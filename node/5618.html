<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5618 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:50:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>&quot;allow positive&quot; disappears after adding | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">&quot;allow positive&quot; disappears after adding</h3>
        <span class="submitted">Submitted by <a href="../user/6791.html" title="View user profile.">a234525</a> on Sat, 23/08/2014 - 18:30</span>
        <div class="content"><p>I have an input displaying instantaneous and daily net import correctly. I am now trying to log positive values only so that I can record daily import from grid.</p>
<p>If I select &quot;Allow Positive&quot; and click add on the Inputs screen, then the process appears in the list and as an icon on the process list below the config section for a few seconds. Then the icon disappears, and the change is not saved.</p>
<p>&nbsp;</p>
<p>This happens at least with</p>
<p>Allow Positve</p>
<p>Allow Negative</p>
<p>Reset to Zero.</p>
<p>&nbsp;</p>
<p>But it allows me to add inputs and log to feeds, and kw to kwh without any issues. I havent tried the other processes.</p>
<p>&nbsp;</p>
<p>is this a bug, or am I doing something incorrecly. I am using the low write version dated 13 August on an SD card, on a PI B+.</p>
<p>&nbsp;</p>
<p>Cheers.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6406.html" class="topic-previous" title="Go to previous forum topic">‹ error after a brand new install</a>
              <a href="6398.html" class="topic-next" title="Go to next forum topic">emoncms - calculate &amp; display cost of natural gas ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-23322"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: "allow positive" disappears after adding</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Sun, 24/08/2014 - 17:34.</div>
    <div class="content">
     <p>it happens to me the same thing !!?</p>
<p>&nbsp;</p>
<p>Saluti</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26172"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7424.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bradtpt&#039;s picture" title="bradtpt&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: "allow positive" disappears after adding</h3>

    <div class="submitted">Submitted by <a href="../user/7424.html" title="View user profile.">bradtpt</a> on Sat, 27/12/2014 - 16:24.</div>
    <div class="content">
     <p>I&#39;m running&nbsp;<strong>emonSD-13-08-14.img.zip</strong>&nbsp;on two separate installations and have found the same thing. &nbsp;These features certainly appear to be&nbsp;broken/disabled in the low-write version.</p>
<p>I have managed to make these input processes&nbsp;work on this version by&nbsp;looking&nbsp;at&nbsp;<strong>/var/www/emoncms/Modules/input/process_model.php</strong>&nbsp;and looking up the numerical codes used in the sql tables to define the input processes. &nbsp;The relevant ones here which we can&#39;t insert on the low-write version&nbsp;are:</p>
<p><strong>24: Allow Positive</strong></p>
<p><strong>25: Allow Negative</strong></p>
<p><strong>33: Reset to zero</strong></p>
<p>These can be manually entered into the processList field for your particular input under the inputs table in the sql database. &nbsp;The easiest way to do this (for a beginner like me) is&nbsp;to install phpMyAdmin and edit the sql database interactively. &nbsp;Previously I was achieving the functionality of &quot;Reset to zero&quot; by multiplying by 0,&nbsp;but with having solar I wanted&nbsp;to log import and export power separately so I really needed the &quot;allow positive&quot; and &quot;allow negative&quot; operations&nbsp;to work. &nbsp;Thankfully, directly&nbsp;adding them to the process list using sql does the trick. &nbsp;To insert a &#39;reset to zero&#39; entry on an existing input of mine&nbsp;I&nbsp;had an input process list which looked like this:</p>
<p><em>1:93,4:94,<strong>2:0</strong>,11:11,11:15,1:115,4:116</em></p>
<p>This translates to:</p>
<p>1:93 -&nbsp;Log&nbsp;to feed 93</p>
<p>4:94 - Power to kWh log to feed 94</p>
<p><strong>2:0 - Multiply by 0</strong></p>
<p>11:11 - +input 11</p>
<p>11:15 - +input 15</p>
<p>1:115 - Log to feed 115</p>
<p>4:116 - Power to kWh log to feed 116</p>
<p>Replace the &quot;multiply by zero&quot; (<strong>2:0</strong>) with <strong>33</strong>&nbsp;and save in phpMyAdmin. &nbsp;The&nbsp;modified&nbsp;process list becomes:&nbsp;<em>1:93,4:94,<strong>33</strong>,11:11,11:15,1:115,4:116</em></p>
<p>The low-write version uses the redis server to buffer data to reduce writes to the SD card,&nbsp;before this change will appear in your inputs back in emoncms&nbsp;you have to run&nbsp;&nbsp;$ <strong>sudo redis-cli flushall</strong>&nbsp;(or wait until the redis server next writes to disk, could be a few seconds to several minutes depending on how full the buffer is).&nbsp;A look at the input process list for that input&nbsp;in emoncms now shows&nbsp;[=0] in place of the [x] which was there previously. &nbsp;The same process applies to insert &quot;allow positive and &quot;allow negative&quot;. &nbsp;The great thing is, once these entries are present in the process list, they can be manipulated as in their order in the process list changed&nbsp;through the web browser without issue.</p>
<p>I&#39;d love to know why this doesn&#39;t work in the low write version natively, hopefully some of the more knowledgeable members can help here.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26216"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="DavidW&#039;s picture" title="DavidW&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: "allow positive" disappears after adding</h3>

    <div class="submitted">Submitted by DavidW (not verified) on Mon, 29/12/2014 - 15:22.</div>
    <div class="content">
     <p>Hi,</p>
<p>I&#39;ve just found the same issue. Glad to see there&#39;s a workaround. Thanks. :)</p>
<p><b>bradtpt</b> wrote: <em>The easiest way to do this (for a beginner like me) is&nbsp;to install phpMyAdmin and edit the sql database interactively</em></p>
<p>Pardon my ignorance (I&#39;m a beginner too) but I think that means install phpMyAdmin on the rPi base (e.g. as per this tutorial I found, <a href="http://www.raspipress.com/2012/09/tutorial-install-phpmyadmin-on-your-raspberry-pi/" title="http://www.raspipress.com/2012/09/tutorial-install-phpmyadmin-on-your-raspberry-pi/">http://www.raspipress.com/2012/09/tutorial-install-phpmyadmin-on-your-ra...</a>)?</p>
<p>Can you (or someone) please confirm?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26245"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7424.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bradtpt&#039;s picture" title="bradtpt&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: "allow positive" disappears after adding</h3>

    <div class="submitted">Submitted by <a href="../user/7424.html" title="View user profile.">bradtpt</a> on Tue, 30/12/2014 - 11:07.</div>
    <div class="content">
     <p>Hi David,</p>
<p>That is correct, the tutorial you linked above will get&nbsp;phpMyAdmin installed. &nbsp;Then&nbsp;you can edit and change things in the SQL database to fix these little glitches.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26257"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="DavidW&#039;s picture" title="DavidW&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: "allow positive" disappears after adding</h3>

    <div class="submitted">Submitted by DavidW (not verified) on Tue, 30/12/2014 - 13:50.</div>
    <div class="content">
     <p>Thanks for the confirmation. :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26259"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: "allow positive" disappears after adding</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 30/12/2014 - 14:09.</div>
    <div class="content">
     <p>The only change that my untrained eye could see that could effect this was the addition of these &quot;curly&quot; brackets in&nbsp;&nbsp;Modules/input/process_model.php, I&#39;m not good with php but I can see the problematic processes all have &quot;None&quot; as $inputprocess[1] so maybe related as this is a v8.4 change to &quot;low-write&quot; emoncms only.&nbsp;</p>
<blockquote><p>if (isset($inputprocess[1]))<strong> {</strong><br />
$arg = $inputprocess[1]; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Can be value or feed id<br />
<strong>&nbsp;}</strong></p>
</blockquote>
<p><a href="https://github.com/emoncms/emoncms/compare/v8.3.6...bufferedwrite#diff-61102ea5f198b440603234fbc9465ac5R107">https://github.com/emoncms/emoncms/compare/v8.3.6...bufferedwrite#diff-61102ea5f198b440603234fbc9465ac5R107</a></p>
<p>​I don&#39;t have a &quot;low-write&quot; emoncms running at the moment to try removing the brackets to test.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26316"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="DavidW&#039;s picture" title="DavidW&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: "allow positive" disappears after adding</h3>

    <div class="submitted">Submitted by DavidW (not verified) on Thu, 01/01/2015 - 15:45.</div>
    <div class="content">
     <p>The phpMyAdmin workaround worked a treat. :) All we need now is a some decent daylight to test the &quot;allow negative&quot; bit (there&#39;s barely enough light to wake up the inverter today, let alone reach export level).</p>
<p>In the interests of investigation I took a first look around the code. I&#39;m more a C++ guy (&amp; a Windows one at that), but looking in input_model.php.</p>
<p><strong>public function add_process($process_class,$userid,$inputid,$processid,$arg)</strong></p>
<p>has a line</p>
<p><strong>$processtype = $process[1];&nbsp;&nbsp; // Array position 1 is the processtype: VALUE, INPUT, FEED</strong><br />
&nbsp;</p>
<p>However, the switch that follow tries to make use of 4 different values, <strong>VALUE, INPUTID, FEEDID</strong> and <strong>NONE</strong>.</p>
<p>I&#39;ve managed to find that <strong>add_process</strong> is called from input_controller.php.</p>
<p>I&#39;m not clear how the $process parameter in the call has been built up, but it does looks from the above as though the <strong>NONE</strong> concept might have been added to existing code, so maybe it&#39;s an avenue for some one more familiar with the code to check?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5618"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-NLOntoZKlApDicGFCGbPFY0nSHOS6PvdtQqewU5IQw8" value="form-NLOntoZKlApDicGFCGbPFY0nSHOS6PvdtQqewU5IQw8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
