<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Hello! New toys... | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/3">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Hello! New toys...</h3>
        <span class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Thu, 28/11/2013 - 11:29</span>
        <div class="content"><p>Hello folks,</p>
<p>My first foray into the forum, I&#39;ve been reading judiciously for some time now and have literally just received my EmonTX v2 kit (thanks chaps) so let the soldering commence ;)</p>
<p>The solar panels are also going up as I speak! The plan is to make use of the immersion diversion - not sure if to go with the router or PLL as reading others&#39; code isn&#39;t my strong point! Also, Arduino is a new environment to me although I did do some stuff on Atmel MCUs back in the dim and distant past! The other plan is to remote switch a pond pump as well as longer term adding a battery bank...</p>
<p>Looking forward to tinkering again and you all seem like friendly folk which no doubt will be of great use along the way :)</p>
<p>Umski</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/4292" class="topic-previous" title="Go to previous forum topic">‹ Tapatalk</a>
              <a href="/emon/node/4232" class="topic-next" title="Go to next forum topic">A new vesion of the Emoncms node for Node-RED  ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-16488"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 28/11/2013 - 16:10.</div>
    <div class="content">
     <p><em>&quot;The plan is to make use of the immersion diversion - not sure if to go with the router or PLL&quot;</em></p>
<p>The main difference is the PLL sketch can monitor and send the data by radio at the same time, Robin&#39;s sketch does not (it is purely and energy diverter/router). Both can run on the same hardware with minor tweaks (if you have the RFM12B) so you can start with one and finish with the other.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16493"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Fri, 29/11/2013 - 09:32.</div>
    <div class="content">
     <p>Ah! Thanks for highlighting that Robert - in my excitement I hadn&#39;t spotted that - I was intending to use the GLCD at some point just to reassure me that things are running as they should once &#39;live&#39; so I guess the PLL version will be my starting point. I&#39;m not quite sure what you mean by &#39;start with one and finish with the other&#39; however? I do have the RFM12B - I went with the 433MHz version - there seem to be mixed opinions on which frequency, but working with mobile phones as my day job, we tend to see better indoor RF performance on the lower bands so I figured that was a useful baseline!</p>
<p>I managed to get most of the passive components on to the EmonTX board yesterday - I&#39;d forgotten how satisfying soldering up a PCB is :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16495"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 29/11/2013 - 09:54.</div>
    <div class="content">
     <p>To test your new hardware, you may find some of the basic tools on my <a href="http://openenergymonitor.org/emon/node/1757">Summary Page</a> to be of use.&nbsp; RawSamplesTool will allow you to see the waveforms from your sensors to check that all is well.&nbsp; The simplest PV Router sketch is my Mk2_mini_3 one.&nbsp; If you&#39;re interested in understanding what&#39;s going on, that&#39;s probably the best one to start with.&nbsp; My Mk2i_rev5 version supports multiple loads and has an RF capability for controlling a remote load.&nbsp; As posted, no transmission of data is supported, but this could be easily added.&nbsp;</p>
<p>Martin&#39;s PLL-based sketch, which does support data transmission, runs on the same hardware so you can switch between them at any time.</p>
<p>At risk of repetition, an 18R burden resistor is not likely to be suitable for a PV Router application - unless you have a 20kW system!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16502"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 29/11/2013 - 13:39.</div>
    <div class="content">
     <p><em>&quot;I&#39;m not quite sure what you mean by &#39;start with one and finish with the other&#39; however?&quot;</em>&nbsp; Not well phrased, I agree. As Robin says, you can easily switch between the two so if you find the one you start with doesn&#39;t suit your needs, you can switch to the other with minimal or no changes to the hardware (given you have the RF module).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16510"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Fri, 29/11/2013 - 16:28.</div>
    <div class="content">
     <p>Thanks Robin for your pointers, I finished soldering all the remaining major bits on earlier so just playing with the compiler and the serial output - seemed to be working ok with a few basic sketches so I&#39;ll have a look at your tools as a next step. I&#39;m waiting for the clamps to arrive before I can do anything serious...However the mk2i_rev5 with remote load switch sounds like a useful one too - thanks :)</p>
<p>Thanks also Robert for clarifying - makes sense!</p>
<p>No doubt I&#39;ll have more questions following some tinkering over the weekend...panels didn&#39;t get finished this week, hopefully Monday...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19004"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Wed, 05/03/2014 - 17:03.</div>
    <div class="content">
     <p>Hello again,</p>
<p>It&#39;s been a while since I started this I realise! The panels went up with a few glitches along the way but have had all that sorted now and a very productive Jan/Feb - too much exported energy though!</p>
<p>After a lot of other diversions, to excuse the pun, I finally got an output board for the triac made up, thanks to Robin for offering a pre-made one, in the end my hand drawn, hand etched board worked without any glitches albeit changing the resistor on the LV side to 10R to get the opto-isolator to work correctly (I have an LED in series)</p>
<p>I went for Martin&#39;s PLL software as this is what I had started to play with and had calibrated. I *think* it is working ok the immersion neon is happily blinking away as is my output board. The serial output I had for a brief period was as follows:</p>
<p>509 514 513 240.11 38.49 2829.45 2772.60 50.07 300.00 2851.38 PLL is locked<br />
	509 513 513 240.15 36.47 2833.23 2773.41 50.07 300.00 2669.03 PLL is locked<br />
	510 513 513 239.64 17.25 2838.69 2761.77 50.06 300.00 2583.13 PLL is locked<br />
	509 513 513 239.72 67.86 2837.35 2763.45 50.06 300.00 2245.21 PLL is locked<br />
	509 513 513 239.57 79.08 2840.34 2760.19 50.06 300.00 1849.82 PLL is locked<br />
	510 513 513 239.92 91.89 2842.73 2768.08 50.06 300.00 1390.35 PLL is locked<br />
	510 513 513 239.90 83.90 2843.22 2767.67 50.06 300.00 972.54 PLL is locked<br />
	509 513 512 240.42 -289.89 2840.20 2390.55 50.06 300.00 2422.01 PLL is locked<br />
	510 514 513 237.90 36.89 2832.91 2721.70 50.06 300.00 2237.53 PLL is locked<br />
	510 513 513 238.73 43.81 2830.95 2740.79 50.06 300.00 2019.37 PLL is locked<br />
	509 514 512 239.02 35.80 2836.53 2747.41 50.07 300.00 1840.38 PLL is locked<br />
	510 513 513 238.86 62.48 2833.96 2743.67 50.08 300.00 1527.96 PLL is locked<br />
	510 513 513 238.79 113.65 2832.41 2742.04 50.07 300.00 961.99 PLL is locked<br />
	509 513 513 238.77 -308.02 2829.78 2357.94 50.07 300.00 2502.09 PLL is locked<br />
	510 513 513 238.67 156.37 2825.58 2739.31 50.07 300.00 1720.26 PLL is locked<br />
	510 513 513 238.41 115.25 2834.01 2733.39 50.07 300.00 1146.34 PLL is locked<br />
	509 513 512 238.74 -270.20 2840.02 2357.20 50.06 300.00 2497.32 PLL is locked<br />
	510 513 513 238.57 97.01 2838.94 2737.05 50.05 300.00 2012.29 PLL is locked<br />
	510 513 513 238.70 174.95 2840.63 2739.99 50.05 300.00 1141.05 PLL is locked</p>
<p>Sorry that might be a bit tricky to read, but I am cautious that the 5th value for Power1 goes negative periodically - this is export so should this happen when the system is working? I see how the energy rises to 2700J and then reduces to 900J as the energy is fed to the immersion, but as I understand it very little should be exported when balanced, no?</p>
<p>Second question is about the meter - we have a mechanical type with 200rev/kWh and it seemed to blip forwards and backwards - no change in the reading of course but do I have scope for changing the energy levels as they are as default for now?</p>
<p>Lastly, have I made any glaring errors in the calibration - I read that the ILEAD values should be about 158uS rather than the default - I can&#39;t find how to go about measuring this without a scope...</p>
<p>#define VCAL 231.6&nbsp; //calibrated 02/03/14 calculated value is 230:9 for transformer x 11:1 for resistor divider = 281<br />
	//#define I1CAL 112.6 // calculated value is 100A:0.05A for transformer / 18 Ohms for resistor = 111.1<br />
	#define I1CAL 108.5 //calibrated 02/03/14<br />
	//#define I2CAL 94.8 // this is for CT2, the solar PV current transformer<br />
	#define I2CAL 108.2 //calibrated 02/03/14<br />
	#define I1LEAD 158 // number of microseconds the CT1 input leads the voltage input by<br />
	#define I2LEAD 158 // number of microseconds the CT2 input leads the voltage input by<br />
	#define POWERCORRECTION 0 // this value, in watts, may be used to compensate for the leakage from<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; voltage to current inputs, it only affects data sent to emonGLCD<br />
	#define LOAD_POWER 2890 //calibrated 05/03/14 //power in watts (at 240V) of triac load for diverted power calculation</p>
<p>Thanks again, I hope to pick up one of Robin&#39;s kits when he&#39;s in full production and likely swap the code as suggested. In the meantime I&#39;m sure the novelty of checking the triac/immersion/meter and running between them will wear off ;) Very satisfying to have this going at last :)</p>
<p>Next step is to get the triac board boxed up - at the moment it is dangling in prototype form. Then to get the GLCD out again which I think I&#39;ve killed :(</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19005"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 05/03/2014 - 17:40.</div>
    <div class="content">
     <p>I&#39;m pleased to hear that another PV Diversion system is in operation.&nbsp; Martin&#39;s code and mine act in a very similar way for the output stage, it&#39;s only the measurement side which is different.&nbsp; If Martin&#39;s PLL code is working fine for you, and your immersion is flashing away as expected, that&#39;s great.&nbsp; No need to change anything.</p>
<p>The main thing to check re. your meter is that there is no net movement.&nbsp; After each complete forward &amp; backward cycle, the disc should end up in the same place.&nbsp; Make sure that it&#39;s not hitting its backstop after each reverse movement. &nbsp; I&#39;ve posted various videos showing this effect.&nbsp; Send me a PM if you need a pointer to any of these (or if you need a smart heatsink :)</p>
<p>With my Mk2 Router code, that much Serial Output would undoubtedly affect the operation.&nbsp; It may be worth commenting out those print statements to see if it makes any noticeable difference.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19006"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 05/03/2014 - 17:57.</div>
    <div class="content">
     <p>If your Ferraris meter is jogging backwards and forwards and not hitting the ratchet that prevents it going backwards (if yours has one - some don&#39;t) and not clocking up energy, then it&#39;s all working properly. You can open up the decision values if you wish, but it&#39;s important not to allow the energy &#39;bucket&#39; to underflow or overflow.</p>
<p>I can&#39;t think of a good reason why you should export energy unless the dump load isn&#39;t available for some reason, it may be something critical like a loose wire or a dirty contact on your immersion thermostat, so I suggest checking obvious things like that first. However, if there&#39;s no apparent cause and it&#39;s a relatively isolated and rare event I wouldn&#39;t worry too much, since tracking it down could be hard. Narrowing the decision values on the energy &#39;bucket&#39; should stop it - but it will increase the flicker rate.</p>
<p>I haven&#39;t looked at a way of measuring ILEAD, so I can&#39;t help you there. If you have a large, suitably rated capacitor, you could try using that as the ONLY load and adjust ILEAD by trial and error to get zero real power. This works because a pure capacitor does not absorb power - the difficulty is getting a representative current with a realistic value of capacitor.. You may need to have many primary turns through your c.t. to do any good.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19041"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Thu, 06/03/2014 - 12:06.</div>
    <div class="content">
     <p>Thanks chaps, that&#39;s reassuring :)</p>
<p>The meter (ABB branded) does have a backstop but I don&#39;t know if there is more than 1 per turn, I&#39;ll take a look at your videos Robin and then see what the tolerance between backwards and forwards is. If it&#39;s one entire turn then that allows a bit of scope for value adjustment. Each turn equates to 5Wh or 18000Ws...</p>
<p>I don&#39;t think there&#39;s any connection issues - the immersion was drawing a full 2890W without the triac involved. The negative value seems to happen each time the energy level drops to 900J which turns the triac off, so as it then takes a brief time to get back up to 2700J this is where it would &#39;appear&#39; to export. Whether this is actually the case, I&#39;m not sure so maybe changing the hysteresis on the on/off values might change this (not seen any flicker so far so seems ok also as lights aren&#39;t usually on during the day probably not such a big issue) I&#39;m curious as to how this affects the output on a GLCD (which I can&#39;t test right now). I think the question is whether anyone else that&#39;s running this code ever sees apparent &#39;export&#39; in the 5 sec intervals with transmissions?</p>
<p>I&#39;m slightly more confused with trying to measure ILEAD with a capacitive load (I feel more and more dumbed down in the &#39;real&#39; world after spending 4 years doing a degree in E&amp;E engineering and not putting it into practice for nearly 10!), I&#39;m curious as to how the original figures might have been derived and what other figures others may be using...</p>
<p>As Robin has suggested before &#39;playing&#39; has helped a great deal in learning the principles, so thumbs up :) Next step is to understand whether the GLCD board (sans display) is receiving the RFM12b transmissions from the EmonTX...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19049"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 06/03/2014 - 14:05.</div>
    <div class="content">
     <p>On the disc-meter that I&#39;ve tested, the backstop cuts in after approx half a revolution in the reverse direction.&nbsp; This behaviour is provided by a little nylon top hat which acts like a pawl or ratchet; one way it gets gently pushed aside as it moves past a protruding obstacle, the other way it catches and any further motion is prevented.&nbsp;</p>
<p>The emonGLCD will display whatever data is sent to it.&nbsp; Because the original emonTx sketches only measure power infrequently (and assume that nothing changes during the periods inbetween), they won&#39;t work reliably if a &#39;burst mode&#39; PV Router is present.&nbsp; A sketch that measures continuously will give much better results.&nbsp; If you are displaying results that are&nbsp; created by Martin&#39;s PLL Router, I would expect the data to be perfect because that sketch records the energy flow during every mains cycle, as do my own Mk2 PV Router sketches.</p>
<p>If you have a spare processing platform handy, you could run my &#39;continuous&#39; code as posted for the emonTx V3.&nbsp; This measures real power continuously on four channels and transmits these values by RF every couple of seconds.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19054"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Thu, 06/03/2014 - 14:45.</div>
    <div class="content">
     <p>That was how I understood it - the RF output on the PLL code is just sent to the GLCD i.e. the data shown from the serial output is effectively what is transmitted to the GLCD and hence displayed. So grabbing a line from above:</p>
<p>509 513 512 240.42 -289.89 2840.20 2390.55 50.06 300.00 2422.01 PLL is locked</p>
<p>realpower1 is -289.89 i.e. the nett house</p>
<p>realpower2 is 2840.20 i.e. the PV output</p>
<p>divertedpower is 2390.55 i.e. the calculated power going to the immersion</p>
<p>Which is exactly what would be displayed on the GLCD. However 5 sec later the following would:</p>
<p>36.89 = import?</p>
<p>2832.91</p>
<p>2721.70</p>
<p>And this is where I was under the impression that when balanced, the first value should hover around zero rather than bouncing up and down quite so much? Or is it because it is a visual &#39;snapshot&#39; of the power rather than seeing what is happening in between? Just want to make sure this is the expected behaviour!</p>
<p>P.S. Saw the videos of the disc-meter - mine is buzzing back and forth for a couple of seconds rather than vibrating in one position - I figure this is due to the low/high energy thresholds?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19055"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1824" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1824" title="View user profile.">MartinR</a> on Thu, 06/03/2014 - 15:01.</div>
    <div class="content">
     <div>
	Umski,</div>
<div>
	&nbsp;</div>
<div>
	It&rsquo;s quite normal for Power1 to show small negative values as the &ldquo;bucket&rdquo; fills up and the meter turns backwards because you really are exporting at this time but because the meter only turns slightly and then starts moving forwards again no units are recorded. If you look at the data you posted and add up the positive samples for Power1 you will see that they almost exactly cancel the negative values, as you&rsquo;d expect in anti-flicker mode.</div>
<div>
	&nbsp;</div>
<div>
	If you want to see the system running with no export reported then set the high and low buffer thresholds to 1800 so the buffer size is 0.</div>
<div>
	&nbsp;</div>
<div>
	I posted a sketch some time ago which measures ILEAD directly when a purely resistive load is present...</div>
<div>
	&nbsp;</div>
<div>
	<a href="2054" title="http://openenergymonitor.org/emon/node/2054">http://openenergymonitor.org/emon/node/2054</a></div>
<div>
	&nbsp;</div>
<div>
	This should give you a&nbsp;reasonable value but be aware that, as Robert Wall has pointed out many times, the CT phase shift does vary with current so you need to choose a representative load.</div>
<div>
	&nbsp;</div>
<div>
	-martin</div>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19056"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 06/03/2014 - 15:38.</div>
    <div class="content">
     <p>If my video shows the disc meter to be &quot;vibrating in one position&quot;, that suggests my Router is in its &quot;normal&quot; mode.&nbsp; If I were to repeat the test with the Router in AF mode, the disc would repeatedly wind its way forwards and backwards within its permitted zone.&nbsp; When using a digital meter, the penalty-free zone that&#39;s allowed is generally either 3600 J (1 Wh), or 1250 J.&nbsp; In your case, you can probably extend your Router&#39;s limits because your non-reversing disc meter won&#39;t hit the brakes until around 2.5 Wh&#39;s worth of reverse flow has occurred.</p>
<p>Depending on the cycle rate of your Router, it&#39;s quite possible that occasional periods of nett import will be correctly reported.&nbsp; Over a sufficiently long timescale, all imports and exports should balance out (as demonstrated by your disc meter), but that will only occur if energy flow is being measured continuously.&nbsp;</p>
<p>I&#39;m sure I&#39;ve posted footage of a disc meter while running a Router in AF mode.&nbsp; Yes, <a href="http://www.youtube.com/watch?v=v8ifoUJvcXY%C2%A0">here&#39;s an exciting one</a> for you to watch.&nbsp; It even talks about phaseCal.&nbsp; Better stock up on the popcorn first!</p>
<p>(is there a category for the most boring video on the Web?)</p>
<p>[Edit]&nbsp; Sorry, that one isn&#39;t in AF mode ... nor can I find any others.&nbsp; To perform that &#39;live&#39; test, I connected Noah&#39;s disc-meter into our domestic supply on the &#39;safe&#39; side of our 2-pole isolator box.&nbsp; After some weeks of that temporary arrangement, I reconnected the wiring as it should be, and don&#39;t wish to disturb it again now.&nbsp; At that time, autumn 2012, flicker had not been raised as an important issue, so my Mk2 Router did not have an AF mode.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19057"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Thu, 06/03/2014 - 15:50.</div>
    <div class="content">
     <p>Thanks Martin :D More reassurance that all is well (and yes no units recorded - will check again today when I get home) - I&#39;ll also check the buffer set to zero scenario too! So in AF mode, it is expected that there might be some +/- shown as and when I get a GLCD working...</p>
<p>And thanks also for the link to the phasecal - this is one page I&#39;ve not come across on my judicious searches! I will try that too :)</p>
<p>Robin - I did watch all 16.24m of that video earlier - I&#39;ve seen more boring stuff, trust me ;) In this context it makes perfect sense! As you say I probably have a bit of scope with the disc meter - more experimentation ahead!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19060"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 06/03/2014 - 17:12.</div>
    <div class="content">
     <p><em>Robin - I did watch all 16.24m of that video earlier - I&#39;ve seen more boring stuff, trust me ;) In this context it makes perfect sense!&nbsp; </em></p>
<p>Umesh - you&#39;ve made my day!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19077"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Fri, 07/03/2014 - 11:32.</div>
    <div class="content">
     <p>Glad to hear it Robin ;)</p>
<p>So I did some more tinkering and have observed as follows:</p>
<p>Using Martin&#39;s Phasecal sketch, I ran this with CT1 and CT2 on the immersion wire alone. With this I got values of 7uS and 3uS respectively. This surprised me but at the same time the original values were 5uS in the calibration data...</p>
<p>I then clipped both CTs to the PV (~400W) and got ~155uS for both...</p>
<p>I understand the implications of the current affecting the phase so variance between very low power levels and high ones...but are the values taken on the immersion the representative ones I should use for ILEAD1/2 or should I stick to 155uS as for the actual source/load inputs that are being measured?</p>
<p>&nbsp;</p>
<p>Second change was the energy levels - changing to 1800J works as expected with very low import/export (below) with the meter buzzing in the same place :) No issues with flickering it seems but then we don&#39;t have any incandescent bulbs...</p>
<p>509 513 512 240.09 3.74 533.49 844.51 49.96 300.00 1783.88 PLL is locked<br />
	510 514 513 240.41 0.39 535.30 733.72 49.95 300.00 1781.92 PLL is locked<br />
	510 513 513 240.69 -0.14 534.79 735.44 49.94 300.00 1782.63 PLL is locked<br />
	509 513 513 240.78 -1.74 535.95 771.04 49.95 300.00 1791.29 PLL is locked<br />
	509 513 513 241.13 2.02 538.03 793.51 49.95 300.00 1781.21 PLL is locked<br />
	510 513 513 240.56 2.86 537.90 781.23 49.94 300.00 1766.97 PLL is locked</p>
<p>I then tried to up the buffer to 7200J with 900J and 6300J thresholds - the meter did the same as before with back and forth movement, but longer of course...</p>
<p>So is there any benefit to the increased buffer size if I&#39;m not using AF mode - or at all for that matter, other than to ensure no nett energy is imported?</p>
<p>&nbsp;</p>
<p>Last of all - I&#39;d set the immersion thermostat to max (65deg I think) and although all but one or two taps are mixers I nearly scalded myself having &#39;calibrated&#39; my brain to the &#39;normal&#39; temperature for the basin tap when heated by gas! So plenty energy being shunted it seems :D</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19079"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 07/03/2014 - 12:23.</div>
    <div class="content">
     <p>The way to look at choosing the value for phasecal is to consider the current. The PV current is roughly steady, varying with the amount of power generated. The grid current, when the diverter is in balance, is pulses of up to 12 A imported balanced by a different and lower exported current. At other times, the grid current is your normal household load, with or without the dump load.</p>
<p>I&#39;d suggest you probably want the phase calibration for the PV feed to be somewhere between 7 and 155 (as 7 represents about 12 A and 155 represents less than 2 - take your pick for where you want the best accuracy!) and the grid connection should probably be set much nearer the 7 end, since the current there is around 12 A when the diverter is working. Assuming you&#39;re using the YHDC ct&#39;s, if you take a look at the report you&#39;ll see exactly how the phase error varies with current and you can make an informed choice.</p>
<p>In case you&#39;re wondering, the answer to the variation is a pair of (much) more expensive ct&#39;s.</p>
<p>Also bear in mind that the phase error is least important with resistive loads, and only becomes critical when you have a very poor power factor, i.e. a mainly reactive load, which tends to be very small appliances and those on standby.</p>
<p>If you and your neighbours don&#39;t experience any flicker, then there&#39;s no real advantage of one method over the other. But if your meter gets replaced, be prepared to make a change if you chose the anti-flicker mode with a wide band and you find the new meter has a small energy packet size.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19130"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Mon, 10/03/2014 - 15:46.</div>
    <div class="content">
     <p>Hello again!</p>
<p>Thanks for the feedback Robert - it makes sense. I experimented with different values for ILEAD and it seems to make little (at least visual) difference to the balance (I have the YHDC 100A CTs) as Robin has also found I believe. Instinctively, I am inclined to have more accuracy at the low end of the power scale but this changes as a result of the load, at least on the house measurement...as a result I have left them at 155uS for the timebeing with the AF off (there aren&#39;t any near neighbours!)</p>
<p>Another question is regarding the &#39;power3&#39; value or &#39;divertedpower&#39; as it is calculated - I frequently see this as being more than the output of the PV - logic dictates that this can&#39;t be the case as power1 is close to 0, but over a sample period of 1 min, it never went below the PV power output. I&#39;m a little confused as I see where this is done in Martin&#39;s code, but also see the Brian D on Martin&#39;s original thread, averaged to value to the GLCD? Would measuring the immersion power with a third CT be any more accurate? Thoughts - does anyone else see this?</p>
<p>510 513 512 240.76 34.52 1210.15 <strong>1365.13</strong> 50.02 300.00 1774.97 PLL is locked<br />
	510 513 513 240.85 -15.25 1216.72 1105.96 50.02 300.00 1790.22 PLL is locked<br />
	510 513 513 240.64 -28.97 1220.80 <strong>1278.43</strong> 50.02 300.00 1819.19 PLL is locked<br />
	510 513 513 240.68 52.52 1224.20 <strong>1364.24</strong> 50.03 300.00 1767.73 PLL is locked<br />
	510 513 513 240.70 -31.62 1228.23 <strong>1395.25</strong> 50.02 300.00 1799.35 PLL is locked<br />
	510 513 513 240.77 -14.89 1234.17 <strong>1483.99</strong> 50.02 300.00 1813.94 PLL is locked<br />
	510 513 513 240.78 12.46 1238.82 <strong>1602.80</strong> 50.03 300.00 1801.72 PLL is locked<br />
	510 513 513 240.86 14.70 1243.23 <strong>1366.21</strong> 50.03 300.00 1787.32 PLL is locked<br />
	510 513 513 240.79 20.76 1253.12 <strong>1306.15</strong> 50.02 300.00 1766.98 PLL is locked<br />
	510 513 513 240.84 -17.09 1264.37 <strong>1544.24</strong> 50.03 300.00 1783.72 PLL is locked<br />
	510 513 513 240.82 -24.78 1271.31 <strong>1543.98</strong> 50.03 300.00 1808.01 PLL is locked<br />
	510 513 513 240.83 12.11 1269.01 <strong>1425.37</strong> 50.03 300.00 1796.14 PLL is locked</p>
<p>P.S. I have been able to get the GLCD board to receive transmissions so can at least remotely pick up the values over serial for now :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19142"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 11/03/2014 - 00:11.</div>
    <div class="content">
     <p>Martin calculates the diverted energy as the product of the number of cycles and the rating of the heater, scaled for the actual voltage. My first thought is the actual rating of your immersion heater is not what it says on the tin!&nbsp; Martin didn&#39;t use a thermostat as he was measuring temperature and using that to override the energy diversion (but that code isn&#39;t in his sketch as published), hence he didn&#39;t count cycles when the thermostat was open, which you can do (but apparently didn&#39;t for the period above). &quot;Diverted energy&quot; is wrong, if you have an active thermostat it should really be &quot;Energy available for diversion&quot;.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19144"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Tue, 11/03/2014 - 01:23.</div>
    <div class="content">
     <p>This sketch works well with a&nbsp;3rd ct for diverted energy. <a href="https://www.dropbox.com/s/q4i3fsn3a0qzjki/eMC_original_plus_3rd_ct.zip">here</a> is a copy of Martin&#39;s original sketch with the 3rd channel added which I have been happily using a version of for several months now.</p>
<p>The differences for the 3rd&nbsp;ct are all marked as when I did it I wanted to track the changes I made in case of any issues, which there wasn&#39;t.</p>
<p>Regards Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19154"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Tue, 11/03/2014 - 15:31.</div>
    <div class="content">
     <p>Thanks Robert, I measured the full immersion power when I calibrated at the start (i.e. just on) and that&#39;s where the figure came from. As I understand Martin&#39;s code, it is calculating Power to the immersion, rather than Energy as per the following two lines</p>
<p>divertedPower=((float)divertedCycleCount*LOAD_POWER)/cycleCount;<br />
	divertedPower=divertedPower*(Vrms/240)*(Vrms/240); // correct power for actual voltage</p>
<p>The thermostat was closed as the figure for power1 is marginally positive/negative and the energy levels are hovering around the 1800J mark as expected (no AF on). This is why I&#39;m a bit confused as to why the calculation doesn&#39;t seem to match what one would expect...</p>
<p>Silly question maybe - first line is percentage of cycles on i.e. proportion of full power, second line corrects for actual voltage (Vrms/240) but why is this multiplied twice? (Peak voltage?)</p>
<p>&nbsp;</p>
<p>Thanks also Paul, this is what I would have done eventually! - very good of you to comment the additional lines - saves having to find every place where repeating code is required! How have you found the measured value to the calculated value - I see you are still keeping both values?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19155"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1824" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1824" title="View user profile.">MartinR</a> on Tue, 11/03/2014 - 15:51.</div>
    <div class="content">
     <p>Power is proportional to voltage squared hence the need to multiply twice.</p>
<p>Did you take the voltage into account when you measured the initial power?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19159"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Tue, 11/03/2014 - 17:26.</div>
    <div class="content">
     <p>Thanks Martin, of course P=V^2/R *doh!*</p>
<p>When you say take the voltage into account, have I missed something obvious there? I simply clipped CT1 onto the immersion feed whilst on and took the reading from the serial reading...it was close enough to 3kW hence using the figure of 2890W</p>
<p>Do the readings for P3 look odd to you?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19343"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Mon, 17/03/2014 - 10:09.</div>
    <div class="content">
     <p>Update!</p>
<p>I think I&#39;ve gotten to the bottom of this. I have been away for most of the week so happily assuming the system was ticking along with plenty of hot water. Of course something had gone awry and when I returned things seemed normal until I realised the water wasn&#39;t quite as hot as it had been...</p>
<p>The output from the Emon seemed to be flashing away, as was the immersion neon, but when I checked the serial readings the energy level was stuck on 3600. That pointed to the immersion stat, which at a glance seemed &#39;ok&#39; but the thermostat wouldn&#39;t kick in and when it did still nothing was happening. That pointed the finger at the overheat cut-out which had tripped :o On resetting this there was still something odd going on so I had to take the cover off to see what had happened. One of the two contacts that are separated by the overheat hadn&#39;t closed again after the reset so I reseated it. Problem solved? Not quite!</p>
<p>Now the neon was coming on intermittently even though the output was fully &#39;on&#39;. If I connected the immersion feed directly no problem. That pointed to the output board - I thought the triac might be fried but then why was it random? I ended up taking the board off and hooking it up to my 60W test lamp testing it with Martin&#39;s manual power level feature (very handy!). Lo and behold, it was the input driver that was only firing the opto-coupler intermittently - seems the combination of the LED and resistor (only 10R) was robbing the LED in the MOC3041. In my haste I hadn&#39;t considered the implications of this but having looked at the datasheet in a bit more detail, the series LED works just as well as a current limiting resistor in this case, so I removed the 10R and it seemed to be happy again.</p>
<p>Reassembled and yippee all is well (apart from no hot water this morning due to the boiler not kicking in - seems the indirect overheat stat had also tripped so must keep an eye on whether this happens again). It seems that the &#39;divertedpower&#39;, P3 values were showing as greater than the PV output due to the trigger not turning the triac on as expected so the energy wasn&#39;t diverted so in turn the totted up value of cycles equated to a higher value than one would expect - all seems fine now! At least that&#39;s how I understand it...</p>
<p>Thanks again for the input folks and hopefully this might be of help to someone in the future!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19346"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 17/03/2014 - 13:33.</div>
    <div class="content">
     <p>The choice of opto-trigger and series resistor is critical. Martin chose to use a high-sensitivity trigger (which needs less current) and used the logical high output as &quot;ON&quot; and connected the trigger between the output and ground, taking advantage of the pulse jack to make the connection. Robin used the standard trigger and as the output swing of the 328 goes closer to the GND than to the Vcc, he had to use logical low = &quot;ON&quot; and connect the trigger between Vcc and the output. It was impossible to choose a series resistor for Robin&#39;s trigger using the active high configuration that met all the worst-case combinations of component tolerances, and that is why he had to use the active low configuration and why he cannot use a series LED.&nbsp; (I know because I did the sums for him. I have not done the sums for Martin&#39;s configuration.)</p>
<p>Also, bear in mind that Martin&#39;s &quot;Diverted Power&quot; is not the power actually diverted, only the power <strong><em>available for diversion</em></strong>. Martin used a temperature sensor on the tank to override diversion when the tank was hot, therefore it worked for him. It will not work for you if a thermostat overrides the energy diverter. But from your tale of woe, it sounds as if you too need to incorporate a temperature sensor that overrides the diversion.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19370"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Tue, 18/03/2014 - 11:39.</div>
    <div class="content">
     <p>Yes, I hadn&#39;t noticed the subtle difference that Martin chose the MOC30<strong>63</strong> rather than the 30<strong>41</strong> (which bizarrely I happened to already have my box of bits!). It seems to be behaving now anyway....I had intended to get one of Robin&#39;s output boards but had already started designing and then etching my own&nbsp; - I may still end up doing this with a more &#39;permanent&#39; set-up. I guess you don&#39;t learn unless you play!</p>
<p>Unfortunately, having a temperature sensor on the tank wouldn&#39;t be practical so I&#39;m relying on the mechanical stat. I expect having never been used since the previous owners installed the tank, it is a bit ropey so I will be keeping a close eye on this. It seemed to be clicking on and off yesterday. Looking at the data sent from the Emon and the fact that as soon as the stat opens the &#39;diverted power&#39; hits the limit, I think I have established all the scenarios where this has occurred:</p>
<p>1. The diverted power is way more than the PV output (this is the easy one to figure out)</p>
<p>2. The PV is more than the full diverted power, BUT importantly the export is way more than if the immersion was actually running (this is trickier to define)</p>
<p>Using some combined logic (it&#39;s easy to see this mentally but harder to state it logically!) I am using the GLCD board to light up the LEDs when I believe the thermostat has opened and the &#39;diverted power&#39; is on full (and/or lots of export!). If this proves to be successful then eventually I can separate out the &#39;real&#39; diverted power to calculate energy diverted. Then when I get round to sorting out the LCD I can make it clear when energy is being absorbed or when the tank is hot and the stat opens. In principle I could do the same on the EmonTX but I&#39;ll need to take a closer look at Martin&#39;s code to ensure there are no side effects and how to go about &#39;re-triggering&#39; the diversion when the stat closes again...for the timebeing it seems we have too much hot water anyway!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19376"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 18/03/2014 - 12:38.</div>
    <div class="content">
     <p>At first glance, you might be able to assume that if the available energy reaches the upper limit, then the tank thermostat has opened, but this is only always true if the PV capacity is less than the immersion load. If greater (i.e. you have a 3 kW load and 3.6 kW of PV), then it&#39;s possible to hit the upper limit and still be diverting energy. Other than with a ct on the immersion feed, I don&#39;t think it is possible to know with absolute certainty when diversion is actually taking place. Hitting the upper limit certainly means export is taking place, but you knew that anyway.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19379"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Tue, 18/03/2014 - 13:44.</div>
    <div class="content">
     <p>I ran through scenario 2 (we have 4kWp) and I believe the following covers it:</p>
<p>if (emontx.power2 &gt; 2890 &amp;&amp; emontx.power1 &lt; emontx.power1+emontx.power2-emontx.power3)</p>
<p>This checks if the PV output is more than the max immersion load (not ideal I know as this can be lower) AND whether the amount of export defies this being the case i.e. if the export value more negative than the export+PV (i.e. the house) less the immersion then the totals won&#39;t add up...</p>
<p>P1 = -3000, P2 = 3500, P3 = 2890 is an example where the stat has opened</p>
<p>P1 = -1000, P2 = 3500, P3 = 2890 is an example where the stat is closed</p>
<p>Basically if the immersion is fully on, then there is no way that the P1 value can be that negative. At least that&#39;s how I&#39;ve seen it behave - of course there may be an alternative scenario or one where the figures are very close together and nearly balance...time will tell ;)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19572"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3943" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Umski&#039;s picture" title="Umski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello! New toys...</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3943" title="View user profile.">Umski</a> on Fri, 21/03/2014 - 12:13.</div>
    <div class="content">
     <p>Ok I correct myself ;)</p>
<p>With the scenario 2 acting itself out today (i.e. PV &gt; Full Immersion load), my LED came on regardless of diversion on/off :(</p>
<p>My flawed logic was in the emontx.power1 &lt; emontx.power1+emontx.power2-emontx.power3 part which will always be the case when exporting - duh!</p>
<p>So actually what is needed is to make use of what the house is actually consuming and remove the immersion factor - if this is positive then the immersion is still on, if the stat has tripped and lots is being exported then the value is negative as such:</p>
<p>if (emontx.power2 &gt; 2890 &amp;&amp; emontx.power1+emontx.power2-emontx.power3 &lt; 0)</p>
<p>Some real examples:</p>
<p>Immersion on:</p>
<p>P1 = -163, P2 = 3205, P3 = 2932: P1+P2-P3 = 110</p>
<p>Immersion off:</p>
<p>P1 = -3100, P2 = 3217, P3 = 3131: P1+P2-P3 = -3014</p>
<p>&nbsp;</p>
<p>Seems to make sense now!</p>
<p>Edit: In fact the same logic covers both scenarios regardless of whether the PV is greater than the max load i.e. if the house consumption isn&#39;t positive then the diversion has stopped :)</p>
<p>if(emontx.power2 &gt;= 0 &amp;&amp; emontx.power1+emontx.power2-emontx.power3 &lt; 0) then the diversion has stopped and there is export going on</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/3237"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ruuFDq_fvzYSWW8GssO9r0h8q9Ylbjd7ylGN5-afrBY" value="form-ruuFDq_fvzYSWW8GssO9r0h8q9Ylbjd7ylGN5-afrBY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
