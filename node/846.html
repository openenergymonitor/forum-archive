<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/846 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:08:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?. | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>
        <span class="submitted">Submitted by Guest on Mon, 16/07/2012 - 08:59</span>
        <div class="content"><p>&nbsp;<span style="color: rgb(34, 34, 34); font-family: arial, sans-serif; font-size: 13px; ">How is it calculated 1480.</span></p>
<div style="color: rgb(34, 34, 34); font-family: arial, sans-serif; font-size: 13px; ">NUMBER OF SAMPLES = 1480 it come from?.</div>
<div style="color: rgb(34, 34, 34); font-family: arial, sans-serif; font-size: 13px; ">Thank You.</div>
<div style="color: rgb(34, 34, 34); font-family: arial, sans-serif; font-size: 13px; ">&nbsp;</div>
<div style="color: rgb(34, 34, 34); font-family: arial, sans-serif; font-size: 13px; ">
<pre style="white-space: pre-wrap; width: 700px; background-color: rgb(238, 238, 238); padding: 0.75em 1.5em; font-size: 14px; border: 1px solid rgb(221, 221, 221); line-height: 17px; text-align: left; ">
#include&nbsp;<span style="color: rgb(0, 102, 153); ">&quot;EmonLib.h&quot;</span>                   <span style="color: rgb(126, 126, 126); ">// Include Emon Library</span>
EnergyMonitor&nbsp;ct1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr></wbr>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(126, 126, 126); ">// Create an instance</span>

<span style="color: rgb(204, 102, 0); ">void</span> <span style="color: rgb(204, 102, 0); "><b>setup</b></span>()
{&nbsp;&nbsp;
&nbsp;&nbsp;<span style="color: rgb(204, 102, 0); "><b>Serial</b></span>.<span style="color: rgb(204, 102, 0); ">begin</span>(9600);
&nbsp;&nbsp;
&nbsp;&nbsp;ct1.currentTX(1,&nbsp;115.6);&nbsp;&nbsp;&nbsp;&nbsp;<wbr></wbr>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(126, 126, 126); ">// CT channel, calibration</span>
}

<span style="color: rgb(204, 102, 0); ">void</span> <span style="color: rgb(204, 102, 0); "><b>loop</b></span>()
{
&nbsp;&nbsp;<span style="color: rgb(204, 102, 0); ">double</span> Irms = ct1.calcIrms(1480);    <span style="color: rgb(126, 126, 126); ">// Calculate RMS current (1480: no. of samples)</span>
&nbsp;&nbsp;
&nbsp;&nbsp;<span style="color: rgb(204, 102, 0); "><b>Serial</b></span>.<span style="color: rgb(204, 102, 0); ">print</span>(Irms*240.0);	       <span style="color: rgb(126, 126, 126); ">// Print to serial apparent power</span>
&nbsp;&nbsp;<span style="color: rgb(204, 102, 0); "><b>Serial</b></span>.<span style="color: rgb(204, 102, 0); ">print</span>(<span style="color: rgb(0, 102, 153); ">&quot; &quot;</span>);
&nbsp;&nbsp;<span style="color: rgb(204, 102, 0); "><b>Serial</b></span>.<span style="color: rgb(204, 102, 0); ">println</span>(Irms);		       <span style="color: rgb(126, 126, 126); ">// Print to serial Irms&nbsp;</span>
</pre></div>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="969.html" class="topic-previous" title="Go to previous forum topic">‹ Phase controlled power switch for &#039;excess&#039; solar power</a>
              <a href="957.html" class="topic-next" title="Go to next forum topic">DS18B20 on hot water cylinder ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-5240"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 16/07/2012 - 15:09.</div>
    <div class="content">
     <p>The sketch reads approximately 106 samples of current in each cycle of mains at 50 Hz. 1480 samples therefore works out at 14 cycles of mains. That will give you a good average reading. You can change the number, but you should get as close as possible to having a whole number of mains cycles, otherwise if you have only part of a cycle on the end, you will introduce an error.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5244"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 16/07/2012 - 18:01.</div>
    <div class="content">
     <p>In contrast with the 'current only' sketch, the 'voltage &amp; current' sketch measures for a whole number of cycles.&nbsp; It actually counts the number of zero-crossings, so for a one second window at 50Hz you would pass the value 100.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5279"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Komkanit99&#039;s picture" title="Komkanit99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by Komkanit99 (not verified) on Thu, 19/07/2012 - 17:33.</div>
    <div class="content">
     <p>&nbsp;Thank You. &nbsp; &nbsp; &nbsp;&nbsp;<img src="../sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/teeth_smile.html" alt="" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5283"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 20/07/2012 - 01:37.</div>
    <div class="content">
     <p>You can time the code like this:</p>
<blockquote><p>unsigned long timethen = millis();<br />
double Irms = emon1.calcIrms(1172);&nbsp; // Calculate Irms only<br />
Serial.print(&quot;Time &quot;);Serial.print(millis() -       timethen);Serial.print(&quot; &quot;);</p>
</blockquote>
<p>This gives you the time to read (in this case) 1172 samples. The time it took was very close to 200 ms (10 cycles at 50 Hz) with an average of 200.033 ms counted over 452 loops. If you wish to time more accurately, you could use micros( ).</p>
<p>A little while ago, Trystan Lea measured 1185 for 10 cycles at 50 Hz.</p>
<p>200 ms&nbsp; would seem to be a good time to aim for, because 200 ms will also give an integral number of cycles at 60 Hz.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5691"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rahuls&#039;s picture" title="rahuls&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by rahuls (not verified) on Mon, 13/08/2012 - 20:37.</div>
    <div class="content">
     <p>What will be the calibration for 230 V with same SCT 013-000 transformer? I am using the normal 5V arduino board? And is this SCT CT is having the built in zener diodes?&nbsp;</p>
<p>&nbsp;</p>
<p>Thanking you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5694"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 13/08/2012 - 23:42.</div>
    <div class="content">
     <p><a href="../user/989.html" title="View user profile.">rahuls</a></p>
<p>The system mains voltage does not affect the current calibration constant, you can follow the calculations <a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory">here </a>where everything is explained (including the 30 A c.t. which has a built-in burden resistor and <strong>no</strong> zener diodes).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5835"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rahuls&#039;s picture" title="rahuls&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by rahuls (not verified) on Tue, 21/08/2012 - 11:58.</div>
    <div class="content">
     <p>Respected sir, </p>
<p>The serial print which prints 106 sample values alongwith the rms current? </p>
<p>I need to take average of 106 samples and i need to calculate the apparent power (Only one value on serial port)?</p>
<p>How we can calculate as i used for loop for it but it is showing 106 samples value. </p>
<p>kINDLY REPLY.I am totally stuck at this point</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5836"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 21/08/2012 - 13:55.</div>
    <div class="content">
     <p>Hello rahuls, </p>
<p>Please can you ask your question in a simple way so that I can understand exactly what you are asking.</p>
<p>If you want to measure real power, the best way is to use the standard Voltage and Current sketch.&nbsp; Then you won't need to worry about how many samples are to be used. </p>
<p>c-r</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5847"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rahuls&#039;s picture" title="rahuls&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by rahuls (not verified) on Tue, 21/08/2012 - 16:21.</div>
    <div class="content">
     <p>Respected sir,<br />
Actually the sketch that is uploaded for current measurement and as per the 1480 samples it will shows the 1480 current and apparent power values in the serial value? So sir if i used 106 sample values then can i take the average of 106 values i.e. of Apparent power values.</p>
<p>Thanking you. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 21/08/2012 - 17:34.</div>
    <div class="content">
     <p>Hi rahuls, </p>
<p>The &quot;Current Only&quot; sketch should give approximately the right answer whatever number of samples you specify.&nbsp; But if you measure over a whole number of mains cycles, the result will be more stable.</p>
<p>I am still not clear what you are trying to measure.&nbsp; Is it &quot;real power&quot;, as a supply-meter would do, or do you want to measure something else?&nbsp; Are you measuring voltage as well as current?</p>
<p>(I will only deserve the &quot;respected sir&quot; title if I can solve your problem !!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5880"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How is it calculated 1480. NUMBER OF SAMPLES 1480 it come from?.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 22/08/2012 - 23:38.</div>
    <div class="content">
     <p>Rahuls,</p>
<p>The way the analogue to digital converter in the processor measures both voltage and current are similar. The signal is changing rapidly, it is approximately a 50 Hz sine wave. Samples of the sine wave are measured and mathematics are done on the numbers. First, a high pass filter is used to remove any d.c. offset. Then:</p>
<ol>
<li>To calculate real power: Voltage and Current are multiplied together and the result is added to an accumulator and a count kept of the number of additions made. At the end of the measuring period, the total in the accumulator is divided by the count to give the average power. If you do this over a whole number of mains cycles, you will get a more accurate answer than if you stop part way through a cycle. The more whole cycles that you average, the smaller the error will be if you do not stop at exactly the right place.</li>
<li>To calculate rms voltage or current: The voltage (or current) is multiplied by itself and the result is added to an accumulator and a count kept of the number  of additions made. At the end of the measuring period, the total  in the accumulator is  divided by the count to give the average (mean) and then the square root is taken. This gives the rms (<strong>r</strong>oot of the <strong>m</strong>ean <strong>s</strong>quare) value. Again, if you do this over a whole number of mains cycles, you will get a more  accurate answer than if you stop part way through a cycle.</li>
</ol>
<p>In the current-only sketch, voltage is not measured and so Vrms and Real Power cannot be known. You assume a value for voltage and from that you can only estimate Apparent Power.</p>
<p>In the voltage &amp; current sketch, voltage and current are measured one after the other and the three calculations are done together. At the end, when you have calculated rms current, rms voltage and real power, you can then calculate:</p>
<ol>
<li>Apparent Power (VA) = Vrms x Irms</li>
<li>Power factor = Real Power / Apparent Power</li>
</ol>
<p>You do not need to know the 106 individual readings for each mains cycle, and you should not try to look at them because you will slow the processor down and they mean nothing. The only numbers that you should use are the results from your calculations: Vrms, Irms, Real Power, Apparent Power and Power Factor.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/846"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-xzdKAPBKKPKdcLG8logchov9iQvVDFjhnfosvpWBCQ0" value="form-xzdKAPBKKPKdcLG8logchov9iQvVDFjhnfosvpWBCQ0"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
