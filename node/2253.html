<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Shared bias circuit | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/4">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Shared bias circuit</h3>
        <span class="submitted">Submitted by Guest on Wed, 17/04/2013 - 21:25</span>
        <div class="content"><p>Would it be a good idea to build a shared biasing circuit for the ct sensors? I built a board in order to sample 4 ct sensors and a biasing circuit for each one of them. The circuit would be extremely accurate if all resistors and capacitors had the same values which unfortunately is not a reality.</p>
<p>Cheers.</p>
<p>P.S. excellent project guys keep up the good work.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/2176" class="topic-previous" title="Go to previous forum topic">‹ Resolved - EmonGLCD time not received</a>
              <a href="/emon/node/2261" class="topic-next" title="Go to next forum topic">OKG with Wiznet W5200 pcb v1.01 reset mod ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-11400"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 17/04/2013 - 21:53.</div>
    <div class="content">
     <p>Calypso_rae advocated this some time ago and his design for the Mk2 router uses a shared bias (so it&#39;s not a new idea). But he&#39;s found in practice that it makes no measurable difference.</p>
<p>Why do you presume it would be &quot;extremely accurate if all resistors and capacitors had the same values&quot;? The RC time constant is very long compared to the operating frequency (50 Hz) and the offset is removed in the software anyway. The only difference it makes is if the midpoint is not exactly in the middle, it reduces the headroom slightly - by 1% if you&#39;re using 1% resistors.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11407"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="allanba&#039;s picture" title="allanba&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by allanba (not verified) on Wed, 17/04/2013 - 22:10.</div>
    <div class="content">
     <p>Thanks for the reply, that&#39;s true, bad presumption from my part. I thought about adding a regulator to the biasing circuit, will it&nbsp; increase the error proportionally to the difference between the voltage in the Arduino and the voltage in the circuit?.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11409"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 17/04/2013 - 22:51.</div>
    <div class="content">
     <p>Sorry, but you haven&#39;t explained what you are thinking. Can you explain where the error that you are worried about arises? And which voltages are you talking about?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11412"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="allanba&#039;s picture" title="allanba&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by allanba (not verified) on Thu, 18/04/2013 - 00:04.</div>
    <div class="content">
     <p>I get the following output from my 4 ct&#39;s,</p>
<p>2.35&nbsp;&nbsp;&nbsp; 2.42&nbsp;&nbsp;&nbsp; 2.37 &nbsp;&nbsp; 2.46</p>
<p>2.37 &nbsp; 2.39 &nbsp;&nbsp; 2.41 &nbsp;&nbsp; 2.32</p>
<p>2.44 &nbsp;&nbsp; 2.31 &nbsp; 2.33 &nbsp; 2.38</p>
<p>As you see the values oscillate within a range not greater than 0.15 A</p>
<p>According to my boss there is something wrong with the circuit, I then changed part of the circuit and it turned out to be the same. Now he says that he wants the basing circuit to be shared and also regulated to operate on 5 V . My first thought on that was that the adc inside the arduino uses a reference voltage equal to vcc, that means that the readings taken in the arduino will be from 0 V - to vcc in the equivalent digital scale (0-1023),&nbsp; if the voltage. If I in example get 4.5 as the voltage in the circuit then the mid point will be roughly 2.25 and the mid point for the arduino at lets say 5.2 V will be 2.6V&nbsp; that means a possible error of 13 percent (if I am right)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11415"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 18/04/2013 - 01:28.</div>
    <div class="content">
     <p>The short answer regarding the reference voltage you mention is that variations are taken care of in the emonlib library functions and the absolute value in the calibration procedure you do when commissioning.</p>
<p><em>&quot;If I in example get 4.5 as the voltage in the circuit then the mid point will be roughly 2.25 and the mid point for the arduino at lets say 5.2 V will be 2.6V&nbsp; that means a possible error of 13 percent (if I am right)&quot;</em><br />
	No, all it means is that the available dynamic range of the input is reduced. In your example zero input will read 433 counts, so your maximum peak-peak input amplitude before clipping is 886 counts rather than 1024. After the high pass filter in software, the signal is still centred about zero, just as it was before. There&#39;s no sensible reason to have a different supply for the processor and the bias, and as I think I&#39;ve shown above, every reason to share the same supply.</p>
<p>There is the possibility of very small crosstalk between the inputs due to the sample and hold capacitor acting as a charge pump. This can largely be removed by changing the configuration of the inputs.</p>
<p>Without knowing what your circuit arrangement is and your component values are and what your construction method is, and indeed what those numbers your quote are, it&#39;s hard for me to diagnose your problem. However I think what you are reading might be digital noise picked up on the analogue input, either due (as pointed out elsewhere quite recently) to a lack of decoupling on the Arduino circuit boards, or poor layout and grounding in the analogue front end.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11416"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="allanba&#039;s picture" title="allanba&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by allanba (not verified) on Thu, 18/04/2013 - 02:33.</div>
    <div class="content">
     <p>My construction methods are questionable, I don&#39;t have much access to electronic components so I had to make use of what I had in my shed, I used the circuit described in the building blocks section 2 10k resistors and 1 10 uF capacitor, I&#39;ve got all four circuits connected to the same ground and vcc all soldered on a perfboard, the sensors are connected through 3.5 mm females plugs for great parts of the connections I had to use wires which are not hanging but soldered to the perfboard . Do note that the circuit is about 1.5 meters away from a 2&nbsp; power inverters rated for 4 kW if it matters. What do you mean by changing the configuration of the pins?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11425"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 18/04/2013 - 11:28.</div>
    <div class="content">
     <p>I&#39;m trying to understand what you&#39;ve got but you&#39;re not giving me the information I need.</p>
<p><em>building blocks section 2</em><br />
	Sorry, I don&#39;t recognise that, Building Blocks sections aren&#39;t numbered. Give me the full title or the URL.</p>
<p>Which current transformer do you have (ratio?) and what value of burden resistor?</p>
<p>What do the numbers that you quoted mean? Are they power (if so what voltage do you have?), are they current? What are the units? Are they the output from a published sketch, if so which? (URL again)<em>. </em>What calibration factors have you used?</p>
<p>Without all that, all I can tell you is that with the emonTx pcb (see &quot;Modules&quot; for photos), we routinely see an output of a few watts on a 240 V supply, which is due to digital noise transferred into the analogue to digital converter and rectified by the software. Anecdotally, we&#39;ve tended to see more reports of higher values with the sort of construction that you are using. Remember that 1 count at the ADC represents a voltage change of roughly 5 mV, so you need to make sure there is no induced current or voltage reaching the analogue inputs.</p>
<p>You might also like to look at Atmels&#39;s website and get hold of the application notes that give some information about best practice.</p>
<p>
	&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11428"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="allanba&#039;s picture" title="allanba&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by allanba (not verified) on Thu, 18/04/2013 - 13:16.</div>
    <div class="content">
     <p>I&#39;m sorry for that Robert, I am using voltage output ct sensors, specifically the sct-013-030. I don&#39;t know the ratio nor the burden resistor, for I haven&#39;t torn the sensor apart.</p>
<p>The circuit is the one described in this link:</p>
<p>&nbsp;http://openenergymonitor.org/emon/buildingblocks/how-to-build-an-arduino-energy-monitor</p>
<p>The numbers I quoted stand for current, my construction doesn&#39;t make use of the voltage sensing. I&#39;m using emonlib in order to calculate the current in Amperes, I had to make a few modifications to the library to make it work with an arduino mega 2560.</p>
<p>Regarding the induced current and voltages in the analogue inputs what is the appropriate tool or method to use? Please do note that my knowledge in electronics is for the moment somewhat limited.</p>
<p>I will have a look at atmel website.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11431"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 18/04/2013 - 15:03.</div>
    <div class="content">
     <p>Which sketch are you using?</p>
<p>What are your calibration factors?</p>
<p>What changes did you make to the library?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11432"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="allanba&#039;s picture" title="allanba&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by allanba (not verified) on Thu, 18/04/2013 - 15:25.</div>
    <div class="content">
     <p>&nbsp; delay(2); // Wait for Vref to settle<br />
	&nbsp; ADCSRA |= _BV(ADSC); // Convert<br />
	&nbsp; while (bit_is_set(ADCSRA,ADSC));<br />
	&nbsp; result = ADCL;<br />
	&nbsp; result |= ADCH&lt;&lt;8;<br />
	&nbsp; result = 1126400L / result; // Back-calculate AVcc in mV<br />
	&nbsp; return result;</p>
<p>I&#39;m using the current-only sketch, I modified the library in the EnergyMonitor::readVcc() method, it looked like this:</p>
<p><em>long EnergyMonitor::readVcc() {<br />
	&nbsp; long result;</em></p>
<p><em>&nbsp; #if defined(__AVR_ATmega168__) || defined(__AVR_ATmega328__) || defined (__AVR_ATmega328P__)<br />
	&nbsp; ADMUX = _BV(REFS0) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1);&nbsp;<br />
	&nbsp; #elif defined(__AVR_ATmega32U4__) || defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__)<br />
	&nbsp; ADMUX = _BV(REFS0) | _BV(MUX4) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1);<br />
	&nbsp; #elif defined (__AVR_ATtiny24__) || defined(__AVR_ATtiny44__) || defined(__AVR_ATtiny84__)<br />
	&nbsp; ADMUX = _BV(MUX5) | _BV(MUX0);<br />
	&nbsp; #elif defined (__AVR_ATtiny25__) || defined(__AVR_ATtiny45__) || defined(__AVR_ATtiny85__)<br />
	&nbsp; ADMUX = _BV(MUX3) | _BV(MUX2);<br />
	&nbsp; #endif</em></p>
<p><em>&nbsp; delay(2);&nbsp;&nbsp;&nbsp;&nbsp; // Wait for Vref to settle&nbsp;<br />
	&nbsp; ADCSRA |= _BV(ADSC);&nbsp;&nbsp;&nbsp; // Convert<br />
	&nbsp; while (bit_is_set(ADCSRA,ADSC));<br />
	&nbsp; result = ADCL;<br />
	&nbsp; result |= ADCH&lt;&lt;8;<br />
	&nbsp; result = 1126400L / result;&nbsp;&nbsp; //1100mV*1024 ADC steps <a href="http://openenergymonitor.org/emon/node/1186" title="http://openenergymonitor.org/emon/node/1186">http://openenergymonitor.org/emon/node/1186</a><br />
	&nbsp; return result;<br />
	}</em></p>
<p>&nbsp;</p>
<p><em>now it looks like this:</em></p>
<p>long EnergyMonitor::readVcc()<br />
	{<br />
	&nbsp; long result;<br />
	&nbsp; // Read 1.1V reference against AVcc<em>&nbsp; </em></p>
<p><em>&nbsp; #if defined(__AVR_ATmega168__) || defined(__AVR_ATmega328__) || defined (__AVR_ATmega328P__)<br />
	&nbsp; ADMUX = _BV(REFS0) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1);&nbsp;<br />
	&nbsp; #elif defined(__AVR_ATmega32U4__) || defined(__AVR_ATmega1280__) || defined(__AVR_ATmega2560__)<br />
	&nbsp;&nbsp;</em>ADMUX = _BV(REFS0) | _BV(MUX4) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1);<br />
	&nbsp; ADCSRB &amp;= ~_BV(MUX5);<em> // Without this the function always returns -1<br />
	&nbsp; #elif defined (__AVR_ATtiny24__) || defined(__AVR_ATtiny44__) || defined(__AVR_ATtiny84__)<br />
	&nbsp; ADMUX = _BV(MUX5) | _BV(MUX0);<br />
	&nbsp; #elif defined (__AVR_ATtiny25__) || defined(__AVR_ATtiny45__) || defined(__AVR_ATtiny85__)<br />
	&nbsp; ADMUX = _BV(MUX3) | _BV(MUX2);<br />
	&nbsp; #endif</em><br />
	&nbsp; delay(2); // Wait for Vref to settle<br />
	&nbsp; ADCSRA |= _BV(ADSC); // Convert<br />
	&nbsp; while (bit_is_set(ADCSRA,ADSC));<br />
	&nbsp; result = ADCL;<br />
	&nbsp; result |= ADCH&lt;&lt;8;<br />
	&nbsp; result = 1126400L / result; // Back-calculate AVcc in mV<br />
	&nbsp; return result;<br />
	}</p>
<p><em>The calibration factors are 30.0.</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11446"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3016" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3016" title="View user profile.">dBC</a> on Thu, 18/04/2013 - 21:33.</div>
    <div class="content">
     <p><em>There is the possibility of very small crosstalk between the inputs due to the sample and hold capacitor acting as a charge pump. This can largely be removed by changing the configuration of the inputs.</em></p>
<p>Robert, can you explain this a bit more please? &nbsp;Are you talking about software configuration of AVR inputs or are you talking about &nbsp;hardware configuration, like reducing the source impedance?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11450"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 19/04/2013 - 00:50.</div>
    <div class="content">
     <p>The current-only sketch as published prints &quot;estimated&quot; power - the measured current multiplied by the presumed voltage of 240 V. If you have not changed that, then the numbers are actually quite good for the degree of noise and pick-up we usually see. If you have changed it and you are printing current ( Serial.print(ct1.Irms); etc) then you appear to have a huge input coming from somewhere. With an emonTx - where the input circuitry is on the same pcb - I expect to see about 40 VA or 30 - 50 mA of pick-up on any input (with a burden resistor present but no c.t. connected) and your calibration values.</p>
<p>Obvious question maybe: Is the &quot;battery&quot; voltage correct since you changed the library? - it should be close to 5000 for a 5 V supply.</p>
<p>I&#39;m assuming those readings persist, you have waited 30 s or so for the digital filters to settle?</p>
<p>Are the 2.3 - 2.5 A numbers with a c.t. connected, or without? Can you disconnect the c.t. and put a short circuit in its place, what do you read then?</p>
<p>&nbsp;</p>
<p>When I said &quot;charge pump&quot;, to understand it you must draw a voltage input and a current input, and the multiplexer switch inside the ADC and the sample and hold capacitor also inside the ADC. When you do that, you can see that each time the multiplexer switches, it transfers the charge left behind on the S&amp;H capacitor onto the 10 uF decoupling capacitor belonging to the input it has just switched to. The result is - in theory at least - you get a very small version of the voltage wave transferred to the current input. The reverse ought to happen too, but the current input voltage is usually a lot smaller than the voltage input voltage so it is swamped. The effect should be reduced if the input circuitry is rearranged so that one side of the sensor (voltage or current) is directly grounded, then the 10 uF is used like the input of an audio amplifier to couple the alternating voltage into the ADC input, which is biased to half supply voltage by the resistor pair. That&#39;s because the charge leaks to ground via the c.t. and the burden in parallel = 50 R approx, rather than through the two 470 K bias resistors in parallel, and is gone in well under a microsecond.</p>
<p><a href="http://openenergymonitor.org/emon/node/1385#comment-7525 " title="http://openenergymonitor.org/emon/node/1385#comment-7525 ">http://openenergymonitor.org/emon/node/1385#comment-7525 </a> onwards.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11451"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3016" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3016" title="View user profile.">dBC</a> on Fri, 19/04/2013 - 01:23.</div>
    <div class="content">
     <p>Very detailed thanks. &nbsp;I&#39;d noticed similar crosstalk&nbsp;on my two analog tank inputs and cured it by introducing op-amps to lower the source impedance (similar to&nbsp;calypso_rae&#39;s solution).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11460"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/10" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/10" title="View user profile.">glyn.hudson</a> on Fri, 19/04/2013 - 07:50.</div>
    <div class="content">
     <p>I have updated emonLib with the fix for the ATmega2560. Please could you test that it works.&nbsp;</p>
<p><a href="https://github.com/openenergymonitor/EmonLib/blob/master/EmonLib.cpp">https://github.com/openenergymonitor/EmonLib/blob/master/EmonLib.cpp</a></p>
<p>Thanks a lot for the fix. Keep up the good work!&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11474"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 19/04/2013 - 16:45.</div>
    <div class="content">
     <p>dBC,</p>
<p>I think you cured it not because you lowered the impedance, but because you shifted the midpoint just enough to move it away from the boundary between two ADC steps. As the simulated peak-peak amplitude is much less than 1 ADC step, you will expect to see the effect only if it causes transitions across the step boundary.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11475"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="allanba&#039;s picture" title="allanba&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by allanba (not verified) on Fri, 19/04/2013 - 16:59.</div>
    <div class="content">
     <p>Thank you @Robert Wall,you&#39;ve been of great help. I will do some testing and come back with the results. @glyn.hudson I will test the current version and let you know how it went</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11479"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3016" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Shared bias circuit</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3016" title="View user profile.">dBC</a> on Fri, 19/04/2013 - 21:32.</div>
    <div class="content">
     <p><em>I think you cured it not because you lowered the impedance, but because you shifted the midpoint just enough to move it away from the boundary between two ADC steps. As the simulated peak-peak amplitude</em></p>
<p>Actually my AVR ADC only measures very slow moving DC inputs (rainwater tank levels). &nbsp;If the two tank levels were different enough (which they can be) then one would impact the other via the exact crosstalk method you described in your pointer above. &nbsp;By driving those two A/D inputs with an op-amp (to lower the source impedance) those AVR internal capacitors charge/discharge much faster, so the results stabilise much sooner.</p>
<p>I think I referenced the wrong Robin above. &nbsp;It was the other Robin who put &nbsp;op-amps on his A/D inputs like I have (in your detailed analysis thread referenced above).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/2253"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-fdvIngIJEfm95RnFTMEnE6DBUMp_IAth-ki29DQD6EU" value="form-fdvIngIJEfm95RnFTMEnE6DBUMp_IAth-ki29DQD6EU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
