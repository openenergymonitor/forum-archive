<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Is 2.5V correct for Vref? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/3">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Is 2.5V correct for Vref?</h3>
        <span class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 30/06/2012 - 15:03</span>
        <div class="content"><p>Although my Mk1 PV control system generates hot water when the sun shines, I'm not convinced that it's using the correct value for Vref.&nbsp;</p>
<p>I have two Arduino Uno boards, both R3.&nbsp; According to the H/W reference page, the ref. voltage for analogue inputs is configurable.&nbsp; The default setting appears to be either 5V or 3.3V but it is not clear to me which value applies to the version that I have.&nbsp; The R3 has both 3.3V and 5V rails.</p>
<p>If the default upper limit of the ADC range were to be 3.3V rather than 5V, then there would be just 0.8V of headroom above the standard ref level of +2.5V.&nbsp; Because my system is only measuring small amounts of power at the supply point while suplus PV energy is being dumped, I'm fairly confident that my 'current' waveform won't be clipping&nbsp; But for any boards with a 3.3V ADC range, users would be well advised to modify their Voltage and Current sensor circuits accordingly, or configure their board for 5V operation.</p>
<p>If anyone has a suitable sketch which could be run on an installed Arduino to record and display raw ADC values, I would be most pleased to hear from them ;)</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/1082" class="topic-previous" title="Go to previous forum topic">‹ Another solar immersion controller *sigh*</a>
              <a href="/emon/node/1059" class="topic-next" title="Go to next forum topic">Solar Power Divert with no voltage readings ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-5072"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Is 2.5V correct for Vref?</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 01/07/2012 - 15:19.</div>
    <div class="content">
     <p><a href="http://openenergymonitor.org/emon/user/924">Robert Wall</a> has kindly supplied me with a 1-line sketch (!) which measures and displays raw samples.&nbsp; The same sketch is attached in slightly expanded form.&nbsp; For ease of use, it now displays the min and max values that have been taken since startup.&nbsp; To start a new run, just press the Arduino's reset button. &nbsp;</p>
<p>The results on my existing rig in the garage have been most revealing.&nbsp; The good news (for me) is that my V &amp; I data are both centred nicely within the ADC's range, so the 2.5 Vref level must be correct for my R3 board.&nbsp; With the C/T hanging free, the background current value is a steady 511.&nbsp; My voltage values also look fine, with a peak-to-peak range of around 480 steps.</p>
<p>But my readings for current are woefully low.&nbsp; The current drawn by a 3kW kettle covers just 105 steps of the ADC's 1024-step range.&nbsp; That's over 100 Amps for full scale coverage.&nbsp; My system is intended to maintain a small export level of around 50W.&nbsp; With my existing hardware, that 'current' signal covers less than 2 steps of the ADC's 1024-step range&nbsp; :(</p>
<p>By playing around with burden resistors while the attached test sketch is running, I hope to be able to increase the size of the input signal somewhat.&nbsp; It would be really helpful to know what other people's readings for AC current are like.&nbsp; Any chance of posting some values?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5076"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Is 2.5V correct for Vref?</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 01/07/2012 - 18:40.</div>
    <div class="content">
     <p>Here is the original one-line sketch:</p>
<blockquote><p>void setup(void) {Serial.begin(9600);} void         loop(void) {Serial.println(analogRead(2));delay(100);}</p>
</blockquote>
<p><img alt="" src="http://openenergymonitor.org/emon/sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/regular_smile.gif" /></p>
<p>I wrote &quot;<font face="Helvetica, Arial, sans-serif">Just write a one-line sketch...</font>&quot; more as a figure of speech than anything else, meaning a very simple sketch that would extract just that one piece of information, then I realised that it might literally be possible to do it in one line. And the rest, as they say, is history.
</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5093"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Is 2.5V correct for Vref?</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 02/07/2012 - 21:09.</div>
    <div class="content">
     <p>Neat, but the numbers whizz round far too fast for my liking !!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5097"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Is 2.5V correct for Vref?</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 02/07/2012 - 22:15.</div>
    <div class="content">
     <p>Change the numbers (the &quot;100&quot;) then!&nbsp; And you can change the port number (&quot;2&quot;) too - depending on which one you want to measure.</p>
<p>It wasn't intended as a textbook reference piece of software, you know. (And if I'd added that information as comments, it would have broken the 'one-line' part of the spec.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6335"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="andyjc&#039;s picture" title="andyjc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Is 2.5V correct for Vref?</h3>

    <div class="submitted">Submitted by andyjc (not verified) on Tue, 25/09/2012 - 09:53.</div>
    <div class="content">
     <p>Robin,</p>
<p>Have just finished the soldering phase of building your Mk2 design, and thought I&#39;d use the above sketch to do some initial checking.&nbsp; Like yourself, I&#39;m also finding that the current signal is very low compared to the voltage input.</p>
<p>I have the YHDC SCT-013-030 CT which has a built-in 39&Omega; burden.&nbsp; This clearly deviates from the 150&Omega; in your circuit diagram, and I was wondering if this is what you arrived at after the &#39;playing around&#39; you mention above?</p>
<p>Many thanks for posting your design, BTW.&nbsp; It&#39;s an incredibly neat solution and provides a very enjoyable project!</p>
<p>Andy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6337"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Is 2.5V correct for Vref?</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 25/09/2012 - 10:46.</div>
    <div class="content">
     <p>Hi Andy,</p>
<p>With the standard YHDC CT, the internal 39R burden will give you around a 1V ptp signal with a 3kW load.&nbsp; That&#39;s just 20% of the ADC&#39;s input range.&nbsp; When just a few tens of Watts are flowing, your signal will only span a couple of the ADC&#39;s 1024 levels.&nbsp; Increasing the burden to 150R allows the ADC&#39;s range to be more fully used, but the phase-shift is then significantly increased at high currents because the CT doesn&#39;t like being forced to produce this higher level of output.&nbsp; Nothing will be damaged, but the linearity of your system will be likely be adversely affected.&nbsp; Because this system serves to keep import and export in a state of precise balance, linearity is everything for this project.</p>
<p>Personally, I think the best approach is to use the INTERNAL(1.1V) mode for analogReference.&nbsp; Having said which, my original version (with the 150R burden) has been happily working away for some months now with plenty of hot water to its credit.&nbsp; It&#39;s not doing much today though :(</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6346"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="andyjc&#039;s picture" title="andyjc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Is 2.5V correct for Vref?</h3>

    <div class="submitted">Submitted by andyjc (not verified) on Tue, 25/09/2012 - 15:55.</div>
    <div class="content">
     <p>Thanks for your reply.&nbsp; I agree that using the analogReference(INTERNAL) sounds the better way forward, and it has the bonus of not needing to butcher the CT.&nbsp; I assume you fed the 3.3v rail to a separate vRef circuit, with a 2nd op-amp and voltage divider?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6355"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Is 2.5V correct for Vref?</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 25/09/2012 - 19:50.</div>
    <div class="content">
     <p>Good point, it&#39;s probably best not to dismantle the CT unless you really need to.&nbsp; The standard of the internal assembly is not the best I&#39;ve ever seen.</p>
<p>You still only need one reference voltage but it needs to be 0.55V rather than 2.5V.&nbsp; That can be created from either of the Arduino&#39;s output rails.&nbsp; 0.55V is one sixth of 3.3V, so a pair of resistors in the ratio of 1:5 does the job nicely.&nbsp; Because I only have E12 resistors, I used a 10K and two 100Ks in parallel.</p>
<p>If using my Mk2 sketch, it&#39;s important that only one (shared) reference is used.&nbsp; That&#39;s because the dc-offset is only evaluated once and then subtracted from both sets of raw samples.</p>
<p>When the 1.1V reference is used, the component values for the voltage sensor will need to change.&nbsp; Aim to use most of the ADC&#39;s range when measuring 240V AC and 3kW&#39;s worth of current (or whatever your dump load is rated at).&nbsp; Either of the tools near the top of this thread should help with this setup.</p>
<p>From the Arduino&#39;s IDE, an excellent description of the hardware (including the power rails) can be found at Help -&gt; Reference -&gt; Hardware</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/789"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-E4iGUuA09N3zU6Eq4DnM5LxaWAp7CN69WSMNWsogyn4" value="form-E4iGUuA09N3zU6Eq4DnM5LxaWAp7CN69WSMNWsogyn4"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>

</html>
