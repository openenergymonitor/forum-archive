<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5725 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:24:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>remove sleep from sketch... | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">remove sleep from sketch...</h3>
        <span class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 09/09/2014 - 09:05</span>
        <div class="content"><p>So cleaning up my sketch before i insert the magic part provided by Robert....&nbsp;</p>
<p>&nbsp;</p>
<p>As i will power from a wall supply i don want to use sleep modes...</p>
<p>&nbsp;</p>
<p>first line i see in the examples are:</p>
<p>&nbsp;</p>
<p>rf12_sleep(RF12_SLEEP);</p>
<p>&nbsp;</p>
<p>if i just remove that one it would no go to sleep right?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3748.html" class="topic-previous" title="Go to previous forum topic">‹ Released: Windows Phone 8+ Energy Monitor App Source Code</a>
              <a href="5739.html" class="topic-next" title="Go to next forum topic">Data poller for monitoring power use via D-Link DSP-W215 &quot;Smart&quot; plugs ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-23675"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: remove sleep from sketch...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 09/09/2014 - 13:16.</div>
    <div class="content">
     <p>Why not? It only sleeps the transmitter - not the main processor. From RFu_RF12.cpp:</p>
<p>&quot;This function can put the radio module to sleep and wake it up again. In sleep mode, the radio will draw only one or two microamps of current.&quot;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23680"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: remove sleep from sketch...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 09/09/2014 - 15:48.</div>
    <div class="content">
     <p>it was more that i will power it from wall brick and dont worrie&nbsp;so much about the consumption...</p>
<p>and the board that monitors my electricity meter will send every 5 sec or so....</p>
<p>&nbsp;</p>
<p>but i guess it will not hurt either, and i guess its the same no matter what radio module you use...&nbsp;</p>
<p>&nbsp;</p>
<p>last thing with this sketch.... i have a single line left</p>
<p>&nbsp;</p>
<p>digitalWrite(PIN_LED, digitalRead(PIN_KAMSER_RX));</p>
<p>&nbsp;</p>
<p>i need to remove the first part.... is the logic that this line could be converted to 2:</p>
<p>&nbsp;</p>
<p>digitalWrite(PIN_LED)</p>
<p>digitalRead(PIN_KAMSER_RX);</p>
<p>&nbsp;</p>
<p>?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23681"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: remove sleep from sketch...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 09/09/2014 - 16:06.</div>
    <div class="content">
     <p>No, that will not work as the original does.</p>
<p>In C, something like &quot;digitalRead(PIN_KAMSER_RX)&quot; is a function that returns a value - as it is a digital pin, it will be either LOW or HIGH. I presume this is a boolean but incredibly (and very stupidly) the Arduino documentation fails to specify the return value type. You can use that value in whatever way you like. Some possibilities:</p>
<p class="rteindent1">bool Kamser_Receive = digitalRead(PIN_KAMSER_RX);</p>
<p class="rteindent1">Serial.print(&quot;Kamser sent &quot;); Serial.print(digitalRead(PIN_KAMSER_RX));</p>
<p>What the original statement does is use that LOW or HIGH it got from the digitalRead function to set the LED on or off, so to split it into two you have to do:</p>
<p class="rteindent1">bool Kamser_Receive = digitalRead(PIN_KAMSER_RX);<br />
	digitalWrite(PIN_LED, Kamser_Receive);</p>
<p>The original did not use Kamser_Receive but put the value straight into digitalWrite( ).</p>
<p>&quot;digitalWrite(PIN_LED)&quot; is not legal as it requires two parameters, the first to tell it which pin and the second to set its state: HIGH or LOW.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23683"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: remove sleep from sketch...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 09/09/2014 - 18:10.</div>
    <div class="content">
     <p>ohhh</p>
<p>&nbsp;</p>
<p>did not see that, so i will just have to use the same name for the LED as emontx sketch&#39;s does... so there will be constant light when it gets data from heat meter and a flash when it transmit over rf</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23685"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: remove sleep from sketch...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 09/09/2014 - 19:17.</div>
    <div class="content">
     <p>???&nbsp; I can&#39;t see that necessarily working either. What does the LED do as per the original Kamser software, and what do you want the LED to do?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23697"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: remove sleep from sketch...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 10/09/2014 - 10:06.</div>
    <div class="content">
     <p>the led should show when there was data incoming....&nbsp;</p>
<p>now i&#39;m not using an arduino but EmonTX.... so i want the single LED on EmonTX both light up on incoming data and flash when it transmits over RF</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23704"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: remove sleep from sketch...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 10/09/2014 - 12:58.</div>
    <div class="content">
     <p>It looks to me as if the LED is permanently on while data is available, and goes off when the receive data fails. In that case, I suspect turning the LED on and off when transmitting will have the effect of turning the LED off after data has been transmitted, it will then flash until the receive data succeeds again. [Remember, I have not studied your sketch in detail so I am guessing a lot of this.]</p>
<p>What I think you need to do is, at the start of the radio transmission, read the state of the LED, reverse it and set the LED to the new state, and do the same at the end of the radio transmission.</p>
<p>That way, if it is not getting data from the heat meter, the LED will flash briefly on, if it is getting data from the heat meter, the LED will flash briefly off.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23708"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: remove sleep from sketch...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 10/09/2014 - 15:12.</div>
    <div class="content">
     <p>yes, my fault, LED in kamstrup&nbsp;bit is on when there is data....&nbsp;</p>
<p>and if not much mistaken led in emontx examples only flash when transmitting right?</p>
<p>&nbsp;</p>
<p>but i guess you are right.... or just bite the dust and add a LED for the heat meter.... will thinker with that thought</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5725"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-tSC_2ThYoi8mCx3fK9ODMTaT40lWFo21FDXljFGpxIc" value="form-tSC_2ThYoi8mCx3fK9ODMTaT40lWFo21FDXljFGpxIc"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
