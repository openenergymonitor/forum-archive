<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6217 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:39:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>
        <span class="submitted">Submitted by <a href="../user/7307.html" title="View user profile.">Kishan</a> on Tue, 02/12/2014 - 02:50</span>
        <div class="content"><p>I am trying to do real....etc&nbsp;measurement using &nbsp;Allegro ACS712 module and the Voltage divider circuit explained in this amazing site.Load(40W bulb). The method i tried is, i&nbsp;want to combine ACS712 module and voltage divider circuit for energy measurement.</p>
<p>First i would like to show the reading i got:</p>
<p>-46.71 177.35 229.85 0.77 -0.26&nbsp;<br />
-33.13 177.02 229.93 0.77 -0.19&nbsp;<br />
-47.28 178.45 230.92 0.77 -0.26&nbsp;<br />
-33.82 177.99 229.93 0.77 -0.19&nbsp;<br />
-46.39 178.86 230.97 0.77 -0.26&nbsp;<br />
-33.42 177.61 229.08 0.78 -0.19&nbsp;<br />
-47.08 179.09 230.91 0.78 -0.26&nbsp;<br />
-33.11 177.09 229.18 0.77 -0.19&nbsp;<br />
-46.08 177.46 229.98 0.77 -0.26&nbsp;&nbsp;</p>
<p>Second: &nbsp;The voltage readings are correct(i checked with a multimeter) but the real power became negative and so as a result the powerfactor. not only these but current is also wrong as &quot;I&quot; should have been =(40/230)=0.17Amps.</p>
<p>Code for ACS712(fully functional in hardware tested) and also the emonTX code(which i changed alittle&nbsp;bit because i wanted to try ACS712 module :) ) are attached below.</p>
<p>Please help me...I want to learn !!!<br />
(i have 20Amp&nbsp;model) thats&nbsp;100mV/Amp.(ACS712)</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6240.html" class="topic-previous" title="Go to previous forum topic">‹ RF Antenna Tuning Help</a>
              <a href="6220.html" class="topic-next" title="Go to next forum topic">emonglcd screen issuse ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-25499"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 02/12/2014 - 04:48.</div>
    <div class="content">
     <p>I suspect the power is negative because you&#39;ve got it facing the wrong way, just flip it the other way relative to the wire you&#39;re monitoring, and it should swing positive. &nbsp; &nbsp;That wouldn&#39;t show up in your ACS712 sketch, because it&#39;s doing an RMS, so you&#39;ll get a positive result regardless of which way it&#39;s facing, and without a voltage signal to reference to, it&#39;s impossible to say which way the current is flowing.</p>
<p>I&#39;m not an EmonLib guru, but I&#39;m not&nbsp;sure you need the changes you&#39;ve made to it. &nbsp;Before your changes, that code used&nbsp;a digital high pass filter (see step B) to remove the DC offset, which I&#39;d imagine is&nbsp;a better approach than subtracting a hardcoded&nbsp;512. &nbsp;You&#39;ll need to calibrate the reading. &nbsp;The calibration constant is the second argument you pass to current(). &nbsp; There are instructions in the Building Blocks section on how to calibrate.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25514"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7307.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7307.jpg" alt="Kishan&#039;s picture" title="Kishan&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>

    <div class="submitted">Submitted by <a href="../user/7307.html" title="View user profile.">Kishan</a> on Tue, 02/12/2014 - 20:49.</div>
    <div class="content">
     <p>Cheers!!! After changing the hardcoded&nbsp;sampleI= 512-analogRead(Ipin) instead of analogRead(Ipin)-512 which you suggested(current direction sense for hall effect XD)<br />
The Readings are as below:</p>
<p>45.77 47.65 245.16 0.19 0.96&nbsp;<br />
45.86 48.10 245.15 0.20 0.95&nbsp;<br />
46.33 48.25 246.23 0.20 0.96&nbsp;<br />
45.06 47.33 245.27 0.19 0.95&nbsp;<br />
46.47 48.17 246.18 0.20 0.96&nbsp;<br />
45.88 47.92 245.05 0.20 0.96&nbsp;<br />
46.01 48.00 245.04 0.20 0.96&nbsp;<br />
45.82 48.06 245.16 0.20 0.95&nbsp;<br />
&nbsp;</p>
<p>NOTE: Above readings are stable closer to accurate but I am using a 40W bulb and my main Vrms=247V(code justified Vrms) and then Irms=(40/245)=0.16 (I guess, my current measurement didn&#39;t have enough samples because if my Irms=0.16 occured then my Pvi=245*0.16=39.2W(40W),Can you suggest about how to deal with this current issue for accuracy please!!).as a result&nbsp;my&nbsp;Preal is not equal to 40W and also my phasecal has to be changed(i&#39;ll takecare of it to make Preal=Pvi).</p>
<p>Thanks !!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25518"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 02/12/2014 - 22:12.</div>
    <div class="content">
     <p><em>After changing the hardcoded sampleI= 512-analogRead(Ipin) instead of analogRead(Ipin)-512 which you suggested</em></p>
<p>I&#39;m not sure I want to be credited with that suggestion. &nbsp;I suggested you lose the 512, and use the high-pass filter that you commented out. &nbsp;Those using a CT have the exact same problem as you do:&nbsp;&nbsp;the signal swings around a mid-point, and that mid-point needs to be removed from the input. &nbsp;They&#39;ve solved that with a more sophisticated solution than subtracting 512. &nbsp;Is there any reason you don&#39;t want to use the existing solution? &nbsp;You seem happy to use it for the voltage signal, but not for the current signal. &nbsp; Having said that, yes, flipping the sign of the current reading has the exact same effect as flipping the sensor 180&deg;, &nbsp;and depending on your physical installation, may well be easier.</p>
<p><em>Can you suggest about how to deal with this current issue for accuracy please</em></p>
<p>Yep, just follow the steps here: &nbsp;http://openenergymonitor.org/emon/buildingblocks/calibration</p>
<p>P.S. &nbsp;You might want to verify that your 40W bulb is exactly 40W before you calibrate to it. &nbsp;Bulbs vary a lot.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25526"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 02/12/2014 - 23:28.</div>
    <div class="content">
     <p>And I suggest using a resistive load much larger - one that draws a current that is about 50% - 75% of the maximum current of your CT, if that is possible - for calibration.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25576"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7307.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7307.jpg" alt="Kishan&#039;s picture" title="Kishan&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>

    <div class="submitted">Submitted by <a href="../user/7307.html" title="View user profile.">Kishan</a> on Wed, 03/12/2014 - 20:40.</div>
    <div class="content">
     <blockquote><p>&nbsp;You seem happy to use it for the voltage signal, but not for the current signal</p>
</blockquote>
<p>yes, because i happen to have ACS712 module ready with me and more over the &quot;main reason&quot; is the CT has a jack at its end and unfortunately all my controllers doesn&#39;t have any means for jack pin to be connected. i can&#39;t buy a controller just because i need it to be connected for CT. <strong>Please suggest if you have any ideas regarding this</strong>(with some reference links to learn from).<br />
&nbsp;</p>
<blockquote><p>Can you suggest about how to deal with this current issue for accuracy please</p>
<p>Yep, just follow the steps here: &nbsp;http://openenergymonitor.org/emon/buildingblocks/calibration</p>
<p>P.S. &nbsp;You might want to verify that your 40W bulb is exactly 40W before you calibrate to it. &nbsp;Bulbs vary a lot.</p>
</blockquote>
<p>Am working on this, will get back to you with some form of improved&nbsp;results. Thanks alot!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25582"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7307.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7307.jpg" alt="Kishan&#039;s picture" title="Kishan&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>

    <div class="submitted">Submitted by <a href="../user/7307.html" title="View user profile.">Kishan</a> on Wed, 03/12/2014 - 23:30.</div>
    <div class="content">
     <p>@Robert</p>
<p>I tried the calibration and was&nbsp;only able to achieve a maximum of&nbsp;0.96(powerfactor) on same 40Wbulb( sorry am away from college, can&#39;t get&nbsp;bigger loads any time soon). Can you tell from your experience, is it possible to achieve a powerfactor of 0.99 by changing phaseCal?? As far as my search&nbsp;goes, i found a powerfactor of 0.97 achieved from posts.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25583"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7307.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7307.jpg" alt="Kishan&#039;s picture" title="Kishan&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>

    <div class="submitted">Submitted by <a href="../user/7307.html" title="View user profile.">Kishan</a> on Wed, 03/12/2014 - 23:31.</div>
    <div class="content">
     <p>@dBc</p>
<p>Cheers!! after testing, i found out that both Vrms as well Irms(which i am worried about) are both correct!! and hence Pvi also should be correct. and powerfactor i am able to achieve around 0.96(but not 0.99 for some reason) and hence all readings are fine and ACS712&nbsp;does its magic properly.<br />
Do you know whether it is possible to achieve 0.99 powerfactor?(i mean is it supposed to be that accurate?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25585"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Real power is coming negative on a 40W bulb(load)  when tried with Allegro ACS712 module and Voltage divider circuit</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 04/12/2014 - 00:40.</div>
    <div class="content">
     <p>I have seen a pf of > 1.0 (but that was before an error in the sketch was corrected!). You can get a pf of 1.0, and I have sometimes changed the print statement to give more significant figures so that I can see whether it is exactly 1.0. (More often, it has been 0.996 or something like that.) But I do not think you will see a better power factor with a load that small, as errors in the CT will be significant. </p>
<p>But you can always make your ct think you have a larger load, by having a multi-turn primary winding. Normally, the primary winding is a single turn (a straight wire) but by having many turns, you multiply the current (and so the apparent size of your lamp load) by the number of turns. For example, to test the 100 A CT at 250 A, I used a 50-turn primary carrying 5 A. But you must be very careful of temperature rise if you try that, because 50 bunched conductors carrying 5 A will get very hot very quickly.</p>
<p><i>" You seem happy to use it for the voltage signal, but not for the current signal</i></p>
<p>If you do not use the high pass filter, any difference between the true average value of the input and the number you subtract (512?) will affect the accuracy of the power calculation and the rms calculations. What you use for the input transducer does not change that. Remember that the HP filter can remove less than 1 count of offset, as it works on floating point values.</p>
<p><i>yes, because i happen to have ACS712 module ready with me and more over the "main reason" is the CT has a jack at its end and unfortunately all my controllers doesn't have any means for jack pin to be connected. i can't buy a controller just because i need it to be connected for CT. Please suggest if you have any ideas regarding this(with some reference links to learn from)."</i></p>
<p>If you want to use a CT with an audio jack with a controller (what sort?) that has a different connector, you unsolder or cut off the jack plug. In the case of the YHDC range of CTs, connect only the red and white wires from the CT to the input of your controller.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6217"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-EOyTK6IJlm3drp5_xPf9DLgP4s_RG8aGScJlryAIFjU" value="form-EOyTK6IJlm3drp5_xPf9DLgP4s_RG8aGScJlryAIFjU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
