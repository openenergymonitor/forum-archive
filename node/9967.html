<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Spurious RF sent to emoncms | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/5">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Spurious RF sent to emoncms</h3>
        <span class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Wed, 07/01/2015 - 22:05</span>
        <div class="content"><p>I&#39;ve finally got around to setting up a system in my new home using emonhub. Nice work! However I have a lot of spurious rf being sent to emoncms as nodes. Is it possible to restrict nodes to just the IDs I have defined in the config file?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/10010" class="topic-previous" title="Go to previous forum topic">‹ Emoncms midnight</a>
              <a href="/emon/node/6374" class="topic-next" title="Go to next forum topic">install EmonCMS on Synology ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26539"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Wed, 07/01/2015 - 22:06.</div>
    <div class="content">
     <p>Can you show some logs and tells us a bit about your setup, for example&nbsp;are you using an rfm2pi?&nbsp;</p>
<p>emonHub isn&#39;t really geared up to filter by node id and whilst you maybe able to achieve this another way eg reduce the node id limit in emoncms&nbsp;(if it&#39;s a local install) it isn&#39;t ideal. if you are getting random nodes then the chances are you are also getting random packets with node ids that match your active nodes and these could fudge your data,. there is an extra &quot;length of packet&quot; check if you use&nbsp;all full&nbsp;&quot;datacodes&quot; strings for each active node but if a random packet of data, the expected size turns up it will get processed as good data.</p>
<p>Do you know the source?</p>
<p>Paul</p>
<p>PS maybe a moderator would be so good as to&nbsp;move this over to a new thread to save going off-topic here, since this is the closest we have to datacodes documentation :-)</p>
<p><em>Edit -&nbsp;done,&nbsp;Paul (moderator)</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26557"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Thu, 08/01/2015 - 12:01.</div>
    <div class="content">
     <p>It's an rfm2piv2 on a custom readonly Debian wheezy install.<br />
I currently only have one valid node 10 which is an emontx module. This is specified in the emonhub.conf with full datacodes definition for that node.<br />
I do have a system of eq3 max heating devices (around 18 in total) which communicate over 868mhz and are received by a CUL device from busware.de so I suspect this is the cause of all the extra RF traffic. </p>
<p>I will provide some logs this evening when home.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26619"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Fri, 09/01/2015 - 23:05.</div>
    <div class="content">
     <p>Here&#39;s a log of the last couple of hours. &nbsp;As you can see there&#39;s a lot of RF transmissions so I definitely need a way to filter the ones I want.</p>
<p>[Duplicate post deleted. Moderator (RW)]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26627"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Sat, 10/01/2015 - 00:25.</div>
    <div class="content">
     <p>Hi Matt, The log clearly shows alot of unwanted RF packets, however it&#39;s only showing the packets that emonHub is successfully&nbsp;filtering as the loglevel is &quot;warning&quot;. These are not the packets you need to target.</p>
<p>Can you change the loglevel to &quot;debug&quot; and post again?</p>
<p>What group are you using? have you tried any others?</p>
<p>Group 0 is &quot;open to all groups&quot; and should be avoided</p>
<p>How close is the emonTx to the RFM2Pi ? If they are pretty&nbsp;close you may get an improvement by running your 868 rfm12&#39;s&nbsp;on 433MHz at a very reduced range but a different freq to the traffic. I haven&#39;t tried this but I&#39;m inclined to think its feasible.</p>
<p>If they are&nbsp;very close is a wired solution possible?</p>
<p>We can definitely&nbsp;add a &quot;node 10 only&quot; filter if there&#39;s no other way but that&#39;s not a perfect solution as corrupt or alien packets starting with &quot;10&quot; can still slip through and this will be a change you make on your install only so will need to be re-implemented after updating emonHub in the future.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26644"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Sat, 10/01/2015 - 19:39.</div>
    <div class="content">
     <p>Log with debug enabled attached. &nbsp;There&#39;s at least one packet that gets sent to emoncms&nbsp;spuriously in that one (node 19).</p>
<p>Group 173 is my home group. &nbsp;But the group id of the spurious RF data is also random so appears in any group.</p>
<p>Not that close, and I&#39;ve also got a couple of other devices (emonglcd,&nbsp;currently off) on the rfm12 network which need to be in different locations. &nbsp;This is a &quot;smarthome&quot; with power/lighting/heating all using a mixture of wireless/wired protocols so the RF spectrum at 433Mhz and 868Mhz is noisy. &nbsp;Forgot to mention 868Mhz also has ZWave traffic as well as the eq3 radiator thermostats so we&#39;re probably seeing that too. &nbsp;There is also weather data being transmitted from the end of my garden.</p>
<p>I appreciate that there is a risk of valid node ids appearing in the random data but I would have thought we could come up with a solution where we check the length against the datacodes which would eliminate nearly all false-positives (note that all observed spurious RF are long datastrings).</p>
<p>I&#39;m not likely to be the only one who will be using the system in a noisy RF environment and would prefer to see a solution that is part of the standard software that can benefit anyone who needs it.</p>
<p>Maybe something like the following:</p>
<p>Under the [nodes] section add a flag: restrictToDefinedNodes = 1 which when set would only treat the defined nodes and associated datacodes as valid. &nbsp;Otherwise it passes everything as before.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26687"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Mon, 12/01/2015 - 11:30.</div>
    <div class="content">
     <p>Hi Matt,</p>
<p>I wasn&#39;t able to look into this over weekend but it was on my mind and I have thought of a couple of possible &quot;enhancements&quot; we could consider, You are right there maybe other users that might&nbsp;make use of&nbsp;additional filtering by node id, However I will need to look into the best way of implementing it. My current thoughts centre around a datacode&nbsp;&quot;X&quot; that can be used as&nbsp;either the interfacers&nbsp;default datacode to signify only &quot;listed&nbsp;nodes&quot; to be processed or as a &quot;unwanted&nbsp;nodes&quot; default datacode in the nodes section to block just that node.</p>
<p>This may offer a more usable solution but may not be instantaneous to implement, if needed we can always&nbsp;temporarily&nbsp;add a &quot;node 10 only&quot; filter&nbsp;<span style="line-height: 20.7999992370605px;">I</span><span style="line-height: 20.7999992370605px;"> will have a look into it as soon as I get a chance.</span></p>
<p>Looking at your latest log I see the very long packet from node 29 has slipped through, Although it wouldn&#39;t eliminate all the unwanted packets in your first log, I do wonder if we should also have a &quot;66 byte&quot; cap to match the rfm&#39;s&nbsp;max payload and&nbsp;discard the obviously incorrect packets on arrival.&nbsp;&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26694"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 12/01/2015 - 14:27.</div>
    <div class="content">
     <p>At the cost of an extra byte, you may also want to consider a simple checksum appended to the message. It wouldn't help with blocking, but if implemented properly it would allow you to know if the message was corrupt or not observing to your protocol. One byte would not give an absolute guarantee of course, but in combination with a length and/or node check it would surely get most errors.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26696"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Mon, 12/01/2015 - 14:47.</div>
    <div class="content">
     <p>I agree, in&nbsp;fact&nbsp;I had actually&nbsp;presumed there was some form of &quot;validation&quot; in the JeeLib&nbsp;hence my initial question asking if Matt was using an RFM2Pi, followed by significant&nbsp;surprise when he said he was. I&#39;m not totally up&nbsp;to speed on what happens &quot;airside&quot; of an rfm device, but can confirm my RFM2Pi&nbsp;handles alot of &quot;noise&quot; internally, if I disable &quot;quiet mode&quot; I see there&#39;s&nbsp;a lot of traffic that doesn&#39;t reach emonHub.​</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26732"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Tue, 13/01/2015 - 00:06.</div>
    <div class="content">
     <p>As an experiment I&#39;ve inserted into emonhub_interfacer.py a check for packetlen &gt; 66:</p>
<pre>
        # Discard if first value is not a valid node id
        n = float(received[0])
        if n % 1 != 0 or n &lt; 0 or n &gt; 31:
            self._log.warning(str(ref) + &quot; Discarded RX frame &#39;node id outside scope&#39; : &quot; + str(received))
            return False

        # Discard if packet len &gt; 66 (max for rfm12)
        if len(received) &gt; 66:
            self._log.warning(str(ref) + &quot; Discarded RX frame &#39;string too long&#39; : &quot; + str(received))
            return False

        # If it passes all the checks return
        return received</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26733"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Tue, 13/01/2015 - 00:13.</div>
    <div class="content">
     <p>Thinking ahead (and I&#39;m aware there&#39;s some work in the experimental branch) we&#39;re going to want to support different types of serial data I think...</p>
<p>So we might want to specify in the config&nbsp;what is a valid packet for each datatype. &nbsp;For example I&#39;m processing a serial datastream from a mk2pvrouter which starts with the text &quot;datalog event&quot;.</p>
<p>For an rfm12pi I guess we&#39;d specify:</p>
<p>datacodes, maxlength.</p>
<p>​Specifying an X for the master datacode sounds like a simple solution for excluding other nodes. &nbsp;Then we just need to add a maxlength parameter which defaults to 66.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26735"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Tue, 13/01/2015 - 00:51.</div>
    <div class="content">
     <p>Unfortunately I still seem to be getting packets through when I&#39;m checking for max length of 66. &nbsp;So think a node filter is required too.</p>
<p>In the mean time, for cleaning up the input list this post is useful:&nbsp;http://openenergymonitor.org/emon/node/3075</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26736"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 13/01/2015 - 01:36.</div>
    <div class="content">
     <p><i>"I had actually presumed there was some form of "validation" in the JeeLib"</i></p>
<p>There's actually almost nothing in JeeLib, because he went for minimal packet size = minimum power. There is a checksum in there, but it won't help you if the 'foreigners' are also using Jeelib. The packet structure is here: <a href="http://jeelabs.org/2011/06/09/rf12-packet-format-and-design/">http://jeelabs.org/2011/06/09/rf12-packet-format-and-design/</a><br />
In fact, in the <a href="http://jeelabs.net/pub/docs/jeelib/RF12_8cpp.html">documentation</a>, there's the comment "If [CRC] != 0 then rf12_hdr, rf12_len, and rf12_data should not be relied upon." and to me that indicates that you should be checking the CRC, it isn't done for you. (It is checked in the GLCD &amp; Nanode <u>sketches</u>.)</p>
<p>Adding your own checksum with a different rule would of course allow you to identify your "own" nodes.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26744"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Tue, 13/01/2015 - 11:22.</div>
    <div class="content">
     <p>Just had a look at JeeLib etc and found the crc does indeed&nbsp;need to be implemented by the application, it also looks like this is done in&nbsp;the JeeLib&nbsp;version of RF12demo.</p>
<p>However the RFM2Pi&nbsp;sketches seem to depend on age and version,&nbsp;</p>
<p>Matt - do you know which version RFM2Pi firmware&nbsp;you are running? and can you try&nbsp;adding &quot;quiet = false&quot; to emonhub.conf&#39;s [[RFM2Pi]] [[[runtimesettings]]]&nbsp;to see if there is were&nbsp;any &quot;bad packets&quot; being discarded?</p>
<p>This <a href="https://github.com/mharizanov/RFM2Pi/commit/d3090b988875dcbed755457a3a768d444bb20286">git commit</a>&nbsp;suggests you where using the&nbsp;<a href="https://github.com/mharizanov/RFM2Pi/blob/master/firmware/Full_RF12demo_atmega328/Full_RF12demo_atmega328.ino">Full_RF12demo_atmega328.ino</a>&nbsp;in Aug 2013, in a <a href="https://github.com/mharizanov/RFM2Pi/commit/c5172fad0cdfcdf4859c84c8e5923e5c03dd1b2b">later commit</a>&nbsp;it looks like there was a &quot;bug fix: packets with bad CRC were not being rejected&quot; in Jan 2014.</p>
<p>So there is a case for the possibility you&#39;re seeing all packets good and bad as crc is not functioning correctly.</p>
<p>Robert - I agree another checksum would add to the certainty, but unless I&#39;m misunderstanding, I think the group is used in the checksum so even if the neighbors are using JeeLib a group change should overcome that, no?&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26746"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Tue, 13/01/2015 - 13:10.</div>
    <div class="content">
     <p>I&#39;ll check this evening and upgrade to the latest recommended firmware.&nbsp; I&#39;m using the version from my github: <a href="https://github.com/mattwire/RFM2Pi/commits/master/firmware/Full_RF12demo_atmega328/Full_RF12demo_atmega328.ino" title="https://github.com/mattwire/RFM2Pi/commits/master/firmware/Full_RF12demo_atmega328/Full_RF12demo_atmega328.ino">https://github.com/mattwire/RFM2Pi/commits/master/firmware/Full_RF12demo...</a> which does ref the Jan 2014 crc fix but I don&#39;t remember if I flashed that version or not.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26747"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 13/01/2015 - 13:19.</div>
    <div class="content">
     <p><i>"Robert - I agree another checksum would add to the certainty, but unless I'm misunderstanding, I think the group is used in the checksum so even if the neighbors are using JeeLib a group change should overcome that, no?"</i></p>
<p>You're probably right there - I was getting tired and not thinking all the way through it! As the checksum at the end of the calculation should be zero, it's probably (without reading the library code!) just a sum (mod 256) of all the bytes in the packet, so everything will be included. It's not a bullet-proof test of course, but the probability that the sum is wrong by exactly 256 has to be quite slim - unless it's all zeros. If you're suggesting that the use of the checksum was missed, then that goes a long way to explaining a lot of the junk that people are seeing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26749"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Tue, 13/01/2015 - 13:59.</div>
    <div class="content">
     <blockquote><p><em>&nbsp;If you&#39;re suggesting that the use of the checksum was missed, then that goes a long way to explaining a lot of the junk that people are seeing.</em></p>
</blockquote>
<p>I&#39;m a little hazy on this myself, but as I understand it the &quot;stock&quot; <a href="https://github.com/mharizanov/RFM2Pi/blob/master/firmware/RF12_Demo_atmega328/RF12_Demo_atmega328.ino#L241">RF12_Demo_atmega328.ino</a>&nbsp;that was/is installed to all shop bought&nbsp;rfm12 RFM2Pi&#39;s&nbsp;will ONLY pass packets&nbsp;that have a zero checksum, despite having a &quot;q&quot; or &quot;quiet&quot; option the quiet boolean&nbsp;variable doesn&#39;t appear to be utilized in the code anywhere. So you can enable/disable &quot;quiet mode&quot; but you will actually only&nbsp;ever get just the packets with a zero checksum.</p>
<p>However the original version of the&nbsp;<a href="https://github.com/mharizanov/RFM2Pi/blob/e7669fed555fb2fc26b113fddbd17a111474071f/firmware/Full_RF12demo_atmega328/Full_RF12demo_atmega328.ino#L744-L753"><strong>Full</strong>_RF12demo_atmega328.ino (I believe) was intended to work the same way</a>, ie pass just good packets with no option to disable &quot;quiet,&nbsp;but the later bugfix suggests the CRC wasn&#39;t previously working and therefore I assume good and bad were passed until the bugfix was applied.</p>
<p>So in theory only the users that <u>installed</u> the &quot;Full&quot; version between june&nbsp;2013 and jan 2014 should be seeing bad packets&nbsp;passed as good.</p>
<p>This also explains why my own&nbsp;rfm12&nbsp;RFM2Pi&nbsp;shows no bad packets when I believe &quot;quite mode&quot; is disabled and yet the rfm69 RFM2Pi is bombarded with bad packets, I thought it was the better receiver&nbsp;picking up signals from far afield but no, apparently it&#39;s just the 12 isn&#39;t able to show them.</p>
<p>Looking at the latest RFM2Pi firmware which is installed to the shop bought&nbsp;rfm69&nbsp;RFM2Pi&#39;s&nbsp;and looks compatible with an rfm12 RFM2Pi too,&nbsp;<a href="https://github.com/openenergymonitor/RFM2Pi/blob/master/firmware/RFM69CW_RF_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328.ino#L620-L633">both the CRC and the &quot;quiet mode&quot; seem enabled</a> for both rfm12 and rfm69,&nbsp;I can confirm they work as expected on a rfm69 RFM2Pi so it could worth trying a firmware upgrade to the RFM2Pi before going any further.</p>
<p>However there&#39;s alot of assumption in there so I may be well off base, especially as I&#39;m not fluent in &quot;arduino&quot; yet.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26751"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Tue, 13/01/2015 - 16:27.</div>
    <div class="content">
     <p>Curiosity got the better of me as usual and I thought I would try the various firmwares,&nbsp;unfortunately&nbsp;I couldn&#39;t get the early &quot;full&quot; version to run on my rfm12 RFM2Pi&nbsp;and suspect it may due be a change in JeeLib&nbsp;rf12_config()&nbsp;is depreciated in favor of&nbsp;rf12_configSilent()&nbsp;and&nbsp;rf12_configDump().&nbsp;</p>
<p>As I didn&#39;t fancy installing an old JeeLib&nbsp;or updating the sketch I skipped the later version too and just tried installing&nbsp;the latest RF12demo.12 aka the rfm69 sketch to the rfm12&nbsp;RFM2Pi and found many bad packets that were silently discarded previously by the &quot;stock&quot; rfm12 firmware.</p>
<p>To use this latest firmware on rfm12,&nbsp;2 lines need editing before compiling</p>
<p><a href="https://github.com/openenergymonitor/RFM2Pi/blob/master/firmware/RFM69CW_RF_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328.ino#L24">#define RF69_COMPAT 1 &nbsp; &nbsp;&nbsp;to &nbsp; &nbsp; &nbsp;#define RF69_COMPAT 0</a></p>
<p>and</p>
<p><a href="#define SERIAL_BAUD 38400">#define SERIAL_BAUD 38400 &nbsp; &nbsp; &nbsp;to &nbsp; &nbsp; &nbsp;&nbsp;#define SERIAL_BAUD 9600</a></p>
<p>With RF12demo.12 installed you will also get the version returned when using &quot;v&quot; command, so the auto-baud selection in emonHub &quot;can&quot; work, I say &quot;can&quot; because it doesn&#39;t&nbsp;appear to work every time. But we are aware the &quot;auto-baud selection&quot; needs attention and it can easily be skipped by defining the baud in emonhub.conf.</p>
<p>The quiet mode can also be enabled/disabled with command &quot;q&quot; .</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26766"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Tue, 13/01/2015 - 23:18.</div>
    <div class="content">
     <p>I&#39;ve updated to the latest Full_RF12 firmware:&nbsp;https://github.com/openenergymonitor/RFM2Pi/commit/2dd48a9bf6497390966fc69df6ece953732526ce</p>
<p>I also tried the RF12_demo (cutdown) version too and both showed node 10 and occasional node 22 (which doesn&#39;t exist) so I&#39;ll leave it til tomorrow and see what we get!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26774"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Wed, 14/01/2015 - 11:22.</div>
    <div class="content">
     <p>As of 1100 today I only have one spurious node (22) with 9 values, triggered 9 hours ago.&nbsp; So much much better with the updated rfm12pi firmware!</p>
<p>I do still have the custom packetlen &lt; 66 in emonhub_interfacer.py as described above so not sure if this is having any impact.&nbsp; Now it is &quot;stable&quot; I&#39;ll probably leave this for a few days before coming back and investigating further.&nbsp; Got a few other projects to sort out :)</p>
<p>&nbsp;</p>
<p>Matthew</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26780"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Wed, 14/01/2015 - 15:44.</div>
    <div class="content">
     <p>Good to hear it&#39;s improved, we can still consider a selective &quot;filter by node id&quot; maybe, the 66byte limit however may not have the expected results, firstly there are instances where the &quot;sent payload&quot; is added to eg the rfm69 rssi, the node, possibly the group (if group 0 used) so may need more thought, plus the if &gt;66 may be counting characters rather than bytes when performed on a string.</p>
<p>See how it pans out and we can look into these things if needed. If the node 22 is reoccurring and the only&nbsp;anomaly&nbsp;it may be worth trying a group change, there&#39;s no guarantee it will help but if the stray foreign packet is consistent (and alone) a group change should change the fixed element&nbsp;of the checksum.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26790"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1039" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Spurious RF sent to emoncms</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1039" title="View user profile.">mattwire</a> on Thu, 15/01/2015 - 13:04.</div>
    <div class="content">
     <p>Last night I removed the check for length 66 and changed my system to group 201.&nbsp; Now there are no unexpected packets!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/9967"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-TYppw1cUPWezyBT0Zg2fOBkD57q1mDnXKujrZqnZ7ao" value="form-TYppw1cUPWezyBT0Zg2fOBkD57q1mDnXKujrZqnZ7ao"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
