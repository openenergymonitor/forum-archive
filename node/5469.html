<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5469 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:27:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emonhub failure | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emonhub failure</h3>
        <span class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 30/07/2014 - 10:03</span>
        <div class="content"><p>Hi</p>
<p>I got an issue with Emonhub in the past days.</p>
<p>I have got a RPI+HDD running Emonhub + EmonCMS (V8.1.2, apt version)<br />
	Emonhub is forwarding data to the local EmonCMS server and to a remote server (Emoncms.org)</p>
<p>Firstly, data in both emoncms servers were being updated at a very low rate (every 100-200 seconds instead of every tens seconds). 12 hours later, I got no more update in both EmonCMS server. Everything is back to work now after having restarted the emonhub service. See attached graph. It&#39;s a power feed which is created in emoncms from a Wh feed sent by emonhub.</p>
<p>It seems to be a problem coming from the local emoncms that replied &quot;sent!ok&quot; to emonhub.<br />
	Please find attached the emonhub log file saved just before restarting the emonhub service.</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>EDIT : I just see a strange line at the end of the log file. It&#39;s the last line before emonhub stopped forwarding data :</p>
<p>2014-07-28 22:48:01,653 WARNING Discarded RX frame &#39;non-numerical content&#39; : [&#39;3&#39;, &#39;146&#39;, &#39;0&#39;, &#39;124&#39;, &#39;250&#39;, &#39;36&#39;, &#39;0&#39;, &#39;250&#39;, &#39;255&#39;, &#39;&#39;, &#39;1&#39;, &#39;184&#39;, &#39;1&#39;, &#39;0&#39;, &#39;0&#39;, &#39;205&#39;, &#39;1&#39;, &#39;0&#39;, &#39;0&#39;, &#39;73&#39;, &#39;100&#39;, &#39;0&#39;, &#39;0&#39;]</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5818.html" class="topic-previous" title="Go to previous forum topic">‹ Meter kwh countdown</a>
              <a href="5821.html" class="topic-next" title="Go to next forum topic">Feed id change ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-22764"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/07/2014 - 12:16.</div>
    <div class="content">
     <p>Hi Eric</p>
<p>Sorry to hear you&#39;ve had a problem, I&#39;ve had a look at the files and see the last line you refer to, the line previous to that is</p>
<p class="rteindent1">2014-07-28 22:48:01,651 INFO&nbsp; NEW FRAME :&nbsp; 3 146 0 124 250 36 0 250 255&nbsp; 1 184 1 0 0 205 1 0 0 73 100 0 0</p>
<p>Which shows in the frame received from node 3, the&nbsp;9th byte has been&nbsp;omited, why? I couldn&#39;t say but the &quot;NEW FRAME&quot; log is prior to any emonHub&nbsp;processing and is for showing the frame in it&#39;s original form, so it is probable the frame was received by emonHub that way. This is just one frame and it&#39;s occured sometime after the main issue so I wouldn&#39;t be concerned about it just yet.</p>
<p>The last good localhost receipt and first occurrence&nbsp;of the rogue &quot;sent!ok&quot; in your logs was at 18:42 on the 28th</p>
<p class="rteindent1">2014-07-28 18:42:23,184 DEBUG Receipt acknowledged with &#39;ok&#39; from <a href="http://localhost/emoncms" title="http://localhost/emoncms">http://localhost/emoncms</a></p>
<p class="rteindent1">2014-07-28 18:42:44,592 WARNING Send failure: wanted &#39;ok&#39; but got Message sent!ok</p>
<p>at this time the updates would of dropped significantly as emonHub would of been stuck trying to deliver the frame for a while&nbsp;then looped again, reading a single frame and getting stuck. so with 5 nodes each of these would get read every 5 post attempts - so very slow for both servers</p>
<p>its not clear when the actual first occurrence&nbsp;was, the post body belonging to the first occurrence in your logs contains 100 frames which is a batch limit set in emonhub so from that I can only tell there were at least 100 frames undelivered at that point in time.</p>
<p>This particular situation should not occur with newer revisions of emonhub&nbsp;as threading is implemented so emonHub is no longer at the mercy of each target server being contactable and able to respond correctly. This does not explain why it stopped reporting all together&nbsp;though and unfortunately your logs do not extend into the period of no updates.</p>
<p>When emonHub&nbsp;was restarted all the buffers were cleared so normal intervals resumed, did you restart emoncms&nbsp;or just emonhub?&nbsp;</p>
<p>I really don&#39;t know how or why the acknowledgement message would change without outside influence, this would appear to be the cause.</p>
<p>Did the data slow and top at the same times on each server or did the emoncms.org server continue to log data at a slow rate beyond the last update on the local server? if they are the same then the local emoncms was being updated and the &quot;incorrect&quot; response of &nbsp;&quot;sent! ok&quot; could be catered for in emonhub&nbsp;by expecting the response to &quot;contain&quot; ok rather than &quot;be equal to&quot; ok, but that seems like a work around rather than a fix.</p>
<p>Paul<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22765"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/07/2014 - 12:24.</div>
    <div class="content">
     <p>PS another concern is the actual value reported, your graph shows a significant drop in power across the slow updates period. the wh&nbsp;accumulator is designed to avoid this, so that should also be looked into also as a network outage or sketchy network connection could present data the same way.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22766"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 30/07/2014 - 13:49.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Thank for being always ready !</p>
<p><em>This does not explain why it stopped reporting all together though and unfortunately your logs do not extend into the period of no updates.</em></p>
<p>&gt;&gt; I got no logs during the period with no updates. The next lines in my emonhub.log file are about the emonhub restart that I did on the 30th of july</p>
<p><em>When emonHub was restarted all the buffers were cleared so normal intervals resumed, did you restart emoncms or just emonhub?</em></p>
<p>&gt;&gt; I just restarted the emonhub service. I did nothing on the local emoncms. Since I have restarted emonhub, there is no more &quot;sent!ok&quot; message in the logs.</p>
<p><em>Did the data slow and top at the same times on each server or did the emoncms.org server continue to log data at a slow rate beyond the last update on the local server?</em></p>
<p>&gt;&gt; Please find a graph to understand what happened on both server. It&#39;s the same feed which represents the total number of kWh elapsed. (There is an offset but don&#39;t look at it). The node 4 sends the Wh elapsed every ten seconds and then the total number of kWh elapsed is calculated in emoncms with a accumulator process.</p>
<p>One can see that during the slow update period, the total number of kWh was increasing at a slow rateonemoncms.org. That&#39;s ok. But during that period, the total number of kWh increased at an abnormal rate (4-5 times more that expected). IT looks like data were posted several times.</p>
<p>Hope this help to understand what happened.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22769"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/07/2014 - 15:36.</div>
    <div class="content">
     <p>Okay, so the graphs clearly show the data was being delivered to the local emoncms, therefore had the unexplained &quot;sent!ok&quot; confirmation been sent or accepted as &quot;ok&quot; then emonhub would of deleted the sent data from the buffer and moved on, issue 1 is where or why did the message change?</p>
<p>and the repeated posting caused the wh accumulators to continue accumulating, which led to exaggerated totals I don&#39;t think that should happen so that&#39;s another issue.</p>
<p>It sounds like emonHub&nbsp;just stopped after a while, maybe it crashed what size are your buffers? did you have your stats php&nbsp;running? could it of been a RAM shortage?</p>
<p>I think we need to look at the confirmation process, emonhub has changed alot&nbsp;over the last couple of months, can you post the confirmation code from emonhub_dispatcher.py so we know exactly what you have? the current version has&nbsp;</p>
<p class="rteindent1">reply = self._send_post(post_url, post_body)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if reply == &#39;ok&#39;:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.debug(&quot;Receipt acknowledged with &#39;&quot; + reply + &quot;&#39; from &quot; + self._settings[&#39;url&#39;])<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return True<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.warning(&quot;Send failure: wanted &#39;ok&#39; but got &quot;+reply)</p>
<p>When the confirmation is &quot;ok&quot; returning &quot;True&quot; tells emonHub&nbsp;it&#39;s ok to delete the sent data from the buffer, the _send_post() code is &nbsp;</p>
<p class="rteindent1">def _send_post(self, post_url, post_body=None):</p>
<p class="rteindent1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reply = &quot;&quot;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; request = urllib2.Request(post_url, post_body)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; response = urllib2.urlopen(request, timeout=60)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except urllib2.HTTPError as e:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.warning(&quot;Couldn&#39;t send to server, HTTPError: &quot; +<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str(e.code))<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except urllib2.URLError as e:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.warning(&quot;Couldn&#39;t send to server, URLError: &quot; +<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str(e.reason))<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except httplib.HTTPException:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.warning(&quot;Couldn&#39;t send to server, HTTPException&quot;)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except Exception:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; import traceback<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.warning(&quot;Couldn&#39;t send to server, Exception: &quot; +<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; traceback.format_exc())<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reply = response.read()<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finally:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return reply</p>
<p class="rteindent1">&nbsp;</p>
<p>Trying to track the origin, I have searched the python modules for &quot;sent!ok&quot; and not found it, nor is it in emonhub or emoncms. I did however find the only occurrences of &quot;sent!&quot; with an exclamation mark are in emoncms&nbsp;locale files&nbsp;&quot;Message successfully sent! and user module &quot;Password recovery email sent!&quot; did you change local or reset password in emoncms recently? Even if you did this doesn&#39;t explain how the 2 could get lumped together though.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22771"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 30/07/2014 - 19:28.</div>
    <div class="content">
     <p>I didn&#39;t modify the default configuration : bufferMethod = memory and bufferSize = 1000.</p>
<p>Regarding the RPI&#39;s stat, I was only logging the RAM used (ram used + ram cached + buffers) and the CPU temp. It shows that it seems not be a RAM issue (see attached).</p>
<p>My version of the emonhub_dispatcher.py file seems to be older as I have no _send_post() function<br />
	Here is my confirmation code :</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else:<br />
	<strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reply = response.read()</strong><br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if reply == &#39;ok&#39;:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.debug(&quot;Receipt acknowledged with &#39;&quot; + reply + &quot;&#39; from &quot; + self._settings[&#39;url&#39;])<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return True<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.warning(&quot;Send failure: wanted &#39;ok&#39; but got &quot;+reply)</p>
<p>Attached is a copy of my emonhub_dispatcher.py file.</p>
<p>
	I didn&#39;t change local or reset password in emoncms recently.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22772"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 30/07/2014 - 19:27.</div>
    <div class="content">
     <p>PS : in my logs, you can also find such message :</p>
<p>WARNING Send failure: wanted &#39;ok&#39; but got Message sent!Message sent!ok</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22775"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/07/2014 - 22:15.</div>
    <div class="content">
     <p>Do you still have the events module installed? and do you have any events configured ? I recall you did install it and That is the one and only place I can find &quot;Message sent!&quot;&nbsp;</p>
<p><a href="https://github.com/emoncms/event/blob/186539af82a78e6cff844365618443bc1d95bec9/event_model.php#L302">https://github.com/emoncms/event/blob/186539af82a78e6cff844365618443bc1d95bec9/event_model.php#L302</a></p>
<p>I&#39;ve been over the emonHub code and can see no other place it could come from other than emoncms, whether it&#39;s possible for the events module to interfere with the request response I cannot say, but it certainly seems the most feasible source .</p>
<p>Looking at your graphs, it doesn&#39;t look like a RAM issue but is it possible the heat was the final straw? there is a massive increase in temp in-line with the constant attempts to post which just suddenly drops and is probably where the posting finally stops.&nbsp;</p>
<p>Although I didn&#39;t find a definitive&nbsp;answer about the temp range of a Pi, I think general consensus is above 50 deg C is not good. <a href="http://elinux.org/images/1/1b/RPiThermalTest-8-20-2012.pdf">This document&nbsp;</a>&nbsp;says it may be possible to run at over 50 deg C but also states this</p>
<blockquote><p>When the system was pushed up to 55&deg;C (131&deg;F), the web browser stalled and the system went<br />
		comatose. Temperature of the SOC/RAM was 75&deg;C (167&deg;F). (Since the SOC is under the RAM no direct<br />
		temperature measurements of the SOC can be made.) The network part was running at 73&deg;C (163&deg; F).<br />
		When the system was shut down and rebooted, it would not operate until the temperature of the<br />
		SOC/RAM parts dropped to 50&deg;C.&nbsp;</p>
</blockquote>
<p>Which is cause enough to suspect heat could of been the final straw since you have recorded temps nearing 57 deg C at the GPU, plus the hdd&nbsp;is also in the same compartment and we don&#39;t know what temp that was at.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22777"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/07/2014 - 22:44.</div>
    <div class="content">
     <p>i just looked at some of your previous graphs and maybe the temp isn&#39;t so extreme, it&#39;s still high but you have run at those temps before,</p>
<p>You have changed the graph on your last post so there is more detail now and I can see Pi still running after where you marked emonhub shut down, presumably&nbsp;the log files stopped at that time, Does the pi have the ability to end a process if its causing temp issues? Just wondering what changed after 12hrs&nbsp;of consistently&nbsp;trying to post the same data,</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22781"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Thu, 31/07/2014 - 07:58.</div>
    <div class="content">
     <p>Hi,</p>
<p>Sorry for my bad english. When I marked &quot;emonhub halt&quot; or &quot;emonhub shutdown&quot;, I am talking about the emonhub service and not the RPI itself. At any moment, the RPI has stopped. I guess that emonhub service has stopped as there were no more logs until I restarted that service.</p>
<p>I managed to run a RPI many hours at 65&deg;C (<a href="../sites/default/files/RAM%20and%20Temp.png">see here</a>) without any problem. So, I&#39;m not sure it is a temp issue. The temp is high (55&deg;C) but stable. According to me, the temp is a consequence and not a cause of&nbsp; emonhub&#39;s state.</p>
<p>Regarding the event module, you must be on the right way as I&#39;m using it on my local emoncms ! I&#39;m not sure there is link but I was facing some problems with it. When a specific condition became TRUE, it sent me the corresponding alert by email. But, when the condition went back to FALSE, the event module kept on sending me email until I deleted the corresponding alert.</p>
<p>To prevent any other emonhub crash, I will temporary delete all alerts.</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22782"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 31/07/2014 - 09:05.</div>
    <div class="content">
     <p>Hi,</p>
<p>There&#39;s no issue with your english at all Eric,</p>
<p>I totally agree the high temp is a consequence of emonHub&nbsp;working so hard continually trying to the post data and get a valid response from emoncms, I didn&#39;t intend to imply otherwise, I was speculating as to what may have caused&nbsp;emonhub to eventually stop, we may never know!</p>
<p>I&#39;m quietly confident the cause was from within the events module, your confirmation of a issue with it combined with it being the only place i can find &quot;Message sent!&quot; used is too coincidental to be ignored.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23491"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 01/09/2014 - 11:26.</div>
    <div class="content">
     <p>Hi,</p>
<p>I had another emonhub failure few days ago with the configuration described above :</p>
<p>&nbsp; - One RPI (+HDD running) running&nbsp; Emonhub + EmonCMS (V8.1.2, apt version)<br />
	&nbsp; - Emonhub is forwarding data to the local EmonCMS server and to a remote server (Emoncms.org)</p>
<p>Firstly, data in both emoncms servers were being updated at a very low rate (every 100-200 seconds instead of every tens seconds). some hours later, I got no more update in both EmonCMS server. The root file system of the RPI was full :</p>
<p>pi@raspberrypi ~ $ df<br />
	Filesystem&nbsp;&nbsp;&nbsp;&nbsp; 1K-blocks&nbsp;&nbsp;&nbsp; Used Available Use% Mounted on<br />
	rootfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2721336 2563696&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 100% /<br />
	/dev/root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2721336 2563696&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 100% /<br />
	devtmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 215824&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 215824&nbsp;&nbsp; 0% /dev<br />
	tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 44820&nbsp;&nbsp;&nbsp;&nbsp; 240&nbsp;&nbsp;&nbsp;&nbsp; 44580&nbsp;&nbsp; 1% /run<br />
	tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5120&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5120&nbsp;&nbsp; 0% /run/lock<br />
	tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 89620&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 89620&nbsp;&nbsp; 0% /run/shm<br />
	/dev/mmcblk0p1&nbsp;&nbsp;&nbsp;&nbsp; 57288&nbsp;&nbsp; 19064&nbsp;&nbsp;&nbsp;&nbsp; 38224&nbsp; 34% /boot</p>
<p>I discovered that I got some very long and repetitive log in /var/log/apache2/error.log (see attached).&nbsp; I moved them to another machine and then deleted them, but it was growing immediately again and again. I had to stop my local emoncms.</p>
<p>In the emonhub log file, one can see that emonhub got a wrong reply from my local emoncms.</p>
<p>Again just before emonhub failure, I got the same message than above : &quot;WARNING Discarded RX frame &#39;non-numerical content&#39;&quot;</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23496"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 01/09/2014 - 13:34.</div>
    <div class="content">
     <p>Hi Eric</p>
<p>I&#39;ve had a browse through the logs and cannot explain the emoncms entries in the apache log, I&#39;m not familiar enough with emoncms or apache.&nbsp;</p>
<p>I couldn&#39;t find the&nbsp;&quot;WARNING Discarded RX frame &#39;non-numerical content&#39;&quot; message but if it came at the end prior to failing it wouldn&#39;t of been the root cause, the emoncms&nbsp;&quot;unpack .. require 4 got 0&quot; messages date back to 16th&nbsp;august which coincides with some phpmyadmin log entries did you trigger something then ?</p>
<p>Whilst emoncms was not returning &quot;ok&quot; this would cause emonhub to &quot;gum up&quot; as the early version you are using is single thread, regardless of the cause of this issue I would strongly recommend upgrading emonhub&nbsp;as multi-threading was introduced to prevent emonhub from being effected by no or slow responses from servers. Although the ever increasing log sizes would eventually stop anything working.</p>
<p>I didn&#39;t notice anything sinister in the emonhub.log beyond the massive &quot;reply&quot; from emoncms and it seems emonhub resumed operation and posted the data as the next reply from emoncms is &quot;ok&quot;.</p>
<p>Maybe Trystan or someone well versed in emoncms or the data engines can shed some light on the apache logs for us.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23504"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 01/09/2014 - 15:29.</div>
    <div class="content">
     <p>The &quot;WARNING Discarded RX frame &#39;non-numerical content&#39;&quot; message is at the very end of the emonhub.log file. It&#39;s the last message before emonhub stops sendind data. I agree with you that the cause of the failure seems to come from my local emoncms.</p>
<p>BTW, I will move to the last version of emonhub.</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24111"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Tue, 23/09/2014 - 11:22.</div>
    <div class="content">
     <p>Hi</p>
<p>I encountered another Emonhub failure (third one...) with the June-apt-version. (I have to update it, I know)</p>
<p>Unlike the two first failures, I didn&#39;t get any message starting by &quot;Send failure: wanted &#39;ok&#39; but got ...&quot;<br />
	Like the two first failures, the last message in the logs (attached) is :</p>
<p>2014-09-19 23:47:31,846 INFO&nbsp; NEW FRAME :&nbsp; 2 36 255 219 255&nbsp; 1 36 3 0 0 7 0 0 0 61 99 0 0<br />
	2014-09-19 23:47:31,849 WARNING Discarded RX frame &#39;non-numerical content&#39; : [&#39;2&#39;, &#39;36&#39;, &#39;255&#39;, &#39;219&#39;, &#39;255&#39;, &#39;&#39;, &#39;1&#39;, &#39;36&#39;, &#39;3&#39;, &#39;0&#39;, &#39;0&#39;, &#39;7&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;61&#39;, &#39;99&#39;, &#39;0&#39;, &#39;0&#39;]</p>
<p>Every thing was fine until that message (normal update in Emoncms, no send failure , ...)<br />
	So this message seems to be the unique cause of the three failures.<br />
	It looks like that a byte has been omited.</p>
<p>Some questions :</p>
<p>&nbsp;&nbsp; - how is it possible to loose a byte inside Emonhub ?<br />
	&nbsp;&nbsp; - how to prevent Emonhub to halt when such an event occur ?</p>
<p>&nbsp;</p>
<p>Another strange thing in my logs. The buffer was always growing although I got &quot;Receipt acknowledged with &#39;ok&#39; from <a href="http://emoncms.org".xn--6a/" title="http://emoncms.org&quot;. ">http://emoncms.org&quot;. </a> Now everything is working fine after restarting the Emonhub service. The buffer is not growing all the time and data are sent to EMonCMS.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24113"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 23/09/2014 - 11:55.</div>
    <div class="content">
     <p>Hi Eric, sorry to hear you&#39;re having troubles again.</p>
<blockquote><p>I encountered another Emonhub failure (third one...) with the June-apt-version. (I have to update it, I know)</p>
</blockquote>
<p>I really do appreciate your early involvement with emonhub but many things have been changed in emonhub to improve it&#39;s functioning as well as improve it&#39;s error handling and reporting, if there is a problem with emonhub it may of already been resolved or not even be relative to the latest build. It is also difficult to support the early version you are using since it was &quot;mid development&quot; prior to any versioning so I cannot be sure what code you have so please update !</p>
<blockquote><p>Unlike the two first failures, I didn&#39;t get any message starting by &quot;Send failure: wanted &#39;ok&#39; but got ...&quot;</p>
</blockquote>
<p>Unlike the first two occasions which logged an unexpected response from your local emoncms, you are not sending to a local emoncms for it to return an unexpected response.</p>
<blockquote><p>So this message seems to be the unique cause of the three failures.</p>
</blockquote>
<p>No, this message seems to commonly be the last thing emonhub logs before the &quot;failure&quot;. In both the previous occasions we have found emonhub was not the cause and we have no reason to suspect anything different at this time.</p>
<blockquote><p>how is it possible to possible to loose a byte inside Emonhub ?</p>
</blockquote>
<p>Since the first thing emonhub does is log the raw string to the log file and the byte is already missing at that point it is likely to of been missing on arrival to emonhub, perhaps emonhub is slower to be effected by the imminent failure and the serial port skips a beat or something (for example).</p>
<blockquote><p>how to prevent Emonhub to halt when such an event occur ?</p>
</blockquote>
<p>emonhub will not fail just because of a missing byte, if you try posting to emonhub from a sketch with a deliberately omitted value it would run indefinitely and fill the log file with the &quot;discarded RX frame messages&quot;</p>
<blockquote><p>Another strange thing in my logs. The buffer was always growing although I got &quot;Receipt acknowledged with &#39;ok&#39;</p>
</blockquote>
<p>As discussed in our PM dated 1/7/2014, this was due to <a href="https://github.com/emonhub/emonhub/commit/254bd0b74081b182b030f4506e543d492c8b9701#diff-22ee5d21e8848c55cf12b01115a96ca7R117">a small bug that was resolved back in june</a> where only a single frame was deleted from the buffer rather than the number of frames successfully posted.</p>
<p>I think it would be unlikely that the larger buffer size would of been able to get to a size that could &quot;choke&quot; the Pi&#39;s RAM since it can only be 1000 items max and I doubt if emoncms would of failed due to duplicated data, so I&#39;m currently at a loss as to the actual cause.</p>
<p>But I am absolutely sure updating emonhub would have a positive impact regardless.</p>
<p>I&#39;m always happy to try and help, but it would be easier for us both if you updated&nbsp;emonhub.</p>
<p>Do you have any other info?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24136"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 24/09/2014 - 12:19.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p><em><em><em><em>sorry to hear you&#39;re having troubles again.</em></em></em></em></p>
<p class="rteindent1">Make sure that I was not complaining at all ! My goal was just to share the bugs I had.</p>
<p><em><em>It is also difficult to support the early version you are using since it was &quot;mid development&quot; prior to any versioning so I cannot be sure what code you have so please update !</em></em></p>
<p class="rteindent1">I haven&#39;t update yet my version because I can&#39;t physically access to the RPI but only by SSH. I&#39;m afraid of losing the control on the RPI during the update if something goes wrong. I would rather have a version that that makes me loose 1 or 2 days of data each month than loosing the RPI. Maybe, I&#39;m too paranoiac ...</p>
<p class="rteindent1">If my version is very out of date, I agree that it doesn&#39;t make any sense to share the bugs I had .</p>
<p><em>I&#39;m always happy to try and help, but it would be easier for us both if you updated emonhub.</em></p>
<p class="rteindent1">I totally understand your point. If I were you I would say the same (in a less polite way).</p>
<p><em>Do you have any other info?</em></p>
<p class="rteindent1">No but one more remark :&nbsp; it&#39;s unclear for me if emonhub is released or not and what is the last version number.</p>
<p class="rteindent1">EDIT : For both, Emonhub and EmonCMS, it would be great to have release notes explaining the new features, the corrected bugs, the installation procedure, ... I know it&#39;s a long work.</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24146"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub failure</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 25/09/2014 - 10:56.</div>
    <div class="content">
     <p>Hi Eric</p>
<p>i understand now why you haven&#39;t updated, I didn&#39;t realize it was that same project. however that confuses me a little as I&#39;m sure we confirmed you had updated the system after I did that bug fix.</p>
<p>If you want we can just edit the dispatcher code to fix that bug, which may well ease the load enough to prevent further issues. But there again I guess you only have a week or so for that project to run now, so probably&nbsp;not worth doing.&nbsp;</p>
<blockquote><p>it&#39;s unclear for me if emonhub is released or not</p>
</blockquote>
<p>Me too :-)</p>
<p>Our original intention was to release emonhub&nbsp;as a debian package, but as that looks &nbsp;less likely now and it&#39;s already in general use &nbsp;I guess it is already unofficially launched. I gave the version included on the latest SD card a version ID of rc1.0 and I have rc1.1 in testing at the moment, minor stuff really just settings validation, default settings and automatic baud selection for rfm&nbsp;type devices. There is a couple of things that need to be decided about installer scripts and the repo structure (to ease upgrading) before they are set in stone but aside from that and the lack of documentation I think v1.0 is good to go!</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5469"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ewMnPPQIBFoBJx79svLBo_QT_x-ark6HyINS0WxC0zM" value="form-ewMnPPQIBFoBJx79svLBo_QT_x-ark6HyINS0WxC0zM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
