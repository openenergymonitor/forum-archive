<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>PHASECAL and Serial Statements | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/3">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">PHASECAL and Serial Statements</h3>
        <span class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 21/07/2012 - 21:27</span>
        <div class="content"><p>This may sound like a surprising pairing, but they both have a significant effect on our real-time code.&nbsp;</p>
<p>The Mk2 sketch that I posted a few days ago loses marks in each of these areas.&nbsp; For a start, it does not include PHASECAL, probably because I didn't really understand it.&nbsp; Although my triac-based build appears to be working fine, and created another full tank of hot water today, its performance would no doubt be improved if I had phase-shifted the voltage samples to align with the current samples.&nbsp; For a resistive load, I should be seeing a Power Factor of unity, but without including PHASECAL, that is unlikely to be happening.&nbsp; RW has suggested that I read up on this topic, which I intend to now do without further exposing my lack of knowledge in this area.</p>
<p>My sketch also contains a display line which appears on the screen every few seconds.&nbsp; OK, we all know that Serial statements are relatively slow, but a few short ones can't really be making very much difference can they?&nbsp; Well, take a look at the attached file, made using the display tool that a posted a few weeks back, and think again ...</p>
<p>Also attached is a display showing a single mains cycle that has been sampled using two independant voltage sensors.&nbsp; One is a standard plasticised adaptor, the other is a large chassis transformer.&nbsp; I wouldn't like to say which one is better, but their waveforms are clearly different.&nbsp; If nothing else, it seems likely that each of them would benefit from a different value of PHASECAL.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/1918" class="topic-previous" title="Go to previous forum topic">‹ RFM12B signal issue need help.</a>
              <a href="/emon/node/2554" class="topic-next" title="Go to next forum topic">Monitoring 10 Clamp inputs ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-5306"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 21/07/2012 - 22:31.</div>
    <div class="content">
     <p>As I understand it, the call to Serial.. returns immediately but the data still has to be sent, and carefully timed to maintain the baud rate, and there's only one processor so the processing has to steal cycles from the sketch.</p>
<p>You will almost certainly need a different value of PHASECAL for different makes and model of transformer. Depending on its performance, you might also find that the value for PHASECAL will depend on the mains voltage at the time. (<a href="http://openenergymonitor.org/emon/sites/default/files/TDC%20Phase%20Shift.zip">here</a> shows the X-Y plot of an adapter as the voltage is varied from 185V to 253V IIRC). For those who can't view the video: Basically, as the voltage increases, what started off as a straight line (output tracks the input exactly) opens out into a loop. The harder you push the iron, the bigger the phase error because you've permanently magnetised the iron and so the magnetism does not follow the same path falling as it did when it was rising (the B-H loop). If you don't get near to saturation, then the loop is small and the phase shift correspondingly small.</p>
<p>[The telecom adapter <em>appears</em> to show less of the 'wiggle' at the crossing that is characteristic of saturation and a phase shift).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5307"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 22/07/2012 - 09:04.</div>
    <div class="content">
     <p>Robert, please could you clarify what you mean by &quot;pushing the iron&quot;.</p>
<p>My 'ironwork' sits within the primary and secondary coils of a dedicated 240V mains transformer.&nbsp; The primary coil is connected to the mains, and the secondary coil is driving a resistive load of approx 100k.&nbsp; I don't see any other way that I could be pushing it, either more or less hard.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5316"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 22/07/2012 - 14:18.</div>
    <div class="content">
     <p>It's not you who is &quot;pushing the iron&quot;, it's the transformer designer. When you magnetise iron, the process is not linear. The magnetic flux increases more and more slowly until it can take no more, when it is said to be 'saturated'. This is a characteristic of the material - the 'magnetisation curve' . (See <a href="http://en.wikipedia.org/wiki/Saturation_%28magnetic%29" title="http://en.wikipedia.org/wiki/Saturation_%28magnetic%29">http://en.wikipedia.org/wiki/Saturation_%28magnetic%29</a>).</p>
<p>When you take the magnetising force away, not all the magnetic flux disappears. The iron has become permanently magnetised. (The flux that remains as called the 'Residual magnetism'). Then, as you magnetise the iron in the other direction, it starts from a different place. This mechanism is what gives you <a href="http://www.electronics-tutorials.ws/electromagnetism/magnetic-hysteresis.html">Magnetic Hysteresis</a>.</p>
<p>Now the voltage that comes out of the transformer is related to the <em>rate of change</em> of flux. So looking at the hysteresis loop, <strong>H</strong> is the magnetising force resulting from the primary current, and the <em>rate of change</em> of flux <strong>B</strong> gives you the output voltage. Clearly, the output voltage is going to be different to the input.</p>
<p>The transformer designer tries to get the maximum out of his transformer by working the iron as close to saturation as possible, because that way he can use the minimum amount of iron and so keep his costs down. But the further he drives the core into saturation, the more distorted the output voltage becomes.</p>
<p>If you run your A.C. adapter at (say) 110 V (as I have done in the tests I've carried out), you find the output almost exactly tracks the input with very little phase lag and distortion.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5324"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 22/07/2012 - 20:14.</div>
    <div class="content">
     <p><em>If you run your A.C. adapter at (say) 110 V (as I have done in the tests  I've carried out), you find the output almost exactly tracks the input  with very little phase lag and distortion.</em></p>
<p>OK, Robert, thanks for that clarification.</p>
<p>So if I were to connect <u><em>two</em></u> small transformers in series so that each of them only sees 110V, and just use the output from one of them, I would then get nigh-on perfect results ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5326"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 22/07/2012 - 21:12.</div>
    <div class="content">
     <p><em>I would then get nigh-on perfect results ... </em></p>
<p>... if you get them to share the voltage equally. But you only get half the voltage out, so you might just as well wire the secondaries in series as well.&nbsp; I don't guarantee the result would be perfect, but it cannot be worse. Of course, you'd need identical, or at least very similar, transformers in order to share the voltage properly. To do <em>that</em>, you might find you need to wire the secondaries in parallel.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5328"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 22/07/2012 - 23:42.</div>
    <div class="content">
     <p>Sorry, Robert, maybe I'm missing the point here.</p>
<p>The standard approach is to take a single 240V AC adaptor or transformer and pot down its output, often by 10:1, for supplying to the Arduino.&nbsp; If there were two similar transformers in series, then each would only see 120V, and each would only provide half of the output signal.&nbsp; For the same sized signal at the Arduino, the resistive divider would just need to be less.</p>
<p>If running a standard transformer on 50% supply would give a near-perfect voltage waveform, then that could be a good reason for taking this different approach.&nbsp; </p>
<p>My PV system needs to be as efficient as I can make it.&nbsp; It needs to pay its way for many more years to come! &nbsp; </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5332"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/450" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/450" title="View user profile.">stuart</a> on Mon, 23/07/2012 - 08:54.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Did I mention interrupts ? <img src="http://openenergymonitor.org/emon/sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/wink_smile.gif" alt="" /></p>
<p>&nbsp;</p>
<p>I re-jigged (technical term!) the code you provided to start using interrupts, this not only allows you to use the serial statements without affecting the measurements, but also then allows very evenly distributed measurements over a period of time.</p>
<p>&nbsp;</p>
<p>Your code as it stands will vary its reading points over the AC wave because each loop through the code takes different amounts of time, additionally because the code is making an estimate of when the positive zero cross occurs that also happens at different points along the cycle, I think I measures values around 5 to 50VAC before the zero cross code kicks in.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5334"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 23/07/2012 - 10:41.</div>
    <div class="content">
     <p><a title="View user profile." href="http://openenergymonitor.org/emon/user/450">stuart</a></p>
<p>My code ? ? ?&nbsp; Which code is that?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5335"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1332" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1332" title="View user profile.">JBecker</a> on Mon, 23/07/2012 - 11:02.</div>
    <div class="content">
     <p><em>If you run your A.C. adapter at (say) 110 V.......</em></p>
<p>Take a 400V AC transformer (these are readily available with different output voltage ratings, e.g. Hahn BV E 1 304 2735 with 21V output) for 230V grid voltage. This also gives a perfect output.</p>
<p>Using inputs or outputs in series (or individual tappings on the output) can give load-dependant results.</p>
<p>BR, J&ouml;rg.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5337"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 23/07/2012 - 11:24.</div>
    <div class="content">
     <p>Now I think it's me who's missing the point!&nbsp; Your resistive divider is 165kOkms in total, the power dissipated in the resistors is 5 mW. The power dissipated in the transformer core is probably 2 orders of magnitude greater than this (The standard Mascot adapter draws 10 mA at 250 V = 2.5 VA, so - I didn't check this - probably about 1.5 W). I don't think saving a few milliwatts in the divider will make much difference - you will probably save more in iron loss by running the transformer at the lower flux density, the justification for that is the Mascot adapter draws 7.5 mA at 225 V, so as expected not a linear relationship.</p>
<p>I just wrote &quot;wire the secondaries in series&quot; to avoid the need to recalculate and obtain a new resistor.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5338"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 23/07/2012 - 11:32.</div>
    <div class="content">
     <p><a href="http://openenergymonitor.org/emon/user/1332" title="View user profile.">JBecker</a></p>
<p>Unfortunately, at 415 V only open-type at 'industrial' sizes (at corresponding prices and VA ratings) are readily available in the UK.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5353"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 29/12/2012 - 11:14.</div>
    <div class="content">
     <p>For anyone who has ever wondered what PHASECAL is all about, but not been quite sure where to start because it all seems so complicated, why not check out my attached &quot;PHASECAL For Dummies&quot; presentation.</p>
<p>A few days ago (as Robert will testify), I knew absolutely nothing about this intriguing topic.&nbsp; I&#39;m not now claiming to be an expert, but you may find a lighter-than-normal approach to this heavyweight topic to be of some interest.&nbsp; From the outset, my objective has been to understand more about my own Mk2 setup for PV Control, but those findings should be equally relevant to anyone who is using the standard OEM V&amp;I sketch.</p>
<p>Within a few minutes, you too could be creating those impressive Lissajous Figures (hope I&#39;ve spelt that right) on your own system.&nbsp; All you need is an Arduino.&nbsp; If you already have a working system for measuring power, you can then find out whether its performance could be improved by tweaking PHASECAL a bit this way or that, or whether it needs more drastic remedial action, as my system appears to do.&nbsp;&nbsp; Maybe my new mains transformer is to blame, who knows.&nbsp;</p>
<p>The attached zip file contains a 6-page MS Word document saved in two formats; the sketch by which all results were taken in both &#39;debug&#39; and &#39;normal&#39; modes; and four files of results from simulation, test rig and our grid-supply point.</p>
<p>Hope it&#39;s of use to someone :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5374"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 24/07/2012 - 13:30.</div>
    <div class="content">
     <p>I've just spotted the Building Blocks piece entitled </p>
<pre>
Explanation of the phase correction algorithm</pre><p>which I see has had 800+ reads.&nbsp; What I don't understand is why anyone would want to use a value of PHASECAL that is outside the range 0 - 1.&nbsp; Within that range, we're applying linear interpolation between two known values, which makes perfect sense to me.&nbsp; </p>
<p>For anything outside that range, it would surely be better to delay one of the samples (whichever occurs first) until the corresponding pair of samples that you require for the instantaneous power calculation have become available.&nbsp; Then, using a PHASECAL value within the range 0 - 1,  you can <em>interpolate</em> between those two samples, so as to get the precise value that you need.</p>
<p>There should never be any need to <em>predict</em> where the voltage waveform is likely to be going.&nbsp; Just store the relevant sample of current until you <u><em>know</em></u> where the voltage has been.&nbsp; </p>
<p>Phase-advancing circuits are fine in theory but seem poorly suited to this kind of application where Voltage and Current samples appear in endless alternation.&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5380"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1332" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1332" title="View user profile.">JBecker</a> on Tue, 24/07/2012 - 14:54.</div>
    <div class="content">
     <p>Robin,</p>
<p>very good point. This has also puzzled me for a while. Why extrapolate when interpolation would also be possible? Extrapolation can in theory give completely wrong sample values. But, on the other hand, especially for the voltage samples, we can with very good probability assume, that the next voltage sample will also 'ly' on the sine curve determined by the preceeding samples. So the extrapolation is a very good 'guess'. It only fails if the mains voltage is suddenly shut off.</p>
<p>This could be the reason why it is done this way ?!?&nbsp; &nbsp;</p>
<p>Regards, J&ouml;rg.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5382"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 24/07/2012 - 18:39.</div>
    <div class="content">
     <p>Try exchanging these two lines in calcVI( ) and see what value you need for PHASECAL <img alt="" src="http://openenergymonitor.org/emon/sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/wink_smile.gif" /></p>
<blockquote><p>sampleV = analogRead(inPinV);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Read in raw voltage signal<br />
sampleI = analogRead(inPinI);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; //Read in raw current signal</p>
</blockquote>
<p>There are some notes in the software that accompanies App Note AVR465 about the phase correction:</p>
<blockquote><p>Due to multiplexing, there will be a delay between subsequent data chennels, as follows:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; Delay = [ 360 degrees * f(mains) ] / [ 3 * f(sampling) ]</p>
<p>At 2400Hz sampling rate, this means that fresh samples from ADC0 and ADC1, for example, will actually have a time difference of&nbsp; 1/2400 = 0.42ms, which corresponds to (50*360)/2400 = 7.5 degrees in a 50Hz mains environment. In addition, current transformers in the analogue front end may typically contribute up to six degrees of additional phase lag. Phase distortions are calibrated using linear interpolation, as follows:</p>
<p>&nbsp;&nbsp;&nbsp; Calibrated = x[n-1] + CalibCoefficient * ( x[n] - x[n-1] )</p>
<p>Note that linear interpolation is the same as a fixed time delay. This means that higher frequency componentes will not be adjusted correctly. Typically, though, not enough energy is present in the higher frequency components to cause this to degrade accuracy below acceptable levels.</p>
<p>Also note that the higher the sampling rate, the lower is the calibration range in degrees. If the sampling rate is too high, then the linear interpolation as such can not compensate for the phase lag of some DC immuned current transformers. Such transformers can have a phase lag in excess of six degrees.</p>
</blockquote>
<p>[Source: AVR465.c example source file by Atmel Corporation to accompany application note AVR465: Single-Phase Power/Energy Meter with Tamper Detection.]<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5384"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 24/07/2012 - 19:46.</div>
    <div class="content">
     <p>J&ouml;rg: Thanks for the support, great to have you on board.&nbsp; </p>
<p><em>very good point. This has also puzzled me for a while. Why extrapolate when interpolation would also be possible? </em></p>
<p>I think it's because the algorithm doesn't need to be changed, only the 'how far ahead?' value for the prediction.&nbsp; A one-size-fits all algorithm must be easier to keep control of than several ones with subtly different timings.&nbsp; As we're all trying to do a similar task, with similar equiment, it may be that a better arrangement can be derived which will suit everyone's setup better. </p>
<p>As shown in the piece that I posted yesterday on this thread, my hardware needs a PHASECAL&nbsp;value of around 2.5.&nbsp; I feel sure that it will be in my best interests to change my code around so that the required value lies within the 0 - 1 range - hence PHASECAL can use interpolation rather than prediction.</p>
<p>But first, I need to be sure which voltage sensor I will be using for the lifetime of my system.&nbsp; From Robert's excellent report on the Mascot AC/AC adaptor, it seems likely that a pair of lightly loaded adaptors wired in series (120V each), may give much improved results.&nbsp; Before hacking my code around, I intend to put this idea to the test.&nbsp; Watch this space ...</p>
<p><em>Robert: Try exchanging these two lines in calcVI( ) and see what value you need for PHASECAL</em></p>
<p>As I see it, the value of 2.5 shows that the current in my system is approximately 1.5 samples in advance of the voltage.&nbsp; At present, with measurements being taken in the order V then I, the predicted voltage is required immediately that the current sample is available.&nbsp; 1.5 samples ahead of this point is approximately when the voltage sample after next is due,</p>
<p>If the samples were instead to be taken in the order I then V, there would then be a delay of around half a loop before the predicted voltage was required.&nbsp; I feel sure that the PHASECAL value for my system would then fall to around 2 from its present value of 2.5.&nbsp; I'll give it a try and let you know.</p>
<p></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5385"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 24/07/2012 - 22:57.</div>
    <div class="content">
     <p>Change of prediction:</p>
<p>With PHASECAL = 2.5, as my system appears to need now, I think that the I waveform is one sample ahead of the V.&nbsp; This is because, when the voltage prediction is needed, the most recent voltage sample (V0) is already half a loop's worth old.&nbsp; At that moment, we're at 1.5 on the PHASECAL scale.&nbsp; PC = 2.5 is another full loop later, just at the time when the next sampleI is due.</p>
<p>When sampleI is taken before sampleV, two effects will come into play:</p>
<p>Firstly, because the calculation can't take place until the sampleV is available, sampleI has to wait around for half a loop.&nbsp; That delay will reduce the prediction's 'length' by half a loop's worth.&nbsp; Secondly, because the sampleV is brand new when the calculation is done, rather than half a loop old, PHASECAL doesn't have to base its prediction from a reference point in the past.&nbsp; So that's another half loop of reduction.</p>
<p>Taken together, I think that changing the sample order as you've suggested will bring the required value of PHASECAL down to 1.5, which looks much more reasonable.&nbsp; And if halving the voltage on the voltage adapter can reduce the amount of phase-advance that is introduced, then we may be onto a winner!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5386"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 25/07/2012 - 00:12.</div>
    <div class="content">
     <p><a href="http://openenergymonitor.org/emon/user/956" title="View user profile.">calypso_rae</a></p>
<p>Yup, when I measured the phase angles of both Mascot adapter and YHDC c.t, I realised that if the statement order were to be reversed, the correction required could be almost none. I did test it and it was indeed the case. But I didn't suggest it because of the confusion I thought it would cause (at that time, there was huge debate because nobody even knew the c.t. ratio!).</p>
<p>(The trick, in case you hadn't rumbled me, is to choose the order so that as close as possible the phase shift of one transformer is equal to the phase shift of the other plus the reading &amp; conversion time for one input. So zero phase shift in the v.t. isn't <em>necessarily</em> the best target - it depends on how bad your c.t. is. Or vice versa).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5394"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 25/07/2012 - 21:55.</div>
    <div class="content">
     <p>RW: As you have painstakingly explained to me in the past, there are only two activities of timing significance per measurement loop, these being the taking of the voltage and current samples.&nbsp; If the current is in advance of the voltage, it makes sense to sample the current first because the voltage sample is then bang up to date when the power calculation is done, half a loop later.&nbsp; The algorithm then doesn't have to predict so far ahead.</p>
<p>Anyway, how was my prediction? i.e. that Config A -&gt; B would be -1. &nbsp; It looks to be about right, but here are the results:</p>
<p>Config A:&nbsp; 240V chassis transformer as Vsensor, V sample first;&nbsp; best value of PHASECAL = 2.8 or maybe 3</p>
<p>Config B:&nbsp; 240V mains transformer as Vsensor, I sample first; &nbsp; best value of PHASECAL = 2.0</p>
<p>Config C:&nbsp; two 'telecom' adapters in series, 120V each, I sample first;&nbsp; best PHASECAL value = 1.8</p>
<p>Config D: a single 240V 'telecom' adapter, I sample first; &nbsp; best PHASECAL value = 0.8</p>
<p>Putting two adapters in series did not achieve the desired effect.&nbsp; That set of L-diagrams looked odd, rather like a triple figure of 8.&nbsp; In terms of reducing PHASECAL, Config D was by far the best, and my rig spent the latter end of the day diverting energy on this basis, seemingly just as before.</p>
<p>With a properly set up system, I was hopeful that meter pulses would appear every 3600J regardless of the load size.&nbsp; Sadly, the non-linearity still seems to be there.&nbsp; Above 1kW load, the system appears to be pretty linear, but tails off significantly with smaller loads.&nbsp; It appears to be around 5% less sensitive at 100W than at 1000W.&nbsp; The leakage with no current flowing is around half a Watt.</p>
<p>Data files attached for anyone who likes watching the eyes open and close ;-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 25/07/2012 - 22:40.</div>
    <div class="content">
     <p>What do you mean by non-linearity? You say at 100 W it is 5% less sensitive. What does that 100 W represent: generated, absorbed or nett exported power?</p>
<p>I'm trying to figure out where a non-linearity like that might creep in. If it was a small d.c offset in the c.t. input that wasn't corrected and in the correct sense, it could appear less sensitive. I can't help thinking it might alternatively be a variable phase shift in the c.t., because the phase error in that is current-dependent. It rises as current falls ( by 1&deg; from 40 A to 3 A), but I don't have any figures relevant to you - I stopped my tests at 62R burden and 3 A primary current.</p>
<p>Have you tried to measure PHASECAL at different currents? What happens when you try to establish PHASECAL at a current equivalent to 100 W?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5399"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 26/07/2012 - 09:48.</div>
    <div class="content">
     <p>Non-linearity.&nbsp; The Mk2 code that I'm running has the ability to record meter events.&nbsp; At each pulse, it displays the energy status as recorded by the system.&nbsp; Because of its upper and lower limits, the main energy bucket is no good for this purpose so I've added a parallel one without any limits).&nbsp; When the house is drawing power from the grid, I expect to see meter pulses occurring at intervals of 3600J.&nbsp; </p>
<p>With POWERCAL set to get 3600J per pulse for a 2kW load, I find that the 'energy per pulse' figure remains constant down to around 1kW but than starts to increase.&nbsp; With a net import of just 100W or so (meter pulses less frequent) the 'energy change per pulse' value invariably climbs up towards towards the 4000 mark.&nbsp; This is not due to leakage in my system as such, because it records no more than 0.5W when the CT is around a mains cable which has no current flowing.</p>
<p>Unfortunately, it's not possible to analyse the performance of the meter when the house is exporting.&nbsp; The LED is just 'on', regardless of how many units of precious PV energy are slipping away.&nbsp; My hope is that, if the system can record net power flow accurately during periods of net import, then the same system will produce accurate results when exporting (hopefully as little as possible!)</p>
<p>If the sensitivity of the system is non-linear, it's difficult to see how this could be accomodated.&nbsp; One approach might be to gradually bias the system towards export, but then pull back a bit every time that a meter pulse is seen.&nbsp; One pulse every minute or so would be a small price to pay (2p per day maybe) for knowing that the system really was utilising every last Joule of available PV.&nbsp; </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5403"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 26/07/2012 - 16:09.</div>
    <div class="content">
     <p>I think we have to assume that the tariff meter is correct. I can't see that the code itself has any non-linearity in it, either by accident or design, so it has to be the transducers or the conversion. Somewhere between the actual current and voltage; and the numbers that the code uses; is where the problem must lie.</p>
<p>I can think of two possibilities (all the rest have to be linear!):</p>
<p>If you have pickup from the mains voltage into the current input, then at low power it could become significant. The effect would be lop-sided, it could even make a small power reverse its sign to change from generation to export, or vice versa. Unclipping the c.t. would remove this pick-up too, so reading 1 W with the c.t. removed from the cable doesn't rule this out. But it does seem to rule out pick-up elsewhere. This is possibility no.1. You can test this by putting the c.t. on the neutral instead.</p>
<p>We know the c.t has a phase shift that varies with current. That's possibility no.2. Unfortunately, you are looking for an error of around 10%, and I can't explain all of that with this theory.</p>
<p>I'll carry on thinking about this.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5404"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 26/07/2012 - 17:25.</div>
    <div class="content">
     <p>Robert, I share your conviction that the tarrif-meter and the code itself can be eliminated from our enquiries.&nbsp; In debug mode, with floating point maths throughout, my code is linear to the Nth degree.&nbsp; Having dissected the stored waveform into individual samples for both V and I, and then reconstructed all the power contributions back together again, the results is identical to what I started with.&nbsp; The single LP filter (which you kindly suggested that I might wish to try) has zero effect on the profile of either waveform.&nbsp; It's rather like passing through a Star Trek transporter; one's bits are somehow sent flying out into the cosmos, but they all manage to come back together perfectly!)</p>
<p>In an AC environment, any form of wound component must be vulnerable to interferance.&nbsp; As will any cables which carry miniscule voltages, such as the CT's cable.&nbsp; I generally put the CT around the neutral wire, if only because it's a prettier colour.&nbsp; Bring back the red one I say!</p>
<p>Minimal leakage is seen when my CT is clipped onto an extension lead where the conductors have been separated.&nbsp; When clipped around either the Neutral or the Live cables near the meter, the only way to know how much current is flowing is by monitoring the LED.&nbsp; That's what I've been doing, and it appears that my system is not entirely linear.</p>
<p>I feel sure that other correspondents will have investigated the linearity of their own OEM systems by now, and will soon provide us with the benefit of their findings ... </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5517"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1399" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1399.jpg" alt="Series530&#039;s picture" title="Series530&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1399" title="View user profile.">Series530</a> on Sat, 04/08/2012 - 07:33.</div>
    <div class="content">
     <p>Undersampling ?</p>
<p>&nbsp;</p>
<p>Under sampling and reconstruction...</p>
<p>I may be completely off base with what is needed here but I thought I would offer this thought:</p>
<p>If one of the issues is the phase delay introduced by sensing the CT and the VT separately and both are limited by the sampling rate of the ADC, could the system be set up such that the incoming waveforms are under sampled and then reconstructed? This gives a lot more phase resolution following a bit more maths.</p>
<p>I dont know how much timing control there is in the arduino (I will have a better idea soon having ordered all of the components) but, if it is possible, either I or V inputs could be sampled with a deterministic phase delay (say 10ms) and a deterministic sampling rate (non integer number of samples per mains cycle) &nbsp;and each I and V input then sampled over several power line cycles simulaneously? Provided the acqusition time of the waveform isn't huge (just a few power line cycles rather than many) the waveforms should be pretty repetitive and the phase resolution then becomes a function of undersampling and we are no longer hampered by the sampling rate of the arduino ADC.</p>
<p>This may be happening as the sampling rate may not be properly locked to the mains frequency given that the processor is off doing other things (like serial printing). There is a subtle difference as, I think at least, what is being done at the moment is a measurement on a single shot capture rather than an undersampled reconstruction.</p>
<p>Remove the ADC sampling offsets and what is left is the errors due to the rest of the system and these can then be characterised separately.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5524"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 04/08/2012 - 14:29.</div>
    <div class="content">
     <p>I've just thrown some numbers at a spreadsheet, and varying the starting point by up to one sample's worth (with 52 samples per cycle - about the norm), it makes 0.064 V difference (240 V to 240.064 V) to the rms voltage calculated over 1 cycle. OK, I appreciate that I haven't done the sum for power, and over a range of currents, and that we might not always get the same number of samples (although we do know how many) but it doesn't look hopeful for explaining a 10% error.</p>
<blockquote><p>With POWERCAL set to get 3600J per pulse for a 2kW load, I find that the  'energy per pulse' figure remains constant down to around 1kW but than  starts to increase.&nbsp; With a net import of just 100W or so (meter pulses  less frequent) the 'energy change per pulse' value invariably climbs up  towards towards the 4000 mark.&quot;</p>
</blockquote>
<p>This seems to say that we're looking for an error that increases to about 10%, apparently non-linerarly, as energy decreases, but which <strong>isn't</strong> there when the c.t. is not around the cable.</p>
<p>Calypso_rae: I'm just wondering whether the tariff meter is hitting 'anti-creep' and under-recording when you are almost balancing to give a low nett import?&nbsp; If so,&nbsp; then it's another a mechanism in the tariff meter that we don't fully understand yet.</p>
<p>[ If you detect grasping at straws - - you're right! ]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5527"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 04/08/2012 - 22:42.</div>
    <div class="content">
     <p>I doubt whether 'anti-creep' would be affecting any measurements that I've made.&nbsp; The change in sensitivity between consumption rates of 100W and 1000W can be detected immediately and seems very predictable.&nbsp; </p>
<p>To shed more light on the meter's operation, I ran some tests yesterday but haven't looked at the results file in detail yet.&nbsp; With 1kW of surplus PV, I repeatedly turned a 3kW kettle on and off while recording meter events and energy levels.&nbsp; The logic inside the meter may well be more complex than I'd previously thought ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5545"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/450" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/450" title="View user profile.">stuart</a> on Mon, 06/08/2012 - 11:29.</div>
    <div class="content">
     <p>Robin, when I get chance to test out your code, I'll put my AC&nbsp;clamp meter around the mains tails and see if the current levels drop to near zero - do you have anything similar you could try ?</p>
<p>Something like this...</p>
<p><a href="http://uk.rs-online.com/web/p/clampmeters/0112752/" title="http://uk.rs-online.com/web/p/clampmeters/0112752/">http://uk.rs-online.com/web/p/clampmeters/0112752/</a></p>
<p>I've read a couple of electric meter manuals (boring!) and it seems the anticreep kicks in around the 10-12W area over a certain (unknown) period of time - once in this zone the meter stops recording unless the load ramps up over the 10-12W range.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5548"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 06/08/2012 - 16:28.</div>
    <div class="content">
     <p>What is creep? The concept comes from the induction watt-hour meter where if the magnets were not set up correctly, the meter would creep even when only the voltage coil was energised.</p>
<p>I would have assumed it was a very small constant current, such as you would get from capacitance between line and neutral, or dampness( ! ). But it is always possible that the meter is seeing accurately balanced 'trampolining' (i.e. a very low <em>average</em> current which is made up of a low and long export current backed off by a large short pulse of import) as a 'creep' current that ought to be ignored.&nbsp;</p>
<p>I think that's just another feature of digital meters that we need to ponder over.</p>
<p>N.B. Anti-creep is usually defined as a current (Starting Current), and I think it's a bit less than the figure you give (for obvious reasons, because you could light an energy-saving lamp for free, and they'll never allow that!). It is specified in the standard as 0.4% of the base current, but that's not always given (it is NOT the maximum current). 20mA seems a common figure (=4.8 W) (40 mA for a Siemens S2AS-100) for Starting Current.</p>
<p>However, the Magnetic Card meter recently posted (I forget by whom) specifically states &quot;Anti creep occurs if an average power of 12.5 watts (+-20%) or less is detected for a period of 4 minutes and 48 seconds.&nbsp; Activation of anti-creep is indicated by the red LED being continuously lit. This function is reset as soon as the average power over 4 minutes and 48 seconds exceeds 12.5 watts (+-20%); the LED then returns to pulsing as normal.&quot;&nbsp; But as the starting current for this meter is 100 mA, it may not be typical of all meters.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5549"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 06/08/2012 - 16:39.</div>
    <div class="content">
     <p>When starting out on this lark, I bought a clamp-style current meter from Maplin for around &pound;15.&nbsp; A seriously useful piece of test kit - or so I thought.&nbsp; However, when compared with the measurements of current which are so easy to make using an Arduino, the results are rubbish!&nbsp; OK, it can probably tell you whether the kettle is on or off, but it could never distinguish between the currents taken by 40W, 60W and 100W bulbs as my test rig has repeatedly done.&nbsp; </p>
<p>The only way to know what's going on at the meter is via its LED.&nbsp; The standard inport meter provides accurate 3600J markers in one direction of energy flow.&nbsp; If everything is linear, one would expect a measurement system to behave the same in either direction.&nbsp; Fitting&nbsp; an export meter would allow the system to be checked in both directions.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5553"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/450" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/450" title="View user profile.">stuart</a> on Mon, 06/08/2012 - 18:21.</div>
    <div class="content">
     <p>Have you tried reading out the meter over the infrared port ?</p>
<p>Think they output more granular level of data than the display shows (more decimal places)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5555"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 06/08/2012 - 18:25.</div>
    <div class="content">
     <p>Call me a measurement junkie, but I'd seriously doubt any test &quot;instrument&quot; at that sort of price. As you say, good for a general indication but not for serious measurement. I think my multimeter (also from Maplin but no longer available) cost about &pound;40 and is about as good as they come in that price range. To get a marked improvement in accuracy especially on the a.c. ranges (i.e a factor of 4 - 3% to 0.7%) you need to spend about 10 times that money; and if you want better than that (0.3%) you are looking at close on &pound;1000.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5563"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 06/08/2012 - 20:52.</div>
    <div class="content">
     <p>Stuart: No, I've not tried to use the infra-red port.&nbsp; Even if I knew the protocol, I'm not sure that this would work; I think it's more for diagnostic purposes.</p>
<p>As others have mentioned, the 5235 manual does talk about an anti-creep mode.</p>
<p><em>Below starting current, the meter enters into an anti-creep mode.&nbsp; In this <br />
state the metrology LED is permanently lit and the registers do not <br />
increment.&nbsp; The LED remains lit until the meter current is increased in a <br />
forward direction beyond the starting current. The starting current is shown <br />
in the technical summary. <br />
</em></p>
<p><em>Current (Base) Direct connection&nbsp; Ib&nbsp;&nbsp; 5A, 10A, or 20A <br />
Current (Max) Imax 40A, 60A, 80A or 100A <br />
Starting Current (IEC) 0.4% of Ib </em></p>
<p>When my Mk2 controller is active and working correctly, the net flow through the meter should be zero.&nbsp; In this state, it is probably entirely reasonable that the meter should go into &quot;anti-creep&quot; mode.&nbsp; It may therefore be the case that what I have been interpreting as &quot;export&quot; is actually &quot;anti-creep&quot;.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5568"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/450" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/450" title="View user profile.">stuart</a> on Tue, 07/08/2012 - 09:05.</div>
    <div class="content">
     <p>Interestingly, the manual also says...</p>
<p>Export:</p>
<p>&quot;Alternately the register is held in memory and can be read from the meter via the IEC 1107 port&quot;</p>
<p><a href="http://www.solarinverters.com.au/files/users_manuals/usermanual-ahmzqq.pdf" title="http://www.solarinverters.com.au/files/users_manuals/usermanual-ahmzqq.pdf">http://www.solarinverters.com.au/files/users_manuals/usermanual-ahmzqq.pdf</a></p>
<p>So the exported energy is kept internally in the meter (even if not displayed) and can be read through the port.</p>
<p>The interface is a standard, circuit diagram here...</p>
<p><a href="http://www.elektor.com/magazines/2002/march/iec1107-electricity-meter-interface.55617.lynkx" title="http://www.elektor.com/magazines/2002/march/iec1107-electricity-meter-interface.55617.lynkx">http://www.elektor.com/magazines/2002/march/iec1107-electricity-meter-in...</a></p>
<p>&nbsp;</p>
<p>On the PHASECAL stuff, does this mean that you could write software to auto calibrate the value - assuming that it was a totally resistive load during the calibration phase ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5572"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 07/08/2012 - 11:57.</div>
    <div class="content">
     <p><em>Stuart: So the exported energy is kept internally in the meter (even if not displayed) and can be read through the port.</em></p>
<p>Well spotted, thanks for that insight, Stuart</p>
<p><em>On the PHASECAL stuff, does this mean that you could write software to  auto calibrate the value - assuming that it was a totally resistive load  during the calibration phase ?</em></p>
<p>Yes, that sounds entirely feasible to me.&nbsp; I have a version of my Phase Diagram Tool which runs several times using a different value of PHASECAL each time.&nbsp; By scanning up and down the Serial window, the best value can be easily seen from the 'eye' diagrams.&nbsp; Once set up up correctly, the value should never need to change, so I'm not sure whether an auto cal feature would be beneficial.</p>
<p>Nudging the algorithm whenever anything happens at the meter's LED sounds a great idea.&nbsp; The virtual meter would then be linked to the physical one rather than operating in glorious isolation.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5610"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 22/03/2013 - 17:53.</div>
    <div class="content">
     <p><a href="http://openenergymonitor.org/emon/sites/default/files/IMGP9729.s.jpg"><img alt="" height="225" src="http://openenergymonitor.org/emon/sites/default/files/IMGP9729.s.jpg" width="300" /></a></p>
<p>In the circuit schematic for my Mk2 PV Controller, I&#39;ve shown a 150R burden resistor.&nbsp; This value of burden gives a decent sized signal at the Arduino for a 3kW load and is the setup that has been reliably working in our garage for the last few weeks.&nbsp; We&#39;ve had 4kWh so far today and the water is fully up to temperature with the stat off.&nbsp; All that lovely power which is now being being wasted ....</p>
<p>However, it has now become appararent that CTs don&#39;t like working at such high output levels.&nbsp; Rather than using a high value of burden to obtain a high signal, it is much better to use a low value of burden and then boost the amplitude with an op amp buffer that has some gain.</p>
<p>It has also become apparent to me that the standard YHDC CT is not really a quality component.&nbsp; Even the tiniest of air gaps ruins the readings.&nbsp; With only plastic springs to keep if shut, the continuity of the ferrite core is problematic to say the least.&nbsp; Yesterday, I invested in a different type of CT, the smallest variant in the <a href="http://www.rapidonline.com/Electrical-Power/Split-core-AC-current-sensors-178112#techSpecs">Magnelabs range via Rapid Online</a>.&nbsp; (This variant now claims to be &#39;discontinued&#39;, but there are many others; the 50A one should be fine)</p>
<p>The Magnelab CT has &#39;lapped&#39; joints in its metallwork.&nbsp; When clipped together, the continuity of the flux-carrying core is as good as it can be for a non-invasive design.</p>
<p>Four results files are attached, all with the same format.&nbsp; Two files relate to the standard YHDC-30 CT; one with a high value of burden (150R), the other with a low burden (39R) and a x3 buffer.&nbsp; The other two relate to the Magnelabs CT; again, one has a high value of burden (820R), the other has a low burden (220R) and a x3 buffer.&nbsp; The absolute sensitivies of the CTs are different hence the different values of burden that I&#39;ve used.&nbsp; The size of the signal&nbsp; presented to the Arduino is similar in all cases.</p>
<p>To quickly compare between these four configurations, look at the end of each file.&nbsp; There you will find the &#39;eye&#39; diagrams for each setup with a 3kW load.&nbsp; The worst configuration by far is the one that I&#39;ve been using to date. &nbsp;</p>
<p><em>[Update:&nbsp; If only measuring &quot;real power&quot;, which is what a domestic electricity meter does, the results are hardly affected by the quality of the &#39;eye diagram&#39; .&nbsp; Using 150R with the standard 30A YHDC CT (from which the internal burden has been removed) seems fine for all practical purposes).&nbsp; Other builders have successfully used a smaller burden and boosted the output via a buffer stage, but the difference in performance appears to be minimal.]</em></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5632"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 10/08/2012 - 12:34.</div>
    <div class="content">
     <p>Picking up on this: &quot;Rather than using a high value of burden to obtain a high signal, it is  much better to use a low value of burden and then boost the amplitude  with an op amp buffer that has some gain.&quot;</p>
<p>Using a higher value burden on a current transformer has exactly the same effect as using a lower resistance load on a voltage transformer - you overload the transformer.&nbsp;</p>
<p>Although they operate on the same fundamental principles, current transformers are the dual of voltage transformers.</p>
<table border="1" align="center" width="504" height="158" cellspacing="1" cellpadding="1">
<thead>
<tr>
<th scope="col">Voltage transformer</th>
<th scope="col">Current transformer</th>
</tr>
</thead>
<tbody>
<tr>
<td>Happy on open circuit</td>
<td>Happy on short circuit</td>
</tr>
<tr>
<td>Destroyed on short circuit by over-current</td>
<td>Destroyed on open-circuit by over-voltage</td>
</tr>
<tr>
<td>Most turns (usually) on the primary winding</td>
<td>Most turns on the secondary winding</td>
</tr>
<tr>
<td>Steps down voltage proportional to turns ratio</td>
<td>Steps down current proportional to turns ratio</td>
</tr>
<tr>
<td>Steps up current proportional to turns ratio</td>
<td>Steps up voltage proportional to turns ratio</td>
</tr>
<tr>
<td>Secondary voltage is defined by primary voltage</td>
<td>Secondary current is defined by primary current</td>
</tr>
<tr>
<td>Primary current is defined by secondary current</td>
<td>Primary voltage is defined by secondary voltage</td>
</tr>
<tr>
<td>Power transferred is limited by VA rating</td>
<td>Power transferred is limited by VA rating</td>
</tr>
</tbody>
</table>
<p>N.B.</p>
<ol>
<li>The primary voltage for a current transformer is the voltage drop in the main conductor measured from one side of the transformer to the other. For the standard 100 A : 50 mA c.t. with 1 V appearing across the burden, the primary voltage is 0.5 mV.</li>
<li>All the above are approximations that neglect losses.</li>
</ol>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/450" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/450" title="View user profile.">stuart</a> on Fri, 10/08/2012 - 15:43.</div>
    <div class="content">
     <p>Robin, found this circuit earlier - any use to you?</p>
<p><a target="_self" href="http://www.crmagnetics.com/Products/Assets/ProductPDFs/Precision%20Rectifier%20Circuit%20for%20CT%20Signal%20Conditioning.pdf" class="Normal" title="Precision Rectifier Circuit for CT Signal Conditioning">Precision Rectifier Circuit for CT Signal Conditioning</a></p>
<p><a href="http://www.crmagnetics.com/Products/Assets/ProductPDFs/Precision%20Rectifier%20Circuit%20for%20CT%20Signal%20Conditioning.pdf" title="http://www.crmagnetics.com/Products/Assets/ProductPDFs/Precision%20Rectifier%20Circuit%20for%20CT%20Signal%20Conditioning.pdf">http://www.crmagnetics.com/Products/Assets/ProductPDFs/Precision%20Recti...</a></p>
<p>CURRENT TRANSFORMERS - An Analysis of Ratio and Phase Angle Error</p>
<p><a href="http://www.crmagnetics.com/Portals/0/analysis_of_ct_error.pdf" title="http://www.crmagnetics.com/Portals/0/analysis_of_ct_error.pdf">http://www.crmagnetics.com/Portals/0/analysis_of_ct_error.pdf</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5638"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 10/08/2012 - 18:55.</div>
    <div class="content">
     <p>Stuart, that circuit appears to be for getting DC from AC.&nbsp; By removing the diodes, It would appear to provide a buffered source of AC which is what we would need.&nbsp;</p>
<p>The x3 buffer that I mentioned yesterday is essentially doing the same job as the pair that they're using.&nbsp; The first of their two buffers, however, seems unnecessary; it's not doing anything of use.&nbsp; The second one (in my case, x3) is fine by itself and does not load the CT at all.&nbsp; I've used an LM358, with R2 = 68K, R1 = 33K as shown <a href="http://en.wikipedia.org/wiki/Op_amp#Non-inverting_amplifier">here</a> .&nbsp; Unfortunately, to cover the full range of the Arduino's ADC,&nbsp; this device needs a supply voltage greater than 5V; I've provided a +9V supply.</p>
<p>Sorry, the final document is way beyond my comprehension.&nbsp; All I know is that I want my measurement system to measure a resistive load as a resistive load.&nbsp; Any phase-shifts must therefore be accounted for and calibrated out.&nbsp; Forcing a CT above its intended voltage appears to cause phase-shift.&nbsp; This unwanted effect is level-dependent, or non-linear.&nbsp; Bad News.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5640"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 10/08/2012 - 19:57.</div>
    <div class="content">
     <p><a title="View user profile." href="http://openenergymonitor.org/emon/user/450">stuart</a></p>
<p>You don't actually want a d.c. output. The whole point of taking voltage and current samples and multiplying them together is to get an accurate measure of power. If you take a rectified average for (presumably both) voltage and current, you have to calibrate it assuming a sinusoidal waveform (or at least some defined waveform) and then it's wrong by varying amounts for every other wave shape.<br />
Not what we want.</p>
<p><a title="View user profile." href="http://openenergymonitor.org/emon/user/956">calypso_rae</a></p>
<blockquote><p>&quot;Forcing a CT above its intended voltage appears to cause phase-shift.&nbsp;  This unwanted effect is level-dependent, or non-linear.&nbsp; Bad News.&quot;</p>
</blockquote>
<p>Yup. You will get a much more accurate waveform by keeping the burden resistor as small as possible (i.e. more lightly loading the c.t.). Some degree of distortion and phase shift is nevertheless inevitable with wound components.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5644"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="kllsamui&#039;s picture" title="kllsamui&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by kllsamui (not verified) on Sat, 11/08/2012 - 04:00.</div>
    <div class="content">
     <p>hi <a title="View user profile." href="http://openenergymonitor.org/emon/user/956">calypso_rae</a></p>
<p>in <a href="http://openenergymonitor.org/emon/node/796">openenergymonitor.org/emon/node/796</a></p>
<p>i described a very bad effect by a high burden resistor (and a too high current).</p>
<p>And also indicated by the need to use a PHASECAL &gt; 3</p>
<p>&nbsp;</p>
<p>but if the point is to read low amps with a &quot; too big&quot; CT</p>
<p>there is still the option to wind the prim. wire ( example 10 times )&nbsp; through the CT.</p>
<p>From the photo i see no space problem doing that.</p>
<p>And much more easy as any opamp circuit.</p>
<p>But anyway you loose the upper range.</p>
<p>&nbsp;</p>
<p>Its difficult to find a nice graph like that for a CT, where you find measuring range for diff. burden resistors.</p>
<p><img src="https://lh4.googleusercontent.com/-uMl-rxLE39w/T_L5BvQ7JGI/AAAAAAAACgs/LW7hqjwBVAs/s521/burden.jpg" alt="burden" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5645"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 11/08/2012 - 09:09.</div>
    <div class="content">
     <p><a title="View user profile." href="http://openenergymonitor.org/emon/user/357">kllsamui</a></p>
<p>The <strong>smallest </strong>size of cable generally used in the UK upstream of the main switch is 16 mm<sup>2</sup>.&nbsp; It is only possible to pass 1 turn of&nbsp;that cable through an aperture that is 12 mm x 12 mm.</p>
<p>We know<a href="http://openenergymonitor.org/emon/buildingblocks/report-yhdc-sct-013-000-current-transformer"> the properties of the YHDC SCT-013-000</a>, and there is good reason to believe the -030 is the same core and secondary winding with a burden resistor added internally.</p>
<p>I have not measured the Magnelab c.t. which Calypso_rae is now using.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5655"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 11/08/2012 - 17:00.</div>
    <div class="content">
     <p><em>stuart: Some degree of distortion and </em><em>phase shift is nevertheless inevitable with wound components.</em></p>
<p>A constant amount of phase-shift is fine because it can be easily calibrated out using the PHASECAL technique.&nbsp; The problem arises when the phase-shift becomes non-linear.&nbsp; Phase shift from CTs appears to be minimal (&lt;2deg) when the output level is small, but&nbsp; increases quite dramatically when the output voltage exceeds a certain level.&nbsp; The maximum output signal that a YHDC-type CT should be asked to supply appears to be around 1V p-t-p.&nbsp; </p>
<p>When allocating power, it is important that the measurement system is linear.&nbsp; Let's say that 300W of spare PV power is available.&nbsp; With a 3kW immersion, the triac will be on for approximately one cycle in every ten.&nbsp; For the majority of cycles, when the triac is off, 300W of surplus power will be slipping out to the grid; that's 1.2A rms or thereabouts.&nbsp; But for every tenth cycle, when the triac is on, 2700W will be entering at the supply point; that's around 11A rms.&nbsp; Providing that the measurement system is linear over this range of currents, then all will be fine.&nbsp; But if the amount of phase-shift varies with amplitude, then the ratio of the powers measured during 'on' and 'off' cycles will not be correct, and the system will drift relative to the supply meter.&nbsp; </p>
<p>Because the mains voltage doesn't change much, one might expect that any phase shift from the voltage sensor would be fairly constant.&nbsp; Robert's report, however, shows that the Mascot AC/AC adapter is surprisingly sensitive to mains voltages that are higher than normal.</p>
<p></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5659"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 11/08/2012 - 23:18.</div>
    <div class="content">
     <blockquote><p>&quot;Robert's report, however, shows that the Mascot AC/AC adapter is  surprisingly sensitive to mains voltages that are higher than normal.&quot;</p>
</blockquote>
<p>My favourite explanation for that is they're designed for the US/Continental market where the supply is nominally 220-230 V, and ours remains centred on 240 V. So even at our nominal centre voltage, they're already being over-run; and as we know, saturation is highly non-linear.</p>
<p>But for that to have an effect, you need to have a weak supply so that the dip on the cycle when you fire the triac can account for at least part of the discrepancy. Have you tried to measure that?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5664"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 12/08/2012 - 06:56.</div>
    <div class="content">
     <p>Robert, the tool that I use to display waveforms is a 1-shot device.&nbsp; After allowing the filters to settle, it identifies a particular cycle and records all V &amp; I samples taken during that cycle.&nbsp; It then moves into a display mode and waits for further instructions from the user.&nbsp; </p>
<p>Because of the time spent outputting the data, this is a stand-alone tool; it is not part of the standard sketch which has to run continuously.&nbsp; It would be entirely feasible to pre-switch on the triac just for the cycle that is being recorded; this would essentially be testing the impedance of our mains supply.&nbsp; Our supply does appear to be 'weak', Henry the vacuum provides a good indication of this.&nbsp; While he is whirring away in the background, if I apply a 2kW load on a separate ring-main, Henry's pitch can be heard to drop.&nbsp; Similarly, when a 3kW kettle or 8kW shower are turned on, the lights always dim slightly.&nbsp; This doesn't seem to cause a problem, it's just a feature of the house.&nbsp; Aren't all houses like this?</p>
<p>For a constant load, it may be interesting to see how the V &amp; I samples are affected when additional power is drawn by household appliances.&nbsp; This test is probably best done after hours when there's no PV.&nbsp;&nbsp; Otherwise there would be too many variables.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5672"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 12/08/2012 - 12:24.</div>
    <div class="content">
     <blockquote><p>&quot;Aren't all houses like this?&quot;</p>
</blockquote>
<p>It shouldn't be the house - on its own at least. I've just done the test and my 3 kW immersion heater drops the mains from 245 V to 243 V (by multimeter, not emonTx, so only 3 digits resolution!), which makes the supply impedance 0.16 Ohms or about 370 kVA fault level (with deplorable uncertainty in the measurement - I must try harder!).</p>
<p>Put it another way, I couldn't see a dip in the lights when I switched the immersion heater on and off.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5680"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 12/08/2012 - 16:28.</div>
    <div class="content">
     <p>A neat test, now why didn't I think of doing that ???</p>
<p>Our 3kW kettle also appears to drop the house voltage by around 2V.&nbsp; On the same ringmain, however, the voltage drop is about twice as much, more like 4V.&nbsp; That is the situation in which the vacuum cleaner's pitch can be heard to change.&nbsp; A 4V drop in voltage is likely to result in a 2-3% reduction of power.</p>
<p>Actually, when I notice the lights dim, it's generally when the 8kW shower is turned on rather than just the kettle.&nbsp; </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5927"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 27/08/2012 - 20:06.</div>
    <div class="content">
     <p>If anyone is interested in finding out what is the best value of PHASECAL for their hardware, here is a tool that should do the job.&nbsp; It needs the Serial window to be open, otherwise nothing will happen.&nbsp; When requested, you enter the min and max values for PHASECAL and the amount that it should be incremented per run.&nbsp; Then just sit back and watch it doing its thing.</p>
<p>For the sketch to work as intended, the voltage and current sensors need to be working, and some current needs to be flowing.&nbsp; I've attached the results file for a 750W resistive load.&nbsp; Looking st this file, the optimal value for the hardware that I'm using appears to be around 1.5.&nbsp; That's when the power factor is closest to one.</p>
<p>Another way of checking the effects of PHASECAL is with the 'eye diagram' tool that I posted some weeks ago.&nbsp; Using that sketch, I've attached the results file for a similar range of values.&nbsp; Given the limited resolution&nbsp; of the displays, the optimal value for PHASECAL is not clear to see.&nbsp; What <em>is</em> fairly evident, however, is the distortion that extreme values of PHASECAL can cause to the voltage waveform.</p>
<p>PHASECAL does not appear in my original Mk2 PV Router sketch at <a href="http://openenergymonitor.org/emon/node/841">http://openenergymonitor.org/emon/node/841</a>, but it is included in the cut-down version that I've posted today at <a href="http://openenergymonitor.org/emon/node/841#comment-5925">http://openenergymonitor.org/emon/node/841#comment-5925</a></p>
<p>All feedback welcome.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5946"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/450" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/450" title="View user profile.">stuart</a> on Tue, 28/08/2012 - 20:54.</div>
    <div class="content">
     <p><a title="View user profile." href="http://openenergymonitor.org/emon/user/956"><em>calypso_rae</em></a><em> on Mon, 27/08/2012 - 20:06.&nbsp; </em></p>
<p>Thanks for the sketch Robin, I've tried this out using a low pass filter to shift the phase of the current signals to match the voltage.</p>
<p>Looks like a winner, a PHASECAL value of around 0.8 seems to work best in my circuit.</p>
<p>&nbsp;</p>
<pre>
The initial value of PHASECAL is 0.25
real power = 16241.45, apparent power = 16319.47, power factor = 0.99522
real power = 16298.89, apparent power = 16377.40, power factor = 0.99521
real power = 16303.07, apparent power = 16381.76, power factor = 0.99520
real power = 16292.60, apparent power = 16371.40, power factor = 0.99519
PHASECAL is now 0.30
real power = 16298.74, apparent power = 16369.23, power factor = 0.99569
real power = 16291.82, apparent power = 16363.46, power factor = 0.99562
real power = 16283.92, apparent power = 16355.43, power factor = 0.99563
real power = 16234.58, apparent power = 16306.18, power factor = 0.99561
real power = 16292.06, apparent power = 16363.91, power factor = 0.99561
PHASECAL is now 0.35
real power = 16293.87, apparent power = 16357.90, power factor = 0.99609
real power = 16302.49, apparent power = 16367.51, power factor = 0.99603
real power = 16342.65, apparent power = 16407.69, power factor = 0.99604
real power = 16344.29, apparent power = 16409.45, power factor = 0.99603
real power = 16344.48, apparent power = 16409.66, power factor = 0.99603
PHASECAL is now 0.40
real power = 16355.08, apparent power = 16412.75, power factor = 0.99649
real power = 16368.39, apparent power = 16427.92, power factor = 0.99638
real power = 16359.47, apparent power = 16418.61, power factor = 0.99640
real power = 16356.30, apparent power = 16415.46, power factor = 0.99640
real power = 16355.65, apparent power = 16414.74, power factor = 0.99640
PHASECAL is now 0.45
real power = 16386.81, apparent power = 16438.58, power factor = 0.99685
real power = 16372.96, apparent power = 16426.44, power factor = 0.99674
real power = 16378.08, apparent power = 16431.83, power factor = 0.99673
real power = 16365.51, apparent power = 16419.31, power factor = 0.99672
real power = 16340.32, apparent power = 16394.61, power factor = 0.99669
PHASECAL is now 0.50
real power = 16362.72, apparent power = 16409.66, power factor = 0.99714
real power = 16354.38, apparent power = 16403.41, power factor = 0.99701
real power = 16355.29, apparent power = 16404.12, power factor = 0.99702
real power = 16341.52, apparent power = 16390.47, power factor = 0.99701
real power = 16343.86, apparent power = 16392.81, power factor = 0.99701
PHASECAL is now 0.55
real power = 16346.63, apparent power = 16389.05, power factor = 0.99741
real power = 16342.11, apparent power = 16386.93, power factor = 0.99727
real power = 16336.18, apparent power = 16381.06, power factor = 0.99726
real power = 16341.98, apparent power = 16386.42, power factor = 0.99729
real power = 16330.65, apparent power = 16374.93, power factor = 0.99730
PHASECAL is now 0.60
real power = 16304.29, apparent power = 16342.98, power factor = 0.99763
real power = 16308.64, apparent power = 16349.87, power factor = 0.99748
real power = 16310.90, apparent power = 16352.08, power factor = 0.99748
real power = 16303.64, apparent power = 16344.88, power factor = 0.99748
real power = 16306.83, apparent power = 16348.01, power factor = 0.99748
PHASECAL is now 0.65
real power = 16322.13, apparent power = 16358.38, power factor = 0.99778
real power = 16318.12, apparent power = 16356.70, power factor = 0.99764
real power = 16315.22, apparent power = 16353.80, power factor = 0.99764
real power = 16322.26, apparent power = 16360.43, power factor = 0.99767
real power = 16312.48, apparent power = 16350.86, power factor = 0.99765
PHASECAL is now 0.70
real power = 16325.61, apparent power = 16359.38, power factor = 0.99794
real power = 16349.14, apparent power = 16385.85, power factor = 0.99776
real power = 16381.06, apparent power = 16418.47, power factor = 0.99772
real power = 16349.04, apparent power = 16385.83, power factor = 0.99776
real power = 16320.15, apparent power = 16356.44, power factor = 0.99778
PHASECAL is now 0.75
real power = 16510.65, apparent power = 16543.49, power factor = 0.99801
real power = 16496.20, apparent power = 16531.71, power factor = 0.99785
real power = 16504.86, apparent power = 16540.29, power factor = 0.99786
real power = 16506.81, apparent power = 16542.36, power factor = 0.99785
real power = 16492.92, apparent power = 16528.63, power factor = 0.99784
PHASECAL is now 0.80
real power = 16514.72, apparent power = 16546.32, power factor = 0.99809
real power = 16519.68, apparent power = 16555.16, power factor = 0.99786
real power = 16528.38, apparent power = 16563.46, power factor = 0.99788
real power = 16530.77, apparent power = 16565.62, power factor = 0.99790
real power = 16528.87, apparent power = 16563.59, power factor = 0.99790
PHASECAL is now 0.85
real power = 16510.61, apparent power = 16542.81, power factor = 0.99805
real power = 16507.60, apparent power = 16542.69, power factor = 0.99788
real power = 16501.31, apparent power = 16536.90, power factor = 0.99785
real power = 16513.56, apparent power = 16548.48, power factor = 0.99789
real power = 16533.04, apparent power = 16568.13, power factor = 0.99788
PHASECAL is now 0.90
real power = 16541.72, apparent power = 16574.88, power factor = 0.99800
real power = 16530.82, apparent power = 16566.68, power factor = 0.99784
real power = 16555.09, apparent power = 16590.97, power factor = 0.99784
real power = 16583.31, apparent power = 16619.74, power factor = 0.99781
real power = 16593.59, apparent power = 16629.83, power factor = 0.99782
PHASECAL is now 0.95
real power = 16603.18, apparent power = 16637.91, power factor = 0.99791
real power = 16559.16, apparent power = 16596.84, power factor = 0.99773
real power = 16548.24, apparent power = 16585.75, power factor = 0.99774
real power = 16562.92, apparent power = 16600.62, power factor = 0.99773
real power = 16567.91, apparent power = 16605.44, power factor = 0.99774
PHASECAL is now 1.00
real power = 16579.68, apparent power = 16616.04, power factor = 0.99781
real power = 16568.13, apparent power = 16607.89, power factor = 0.99761
real power = 16587.74, apparent power = 16627.81, power factor = 0.99759
real power = 16554.26, apparent power = 16594.22, power factor = 0.99759
real power = 16577.06, apparent power = 16616.61, power factor = 0.99762
End of run, please restart to repeat


</pre><p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5953"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 29/08/2012 - 08:30.</div>
    <div class="content">
     <p>Yes, that sounds a good combination.&nbsp; </p>
<p>Include an analogue filter so as to get the optimal value of PHASECAL&nbsp;to lie within the range 0 - 1, and then run the tool to find exactly the right value.&nbsp; The code in the tool needs to match that in the final application; measuring V and I in different orders would defeat the object of the exercise.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6804"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 21/10/2012 - 07:18.</div>
    <div class="content">
     <p>On second thoughts, wouldn&#39;t it better to store samples (V or I) until they can be combined without requiring PHASECAL to be&nbsp; outside the range 0 to 1?&nbsp; This approach would be guaranteed not to introduce any distortion, unlike with any kind of additional filter.</p>
<p>The phasecal algorithm already stores one sample (the previous voltage sample).&nbsp; Storing addition samples would be a straightforward upgrade ... if it really matters, that is.&nbsp; <a href="http://www.youtube.com/watch?v=v8ifoUJvcXY">My results yesterday</a> suggest that phase-shift errors have remarkably little effect on the system&#39;s ability to maintain the balance condition, which is all that really matters for this application.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6811"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/450" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/450" title="View user profile.">stuart</a> on Sun, 21/10/2012 - 19:32.</div>
    <div class="content">
     <p>But more of an effect if you try and mix reliable readings and the solar dump controller!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7218"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 13/11/2012 - 10:45.</div>
    <div class="content">
     <p>Using a spreadsheet, I&#39;ve been playing around with various ways that V &amp; I waveforms can be sampled and processed.&nbsp; I&#39;m not sure whether anything of particular use has been discovered along the way, but the various graphs may be of general interest.&nbsp; Each one is on a separate page/tab, so it&#39;s really easy to flick between the pages to see how things change.&nbsp; These exhibits may be of interest to anyone who is considering phase-angle control, or who wants to understand PHASECAL in a simple hands-on way.</p>
<p><a href="http://openenergymonitor.org/emon/sites/default/files/graphPic.jpg"><img alt="" height="225" src="http://openenergymonitor.org/emon/sites/default/files/graphPic.jpg" width="300" /></a></p>
<p>Sheet 1: 30 pairs of V&amp;I sample pairs per cycle, both taken at the same time.&nbsp; As expected, there is no residual drift at the end of the cycle, but there is some cumulative error as the cycle progresses.</p>
<p>	Sheet 2: As for sheet 1 but with only 15 sample pairs per cycle.&nbsp; As expected, there is more cumulative drift as the cycle progresses.</p>
<p>	Sheet 3: As for sheet 2, but with the the I sample taken first and delayed until the V sample is available.&nbsp; This is how the Arduino measures power.&nbsp; Note that there is now a residual drift at the end of the cycle.&nbsp; This is because the two waveforms have effectively been shifted in time.</p>
<p>	Sheet 3a: As for sheet 3, but with only half the amplitude of current.&nbsp; The residual drift at the end of the cycle is now halved.&nbsp; This shows that the drift is proportional to the amount of energy that is present, so could be compensated for by POWERCAL.&nbsp;</p>
<p>	Sheet 4: As for Sheet 3, with the I sample being taken and delayed until the V sample is taken.&nbsp; It is then multiplied by the average of the two most recent voltage samples.&nbsp; This is effectively applying a PHASECAL of 0.5.&nbsp; This re-aligns the two waveforms in time, but slightly reduces the amplitude of the voltage waveform.&nbsp; Note that there is no longer any cyclic wobble in the cumulative error curve, just the residual drift.</p>
<p>	Sheet 5: As for Sheet 3, but with a calculation being done as soon as a new sample is available.&nbsp; Each sample is now used twice.&nbsp; This causes the two waveforms to remain aligned in time, but causes havoc with the plotting facility.&nbsp; Note that the cyclical variation of cumulative error has stayed away.&nbsp; In this particular case, this simple technique has much the same effect as applying PHASECAL = 0.5.</p>
<p>	Sheet 6:&nbsp; As for Sheet 3, but with the current flow interrupted after 90 degrees.&nbsp; As expected, the large cumulative error remains.&nbsp; This would be Bad News if dumping power using phase-angle control.</p>
<p>	Sheet 7: As for Sheet 5, but with the current flow interrupted after 90 degrees.&nbsp; As expected, the small cumulative error remains.&nbsp; This would be a much better situation if dumping power using phase-angle control.</p>
<p>	Sheet 8:&nbsp; Back to 30 sample pairs per cycle (as per Sheet 1) but with a one loop phase shift (I is advanced w.r.t. V).&nbsp; We now see a negative residual drift because the Power Factor is less than unity.</p>
<p>	Sheet 9:&nbsp; As per Sheet 8, but with a PHASECAL of 2.&nbsp; This realign the waveforms perfectly in time but not in amplitude.&nbsp; Being outside the range of 0 to 1, POWERCAL introduces a positive gain.&nbsp; We now see a net positive residual drift because the distorting effect of PHASECAL more than compensates for the reduction in amplitude caused by the Power Factor being less than unity.</p>
<p>	Sheet 10:&nbsp; As for Sheet 1 but with a two-loop phase shift (I is advanced w.r.t. V).&nbsp; We now see a greater negative residual drift because the Power Factor is significantly less than unity.</p>
<p>	Sheet 11:&nbsp; Applying PHASECAL = 3 to realign the waveforms adds a large positive offset to the cumulative error.&nbsp; Note that the graph has changed scale.&nbsp; Although this additional gain can be compensated for by calibration, this is not a good way to treat the measured waveform.&nbsp; With a voltage waveform that is not sinusoidal, the distortion can look even worse.&nbsp;</p>
<p>	Sheet 12:&nbsp; The current waveform has the same amount of phase advance as in Sheer 10, but with only 15 sample pairs per cycle rather than 30.&nbsp; The cumulative error curve is similar to before but lumpier on account of the reduced resolution.&nbsp; The residual drift is still negative because the Power Factor is less than unity.</p>
<p>	Sheet 13: The current waveform still has a similar amount of phase advance, but each calculation is now done as soon as a new sample is available.&nbsp; This means that each sample is used twice, as per Sheet 5.&nbsp; The variation of the cumulative error curve within the cycle is noticably reduced, which can only be good.<br />
	&nbsp;&nbsp; Although the V and I graphs appear rather lumpy, this is just because of the way that have been plotted.&nbsp; Double-using each sample may well be a useful technique, especially if the correct amount of PHASECAL is not known or is not being applied.<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8912"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Sun, 06/01/2013 - 15:27.</div>
    <div class="content">
     <p>Hi, I&#39;m new to this forum and don&#39;t have the knowledge that you do but have a couple of questions as I&#39;m in the process of ordering everything.</p>
<p>The 9v supply for the CT - can that be taken from the voltage sensor supply via a suitable bridge rectifier and regulator.</p>
<p>I&#39;ve ordered the CT (SCT-0750-050). How do&nbsp;I determine the best burden resistor as your&nbsp;CT had none within it and&nbsp;I can&#39;t see any details on the resistor already&nbsp;fitted in the SCT-0750-050</p>
<p>I like the anti flicker video and the possibility it brings to operating other equipment that isn&#39;t just a heating element.</p>
<p>Many years ago&nbsp;I had a problem with a high frequency&nbsp;flicker in a house&nbsp;I lived in. It occurred&nbsp;about 6am in the &nbsp;morning and within a specific time frame. It was very fast and not noticeable to everyone but very annoying to me. It took a while for the DNO to realize there was a problem, having first just used some very basic equipment to monitor it, which i knew it wouldn&#39;t show on. To cut a long story short they couldn&#39;t find the problem in our small village but 6 months later they had the same problem in a much smaller village and the person investigating recognized&nbsp;a piece of&nbsp;equipment he recalled seeing at a house he&#39;d visited&nbsp;in our village and put two and two together. If&nbsp;I recall it was a Triac controlled Range and it&nbsp;turned out to be a manufacturing problem.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8927"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 07/01/2013 - 10:22.</div>
    <div class="content">
     <p>Hi, and thanks for giving this thread a nudge :)</p>
<p>The CT is entirely passive, so doesn&#39;t need any power supply as such.&nbsp; One of its ends is connected to a DC reference, that being a simple voltage divider across the Arduino&#39;s 5V rail.&nbsp; I always buffer that reference and then use it for both sensors.&nbsp; The standard approach is to have two separate (unbuffered) references.&nbsp; This is how the emonTx hardware is configured.&nbsp; Both approaches seem to go give very similar performance.</p>
<p>The burden resistor is a bit of a black art.&nbsp; I generally use whatever value gives around a 3 or 4 Volt swing with a 3kW load.&nbsp; This is undoubtedly using the CT outside its recommended range, but seems to give better results than when restricting it to the sub-1V range.&nbsp; Other contributers have successfully boosted the CT&#39;s output but my attempts did not appear to give any improvement so I&#39;ve not pursued this route.&nbsp;</p>
<p>I&#39;m pleased that you like the anti-flicker video.&nbsp; Personally, a bit of flicker doesn&#39;t bother me, but I appreciate that there are published standards which ought to me maintained, particularly if a power diversion system is being built for other than DIY use or is of a particularly high rating.&nbsp; The a/f algorithm is not mine as such, but I thought that it would be helpful for this feature to be included in my latest Mk2 version for completeness.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8930"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Mon, 07/01/2013 - 12:13.</div>
    <div class="content">
     <p>Hi, Thanks for the reply. sorry i should have made myself clearer. &nbsp;The 9V supply was in reference to what you had said earlier in the thread Quote:</p>
<p>&#39;The x3 buffer that I mentioned yesterday is essentially doing the same job as the pair that they&#39;re using.&nbsp; The first of their two buffers, however, seems unnecessary; it&#39;s not doing anything of use.&nbsp; The second one (in my case, x3) is fine by itself and does not load the CT at all.&nbsp; I&#39;ve used an LM358, with R2 = 68K, R1 = 33K as shown here .&nbsp; Unfortunately, to cover the full range of the Arduino&#39;s ADC,&nbsp; this device needs a supply voltage greater than 5V; I&#39;ve provided a +9V supply.&#39;</p>
<p>&nbsp;</p>
<p>This was what i was looking at doing but is it not worthwhile? If it is then i think I&#39;ve found the answer to&nbsp;my own question_ the 9v could come from the Vin pin.</p>
<p>&nbsp;</p>
<p>The flicker&nbsp;I experienced was very annoying, It was constant and really really fast,&nbsp;I don&#39;t know what frequency but some people could see it and some couldn&#39;t. I now suffer from optical migraines (weird, until you know what they are!) and&nbsp;I could imagine that experiencing that again would probably set one off.&nbsp;I cant imagine what load it must have been but it must have been very large.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8932"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 07/01/2013 - 12:43.</div>
    <div class="content">
     <p><em>&quot;The burden resistor is a bit of a black art.&quot;</em></p>
<p>No it isn&#39;t! A <em><u>current</u></em> transformer is the dual of the much more common voltage transformer. Therefore you overload it by asking for too much voltage out of it (by increasing the burden resistor value). And when you overload it, it saturates and distorts the waveform. Simple. It&#39;s just that the VA rating of the miniature c.t&#39;s that we use isn&#39;t published, so it has to be determined by measurement..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8933"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 07/01/2013 - 13:20.</div>
    <div class="content">
     <p>OK Robert, point taken.&nbsp; The black art comes into play when deciding how best to configure the input circuit so as to give best overall performance.&nbsp;</p>
<p>If possible, I would much prefer to operate my CT with a low-valued burden so that the voltage which is seen across that resistance is only small.&nbsp; However, this means that only a small fraction of the useful input range of the ADC is being used.&nbsp; Quantisation Distortion therefore becomes very significant at small levels of current.&nbsp; A higher value of burden is good for increasing the voltage swing but is no doubt bad for the CT&#39;s performance.</p>
<p>New Year&#39;s resolution - I must try to get the terminology right!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9299"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="rj017850&#039;s picture" title="rj017850&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by rj017850 (not verified) on Tue, 22/01/2013 - 19:05.</div>
    <div class="content">
     <p>The pressure resistor is a bit of a dark art. I usually use whatever value gives around a 3 or 4 Voltage move with a 3kW fill. This is certainly using the CT outside its suggested variety, but seems to provide better outcomes than when reducing it to the sub-1V variety. Other contributers have efficiently enhanced the CT&#39;s outcome but my efforts did not appear to provide any enhancement so I&#39;ve not followed this path. <a href="http://allbestserials.com/" rel="dofollow">all best serials</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9302"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 22/01/2013 - 20:24.</div>
    <div class="content">
     <p>If &quot;pressure resistor&quot; is another term for the &quot;burden&quot;, then I agree with your findings 100%.&nbsp; Welcome to the forum!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10188"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Thu, 28/02/2013 - 21:39.</div>
    <div class="content">
     <p>I&#39;m tempted to try running the CT into a virtual earth amplifier (using the other half of the 358).</p>
<p>This should keep the CT in totally in current mode as the amplifier will not allow any voltage to develop accross the transformer secondary and the feed back resistor in the amplifier will allow what ever voltage swing is needed to give the ADC optimum resolution.</p>
<p>Diagram attached. The theory is that an ideal amplifier will allow no voltage difference between + and - inputs and the output voltage will adjust to try and achieve this. So the current through the resistor must equal the current through the transformer secondary.&nbsp; so Vo = -I * R</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10195"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 28/02/2013 - 22:18.</div>
    <div class="content">
     <p>Are you going to follow it up with a driver circuit of some sort? The LM358 is only guaranteed to source 20 mA and sink 10 mA and that&#39;s with a 15 V supply.&nbsp; According to me, that&#39;s not 15 A of primary current. And you might need to beef up your power supply too.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10202"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Fri, 01/03/2013 - 09:55.</div>
    <div class="content">
     <p>I don&#39;t see the need. The coil shown is the secondary of a standard current transformer that Robin&#39;s design already uses.</p>
<p>I&#39;m not sure of the turns ratio but we are talking of a few mA in the secondary for 15A on the primary so the LM358 is perfectly adequate.</p>
<p>&nbsp;</p>
<p>Bob</p>
<p>&nbsp;</p>
<p>PS I did not get an email prompt about the reply. Does that need to be set up somewhere please?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10203"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 01/03/2013 - 10:36.</div>
    <div class="content">
     <p>When a thread to which I have already contributed is updated, I don&#39;t get an email prompt, but the number of &quot;new&quot; contributions is shown at the top of my &quot;Track&quot; view.&nbsp; If I am sent a PM, I also get an email.&nbsp; This arrangement works fine for me so I&#39;ve never tried to change it.</p>
<p>I like the idea of keeping the CT in current-only mode and hope to try out your suggestion soon.&nbsp; My main rig still uses its original breadboard with half of the Vref op amp unused, so it should be easy enough to make this change.&nbsp; Whether it will ever work again is another matter ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10206"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Fri, 01/03/2013 - 14:04.</div>
    <div class="content">
     <p>Thanks Robin,</p>
<p>&nbsp;</p>
<p>When you try it out, don&#39;t for get the phase inversion in the circuit. Possibly easiest to change the direction of the transformer on the incomer.</p>
<p>I suppose the best way to test the effect is to impose a load of 10-15amps and then run phasecal before and after the change.</p>
<p>&nbsp;</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10208"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1775" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1775.jpg" alt="Brian D&#039;s picture" title="Brian D&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1775" title="View user profile.">Brian D</a> on Fri, 01/03/2013 - 16:53.</div>
    <div class="content">
     <p>The I to V circuit that 9fingers has suggested looks like an excellent idea to me but the LM358 is output swing limited so is not a good choice of device. Something like the TS912N is pin compatible and is rail-to-rail.</p>
<p>A good article on I to V can be seen <a href="http://en.wikipedia.org/wiki/Current-to-voltage_converter">here</a>. One problem I can think of is that the cheap jack plugs and sockets can momentarily go open circuit sometimes and that will probably kiss your front end goodbye. Some protection diodes inside the CT should be enough to fix this.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10212"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Fri, 01/03/2013 - 21:14.</div>
    <div class="content">
     <p>Both very valid points Brian. I have to put my hand up to initially discussing the use of a VE amplifier as a concept and then thought maybe not everyone would know about such things and a quick diagram would help.</p>
<p>&nbsp;</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10214"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 01/03/2013 - 21:20.</div>
    <div class="content">
     <p>My first dabble with the new CT connection scheme did not give promising results, not sure why.&nbsp; Hope to have another go tomorrow.&nbsp;</p>
<p>I was using a feedback resistor of 220R, but have no idea whether that&#39;s a sensible value for this circuit.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10218"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Fri, 01/03/2013 - 21:58.</div>
    <div class="content">
     <p>Typically the resistor would be the same as the burden resistor and if the original burden is inside the CT, this needs to be removed. Also bear in mind Brian&#39;s comments.</p>
<p>Back to back diodes in the CT in place of the burden resistor for protection and an op amp suitable for rail to rail output.</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10222"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 02/03/2013 - 09:38.</div>
    <div class="content">
     <p>As the purpose of the op amp is to maintain both ends of the CT&#39;s output at the same potential, would there be any harm in leaving an internal burden in place?&nbsp; It would only come into play when the op amp ran out of steam, which may be no bad thing.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10229"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Sat, 02/03/2013 - 12:33.</div>
    <div class="content">
     <p>Good point Robin.</p>
<p>Bob</p>
<p>Memo to self: Think about things a little deeper before posting - it might save some of those red face moments I&#39;ve been getting recently.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10232"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 02/03/2013 - 13:46.</div>
    <div class="content">
     <p><em>Think about things a little deeper before posting - it might save some of those red face moments I&#39;ve been getting recently.</em></p>
<p>No problem, I&#39;m sure we&#39;ve all had that feeling.&nbsp;</p>
<p>Some years ago, the Open University had an email feature whereby you could &#39;unsend&#39; any message that you&#39;d had second thoughts about.&nbsp; A brilliant idea.&nbsp; Unfortunately, it was less easy to get people to &#39;unread&#39; what you had just unsent!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13633"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="girishgrao&#039;s picture" title="girishgrao&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by girishgrao (not verified) on Mon, 15/07/2013 - 20:34.</div>
    <div class="content">
     <p>Hi</p>
<p>I have read with much interest all the research and development you have done on this project.&nbsp; These posts seem to be about an year old and I wonder if you are still pursuing this project further.</p>
<p>Just wanted to ask if you have considered the following:</p>
<p>1. Use a standard metering IC from a supplier like Analog Devices.&nbsp; A single phase metering IC with an SPI interface to a microcontroller would solve all your problems of measuring accuracy.&nbsp; It would also give you the active power reading straightaway.&nbsp; The MCU then only has to do some logical comparisons and operate the Triac suitably.</p>
<p>2. Use a standard toroidal metering CT rather than a clamp CT.&nbsp; These CTs are now available for GBP 2-3 for small qtys and would have very high accuracy over a wide range of currents.</p>
<p>3. In your earlier posts, you mentioned about a unit costing around &pound; 70 to control the heater ckt.&nbsp; What is this unit and what does it do.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 15/07/2013 - 23:07.</div>
    <div class="content">
     <p>Robin is away at present and will no doubt respond fully on his return.</p>
<p>It is not quite so simple as your first point suggests. The voltage signal is required to time the initiation of the zero crossing trigger, and this is notably absent in some of the dedicated i.c&#39;s.</p>
<p>In answer to your 2nd point, a ring core c.t. is not generally viable in the UK as the connections between the incomer and the consumer&#39;s main switch are sealed by the supply authority, therefore fitting a ring core c.t. would be unattractive to most constructors.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13736"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASECAL and Serial Statements</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 21/07/2013 - 15:12.</div>
    <div class="content">
     <p>Thanks, Robert, for your reply.&nbsp;</p>
<p>I don&#39;t think there&#39;s anything I can add to points 1 and 2 expect to say that, for the purpose of calculating real power, the effect of phase shift between the V and I waveforms makes very little effect.&nbsp; I have long since given up worrying about this.&nbsp; All my recent builds have had phaseCal = 1 and appear to work fine with no appreciable error.&nbsp;</p>
<p>The biggest source of error that I&#39;m aware of is the tendency of the system to drift by up to a Watt in one direction of the other (or neither) when zero current is present at the CT.&nbsp; This effect can occur when the CT&#39;s mid-point lies close to one of the ADC&#39;s decision points, which can cause tiny amounts of noise to be amplified.&nbsp; In a real system, however, I do not believe that this effect would cause any problem.&nbsp; For one thing, most digital meters require at least 10 Watts to flow before user consumption is registered.&nbsp; For another, the net current at the supply point for a domestic premises is unlikely to be exactly zero (or constant) for any appreciable amount of time.</p>
<p>As for point 3, that would have been a Carlo Gavazzi power controller (<a href="http://www.datasheetdir.com/RJ1P23V30E+Solid-State-Relays">RJ1P23V30E</a>) that I used before devising the triac-based approach.&nbsp; Although that unit could be instructed to vary the power to my immersion in various ways (phase-angle and several burst-mode options), its performance was less than ideal because of various limiting factors.&nbsp; My Mk2 logic, in which the measurement and control logic operate continuously and are fully integrated, is a much better arrangement, IMHO.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/870"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-UzIYCOWxNuhgJvCrEpZV5PaIVK-WQ3XfbXqG91aHIzc" value="form-UzIYCOWxNuhgJvCrEpZV5PaIVK-WQ3XfbXqG91aHIzc"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>

</html>
