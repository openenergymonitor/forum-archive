<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11062 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:55:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonTH Unreliable reading timing? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonTH Unreliable reading timing?</h3>
        <span class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Thu, 30/07/2015 - 17:27</span>
        <div class="content"><p>I have just taken delivery of two new EmonTH with the DHT22 inside but the input on my Raspberry Pi (preloaded sd card) isn&#39;t receiving new data every 60 seconds as in the specs of the TH.</p>
<p>Infact, sometimes I get no new data for 10 minutes on 1, 2 minutes on the other, sometimes 60 seconds.... It seems completely random from both of them.</p>
<p>Is there a reason for this? I have put them in the same room as the pi to rule out range, but I am still experiencing random behaviour.</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12210.html" class="topic-previous" title="Go to previous forum topic">‹ kWh have reset to 0</a>
              <a href="12193.html" class="topic-next" title="Go to next forum topic">Vrms incorrect ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-32821"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 30/07/2015 - 18:02.</div>
    <div class="content">
     <p>Are they both transmitting at the same time and blocking one another? Is there another (unrelated) transmitter on the same band nearby that's causing interference that's blocking them? </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32823"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Thu, 30/07/2015 - 18:43.</div>
    <div class="content">
     <p>How would I tell if they are transmitting at the same time?</p>
<p>They both have different node ID&#39;s as well. The only other 433 transmitter is the emonTX.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32826"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Thu, 30/07/2015 - 20:19.</div>
    <div class="content">
     <p>Plenty of this in the logs:</p>
<p>&nbsp;</p>
<p>
2015-07-30 20:16:11,493 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 0 2 80 95 2 104 120 190 228 208 90 166 71 107 147 49 87 38 60 144 46 (-98) 2015-07-30 20:16:13,012 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 184 47 23 190 235 216 145 18 65 228 11 203 158 131 3 147 186 179 38 56 72 (-101) 2015-07-30 20:16:15,440 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 42 8 111 65 240 61 60 132 5 28 55 169 82 153 203 60 17 11 4 182 83 (-98)<br />
&nbsp;</p>
<p>I am sat here with the serial shell open and emoncms (on the pi) watching it take a read, then emoncms miss it...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32827"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 30/07/2015 - 21:07.</div>
    <div class="content">
     <p>All three (emonTx, 2 &times; emonTH) use the same band and frequency, the Group and Node numbers only work in the software while or after the message is being or has been decoded. So it's quite possible, but unlikely, that all 3 are blocking each other all of the time.</p>
<p>Paul (pb66) is the emonHub expert, hopefully he'll pick this up.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32829"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Thu, 30/07/2015 - 21:50.</div>
    <div class="content">
     <p>Thanks Robert,</p>
<p>I was wondering if interference from a third party device was causing this so I went around the office and turned everything wireless off. Still got the same result (lots of &#39;unreliable content&#39; messages in the log and missing readings). So I took it all home with me and sure enough, here now, with just the single emonTH and the pi hub, its still the same.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32838"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 30/07/2015 - 23:21.</div>
    <div class="content">
     <p>The &quot;Discarding RX frame &#39;unreliable content&#39; &quot; message will occur for any frames prefixed with a &quot; ? &quot; as that is the JeeLibs&nbsp;way of denoting a bad packet, looking at those packets the RSSI&nbsp;is very low -98dB&nbsp;and -100dB, that is just noise or some&nbsp;interference in the distance.&nbsp;</p>
<p>Your local devices should clear that by at least 20dB&nbsp;min (-80)&nbsp;but if in the same room you could be looking at -20dB or better.</p>
<p>In emonhub.conf [{RFM2Pi]][[[runtimesettings]]] setting <strong>quiet = true</strong>&nbsp;will command the RFM2Pi module to not report&nbsp;bad packets.&nbsp;</p>
<p>The group id is actually used as part of the initial crc check so check you are using a consistent group id, 210 is the OEM default and the rfm2pi. emonTx and emonTH would have been pre set to 210 as should emonHub.</p>
<p><strong>tail -f /var/log/emonhub/emonhub.log&nbsp;</strong>will be a better way of monitoring&nbsp;the packets passing through emonHub and you may even find it helpful to temporarily reduce the interval on a emonTH&nbsp;while debugging (by uploading a sketch with shorter interval) and powering via the usb programmer (saves battery with the increased frequency and may also give a small voltage boost over battery op)</p>
<p>A crude way of syncing the emonTH&#39;s&nbsp;is to insert&nbsp;the batteries in one, wait 30s&nbsp;and fit the batteries in the second, in theory they should tx alternately each 30s&nbsp;but this will probably slip over time.</p>
<p>They are not normally troublesome so I&#39;m also interested to find out the cause.&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32841"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 30/07/2015 - 23:50.</div>
    <div class="content">
     <p>Hopefully a silly question - are all the RFM69CW modules the 433 MHz variety? There is a Building Blocks page on identifying which is which.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32844"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 06:15.</div>
    <div class="content">
     <p>Ok, I did notice the -99dB as well which made me think it is just background noise. However, when I changed to quiet mode &nbsp;= true in the emonhub.conf (through the gui) it still reported all the unreliable frames?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32848"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 08:44.</div>
    <div class="content">
     <p>Ok, so some further troubleshooting and i think i have spotted something. I have increased the read interval on the TH to 0.1 minutes (so 6 seconds). The sensor is about 2 ft away from the RPi and this is the hub log, note the discarded frames with a similar signal strength to the good frames, could this be our failing packets?</p>
<p>
I have attached an excerpt of the log, the high signal strength discarded packet seems to happen every couple of readings.</p>
<p>&nbsp;</p>
<p>Here is a comparison of some good and bad frames in no particular order:</p>
<p>2015-07-31 08:12:32,461 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 19 225 0 0 0 1 32 0 135 (-36)<br />
2015-07-31 08:12:34,472 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 20 243 0 0 0 112 0 0 152 (-29)<br />
2015-07-31 08:12:36,884 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 20 243 0 0 0 112 0 0 152 (-27)<br />
2015-07-31 08:12:37,189 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 1056 NEW FRAME : OK 19 225 0 0 0 144 1 32 0 (-36)<br />
2015-07-31 08:14:44,522 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 20 238 0 0 0 128 0 0 107 (-31)<br />
2015-07-31 08:16:16,224 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 1164 NEW FRAME : OK 19 225 0 0 0 146 1 32 0 (-40)<br />
2015-07-31 08:16:13,844 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 1162 NEW FRAME : OK 19 225 0 0 0 146 1 32 0 (-39)<br />
2015-07-31 08:16:56,996 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 1187 NEW FRAME : OK 20 236 0 0 0 121 1 0 0 (-27)</p>
<p>
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32849"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 31/07/2015 - 09:06.</div>
    <div class="content">
     <p>Could you try adding a line to the emonTH sketch to eliminate or&nbsp;confirm a possible bit sync issue&nbsp;caused by the string of zero values?</p>
<p>Adding &quot;&nbsp;<strong>emonth.temp_external=3010</strong> &nbsp;&quot; <a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L282">at line 282 after the battery voltage reading</a> should to the trick and&nbsp;hardcode a value of 301&deg;c.</p>
<p>Are you currently running of the usb programmer or batteries?</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32850"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 09:19.</div>
    <div class="content">
     <p>I will do that now. I was running off the USB programmer, then batteries again if you noticed a strange voltage reading.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 09:36.</div>
    <div class="content">
     <p>Done, but still getting plenty of these:</p>
<p>
2015-07-31 09:25:22,540 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 19 233 0 194 11 145 1 0 43 (-27) 2015-07-31 09:25:24,855 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 19 233 0 194 11 145 1 0 43 (-31)<br />
&nbsp;</p>
<p>Attached is a chunk of log.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32852"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 31/07/2015 - 09:57.</div>
    <div class="content">
     <p>To get a better look at the raw data stream from the serial port we should try using a serial console, are you familiar with Minicom? (I hope so it&#39;s not the most user friendly SW), I&nbsp;believe it is included on that SDcard image.</p>
<p>You can&nbsp;stop emonHub with <strong>sudo service emonhub stop&nbsp;</strong>to give minicom exclusive serial port access/control.</p>
<p>can you then provide a longer log from which it should be easier to spot patterns?</p>
<p>sending &quot;1q&quot; or &quot;0q&quot; should enable/disable quite mode and when you do either should get a &quot;currrent configuration&quot; from which you should see the node (15i) group (210g) frequency (@433MHz) and if quite mode is enabled &quot;1q&quot;.</p>
<p>I did think the battery voltage of 0.3v was odd and wondered if the results&nbsp;seen where battery or programmer powered.</p>
<p>For the moment I would recommend working with one device to avoid any collisions or confusion, and use the usb lead power (if possible) to give us the best shot of debugging, Although several battery feed devices should work fine in service, debugging can be simpler by eliminating the &quot;other&quot; possible influences, like range etc, you only need one irrelivent result from &quot;another&quot; influence to throwout and mask a pattern.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32854"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 10:26.</div>
    <div class="content">
     <p>Attached is an output of minicom for you. Just to note that I have changed the group ID to 212 on both the Pi and the TH as a troubleshooting step yesterday.</p>
<p>It looks like it is receiving a series of frames from node 19 (the TH) but only 1 in a few is OK.</p>
<p>&nbsp;</p>
<p>EDIT: Attached a bigger dump of output as well.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32855"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 31/07/2015 - 10:41.</div>
    <div class="content">
     <p>I haven&#39;t looked at the second one yey but there is definitely a pattern there, I&#39;m just not sure of the cause yet.</p>
<p><img alt="" src="../sites/default/files/emonthminicom_0.png" style="width: 400px; height: 477px;" /></p>
<p>The red lines are too long and too weak so can be excluded. The green&nbsp;are good and the orange should be good, notice the pattern of 1&#39;s and 4&#39;s, that follow the pass/fail rate 100%, too much of a coincidence to not be related.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32856"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 11:27.</div>
    <div class="content">
     <p>Ok, I have no idea what to look for from here, so hopefully you can spot something.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32859"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 31/07/2015 - 12:46.</div>
    <div class="content">
     <p>At the moment I do not know the root cause, the logs suggest a byte is being dropped but that seems very odd,&nbsp;</p>
<p>2 things I would do is a update the rfm2pi firmware to be 100% sure the latest is being used and add a serial print of the emonth typedef struct&nbsp;Payload, the current &quot;debug&quot; prints will output real values and require some decoding/encoding to compare with the RFM2Pi&nbsp;serial stream.</p>
<p>Although on reflection I think the issue must be &quot;in the air&quot; or in the rfm2pi firmware/jeelib, because if the emonTh&nbsp;was sending incorrect data the RFM2Pi wouldn&#39;t know that is was wrong as it would pass the crc checks, so I think the RFM2Pi firmware should be updated before we go any further.</p>
<p>This is done directly via the Pi. see the <a href="http://wiki.openenergymonitor.org/index.php/RFM69Pi_V3">rfm2pi wiki for a how to guide</a>&nbsp; and you can use <a href="https://github.com/openenergymonitor/RFM2Pi/blob/master/firmware/RFM69CW_RF_Demo_ATmega328/V13_RFM69CW_RF12_Demo_ATmega328.cpp.hex">this updated firmware hex file</a>&nbsp;it was recently compiled in an attempt&nbsp;to resolve a different issue so I know it&#39;s up&nbsp;to date.</p>
<p>I will give it some more thought and perhaps someone else may spot something</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32861"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 14:48.</div>
    <div class="content">
     <p>Hi Paul, ok done that, firmware updated and attached is an output of minicom. It looks like it is discarding frames a lot less, but I can still see some there.</p>
<p>EDIT:</p>
<p>After watching minicom for quite some time, its doing exactly the same thing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32864"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 31/07/2015 - 15:00.</div>
    <div class="content">
     <p>It would seem either I&#39;m missing something really basic or real can of worms has been opened here!!</p>
<p>I looked a&nbsp;little closer at the raw serial output of&nbsp;an emonTH&nbsp;I have that has not been performing well (dropping packets) and I assumed traffic issues. Turns out it is doing EXACTLY the same byte 5 is missing on many packets.</p>
<p>I can now confirm it is byte 5 &quot;missing&quot; and not a corrupt or out of sync bit count. When I could see the same pattern I added 2 more default values to the emonTH sketch so I have&nbsp;a valid temperture followed by 3 hardcoded&nbsp;value of 3010 to represent ext_temp, humidity and battery. Around half the time I get the expected output and the rest of the time the second 194 (byte 5, the lsb of integer&nbsp;3030) has been dropped and the frame is rejected by crc</p>
<p>OK 19 220 0 194 11 194 11 194 11 (-32)&nbsp;<br />
OK 19 220 0 194 11 194 11 194 11 (-35)&nbsp;<br />
&nbsp;? 19 220 0 194 <strong>11 11 </strong>194 11 215 (-33)&nbsp;<br />
&nbsp;? 19 220 0 194 <strong>11 11</strong> 194 11 215 (-31)&nbsp;</p>
<p>I have tried the latest RFM2Pi&nbsp;firmware and an&nbsp;earlier version. I have also tried the latest&nbsp;RFdemo.12 from JeeLib and an older one I found&nbsp;on my hdd. I have not tried back dating my JeeLib&nbsp;library and recompiling &nbsp;yet.</p>
<p>Any ideas ? anyone ? am I missing something daft?&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32865"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 15:16.</div>
    <div class="content">
     <p>Well im glad that when I identify a problem, its a good one... ha ha ha</p>
<p>If i can be of assistance, let me know but you&#39;re now beyond me, Im only an IT DC Infrastructure guy! Pretty new to all this microcontroller fun.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32869"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 31/07/2015 - 16:34.</div>
    <div class="content">
     <p>What sort of emonTH does everybody have? Mine is a RF&mu;328 / RFM12B version (1.4). I can give that a try later.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32870"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 31/07/2015 - 16:42.</div>
    <div class="content">
     <p>Mines the newer type and I uploaded the 1.5.1 sketch.&nbsp;RFM69CW</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32871"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 31/07/2015 - 17:14.</div>
    <div class="content">
     <p>Mine is a late (non-RFu)&nbsp;v1.5 RFM69CW&nbsp;emonTH with the latest&nbsp;V1.5.1 firmware too.</p>
<p>I have looked through a significant amount of logging now, and my emonTx&#39;s&nbsp;do not do it, the emonTH does it all the time, alot!</p>
<p>Although I&#39;m drawn to the RF12demo/RFM2Pi sketch because its failing the CRC the fact it seems to be consistant with the new emonTH&nbsp;and not occur with other devices makes me think otherwise, this is also possibly why it&#39;s only just coming to light, the emonTH has only been around a few months.</p>
<p>Is it possible for the packet to get altered (drop a byte)&nbsp;after the crc is decided but before it is sent?&nbsp;</p>
<p>My findings show of 2500 frames of which 900+ where obvious&nbsp;interference and weak signals etc the remaining ~1360 had ~400 emonTx frames which included&nbsp;a few &quot;bad&quot; packets&nbsp;none of which showed any sign of a missing byte,&nbsp;</p>
<p>Where as of 925 emonTH frames&nbsp;&nbsp;250 were &quot;bad&quot; all of which had a byte missing, predominantly the 5th (~240 of 250) but the other 10&nbsp;had either the 4th or the 6th byte missing. very bizzarre&nbsp;but also very consistent.</p>
<p>The attached log is of ~925 emonTH packets sorted so failed are 1st followed by the passed packets.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32874"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 31/07/2015 - 20:50.</div>
    <div class="content">
     <p>Would it be worth trying the non-JeeLib low level calls, taken from the emonTx V3.4 3-phase sketch, to send the data?</p>
<p>Like JeeLib, that works fine for the emonTx V3, and at least you can see exactly what's going on. I've not got a RFM69 emonTH so I can't test it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32883"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 01/08/2015 - 10:07.</div>
    <div class="content">
     <p>I did scout around for an alternative sketch to try&nbsp;on the emonTH&nbsp;but there seems to only be one &quot;RFM69&quot; sketch.</p>
<p>I will look at the low level code option, it sounds sensible I&#39;m just not sure my coding is up to it. which ever method I try it&#39;s going to get quite involved I guess and to be honest this may need to wait a&nbsp;bit as I&#39;m already spreading my time too thinly, I certainly won&#39;t get near it over the weekend.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32887"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 01/08/2015 - 12:03.</div>
    <div class="content">
     <p>The code is essentially a stripped-down version of the transmit code used by JeeLib (except for a small section borrowed from MartinR). Here are the pertinent lines &amp; functions - I think! I can&#39;t test this, so it&#39;s quite possible I&#39;ve missed something. It should be fairly easy to slot in.<br />
&nbsp;<br />
Note the maximum useful payload is <strong>60 bytes</strong> - JeeLabs are aware of this, I don&#39;t know if they&#39;ve found the cause, but it fails if this is exceeded.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32888"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Sat, 01/08/2015 - 12:26.</div>
    <div class="content">
     <p>What actually is the 5th byte? I was playing around uploading to emoncms and noticed an extra value come into my inputs that Im not expecting in my hub config.</p>
<p>Screenshots attached. You can see in my emonhub config I am naming 4 values, and 4 values is what I get in the nodes section of the local emon on the pi. However when posting out to emoncms.org I have that 5th value coming in.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32889"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 01/08/2015 - 12:39.</div>
    <div class="content">
     <p>Robert - I may just create a test sketch by adding a fixed payload that mimics the emonTH in size to the low-level stuff you have written&nbsp;and try that on both a emonTx and emonTH, then go from there.</p>
<p>Tom -&nbsp;The 5th <em>value</em> you see is the RSSI, the signal strength as a negative dB value is added automatically if you are using a rfm69 based receiver. It is the bracketed value on the end of each packet seen in minicom.</p>
<p>When I refer to the 5th <em>byte</em> I&#39;m referring to the 5th of 8 byte&nbsp;values&nbsp;that make up the data string. The packet seen in minicom is of the format &quot;OK&quot; or &quot; ?&quot; to signify valid or not, the first value after that is the node id the rest is data up to the RSSI. 8&nbsp;&quot;byte&quot; values of 0-255 are expected 4 integers.</p>
<p>&nbsp;Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32890"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 01/08/2015 - 13:02.</div>
    <div class="content">
     <p>I don't know what this is worth, but I've been running my rf&mu; emonTH for some hours now. While there are many missing readings (27 in about 10 hours - and there's no pattern nor regularity visible) there isn't a single "Discarding" in the log.</p>
<p>(I'm not sure what version of emonHub I've got here though - emonhub.py is dated May 8.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32892"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 01/08/2015 - 13:09.</div>
    <div class="content">
     <p>Paul,</p>
<p>If you do as you suggest, and there's no problem (because there's nothing in those code snips to put anything to sleep), I'd be looking at how the 328 and the RFM69 are put to sleep and wake up again - this problem has the smell of a timing/power-up race issue about it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32893"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 01/08/2015 - 13:39.</div>
    <div class="content">
     <p>Although I&#39;m not currently on this (just, taking a teabreak from catching up on the&nbsp;gardening) my current &quot;feeling&quot; is that it most probably definitely&nbsp; maybe the sketch, as the emonTH is just a &quot;arduino&quot; type device with a rfm69&nbsp;attached,&nbsp;at the and of the day, it shouldn&#39;t perform any different to an emonTx&nbsp;etc, but that is just a feeling!</p>
<p>27 in 10 hrs at 60per&nbsp;hour (assuming default settings) is less than 5% and possibly in line with the (uncounted) packets I deleted from the logs that were obviously wrong, genuinely corrupted or incomplete packets. The &quot;pattern&quot; was easily spotted and I have just focused on those for now.</p>
<p>5% is probably considered&nbsp;acceptable, although I prefer the terms expected or tolerated :-)</p>
<p>pre &quot;emon-pi&quot; or &quot;original&quot; emonHub&nbsp;versions have not altered much at all, so you should be good, besides this issue is very much before emonHub gets the data.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32894"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Sat, 01/08/2015 - 13:42.</div>
    <div class="content">
     <p>So are we leaning towards a potential sleep issue in the TH sketch?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32897"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Sat, 01/08/2015 - 16:22.</div>
    <div class="content">
     <p>The error pattern(s) shown above can happen if the byte-level Tx buffer handling is temporarily stalling&nbsp; - the buffer underrun will have the effect of putting the last correct byte on the air twice.</p>
<p>Something odd happening in the interrupt world?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32899"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 01/08/2015 - 16:34.</div>
    <div class="content">
     <p>Could be...</p>
<p>That I don&#39;t see it with an RF&amp;mu; emonTH does tend to suggest that it&#39;s tied in with JeeLib and the RFM69.</p>
<p>I&#39;ve got no proof that it is a sleep problem, it&#39;s just that weird things like this tend to be a consequence of timing problems, and those could be sleep-related. A lot of things are turned off in the sketch to save battery current, and I&#39;d be looking at the order in which they come back, and how long each requires to stabilise - stuff like that. But as most (if not all) of that is common to the &#39;69 and the RF&mu; versions, it&#39;s not that <em>per se</em>, but more likely a secondary effect.</p>
<p>It could be a power supply problem, because at the default max power, the RFM69 draws a big chunk of current, which might just be screwing something up. (The LL code: it&#39;s only &nbsp;matter of changing one register value to set the power, and it&#39;s commented.)</p>
<p>Here&#39;s the &quot;pattern&quot; of my missing data&nbsp;- I can&#39;t see a pattern, it looks pretty random to me.<img alt="" src="../sites/default/files/Selection_090.png" /></p>
<p>Recording started at 02:15 and stopped at 11:55.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32900"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 01/08/2015 - 17:27.</div>
    <div class="content">
     <p><em>&quot; &nbsp;...will have the effect of putting the last correct byte on the air twice&quot;</em></p>
<p>I think we are losing a byte rather than gaining(duplicating)&nbsp;a byte because there is 3 sets of &quot;194 11&quot; expected but when ever there are consecutive 11&#39;s (or occasionally 194&#39;s) there is an &#39;unknown&#39; value tagged on the end before the RSSI, if we were gaining a value every packet would end on 194 rather than the expected 11.&nbsp;This can be easily&nbsp;proven by changing the 2nd and 3rd hardcoded integers.</p>
<p>I have not seen any pattern in the occurrence either, that seems random and the number affected can vary too. The numbers I supplied above show around ~20% invalid with the same &quot;byte missing&quot; characteristics&nbsp;but the first short run I did there were slightly more invalid than valid ie on the wrong side of 50% invalid.</p>
<p>It has since dawned on me I am comparing the success rate against rfm12&nbsp;emonTx&#39;s&nbsp;running variants of&nbsp;MartinR&#39;s&nbsp;sketch which doesn&#39;t use JeeLib,. not that I think that&#39;s relative, but it&#39;s clear I need to do some more tests with other sketches on both a rfm69 emonTx&nbsp;v3.4&nbsp;and emonTH.1.5 for a better picture.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32901"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 01/08/2015 - 17:35.</div>
    <div class="content">
     <p><em>&quot;It could be a power supply problem&quot;&nbsp;</em>hopefully we ruled that out by powering via a usb programmer, but I will confirm further with a good 5v supply.</p>
<p>Does the emonTx discrete sampling sketch use the same sleep regime&nbsp;? Is it worth sticking some batteries in a emonTx v3.4&nbsp;and not connecting an AC/AC supply to see how it copes ?&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 01/08/2015 - 20:16.</div>
    <div class="content">
     <p><em>&quot;Does the emonTx discrete sampling sketch use the same sleep regime&nbsp;? &quot;</em></p>
<p>Broadly, yes, but I can see that&nbsp;the TH does some additional things - hence the finger pointed in that direction. I think batteries in an emonTx would not help, because I know it can fall over when&nbsp;on the ac supply if the RFM69 is run at full power and the supply is only a little&nbsp;below the UK nominal voltage. And when that happens,&nbsp;it goes through a complete reset sequence. I haven&#39;t tried it when sending to an emonPi to see exactly what is logged, but I&#39;d have thought that the transmission would be abruptly truncated, and the subsequent reset would have showed up there.</p>
<p><em>&quot;I am comparing the success rate against rfm12&nbsp;emonTx&#39;s&nbsp;running variants of&nbsp;MartinR&#39;s&nbsp;sketch which doesn&#39;t use JeeLib&quot;</em></p>
<p>The part of my LL function that handles the passing of the data into the TX register&nbsp;(i.e. the part where a byte might get lost!)<span style="line-height: 20.7999992370605px;">&nbsp;is&nbsp;</span>MartinR&#39;s<span style="line-height: 20.7999992370605px;">&nbsp;logic</span><span style="line-height: 1.6;">, </span><span style="line-height: 1.6;">everyth</span><span style="line-height: 1.6;">ing</span><span style="line-height: 1.6;"> surrounding that small part</span><span style="line-height: 1.6;"> is essentially </span>JeeLib<span style="line-height: 1.6;"> - without all the options.&nbsp;So it might be relevant</span><span style="line-height: 1.6;">&nbsp;after all?</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32925"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 02/08/2015 - 18:21.</div>
    <div class="content">
     <p>I think I&#39;ve got to the bottom of this now.</p>
<p>The issue seems to be that the rfm69 needs a bit of time to wake up, by inserting a 0.1 sec delay ( <strong>dodelay(100);</strong> )&nbsp;immediately after the <a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L312">rf12_sleep(RF12_WAKEUP); on line312</a>&nbsp;I&nbsp;no longer get any bytes dropped even running at a 2 sec interval.</p>
<p>A 2 sec interval is the result of reducing the interval&nbsp;to &quot;0.1 minutes&quot;, the &quot;<strong>const int</strong> time_between_readings&nbsp;= 0.1&quot; will not provide the desired 6secs, it&nbsp;has basically created a zero delay and only the hardcoded&nbsp;2sec&nbsp;wait for the DHT22 and a 100ms&nbsp;pause has provided an interval of 2.1s.</p>
<p>So&nbsp;I replaced that <a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L323-L330">whole block L323 - L330</a> with <strong>dodelay(time_between_readings); </strong>since it replicates the <a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L333-L344">dodelay()&nbsp;function immediately below it</a>&nbsp;and set&nbsp;time_between_readings = 3800&nbsp;(2.2s + an additional 3.8s = 6s),</p>
<p>This can be returned to a <a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L326">calculation from minutes</a> but IMO&nbsp;seconds would be more appropriate and it should also&nbsp;be calculated just once at compile time using a define rather than in every loop, it should factor&nbsp;in the 2.2sec too, so the user gets the interval defined.</p>
<p>Tom - could you test this please, you should be able&nbsp;to use a stock sketch with the one delay line added after the wake-up.</p>
<p>If this fixes the issue I will tidy it up and submit a pull request.</p>
<p>Robert - I&#39;m not entirely sure what I did wrong with the code you supplied, I added the absolute minimum to test and it made a very effective &quot;jammer&quot; completely wiping out all my device traffic the whole time it was powered, I didn&#39;t try debugging but&nbsp;I have attached a copy for your perusal/amusement&nbsp;:-)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32928"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 02/08/2015 - 19:59.</div>
    <div class="content">
     <p>I have left this ticking over for a while and just checked the results, of ~1600 emonTH packets 11 were invalid and all of them were obviously invalid, none had any common values or were of a similar length.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32933"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 02/08/2015 - 20:19.</div>
    <div class="content">
     <p>Paul,</p>
<p>There was from me no delay in loop( ) so transmission would have been practically continuous, so a very thorough jamming of the band was to be expected. But 6 seconds should have been enough. &nbsp;I don&#39;t quite see why it hung on (if indeed it did). &nbsp;What hardware was it on?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32944"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Sun, 02/08/2015 - 23:32.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>I will update the sketch on my two TH&#39;s first thing in the morning when I get to the office and let you know how it goes.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32955"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Mon, 03/08/2015 - 10:19.</div>
    <div class="content">
     <p>Ok, I am running the sketch with the delay line in, at 2.1sec intervals and am capturing a minicom&nbsp;session. I will look at it after a while and post it up here as well.</p>
<p>EDIT: Attached is my minicom output. From my quick analysis it looks good now, much much much better.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32957"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Mon, 03/08/2015 - 13:10.</div>
    <div class="content">
     <p>Had it back on 1 min intervals now for a few hours and it seems to be working fine.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32962"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 03/08/2015 - 15:49.</div>
    <div class="content">
     <p>excellent!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32992"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Sun, 09/08/2015 - 14:05.</div>
    <div class="content">
     <p>Hmm,&nbsp; the gross packet incorrect filling has certainly gone away, but I&#39;m puzzled by the following sorted minicom extract:</p>
<p>OK 19 235 0 0 0 253 1 2 0 (-28)<br />
OK 19 235 0 0 0 2 2 2 0 (-28)<br />
OK 19 235 0 0 0 2 2 2 0 (-32)<br />
OK 19 235 0 0 0 2 2 2 0 (-28)<br />
OK 19 235 0 0 0 3 2 2 0 (-32)<br />
&nbsp;&nbsp; ? 19 235 0 0 0 237 0 2 0 (-27)</p>
<p>The sort was to find any errant ID 19 packets, then looking for good 19 235 packets for comparison.</p>
<p>Just one packet, same dB range, first fields ok.&nbsp; 253 to 237 is a single dropped bit in the middle of that byte. This could <s>easily</s> be explained by a narrow noise blip in the channel. Then<em> possibly</em> another glitch at the end of the next byte at a stretch.</p>
<p>The puzzling issue are the four packets that fell out of the sort for 19, 235.&nbsp; Is that 2/3, 2, 2,0 pattern reasonable payload? - perhaps entirely my ignorance about what gets stuffed into a normal packet.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32995"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 04/08/2015 - 09:21.</div>
    <div class="content">
     <p>I hadn&#39;t gotten around to checking Tom&#39;s&nbsp;latest logs yet. I suspect the run of zeros is causing the same sync problem found with Ian&#39;s <a href="11062.html">&quot;emonTH Unreliable reading timing?&quot;</a>&nbsp;issue, which was my first&nbsp;suspicion&nbsp;but introducing the fixed value didn&#39;t impact the results at the time.</p>
<p>The emonTH payload is 4 integers temp1&nbsp;temp2&nbsp;humidity battery, (all are scaled&nbsp;x10)&nbsp;In this &quot;stock?&quot; example with a DHT22 fitted,&nbsp;temp2&nbsp;(bytes 3 and 4 of data)<span style="line-height: 20.7999992370605px;">&nbsp;</span><span style="line-height: 20.7999992370605px;">is unused</span><span style="line-height: 1.6;">&nbsp; </span><span style="line-height: 1.6;">U</span><span style="line-height: 1.6;">nless </span><span style="line-height: 1.6;">temperature</span><span style="line-height: 1.6;">&nbsp;exceeds 25.5&deg;C the 2nd byte will remain 0 too and the maximum byte 2 can ever </span><span style="line-height: 1.6;">reach is 4 due to a 125.0&deg;C cap.</span></p>
<p>I will take a look and run some more tests locally here. Although IMO the temp sensor circuits should all use &nbsp;<a href="11070.html">&quot;Temp sensor circuit error codes&quot; so I&nbsp;proposed a &quot;standard&quot; for consideration.</a></p>
<p>Paul</p>
<p>PS byte 7 and 8 are ~ 2 &amp; 0 as Tom is powering from a programmer rather than batteries&nbsp;so the 0.2v is probably residue voltage or&nbsp;noise seen by the ADC ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33005"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Tue, 04/08/2015 - 10:40.</div>
    <div class="content">
     <p>@Paul,</p>
<p>Ok, that makes sense - the RH is hovering around 50% which due to the encoding looks like odd dramatic changes of byte 5.&nbsp; The decoded values look sensible with slow rates of change. This just leaves the single packet corrupted packet, correctly caught by the CRC.</p>
<p>The remainder are true noise packets - low signal strength and random contents.&nbsp; I have a potential fix for these that requires a library rebuild on the Rx side if you have time to dig further.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33008"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 04/08/2015 - 11:13.</div>
    <div class="content">
     <p>Ah, you beat me to it, I just came to post my findings, which concur with your own. the roll over at ~51% humidity is shown by&nbsp;the box on&nbsp;the attached png and I too only found 1 unexplained packet that was rejected by crs every thing else appears as expected.</p>
<p>Although I&#39;m interested in your fix I&#39;m not sure there would be any significant gain from any&nbsp;&quot;improvement&quot; for Tom, setting silent will remove all the noise packets and the loss of one good packet isn&#39;t the end of the world I guess. The only way to tell is to count the packets over a prolonged period to determine the fail rate and to see&nbsp;if any packets are entirely missing (by calculating from send frequency)&nbsp;due to being blocked by the noise but I would think that was unlikely, I&#39;m game if Tom is, although he may not be geared up to compile and install FW to the rfm2pi, that normally&nbsp;involves having a GUI arduino&nbsp;IDE on the same machine as the GPIO. unless you can compile a hex file for him to install with avrdude.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33013"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Tue, 04/08/2015 - 13:56.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Nice work!</p>
<p>I can start X and stick the Arduino&nbsp;IDE on the Pi if you need me to. Or if someone compiles the firmware I can shove it on with avrdude.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33016"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 04/08/2015 - 14:50.</div>
    <div class="content">
     <p>Cool, lets see what emjay&nbsp;prefers,</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33039"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 05/08/2015 - 08:36.</div>
    <div class="content">
     <p>Reading this post with interest, also noticing similar drop in reading reliability with rfm69 emonTH and have been trying to debug a system that we sent out that I think this may be a contributor too, although I think there is something else there too that is causing readings to drop off for hours. Perhaps a combination of this and a high radio noise environment..?</p>
<p>I setup a test system yesterday and ran it with standard firmware until just after 11pm, then added in the 100ms delay. Recording the a temperature feed from the emonth with the phpfina engine and an interval of 60s and then using the emoncms data viewer with skip missing unticked and the interval in the request set to 60s you can see the missing packets clearly and there&#39;s a noticeable improvement in reliability after adding the 100ms delay!</p>
<p>Il try reducing the delay a bit to save power next to see how short it can be without reducing the reliability.</p>
<p><img alt="" src="../sites/default/files/rfm69delay.png" style="width: 650px; height: 488px;" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33042"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 05/08/2015 - 09:29.</div>
    <div class="content">
     <p>Hi Trystan - can you post a minicom log of the rfm2pi output with silent off?</p>
<p>This has proved the most enlightening method of debugging, If you have multiple devices you could also try changing&nbsp;the emonTH sketch&nbsp;to a different group which will allow you to change group at minicom to view just the emonTH&nbsp;this reduces clashes for testing and is easier on the eye when digesting the data.</p>
<p>The &quot;run of zero&#39;s&quot; could also be causing a sync&nbsp;issue and viewing via a feed could be adding to the percieved&nbsp;issue, It has been proven on another thread just using a phptimeseries&nbsp;as the first log to feed yield a much higher datapoint count than a fixed interval.</p>
<p>Using the emonTH&nbsp;alone for a set timed period and using excel for&nbsp;analysis&nbsp;of&nbsp;the minicom log is the only sure way to establish an accurate emonTH send rate currently.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33045"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 05/08/2015 - 10:49.</div>
    <div class="content">
     <p>Checking my own logs this morning I found a couple of&nbsp;anomalies and went back to the 1 &quot;unexplained&quot; packet in Toms last results. losing a single&nbsp;packet isn&#39;t significant, but it&#39;s values actually reveal a recognizable pattern.</p>
<p><img alt="" src="../sites/default/files/emonth_tom2.png" style="width: 700px; height: 320px;" /></p>
<p>&nbsp;On the whole the packet is within scope, correctly formatted and plenty strong enough to be read above the noise floor. We can be pretty sure the humidity didn&#39;t dip from 49.3% to 23.7% and back to 49.3% in 12 seconds (and if it did, I don&#39;t think the DHT22&nbsp;could&nbsp;keep up) so I suspect one of 2 things could of&nbsp;occurred</p>
<p>1) the preceding &quot;run of zeros&quot; caused a sync issue in the reciever, which only manifested from 3/4 of the way into the 5th byte so the humidity should be 49.2%.</p>
<p>​2) The 100ms&nbsp;delay is border line and the DHT22 value was incomplete when read.</p>
<p>Either will be hard to detect in any quantity but if the use of zero&#39;s for unused temp sensors is removed and Trystans&nbsp;delay tests reveal&nbsp;a clear result (eg&nbsp;if stable at 50ms then 100ms is definitely not the cause, or if a&nbsp;reduction negatively&nbsp;effects stability perhaps we need to extend the delay)&nbsp;we may be able to improve the results further&nbsp;without&nbsp;the need for&nbsp;more&nbsp;indepth tests.</p>
<p>Wouldn&#39;t it&nbsp;be more efficient on the battery to wake the rfm69&nbsp;earlier in the routine and then do something else rather than use a delay, if it&#39;s possible ?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33046"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 05/08/2015 - 11:38.</div>
    <div class="content">
     <p>Great thanks Paul, I&#39;ve got minicom setup and logging to a file, will post up the results soon. Setting the delay to 20ms looks promising so far... by looking at the data viewer, but dont want to jump to conclusions yet..</p>
<p>Good idea about waking the rfm69 earlier in the routine. The last time I measured the power consumption for the emontx with the rfm69 asleep vs initialized and awake I didnt measure a difference. It used 8.4mA. The power consumption only jumped up if data was being sent (34-44mA) or rf12_recvDone() was being called (~23 mA). Measurements include atmega power consumption. Which would suggest negating the need to call sleep, maybe I should double check those measurements..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33075"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Thu, 06/08/2015 - 08:21.</div>
    <div class="content">
     <p>@Paul,</p>
<p>Analyzing that corrupted packet is rather speculative, but assuming the &#39;BAT&#39; reading is 2 as reported, then there is unlikely to be a bit synch problem, just a bit decode error in byte 6.&nbsp;&nbsp; At these very high S/N ratios, a single bit error&nbsp; is also unlikely unless there was a very short RF noise spike in that bit decode window.</p>
<p>Doing some stats on more than a sample of one would be nice ! ;-)</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33094"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/08/2015 - 09:01.</div>
    <div class="content">
     <p>I haven&#39;t been able to shed much more light on this yet. I did the test with a 20ms delay and minicom for 2 hours and 48 minutes which with a 100% success rate would be 168 packets. 161 &quot;OK 19 &quot; packets where received and there was a lot of noise packets:</p>
<p>? 19 146 145 237 47 87 57 89 43 153 203 32 144 174 198 128 28 201 163 255 196 (-104)<br />
? 19 135 156 70 217 76 27 31 9 240 191 194 222 129 149 86 151 88 219 66 64 (-104)<br />
OK 19 148 0 0 0 36 3 30 0 (-48)<br />
? 19 25 101 1 97 138 224 50 135 60 43 91 7 254 78 90 116 219 203 242 176 (-101)<br />
? 19 88 118 8 101 179 203 202 208 88 70 247 254 55 143 44 216 126 198 243 28 (-105)<br />
OK 19 149 0 0 0 37 3 30 0 (-48)<br />
OK 19 149 0 0 0 37 3 31 0 (-48)</p>
<p>
I didn&#39;t receive any packets with &quot;? 19 &quot; that appeared to be anything other than noise.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33097"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 07/08/2015 - 10:48.</div>
    <div class="content">
     <p>The &quot;set interval&quot; in the emonTH sketches are &quot;1&quot; minute, there is a 2 second &quot;dodelay()&quot; prior to the DHT22&nbsp;reading and a couple of minor pauses AND the time taken to execute. The result is the nett interval is a minimum of 62+ seconds and depends on whether you have debug enabled and an external temp sensor.</p>
<p>2hrs 48m is 168*60 = 10080 seconds / 161 &quot;OK 19&quot; packets = 62.6 second interval average, which I would say was probally spot on.</p>
<p>I had intended to reorganise the timing as described earlier in this thread to,&nbsp;calculate the existing delay depending on what is discovered (and the #defines) from that calculate the balance required to achieve&nbsp;the desired interval (specified by the user in seconds rather than minutes) once only in the&nbsp;setup() rather in each loop, the only time the interval would change is when a sensor is added/removed or debug selected none of which should happen in normal running.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33098"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/08/2015 - 11:26.</div>
    <div class="content">
     <p>A little more data both in attached txt and graph screenshot, this is with no delay and full sleep mode. Im in Manchester today so this is also a different location.</p>
<p>There are 24 valid packets all together, both recorded with emonhub and visible in the end on the emoncms graph, I&#39;ve enabled graph points so that it shows all the received datapoints.</p>
<p>There are 13 non-valid packets all together that are of the right form and with valid rssi.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33099"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Fri, 07/08/2015 - 12:34.</div>
    <div class="content">
     <p>@Paul, just a thought if you plan to reorganize the delay mechanisms.&nbsp; If the lag is acceptable, how about overlapping the DHT22 delay with the packet send by saving those readings to send out in the next packet? Might save a few micro-coulombs at the expense of slower response to ambient.&nbsp; If trends are the concern, then perhaps this is acceptable.</p>
<p>Without any fresh data streams to look at, I&#39;ve gone back to the pre-delay sets.&nbsp; Something is not hanging together with the current idea that the RFM69 is not ready fast enough when transitioning from SLEEP mode.&nbsp;&nbsp; The FIFO can be loaded up while in SLEEP mode and surely it would be the first byte or so that was failing, not consistently further down the packet.</p>
<p>Since the FIFO loading is a simple code loop, there must be something happening &#39;behind the scenes&#39; for this to fail i.e. an interrupt-time issue.&nbsp; The event can be bracketed - it happens after <em>n</em> SPI transactions from taking the radio out of sleep and it is masked by introducing that arbitrary delay (i.e currently &lt;&nbsp; 20ms).&nbsp; TxReady popping up after crystal oscillator/PLL start up delay from sleep?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33100"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 07/08/2015 - 13:23.</div>
    <div class="content">
     <p>The interval between each of the emonhub.log messages is ~62s which confirms&nbsp;the interval spacing discussed above.</p>
<p>Of the 37, 24 are correct and passed to emoncms,&nbsp;the remaining 12&nbsp;are made up of 2 overlapping groups (of which 3 packets belong to both)</p>
<p>There are 9 correctly formatted but have invalid data (in boxes on attached image), <s>8</s>&nbsp;all&nbsp;of those I&#39;m confident would be fixed with the RFM wake up delay, <s>the 9th (in bright red) is an odd case and may be related to the single&nbsp;&quot;unexplained&quot;, similar but not the same packet discussed a couple of posts back.</s></p>
<p>There are 7 (in orange) that appear to be prefixed with, or rather attached to the end of a &quot;-&gt; ack&quot;, emonhub&nbsp;recognizes the &quot;-&gt;&quot; as a confirmation message and will log and discard&nbsp;that frame. The&nbsp;&quot;confirmed&nbsp;sent&nbsp;packet&nbsp;size&quot; message is not generic enough to accurately include acks&nbsp;as it was written for the glcd&nbsp;time and packetgen&nbsp;type transmission commands&nbsp;from emonhub. The wording needs to be changed, but more importantly the concatenation of that reply and the next payload must be separated by a new line and I believe that will be an issue in the RFM2Pi sketch.</p>
<p>Paul</p>
<p>EDIT -new image attached, the one I marked in red previously wasn&#39;t a special case! not sure why I thought it was now I look at it again ???)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33101"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 07/08/2015 - 13:19.</div>
    <div class="content">
     <p>@emjay - just spotted your post after I posted, I would hope the delay can be incorperated into a more efficient routine. The DHT22&nbsp;&quot;delay&quot; is actually a &quot;&nbsp;Sleepy::loseSomeTime(2000)&quot; so it&#39;s not actually awake during that particular &quot;delay&quot; thare&nbsp;are some options but I won&#39;t invest too much time into it until we are sure of the time needed and if any&nbsp;other items should be factored in, plus I&#39;ll wait to see if Tyrstan&nbsp;plans any changes rather than us both doing different things.</p>
<p>You could be write that the core of the issue is something else, I only assume it&#39;s the rfm not waking in time because adding the delay where it is has a 99.99% cure rate.&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33103"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/08/2015 - 13:48.</div>
    <div class="content">
     <p>More data. I have 3x emonth nodes here.</p>
<p>node 19: standard emonth rfm69 firmware without any delay but full sleep mode.<br />
node 20: standard emonth rfm69 minus rfm wake/sleep calls all together<br />
node 21: very basic rfm69 + dht22 code without any sleeping, should be the same as 20.</p>
<p><strong>Result summary for node 19</strong><br />
166 lines all together.<br />
7 missing packets<br />
<strong>37 discarded frames</strong><br />
27 confirmed sent packet size: -&gt; ack<br />
166 - 7 - 37 - 27 = 95<br />
~93 in graph between 10:00 and 12:45</p>
<p><strong>Result summary for node 20</strong><br />
142 lines all together.<br />
9 missing packets<br />
27 packets with &quot;confirmed sent packet size: -&gt; ack&quot;<br />
142 - 9 - 27 = 106<br />
~105 in graph</p>
<p><strong>Result summary for node 21</strong><br />
143 lines all together.<br />
7 missing packets<br />
23 packets with &quot;confirmed sent packet size: -&gt; ack&quot;<br />
143 - 7 - 23 = 113<br />
112 datapoints between 10:58 and 13:21 in graph</p>
<p>edit: name of emonth_sleep_20_nonoise.txt should be emonth_nosleep_20_nonoise.txt</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33104"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/08/2015 - 13:52.</div>
    <div class="content">
     <p>The &quot;confirmed sent packet size: -&gt; ack&quot; might be my fault with the modified emonpi firmware code i made to run these tests as the default firmware does not print any of the ? packets. Il check that</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33105"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 07/08/2015 - 13:53.</div>
    <div class="content">
     <p>@ Trystan what HW &amp; SW are you debuging?</p>
<p>I just checked and the urrent&nbsp;<a href="https://github.com/openenergymonitor/RFM2Pi/blob/master/firmware/RF12_Demo_atmega328/RF12_Demo_atmega328.ino#L266">RFM2Pi (rfm12)</a> &amp; <a href="https://github.com/openenergymonitor/RFM2Pi/blob/master/firmware/RFM69CW_RF_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328.ino#L697">RFM2Pi (rfm69)</a> both have new lines started immediatly after the print&nbsp;&quot;-&gt; ack&quot;, only the <a href="https://github.com/openenergymonitor/emonpi/blob/master/Atmega328/emonPi_RFM69CW_RF12Demo_DiscreteSampling/emonPi_RF.ino#L40">emonPi&nbsp;sketch</a> appears different (omitted?), I cannot see a new line created there.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33109"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/08/2015 - 14:28.</div>
    <div class="content">
     <p>Hardware is emonpi + 3x emonth all rfm69. Software for nodes is as described above. Yes not sure why it doesnt have a new line. But re-uploading the default emonpi firmware which doesnt print corrupt packets does not print any &quot;confirmed sent packet size: -&gt; ack&quot;</p>
<p>This is my current RF_Rx_Handle() function, now with added newline:</p>
<p>boolean RF_Rx_Handle(){<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp; if (rf12_recvDone()) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // if RF Packet is received<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte n = rf12_len;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (rf12_crc == 0) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;OK&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;?&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (n&gt;20) n = 20;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot; &quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Print RF packet to serial in struct format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(rf12_hdr &amp; 0x1F);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Extract and print node ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot; &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (byte i = 0; i &lt; n; ++i) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print((word)rf12_data[i]);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&#39; &#39;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #if RF69_COMPAT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // display RSSI value after packet data e.g (-xx)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;(&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(-(RF69::rssi&gt;&gt;1));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;)&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #endif<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (RF12_WANTS_ACK==1) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot; -&gt; ack&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rf12_sendStart(RF12_ACK_REPLY, 0, 0);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (rf12_crc==0) return(1); else return(0);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp; } //end recDone<br />
&nbsp;&nbsp; &nbsp;<br />
}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33110"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 07/08/2015 - 14:33.</div>
    <div class="content">
     <p>I have only looked at the node 19 log so far and there are only 2 &quot;missing&quot; datapoints&nbsp;5 of the 7 you counted just jump a minuit&nbsp;eg from 1m 59s to 3m 1s would be&nbsp;only an interval of 1m 2s there is not a missing datapoint, This is however possibly the &quot;logic&quot; behind the missing datapoints in a phpfiwa&nbsp;feed as there will be intervals with 0 updates.</p>
<p>The nett count is the same, just less &quot;missing&quot; !</p>
<p><s>166</s>161 - <s>7</s>&nbsp;2&nbsp;&nbsp;- 37 - 27 = 95 so&nbsp;~93 in graph between 10:00 and 12:45 isn&#39;t bad and there are only 2 stray datapoints&nbsp;in 161 so 1.24% didn&#39;t make it to the emonPi&nbsp;from 19.&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33115"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 07/08/2015 - 16:21.</div>
    <div class="content">
     <p>node 20 has 5 of 138 (3.6%) &#39;missing&#39; = 106 vs 105 in graph&nbsp;</p>
<p>node 21 has 7&nbsp;of 143&nbsp;(4.9%)&nbsp;&quot;missing&quot; =&nbsp;111&nbsp;vs&nbsp;112 so is in line there too.</p>
<p>So it appears the &quot;well rested&quot; rfm69&nbsp;performs significantly better than one that is always awake, go figure??</p>
<p>This is based on a relatively small dataset and it probably isn&#39;t the fact the rfm69 is &quot;rested&quot; but there is clearly a big difference ie improvement allowing the rfm to snooze between duties.</p>
<p>Could it be that freshly awoken there is no pending stack of received data to discard? and it starts with a clean slate?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33116"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Fri, 07/08/2015 - 16:27.</div>
    <div class="content">
     <p>@Trystan, small aside - if that send ACK path is followed, isn&#39;t rf12_crc then modified?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33143"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 08/08/2015 - 10:32.</div>
    <div class="content">
     <p>I'm off on holiday today until the 14th, to the isle of eigg and rum :) so I'm not going to get a chance to delve into this  further until then, would like to run a series of tests with different delay sizes 10,20,50,100ms to see how much is needed. I'd say we need more data maybe a few days at least to tell the difference between some of these changes..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33146"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/53.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-53.jpg" alt="johncantor&#039;s picture" title="johncantor&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/53.html" title="View user profile.">johncantor</a> on Sat, 08/08/2015 - 12:00.</div>
    <div class="content">
     <p>I&#39;m just doing a parallel&nbsp;test with 2 EmonTh&nbsp;using the pulse sketch</p>
<p>One with sleep commented out, other with delay as follows</p>
<p>rf12_sleep(RF12_WAKEUP);&nbsp;&nbsp;&nbsp;</p>
<p>delay(100);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>rf12_sendNow(0, &amp;emonth, sizeof emonth);&nbsp;</p>
<p>I&#39;ll try 2hr periods with 100ms, 20ms and no delay,&nbsp;and compare them with the one with no sleeping.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33149"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sat, 08/08/2015 - 16:26.</div>
    <div class="content">
     <p><em>So it appears the &quot;well rested&quot; rfm69&nbsp;performs significantly better than one that is always awake, go figure??</em></p>
<p>Hi Paul,</p>
<p>Your comment reminded me of a parameter used in packet radio Terminal Node Controllers.</p>
<p>Even if the RFM module is fully awake and in receive mode, is the module getting enough &quot;delay&quot; to allow the transmitter to &quot;fully ramp up&quot;&nbsp; before the data stream gets fed to it?</p>
<p>Comparativly speaking, with a TNC, the required delay was huge - on the order of 225-250 milliseconds. With<em> </em><em>that</em> particular hardware, if the transmitter delay was set just a few (~5-10) mS too small, problems similar to the ones described in this thread ensued.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33150"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Sat, 08/08/2015 - 17:51.</div>
    <div class="content">
     <p>Just updating you guys to say that my two emonTH&#39;s have now been running for a few days without a problem using the added 100ms delay.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33154"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/53.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-53.jpg" alt="johncantor&#039;s picture" title="johncantor&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/53.html" title="View user profile.">johncantor</a> on Sun, 09/08/2015 - 09:51.</div>
    <div class="content">
     <p>I did the test with both test nodes down the garden. Range 20m from Pi, and going through stone walls. &nbsp;(they are simply counting +1 on every rf send)</p>
<p>The graphs are with &#39;skip missing&#39; un-ticked. &nbsp;Not sure how conclusive it is? I guess I need to repeat&nbsp;it.&nbsp;There seems no great&nbsp;difference between 100 and 20ms delay as compared to the control above it&nbsp;&nbsp; The wake-up with no delay looks a bit worse than the no-sleep control.</p>
<p>Is it worth seeing what&nbsp;10 or 5ms look like?</p>
<p><a href="../../../dl.dropboxusercontent.com/u/3500990/08-08-15WARM%20test.jpg_%3b%20filename_%3dUTF-8%27%2708-08-15WARM%2520test.jpg"><img alt="" src="../../../dl.dropboxusercontent.com/u/3500990/08-08-15WARM%20test.jpg_%3b%20filename_%3dUTF-8%27%2708-08-15WARM%2520test.jpg" /></a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33155"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Sun, 09/08/2015 - 11:01.</div>
    <div class="content">
     <p>@John,</p>
<p>Interesting results. If we speculate that there are at least two packet failure mechanisms, then the graphics are the OR of the effects. This is supported by the similarities reading vertically in a particular time zone and that other results have shown that the 100 ms delay almost completely masks the buffer-stuffing error.</p>
<p>For example, the 15:00 - 17:30 pattern similar losses even with 100 ms delay with the lower. This suggests a strong? interferer in the channel around that period. Similarly, the 18:30 - 21:30 shows extra errors adding in (as expected) in the &#39;no delay&#39; graphic.</p>
<p>A mincom style log would be very useful - this may well show a flood of spurious packets during the &quot;noisy&quot; periods with probably distinct and different RSSI values from the expected packets.&nbsp;&nbsp; If the flood is a torrent, the Rx section is blinded to valid packets while it flushes out the spurious junk and gets around to Rx Ready again.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33156"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 09/08/2015 - 11:25.</div>
    <div class="content">
     <p>@Bill - I&#39;m not clear on the root cause as my understanding of RFM&#39;s&nbsp;and JeeLib&nbsp;isn&#39;t great at that level, It was Roberts &quot;sleep&quot; pointers that led me to systematically test each sleep related part of the sketch and tuned into this particular part. I only know the effect of the delay fixes the issue But not really why.</p>
<p>@Tom - Good to hear, thanks for finding the bug, I&#39;m sure there will be a updated sketch soon and hopefully that will also address the interval between packets not being as defined too.</p>
<p>@John -&nbsp;thanks for the input, What type of feed are you using? if using a fixed interval the results will not be totally&nbsp;accurate, I notice you are using the &quot;pulse&quot; sketch and having took a look at it I cannot be sure it would be affected by&nbsp;as&nbsp;the issue consistently manifests itself as &quot;dropping&quot; either the 5th or 6th byte of a 8 byte payload, these are provided by the rather slow acting DHT22 which isn&#39;t present in the sketch you are using plus it only has a 6 byte&nbsp;payload.</p>
<p>If you have a couple of DHT22&#39;s&nbsp;and want to do some &quot;rfm69&nbsp;wakeup delay duration tests&quot; we can mod a sketch or if&nbsp;you are trying to debug the &quot;missing&quot; datapoints&nbsp;you&#39;re seeing then I would recommend running a phptimeseries&nbsp;feed as the very first feed on that input and either way take a look at the packets in minicom, the serial stream&nbsp;holds many more answers, is more accurate and can be debugged&nbsp;in excel.</p>
<p>If you can provide us with a log of the packets from minicom&nbsp;I will take a look, perhaps we&nbsp;should confirm if the issue occurs without a DHT22 and/or related to packet size too. I will try and run some tests for that&nbsp;too.</p>
<p>Paul</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33157"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 09/08/2015 - 12:00.</div>
    <div class="content">
     <p>Hi emjay&nbsp;- I started writing that last post sometime ago and hadn&#39;t noticed your post til now.</p>
<p>How we view the data is definitely&nbsp;playing a big part, viewing the data in minicom is the only accurate method currently, the fixed interval feeds in emoncms are amplifying the errors as they seem to test if there has been a update in the last 60s and this can be let down by server loading, network performance and also the fact the sketches are not sending a packet &quot;within&quot; 60sec&nbsp;window, if we are licky every 60 sec window might receive an update but since they are sent on an interval greater than 60s it cannot occur every 60s window.</p>
<p>I even suspect the occasional valid packet is going astray as I am comparing the phptimeseries&nbsp;too, (that feed engine is not fixed interval, it just records the time and value of datapoint.</p>
<p>Going back to Trystan&#39;s logs there could be yet another issue in play there that cannot be seen in the emonhub logs, I&#39;m trying to figure out why only some of the packets are appended to an &quot;-&gt; ack&quot;, we know there should be a new line but why are there just a handful of them? I would of though there would be as many &quot;-&gt; ack&quot; frames as there is frames received&nbsp;(although they wouldn&#39;t be paired up as each ack is prepended to the next packet, good or bad)</p>
<p>I notice your wording&nbsp;<em>&quot;almost completely <strong>masks</strong> the buffer-stuffing error&quot; </em>rather than helps, alleviates, fixes or improves the issue etc, do you know the real cause? is there a better way to address this?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33158"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/53.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-53.jpg" alt="johncantor&#039;s picture" title="johncantor&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/53.html" title="View user profile.">johncantor</a> on Sun, 09/08/2015 - 12:20.</div>
    <div class="content">
     <p>Much of this is beyond my understanding, but I see its better to test with DTH22&#39;s&nbsp;so I have&nbsp;re-configured with DTH22s. &nbsp;so far i have one with 50ms delay after the wakeup&nbsp;command, other has no delay.... delay (50); line commented out.</p>
<p>I dont&nbsp;know about minicom.</p>
<p>What useful tests can I do simply looking at the feed graphs (I am using fixed period with averaging).</p>
<p>From a casual look at update rates, there is no difference between the 2 (50ms delay and 0 delay). &nbsp;however I am seeing times up to 8 mins (with pulse it rarely went over 60 secs)</p>
<p>For this application (room temperature), we don&#39;t really need mind lots of missed packets BUT Pete had observed no data for 24hrs. &nbsp;How is this possible?</p>
<p>Any suggestions re what tests I should continue with? &nbsp; &nbsp;I was trying at 20+m range and through a stone wall. &nbsp;I thought&nbsp;it useful&nbsp;to test it near the range limit, but I guess if I&#39;m too near the edge of range, the results could be less valid.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33160"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/53.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-53.jpg" alt="johncantor&#039;s picture" title="johncantor&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/53.html" title="View user profile.">johncantor</a> on Sun, 09/08/2015 - 12:40.</div>
    <div class="content">
     <p>Just stepping back a bit. &nbsp;When Pete set up several nodes, we observed on more than one occasion that several nodes stopped together at about the same time, but some kept logging. &nbsp; e.g. I remember looking down the inputs to see some updating, but maybe 3 showing the same time (e.g.20mins, or&nbsp;3 hrs). &nbsp;I cannot be totally certain that this was not due to Pete moving the nodes further away, but it happened several times. &nbsp;Is it possible that something on the receiving end in the Pi is causing the problem. &nbsp;I am struggling to get my head around the fact that we saw last update times of 18hrs&nbsp;on several nodes, but they all recovered after resetting just one of the nodes. &nbsp; &nbsp;Furthermore, I have not managed to replicate very long periods of drop-out here. &nbsp;This has only been observed in Pete&#39;s office. &nbsp;</p>
<p>I&#39;ll do some further tests if anyone can suggest what I should do.</p>
<p>As i said, we should be able to tolerate&nbsp;lots of drop-outs for room temperature&nbsp;monitoring, but we need to&nbsp;avoid what appears to be a lock-up.</p>
<p>many thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33161"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Sun, 09/08/2015 - 13:27.</div>
    <div class="content">
     <p>@Paul,</p>
<p>We just have pointers to the bit-stuffing error so far - occurring several bytes into the FIFO doesn&#39;t jibe <em>directly</em> with a &quot;slow&quot; module start up from sleep.&nbsp; The timing <em>is</em> relatively consistent, which suggests an interrupt-level glitch.</p>
<p>This would be confirmed if we see the byte position move forward with a very short delay.</p>
<p>As for a fix, still head-scratching time I&#39;m afraid.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33162"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/53.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-53.jpg" alt="johncantor&#039;s picture" title="johncantor&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/53.html" title="View user profile.">johncantor</a> on Sun, 09/08/2015 - 13:41.</div>
    <div class="content">
     <p>So, I&#39;m seeing no&nbsp;difference on feed update times with 50ms&nbsp;delay after wakeup and no delay. &nbsp;anything worth trying? &nbsp; &nbsp;should I retest with the sleep/wake commands removed? &nbsp; &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33163"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 09/08/2015 - 15:33.</div>
    <div class="content">
     <p>OK so that we can collect some good data I have thrown together&nbsp;a little python utility to use in place of minicom&nbsp;so that it will do 2 things one is add a timestamp and it also saves to a csv file that can be opened directly by excel&nbsp;(plus&nbsp;I don&#39;t find minicom very user friendly).</p>
<p>Example log attached (had to rename ,txt as .csv wouldn&#39;t upload) to see what the output is like (ignore the data). the menu stuff at the start of each session can be deleted but I didn&#39;t want to start adding filters to remove certain stuff&nbsp;and then we miss some valid data, so this will record everything&nbsp;out of the serial&nbsp;port (unlike emonhub/emoncms) and will record a timestamp (unlike minicom or arduino IDE). It is&quot;one-way&quot; so the group and node settings etc cannot be altered whilst running. once downloaded and settings edited it can be run with one command.</p>
<p>To try it (assuming a Pi emonbase and&nbsp;use rpi-rw&nbsp;1st if OS is read-only) download with</p>
<p><strong>wget&nbsp;http://openenergymonitor.org/emon/sites/default/files/read_rfm2pi.py_.txt&nbsp;-O ~/read_rfm2pi.py<br />
chmod&nbsp;+x ~/read_rfm2pi.py</strong></p>
<p>The PORT, BAUD, PATH and FILE setting need to be confirmed/set in the script</p>
<p><strong>nano&nbsp;~/read_rfm2pi.py</strong></p>
<p>As per usual it should have exclusive access to&nbsp;uart&nbsp;so stop&nbsp;emonhub&nbsp;etc first</p>
<p><strong>sudo&nbsp;service emonhub stop</strong></p>
<p><strong>~/read_rfm2pi.py</strong></p>
<p>and <strong>ctrl-c</strong> will stop recording, emonhub&nbsp;can be started again with&nbsp;<strong>sudo&nbsp;service&nbsp;emonhub&nbsp;start, </strong>the script is very basic and rough around the edges by it does the job :-)</p>
<p>Posting from these logs will significantly help with tracing issues with the rfm2pi&nbsp;network devices.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33164"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 09/08/2015 - 15:42.</div>
    <div class="content">
     <p>@John - We need to see the characteristics of the issue you are up against, all the feed will show you is it&#39;s not right, there isn&#39;t any detail and the frequency etc get affected&nbsp;by the fixed interval.</p>
<p>Can you try the script above rather than minicom?</p>
<p>At least then we can determine the nature of the issue(s) you are seeing. The adding of the &quot;wakeup delay&quot; targets one specific issue, we are aware of a possible bit&nbsp;sync issue and there are various other possibilities too.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33168"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Sun, 09/08/2015 - 16:19.</div>
    <div class="content">
     <p><em>@Paul,</em></p>
<p>Good idea. Could I suggest one change?&nbsp; When the FIFO count gets truncated for <em>n</em> &gt; 20, could the received <em>n</em> value be stuffed into that last position? The actual buffer contents are junk so there is no loss in overwriting one value - the <em>n</em> value is useful though since it indicates how long the Rx section is blocked dealing with the noise packet.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33170"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 09/08/2015 - 16:41.</div>
    <div class="content">
     <p>@emjay - That would be useful, however it would need to be written into the receiver sketch rather than this monitor utility, something like <a href="10900.html#comment-32517">this&nbsp;change</a>&nbsp;proposed while looking into Ian&#39;s bit sync&nbsp;issue could be added to the receiver&nbsp;sketch&nbsp;without impacting normal use.</p>
<p>EDIT - athough&nbsp;in normal use a &gt;20 not &gt;70 would be used</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33198"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 10/08/2015 - 19:39.</div>
    <div class="content">
     <p>Hi guys,</p>
<p>Thanks for your help debugging this.</p>
<p>The emonTH coded on GitHub and pre-compiled .hex files have been updated to V1.6 to include a 100ms dodelay&nbsp;immediately after the rf12_sleep(RF12_WAKEUP); on line312​</p>
<p><a href="https://github.com/openenergymonitor/emonTH/blob/85e26415214f206dbfd015846ad5ce6cec045c5f/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino">https://github.com/openenergymonitor/emonTH/blob/85e26415214f206dbfd015846ad5ce6cec045c5f/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino</a></p>
<p>We will include this update in all new emonTH units.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33222"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 10/08/2015 - 22:56.</div>
    <div class="content">
     <p>Hi Glyn, good to see the delay in the sketch, that should reduce that issue significantly,</p>
<p>however&nbsp;the use of &quot;dodelay&quot;,&nbsp;a shorter delay&nbsp;or different routine may help minimize the impact of that delay on&nbsp;battery life,</p>
<p>I see you have shortened the main interval to 55&nbsp;seconds which should be ok&nbsp;as a interim&nbsp;fix to&nbsp;ensure no missing data point <em>are apparent</em> when viewing a graph of a fixed feed etc, but it will it will knock over 8% off battery life and cause&nbsp;wasted packets as many&nbsp;1min fixed intervals will now&nbsp;receive&nbsp;2&nbsp;updates of which one will be ignored,</p>
<p>I have tried a couple of methods to calculate the interval which are very successful&nbsp;with a stable voltage but running on (fresh) batteries yields an interval 0.8s longer than when powered by usb programmer Not that a 0.8s variation is a problem but&nbsp;I wonder how long the interval will become when the batteries are nearly&nbsp;depleted?&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33248"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 11/08/2015 - 14:33.</div>
    <div class="content">
     <p>Hi Paul,&nbsp;</p>
<p>I have selected to use &#39;dodelay&#39; to keep impact on battery life minimal:&nbsp;</p>
<p><a href="https://github.com/openenergymonitor/emonTH/blob/85e26415214f206dbfd015846ad5ce6cec045c5f/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L314">https://github.com/openenergymonitor/emonTH/blob/85e26415214f206dbfd015846ad5ce6cec045c5f/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L314</a></p>
<p>Good point regarding wasted packets, 8% is quite a reduction.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33251"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 11/08/2015 - 15:08.</div>
    <div class="content">
     <p>Hi Glyn, I&#39;m not sure that&#39;s right still</p>
<p><a href="https://github.com/openenergymonitor/emonTH/blob/85e26415214f206dbfd015846ad5ce6cec045c5f/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L320" style="line-height: 20.7999992370605px;">I</a><span style="line-height: 20.7999992370605px;">t looks like&nbsp;</span>Trystan&nbsp;had already added a <strong>delay</strong>(20) in the correct location&nbsp;<a href="https://github.com/openenergymonitor/emonTH/blob/85e26415214f206dbfd015846ad5ce6cec045c5f/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L314">(L314)</a>&nbsp;</p>
<p>then you have added a <strong>dodelay</strong>(100) after the rfm has been put to sleep again&nbsp;<a href="https://github.com/openenergymonitor/emonTH/blob/85e26415214f206dbfd015846ad5ce6cec045c5f/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L320">(L323)&nbsp;</a></p>
<p>and the led flash with a&nbsp;dodelay(100) has&nbsp;been uncommented too&nbsp;<a href="https://github.com/openenergymonitor/emonTH/blob/85e26415214f206dbfd015846ad5ce6cec045c5f/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L322-L324">(L322-324).</a></p>
<p>The position needs to be L314, a dodelay() will use less power than a delay() and&nbsp;the jurys still out on the duration, but it won&#39;t matter so much if the dodelay is used so probally better to be safe with 100ms&nbsp;as&nbsp;I guess an additional&nbsp;80ms of rfm power is nothing compared to the 100ms of led or the 8% drop in interval duration.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33254"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/53.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-53.jpg" alt="johncantor&#039;s picture" title="johncantor&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/53.html" title="View user profile.">johncantor</a> on Tue, 11/08/2015 - 15:37.</div>
    <div class="content">
     <p>Much of this is above my understanding, but I have continued with by test. &nbsp;I have one with 50ms delay and one with no delay. &nbsp;delay looks better. &nbsp; &nbsp;Should I try the dodelay? &nbsp;not that I know what that is</p>
<p><img alt="" src="../../../dl.dropboxusercontent.com/u/3500990/warm%20test%20150811.jpg_%3b%20filename_%3dUTF-8%27%27warm%2520test%2520150811.jpg" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33256"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 11/08/2015 - 15:47.</div>
    <div class="content">
     <p>Hi John - There are a couple of potential issues in play and to establish which is effecting you we really need to see the serial data. I wrote a helper script to negate the need to use minicom, You can cut and paste the screen data or&nbsp;it also saves to a file that can be easily attached to a comment here. Can you give that a whirl? <a href="11062.html#comment-33163">A&nbsp;guide is included a couple of posts back</a></p>
<p>we can tell much more from that data than the graphs,&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/53.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-53.jpg" alt="johncantor&#039;s picture" title="johncantor&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/53.html" title="View user profile.">johncantor</a> on Tue, 11/08/2015 - 16:04.</div>
    <div class="content">
     <p>OK Paul, I will have a look and try it out</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33312"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Thu, 13/08/2015 - 14:35.</div>
    <div class="content">
     <p>Update:</p>
<p>So I now have 4 emonTH&#39;s running with the delay line in and they have been spot on up until now.... Now I just switched on my emonTX again and the emonTH&#39;s are once again missing every other reading.</p>
<p>EDIT: Another screenshot added. I think I spotted a script in here to log data instead of using minicom. I will run it today and attach some data.</p>
<p>I just had a thought which is that the sampling and transmit frequency of the emonTX might be so fast that the RFM69 on the Pi is too busy sometimes to deal with the emonTH readings?</p>
<p>I will switch the TX off in a minute and see what happens.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33313"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 13/08/2015 - 14:35.</div>
    <div class="content">
     <p>@Tom - can you try the script above?</p>
<p>I suspect it may be traffic related and it would be good to see if there is a pattern, The script will give timestamped&nbsp;serial data.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33314"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Thu, 13/08/2015 - 14:36.</div>
    <div class="content">
     <p>Paul, I will do, just edited my post above at the same time as you posted.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33315"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Thu, 13/08/2015 - 14:52.</div>
    <div class="content">
     <p>Ok, I don&#39;t think monitoring will be required since I just turned the TX off and instantly all the TH readings are coming in on time. So I guess I should just reduce the transmit frequency of the TX.</p>
<p>Is the timing setting obvious when I look at the sketch or can someone point me in the right direction?</p>
<p>&nbsp;</p>
<p>Tom</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33316"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 13/08/2015 - 15:00.</div>
    <div class="content">
     <p>What does the inputs page show?</p>
<p>The phpfina feeds are ok for recording reliable data but they really aren&#39;t any good for debugging this type of issue.</p>
<p>Have you made any interval adjustments to the sketches? if still running a 62 second &quot;send&nbsp;interval&quot; there will also be several &quot;60 second fixed feed&quot; intervals that do not get updated, add that&nbsp;to a couple of packets dropped due to clashes and you could get significant &quot;dry spells&quot;.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33317"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 13/08/2015 - 15:19.</div>
    <div class="content">
     <p>Yes it is fairly easy to spot and increasing it most&nbsp;probably&nbsp;will&nbsp;improve things but it&#39;s not definitive, is every emonTx&nbsp;transmission&nbsp;successful ? what is the noise floor level compared to the rssi&#39;s of the dropped devices?&nbsp;</p>
<p>The length of the emonTx packet is twice as long as it needs to be if you are not using the 6 temp sensors there are provisions for and there is also a known issue that causes&nbsp;those unused&nbsp;values to cause the CRC checks to fail due to a bit sync error, the result of which would be that the receiver is spending too much time partially processing corrupt packets.</p>
<p>Increasing the interval is the same as driving at a lower speed would reduce the chance of an accident when you have bald tyres or something in your eye impairing you vision.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33318"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 13/08/2015 - 15:24.</div>
    <div class="content">
     <p>Good spot Paul. I have not updated Trystan&#39;s&nbsp;delay(20) to be dodelay(100) to minimize effect on battery life. We&nbsp;can look at reducing this in the future. This bumps the firmware version to V1.6.1</p>
<p><a href="https://github.com/openenergymonitor/emonTH/commit/ddb06430edfc24e31c46c23c25970ba974797db3">https://github.com/openenergymonitor/emonTH/commit/ddb06430edfc24e31c46c23c25970ba974797db3</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33319"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 13/08/2015 - 15:35.</div>
    <div class="content">
     <p>Hi Glyn, I don&#39;t think<a href="https://github.com/openenergymonitor/emonTH/blob/ddb06430edfc24e31c46c23c25970ba974797db3/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L321"> the second dodelay</a> is required, it only delays the spi being diabled after the rfm has already gone to sleep.</p>
<p>And previously the l<a href="https://github.com/openenergymonitor/emonTH/blob/ddb06430edfc24e31c46c23c25970ba974797db3/emonTH_DHT22_DS18B20_RFM69CW/emonTH_DHT22_DS18B20_RFM69CW.ino#L323-L325">ed on,&nbsp;dodelay, off,</a> was commented out is that supposed to still&nbsp;be active?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33321"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Thu, 13/08/2015 - 16:51.</div>
    <div class="content">
     <p>So I havn&#39;t&nbsp;yet modified the TX&#39;s interval, but I have captured some data using your script. It its attached and renamed to a .txt.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33323"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 13/08/2015 - 17:23.</div>
    <div class="content">
     <p>I haven&#39;t crunched any numbers yet but the 2 things that stand out (other than you are not using a stock emonTx sketch so the redundant temperature values mentioned above&nbsp;are not a problem) are that there is alot of noise in the -80dB&nbsp;to -100dB&nbsp;range and the emonTx&nbsp;signal is in the same region so the signal from the emonTx needs to be improved so it can overcome the noise, if you can get the poorest emonTx&nbsp;rssi&nbsp;above the bulk of the noise it may be possible to change the rssi threshold to -90dB&nbsp;and half the noise or -80dB would be better if the emonTx can be lifted enough. And the interval of the emonTx is only 2.5secs, way too fast for RF with 4 other nodes.</p>
<p>Too reuse my analogy above if you drive at 4x the recommended speed you will have problems&nbsp;regardless of any other issues :-)</p>
<p>Try setting the emonTx to 10 seconds and repositioning either it or the rfm2pi&nbsp;for a better signal,&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Fri, 14/08/2015 - 14:34.</div>
    <div class="content">
     <p>Hi Paul thanks for your reply. With regards to the timing. I am using the 3 Phase sketch and the only thing I had to do was calibrate the reading values. I have not ever changed the time to 2.5 seconds, is this already set on the github master?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33349"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 14/08/2015 - 15:11.</div>
    <div class="content">
     <p>Hi Tom, I would guess that time was set during some tests and not reverted before being&nbsp;committed, The recommended update interval is generally 10-15s for a emonTx. So I believe <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_3Phase_Voltage/emonTxV3_4_3Phase_Voltage.ino#L139">line 139 should be 10 not 2 (seconds)</a>&nbsp;but that will undoubtedly give you a ~10.5s interval, If you wish to correct that you could amend&nbsp;<a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_3Phase_Voltage/emonTxV3_4_3Phase_Voltage.ino#L346">L346</a>&nbsp;to absorb the looptime, in this case ~0.5s&nbsp;something like &quot;&nbsp;delay((TIME_BETWEEN_READINGS*1000)-500); &quot; should help but it&#39;s not that precise, not that it needs to be really.</p>
<p>​Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33374"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8504.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="tomstephens89&#039;s picture" title="tomstephens89&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8504.html" title="View user profile.">tomstephens89</a> on Sun, 16/08/2015 - 15:04.</div>
    <div class="content">
     <p>Ok Paul, I will update the timing to 10 secs when I am back in the office and report back.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33869"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8538.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="321liftoff&#039;s picture" title="321liftoff&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8538.html" title="View user profile.">321liftoff</a> on Sat, 05/09/2015 - 04:39.</div>
    <div class="content">
     <p>Could this issue also be&nbsp;affecting&nbsp;an&nbsp;emonBase from correctly receiving info from a emonTx v3.4? &nbsp;I get a lot of the following:</p>
<p>
2015-09-05 04:35:08,827 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 10 0 0 0 0 0 0 0 0 22 48 0 0 0 0 0 0 0 0 0 0 (-49)<br />
&nbsp;</p>
<p>and every once in a while it decodes it correctly:</p>
<p>
2015-09-05 04:34:58,273 DEBUG RFM2Pi 24 NEW FRAME : OK 10 0 0 0 0 0 0 0 0 26 48 0 0 0 0 0 0 0 0 0 0 0 0 0 0 (-50)<br />
2015-09-05 04:34:58,295 DEBUG RFM2Pi 24 Timestamp : 1441427698.27<br />
2015-09-05 04:34:58,298 DEBUG RFM2Pi 24 From Node : 10<br />
2015-09-05 04:34:58,310 DEBUG RFM2Pi 24 Values : [0, 0, 0, 0, 123.14, 0, 0, 0, 0, 0, 0, 0]<br />
2015-09-05 04:34:58,313 DEBUG RFM2Pi 24 RSSI : -50<br />
2015-09-05 04:34:58,316 INFO RFM2Pi Publishing: emonhub/rx/10/values 0,0,0,0,123.14,0,0,0,0,0,0,0<br />
2015-09-05 04:34:58,340 DEBUG RFM2Pi 24 adding frame to buffer =&gt; [1441427698, 10, 0, 0, 0, 0, 123.14, 0, 0, 0, 0, 0, 0, 0, -50]<br />
2015-09-05 04:34:58,343 DEBUG RFM2Pi 24 Sent to channel&#39; : ToEmonCMS<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33871"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 05/09/2015 - 07:07.</div>
    <div class="content">
     <p>Packets of the form 10 0 0 0 0 0 0 0 0 22 48 are very similar to the startup test packets send by the emontx and emonth to test that the radio works. If your seeing a lot of these it might be that the emontx is resetting which could be caused if only powering from an ACAC Adapter. What firmware are you running? and do you have external sensors connected? What happens if you add USB power, if it is ACAC only at the moment?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33876"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8538.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="321liftoff&#039;s picture" title="321liftoff&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8538.html" title="View user profile.">321liftoff</a> on Sat, 05/09/2015 - 14:00.</div>
    <div class="content">
     <p>You are correct, it is on ACAC at the moment. &nbsp;I&nbsp;don&#39;t have any CTs connected as I don&#39;t have those yet, so that is why the power readings are 0. &nbsp;Is that why you think they&nbsp;look&nbsp;like test packets?&nbsp; I don&#39;t&nbsp;have any external devices connected, so the ACAC should be okay to power the emonTx. &nbsp;I don&#39;t think the emonTx is&nbsp;resetting, because when I watch the red led, I can correlate&nbsp;the flash (1/10seconds) with the packet, either &#39;unreliable content&#39; or decoded; it never does the fast 10 pulses similar to a powerup. &nbsp;emonTx&nbsp;was just purchased, so I assume firmware is 3.4 hardware with 1.6 firmware.</p>
<p>Let me know if I should start a new thread to help troubleshoot this particular case. &nbsp;Meanwhile, I can still&nbsp;try the USB power if that is still needed.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33881"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8538.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="321liftoff&#039;s picture" title="321liftoff&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8538.html" title="View user profile.">321liftoff</a> on Sat, 05/09/2015 - 14:23.</div>
    <div class="content">
     <p>I have attached a&nbsp;5min CSV file from python script. &nbsp;It appears that the OK data has an extra QTY 4 &quot;0&quot; (bytes), whereas all the others do not. &nbsp;I find it odd that all the &quot;noise&quot; packets (&lt;-70dbm) are all the same length; must be determined by the code assuming a fixed packet length?</p>
<p>For the packets that are &#39;?&#39; but should be OK, note that the node id is consistently correct (10), the RSSI is solid, the voltage is same as OK packets and in the correct location. and these packets correctly&nbsp;are appearing every 10s. &nbsp;So somehow,&nbsp;my&nbsp;good packets are ending up as these noisy&nbsp;21 byte packets instead of OK&nbsp;25byte&nbsp;packets.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33885"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 05/09/2015 - 15:28.</div>
    <div class="content">
     <p>Take a look at the&nbsp;<a href="10900.html">Data loss due to RF packets getting corrupted</a>&nbsp;thread, it is more likely that you are seeing that error than this one.</p>
<p>The &quot;other&quot; issue is a bit syncing issue caused by the long run of&nbsp;zero temperture values, in theory the zero CT values could do the same but you appear to be ok there, since the voltage reading is a valid value even on the failed packets, so it is probably the run of 6 zero temps + 1 &nbsp;zero pulse count&nbsp;(112 0&#39;s) rather than the 4 zero&nbsp;powers (64 0&#39;s).</p>
<p>The (printed)&nbsp;length of a failed packet is truncated&nbsp;at 20byte by code in the receiver&nbsp;(rfm2pi) so we do not know the true length of the failed packets.</p>
<p>To determine if this is the issue you will need to either edit the emonTx sketch to introduce some non-zero values and/or edit the rfm2pi&nbsp;sketch to allow a longer sample of failed packet ie&nbsp;&gt;25 bytes, to see the end of the packet</p>
<p>Do you have a USB programmer?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33897"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8538.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="321liftoff&#039;s picture" title="321liftoff&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/8538.html" title="View user profile.">321liftoff</a> on Sat, 05/09/2015 - 20:55.</div>
    <div class="content">
     <p>Paul,</p>
<p>You&#39;re right, my issue is at the other thread. &nbsp;I&#39;ll continue there.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39584"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7376.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7376.jpg" alt="allmac&#039;s picture" title="allmac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTH Unreliable reading timing?</h3>

    <div class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Sun, 21/02/2016 - 08:49.</div>
    <div class="content">
     <p>I tried Robert code (RFM69_LL.txt)&nbsp;with a prototype&nbsp;(Arduino&nbsp;Nano&nbsp;+&nbsp;RFM69C)... and my&nbsp;Emoncms&nbsp;(Raspberry +&nbsp;RFM69Pi)&nbsp;did receive data without problem.</p>
<p>However, when it was ON,&nbsp;my&nbsp;EmonTX&nbsp;Shield did stop&nbsp;to send data to&nbsp;RFM69Pi (I was able to receive &quot;some&quot; data &quot;sometimes&quot;).</p>
<p>Than I did turn OFF my&nbsp;prototype,&nbsp;EmonTX&nbsp;Shield and Raspberry... (full&nbsp;hard reset).<br />
And did turn ON only&nbsp;EmonTX&nbsp;Shield&nbsp;and Raspberry.<br />
Without&nbsp;sucess!&nbsp;It&nbsp;apeears&nbsp;that after this, something did change my&nbsp;RFM69Pi&nbsp;or the&nbsp;Shield.</p>
<p>What I found different...<br />
EmonTX&nbsp;Shield should send: 6 input data +&nbsp;RSSI.<br />
I see input data in&nbsp;minicom like: 13 input +&nbsp;RSSI:&nbsp;OK 5 60 1 103 0 22 0 182 0 125 0 32 0 (-50)<br />
If you remove 1 digit numbers, than I believe that this&nbsp;sould&nbsp;be the correct data.</p>
<p>Any idea what can be happening? What could be modified just running your&nbsp;code from another prototype.<br />
Thanx&nbsp;a lot.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11062"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Gq-AMOO76ln3NQc785W7O94dJTZavHcolDjhfCkzaCE" value="form-Gq-AMOO76ln3NQc785W7O94dJTZavHcolDjhfCkzaCE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
