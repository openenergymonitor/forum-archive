<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12549 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:15:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Large monitoring rollout: how to differentiate output from several emonpi units. | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Large monitoring rollout: how to differentiate output from several emonpi units.</h3>
        <span class="submitted">Submitted by <a href="../user/8410.html" title="View user profile.">waterford</a> on Sun, 24/04/2016 - 08:20</span>
        <div class="content"><p>I am trying to rollout OEM across a large school campus, and feeding the outputs into a cloud server.</p>
<p>I will have about 10 emonpi units, each collecting data from about 4 emontx units. The school campus covers several hectares.</p>
<p>I have no problem in giving the emontx boxes different node numbers.</p>
<p>What is still puzzling me is</p>
<p>1. how do I make sure that data from each emontx is picked up by only one emonpi, if two happen to be in range?</p>
<p>2. how does the emoncms server in the cloud differentiate feeds from all the different emonpi units?</p>
<p>I suspect that the answer to each of these is probably quite straight forward, but I have not found a clear guide.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12468.html" class="topic-previous" title="Go to previous forum topic">‹ Simple Zoom Problem</a>
              <a href="12538.html" class="topic-next" title="Go to next forum topic">Send message to Emonhub ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-41419"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8410.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8410.jpg" alt="waterford&#039;s picture" title="waterford&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/8410.html" title="View user profile.">waterford</a> on Tue, 26/04/2016 - 16:16.</div>
    <div class="content">
     <p>OK. I have sorted out (1) myself; was missing the lines for network group in both</p>
<p>emonhub.conf-&nbsp; line 55</p>
<p>and in the arduino sketch-&nbsp;&nbsp; line 113</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41484"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 28/04/2016 - 18:06.</div>
    <div class="content">
     <p>Hi,</p>
<p>Great to hear of your project. Sorry for slow reply. Here are my answers&nbsp;</p>
<p>1. You need to have seperate network groups for each system that you want to keep sperate. E.g. all RF nodes on 210 (default) will be picked up by the emonPi. If you changed nodes to a different&nbsp;group e.g. 200 the emoPi on 210 would not be able to receive. Network group can be changed in emonTH / emonTx firmware and set emonPi group in emonhub.conf.&nbsp;</p>
<p>&nbsp;</p>
<p>2. Each node will have to have a different node ID.&nbsp;</p>
<p>The emonPi node ID (default 5) is set <a href="https://github.com/openenergymonitor/emonpi/blob/master/firmware/firmware/firmware.ino#L122">here in emonPi firmware</a>&nbsp;L122. You will also need to make corresponding change to emonhub.conf. See emonhub&nbsp;configuration info:</p>
<p><a href="https://github.com/openenergymonitor/emonhub/blob/emon-pi/configuration.md" title="https://github.com/openenergymonitor/emonhub/blob/emon-pi/configuration.md">https://github.com/openenergymonitor/emonhub/blob/emon-pi/configuration.md</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41490"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 29/04/2016 - 09:44.</div>
    <div class="content">
     <p>The ability to change the groups will help reduce the &quot;noise&quot; as&nbsp;neighboring&nbsp;groups will not be collecting packets destined for other emonpi&#39;s&nbsp;but it won&#39;t help with identifying the nodes at emoncms unfortunately as you are still restricted to 30 valid (1-30)&nbsp;node id&#39;s which won&#39;t cover the estimated 10 groups of 5 nodes&nbsp;(1 emonpi + 4 emonTx)&nbsp;</p>
<p>Keeping each emonpi network as a separate group in this way is usually the better option and it&#39;s a neater way of doing things but if you do&nbsp;find that you have &quot;borderline&quot; devices that struggle to reach a designated emonpi group, a neighboring emonpi may offer a second chance if it&#39;s also within it&#39;s grasp and shares the same group id.&nbsp;</p>
<p>There was a feature written into the &quot;experimental&quot; version of emonhub&nbsp;that was added for the purpose of extending and identifying the nodes from multiple groups, it is a setting called &quot;nodeoffset&quot; in normal running this would assume a value of 0 and it&#39;s presence go unnoticed, by setting this value to say 32 on a second device or interfacer it would give you a whole second range of node&nbsp;ids by simply adding 32 to each of the incoming packets node ids eg a second emonpi with no alteration beyond setting &quot;nodeoffset = 32&quot; in the conf would present itself as node 37 (5+32). setting a 3rd as &quot;nodeoffset&nbsp;= 64&quot; would be seen as node 69 etc.</p>
<p>I have tested this with a hand full of devices during development and although I see no reason it wouldn&#39;t work for&nbsp;10 ranges I haven&#39;t tried it, 10 ranges of 32 node ids is probably far more than you will ever need but I chose 32 as an example as it makes the full range of node ids available for each device and&nbsp;prevents any overlap.</p>
<p>For example if you were to set a nodeoffset of 10 it will still work and it will give you a much&nbsp;smaller range of potential node ids (10x10) but it caps the node ids to 1-9&nbsp;on each device as setting a node id of 12 would clash with the next hubs node 2+offset 10. and node 22 would clash with the 3rd node 2 etc.</p>
<p>Setting the offset to 32 is easier as it not only more robust, it also means no firmware changes (due to node id changes) since the RF networks remain as they are only the emonhub.conf needs changing. In addition to adding the setting you will also need to edit the [nodes] entries to suit the new range.</p>
<p>I have looked at the &quot;emon-pi&quot; variant of emonhub&nbsp;which was derived from that experimental version&nbsp;and the code seems to still be there but I do not know if it is still intact or functional as there have been many changes and this lesser known feature will not have been tested along the way.</p>
<p>If you or someone else would like to test briefly then editing the emonhub.conf to include &quot;nodeoffset = 64&quot; in the [interfacers]&nbsp;[[RFM2Pi]]&nbsp;[[[runtimesettings]]] and editing [[5]] to be [[69]] in the [nodes] section should work, if it doesn&#39;t appear at emoncms&nbsp;then take a look in the emonhub.log as it may well be the out bound interfacers that are preventing it working since they have had extensive work without awareness of this feature.</p>
<p>You mention the &quot;cloud&quot; emoncms, do you mean emoncms.org or your own instance? there is a 32 node restriction in&nbsp;emoncms, in a locally installed instance you can increase that restriction within the settings.conf and the &quot;32&quot; used here is a maximum count not a maximum id so if you do have 50 nodes across a range of 320 valid id&#39;s you can still set the max count to 50, 60 or 100 etc.</p>
<p>Unfortunately&nbsp;emoncms.org will only allow node id&#39;s &lt; 32 so it is not really an&nbsp;option for 50 nodes.</p>
<p>Sorry if my explanation sounds complex but if the code is intact in the &quot;emon-pi&quot; variant then it is in fact very simple and quite&nbsp;probably the only way to squeeze 50 node ids out of the available 30, I hope it works for you.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41517"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8410.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8410.jpg" alt="waterford&#039;s picture" title="waterford&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/8410.html" title="View user profile.">waterford</a> on Sun, 01/05/2016 - 02:54.</div>
    <div class="content">
     <p>Thanks for that.</p>
<p>Luckily we thought that imposing a large installation on emoncms.org would be unfair and set up our own cloud server- energy.waterford.sz.</p>
<p>The node offset will work just fine. I have tried an offset all the way up to 384, (32x12) and it works when I then set the node id from [[10]] to [[394]] for a Tx that has dip switch on 10.</p>
<p>Changing the [[5]] does not seem to do much, as I do not use the emonPi as a sensor.</p>
<p>So every emonTx box will show up uniquely on the cloud server. It does mean that the emonhub.conf will need to be set up carefully on each emonPi, but that will only be a once off.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41520"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 01/05/2016 - 10:40.</div>
    <div class="content">
     <p>Good to hear it is working.</p>
<p>With regard to the individual emonhub.conf&#39;s there are several options as emonhub was originally written offer the user flexibility and/or keep the configuration to a minimum rather than provide a pre-configured conf.</p>
<p>Firstly, as your node ids&nbsp;are all unique across&nbsp;your project you could use the same emonhub.conf copied to all 10 emonpi&#39;s, the [nodes] section could list all 40 active nodes and only the nodeoffset (and group?) need to be changed on each emonpi.</p>
<p>Secondly you could just delete the contents of the [nodes] section. The original code would run with no nodes defined if the values within those node&#39;s payloads were all integers which I believe the default emonTx&nbsp;v3 FW does. The downside of this very easy method is that the values would not get the &quot;scale&quot; corrections applied at the emonpi and would arrive at emoncms&nbsp;requiring scaling eg the voltage values would require a x0.01 process inserted at the beginning of the processlist.</p>
<p>there are other options in&nbsp;besides&nbsp;those 2, including for example&nbsp;this third option where you only define&nbsp;the essential data for the actual nodes used. so your [nodes] section would look something along the lines of (I have only included 2&nbsp;emonTx&#39;s&nbsp;(9&amp;10)&nbsp;per group here to keep it short)&nbsp;</p>
<p>[[9]]<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1,1,1,1,0.01,0.1,0.1, 0.1,0.1,0.1,0.1,1</p>
<p>[[10]]<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1,1,1,1,0.01,0.1,0.1, 0.1,0.1,0.1,0.1,1</p>
<p>[[41]]<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1,1,1,1,0.01,0.1,0.1, 0.1,0.1,0.1,0.1,1</p>
<p>[[42]]<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1,1,1,1,0.01,0.1,0.1, 0.1,0.1,0.1,0.1,1</p>
<p>[[73]]<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1,1,1,1,0.01,0.1,0.1, 0.1,0.1,0.1,0.1,1</p>
<p>[[74]]<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1,1,1,1,0.01,0.1,0.1, 0.1,0.1,0.1,0.1,1</p>
<p>etc etc all the way up to your last active node id, this nodes section could then be used in all 10 emonpi&#39;s emonhub.conf. There is no need to define the emonpi or all the other unused nodes. This will only save you from defining the scales in emoncms&nbsp;so it may be tidier to just have an empty nodes section and do it all at emoncms?</p>
<p>There is something you should be aware of when using the emonpi&nbsp;with a remote server. The emonpi will forward the data in 30 sec batches and has no buffering, there is no confirmation of receipt before the data is deleted either. So if you have anything less than a perfectly reliable network connection and a server that is always able to receive and process data first time, all the time it will result in data loss as the&nbsp;emonpi&#39;s will simply&nbsp;&quot;fire and forget&quot; every 30secs.&nbsp;</p>
<p>If you think this is likely to be an issue then for&nbsp;forwarding only, the original emonhub is by&nbsp;far a better solution not only for normal running reliability but also since&nbsp;you can set a larger buffer if required it facilitates server maintenance, my installs are all configured to buffer at least 24hrs data so a server can be taken down for maintenance etc and as long as it&#39;s back up within 24 hrs there will be no loss of data (providing there were no power interruptions to the Pi&#39;s as the buffer is in ram)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41526"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8410.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8410.jpg" alt="waterford&#039;s picture" title="waterford&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/8410.html" title="View user profile.">waterford</a> on Sun, 01/05/2016 - 17:43.</div>
    <div class="content">
     <p>Things are looking better and better.</p>
<p>Yes, I did notice that the emoncms server already picked up voltage before a node was correctly defined, although out by a few powers of 10. I am mulling over the options that you suggest, although so far I think I will go for option 3, defining only the essential data for all the nodes in a common file. It looks neat and the further we move up the hierarchy, the less expert my operators will become. I work on the lowest level configuration and development, but I&#39;m also training a technician in the IT dept to do the routine installation and maintenance Txs and Pis and that can include calibration. We would not like to have students risk electrocution, but we do hope to have a group of able and interested students enjoy creating feeds, building the dashboards and making apps as a community service project. It will make a better impression if the numbers are sensible as they come in to emoncms.</p>
<p>Data reliability can be an issue in Swaziland, where power cuts are frequent and Internet can suddenly slow to a crawl. We can live with an update every 5 minutes, which means that we can afford to lose a fair amount of data. Nevertheless it is worth looking at options for improved reliability.</p>
<p>1. How easy will it be to have an emonPi run emonhub software, as you suggest? I already have the emonPis.</p>
<p>2. We actually have two emoncms servers running: the cloud server, as mentioned, which I hope will soon be giving read access to the school website, but I have also set up a server on the school Intranet which has generator backup and is immune to the vagaries of the Internet connection. For now I have the emonPis feed into both of them independantly. However the best solution might be for the Intranet emoncms server to act as a buffer to the cloud server. Is there an easy-ish way to do that? There will not be a problem if the cloud server falls behind by a few hours, or even a day from time to time.</p>
<p>I&#39;m not much of a mysql expert- I would need clear instructions- but running rsync as a chron job every few minutes on a set of files would be fairly straightforward for me.</p>
<p>Thanks for all the help so far.</p>
<p>Quinton</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41532"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 01/05/2016 - 22:16.</div>
    <div class="content">
     <p>It could be fairly easy to get original emonhub&nbsp;(v1.2)&nbsp;running on an emonpi&nbsp;as&nbsp;it is at the heart just&nbsp;a regular raspberry&nbsp;pi, there is no official route or guide as the only current option promoted by OEM is the single user local emoncms&nbsp;SDcard which uses the emon-pi variant of emonhub.</p>
<p>As a forwarding only solution installing Raspbian,&nbsp;configuring&nbsp;the <a href="https://github.com/emoncms/emoncms/blob/master/docs/RaspberryPi/read-only.md#read-only-mode">filesystem to be read-only</a> and then&nbsp;<a href="https://github.com/emoncms/emoncms/tree/master/docs/RaspberryPi#install-emonhub">installing emonhub&nbsp;v1.2 using the installer</a> is pretty much all that is required for a very robust &quot;fit and forget&quot; install&nbsp;(each of these parts is documented in the main emoncms&nbsp;install&nbsp;docs). But that doesn&#39;t utilize the emonpi&#39;s &nbsp;LCD and&nbsp;button, nor does it fully utilize the emonpi add-on board since the GPIO&nbsp;will not get configured for the OOK&nbsp;and/or the reset/power button etc, the emonpi board will however continue to function as both an RF transceiver and a 2CT energy monitor via the serial port (even though the latter part may not be important to&nbsp;you). Using the&nbsp;more &quot;emonPi&quot; type elements would require some&nbsp;dissection&nbsp;of&nbsp;the <a href="https://github.com/openenergymonitor/emonpi">emonPi&nbsp;repo</a> as they are not available separately.</p>
<p>Power outages at the emonTx&#39;s&nbsp;isn&#39;t normally a concern as if the powers out there is nothing to monitor, the emonpi&#39;s might benefit from adding a small battery pack perhaps? that would prevent minor power glitches from disturbing things and it is worth noting the current emonpi&nbsp;SDcard&nbsp;image has a writable partition and does do some persisting other than feed data, if data is being written when the power fails that would cause the whole&nbsp;SDcard to fail rather than just the write partition.</p>
<p>the original emonhub&nbsp;does not have a write partition and does not write anything to disc&nbsp;in normal operation so sd card failure is reduced significantly, although it could still benefit&nbsp;from a&nbsp;battery pack to avoid losing any yet undelivered data still held in ram.</p>
<p>The buffers are per target server so when you have multiple servers it would retain independent &quot;queues&quot; for each and deliver when it could.</p>
<p>It is worth noting that the &quot;emonpi update scripts&quot; will not be available for use if not using the full emonpi&nbsp;install and if you are currently using the emoncms&nbsp;&quot;emonhub&quot; webpage via a browser to edit emonhub.conf you would need to switch to using ssh unless the full apache/emoncms/sql stack is installed IMO thats a lot of complication for a potentially one of&nbsp;set-up, that way&nbsp;the firewall can be&nbsp;closed (except for ssh)&nbsp;and a secure key used for&nbsp;ssh access rather than 10 different (the same ?) user/password&nbsp;logins.&nbsp;&nbsp;</p>
<p>If you are wanting to let the students loose on the feeds and dashboards you can have more targets set up in emonhub so that you can easily have accounts for different student groups and/or a master account too. Since you have access to the feed files and the SQL tables you can effectively &quot;reset&quot; accounts by deleting the user account,&nbsp;creating a new one, copying in the data and editing the apikey to the previously used one for the deleted account in the SQL table.</p>
<p>I do not know of a way to make one emoncms&nbsp;forward data to another and think you may stray into issues using a live rsync&nbsp;solution as some data is held in redis or read from the sql tables&nbsp;and not always read from the persisted feed files. it might be possible but&nbsp;at best it&#39;s unchartered waters to my knowledge.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41538"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8410.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8410.jpg" alt="waterford&#039;s picture" title="waterford&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/8410.html" title="View user profile.">waterford</a> on Mon, 02/05/2016 - 12:45.</div>
    <div class="content">
     <p>I have some queries about your instruction.</p>
<p>1. Making a read only filesystem seems to assume that there is a /home/pi/emonpi folder, but after installing raspbian pi&#39;s home is empty. Do I install emonhub first?</p>
<p>2. Do install emoncms at all?</p>
<p>3. If I don&#39;t install emoncms, do I need to configure wireless using ifupdown and the /etc/network/interfaces file</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41540"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 02/05/2016 - 14:37.</div>
    <div class="content">
     <p>My &quot;instruction&quot; was a very loose main points only generalization, We can work through the various&nbsp;steps if you are wanting to give it a whirl.</p>
<p>See the <a href="5331.html">&quot;Configuring Raspbian as Read-Only&quot;</a>&nbsp;thread for the original read-only instructions, they have been altered a fair bit for the emonSD image for the 3rd &quot;data&quot; partition which you do not need and rather than writing/editing the fstab that guide does seem to symlink&nbsp;a replacement which will only work if using a emonpi image.</p>
<p>There are&nbsp;additional RAM partitions for openHAB and dchp in the newer guide, if you are not using openHAB that partition&nbsp;(and directory) is not required. As for dchp&nbsp;I use a different method which works really well for me but I have no idea how it will mesh with any other &quot;emonpi&quot; networking strategies if you use adopt them.</p>
<p>I like to keep it simple and just&nbsp;symlink the 2 dchp files to /tmp.</p>
<p>&nbsp; &nbsp; sudo mv /etc/resolv.conf /tmp<br />
&nbsp; &nbsp;&nbsp;sudo ln -s /tmp/resolv.conf /etc/resolv.conf<br />
&nbsp; &nbsp;&nbsp;sudo mv /var/cache/unbound/resolvconf_resolvers.conf /tmp<br />
&nbsp; &nbsp;&nbsp;sudo ln -s /tmp/resolvconf_resolvers.conf /var/cache/unbound/resolvconf_resolvers.conf</p>
<p>Raspbian&nbsp;wheezy&nbsp;had a bit of a problem with keeping a&nbsp;wifi&nbsp;connection alive so a reconnection script was used, I would say try Jessie without at first (if using&nbsp;wifi&nbsp;of course) and if you have issues you can choose a&nbsp;wifi&nbsp;script if required.&nbsp;</p>
<p>The installation of <a href="https://github.com/emonhub/ntp-backup">ntp-backup</a>&nbsp;is essential if you have anything less than a 100% reliable network and just to start off on the right foot ensure you &quot;first boot&quot; with a known good internet connection or run in &quot;write&quot; mode until the time is corrected, after that the time keeping will be at worst &quot;in the right ball park&quot; see the <a href="5877.html">&quot;Read-only time issues&quot;</a> thread if you want more details on how that works.</p>
<p>If you install ufw (uncomplicated firewall) be sure to allow SSH (port 22) before enabling it&nbsp;(unless you have a keyboard and screen handy).</p>
<p>Emonhub&nbsp;is a one liner install but you can also also add the menu commands to make it&#39;s use easier with</p>
<p>&nbsp; &nbsp; wget&nbsp;-O ~/hub_utils.sh&nbsp;https://openenergymonitor.org/emon/sites/default/files/emonhub_utilities_0.txt<br />
&nbsp; &nbsp;&nbsp;chmod&nbsp;+x ~/hub_utils.sh &amp;&amp; ~/hub_utils.sh</p>
<p>accessing the emonhub.conf is then as easy as emonhub -c etc, type emonhub -h for help.</p>
<p>It would be a good idea to setup logrotate&nbsp;to prevent the &quot;/var/log&quot; partition filling up with messages etc.</p>
<p>EmonCMS is not required for a forwarding only set up.</p>
<p>The interfaces file shouldn&#39;t need editing unless you plan to use fixed IP&#39;s or a non-standard network set up. If your network will recognize&nbsp;hostnames&nbsp;then just use the &quot;change hostname&quot; option after&nbsp;&quot;sudo raspi-config&quot; and name each emonpi something unique, otherwise you will need to allocate fixed IP&#39;s and depending on your network you then may need to add the details to the interfaces file, but that is usually only&nbsp;to setup inbound access to the pi from outside the LAN.&nbsp;</p>
<p>Change the emonpi timezones&nbsp;to get the error logs to log in your local time, the data is actually passed with&nbsp;unix timestamps so it&#39;s not mandatory.</p>
<p>If just using wifi then you will need to add your ssid and password to the wpa_suppliment.conf file as usual.</p>
<p><span style="line-height: 20.8px;">I&#39;ve&nbsp;</span><span style="line-height: 20.8px;">ratt</span><span style="line-height: 20.8px;">led</span><span style="line-height: 20.8px;">&nbsp;this off from memory so please forgive me if I&#39;ve missed something out but the basics are covered I think. There is other stuff you could install like avrdude and the autoreset script if you plan on updating the emonpi FW remotely.</span></p>
<p><span style="line-height: 20.8px;">Paul</span></p>
<p><span style="line-height: 20.8px;">Oh and I just recalled the &quot;easily overlooked&quot; but crucial editing of the /boot/cmdline.txt to free up the gpio serial port. Since the launch of the Pi3 Ithink the bit to remove will include something like &quot;console=/dev/<strong>serial0</strong>,115200&quot; it&#39;s pretty well documented thoughout the site and guides but the device&nbsp;has recently changed from /dev/ttyAMA0 to /dev/serial0&nbsp;or something pretty similar.</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41578"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8410.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8410.jpg" alt="waterford&#039;s picture" title="waterford&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/8410.html" title="View user profile.">waterford</a> on Thu, 05/05/2016 - 10:57.</div>
    <div class="content">
     <p>Hi Paul.</p>
<p>I may well give it a go. Before I start though, is there a reasonable way to monitor via ssh the inputs that emonhub is receiving and posting if I haven&#39;t installed emoncms?</p>
<p>Just if anyone is interested, the large node offsets only work well with my cloud emoncms, which is version 9.5. My intranet server (V8.5) does not , and the emonpi boxes, also v8.5, show green time stamps, but the text next to them is &quot;inactive&quot; and no data is displayed.&nbsp; Maybe there is just a tweak to be made to the emoncms?</p>
<p>Is there any working image of the emonpi with emoncms v9?</p>
<p>emonhub log:</p>
<p>2016-05-05 10:48:08,655 DEBUG RFM2Pi 1439 NEW FRAME : OK 10 0 0 0 0 0 0 0 0 135 99 184 11 184 11 184 11 184 11 184 11 184 11 1 0 (-55) 2016-05-05 10:48:08,659 DEBUG RFM2Pi 1439 Timestamp : 1462445288.66 2016-05-05 10:48:08,660 DEBUG RFM2Pi 1439 From Node : 10 2016-05-05 10:48:08,660 DEBUG RFM2Pi 1439 Values : [0, 0, 0, 0, 232.39411187399998, 300, 300, 300, 300, 300, 300, 1] 2016-05-05 10:48:08,661 DEBUG RFM2Pi 1439 RSSI : -55 2016-05-05 10:48:08,662 INFO RFM2Pi Publishing: emonhub/rx/10/values 0,0,0,0,232.394111874,300,300,300,300,300,300,1 2016-05-05 10:48:08,665 DEBUG RFM2Pi 1439 adding frame to buffer =&gt; [1462445288, 10, 0, 0, 0, 0, 232.39411187399998, 300, 300, 300, 300, 300, 300, 1, -55] 2016-05-05 10:48:08,666 DEBUG RFM2Pi 1439 adding frame to buffer =&gt; [1462445288, 10, 0, 0, 0, 0, 232.39411187399998, 300, 300, 300, 300, 300, 300, 1, -55] 2016-05-05 10:48:08,667 DEBUG RFM2Pi 1439 Sent to channel&#39; : ToEmonCMS 2016-05-05 10:48:11,181 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 167 168 103 207 58 58 244 181 182 22 184 143 210 150 213 26 78 104 135 120 230 (-100) 2016-05-05 10:48:11,688 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 3 150 250 172 18 159 131 179 214 117 225 153 82 115 250 187 58 204 128 249 218 (-101) 2016-05-05 10:48:12,833 INFO energywaterfordsz sending: http://energy.waterford.sz/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1462445268,10,0,0,0,0,231.73739944199997,300,300,300,300,300,300,1,-54],[1462445278,10,0,0,0,0,231.664431394,300,300,300,300,300,300,1,-53],[1462445288,10,0,0,0,0,232.39411187399998,300,300,300,300,300,300,1,-55]]&amp;sentat=1462445292 2016-05-05 10:48:14,751 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 12 215 223 14 50 181 13 152 5 58 226 159 115 5 130 112 191 110 142 112 148 (-98)</p>
<p>emoncmslog:</p>
<p>2016-5-5 10:49:51 MQTT INFO Reloading config 2016-5-5 10:49:57 MQTT INFO Reloading config 2016-5-5 10:49:57 MQTT INFO Received mqtt message: emonhub/rx/10/values 0,0,0,0,231.928940568,300,300,300,300,300,300,1 2016-5-5 10:50:03 MQTT INFO Reloading config 2016-5-5 10:50:07 MQTT INFO Received mqtt message: emonhub/rx/10/values 0,0,0,0,231.90157755,300,300,300,300,300,300,1 2016-5-5 10:50:09 MQTT INFO Reloading config 2016-5-5 10:50:15 MQTT INFO Reloading config 2016-5-5 10:50:15 FEEDWRITER INFO PHPTimeSeries bytes written: 0 2016-5-5 10:50:15 FEEDWRITER INFO PHPFina bytes written: 0 2016-5-5 10:50:17 MQTT INFO Received mqtt message: emonhub/rx/10/values 0,0,0,0,231.892456544,300,300,300,300,300,300,1 2016-5-5 10:50:21 MQTT INFO Reloading config 2016-5-5 10:50:27 MQTT INFO Reloading config 2016-5-5 10:50:27 MQTT INFO Received mqtt message: emonhub/rx/10/values 0,0,0,0,231.965424592,300,300,300,300,300,300,1 2016-5-5 10:50:33 MQTT INFO Reloading config 2016-5-5 10:50:37 MQTT INFO Received mqtt message: emonhub/rx/10/values 0,0,0,0,231.928940568,300,300,300,300,300,300,1 2016-5-5 10:50:39 MQTT INFO Reloading config 2016-5-5 10:50:45 MQTT INFO Reloading config 2016-5-5 10:50:47 MQTT INFO Received mqtt message: emonhub/rx/10/values 0,0,0,0,231.755641454,300,300,300,300,300,300,1</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41582"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Large monitoring rollout: how to differentiate output from several emonpi units.</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 06/05/2016 - 19:29.</div>
    <div class="content">
     <p><a href="https://community.openenergymonitor.org/t/re-large-monitoring-rollout-how-to-differentiate-output-from-several-emonpi-units/243">This thread has is now continued on the new forum</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12549"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-R6uPyN_WhMjA66kaeYH2SYp5iYswtLa82woQKfBB5og" value="form-R6uPyN_WhMjA66kaeYH2SYp5iYswtLa82woQKfBB5og"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
