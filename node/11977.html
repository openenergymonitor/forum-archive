<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11977 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:55:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonTx locks up after a week or two, needs to be repowered | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonTx locks up after a week or two, needs to be repowered</h3>
        <span class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Tue, 12/01/2016 - 03:09</span>
        <div class="content"><p>I bought two emonTx V3&#39;s last summer, and have them both feeding an emonBase via RF.</p>
<p>One works perfectly. The other one runs for a few weeks and then appears to freeze. Its data is no longer appearing on the emonPi.</p>
<p>Other than putting on a timer to periodically repower it (not a good thing), what else can I do? I don&#39;t see a replacement circuit board for sale on the site.</p>
<p>&nbsp;</p>
<p>Tks.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12084.html" class="topic-previous" title="Go to previous forum topic">‹ Why do I have two sets of API?</a>
              <a href="11794.html" class="topic-next" title="Go to next forum topic">New emonpi setup with Edimax wifi dongle keeps disconnecting ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-38175"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 12/01/2016 - 09:53.</div>
    <div class="content">
     <p>Are both running the same sketch?<br />
Have you any idea where/why it locks up - might&nbsp;it be temperature-related, for example? Or a massive burst of interference from another appliance?</p>
<p>The first thing I would do is take a hand lens and very carefully look at the soldering on the radio module. That is the likeliest area for a fault that would stop it completely.</p>
<p>The assembled emonTx&nbsp;V3&nbsp;is available from the <a href="http://shop.openenergymonitor.com/emontx-v3-electricity-monitoring-transmitter-unit-433mhz/">Online Store</a> without a case and accessories, I would not recommend trying to obtain a bare PCB and transferring the components.<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38179"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 12/01/2016 - 12:36.</div>
    <div class="content">
     <p>Also when you say &quot;appears to freeze. Its data is no longer appearing on the emonPi.&quot; &nbsp;is it possible the emonTx is still sending but the packets are not recieved? can you still see an led flash (assuming it&#39; not battery powered) ? if there is usually a flashing led.</p>
<p>What do you have connected to this emonTx (and is that the same as the other) ? depending on the era or emonTx is pulse counting ? or running a continuous sampling sketch with accumulating Wh&#39;s&nbsp;that could cause a&nbsp;possible roll over issue? Do you have temperture sensors, if so how many?&nbsp;</p>
<p>Again depending on era (last summer this is the most probable) do you have upto 6 unpopulated temp sensor&nbsp;values all reporting 0? This could cause &quot;bitslip&quot; at the reciever&nbsp;(emonPi)..</p>
<p>If the led is flashing and the firmware/hardware combo fits we can try and check for discarded&nbsp;packets.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38197"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Tue, 12/01/2016 - 17:31.</div>
    <div class="content">
     <p>Those are a lot of good thoughts from both response. <strong>Thank you</strong>.</p>
<p>Both emonTx&#39;s are as they came from the factory from last year, with no sketches uploaded since purchase.&nbsp; They are V3 but <strong>I am not sure of the firmware version - is there a way to tell?</strong></p>
<p>The two units are id 10 (the failing one) and 9 and are feeding the same emonHub. Both units are indoors, sitting side by side on a shelf, so temperature shouldn&#39;t be an issue - or if it was, I would expect problems with both units. The failing unit has 4 current sensors, a pulse counter (optical) and one temperature sensor. The non-failing unit has 4 current sensors only. I don&#39;t know the firmware versions, but both units were purchased last summer (27 July, 14 Aug) - the failing one first and then the other one.</p>
<p>Unfortunately, I had re-powered it before I thought to check the LED, but I believe from prior failures that the LED on the emonTx stops flashing.</p>
<p>Because I have two units feeding into a single emonBase, and one is working, I don&#39;t think RF interference is an issue or it would hit both TX&#39;s,&nbsp; and for the same reason I don&#39;t think the receiving unit is the problem.</p>
<p>Per roll-over - the pulse counter does roll over, but that appears to not be a problem.</p>
<p>Regarding unpopulated temp sensors - the working unit has no temp sensors, the failing unit has one.</p>
<p>As far as discarded packets... there are other devices on the same frequency (I&#39;m not sure what they are, but I can see them on a spectrum analyzer). This results in a fair number of discarded packets during normal operation. If the emonTx was having its packets discarded, I&#39;m not sure how I would tell the difference. Also, I would think bit-slip would be a problem all the time, not just show up after it has been running a few weeks and then lose absolutely every packet.</p>
<p>I think it is most likely that the emonTx is simply stopping running or it&#39;s RF board croaked. Unfortunately, since I fixed it without looking for the flashing LED, I can&#39;t be certain. I believe that in past failures, the LED had stopped flashing, though.</p>
<p><strong>Does the software use a watchdog, as is common in embedded systems? </strong>The ATMega series has a built-in watchdog timer that will reset the CPU if the firmware doesn&#39;t &quot;pet&quot; the watchdog periodically, but it has to be enabled and the petting software has to be done in a way that any persistent problem will result in no petting.</p>
<p>I will take a close look at the RF unit on the failing unit for solder issues, as mentioned. If I can&#39;t solve it, I guess I&#39;ll just cough up the 60 pounds and shipping to the US. I notice that the store no longer offers node 9 or 10 options. I guess I&#39;ll have to program the new one to 10, or redefine my 6 sensors to 8.</p>
<p>Below is log output for one packet from the unit that fails:</p>
<p>2016-01-12 17:04:07,719 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 7 NEW FRAME : OK 10 0 0 25 0 4 0 253 255 131 46 0 0 0 0 0 0 0 0 0 0 0 0 135 33 (-39)<br />
2016-01-12 17:04:07,722 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 7 Timestamp : 1452618247.72<br />
2016-01-12 17:04:07,723 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 7 From Node : 10<br />
2016-01-12 17:04:07,724 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp; Values : [0, 25, 4, -3, 119.07000000000001, 0, 0, 0, 0, 0, 0, 8583]<br />
2016-01-12 17:04:07,725 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSSI : -39</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38204"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 12/01/2016 - 23:14.</div>
    <div class="content">
     <p><em>&quot;I notice that the store no longer offers node 9 or 10 options.&quot;</em></p>
<p>If you speak nicely to the shop, they might be able to program one&nbsp;to nodeIDs 9 &amp; 10 for you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38209"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 12/01/2016 - 23:56.</div>
    <div class="content">
     <p>I would not be surprised if it was the run of 12 zeros (96 zero bits) causing the dropouts, or even a slightly different loop time&nbsp;causing&nbsp;this emonTx to be blocked by the other.</p>
<p>Unfortunately&nbsp;the emonPi&nbsp;firmware does not allow the &quot;discarded&quot; packets to be logged, once they fail the crc they are forgotten. Normally you could set &quot;quiet = false&quot; in emonhub and we could see for sure what was occurring.</p>
<p>Do you by any chance have another &quot;RFM&quot;&nbsp;device like a rfm2pi or jeelink?</p>
<p>The node 9 or 10 choice in the shop was from the days prior to the DIP switches being fitted when it required an edit to the sketch. now you have the choice of 2 node ids on every emonTx (4 on an emonTH), you just flick the switch.</p>
<p>Do you have a programmer? the later firmware for the emonTx&nbsp;uses non-zero values for unused temp sensors so that possibility could be removed with a routine&nbsp;update.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38212"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Wed, 13/01/2016 - 01:39.</div>
    <div class="content">
     <p>@pb66... This hypothesis doesn&#39;t explain why it works okay for weeks and then stops working, but starts immediately after being repowered.&nbsp;</p>
<p>If the data is transmitted async (which I thought it was), each character would have a start and one or more stop bits. One of those would not be zero (I don&#39;t remember which these days - I think the stop bit). Async transmission can send zeroes forever without losing sync. Synchronous protocols use other techniques (bit stuffing or sync bytes) to deal with repeated zeros to guarantee there are enough transitions that the UART/USART can maintain sync.</p>
<p>On the other hand, you say they use non-zero values now. Was that due to this issue, or because a zero value is a legitimate value and they don&#39;t want confusion between a no-data value and a zero temperature value?</p>
<p>I noticed that the new emonTx&#39;s have the dip switches. I don&#39;t know what mine have (I haven&#39;t opened them up). It&#39;s interesting that they only have two choice - two switches allow for 4 choices. I guess they didn&#39;t want to confuse people with binary - not a bad idea.</p>
<p>Tks for the thoughts.<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38213"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 13/01/2016 - 01:57.</div>
    <div class="content">
     <p>You&#39;ll find details of the message format on the JeeLabs website. There are no &#39;characters&#39; as such and no&nbsp;<span style="line-height: 20.8px;">start and stop bits</span><span style="line-height: 1.6;">, it&#39;s transmitted as one long bit stream, and not Manchester encoded.</span></p>
<p>On the emonTx, one DIP switch is used for voltage selection (230/110 V), the second for nodeID.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38214"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Wed, 13/01/2016 - 03:01.</div>
    <div class="content">
     <p>Wow! Raw bits, no synchronization! Looking at the board I have, it looks like it has a 32kHz frequency reference - ceramic resonator or crystal, I can&#39;t tell. Either should be good enough to not require sync for quite a few bits, assuming the receiver behaves itself when slicing the bits.Thanks for the info.</p>
<p>Anyway, I don&#39;t think that&#39;s the problem with my system, unless somehow the clock on the defective emonTx drifts very slowly, but consistently, and recovers after a 1 second power bounce. I think that&#39;s unlikely.</p>
<p>On the dip switch, thanks for the correction.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38427"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9043.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9043.jpg" alt="dwmw2&#039;s picture" title="dwmw2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/9043.html" title="View user profile.">dwmw2</a> on Mon, 18/01/2016 - 12:30.</div>
    <div class="content">
     <p>If you want to look at wireless transmissions, you can use a cheap USB DVB-T receiver <em>(under &pound;10 from eBay)</em> and rtl_433. I haven&#39;t yet got it actually decoding the emonTx signals but we&#39;re working on it.</p>
<p>It can certainly do the basic captures, which users could submit and someone with more clue could interpret for them.</p>
<p><a href="https://github.com/merbanan/rtl_433_tests/pull/67" title="https://github.com/merbanan/rtl_433_tests/pull/67">https://github.com/merbanan/rtl_433_tests/pull/67</a> has a couple of example captures; there&#39;s a waveform image there too.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38461"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Mon, 18/01/2016 - 20:23.</div>
    <div class="content">
     <p>Thanks. I looked at the received bit stream some time back just by putting a digital oscilloscope on the right pin coming out of the receiver on the emonBase. However, I don&#39;t know if that is a faithful reproduction, or if the RF board is decoding the bit stream and reencoding it. It&#39;s a bit opaque to me what is happening on the RF boards.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38489"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9043.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9043.jpg" alt="dwmw2&#039;s picture" title="dwmw2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/9043.html" title="View user profile.">dwmw2</a> on Tue, 19/01/2016 - 14:34.</div>
    <div class="content">
     <p>The RF board will definitely be decoding the bit stream. You&#39;ll get nice clear bits from it, with all the edges in the right places. If the problem is in the RF and timing side, you&#39;ll not see it at all; just corrupt bits.</p>
<p>With a RTL2832 DVB receiver, you can see the actual waveform. As shown in the picture in that pull request for example, at <a href="../../../raw.githubusercontent.com/merbanan/rtl_433_tests/d0770373ae5ba1820705ada6129adcb6c5ab7fa5/tests/emontx/01/gfile001.png" title="https://raw.githubusercontent.com/merbanan/rtl_433_tests/d0770373ae5ba1820705ada6129adcb6c5ab7fa5/tests/emontx/01/gfile001.png">https://raw.githubusercontent.com/merbanan/rtl_433_tests/d0770373ae5ba18...</a></p>
<p>Although we don&#39;t yet have rtl_433 decoding the data <strong><em>(<a href="12037.html">qv</a>)</em></strong>, you could at least compare the working and non-working transmissions.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38500"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Tue, 19/01/2016 - 17:38.</div>
    <div class="content">
     <p>Thanks. The SDR radio does look like a nifty tool.</p>
<p>In my case, all transmissions work, except after a while, one transmitters data goes missing. I am going to wait for the next failure to see if the problem is that the unit just locks up, as I suspect, as opposed to continuing to transmit but not having the data received properly. Then, I might try the SDR. Or I might give up and buy a new emonTx.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38513"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 19/01/2016 - 21:32.</div>
    <div class="content">
     <p>Since you&#39;re probing, if you find there&#39;s nothing coming out on the RF side, it might also be worth looking at /CS, SCLK&nbsp;and /IRQ. &nbsp; Activity there would indicate the AVR is still hammering away at it. &nbsp;Lack of activity would be less conclusive, but since it happens rarely, the more data you can collect the better.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38628"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9043.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9043.jpg" alt="dwmw2&#039;s picture" title="dwmw2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/9043.html" title="View user profile.">dwmw2</a> on Fri, 22/01/2016 - 14:59.</div>
    <div class="content">
     <p>FWIW the emonTx support is now merged into rtl_433 upstream so you should be able to use that for diagnosis of wireless issues fairly easily.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38640"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Sat, 23/01/2016 - 00:31.</div>
    <div class="content">
     <p>Can you give more details? I&#39;m not sure what you mean.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38653"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Sun, 24/01/2016 - 03:37.</div>
    <div class="content">
     <p>My system is now back in the state where my emonTx (#10) appears to be doing nothing but emonTx (#9) is working. Both are V3.2.</p>
<p>It is AC powered, and from my reading, that means the red LED should flash every once in awhile. It is not.</p>
<p>It is also not showing up in the emoncms.log on the pi, but the other emonTx (#9) is showing. That emonTx (#9) also is not blinking a red light, but it is DC powered so maybe it isn&#39;t supposed to.</p>
<p>The end of the log is below.</p>
<p>Any more ideas of what to try?</p>
<blockquote><p>16-1-24 03:33:47 MQTT INFO Received mqtt message: emonhub/rx/9/values 4,0,31,11,5.27,14.1,0,0,0,0,0,0<br />
2016-1-24 03:33:50 MQTT INFO Reloading config<br />
2016-1-24 03:33:56 MQTT INFO Reloading config<br />
2016-1-24 03:33:59 MQTT INFO Received mqtt message: emonhub/rx/9/values 3,0,32,10,5.31,14.1,0,0,0,0,0,0<br />
2016-1-24 03:34:02 MQTT INFO Reloading config<br />
2016-1-24 03:34:08 MQTT INFO Reloading config<br />
2016-1-24 03:34:09 FEEDWRITER INFO PHPTimeSeries bytes written: 0<br />
2016-1-24 03:34:09 FEEDWRITER INFO PHPFina bytes written: 260<br />
2016-1-24 03:34:14 MQTT INFO Reloading config<br />
2016-1-24 03:34:20 MQTT INFO Reloading config<br />
2016-1-24 03:34:25 MQTT INFO Received mqtt message: emonhub/rx/9/values 3,0,32,10,5.22,14.1,0,0,0,0,0,0<br />
2016-1-24 03:34:26 MQTT INFO Reloading config<br />
2016-1-24 03:34:32 MQTT INFO Reloading config<br />
2016-1-24 03:34:37 MQTT INFO Received mqtt message: emonhub/rx/9/values 2,0,32,11,5.28,14.1,0,0,0,0,0,0<br />
2016-1-24 03:34:38 MQTT INFO Reloading config<br />
2016-1-24 03:34:44 MQTT INFO Reloading config<br />
2016-1-24 03:34:50 MQTT INFO Reloading config<br />
2016-1-24 03:34:50 MQTT INFO Received mqtt message: emonhub/rx/9/values 2,0,30,10,5.3,14.1,0,0,0,0,0,0<br />
2016-1-24 03:34:56 MQTT INFO Reloading config</p>
<p>&nbsp;</p>
</blockquote>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38657"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sun, 24/01/2016 - 09:27.</div>
    <div class="content">
     <p>Are you able to probe signals with your scope? &nbsp;If so, check out those signals I mentioned above to see if there&#39;s any action on the SPI bus.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38660"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 24/01/2016 - 13:27.</div>
    <div class="content">
     <p>Did you not check if the led flashing whilst the unit&nbsp;was working? without seeing the exact&nbsp;firmware it&#39;s difficult to know if&nbsp;&quot;not flashing when not working&quot; is helpful. What you are looking for is an &quot;led flash when not working&quot;&nbsp;as a sign of life or a &quot;change in behavior&nbsp;when it stops working&quot;.</p>
<p>The emoncms log you provided only shows node 9&nbsp;continue to work not node 10 stop, but it&#39;s unlikely to show anything more than it just stop. The most useful logs for this type of debugging is emonhub.log, the loglevel&nbsp;should be set to &quot;DEBUG&quot; in emonhub.conf. In the emonhub.conf you should also set &quot;quiet = false&quot; in the [[[runtimesettings]]] of the [[RFM2Pi]] section.</p>
<p>The &quot;bitslip&quot; issue was really the <u>only</u> reason the positive fault indication of 300 was added to current sketches. I am not going to try and convince you it IS that when it is only one of several possibilities. The pattern of occurrence is a little odd but does not rule it out. Previously I was only guessing you had more than one available&nbsp;temp&nbsp;sensor&nbsp;value in the payload but your log above confirms 6 unused temp sensors. The fact that the&nbsp;device in question has one occupied would suggest it is less likely to occur, but the fact this one is ACAC&nbsp;powered and the other ACDC powered could counter that theory, certainly adding pulse counting into the mix on ACAC and you may be stretching things a&nbsp;little further than the other device with less load and a better supply.</p>
<p>What is that single temperature sensor reading does it drop to zero degrees every 2 weeks causing a longer run of zeros and therefore bitslip?</p>
<p>That load and power supply could also make the other node a more dominant rf signal and/or slightly faster loop without the pulse&nbsp;counting of temperture, this could mean that when the 2 devices rf payloads clash, the other device prevails causing a long period of no data from this one, that if left long enough may play out and resume.</p>
<p>The emonTx v3.2 had a rfm12 so I don&#39;t think the addition of a temp sensor and pulse sensor should cause an power supply&nbsp;issue alone, but payload, workload, ambient&nbsp;temperature, supply voltage, temperature sensor reading, component tolerances and any variation in&nbsp;rf behavior of it&#39;s brother, the&nbsp;receiver or &quot;other devices&quot; introduce enough variables to warrant&nbsp;skipping the &quot;in-theory&quot; debugging and get some actual data to work with.</p>
<p>What we are looking for is packets beginning with a &quot;?&quot; in emonhub.log.</p>
<p>What is your emonBase ? rfm12 or rfm69 ? some firmwares (including emonPi) will not pass the discarded packets to emonhub, if this is the case you can probally&nbsp;update the firmware quite easily, What OEM image are you running?</p>
<p>Paul</p>
<p>EDIT &nbsp;- &quot;Both are V3.2&quot; are you sure? the v3.4&#39;s were launched&nbsp;before the emonPi. Did you buy all you stuff in one go or did you have a working system before the emonPi? I ask as the emonPi will not output the &quot;discarded packets&quot; originally I believed you had an emonPi but the recent mention of v3.2 emonTx&#39;s pre-dates the emonPi so my reply today is based on you having a RFM2Pi board. If you do only have the emonPi we could&nbsp;temporarily load a RFM2Pi sketch to it for debugging (will need to recompile a hex for 16MHz)</p>
<p>Also regardless of the outcome of this thread, as both units are side by side,&nbsp;it may be a good idea to consider&nbsp;using the ACDC to power both units and the ACAC&nbsp;as a reference only to both units. That way they both get a stable 5vdc with plenty of headroom and all 8 ct&#39;s&nbsp;are&nbsp;more accurate, 4 from introducing an AC signal to reference and the other 4 from an undistorted (by power demand)&nbsp;reference.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38670"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Sun, 24/01/2016 - 18:40.</div>
    <div class="content">
     <p>Hi,</p>
<p>&nbsp;&nbsp; Thanks for the correction on which log to use. I will include log output below.</p>
<p>&nbsp;</p>
<p>&nbsp; I will respond to the rest interpolated in your message below. First, though, some new info, from tests suggested by our exchange...</p>
<p>I put my spectrum analyzer on 433.92 and can see the packets. The ones from the working node are far stronger than the others in the environment, so I set the squelch so that only those packets produce an audio for me to hear. The strong signals are always correlated with the working emonTx (#9) - per the emonhub logs.</p>
<p>Then, I unpowered #9, and reset #10 (the bad one) by removing and returning power to it. Now I can hear #10 on the spectrum analyzer when its red LED blinks, and its packets are showing up in the log OK.</p>
<p>This is very strong evidence that #10 had simply quit transmitting, for whatever reason, and it resumed after I repowered it. FWIW it blinked 10 times (if I counted right) when I repowered it.</p>
<p>Also, now that it is working, the LED is flashing with each transmission. It was not flashing before.</p>
<p>Assuming that it is simply stopping, as shown, what do I do? Buy a new one? Send it back for repair? Or more analysis and experimenting?</p>
<p>... on to the other analysis...</p>
<p>&nbsp;&nbsp;</p>
<blockquote><p>Did you not check if the led flashing whilst the unit&nbsp;was working? without seeing the exact&nbsp;firmware it&#39;s difficult to know if&nbsp;&quot;not flashing when not working&quot; is helpful. What you are looking for is an &quot;led flash when not working&quot;&nbsp;as a sign of life or a &quot;change in behavior&nbsp;when it stops working&quot;.</p>
</blockquote>
<p>Yeah, that was dumb of me. I just assumed it was supposed to flash, and had a memory of it flashing, but its been a few months so I wasn&#39;t sure. [after re-powering, it now flashes with each transmission]</p>
<blockquote><p>The emoncms log you provided only shows node 9&nbsp;continue to work not node 10 stop, but it&#39;s unlikely to show anything more than it just stop. The most useful logs for this type of debugging is emonhub.log, the loglevel&nbsp;should be set to &quot;DEBUG&quot; in emonhub.conf. In the emonhub.conf you should also set &quot;quiet = false&quot; in the [[[runtimesettings]]] of the [[RFM2Pi]] section.</p>
</blockquote>
<p>Oops, wrong log. I am now including output from the emonhub log - before repowering node #10. It shows lots of bad packets, but those are from other devices not part of this system.</p>
<blockquote><p>The &quot;bitslip&quot; issue was really the only reason the positive fault indication of 300 was added to current sketches. I am not going to try and convince you it IS that when it is only one of several possibilities. The pattern of occurrence is a little odd but does not rule it out. Previously I was only guessing you had more than one available&nbsp;temp&nbsp;sensor&nbsp;value in the payload but your log above confirms 6 unused temp sensors. The fact that the&nbsp;device in question has one occupied would suggest it is less likely to occur, but the fact this one is ACAC&nbsp;powered and the other ACDC powered could counter that theory, certainly adding pulse counting into the mix on ACAC and you may be stretching things a&nbsp;little further than the other device with less load and a better supply.</p>
</blockquote>
<p>I cannot dispute the experience - obviously that change wasn&#39;t just put in for fun.&nbsp; I was just surprised to run into a protocol that didn&#39;t provide adequate transitions for bit synchronization, and I was guessing about the accuracy of the clocks. I&#39;m glad it&#39;s fixed in the latest version.</p>
<p>
I don&#39;t see why it would work fine for a week or two and then experience a bit slip on every packet forever. What I see is that data comes in properly until a time after which it comes in not at al [verified by looking at the graphs]l. I don&#39;t see the data start to be bad and drift into always bad - it is just bad for up to several weeks at a time.</p>
<p>&nbsp;</p>
<blockquote><p>What is that single temperature sensor reading does it drop to zero degrees every 2 weeks causing a longer run of zeros and therefore bitslip?</p>
</blockquote>
<p>The temp since the most recent failure has been well above either 0F or 0C. I live in Phoenix, AZ, but it does occasionally get down to 0C. BTW, it turns out I have a temp sensor on both emonTx&#39;s, so I have a record of the temperatures.</p>
<blockquote><p>That load and power supply could also make the other node a more dominant rf signal and/or slightly faster loop without the pulse&nbsp;counting of temperture, this could mean that when the 2 devices rf payloads clash, the other device prevails causing a long period of no data from this one, that if left long enough may play out and resume.</p>
</blockquote>
<p>That&#39;s a good thought. However, I have had perfect outages (absolutely no data from #10) that last for weeks. Also, I just now unpowered the other emonTx and still see no packets from #10, so I think we can rule that possibility out.</p>
<p>...</p>
<p>&nbsp;</p>
<blockquote><p>What we are looking for is packets beginning with a &quot;?&quot; in emonhub.log.</p>
<p>What is your emonBase ? rfm12 or rfm69 ? some firmwares (including emonPi) will not pass the discarded packets to emonhub, if this is the case you can probally&nbsp;update the firmware quite easily, What OEM image are you running?</p>
</blockquote>
<p>The base is an rfm69 at 433.92 MHz. Lots of discarded packets are showing up in the emonhub log.</p>
<blockquote><p>EDIT &nbsp;- &quot;Both are V3.2&quot; are you sure? the v3.4&#39;s were launched&nbsp;before the emonPi. Did you buy all you stuff in one go or did you have a working system before the emonPi? I ask as the emonPi will not output the &quot;discarded packets&quot; originally I believed you had an emonPi but the recent mention of v3.2 emonTx&#39;s pre-dates the emonPi so my reply today is based on you having a RFM2Pi board. If you do only have the emonPi we could&nbsp;temporarily load a RFM2Pi sketch to it for debugging (will need to recompile a hex for 16MHz)</p>
</blockquote>
<p>Sorry for the confusion - I called it a &quot;pi&quot; because there&#39;s a pi in it. I don&#39;t have an emonPi. I have an emonBase. My base and the Tx that is having problems were purchased in July of 2014 and the Tx that is not failing was purchased on Aug 14, 2014. The firmware version isn&#39;t mentioned in the receipts and I don&#39;t know how to find it, but I&#39;m think it&#39;s 3.2. Is there a way to tell?</p>
<blockquote><p>Also regardless of the outcome of this thread, as both units are side by side,&nbsp;it may be a good idea to consider&nbsp;using the ACDC to power both units and the ACAC&nbsp;as a reference only to both units. That way they both get a stable 5vdc with plenty of headroom and all 8 ct&#39;s&nbsp;are&nbsp;more accurate, 4 from introducing an AC signal to reference and the other 4 from an undistorted (by power demand)&nbsp;reference.</p>
</blockquote>
<p>Good idea. I will do that.</p>
<p>Paul, thanks for all the good ideas!</p>
<p>John</p>
<p>2016-01-24 18:17:35,037 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 33 220 194 224 175 100 76 246 66 188 146 92 32 105 19 208 255 63 251 237 129 (-93)<br />
2016-01-24 18:17:36,150 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 165 134 165 61 250 31 200 61 163 161 61 218 70 243 247 66 60 232 114 108 6 (-92)<br />
2016-01-24 18:17:36,356 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 156 198 105 62 98 220 228 52 221 127 159 27 5 156 3 97 226 228 160 65 129 (-92)<br />
2016-01-24 18:17:36,762 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 16 9 95 160 153 14 93 52 231 195 64 35 47 21 238 32 224 184 122 192 89 (-91)<br />
2016-01-24 18:17:37,870 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 131 116 111 247 25 243 1 123 180 135 52 175 234 70 134 140 128 145 245 202 213 (-92)<br />
2016-01-24 18:17:38,780 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 155 172 103 7 255 32 122 40 59 220 121 3 44 158 177 108 42 51 147 215 223 (-93)<br />
2016-01-24 18:17:44,204 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 185 175 248 222 206 230 176 45 159 2 227 6 220 226 57 74 188 235 176 15 (-91)<br />
2016-01-24 18:17:46,214 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 9 2 0 0 0 0 5 0 18 2 151 0 0 0 0 0 0 0 0 0 0 (-37)<br />
2016-01-24 18:17:49,130 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 176 121 163 36 230 168 205 58 5 250 37 72 92 55 97 40 146 100 139 148 31 (-93)<br />
2016-01-24 18:17:50,655 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 186 209 141 35 138 52 210 247 180 23 135 6 195 60 94 228 176 98 173 80 238 (-90)<br />
2016-01-24 18:17:53,566 INFO&nbsp;&nbsp;&nbsp;&nbsp; emoncmsorg sending: http://emoncms.org/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1453659453,9,2,0,32,7,5.2700000000000005,15.100000000000001,0,0,0,0,0,0,-37]]&amp;sentat=1453659473<br />
2016-01-24 18:17:53,884 DEBUG&nbsp;&nbsp;&nbsp; emoncmsorg acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
2016-01-24 18:17:54,820 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 15 124 63 218 171 1 129 99 157 240 235 166 174 79 17 110 190 31 138 188 115 (-91)<br />
2016-01-24 18:17:54,928 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 29 154 206 254 117 150 24 240 241 126 53 128 27 68 160 37 236 98 108 214 248 (-94)<br />
2016-01-24 18:17:57,003 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 147 187 143 93 162 2 229 108 254 181 253 107 228 229 211 190 130 158 160 194 28 (-93)<br />
2016-01-24 18:17:57,817 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 14 199 179 34 227 103 209 110 142 227 122 136 133 31 57 41 226 91 227 0 131 (-95)<br />
2016-01-24 18:17:58,123 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 4 173 43 43 246 98 28 102 32 253 42 181 54 44 120 112 114 250 137 39 103 (-90)<br />
2016-01-24 18:17:58,851 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2963 NEW FRAME : OK 9 2 0 0 0 33 0 4 0 18 2 151 0 0 0 0 0 0 0 0 0 0 0 0 0 (-36)<br />
2016-01-24 18:17:58,855 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2963 Timestamp : 1453659478.85<br />
2016-01-24 18:17:58,856 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2963 From Node : 9<br />
2016-01-24 18:17:58,857 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2963&nbsp;&nbsp;&nbsp; Values : [2, 0, 33, 4, 5.3, 15.100000000000001, 0, 0, 0, 0, 0, 0]<br />
2016-01-24 18:17:58,857 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2963&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSSI : -36<br />
2016-01-24 18:17:58,858 INFO&nbsp;&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Publishing: emonhub/rx/9/values 2,0,33,4,5.3,15.1,0,0,0,0,0,0<br />
2016-01-24 18:17:58,861 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2963 adding frame to buffer =&gt; [1453659478, 9, 2, 0, 33, 4, 5.3, 15.100000000000001, 0, 0, 0, 0, 0, 0, -36]<br />
2016-01-24 18:17:58,862 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2963 Sent to channel&#39; : ToEmonCMS<br />
2016-01-24 18:18:02,827 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 148 46 61 23 96 219 71 232 255 191 93 198 219 51 101 140 170 123 227 39 255 (-90)<br />
2016-01-24 18:18:08,697 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 27 (-93)<br />
2016-01-24 18:18:11,527 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2964 NEW FRAME : OK 9 2 0 0 0 34 0 4 0 18 2 151 0 0 0 0 0 0 0 0 0 0 0 0 0 (-38)<br />
2016-01-24 18:18:11,530 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2964 Timestamp : 1453659491.53<br />
2016-01-24 18:18:11,530 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2964 From Node : 9<br />
2016-01-24 18:18:11,531 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2964&nbsp;&nbsp;&nbsp; Values : [2, 0, 34, 4, 5.3, 15.100000000000001, 0, 0, 0, 0, 0, 0]<br />
2016-01-24 18:18:11,532 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2964&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSSI : -38<br />
2016-01-24 18:18:11,533 INFO&nbsp;&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Publishing: emonhub/rx/9/values 2,0,34,4,5.3,15.1,0,0,0,0,0,0<br />
2016-01-24 18:18:11,534 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2964 adding frame to buffer =&gt; [1453659491, 9, 2, 0, 34, 4, 5.3, 15.100000000000001, 0, 0, 0, 0, 0, 0, -38]<br />
2016-01-24 18:18:11,535 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2964 Sent to channel&#39; : ToEmonCMS<br />
2016-01-24 18:18:13,445 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 69 72 185 181 232 254 139 87 188 197 200 253 216 241 28 73 48 26 167 153 42 (-97)<br />
2016-01-24 18:18:21,324 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 13 148 239 192 255 194 174 51 126 98 139 64 110 167 50 61 1 178 238 47 60 (-95)<br />
2016-01-24 18:18:22,332 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 55 223 81 89 123 172 159 21 24 231 42 127 183 172 85 203 75 59 170 97 123 (-91)<br />
2016-01-24 18:18:23,025 INFO&nbsp;&nbsp;&nbsp;&nbsp; emoncmsorg sending: <a href="http://emoncms.org/myip/set.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y" title="http://emoncms.org/myip/set.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y">http://emoncms.org/myip/set.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y</a><br />
2016-01-24 18:18:23,645 INFO&nbsp;&nbsp;&nbsp;&nbsp; emoncmsorg sending: http://emoncms.org/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1453659478,9,2,0,33,4,5.3,15.100000000000001,0,0,0,0,0,0,-36],[1453659491,9,2,0,34,4,5.3,15.100000000000001,0,0,0,0,0,0,-38]]&amp;sentat=1453659503<br />
2016-01-24 18:18:23,956 DEBUG&nbsp;&nbsp;&nbsp; emoncmsorg acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
2016-01-24 18:18:23,984 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 40 11 224 200 32 217 246 31 62 213 93 83 116 106 231 71 248 173 164 59 207 (-92)<br />
2016-01-24 18:18:24,190 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 9 1 0 0 0 0 5 0 18 2 151 0 0 0 0 0 0 0 0 0 0 (-39)<br />
2016-01-24 18:18:25,937 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 133 111 62 242 155 222 82 158 0 123 132 29 163 100 24 182 232 79 82 30 63 (-94)<br />
2016-01-24 18:18:35,423 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 27 0 245 72 113 73 228 24 187 61 79 150 109 7 43 64 133 145 225 150 227 (-93)<br />
2016-01-24 18:18:36,857 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2965 NEW FRAME : OK 9 2 0 0 0 33 0 5 0 18 2 151 0 0 0 0 0 0 0 0 0 0 0 0 0 (-38)<br />
2016-01-24 18:18:36,860 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2965 Timestamp : 1453659516.86<br />
2016-01-24 18:18:36,861 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2965 From Node : 9<br />
2016-01-24 18:18:36,863 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2965&nbsp;&nbsp;&nbsp; Values : [2, 0, 33, 5, 5.3, 15.100000000000001, 0, 0, 0, 0, 0, 0]<br />
2016-01-24 18:18:36,864 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2965&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RSSI : -38<br />
2016-01-24 18:18:36,865 INFO&nbsp;&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Publishing: emonhub/rx/9/values 2,0,33,5,5.3,15.1,0,0,0,0,0,0<br />
2016-01-24 18:18:36,867 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2965 adding frame to buffer =&gt; [1453659516, 9, 2, 0, 33, 5, 5.3, 15.100000000000001, 0, 0, 0, 0, 0, 0, -38]<br />
2016-01-24 18:18:36,868 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; 2965 Sent to channel&#39; : ToEmonCMS<br />
2016-01-24 18:18:36,976 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 137 249 191 122 49 197 231 79 54 165 207 26 188 221 171 26 127 151 79 198 139 (-95)<br />
2016-01-24 18:18:47,165 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 29 219 227 207 175 64 125 36 110 4 56 187 3 114 195 80 56 222 117 200 179 (-93)</p>
<p>
&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38677"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 24/01/2016 - 20:56.</div>
    <div class="content">
     <p><em>&quot;It shows lots of bad packets, but those are from other devices not part of this system.&quot;</em></p>
<p>Agreed most of the discarded packets are garbage and the rssi of most are -90+, but there is one in that excerpt</p>
<p><em>2016-01-24 18:17:46,214 DEBUG&nbsp;&nbsp;&nbsp; RFM2Pi&nbsp;&nbsp;&nbsp;&nbsp; Discarding RX frame &#39;unreliable content&#39;? 9 2 0 0 0 0 5 0 18 2 151 0 0 0 0 0 0 0 0 0 0 (-37)</em></p>
<p>That is supposed to be a valid packet and I strongly suspect &quot;bitslip&quot;, but that&#39;s just one packet and the wrong device.</p>
<p>From your findings it certainly sounds like the emonTx is just stopping rather than the rf signal being lost, dropped or malformed. I would certainly consider some other things before rushing out to buy a new one though. firmware and&nbsp;power supplies&nbsp;(as suggested above) at least.</p>
<p>Do you have a programmer&nbsp;?&nbsp;</p>
<p>v3.2 is the hardware version not the firmware version, using the programmer you may be able to determine the installed&nbsp;firmware or at least install a known/latest version.</p>
<p>I had no idea the outages were lasting weeks, that is a very&nbsp;definite&nbsp;stop...dead! so firmware or hardware is fast becoming stronger suspects.</p>
<p>Paul<br />
&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38685"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Sun, 24/01/2016 - 22:25.</div>
    <div class="content">
     <p>Paul... sorry I didn&#39;t make it clear sooner about the long lasting failure.</p>
<p>I will try the dc supply in addition to the AC reference.</p>
<p>Could this really be a firmware issue? Usually this sort of failure, at least on a system with a watchdog, is a hardware failure. but if it doesn&#39;t use the watchdog right, a firmware error can cause it. Do you know if others have reported similar problems and they have been found to be firmware?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38689"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sun, 24/01/2016 - 22:56.</div>
    <div class="content">
     <p>I&#39;ve seen a lot of AVR hangs, and I think I can honestly say&nbsp;they&#39;ve always been firmware loops... usually f/w looping on external h/w that has failed to respond (which may be because that small piece of h/w has failed or reset unexpectedly). &nbsp; The most recent one I worked on was a Vcc glitch that was low enough to reset a device on the SPI bus, but not low enough to trigger the AVR BOD. &nbsp;Further investigation revealed it was a power supply problem.&nbsp;</p>
<p>And yes, you&#39;re right: the AVR wdog is very useful for diagnosing such stuff, especially if you run it in it&#39;s two-stage mode. &nbsp;On the first firing, you can capture machine state (including the PC) and store it away in non-volatile storage, then on the second firing, you can let it reset the AVR. &nbsp;Even then you really need a way for your f/w to be able to reset all the external h/w, otherwise you run the risk of the AVR starting afresh, but the various h/w it&#39;s talking to all being in some previous state.</p>
<p>AFAIK, Jellib uses the wdog to wake the AVR from a deep sleep. &nbsp;I&#39;m not sure that it then continues to use it to ensure the system is running normally once awake, but it&#39;s all open-source so you could check (unless anyone else knows?)</p>
<p>If you assume for a minute your AVR is still running, then you need to go looking at why it would stop blinking the LED. &nbsp;I&#39;m not familiar with the RF module and the Jeelib stuff, but a quick glance in there suggests it runs quite a state machine, and there are several places it hammers away on the RF module until a specific event happens. That&#39;s why I proposed you look to see if there&#39;s still activity&nbsp;on the SPI bus during the hang.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38691"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Sun, 24/01/2016 - 23:45.</div>
    <div class="content">
     <p>I agree with your analysis of AVR and watchdogs. I&#39;ve done a bunch of comercial products where the product had to keep running no matter what - as long as it had power, and I used the watchdog to assure that. With thousands of installations, I&#39;ve never heard a complaint where it was locked up and repowering it solved it.</p>
<p>The Red LED is driven directly by the ATMega328, so it&#39;s a strong (but not conclusive) argument that the processor is stopping. Given that,I don&#39;t think there is productive diagnostics I can do beyond this. If the behavior persists with the DC supply (and I expect it will), then I&#39;ll have to buy a new RFu328 or a new emonTx V3.4 (or maybe, if they sell it, a new emonTx populated board).</p>
<p>
Thanks</p>
<p>John</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38694"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 25/01/2016 - 05:49.</div>
    <div class="content">
     <p>I don&#39;t share your confidence that the watchdog is enabled. &nbsp;At any rate, it&#39;s pretty easy to test. &nbsp;Simply add this line to the main loop of the sketch:</p>
<p>&nbsp; &nbsp; while (millis() &gt; 60000);</p>
<p>If after a minute the device just hangs, with no more LED flashing, then we&#39;ve replicated your symptoms without any hardware issue. &nbsp;If it reboots, then we know the watchdog is indeed watching and an infinite loop is unlikely to be causing what you&#39;re seeing.</p>
<p>Assuming for a minute the wdog isn&#39;t enabled, then any loop that has the possibility of running forever could be the cause of your symptoms. There seem to be plenty of them in the RF code:</p>
<pre>
while (!rf12_canSend())
  rf12_recvDone(); // keep the driver state machine going, ignore incoming


</pre><p>Most of them seem to bang on the RF module waiting for it to do as expected, but if it doesn&#39;t I can&#39;t see any escape clause. &nbsp;&nbsp;So putting your scope probe on the SPI signals might help you pinpoint what&#39;s broken.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38713"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 25/01/2016 - 15:00.</div>
    <div class="content">
     <p>As far as I&#39;m aware the watchdog is only used in the JeeLib&nbsp;sleepy functions but I cannot be absolutely sure.</p>
<p>Since we do not know exactly what firmware you are using it is difficult to know if it has been revised at any point, I have looked at the repo but a reorganisation in&nbsp;&nbsp;summer last year prevents searching&nbsp;the commits history.</p>
<p>There have been revisions to the JeeLib library and I cannot rule out any other changes since the compilation of an sketch of un-confirmed revision. Even if I had bought the device recently and there were no known issues or revisions to the firmware I would still try a free, quick and simple firmware update long before I would shell out postage to return a device let alone buy a new one.</p>
<p>In fact if I had a programmer (still unsure if you do) connecting it may tell us&nbsp;the firmware revision and at this point in the game, whether it did or it didn&#39;t, or whether it was the latest or not, I would still update it so that I knew exactly what was installed for future reference.</p>
<p>As highlighted by dBC, it could be hanging on an rf12&nbsp;function. That could be brought about if there is a power supply issue that only effects the rfm module, I don&#39;t think they are&nbsp;as accommodating as the avr&#39;s with respect to voltage, so just using the 5vdc supply for both emonTx&#39;s may well fix the issue.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38715"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 25/01/2016 - 15:49.</div>
    <div class="content">
     <p><em>&quot;Most of them seem to bang on the RF module waiting for it to do as expected, but if it doesn&#39;t I can&#39;t see any escape clause. &quot;</em></p>
<p><em>&quot;it could be hanging on an rf12&nbsp;function&quot;</em></p>
<p>Both seconded. Almost all the reported problems with&nbsp;the sketches hanging have turned out to be at calls to the RF module, and (from memory) all of those&nbsp;have been the RF module not responding due to a bad joint.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38716"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 25/01/2016 - 16:00.</div>
    <div class="content">
     <p>Robert - I had wondered at first glance if that was supposed to be&nbsp;</p>
<p><em>&quot;Most of them seem to bang on <strong>about</strong> the RF module waiting for it to do as expected,&quot;</em></p>
<p>perhaps referring to the likes of you and me :-)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38720"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 25/01/2016 - 16:25.</div>
    <div class="content">
     <p>You could be right! &nbsp;But no, I think it meant&nbsp;<strong><em>hang</em></strong>&nbsp;(the keys are diagonally adjacent).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38732"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 25/01/2016 - 21:48.</div>
    <div class="content">
     <p>It was more like: &nbsp;<em>I&#39;m going to bang on this ball joint with my hammer until it does what I want.</em></p>
<p>If anyone out there with some OEM h/w and a couple of minutes to spare could briefly&nbsp;add:</p>
<p>&nbsp; &nbsp; while (millis() &gt; 60000);</p>
<p>to their main loop, we&#39;d know for sure if the watchdog is enabled (at least in the f/w version they&#39;re running). &nbsp;It should either reset every minute (watchdog enabled) or hang indefinitely after a minute (no watchdog). &nbsp;A quick browse of&nbsp;https://github.com/jcw/jeelib/blob/master/Ports.cpp makes me think it isn&#39;t. &nbsp;All the WDTCSR manipulations seem to be setting it up for deep sleep wakeup, and not system resets, but I could have easily missed something in other modules.</p>
<p>If the radio module does occasionally get into some state that requires a hard reset, then enabling the AVR watchdog won&#39;t help. &nbsp;That&#39;ll break the AVR out of it&#39;s immediate loop, but without a mechanism for the freshly-restarted&nbsp;f/w to force a hard reset of the radio module, it&#39;s likely to quickly end up back in the loop.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38739"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Tue, 26/01/2016 - 03:44.</div>
    <div class="content">
     <p>I will be interested to see if someone runs that test.</p>
<p>As for a hard reset... I would hope that on startup, the AVR hard resets all peripheral devices that need resetting. That&#39;s standard practice in systems that need watchdogs - without doing that, the watchdog is really a waste of time. For example, brownouts can cause logic other than the CPU to get in bad states.</p>
<p>It looks like the production code is probably built from emonTxFirmware-master 2/emonTxV3/RFM/emonTxV3.2/emonTxV3_2_DiscreteSampling although the comment in the repo has a different URL, one that is broken.</p>
<p>That code uses an object called Sleepy and assigns the watchdog interrupt to a function in Sleepy. That function, in the emon version of Jeelib, just counts.</p>
<p>But... I don&#39;t know what mode the watchdog is in. These things have 3 different programmable modes, and also 3 fuses! One programmable mode would allow the code I saw to still have a hard reset: the &quot;Interrupt and System Reset&quot; mode. But, I cannot tell from reading the code what is going on - at least not without reading the Arduino framework code.</p>
<p>&nbsp;</p>
<p>Anyway, here&#39;s <a href="http://www.atmel.com/images/Atmel-8271-8-bit-AVR-Microcontroller-ATmega48A-48PA-88A-88PA-168A-168PA-328-328P_datasheet_Complete.pdf">the link to the full datasheet for the </a>ATMega328.</p>
<p>So, if anyone knows, or does the experiment, I&#39;d love to know whether there really is a working watchdog in this beast - that is, working in the sense of resetting the processor in case of a loop.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38740"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 26/01/2016 - 04:40.</div>
    <div class="content">
     <p><em>I would hope that on startup, the AVR hard resets all peripheral devices</em></p>
<p>I can&#39;t see any provision for the AVR to hard&nbsp;reset the RF module in the schematic, can you?</p>
<p><em>&nbsp;without doing that, the watchdog is really a waste of time</em></p>
<p>Maybe that&#39;s why nobody has bothered to enable it (other than to use it for deep sleep wakeups).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38741"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="meso&#039;s picture" title="meso&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/8490.html" title="View user profile.">meso</a> on Tue, 26/01/2016 - 04:40.</div>
    <div class="content">
     <p>I don&#39;t see a way for it to reset the RF board. But... I don&#39;t know if the RF board needs resetting, since I don&#39;t know what&#39;s on it and whether it has a CPU with a watchdog. Mysteries abound.</p>
<p>&nbsp;</p>
<p>However, even if it has a failure mode, there&#39;s no reason for the Arduino CPU to not protect itself with a reset on watchdog. Maybe not every failure can be caught, but it is still good practice.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38742"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 26/01/2016 - 04:59.</div>
    <div class="content">
     <p><em>Mysteries abound.</em></p>
<p>There may&nbsp;be one less mystery if you probe&nbsp;the SPI signals next time it hangs.</p>
<p><em>there&#39;s no reason for the Arduino CPU to not protect itself with a reset on watchdog. Maybe not every failure can be caught, but it is still good practice.</em></p>
<p>Hey, it was you who declared &nbsp;&quot;without doing that, the watchdog is really a waste of time&quot;. &nbsp; If you think it&#39;ll help, then enable it. &nbsp;You know what they say about opensource... if you don&#39;t like it, rewrite it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38746"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Tue, 26/01/2016 - 09:13.</div>
    <div class="content">
     <p><em>@meso,</em></p>
<p><em>I don&#39;t know if the RF board needs resetting, since I don&#39;t know what&#39;s on it and whether it has a CPU with a watchdog</em></p>
<p>The RF Modules have an RF engine driven by a state machine - some state transitions have timers associated, but there is no formal watchdog &quot;reset&quot; to a known state. &#39;Power on Reset&#39; has this function.</p>
<p><em>One works perfectly. The other one runs for a few weeks and then appears to freeze.</em></p>
<p>Identical code and same base hardware, sitting on the same shelf you said.&nbsp; Once you have eliminated the obvious (e.g. swapping power sources between them) surely this points to a hardware issue? Then implementing your version of a watchdog would simply mask the problem?</p>
<p>Good enough for Government work I suppose - look forward to seeing your results.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38747"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx locks up after a week or two, needs to be repowered</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 26/01/2016 - 11:22.</div>
    <div class="content">
     <p>Actually, if meso&nbsp;implements it well,&nbsp;the watchdog&nbsp;can be a very useful diagnostic tool, &nbsp;Even if it&#39;s not possible to bring a wedged RF module back to life (due to nothing being connected to the module&#39;s /RESET pin) you can gather lots of useful information about where the AVR&nbsp;got wedged, and that will often point&nbsp;to what&#39;s broken/flakey.</p>
<p>On my AVR-based&nbsp;hardware&nbsp;I keep lots of health status (shown below), and additionally&nbsp;if there has been a WDOG reset, I also record:</p>
<pre>
  ...
  uint32_t wdog_pc;
  uint32_t last_known_pid;
  uint8_t  wdog_fw_version_maj;
  uint8_t  wdog_fw_version_min;
  uint8_t  wdog_link_status;
  uint8_t  wdog_portc;
  uint8_t  wdog_porta;
} XXX_health_t;</pre><p>Knowing the AVR&nbsp;PC at the time the wdog&nbsp;fired, the last known process-id, the link state of all the ethernet ports and which SPI /CS&#39;s were asserted&nbsp;has helped me isolate h/w failures. &nbsp;Although as I mentioned above, that was just the first step... the ultimate culprit in that case was the power-supply glitching Vcc, but it was all this wdog info that lead me down that path.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11977"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form--28IOLzpV7q0d1SGQcz_PvwN1ozmY0S87ZeRe4FYkvQ" value="form--28IOLzpV7q0d1SGQcz_PvwN1ozmY0S87ZeRe4FYkvQ"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
