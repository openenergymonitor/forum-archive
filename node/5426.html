<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5426 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:46:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Send emonTx data to non-emoncms server | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Send emonTx data to non-emoncms server</h3>
        <span class="submitted">Submitted by <a href="../user/6642.html" title="View user profile.">natshiel</a> on Fri, 18/07/2014 - 21:31</span>
        <div class="content"><p>Hi y&#39;all,</p>
<p>Is it possible to send data from an emonTx3 + Raspberry Pi directly to a server that IS NOT emonCms? I dug through the .py files on the SD card (oemgatewaybuffer.py in particular) and tried to change the url_string variable that the data gets sent to. However, if I enter a valid URL, the output from the pi stops at</p>
<p>INFO Serial RX: &gt; 0s</p>
<p>INFO Serial RX: &nbsp;-&gt; 4 b</p>
<p>and prints that again every 5 minutes. How can I &quot;hijack&quot; the json object created by the emonTx + pi and post it to a URL of my choosing?</p>
<p>Thanks in advance!</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5465.html" class="topic-previous" title="Go to previous forum topic">‹ wrench icon in Inputs has no function. Emoncms v8.3.2 in windows7</a>
              <a href="5459.html" class="topic-next" title="Go to next forum topic">3 phase in emoncms, node inputs sum ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-22616"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Fri, 18/07/2014 - 21:39.</div>
    <div class="content">
     <p>I am interested in this as well - as I would like my EmonTX to post updates to MQTT topics (to end up in openHAB).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22620"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 19/07/2014 - 10:29.</div>
    <div class="content">
     <p>Oemgateway was designed to be modified for use with other destinations and emonHub is currently being developed in such a way to promote development and inclusion of &quot;other&quot; destinations as well as other input sources.&nbsp;</p>
<p>However, since the default url string is constructed from an address specified in the conf file and then the data and a timestamp is attached with the necessary apikey and formatted specifically for submission to emoncms, some additional changes are required, so a new &quot;type&quot; class should be created.</p>
<p>If you post some details about your requirements eg target &amp; formatting etc we can give you some pointers or show us what you have, you can attach copy of oemgatewaybuffer.py &amp;&nbsp;oemgateway.conf or point to&nbsp;git&nbsp;repo if you have one set up.</p>
<p>summerboy -&nbsp;&nbsp;natshiel&nbsp;is adapting the gateway software run on the Pi, that forwards the data from an emonTx&nbsp;(network). Your post suggests you want the emontx to connect to MQTT directly which wouldn&#39;t involve a gateway or pi so the solution would be different unless you plan to use a gateway.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22645"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6642.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="natshiel&#039;s picture" title="natshiel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/6642.html" title="View user profile.">natshiel</a> on Sun, 20/07/2014 - 22:11.</div>
    <div class="content">
     <p>Hi,</p>
<p>I&#39;ve made some progress: I can sometimes send requests to an address of my choosing. However, the .py code has a VERY odd property where small changes will cause nothing to happen. I&#39;m attaching my oemgatewaybuffer.py. I had to attach the output in text files because the forum would not let me submit the output in the post.</p>
<p>The only lines I&#39;ve changed are those relating to the variables url_string and data_string. An example of the strange things that are occurring:</p>
<p>Line 154 of oemgatewaybuffer.py is</p>
<p>url_string = &quot;10.156.45.16:8080/innovation/device/register/post.json?&quot;</p>
<p>When I reboot the pi the ouput I get is in the file output1.txt</p>
<p>The last four lines of the output repeat several times a second</p>
<p>Notes: the /innovation/device/test lines are produced from the .conf file, but the data is NOT being sent there, it&#39;s being sent to the URL &quot;10.156.45.16:8080/innovation/device/register/post.json?&quot;</p>
<p>It&#39;s not weird that the send fails, because there&#39;s no http:// infront of the IP address, but this output shows that the http requests are being attempted, at least.</p>
<p>When I edit the url_string variable to url_string = &quot;http://10.156.45.16:8080/innovation/device/register/post.json?&quot;, the output changes to output2.txt.</p>
<p>And it stops there. Any ideas as to why this is happening? I&#39;m happy to explain anything that&#39;s confusing with my output or code (the code IS kind of messy, sorry about that)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22686"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6642.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="natshiel&#039;s picture" title="natshiel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/6642.html" title="View user profile.">natshiel</a> on Tue, 22/07/2014 - 17:45.</div>
    <div class="content">
     <p>Hi,</p>
<p>An update to the above response I gave: I&#39;d like to send a request in the format</p>
<p>http://10.156.45.16:8080/innovation/device/register/post.json?{&quot;uuid&quot;:&quot;12345&quot;,&quot;user1&quot;:&quot;120&quot;,&quot;user2&quot;:&quot;70&quot;,&quot;user3&quot;:&quot;13&quot;,&quot;user4&quot;:&quot;46&quot;}</p>
<p>Sorry to bump, but I&#39;m on a tight timeline and any help would be very much appreciated!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22687"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 22/07/2014 - 19:13.</div>
    <div class="content">
     <p>Hi natshiel, I&#39;ve been a little tied up the last few days and missed your post. the labels in the data_string make things a little less flexible. It looks like your URL is incomplete and there is some redundant code still in play.</p>
<p>I&#39;ve&nbsp;quickly knocked up a custom buffer for you. I haven&#39;t tried it and I&#39;m more accustomed to emonhub&nbsp;than oem&nbsp;gateway, but if nothing else, it should point you in the right direction.</p>
<p>Some assumptions have been made and are commented on in the file below. It&#39;s a very quick and very dirty fix that does no error checking or qualification beyond checking the data is numeric. there&#39;s no timestamp and the node id is ignored.</p>
<p>There are a couple of lines to add to the conf file as well. Sorry for the short response, but I&#39;m off again very shortly. I hope this helps,&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22689"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Tue, 22/07/2014 - 23:00.</div>
    <div class="content">
     <p>I think I will be writing a custom sketch for my Arduino&nbsp;+ EmonTX Shield as it will be sitting on an Ethernet shield and I want to post results back to an MQTT broker directly.</p>
<p>I have written a couple of other sketches that do this sort of direct MQTT publishing from Arduino&nbsp;nodes (using&nbsp;http://knolleary.net/arduino-client-for-mqtt/) and it works very well.</p>
<p>I can then decide how to use that data. A simple python script could monitor the necessary MQTT topics and publish results to an EmonCMS server in the correct format, or I can write the data to my InfluxDB&nbsp;database and display the results using Grafana.</p>
<p>I quite like the idea of decoupling the EmonTX from whatever reporting tool - and MQTT is the perfect protocol for this.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22733"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6642.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="natshiel&#039;s picture" title="natshiel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/6642.html" title="View user profile.">natshiel</a> on Mon, 28/07/2014 - 16:59.</div>
    <div class="content">
     <p>Hi pb66,</p>
<p>Thanks so much for your response. I&#39;ve unfortunately been in a weird situation at work where I haven&#39;t had the time to work that I thought I did, or have been separated from the hardware. When I tried to run the natshiel buffer, I originally had some trouble compiling but eventually got it to work, and now I&#39;m debugging. I have a question, though. When I turn on the R-pi and the EmonTX and nothing happens after &quot;INFO Serial RX: &gt; 0s INFO Serial RX:&nbsp; -&gt; 4 b,&quot; what is the reason for that? It seems to me that it&#39;s happening arbitrarily, which is almost certainly not the case, but it makes it very hard for me to debug when I don&#39;t know what&#39;s going wrong. I&#39;ll add a line for debugging output and the code will run in a totally different manner, which is really confusing to me. Do you have any advice for the debugging process?</p>
<p>I&#39;ll upload the changes I&#39;ve made to oemgatewaybuffer.py when I next have the opportunity. Thanks in advance!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22735"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6642.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="natshiel&#039;s picture" title="natshiel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/6642.html" title="View user profile.">natshiel</a> on Tue, 29/07/2014 - 05:23.</div>
    <div class="content">
     <p>GOT IT</p>
<p>Or at least I&#39;m pretty sure I do. Our server is down but all the output looks correct. Your code got me started (and pretty far, thanks!), but there were several more change that I had to make. I believe I had to update gatewayinterface, conf, and gatewaybuffer. I&#39;ll upload the files in the zip below.</p>
<p>Quick note: The contents of the oemgateway.conf file appear to have to be the exact same in two places, or maybe the code was just being funky. By this I mean that I changed the .conf file that I&#39;ve uploaded first by sshing into the Pi and using a text editor AND by plugging the SD card into my computer and changing it there too. It seems that the two files must be EXACTLY the same.</p>
<p>Hope this is helpful to everyone!</p>
<p>I&#39;ll try to answer the questions y&#39;all have, wish me luck on my presentation on Friday :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22754"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/07/2014 - 13:00.</div>
    <div class="content">
     <p>Hi natshiel,&nbsp;</p>
<p>I&#39;m glad you got it working, that&#39;s a priority for your presentation,&nbsp;</p>
<p>It looks like the problems you have overcome by altering the code originate from the command line&nbsp;used, this is normally defined in the daemon script &nbsp;at /etc/init.d/oemgateway which is not included in your zip so I&#39;m unable to check it.</p>
<p>When OEMG is started both the logfile and the config file locations should be specified eg</p>
<p class="rteindent1">oemgateway&nbsp;--config-file /path/to/my/settings/oemgateway.conf&nbsp;--logfile&nbsp;/path/to/my/logfile/oemgateway.log</p>
<p>If the logfile location is ommited it will default to outputting the log entries to the console screen which isn&#39;t so bad, but if the config file location is ommited then it will assume it is installed with emoncms installed to the same machine and expect emoncms&nbsp;to provide the settings, which is why you have had to duplicate the setting in the emoncmsInterface&nbsp;class of the oemgatewayinterface.</p>
<p>you can see&nbsp;<a href="https://github.com/Jerome-github/oem_gateway/blob/master/oemgateway.init.dist#L28-L29">here</a>&nbsp;OEMG&nbsp;is configured to use&nbsp;emoncms&nbsp;by default, comment out Line28 and uncomment Line29 and edit it to your config file location.</p>
<p>It&#39;s not clear why the oemgatewaybuffer.py needed further editing other than the the fact you have &nbsp;edited&nbsp;oemgateway and pointed the main loop&nbsp;to the oemgatewaybuffers&nbsp;&quot;send&quot; rather than the intended &quot;add&quot; by using b.send(values), there by bypassing any buffer functions.</p>
<p>I am happy to help you resolve these issues if you want, although to do so I would recommend setting up a GitHub account for this type of thing and perhaps even look at emonHub&nbsp;rather than OEMgateway to build a more permanent&nbsp;&nbsp;&quot;add-on&quot;&nbsp;bespoke solution to replace my &quot;quick fix&quot;.</p>
<p>Hope it goes well Friday !</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22770"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6642.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="natshiel&#039;s picture" title="natshiel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send emonTx data to non-emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/6642.html" title="View user profile.">natshiel</a> on Wed, 30/07/2014 - 17:20.</div>
    <div class="content">
     <p>Howdy,</p>
<p>Quick note on why I have the oemgatewaybuffer.py using .send() instead of .add(): I purchased the ready-to-go SD card, and the main loop in oemgateway.py was exactly as I have it in the zip I uploaded, using b.send() and b.run(). The python code you sent me had a &quot;.add()&quot; and a &quot;.flush()&quot;, (nearly identical to .send and .run) so I simply renamed those functions to .send() and .run() and called it a day.</p>
<p>In terms of a long term fix, I&#39;ll see if I can convince my employer to let me keep playing with their hardware after the presentation :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5426"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-cruzNMxMak6yJROAvepSR021KgolUBaZ2L78ALum7LM" value="form-cruzNMxMak6yJROAvepSR021KgolUBaZ2L78ALum7LM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/5426 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:46:13 GMT -->
</html>
