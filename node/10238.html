<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10238 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:54:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>ESP8266 send data to emoncms | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">ESP8266 send data to emoncms</h3>
        <span class="submitted">Submitted by <a href="../user/490.html" title="View user profile.">Alvydas001</a> on Mon, 02/03/2015 - 20:07</span>
        <div class="content"><p>Hello,</p>
<p>with AT commands I try to send data to the server emoncms.org.<br />
The data on the server side are not accepted. The database is left without a record.<br />
Maybe someone can tell what&#39;s wrong here?<br />
( To thingspeak.com server data are received correctly)</p>
<p>AT+CIPSTART=&quot;TCP&quot;,&quot;emoncms.org&quot;,80<br />
CONNECT</p>
<p>OK<br />
AT+CIPSEND=82<br />
&gt; GET /input/post.json?json={power:220}&amp;apikey=5f95184d8fafxx***xx1e0fd9aad868 HTTP/1.0\r\nbusy s...</p>
<p>SEND OK</p>
<p>+IPD,315:&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;<br />
&lt;html&gt;&lt;head&gt;<br />
&lt;title&gt;404 Not Found&lt;/title&gt;<br />
&lt;/head&gt;&lt;body&gt;<br />
&lt;h1&gt;Not Found&lt;/h1&gt;<br />
&lt;p&gt;The requested URL /input/post.json was not found on this server.&lt;/p&gt;<br />
&lt;hr&gt;<br />
&lt;address&gt;Apache/2.2.22 (Ubuntu) Server at h80-243-190-58.host.redstation.co.uk Port 80&lt;/address&gt;<br />
&lt;/body&gt;&lt;/html&gt;</p>
<p>OK<br />
CLOSED</p>
<p>-------- ESP8266 Firmware --------------------</p>
<p>AT+GMR<br />
00200.9.5(b1)<br />
compiled @ Dec 25 2014 21:40:28<br />
AI-THINKER Dec 25 2014</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11299.html" class="topic-previous" title="Go to previous forum topic">‹ How to use API to get value at a given time</a>
              <a href="5744.html" class="topic-next" title="Go to next forum topic">EMONCMS: Allow New Input processes Feeds in MySQL engine as option from UI ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-28435"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Alvydas001&#039;s picture" title="Alvydas001&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: ESP8266 send data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/490.html" title="View user profile.">Alvydas001</a> on Sat, 07/03/2015 - 12:42.</div>
    <div class="content">
     <p>Sending to the server emoncms.org with AT commands: </p>
<p>AT+CIPSTART=&quot;TCP&quot;,&quot;80.243.190.58&quot;,80<br />
CONNECT</p>
<p>OK<br />
AT+CIPSEND=90<br />
&gt; GET /emoncms/input/post.json?json={power:210}&amp;apikey=5f95184d8faf*-*-*-*-*-*-0fd9aad868 HTTP/1.0\r\nbusy s...</p>
<p>SEND OK</p>
<p>+IPD,2:ok<br />
OK<br />
CLOSED
</p>
<p><b>The Arduino code (correct version):</b></p>
<p style="font-family: monospace">
#include &lt;SoftwareSerial.h&gt;<br />
#include &lt;OneWire.h&gt;<br />
#include &lt;DallasTemperature.h&gt;</p>
<p style="font-family: monospace">
#define SSID &quot;xxx&quot;<br />
#define PASS &quot;xxx&quot;<br />
#define MODULE_ID &quot;ESP-01&quot;<br />
#define ONE_WIRE_BUS A2<br />
OneWire oneWire(ONE_WIRE_BUS);<br />
DallasTemperature sensors(&amp;oneWire);</p>
<p style="font-family: monospace">
//*-- Hardware Serial<br />
#define _baudrate 115200</p>
<p style="font-family: monospace">
//*-- Software Serial<br />
//<br />
#define _rxpin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2<br />
#define _txpin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4<br />
SoftwareSerial debug( _rxpin, _txpin ); // RX, TX</p>
<p style="font-family: monospace">
#define IP &quot;80.243.190.58&quot; // emonsms<br />
//#define IP &quot;api.thingspeak.com&quot;<br />
String GET = &quot;GET /emoncms/input/post.json?apikey=5f95-x-x-x-x-x-x-x-x-ad868&amp;json={boiler:&quot;;</p>
<p style="font-family: monospace">
<br />
void setup()<br />
{<br />
&nbsp; Serial.begin(_baudrate);<br />
&nbsp; debug.begin( _baudrate );<br />
&nbsp; sensors.begin();<br />
&nbsp; Serial.println(&quot;AT&quot;);<br />
&nbsp; delay(5000);<br />
&nbsp; if(Serial.find(&quot;OK&quot;)){<br />
&nbsp;&nbsp;&nbsp; connectWiFi();<br />
&nbsp;&nbsp;&nbsp; debug.println(&quot;prisijungta&quot;);<br />
&nbsp; }<br />
}</p>
<p style="font-family: monospace">
void loop(){<br />
&nbsp; sensors.requestTemperatures();<br />
&nbsp; float tempC = sensors.getTempCByIndex(0);<br />
//&nbsp; tempC = DallasTemperature::toFahrenheit(tempC);<br />
debug.println(tempC);<br />
&nbsp; char buffer[10];<br />
&nbsp; String tempF = dtostrf(tempC, 4, 1, buffer);<br />
&nbsp; updateTemp(tempF);<br />
&nbsp; delay(10000);<br />
}</p>
<p style="font-family: monospace">
void updateTemp(String tenmpF){<br />
&nbsp; String cmd = &quot;AT+CIPSTART=\&quot;TCP\&quot;,\&quot;&quot;;<br />
&nbsp; cmd += IP;<br />
&nbsp; cmd += &quot;\&quot;,80&quot;;<br />
&nbsp; debug.println(cmd);<br />
&nbsp; Serial.println(cmd);<br />
&nbsp; delay(2000);<br />
&nbsp; if(Serial.find(&quot;Error&quot;)){<br />
&nbsp;&nbsp;&nbsp; return;<br />
&nbsp; }<br />
&nbsp; cmd = GET;<br />
&nbsp; cmd += tenmpF;<br />
&nbsp; cmd += &quot;}\r\n&quot;;<br />
&nbsp; Serial.print(&quot;AT+CIPSEND=&quot;);<br />
&nbsp; Serial.println(cmd.length());<br />
&nbsp; debug.println(&quot;AT+CIPSEND=&quot;);<br />
&nbsp; debug.println(cmd.length());<br />
&nbsp; if(Serial.find(&quot;&gt;&quot;)){<br />
&nbsp;&nbsp;&nbsp; Serial.print(cmd);<br />
&nbsp;&nbsp;&nbsp; debug.println(cmd);<br />
&nbsp; }else{<br />
&nbsp;&nbsp;&nbsp; Serial.println(&quot;AT+CIPCLOSE&quot;);<br />
&nbsp; }<br />
}</p>
<p style="font-family: monospace">
&nbsp;<br />
boolean connectWiFi(){<br />
&nbsp; Serial.println(&quot;AT+CWMODE=1&quot;);<br />
&nbsp; delay(2000);<br />
&nbsp; String cmd=&quot;AT+CWJAP=\&quot;&quot;;<br />
&nbsp; cmd+=SSID;<br />
&nbsp; cmd+=&quot;\&quot;,\&quot;&quot;;<br />
&nbsp; cmd+=PASS;<br />
&nbsp; cmd+=&quot;\&quot;&quot;;<br />
&nbsp; Serial.println(cmd);<br />
&nbsp; delay(5000);<br />
&nbsp; if(Serial.find(&quot;OK&quot;)){<br />
&nbsp;&nbsp;&nbsp; debug.println(&quot;OK&quot;);<br />
&nbsp;&nbsp;&nbsp; return true;<br />
&nbsp; }else{<br />
&nbsp;&nbsp;&nbsp; return false;<br />
&nbsp; }<br />
}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32384"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5908.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rbreuss&#039;s picture" title="rbreuss&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: ESP8266 send data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/5908.html" title="View user profile.">rbreuss</a> on Sun, 19/07/2015 - 09:17.</div>
    <div class="content">
     <p>Hi,&nbsp;</p>
<p>do I understand correctly, you solved it and that code you shared is working now? If so, let me to ask you two questions to ensure myself, I understand it:</p>
<p>1) This code is for to be uploaded directly into ESP8266?</p>
<p>2) If so, HW serial is used for to send data to WiFi and SW serial for debug?</p>
<p>Or am I completely&nbsp;wrong and this code is for Arduino connected via HW serial to ESP module?</p>
<p>Radek</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32385"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/490.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Alvydas001&#039;s picture" title="Alvydas001&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: ESP8266 send data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/490.html" title="View user profile.">Alvydas001</a> on Sun, 19/07/2015 - 09:25.</div>
    <div class="content">
     <p>1. - No!</p>
<p>2. - Yes, this code for Arduino connected via HW serial to ESP module.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32407"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5908.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rbreuss&#039;s picture" title="rbreuss&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: ESP8266 send data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/5908.html" title="View user profile.">rbreuss</a> on Mon, 20/07/2015 - 15:01.</div>
    <div class="content">
     <p>Thanks, I got it in the meantime. I modified your code slightly and now it sends data measured but Arduino Due directly via WiFi into my Emoncms dataserver, It eliminates completely&nbsp;Raspi and Emonhub from landscape. Thats really a&nbsp;great piece of hardware !</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32409"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mel&#039;s picture" title="mel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: ESP8266 send data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/8446.html" title="View user profile.">mel</a> on Mon, 20/07/2015 - 15:13.</div>
    <div class="content">
     <p>Hi Rbreuss,</p>
<p>Could you share your&nbsp;sketch?</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32414"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5908.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rbreuss&#039;s picture" title="rbreuss&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: ESP8266 send data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/5908.html" title="View user profile.">rbreuss</a> on Mon, 20/07/2015 - 20:14.</div>
    <div class="content">
     <p>Sure, just&nbsp;give me a short time to remove unused rows and to some comments to used rows. Now it looks&nbsp;too messy. But Im surprised, how easy it works.</p>
<p>Radek&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32422"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5908.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rbreuss&#039;s picture" title="rbreuss&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: ESP8266 send data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/5908.html" title="View user profile.">rbreuss</a> on Tue, 21/07/2015 - 07:08.</div>
    <div class="content">
     <p>So here is that sketch promised. It works on Arduino Due with ESP8266&nbsp;(ESP01)&nbsp;powered from this&nbsp;Arduino (ATTENTION - powered from 3,3V pin !!!) and connected to Serial2&nbsp;TX/RX. To get it working, ESP01 pin CH_PD has to be at high state (connected to 3,3V). You have to write there your WiFi SSID and passwd, your domain with emoncms (emoncms is installed in domain/emoncms folder) and you have to fill in your RW apikey. And when you connect real DS18B20 sensors, you have to comment out that hardwired temperature value at the end of sketch. Good luck and let me know your feedback.</p>
<p>Radek</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34582"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8759.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="arduino_man&#039;s picture" title="arduino_man&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: ESP8266 send data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/8759.html" title="View user profile.">arduino_man</a> on Tue, 29/09/2015 - 14:46.</div>
    <div class="content">
     <p>I am a little bit stuck and I could REALLY use some help. So my friend and I are trying to send data through a server to a database (ESP8266 + Arduino, Apache Server and Mysql Database). When we send data, it says &ldquo;send ok&rdquo; and after that it says connection timeout. On apache it says 408 error. A few times we got 200 4961 (this is what we want) but that only happens when we send GET /HTTP/1.1 and when we send to GET/index.php?img=pngPlugIn HTTP/1.1. We try to send GET /pm/add_message.php?pmu=RAL005-07001-FL02-0030-2L Host:192.168&hellip;&hellip;. but we get 408 320. Any suggestions? Do you know what we might be doing wrong? ((I have attached a list of the log in a word document in case anyone wants to view. Thank you!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10238"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-jYhnT_uCR8I2F3NgvOSxDbk93Fu2WEB6bWAf4xK6x14" value="form-jYhnT_uCR8I2F3NgvOSxDbk93Fu2WEB6bWAf4xK6x14"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
