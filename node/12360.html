<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12360 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:05:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Problems writing to Pi&#039;s serial port | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Problems writing to Pi&#039;s serial port</h3>
        <span class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 17/03/2016 - 14:57</span>
        <div class="content"><p>[ Edit - Title changed from &quot;BEWARE BEFORE UPDATING !!!&quot; since this&nbsp;is no longer&nbsp;the&nbsp;concern.]&nbsp;</p>
<p>There seems to be an issue writing to the serial port in the&nbsp;Raspbian&nbsp;OS once&nbsp;updated.</p>
<p>I am still trying to fathom this out, but thought I would post in case anyone who hasn&#39;t yet updated is thinking about doing so. In short, DON&#39;T.</p>
<p>As far as I can tell, this isn&#39;t anything to do with OEM software or images, as I have various Pi&#39;s with self built images, and it seems to affect all those &quot;recently&quot; updated. I do not know how recently yet, but I only have 1 Pi that continues to function correctly and it hasn&#39;t been updated in several months. ALL my others now have an issue. I have combinations of B+ and 2B models running both Wheezy&nbsp;and Jessie&nbsp;OSes.</p>
<p>My Pi 3 isn&#39;t up and running so I haven&#39;t checked that, but I expect the recent kernel changes for the Pi 3&#39;s bluetooth may be the root cause (but that&#39;s&nbsp;guesswork,&nbsp;2+2=5),</p>
<p>The symptoms are that you cannot write to the serial port. I have confirmed emonHub v1.2 cannot get a response so the rfm settings cannot be altered and&nbsp;avrdude cannot update firmware (reported as an issue on another thread). I have tried writing to the serial port from python and bash with no success.</p>
<p>I have tried as a root user (sudo), and tried adding &quot;pi&quot; to the dialout group, but as yet I have not found a way round this issue and cannot find any relative reports on the net. I have also tried using minicom to write to an rfm2pi and also used the arduino IDE serial terminal. I can communicate as usual with a JeeLink or&nbsp;USB devices via a programmer, but not with anything hooked up to the GPIO&nbsp;by any means.</p>
<p>I will post here if I find out more. but if anyone else has any ideas please don&#39;t be shy&nbsp;:-)</p>
<p>Paul</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12368.html" class="topic-previous" title="Go to previous forum topic">‹ Calibration procedure</a>
              <a href="12323.html" class="topic-next" title="Go to next forum topic">Possible tracking multiple inverters? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-40396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3623.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="manicmoddin&#039;s picture" title="manicmoddin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Problems writing to Pi's serial port</h3>

    <div class="submitted">Submitted by <a href="../user/3623.html" title="View user profile.">manicmoddin</a> on Thu, 17/03/2016 - 15:53.</div>
    <div class="content">
     <p>Hi,</p>
<p>If you go go into /dev</p>
<pre>
cd /dev
</pre><p>Then see the full permissions of the serial port</p>
<pre>
ls -lah | grep ttyUSB</pre><p>or</p>
<pre>
ls -lah | grep ttyACM</pre><p>If you can send in the results of this, it may give us a pointer towards the solution.</p>
<p>&nbsp;</p>
<p>Jimmy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40398"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Problems writing to Pi's serial port</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 17/03/2016 - 16:30.</div>
    <div class="content">
     <p>Using a wildcard one liner is another&nbsp;method to get all&nbsp;</p>
<p>ls -la /dev/tty*</p>
<p>or for just the serial devices</p>
<p>ls -la /dev/tty*[a-zA-Z]*[a-zA-Z0-9]</p>
<p>however the permissions were amoung the first thing I checked and appear the same&nbsp;</p>
<p>eg Working Pi</p>
<p>pi@mediaPi ~ $ ls -la /dev/tty*[a-zA-Z]*[a-zA-Z0-9]<br />
crw-rw---T 1 root dialout 204, 64 Mar 17 13:53 /dev/ttyAMA0<br />
crw-rw---T 1 root dialout &nbsp; 5, &nbsp;3 Jan &nbsp;1 &nbsp;1970 /dev/ttyprintk<br />
lrwxrwxrwx 1 root root &nbsp; &nbsp; &nbsp; &nbsp; 12 Feb 13 16:37 /dev/ttyS0 -&gt; /dev/ttyAMA0</p>
<p>&nbsp;</p>
<p>eg&nbsp;Non working Pi</p>
<p>pi@raspberrypi ~ $ ls -la /dev/tty*[a-zA-Z]*[a-zA-Z0-9]<br />
crw-rw---T 1 root dialout 204, 64 Mar 17 15:17 /dev/ttyAMA0<br />
crw-rw---T 1 root dialout &nbsp; 5, &nbsp;3 Jan &nbsp;1 &nbsp;1970 /dev/ttyprintk<br />
crw-rw---T 1 root dialout 188, &nbsp;0 Jan &nbsp;1 &nbsp;1970 /dev/ttyUSB0</p>
<p>​also&nbsp;it doesn&#39;t seem to complain about permissions as linux usually does, in fact I have tried removing &quot;pi&quot; from dialout to confirm the warnings are still being given when permissions are an issue, and they do seem to be</p>
<p>Paul.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40400"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3623.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="manicmoddin&#039;s picture" title="manicmoddin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Problems writing to Pi's serial port</h3>

    <div class="submitted">Submitted by <a href="../user/3623.html" title="View user profile.">manicmoddin</a> on Thu, 17/03/2016 - 16:54.</div>
    <div class="content">
     <p>Hi,</p>
<p>I didn&#39;t realise it was you Paul (oops)</p>
<p>However as you say this has confirmed it is not a permissions thing.</p>
<p>I guess these ones that are not working have been upgraded from older versions of raspian, not a fresh install?</p>
<p>If so do you get the same results in minicom?</p>
<p>Also what about plugging in a USB to Serial device or arduino?</p>
<p>Jimmy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40401"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Problems writing to Pi's serial port</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 17/03/2016 - 17:20.</div>
    <div class="content">
     <p>Hi Paul,&nbsp;</p>
<p>Thanks for letting everyone know.</p>
<p>Just to clear things up, the emonPi update and emonPi&nbsp;first boot update do not do an sudo apt-get update or upgrade. It merely&nbsp;git pulls from all our repos. Please, could you edit your first post not to mislead?</p>
<p>The RasPi3&nbsp;has indeed changed things with regard to the serial ports. By default UART0 (ttyAMA0) is connected the the BT.&nbsp;See my post for how to remap&nbsp;UART1 back to UART0 and why we need to do this:</p>
<p><a href="12311.html" title="https://openenergymonitor.org/emon/node/12311">https://openenergymonitor.org/emon/node/12311</a></p>
<p>Please, could you test this on a Pi2 with the changes I mention in my post above?</p>
<p>Update: just tested on a RasPi2 and full serial comms&nbsp;(including AVR upload) is working after adding</p>
<pre>
dtoverlay=pi3-disable-bt</pre><p>to /boot/config.txt, then running:</p>
<pre>
sudo systemctl disable hciuart​</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40405"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Problems writing to Pi's serial port</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 17/03/2016 - 18:46.</div>
    <div class="content">
     <p>Hi Glyn</p>
<p>I am aware of the Pi 3 BT v UART&nbsp;issue, it&#39;s the reason mine&#39;s sat here&nbsp;not being used yet, I&#39;m not really overly interested in the boost in power if it means &quot;hacking&quot; it to get the serial port working. I hope it gets fixed in future updates or if push comes to shove, I would&nbsp;drop the clock rate to retain BT and wifi, but I&#39;m happy to wait for now.</p>
<p>With this issue, the serial port is reading fine so mapping probably isn&#39;t the issue unless it can affect writing&nbsp;without affecting the reading. For that possibility, (and pure desperate optimism AKA clutching&nbsp;at straws) I tried the dtoverlay&nbsp;anyway, on both&nbsp;wheezy and jessie, and on a model B+ and a 2 B too, (just 2 B sure) but no change on any of them. The wheezy machines didn&#39;t recognise the &quot;systemctl&quot; command and have no &quot;hciuart&quot; service to halt. {EDIT - BTW Yes I did reboot for the changes to be picked up}</p>
<p>Paul</p>
<p>PS - I have now deleted the&nbsp;&quot;if using emonpi update&quot;&nbsp;warning.&nbsp;I had already edited it after checking the code and only left the correction there as it is better to be safe than sorry.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40410"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Problems writing to Pi's serial port</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 17/03/2016 - 21:44.</div>
    <div class="content">
     <p>Just for the record, the Kernel&nbsp;on the Feb emonSD image (before any&nbsp;updating) was&nbsp;4.1.18 and after the updates, the kernel is at 4.1.19. However, serial issues are more likely to be part of RaspberryPi firmware. Did you run rpi-update?</p>
<p>My Pi2 is working fine with serial sending and&nbsp;receiving&nbsp;after the&nbsp;dtoverlay=pi3-disable-bt change.&nbsp;</p>
<p>I don&#39;t think&nbsp;dtoverlay=pi3-disable-bt is too much of a hack as it&#39;s the official solution from the RaspberryPi team. I agree, we don&#39;t really need the extra power of the Pi3. However, on-board WiFi is nice. I have no use for BT, hence for most applications it&#39;s no big loss. From what I have read, dropping the clock and using UART1&nbsp;to communicate with the RFM69Pi / emonPi still has issues since UART1 has less buffering and baud rate could still fluctuate due to undervoltage or overheating throttling.</p>
<p>You are probably wise letting the dust settle on the Pi3! It took me most of a day, a couple of days after the Pi3 was launched to find a fix for the UART issue. This is how long it took the Pi team to implement the &#39;fix&#39;!&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40425"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Problems writing to Pi's serial port</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 19/03/2016 - 10:28.</div>
    <div class="content">
     <p>After many hours of debugging, I found what I had believed to be a <em>&quot;known good&quot;</em>&nbsp;rfm69pi, used to debug what started out as&nbsp;an &quot;avrdude&quot; related issue,&nbsp;is actually faulty. It is blind to any activity on it&#39;s RX line.</p>
<p>I will report back if I find anything of use when I look at the rfm69pi, but for now I must put it aside and press on with the original task.</p>
<p>Thanks for the suggestions.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12360"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-vBCauXL3BXv9Or3m0JeCTg3aMUMX8vVzSoyj1iI72Sw" value="form-vBCauXL3BXv9Or3m0JeCTg3aMUMX8vVzSoyj1iI72Sw"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
