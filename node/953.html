<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/953 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:08:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>PHASE calculations | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">PHASE calculations</h3>
        <span class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Thu, 16/08/2012 - 13:00</span>
        <div class="content"><p>I'm currently working on a combined solar PV energy diverter and energy monitoring circuit + code. Think of emonTX combining calypso_rae's solar code.</p>
<p>&nbsp;</p>
<p>I'm using a mascott AC adapter and voltage divider circuit as per calypso_rae's diagram (using the OpAmp to provide 2.5v reference/bias).&nbsp; However for current measurements, I'm using the OpAmp circuit as per the eMonTX SMT (and AVR notes).</p>
<p>Currently the OpAmp is running a fixed gain and appears to be working fine.</p>
<p>&nbsp;</p>
<p>The problem I'm having is that the phase of the two readings is out by a long way.&nbsp; I've captured two traces, one from my &quot;toy&quot; scope and the other straight from the Arduino (just raw AnalogRead statements), both uploaded to Google spreadsheets...</p>
<p>Read from scope...<br />
<a href="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdHE1MEwyUUhVSjBKMVNkcEItNklqbkE" title="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdHE1MEwyUUhVSjBKMVNkcEItNklqbkE">https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdHE1MEwyUUhVSjB...</a></p>
<p>Read from Arduino..<br />
<a href="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5RYldHSXFodDhEYVE" title="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5RYldHSXFodDhEYVE">https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5...</a></p>
<p>
On the spreadsheet,&nbsp;I've then applied the same filters that the code does to try and replicate as much as I can.&nbsp; The problem that I'm seeing is that the current is in front of the voltage readings by around 5 samples (forgot what my time base was!)</p>
<p>&nbsp;Whats the best way to correct this gap and why is is occuring ?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="902.html" class="topic-previous" title="Go to previous forum topic">‹ Thought of an idea: PV storage</a>
              <a href="969.html" class="topic-next" title="Go to next forum topic">Phase controlled power switch for &#039;excess&#039; solar power ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-5744"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 16/08/2012 - 14:55.</div>
    <div class="content">
     <p>You are reading every 6&deg; approx, so 5 samples = a ridiculous phase shift. I honestly don't believe it. I think you need to track down why you have so much phase difference. It shouldn't be that much. Have you made any of the coupling capacitors smaller? Are you sure you had a resistive load ? ! !&nbsp;!&nbsp;</p>
<p>There are two effects: (1) the TIME difference between the two readings (because the software reads sequentially of course), and (2) the <em>difference</em> between the phase shifts of the a.c. voltage sensor and the current sensor. Depending on which is read first and which is larger, that either adds to or subtracts from the time difference. I plotted the phase shifts for the Mascot adapter and the YHDC c.t. at various voltages, currents and burdens and you can check those numbers in the reports. The time taken to read an analogue input is around 180 &micro;s (= 3.24&deg;)</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5745"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 16/08/2012 - 15:21.</div>
    <div class="content">
     <p>There are ~122 samples taken for every channel (voltage and curent) in one full wave of 20ms (50Hz), means ~164us/sample. How did you do this as one analogRead() takes ~110us? Or did you read one full wave of voltage samples first and then one full wave of current samples? But how did you synchronize this?</p>
<p>Strange. And the 1ms peaks on the current are also quite strange.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5751"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Thu, 16/08/2012 - 19:57.</div>
    <div class="content">
     <p>Assuming that you are looking at the arduino link above, not the scope output...</p>
<p>You can reduce the time of analogRead by changing the pre-scaler, without substantially reducing the resolution.</p>
<p>This is the Arduino code I used to make the measurements above, I've using a 32 division on the prescaler, 128 is standard.</p>
<p>&nbsp;ATMEL reference document... <a href="http://www.atmel.com/dyn/resources/prod_documents/DOC2559.PDF" title="http://www.atmel.com/dyn/resources/prod_documents/DOC2559.PDF">http://www.atmel.com/dyn/resources/prod_documents/DOC2559.PDF</a></p>
<p class="rteindent1">QUOTE: <em>The ADC accuracy also depends on the ADC clock. The recommended maximum  ADC clock frequency is limited by the internal DAC in the conversion  circuitry. For optimum performance, the ADC clock should not exceed 200  kHz. However, frequencies up to 1 MHz do not reduce the ADC resolution  significantly. Operating the ADC with frequencies greater than 1 MHz is not characterized.</em></p>
<p><img src="../../../i187.photobucket.com/albums/x269/jmknapp/adc_prescale.png" alt="" /></p>
<pre>
// define the input pins
#define voltageSensorPin A2
#define currentSensorPin A3

#define m 250

int sampleV[m];
int sampleI[m];

// defines for setting and clearing register bits
#ifndef cbi
#define cbi(sfr, bit) (_SFR_BYTE(sfr) &amp;= ~_BV(bit))
#endif
#ifndef sbi
#define sbi(sfr, bit) (_SFR_BYTE(sfr) |= _BV(bit))
#endif


void setup()
{ 
  Serial.begin(115200);

  //set prescale as per forum on <a href="http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1208715493/11" title="http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1208715493/11">http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1208715493/11</a>
  //table of prescale values... <a href="../../../i187.photobucket.com/albums/x269/jmknapp/adc_prescale.png" title="http://i187.photobucket.com/albums/x269/jmknapp/adc_prescale.png">http://i187.photobucket.com/albums/x269/jmknapp/adc_prescale.png</a>
  //Prescale 32
  sbi(ADCSRA,ADPS2);  //ON
  cbi(ADCSRA,ADPS1);  //OFF
  sbi(ADCSRA,ADPS0);  //ON
}

void loop() {

  int i=0;
  bool flag1=false;
  bool flag2=false;

  while (i&lt;m) {
    sampleI[i] = analogRead(currentSensorPin);                 //Read in raw current signal
    sampleV[i] = analogRead(voltageSensorPin);                 //Read in raw voltage signal
    delayMicroseconds(100);

    if (sampleV[i]&gt;700 &amp;&amp; flag1==false &amp;&amp; flag2==false) flag1=true;

    if (sampleV[i]&lt;250 &amp;&amp; flag1==true &amp;&amp; flag2==false) {
      flag2=true;
//Wait until almost the start of the wave
      delayMicroseconds(6000);
      i--;
    }

    if (flag1==true &amp;&amp; flag2==true) i++;
  }


&nbsp; Serial.println(&quot;VOLTAGE=&quot;);
&nbsp; for (int index = 0; index &lt; m; index++)
&nbsp; {
&nbsp;&nbsp;&nbsp; Serial.print(sampleV[index]);
&nbsp;&nbsp;&nbsp; Serial.print('\t');
&nbsp; }
&nbsp; Serial.println(&quot;&quot;);
&nbsp; Serial.println(&quot;CURRENT=&quot;);
&nbsp; for (int index = 0; index &lt; m; index++)
&nbsp; {
&nbsp;&nbsp;&nbsp; Serial.print(sampleI[index]);
&nbsp;&nbsp;&nbsp; Serial.print('\t');
&nbsp; }
&nbsp; Serial.println(&quot;&quot;);

&nbsp; delay(20000);
}
</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5753"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Thu, 16/08/2012 - 20:31.</div>
    <div class="content">
     <p>Thanks for checking the graphs Robert.</p>
<p>I'm using a current circuit the same as this one, MINUS the C2/R3/R4 circuit - for this I'm feeding 2.5v from an OpAmp divider circuit (as per calypso_rae circuit).&nbsp; I've also not installed the bilateral switches so all that lot is removed and I have C1/R11 and R2 in place.</p>
<p>C1 is 10uF as per below, but just checked the ATMEL&nbsp;sheet where this diagram was copied from and that is using a 47uF - is this the problem?</p>
<p>I'm using a 22ohm for RS&nbsp;(burden), and the SCT-013-000 clamp.</p>
<p><img src="../../../3.bp.blogspot.com/-Z6-WTfCXnfY/T9S-l-RCp3I/AAAAAAAAbrk/eYv7rMySnNQ/s640/Labeled%20Atmel%20Energy%20Monitor%20app%20note.png" alt="" /></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5755"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Thu, 16/08/2012 - 21:06.</div>
    <div class="content">
     <p>Answering my own posts, I've changed to a 47uF capacitor and that seems to have brought things back in line.</p>
<p>Just for reference, I'm reading current before voltage on the Arduino.</p>
<p>If you get chance, have a look at the google spreadsheet again</p>
<p><a href="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5RYldHSXFodDhEYVE" title="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5RYldHSXFodDhEYVE">https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5...</a></p>
<p>&nbsp;</p>
<p>I've also discovered what the small spikes in current are as well - it only happens when I've got an open COM port window to the arduino!&nbsp; On the scope, you can see the spikes &quot;sliding&quot; along the current wave form.&nbsp; Without any serial connection, the scope shows the waves as smooth - is this just noise being picked up by the Opamp ?</p>
<p>&nbsp;My Opamp(s) and Arduino CPU are all on the same breadboard by the way</p>
<p>&nbsp;</p>
<p>Additionally, I'm just connecting pin 20 AVCC&nbsp;to VCC just as the emonTX does - looking at most references, if you are using the ADC, this should be connected to a low pass filter - not just to VCC - is this where the issue lies?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5758"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 16/08/2012 - 22:04.</div>
    <div class="content">
     <p>Are you sure it was 10&micro;F and not 1&micro;F?&nbsp; According to me 1&micro;F will give you a 25&deg; or so phase shift, 10&micro;F about 2&frac12;&deg;.&nbsp;</p>
<p>The spikes (if they're asynchronous) are almost certainly digital noise - picked up either by the op-amp or the analogue input itself. You need to clean up your earthing arrangements, and adding some decoupling to AVcc wouldn't hurt.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5762"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Fri, 17/08/2012 - 07:05.</div>
    <div class="content">
     <p><em>You can reduce the time of analogRead by changing the pre-scaler, without substantially reducing the resolution.</em></p>
<p>Thnks for clarifying this, it is always good to know how the measuring data was taken <img src="../sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/regular_smile.html" alt="" />. And, true, you can increase the clock frequency without to much noticable increase in error but the datasheet also specifies an increase in absolute accuracy <em>error</em> from 2 to 4.5 LSBs when increasing the clock from 200kHz to 1MHz.</p>
<p>&nbsp;</p>
<p><em>Answering my own posts, I've changed to a 47uF capacitor and that seems to have brought things back in line.</em></p>
<p>I would have thought that this change has an effect, but not as big as it seems to be in reality (and my 'stomach feeling' would have predicted a shift in the other direction!?!). Good to know. A Pspice simulation with different values would be nice here.</p>
<p>&nbsp;</p>
<p>Regarding the 'noise' from the serial: Breadboards and Opamps can be a tricky combination (although this a a really slow Opamp). Hmmm, and 1ms does not really fit to 115kBaud....</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5770"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 17/08/2012 - 01:17.</div>
    <div class="content">
     <blockquote><p>&quot;(and my 'stomach feeling' would have predicted a shift in the other direction!?!)&quot;</p>
</blockquote>
<p>See here: <a href="http://www.electronics-tutorials.ws/filter/filter_3.html " title="http://www.electronics-tutorials.ws/filter/filter_3.html ">http://www.electronics-tutorials.ws/filter/filter_3.html </a> In the initial results posted, the current curve led the voltage curve and the filter was in the current input. Those results were consistent with a capacitor value of about 1&micro;F, as I wrote above. I think the capacitor was faulty, wrongly labelled or misread.</p>
<p><img src="data:image/png;base64,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" alt="" /></p>
<p>&nbsp;</p>
<blockquote><p>&quot;Regarding the 'noise' from the serial: Breadboards and Opamps can be a tricky combination&quot;</p>
</blockquote>
<p>There is anecdotal evidence that Arduino-based designs with prototype-board front end circuitry are more prone to reading current when none is flowing (i.e. noise pick-up), than emonTx-based installations. And that is without the op-amp.</p>
<blockquote><p>&quot;.... Hmmm, and 1ms  does not really fit to 115kBaud....&quot;</p>
</blockquote>
<p>And the spikes are probably the effect of ground currents resulting from the message burst and smoothed out by some supply decoupling, rather than individual 1s and 0s. 14 characters transmitted lasts about 1 ms, which sounds about right to me..</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5774"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Fri, 17/08/2012 - 07:15.</div>
    <div class="content">
     <p>Robert,</p>
<p>I think your last but one post came when I was editing. So the effect of lower C is shifting the curve to the left, ok (hope this helps to re-program my 'stomach'<img alt="" src="../sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/regular_smile.html" />).</p>
<p>But 115kBaud and 12 bits per character gives ~104us and 14 characters would then give ~1.5ms. This is why I thought it would not really fit. Still, the 'board design' could certainly induce oszillations in the opamp circuit.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5781"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Fri, 17/08/2012 - 12:06.</div>
    <div class="content">
     <p>The ripples on the sine wave are there even when not outputting any serial data - as long as the arduino COM port window is open, the noise is there !&nbsp; Could this be one of the clock or DTR lines ??</p>
<p>I even tried moving the serial.begin() instruction to later in the code (just before first print statements) hoping that the serial connection would be closed until this point - no luck I'm afraid.</p>
<p>&nbsp;</p>
<p>The 10uF capacitor was fresh out of the bag of recently purchased cap's - I'm sure it was 10uF - will check again to make sure - could be faulty !</p>
<p>&nbsp;</p>
<p>Any recommendations on the decoupling to AVcc?&nbsp; Seems very little of our standard boards include this - including the eMonTX !</p>
<p>&nbsp;</p>
<p>I might just swap over the circuit onto strip board so hope that helps.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a title="View user profile." href="../user/1332.html">JBecker</a>, I'm using a 32 prescale on this circuit/code so running at 0.5Mhz, so hopefully the error rate will be okay.&nbsp; After code optimisation, I will try and go back to the default assuming I get enough CPU cycles to do everything.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5813"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Sun, 19/08/2012 - 19:45.</div>
    <div class="content">
     <p>I've added a 100nF capacitor between ground and&nbsp; C1/R11 and that has removed the transmission spikes I was getting - don't think its changed the waveform - any comments please ?</p>
<p>I've updated my spreadsheet at...</p>
<p><a href="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5RYldHSXFodDhEYVE#gid=0" title="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5RYldHSXFodDhEYVE#gid=0">https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5...</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5817"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 19/08/2012 - 23:05.</div>
    <div class="content">
     <blockquote><p>&quot;I've added a 100nF capacitor between ground and&nbsp; C1/R11 and that has  removed the transmission spikes I was getting - don't think its changed  the waveform - any comments please ?&quot;</p>
</blockquote>
<p>I don't think I would have added it there - but I'm not at all sure where I would have added it - if at all. I don't know what your circuit layout is - from what you mentioned earlier I presume plugboard - so my first thoughts would be to look carefully where the digital currents to the &micro;P flow - both supply current from the power supply and ground current returning to the power supply (not forgetting the ground/common of the serial link) and make sure all these paths are as low resistance as you can manage, and as separate as possible from the equivalent on the analogue side, the two joining as close to the power supply and the main decoupling/smoothing capacitors as possible.</p>
<p>Track down <a href="http://www.google.co.uk/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;ved=0CFkQFjAA&amp;url=http%3A%2F%2Fwww.atmel.com%2Fimages%2Fdoc2521.pdf&amp;ei=IXAxUKfCOcLL0QWO5IDwDA&amp;usg=AFQjCNEsdm8pIr_hAKI_da5-r-QAAwtW3A">App Note AVR042</a> on the Atmel website - you might find some inspiration there.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5823"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Mon, 20/08/2012 - 12:51.</div>
    <div class="content">
     <p>Thanks for the comments Robert, I'll go and check the plugboard layout and read through those notes.</p>
<p>I think the visibility of the spikes is simply down to over-amplification of a small current clamp signal, and hence the ripple is appearing larger than in reality.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5825"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 20/08/2012 - 19:19.</div>
    <div class="content">
     <p>Just spotted this thread while browsing around ...</p>
<p>Regarding the large amount of phase advance seen with the standard CT, here are a couple of pics that I took yesterday using a freebie digital scope tool.&nbsp; The green waveform is simply a potted down version of the mains, with (presumably) no phase-shift.&nbsp; The red waveform is the output from a standard YHDC 30A CT with a 39R burden.&nbsp; The load in both cases was a 2kW resistive 'space heater'.</p>
<p>4a shows these waveforms as graphs, and 4b as&nbsp;a Lissajous diagram.&nbsp; As you can see, the CT is causing quite a significant phase-advance.&nbsp; If a larger valued burden were to be used, such as the 150R that I initially suggested for my Mk2 design, the phase shift would be considerably greater than this.&nbsp;</p>
<p>I've never used a Mascot adapter but have obtained AC voltage signals using a variety of transformer-based approaches.&nbsp; Unfortunately, they all introduce distortion of the waveform including some phase-advance.&nbsp; Because both types of wound-components shift the phase in the same direction, their effects largely cancel out.&nbsp; To realign both waveforms for power calculations, PHASECAL can therefore need be less than it would otherwise need to be.</p>
<p>If anyone knows a way of obtaining an image of the mains voltage without distorting the waveform (other than by using a resitive divider), I'd be most pleased to hear about it.&nbsp; Until a better arrangement is found, I fear that our attempts to divert all surplus PV energy will be unlikely to succeed.</p>
<p>HEALTH WARNING:&nbsp; If wishing to repeat these tests, please read the comprehensive safety guidance posted by Robert Wall in his <a href="https://learn.openenergymonitor.org/?redirect=report-mascot-9v-acac-adaptor">report on the Mascot adapter</a>.&nbsp; Connecting to live mains, and removing earths, can be bad for one's health!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5833"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Tue, 21/08/2012 - 11:35.</div>
    <div class="content">
     <p>If we assume (for safety) that we would be using a transformer, and accept that this is introducing a phase shift, could we not then artificially delay the current reading using some sort of delay or timing circuit to match ?</p>
<p>Will still need to take into account the delay offset of the 2 analog reads on the Arduino as well though.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5834"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 21/08/2012 - 11:57.</div>
    <div class="content">
     <p><em>If anyone knows a way of obtaining an image of the mains voltage without  distorting the waveform (other than by using a resitive divider), I'd  be most pleased to hear about it.&nbsp; Until a better arrangement is found, I  fear that our attempts to divert all surplus PV energy will be unlikely  to succeed.</em></p>
<p>Robin,</p>
<p>is the transformer distortion really a factor that will prevent you from making 'good enough' calculations? Then I would still propose to use a 400V transformer. If you have problems getting one, I could supply you with an E30 400V primary 21V secondary 2.1VA for testing. I don't have a price at the moment, but should definitely be less than &euro;8. This is a bare transformer without leads nor enclosure though.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5839"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 21/08/2012 - 14:42.</div>
    <div class="content">
     <p><a href="../user/450.html" title="View user profile.">stuart</a></p>
<blockquote><p>&quot;could we not then artificially delay the current reading using some sort of delay or timing circuit to match ?&quot;</p>
</blockquote>
<p>That's precisely what the interpolation calculation and PhaseCal achieves!</p>
<blockquote><p>&quot;2 analog reads&quot;</p>
</blockquote>
<p>2 ? ? ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5840"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 21/08/2012 - 14:48.</div>
    <div class="content">
     <p><em>Stuart: If we assume (for safety) that we would be using a transformer, and  accept that this is introducing a phase shift, could we not then  artificially delay the current reading using some sort of delay or  timing circuit to match ?</em></p>
<p>In short, yes.&nbsp; If either transformer introduces a small amount of phase-shift, that's not a problem.&nbsp; Voltage and current measurements are taken alternately approx 2.5 degrees apart.&nbsp; If one is advanced by no more than 5 degrees relative than to the other, then that difference can be easily accommodated by the use of PHASECAL in the range 0 to 1.&nbsp; </p>
<p><em>Will still need to take into account the delay offset of the 2 analog reads on the Arduino as well though.</em></p>
<p>By measuring V and I in the right order, this offset can be used to our advantage.&nbsp;  Whichever is the more advanced should be measured first.&nbsp; </p>
<p>For a given set of hardware, if current is the more advanced, then current should be measured first and voltage second.&nbsp; PHASECAL should then be applied to the voltage samples.&nbsp; If voltage were found to be the more advanced, then voltage should be measured first, and current second.&nbsp; In that case, PHASECAL should be applied to the current samples.</p>
<p><em>J&ouml;rg,</em> Thanks for your suggestion (again) of using a 400V transformer.&nbsp; When I tried using two 240V ones in series, the phase-shift was definitely reduced but the shape of the output waveform was still distorted.&nbsp; If I can find a better transformer which does not distort the waveform, that would be great.&nbsp; I may be more likely to find such a device as a 400V model rather than a 240V one.</p>
<p>Attached are the results of comparing my normal 'telecom' AC adapter against a known good voltage reference.&nbsp; As you can see, it is not the phase advance that is main problem; it is the distortion of the waveform's shape that concerns me.&nbsp; That's why I need to find a better transformer.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5842"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Tue, 21/08/2012 - 14:55.</div>
    <div class="content">
     <p>I wonder if an op-amp circuit like this</p>
<p><a href="http://www.tedpavlic.com/teaching/osu/ece209/lab1_intro/lab1_intro_phase_shifter.pdf" title="http://www.tedpavlic.com/teaching/osu/ece209/lab1_intro/lab1_intro_phase_shifter.pdf">http://www.tedpavlic.com/teaching/osu/ece209/lab1_intro/lab1_intro_phase...</a></p>
<p>would be useful to delay the current (or voltage) signal rather than using code to fix ?&nbsp; Would also free up a couple of CPU cycles and remove some floating point math.</p>
<p>&nbsp;I might have a play with this tonight and see what happens.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5843"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 21/08/2012 - 15:18.</div>
    <div class="content">
     <p>Stuart,</p>
<p>you could do the first tests with a simple RC (e.g. 100k poti + 10n). This will give some attenuation of the amplitude too, but you have to calibrate the amplitude anyway. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5844"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 21/08/2012 - 15:27.</div>
    <div class="content">
     <p><a title="View user profile." href="../user/1332.html">JBecker</a></p>
<p>I know of a way - but it's not practical for general use! You need to use one of the many specialised devices (from all the usual sources) - an ADC with opto-isolated digital output - but they require their own isolated floating supply for the isolated mains side as well as a common supply for the processor non-isolated side.</p>
<p>Aside from cost and complexity, there remains the question of working on live equipment and the safety concerns that go with that. It is not something I could recommend to constructors lacking the required knowledge and experience.</p>
<p>This is essentially what <span class="submitted"><a title="View user profile." href="../user/851.html">daveb</a></span> did here: <a href="../../../www.rotwang.co.uk/projects/images/mains_opto.html" title="http://www.rotwang.co.uk/projects/images/mains_opto.gif">http://www.rotwang.co.uk/projects/images/mains_opto.gif</a></p>
<p>I think the 'best' general universal answer to the problem is a custom-made transformer that has been specified to have minimal waveform distortion and phase shift, ideally in a plug-top case (and even better if it had interchangeable adapters like my Seagate external drive power supply). Unfortunately, cost is likely to be somewhat more than the 'cheap &amp; cheerful' mass-produced adapter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5845"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 21/08/2012 - 15:29.</div>
    <div class="content">
     <p>Because V and I are measured at different times, some means of re-aligning them needs to be included in the code.&nbsp; If both of the sensors were perfect, either parameter could be measured first.&nbsp; Applying PHASECAL = 0.5 to the one that is measured second would then align V and I perfectly.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5846"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 21/08/2012 - 15:59.</div>
    <div class="content">
     <p><em>Because V and I are measured at different times, some means of re-aligning them needs to be included in the code.</em></p>
<p>Not neccessarily. If the signal that 'comes first' is delayed by the correct amount, you could get rid without any phase shifting calculation. I think this is what Stuart meant. It would make at least these float calculations obsolete.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5850"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 21/08/2012 - 17:18.</div>
    <div class="content">
     <p><em>If the signal that 'comes first' is delayed by the correct amount, you could get rid without any phase shifting calculation.</em></p>
<p>Agreed.&nbsp; If one of both of the signals were to be phase-shifted by the correct amount in hardware, there would be no need for any equivalent adjustment in software.&nbsp; However, I don't think that float calculations could ever be avoided altogether as some form of filtering of the sample stream(s) will always be needed, if only to remove the DC-offset.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5853"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 21/08/2012 - 19:53.</div>
    <div class="content">
     <p><em>However, I don't think that float calculations could ever be avoided altogether....</em></p>
<p>Disagree <img alt="" src="../sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/regular_smile.html" />. Float calculations can always be avoided. They do not <em>unconditionally</em> give a better accuracy or higher precision. Float uses 4 bytes per variable, same as long. The number of different values that you can build with a long is exactly the same as with a float. A float can just cover a 'bigger' range of values more easily (but with bigger 'holes' in between values). This makes it easier to combine very small and very big numbers in the same calculation and still get a decent result. But the same can be accomplished with integer calculation with careful choice of values (or 'resizing').</p>
<p>We have discussed this in another thread already, a (float) multiplication (0.966*X) gives the same result as an integer calculation (255*X / 256) or ( (255*X)&gt;&gt;8) or ( (X&lt;&lt;8)-X) and the integer calculations are way faster. (There is a small difference in the result, but this is not a fundamental one.)</p>
<p>But I think this might be a bit off-topic here.</p>
<p>&nbsp; &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5854"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Tue, 21/08/2012 - 21:43.</div>
    <div class="content">
     <p>Might be on to something here....</p>
<p>I've got this circuit built...</p>
<p>CT&nbsp;SENSOR&nbsp;&gt;&gt; OP AMP GAIN &gt;&gt;&nbsp;PHASE&nbsp;SHIFT&nbsp;OPAMP &gt;&gt;&nbsp;ANALOGUE&nbsp;PIN</p>
<p>AC&nbsp;ADAPTER&nbsp;&gt;&gt;&nbsp;VOLTAGE DIVIDER +&nbsp;OPAMP&nbsp;OFFSET VOLTAGE &gt;&gt; ANALOGUE&nbsp;PIN</p>
<p>&nbsp;</p>
<p>After tweaking the &quot;phase shift&quot; by changing the resistance in the circuit from here..</p>
<p><a href="http://www.tedpavlic.com/teaching/osu/ece209/lab1_intro/lab1_intro_phase_shifter.pdf" title="http://www.tedpavlic.com/teaching/osu/ece209/lab1_intro/lab1_intro_phase_shifter.pdf">http://www.tedpavlic.com/teaching/osu/ece209/lab1_intro/lab1_intro_phase...</a></p>
<p>(I used 7.4k as the variable, 10k for RF, and 0.1uF electrolitic capacitor)</p>
<p>&nbsp;</p>
<p>I get the following output...</p>
<p><a href="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5RYldHSXFodDhEYVE" title="https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5RYldHSXFodDhEYVE">https://docs.google.com/spreadsheet/ccc?key=0AvDz3-CEPA_tdGlOb1JQaXJLVW5...</a></p>
<p>which looks good to me!</p>
<p>&nbsp;</p>
<p>Additionally, I've seemed to solve the spikes I was getting by putting 100nF caps to ground on the op-amps and seperating analogue and digital +/- connections.</p>
<p>Assuming everyone thinks this is a good idea, the only problem I can see is drift on the components due to temperature changes.</p>
<p>&nbsp;</p>
<p>I'm now reading VOLTAGE&nbsp;before CURRENT&nbsp;by the way, and this is the sketch I've used to tweak the resistance until &quot;just right&quot;.</p>
<p>&nbsp;</p>
<pre>
// define the input pins
#define voltageSensorPin A2
#define currentSensorPin A3
#define m 250

int sampleV[m];
int sampleI[m];

// defines for setting and clearing register bits
#define cbi(sfr, bit) (_SFR_BYTE(sfr) &amp;= ~_BV(bit))
#define sbi(sfr, bit) (_SFR_BYTE(sfr) |= _BV(bit))

void setup()
{  
  //set prescale as per forum on <a href="http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1208715493/11" title="http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1208715493/11">http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1208715493/11</a>
  //table of prescale values... <a href="../../../i187.photobucket.com/albums/x269/jmknapp/adc_prescale.png" title="http://i187.photobucket.com/albums/x269/jmknapp/adc_prescale.png">http://i187.photobucket.com/albums/x269/jmknapp/adc_prescale.png</a>
  //Prescale 32
  sbi(ADCSRA,ADPS2);  //ON
  cbi(ADCSRA,ADPS1);  //OFF
  sbi(ADCSRA,ADPS0);  //ON
  Serial.begin(115200);
}

void loop() {
  delay(1000);
  int i=0;
  //IMPORTANT - ensure power and voltage readings stay constant throughout measurement!!  
  //Read lots of samples to find the min/max range
  //Do this one at a time to avoid delays in analogRead...
  int lowI=9999, highI=0;
  for(int i=0;i&lt;500;i++) {  
    int r = analogRead(currentSensorPin);
    if (r&lt;lowI) lowI=r;
    if (r&gt;highI) highI=r;
  }

  int lowV=9999, highV=0;
  for(int i=0;i&lt;500;i++) {  
    int r = analogRead(voltageSensorPin);
    if (r&lt;lowV) lowV=r;
    if (r&gt;highV) highV=r;
  }

  Serial.print(&quot;Voltage range=&quot;);
  Serial.print(lowV);
  Serial.print(&quot; to &quot;); 
  Serial.println(highV);
  Serial.print(&quot;Current range=&quot;);
  Serial.print(lowI);
  Serial.print(&quot; to &quot;); 
  Serial.println(highI);

  int zeroV=lowV+((highV-lowV)/2);
  int zeroI=lowI+((highI-lowI)/2);

  while(1) {
    sampleV[i] = analogRead(voltageSensorPin);                 //Read in raw voltage signal

    if (sampleV[i]==zeroV) {      
      //Get the next cycle
      delayMicroseconds(20000-5500);
      while (i&lt;m) {
        sampleV[i] = analogRead(voltageSensorPin);                 //Read in raw voltage signal
        sampleI[i] = analogRead(currentSensorPin);                 //Read in raw current signal
        delayMicroseconds(50);
        i++;
      }

      //Find where the current goes over zero cross
      int startI=sampleI[0];
      int indexI=0;
      for (int index = 0; index &lt; m; index++) 
      {
        if ((startI&gt;zeroI &amp;&amp; sampleI[index]&lt;zeroI) || (startI&lt;zeroI &amp;&amp; sampleI[index]&gt;zeroI)) {
          Serial.print(&quot;Current zero cross at index=&quot;);
          Serial.print(index);
          indexI=index;
          break;
        }
      }      

      int startV=sampleV[0];
      int indexV=0;
      for (int index = 0; index &lt; m; index++) 
      {
        if ((startV&gt;zeroV &amp;&amp; sampleV[index]&lt;zeroV) || (startV&lt;zeroV &amp;&amp; sampleV[index]&gt;zeroV)) {
          indexV=index;
          Serial.print(&quot;  Voltage zero cross at index=&quot;);
          Serial.print(indexV);
          break;
        }
      }      

      Serial.print(&quot;  DIFFERENCE   =&quot;);
      Serial.println(indexI-indexV);

      if (abs(indexI-indexV) &lt; 10) {
        Serial.println(&quot;VOLTAGE=&quot;);
        for (int index = 0; index &lt; m; index++) 
        {
          Serial.print(sampleV[index]);          Serial.print('\t');
        }
        Serial.println(&quot;&quot;);
        Serial.println(&quot;CURRENT=&quot;);
        for (int index = 0; index &lt; m; index++) 
        {
          Serial.print(sampleI[index]);          Serial.print('\t');
        }
        Serial.println(&quot;&quot;);

        delay(20000);

      }

      delay(1000);

      i=0;
    }
  }
}

</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5856"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 21/08/2012 - 22:39.</div>
    <div class="content">
     <p>Sorry Jorg, I'm probably confusing long and float :(</p>
<p>I have often wondered how effective the PHASECAL approach is at compensating for phase-shift between voltage and current.&nbsp;&nbsp; So I've just created a tool, as attached, which tests this out.</p>
<p>Both sets of samples, V and I, are in floating point form and there are no dc-offsets or filters.&nbsp; It simply synthesizes V &amp; I values for one cycle and combines their instantaneous power contributions.&nbsp; At the end of the cycle, the accumulated power sum is 25, no doubt because I've chosen to have 50 samples per cycle, and V and I both have half-amplitudes of 1.</p>
<p>Anyway, the numbers are not important.&nbsp; What <em><u>is</u></em> important is the effect that PHASECAL has when used outside the 0 - 1 range, i.e when it is&nbsp; predicting rather than interpolating.&nbsp; Here are the results:</p>
<p>Column 1: # samples of phase advance (current);&nbsp; Column 2: PHASECAL, as applied to voltage;&nbsp; Column 3: power error ratio</p>
<p>-1 &nbsp; &nbsp;&nbsp; 0 &nbsp; &nbsp;&nbsp; 1.0000</p>
<p>-0.5&nbsp;&nbsp; 0.5&nbsp;&nbsp;&nbsp; 0.9980</p>
<p>0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.0000</p>
<p>1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.0156</p>
<p>2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.0462</p>
<p>3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.0902</p>
<p>So, with a perfect sinusoid, a matched PHASECAL&nbsp;value of 2 (i.e. predicting just one sample into the future) introduces a magnitude error of 1.5%!&nbsp; As PHASECAL is increased, so does the error - rapidly.&nbsp; </p>
<p>The small amount of error (no more than 0.2%) when interpolating in the range 0 to 1 is unavoidable in a digital system when V and I measurements can't be taken at the same instant.&nbsp; An alternative approach in hardware might not suffer in this way.&nbsp; Another option would be to perform the interpolation using a better method than straight linear.&nbsp; </p>
<p>For accurate measurements of power, I feel sure that any phase-shifts within our voltage and current transformers should be within one sample of each other.&nbsp; Then they can be effectively aligned using PHASECAL within the range 0 to 1.&nbsp; Moreover, they should not otherwise distort the waveform because that can't be rectified using PHASECAL.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5857"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 21/08/2012 - 23:14.</div>
    <div class="content">
     <p>Your &quot;phase shift&quot; circuit is commonly known as an &quot;all-pass&quot; filter. The phase shift is of course frequency-dependent, but as the mains frequency tolerance is &plusmn;1%, that should not be an issue.</p>
<p>However, if your load includes switching power supplies, the current input is likely to have a higher harmonic content than the voltage (which <em>ought</em> to be a pure sine wave, but we know it isn't), so my instinct would - without the benefit of a full analysis - have been to apply the filter to the voltage wave so as to more faithfully preserve the shape of the current waveform.</p>
<p>This is what happens to a square wave passed through your filter:</p>
<p><img alt="" src="data:image/png;base64,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" /></p>
<p>[OK, you won't get a current waveform like that].</p>
<blockquote><p>&quot;putting 100nF caps to ground on the op-amps&quot;</p>
</blockquote>
<p>- do you mean decoupling the supply to the op-amps? - recommended practice and a good idea if so.<img src="../sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/thumbs_up.html" alt="" /></p>
<blockquote><p>&quot;0.1uF electrolitic capacitor&quot;</p>
</blockquote>
<p>You really ought to use a non-polarised component there - one of those 100nF plastic film capacitors, which should have a much tighter tolerance on value than an electrolytic anyway, and less liable to change its value with age.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5858"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 21/08/2012 - 23:29.</div>
    <div class="content">
     <p>The tool that I've just posted can also show the effect of having a PHASECAL value that is not perfectly matched to the phase-shift that exists between voltage and current.&nbsp; </p>
<p>It turns out that the 'best' value of PHASECAL&nbsp;is not actually one less than the number of samples of phase-shift.&nbsp; As phase shift increases, the optimum value of PHASECAL increases at a slower rate.&nbsp; To keep the power error ratio at 1, we find that:</p>
<p>if current is advanced by 1 sample, the optimal PHASECAL value is approx 1.5, i.e. predicting the voltage by only half a sample;</p>
<p>if current is advanced by 2 samples, the optimal voltage prediction is approx 2, i.e. predicting the voltage by only one sample;</p>
<p>if current is advanced by 3 samples, the optimal voltage prediction is approx 2.5, predicting the voltage by only one and a half samples.</p>
<p>Needless to say, I remain convinced that PHASECAL should be a) matched to the actual phase-shift of the measurement circuitry, and b) kept within the range 0 to 1 :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5859"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 21/08/2012 - 23:32.</div>
    <div class="content">
     <p>Two comments on PHASECAL and integer vs float.</p>
<p>1. Phasecal: If you look at the algorithm carefully and draw pictures, it's clear that the amplitude will be affected. That's why in the explanation in building blocks I wrote &quot;(it also has a small effect on the amplitude, which may need to be corrected).&quot;<br />
As PHASECAL is constant, the amplitude change can easily be calibrated out. What cannot be calibrated out is the effect on harmonics, because a phase shift is equivalent to a time shift at one frequency only.</p>
<p>2. Having the filtered value as a float <em>may</em> be beneficial when very small signals (peak-peak amplitude of just a few counts) are concerned and there is a small amount of noise on the signal that is having the effect of adding dither. In those particular circumstances, it can be shown that accuracy will be improved. However, if those conditions are not met, it's doubtful that there will be a significant difference between using floating point and integer values - except of course in processor load.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5864"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Wed, 22/08/2012 - 07:48.</div>
    <div class="content">
     <pre><a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 21/08/2012 - 14:42:  &quot;2 analog reads&quot;   2 ? ? ?
</pre><p>Typo! Should be delay by 1 analogue read.</p>
<p><a href="../user/924.html" title="View user profile."><em><br />
Robert Wall</em></a><em>: apply the filter to the voltage wave so as to more faithfully preserve the&nbsp; shape of the current waveform.</em>&nbsp;</p>
<p>I agree that would have been my preference to, however the CT&nbsp;clamp has already moved the phase forward on the voltage readings, so its difficult to delay the voltage using hardware, but fairly easy to push the current phase forward to match.&nbsp;</p>
<p>The wave forms are not perfectly in sync, they are delayed by the time it takes the CPU to read the samples, voltage then current.</p>
<p>With regard to the shape of the current curve with switching power supplys - I did try this last night, and see small spikes at the top and bottom of each curve.</p>
<p>Robert, do you think the phase delay/all-pass filter is a route worth taking ?&nbsp; or am I barking up the wrong tree !</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5870"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 22/08/2012 - 13:15.</div>
    <div class="content">
     <p>I think it's a question of balance - one of those engineering questions where you need to make a judgement based on all the information available. Surely an analogue solution to an analogue problem is likely to be 'better', but at what cost? If it means several op-amps which you need power supplies for and components around, it adds complication and cost. If you accept that and you think you need the extra accuracy for your application, that's your decision and it's fine by me. But remember that you have two distinct and different effects present, and so you really ought to use <strong><em>both</em></strong> approaches - the time delay by interpolation to compensate for the time delay between readings, and the phase shift to compensate for the differential phase shift between c.t and p.t.</p>
<p>The Atmel application note that the emonTx/Arduino design seems to be based on had a direct voltage input, with only a c.t. contributing phase shift. Now the c.t's phase shift isn't constant, but varies with current, so it's impossible to correct totally with a fixed time shift. However, for the purpose of that design - a meter demonstration - they concluded that after calibration the inaccuracies would be inside the standards set for a tariff meter.<br />
(So just considering that last point, once you approach the accuracy of your tariff meter, how are you to know whether you are right, or the tariff meter is right, or whether both are wrong, without a yet more accurate standard?).</p>
<p>I'd like to do the full analysis, but I'm afraid I just don't have time at the moment.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5929"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Tue, 28/08/2012 - 08:49.</div>
    <div class="content">
     <p>&nbsp;Analog approach.</p>
<p>Just an off the wall suggestion following Robert's comments on using both an analog and digital approach. If you used an analog multiplier then voltage and power could be sampled which would remove all the problems associated with spikey currents. Robins immersion controller would need the voltage sample to trigger the triac. The multiplier is expensive &pound;6 but it solves so many problems and the circuit is very simple indeed as the multiplier has an offset facillity built in. Phase compensation could be done via some bilateral switches on the voltage feed which would give at least the same or more resolution as the sample rate of current and voltage. If there is any interest I can post a circuit.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5930"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 28/08/2012 - 09:34.</div>
    <div class="content">
     <p>When diverting surplus PV using my Mk2 circuit, very little seems to be of importance.</p>
<p>I currently have two rigs on the go and can switch between them by simply plugging the trigger's control wire into pin 9 of one Arduino or the other.&nbsp;&nbsp; One rig has all the best ideas that I can muster; the other is just the standard setup with the <a href="841.html#comment-5925">cut-down code</a> that I posted yesterday.&nbsp;  In today's sunshine, the performance of these two rigs is virtually identical.</p>
<p>For accurate monitoring of energy flows, I've no doubt that all sorts of details need to be taken into account, including phase effects.&nbsp; But for simply diverting surplus PV, it seems that any setup behaves much the same.&nbsp; The key reason for this is that measurements are only done at one place, and the net flow of current at that point is zero, hence no need for accurate calibration.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5931"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 28/08/2012 - 09:52.</div>
    <div class="content">
     <p>A simple RC filter with variable resistor is enough to compensate phase shifts. It can also help to solve another problem of the original circuit. There is no decent analog filtering implemented yet. This means that when taking digital samples of the original waveform at discrete time intervals of ~400us, you are actually 'undersampling' a waveform with possibly much higher frequency content. There should actually be an integrating analog filter with a similar time constant as the sampling rate to get the 'real' picture.</p>
<p>To give an extreme example of the possible effects of undersampling:</p>
<p>take a 10kHz square-wave signal with 5V amplitude and 50% dutycyle. If you sample this with an adc every ms (1kHz sample rate), you can either get a random (even infinite!) number of 0V readings or 5V readings (or a random mixture of 0's and 1's depending on the exact ratio between original wave frequency and sampling rate). This might never 'average out'! And no digital filter can help to solve this! The only solution is a decent analog filtering.</p>
<p>&nbsp; &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5932"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Tue, 28/08/2012 - 14:07.</div>
    <div class="content">
     <p><a title="View user profile." href="../user/956.html"><em>calypso_rae</em></a><em> on Tue, 28/08/2012 - 09:34. When diverting surplus PV using my Mk2 circuit, very little seems to be of importance.</em></p>
<p>Agreed, the simplicity of your circuit+code is one of its many benefits.</p>
<p>The difficulty starts to creep in if you then try and adapt the circuit to make accurate measurements in an attempt to replace the emonTX along with the solar controller all in one &quot;box&quot;.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5938"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Tue, 28/08/2012 - 18:27.</div>
    <div class="content">
     <p>&nbsp;Technically there should be an antialias filter at lower than half the sample rate.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5939"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Tue, 28/08/2012 - 19:22.</div>
    <div class="content">
     <p><a title="View user profile." href="../user/1149.html"><em>pmcalli</em></a><em> on Tue, 28/08/2012 - 18:27: Technically there should be an antialias filter at lower than half the sample rate.</em></p>
<p>&nbsp;</p>
<p>Is this best done in software or hardware?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5941"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 28/08/2012 - 19:40.</div>
    <div class="content">
     <p>An antialiasing filter can not be done in software! I tried to explain that above with an example about undersampling.</p>
<p>The error that is introduced by undersampling (using a sampling rate that is lower than double the highest frequency in the original waveform) can never be corrected afterwards. Information is lost and cannot be 'reconstructed' again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5942"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 28/08/2012 - 19:57.</div>
    <div class="content">
     <p><a title="View user profile." href="https://openenergymonitor.org/user/1332"><em>JBecker</em></a><em> on Tue, 28/08/2012 - 10:52.&nbsp; This means that when taking digital samples of the original waveform at  discrete time intervals of ~400us, you are actually 'undersampling' a  waveform with possibly much higher frequency content.</em></p>
<p>The mains supply may well contain lots of high-order harmonics, but is it necessary for the power at these extreme frequencies to be measured?&nbsp; With a 50Hz fundamental, and a sampling frequency in excess of 2kHz, a typical monitoring system should already be recording all energy up to the 20th harmonic ;)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5943"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 28/08/2012 - 20:38.</div>
    <div class="content">
     <p>Robin,</p>
<p>this is a good question. And there is the other question about the bandwidth of the CT (the problem with higher frequency content is much more relevant for current than for voltage in our case). I did not find anything in the data sheet.</p>
<p>But the bad thing about not using an antialiasing filter is, that higher frequencies than half the sampling frequency will 'fold back' into the lower frequency band and introduce additional errors there. I have no idea how big these errors are in our specific case.&nbsp;</p>
<p>I just wanted to say that adding an RC for phase correction could have additional benefit (killing two birds with one stone).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5944"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 28/08/2012 - 20:41.</div>
    <div class="content">
     <p>&nbsp;I doubt there is very much harmonic content up there. What there might be is mains-borne signals from baby alarms, network extenders and the like. I have no idea of the signal amplitudes these devices employ, but I suspect they will be in the order of volts (rather than 10s of volts).</p>
<p>Interestingly, there is no mention in Atmel's App. note AVR465 of an anti-aliasing filter, and I suspect they considered it unnecessary given the low amplitudes expected at those frequencies and the limitations of a 10-bit ADC.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5945"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 28/08/2012 - 20:51.</div>
    <div class="content">
     <p>&nbsp;J&ouml;rg,</p>
<p>The c.t. is quite good enough to pass through any trouble - pretty much unhindered!</p>
<p>&quot;5. Frequency Response.<br />
&nbsp;The frequency response was checked at a primary current of 30 A and a burden resistance &nbsp;of 39 Ohms. The phase error remained below 1 degree and amplitude error remained below 1% up to the 13th harmonic of line frequency (650 Hz). At 1.5 kHz the amplitude error remained below 1% whilst the phase error had increased to 5 degrees. At 2.5 kHz &nbsp;the amplitude error had risen to 3% whilst the phase error had increased to 10 degrees. &quot;</p>
<p>It might well need rather more than a first order filter to pass significant harmonics for accurate measurements for the phase-controlled fraternity and yet cut off adequately at 2.5 kHz.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5948"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 28/08/2012 - 22:54.</div>
    <div class="content">
     <p>Robert,</p>
<p>I have seen quite a lot of bullshit on mains current produced by 'cheap and dirty' electronic ballasts (and this time it was not from chinese stuff but from well known european manufacturers!). I don't want to say that this does effect measuring in a normal household very much, most of my (bad) experience comes from emergency lighting systems in big office buildings.</p>
<p>But the lack of nearly any filtering in the AVR465 application note slightly puzzles me. There is the other fact that they do not use any Cs on the analog inputs. This is against any 'good practice' rules for adc inputs. I know quite a lot of controllers where this would give catastrophic results. OK, the AVR adc is very slow, but we have never done a single circuit without a decent RC on the analog AVR inputs.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5951"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 29/08/2012 - 07:37.</div>
    <div class="content">
     <p>Anti alias&nbsp;Is this best done in software or hardware?</p>
<p>&nbsp;</p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; ">The answer is both. Normal approach is to seriously over sample with an easy to implement anti alias filter and then a very sharp digital filter. Most meter chips use delta sigma converters with a simple anti alias then direct multiplication of the current voltage pairs followed by a digital filter. If you want real accuracy these chips are quite inexpensive (&pound;2) for&nbsp;<span class="Apple-style-span" style="font-family: MyriadPro; font-size: 15px; font-weight: bold; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.296875); -webkit-composition-fill-color: rgba(175, 192, 227, 0.230469); -webkit-composition-frame-color: rgba(77, 128, 180, 0.230469); ">ADE7755</span></p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; ">&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5952"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Wed, 29/08/2012 - 07:53.</div>
    <div class="content">
     <p>Last night I swapped over from an OpAmp &quot;phase shifter&quot; to using a RC circuit, works fine.&nbsp; I'm using this in conjunction with the phase calibration in software, which is now in the range of 0.5-0.85.</p>
<p>&nbsp;Using voltage reading circuit from the original Mk2 design by Robin (as below) I'm getting lots of noise on the AC waveform, like the top wave form diagram below - although lots more that a single spike.</p>
<p><img width="400" height="170" src="../../../www.bores.com/courses/intro/basics/gifs/1_anti.gif" alt="" /></p>
<p>This is corrected by putting a 100nF cap between the 15k resistor and ground.&nbsp; I'm assuing that this capacitor is then working as a low pass filter in conjunction with the resistors, and removing the &quot;noise&quot;/high frequency components.</p>
<p><img width="801" height="543" border="1" align="middle" src="../../../s15.postimg.org/wfnhlypl7/robin_mk2_circuit.png" alt="" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5955"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 29/08/2012 - 08:54.</div>
    <div class="content">
     <p>&nbsp;Noise on ac waveform</p>
<p>You may have a problem with the 100nF as it will be across the ref opamp output and they have a habit of oscillating with a capacitor load. Common solution used to soften spikes and pass emc susceptibility is to put a 1nF across the secondary of the transformer</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5956"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Wed, 29/08/2012 - 09:01.</div>
    <div class="content">
     <p><em>Anti alias&nbsp;Is this best done in software or hardware? ... <em>The answer is both.</em></em></p>
<p>Paul, this is not 100% true (only 50% <img src="../sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/regular_smile.html" alt="" />). After sampling, the unwanted higher frequency contents are folded everywhere into the lower frequency band and cannot be removed by any digital filter (because they are undistinguishable from the 'real' signal). The digital filter in the ADE is a low pass filter which removes the unwanted higher frequency components which are there due to the high sampling rate (~1MHz), but it is not an anti-aliasing filter.</p>
<p>Using the AVR we are stuck with rather low sampling rates and here we possibly have to think about real anti-aliasing (which has to be done in hardware).</p>
<p>And we already use 'digital filters' in the software (high-pass for DC-removal, low-pass (in Robins code), integration, averaging..).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5961"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 29/08/2012 - 09:49.</div>
    <div class="content">
     <p>&nbsp;<span class="Apple-style-span" style="border-collapse: collapse; font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.292969); -webkit-composition-fill-color: rgba(175, 192, 227, 0.230469); -webkit-composition-frame-color: rgba(77, 128, 180, 0.230469); -webkit-text-size-adjust: auto; "><em>Anti alias&nbsp;Is this best done in software or hardware? ...&nbsp;<em>The answer is both.</em></em></span></p>
<p>&nbsp;</p>
<p>You should read my post correctly I never called the software post filter an antialias filter it is there to recover the dc component of the power after sampling/multiplying with a correct antialias filter. The real problem here is the sample rate is too low and the a/d type is inappropriate for this type of measurement but that is not to say its not good enough for the purpose intended</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5979"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 29/08/2012 - 18:48.</div>
    <div class="content">
     <p>My 3kW electric kettle and immersion heater each take 12.5A at 240V rms so look much like a 19 Ohm resistors.&nbsp; Our 8kW shower looks much like a 7 Ohm resistor.&nbsp; As the mains waveform gets hammered by non-resistive appliances, I can see how higher harmonics will creep in.&nbsp; Power at these harmonics will presumably be consumed by my resistive loads and should therefore be charged for by the meter.</p>
<p>What I don't understand is how high frequency signals can be usefully carried over the mains.&nbsp; Why aren't they just shorted out by all the resistive loads that are out there?</p>
<p>(sorry, a bit off topic ...)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5980"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Wed, 29/08/2012 - 19:37.</div>
    <div class="content">
     <p>Paul,</p>
<p>I did not want to offend you in any way. I was just reacting to your answer to the original question '<span class="Apple-style-span" style="border-collapse: collapse; font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.292969); -webkit-composition-fill-color: rgba(175, 192, 227, 0.230469); -webkit-composition-frame-color: rgba(77, 128, 180, 0.230469); -webkit-text-size-adjust: auto; ">Anti  alias&nbsp;Is this best done in software or hardware?' And there is only one  correct answer to this: It can not be done in software.</span><em><span class="Apple-style-span" style="border-collapse: collapse; font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.292969); -webkit-composition-fill-color: rgba(175, 192, 227, 0.230469); -webkit-composition-frame-color: rgba(77, 128, 180, 0.230469); -webkit-text-size-adjust: auto; "><br />
</span></em></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5982"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 29/08/2012 - 20:42.</div>
    <div class="content">
     <p>J&ouml;rg,</p>
<p>Your problem with the secondary lighting is the standard defines the harmonic currents in absolute terms per load, not in percentage terms. So if you get very many small loads, the total harmonic current can be much larger than would be permitted for fewer large loads, yet still comply. We have to assume that the standard was written in anticipation of a 'normal' mixed load.<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5984"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 29/08/2012 - 21:57.</div>
    <div class="content">
     <p>&nbsp;Calypso_rae,</p>
<p>Of course the loads on your system affect the transmissions. But you have what is in essence the same arrangement as in any radio receiver, an automatic gain control system that aims to maintain the received carrier at a constant amplitude. Bear in mind also that these are usually fairly narrow-band systems, so benefit from sharply tuned filters - again broadly similar to a radio.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5989"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 30/08/2012 - 10:27.</div>
    <div class="content">
     <p>Robert,</p>
<p>I think the regulation (that more harmonic content is allowed for small loads) makes sense, it keeps the cost down for these small appliances and the idea is, that the noise of many of these small loads will 'average out' to a certain extent. This is statistically correct, but we may still find a lot of high frequency content in out current signal, which makes me believe that a decent low-pass anti-aliasing filter would be a good idea. &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5990"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 30/08/2012 - 10:39.</div>
    <div class="content">
     <p>I think it all depends on how high-frequency signals are treated by supply meters.&nbsp; </p>
<p>If the supply meter measures( and charges for) energy that is consumed at the 39th or 139th harmonic, then so should our own systems.&nbsp; If it doesn't, then neither - I would have thought - should we.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5994"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Thu, 30/08/2012 - 14:09.</div>
    <div class="content">
     <p>&nbsp;<span class="Apple-style-span" style="border-collapse: collapse; font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.292969); -webkit-composition-fill-color: rgba(175, 192, 227, 0.230469); -webkit-composition-frame-color: rgba(77, 128, 180, 0.230469); -webkit-text-size-adjust: auto; ">I think it all depends on how high-frequency signals are treated by supply meters.&nbsp;</span></p>
<p><span class="Apple-style-span" style="border-collapse: collapse; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 11px; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.296875); -webkit-composition-fill-color: rgba(175, 192, 227, 0.230469); -webkit-composition-frame-color: rgba(77, 128, 180, 0.230469); -webkit-text-size-adjust: auto; "></p>
<div class="content" style="line-height: 1.4em; margin-top: 0.5em; margin-right: 0px; margin-bottom: 0.5em; margin-left: 0px; ">
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; ">If the supply meter measures( and charges for) energy that is consumed at the 39th or 139th harmonic, then so should our own systems.&nbsp; If it doesn't, then neither - I would have thought - should we.</p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; ">&nbsp;</p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; ">The problem that may be encountered without an appropriate antialias filter is the high frequency components will be folded (aliased) into a low frequency which you will incorporate and the meter will not.</p>
</div>
<p></span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5996"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: PHASE calculations</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 30/08/2012 - 14:44.</div>
    <div class="content">
     <blockquote><p>&quot;which you will incorporate and the meter will not&quot;</p>
</blockquote>
<p>or possibly vice-versa! &nbsp;The point is, without an anti-aliasing filter, you are dependant on there being no content at a frequency above half your sample rate. If there is content there, you need to know the amplitude and frequency to calculate what effect it will have. Only then can you know whether it is introducing a significant error or not.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/953"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-eaAYjqyJcI0lahZif3seZIPpyEcipCN8vbdnlnqS_uY" value="form-eaAYjqyJcI0lahZif3seZIPpyEcipCN8vbdnlnqS_uY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
