<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3693 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:50:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>gateway forwarder receiving serial data via USB | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">gateway forwarder receiving serial data via USB</h3>
        <span class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Wed, 22/01/2014 - 20:59</span>
        <div class="content"><p>Hi,</p>
<p>I got the EmonTX shield&nbsp;to work with the&nbsp;Aduino, which is now making the data available to the Raspberry via USB (I don&#39;t have the RF&nbsp;add-on board) . Now the next step for me is to get the OEM gateway forwarder installed and working. I saw that there is a description how to configure this for wireless data but is there also a description how to configure the gateway for serial data via USB?</p>
<p>Furthermore, I would like to aggregate and store the data in 15 minute intervals, which is the standard for the energy market metering and settlement in most EU countries. Can this be done and how? I only saw other time intervals, like 10 min and 1 h.</p>
<p>Thanks for your help.</p>
<p>Frank</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3740.html" class="topic-previous" title="Go to previous forum topic">‹ Problem after upgrade to V7</a>
              <a href="3733.html" class="topic-next" title="Go to next forum topic">can EmonCMS  send command back to Gateway ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-17843"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Thu, 23/01/2014 - 08:28.</div>
    <div class="content">
     <p>If the connection is serial over USB, you can use the OEM gateway. Instead of using a OemGatewayRFM2PiListener, you&#39;ll use a OemGatewaySerialListener. The only parameter is the COM port.</p>
<p>Make sure that the TX formats the data like this:</p>
<pre>
NodeID val1 val2
NodeID val1 val2</pre><p>Example for temperature and relative humidity fluctuating around 19&deg;C and 60%:</p>
<pre>
12 19.2 60.1
12 19.5 60.0
12 19.3 60.4</pre><p>(No restriction on number size and decimal part.)</p>
<p>Tell us how it goes.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17847"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 23/01/2014 - 15:49.</div>
    <div class="content">
     <p>nice, I didn&#39;t know OEM gateway could do that. How do you set USB serial baud rate of serial listener. What&#39;s the default? 9600?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17858"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 24/01/2014 - 08:37.</div>
    <div class="content">
     <p>Good point.</p>
<p>Yes, currently it is hardcoded as 9600/</p>
<p>Let&#39;s change this.</p>
<p><a href="https://github.com/Jerome-github/oem_gateway/issues/16" title="https://github.com/Jerome-github/oem_gateway/issues/16">https://github.com/Jerome-github/oem_gateway/issues/16</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17859"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Fri, 24/01/2014 - 09:31.</div>
    <div class="content">
     <p>Thanks, Jerome.</p>
<p>I assume that you are saying that I should make my own build &nbsp;using the code the you have placed on github, rather than using the ready-to-go SD card image (22 oct) available on the emoncms.org website. &nbsp;Could you confirm? Since I have never used Python before and my programming days are 20 years ago this will be a bit new for me&nbsp;.... Or should it also work with the ready-to-go image?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17861"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 24/01/2014 - 10:28.</div>
    <div class="content">
     <p>The ready-to-go SD card contains the same gateway, roughly, perhaps not the exact latest version, but never mind. If you don&#39;t have anything else on your RPi already, you can use the ready-to-go SD Card.</p>
<p>Or you can add the gateway to your existing system. Nothing to build in python, it is script/interpreted just copy and execute. Instead of copying, you&#39;d rather git clone (see help anywhere), so that you can pull later revisions. See gateway readme for installation procedure (file permissions, config file,...).</p>
<p>If the baud rate you use is not 9600, just modify the code to yours and restart the gateway.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17862"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Fri, 24/01/2014 - 10:59.</div>
    <div class="content">
     <p>Ok, sounds good. I shall try both options.&nbsp;</p>
<p>One more question: How do I find out which NodeID&nbsp;I need to choose that I presumably need to include in the Arduino sketch, before the values, according to your post above, and where in the sketch do I include it? The standard arduino&nbsp;sketch does not seem to transfer a node in the way you have explained it above.</p>
<p>Thanks a lot for you help!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17863"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 24/01/2014 - 12:32.</div>
    <div class="content">
     <p>Please point me to the sketch you are referring to.</p>
<p>The node ID is up to you to decide. Just don&#39;t use two nodes with same node ID.</p>
<p>See this page, especially the end: <a href="https://learn.openenergymonitor.org/?redirect=rfm12b2" title="http://openenergymonitor.org/emon/buildingblocks/rfm12b2">http://openenergymonitor.org/emon/buildingblocks/rfm12b2</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17865"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Fri, 24/01/2014 - 12:43.</div>
    <div class="content">
     <p>Hi Jerome,</p>
<p>here is the sketch that I am using:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxShield/Shield_CT1234/Shield_CT1234.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxShield/Shield_CT1234/Shield_CT1234.ino</a></p>
<p>In my uneducated state I am assuming that the data is transferred from Arduino to Pi with the serial.print() method, however, i am not clear how to transfer the&nbsp;nodeID.</p>
<p>thanks again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17867"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 24/01/2014 - 13:44.</div>
    <div class="content">
     <p>OK, now I understand the context.</p>
<p>It&#39;s not as straightforward as I thought but it should be feasible.</p>
<p>The Node ID is 10, which is the default. If you have only one TX, keep it 10.</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxShield/Shield_CT1234/Shield_CT1234.ino#L50" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxShield/Shield_CT1234/Shield_CT1234.ino#L50">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxSh...</a></p>
<p>I didn&#39;t realize you were using the default serial/USB. Well, this may be unclear to you, but I thought you were using a sketch you had modified to send data over serial, not radio.</p>
<p>Currently, in your sketch, the serial link is not really used to transfer data, rather to be used as a debug tool, a logger. But I suppose you can use it like you want with few modifications.</p>
<p>Yes, the instruction is Serial.println(&quot;My string&quot;);</p>
<p>The lines in setup() won&#39;t be understood by the gateway but shouldn&#39;t make it crash. You may leave them.</p>
<p>What you need to do is ensure you write</p>
<p>NodeID val1 val2<br />
	NodeID val1 val2</p>
<p>In loop(), add the following line at the beginning:</p>
<p>Serial.print(nodeID); Serial.print(&quot; &quot;);</p>
<p>Watch the output and modify the code until you get the expected format.</p>
<p>Then you can try the gateway.</p>
<p>BTW, baud rate is 9600, so no need to modify anything.</p>
<p>In the gateway config, you&#39;ll need to enter the serial port path. I don&#39;t know it, and I don&#39;t think it will be the default one. But work on the TX output before, and you&#39;ll see this later.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17877"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Fri, 24/01/2014 - 21:30.</div>
    <div class="content">
     <p>Hi Jerome,</p>
<p>I did the changes to the sketch and checked the output format and it is ok. Unfortunately you are right with you assumption that I also need to change something in the config&nbsp;file. I have a feeling that I need to replace the listener:</p>
<p>Listeners #<br />
	#############<br />
	[listeners]</p>
<p># This listener manages the RFM2Pi module<br />
	[[RFM2Pi]]<br />
	&nbsp;&nbsp;&nbsp; type = OemGatewayRFM2PiListener<br />
	&nbsp;&nbsp;&nbsp; [[[init_settings]]]<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; com_port = /dev/ttyAMA0<br />
	&nbsp;&nbsp;&nbsp; [[[runtime_settings]]]<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sgroup = 210<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; frequency = 8<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; baseid = 15<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sendtimeinterval = 300</p>
<p># This listener gets data from a socket<br />
	[[Socket]]<br />
	&nbsp;&nbsp;&nbsp; type = OemGatewaySocketListener<br />
	&nbsp;&nbsp;&nbsp; [[[init_settings]]]<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; port_nb = 50011<br />
	&nbsp;&nbsp;&nbsp; [[[runtime_settings]]]</p>
<p>&nbsp;</p>
<p>thanks for your help. Otherwise tomorrow I&#39;ll try the code from github.</p>
<p>Regards,</p>
<p>Frank</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17884"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Sat, 25/01/2014 - 15:46.</div>
    <div class="content">
     <p>Here is an update if you are interested.</p>
<p>I updated the conf file, even though this may not be the problem.&nbsp;</p>
<p>The gateway is running the initialization, but then does not get any data from /dev/ttyAMA0. I reckon the problem is that the&nbsp;Arduino/EmonTX shield does not send anything like it does when I connect it to the&nbsp;RPi. However, it always sends ok when I put the other SD card into the RPi.</p>
<p>Could it be that the RPi gateway image does not support USB? How could I add the USB support to the gateway?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17886"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1741.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1741.jpg" alt="ukmoose&#039;s picture" title="ukmoose&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1741.html" title="View user profile.">ukmoose</a> on Sat, 25/01/2014 - 16:41.</div>
    <div class="content">
     <p>/dev/ttyAMA0 is the Pi&#39;s UART serial port not the Pi&#39;s USB port.&nbsp; You will need to change that to point at the USB port</p>
<p>The address of that will change dependant on which USB port you are using.</p>
<p>if you do a ls the dev directory you should be able to determine the right port (/dev/ttyUSB&lt;something&gt;)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17899"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sat, 25/01/2014 - 21:16.</div>
    <div class="content">
     <p>Since there&#39;s only two USB ports on your Pi, it&#39;ll be /dev/ttyUSB0 or /dev/tty/USB1</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 26/01/2014 - 15:52.</div>
    <div class="content">
     <p>Hey Jerome&nbsp;</p>
<p>Great work on the serial gateway. I&#39;ve just set up the oem gateway posting data from an Arduino connected via USB to both local and remote emoncms. The whole thing worked first time without any issues. I will try and do a quick blog post to highlight this functionality of the oem gateway. I&#39;m not sure many people realize it can be used like this. It worked well on conjunction with ino&nbsp;to compile and upload code for the arduino&nbsp;all on the pi</p>
<p><a href="http://openenergymonitor.blogspot.com/2013/12/developing-for-arduino-remotely-on.html">http://openenergymonitor.blogspot.com/2013/12/developing-for-arduino-remotely-on.html&nbsp;</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17911"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Sun, 26/01/2014 - 20:11.</div>
    <div class="content">
     <p>Hi, thanks everyone, I figured it out now. In my case the correct port actually &nbsp;is /dev/ttyACM0. works&nbsp;great, the oemgateway is now getting data from the Shield/Arduino.</p>
<p>However, its not uploading anything to the remote server (emoncms.org) as it should. Here is an excerpt of the log:</p>
<p>&nbsp; &nbsp; 2014-01-26 20:01:30,981 INFO Serial RX: 10 4 263.56 0.36<br />
	&nbsp; &nbsp; 2014-01-26 20:01:30,984 WARNING Misformed RX frame: [&#39;10&#39;, &#39;4&#39;, &#39;263.56&#39;, &#39;0.36&#39;]</p>
<p>Anyone any good ideas? Here is the&nbsp;listener in&nbsp;config file I have created. I left the&nbsp;runtime settings empty as Jerome suggest.</p>
<p>&nbsp;</p>
<p>#############<br />
	# Listeners #<br />
	#############<br />
	[listeners]</p>
<p># This listener manages the serial input<br />
	[[Serial]]<br />
	&nbsp;&nbsp;&nbsp; type = OemGatewaySerialListener<br />
	&nbsp;&nbsp;&nbsp; [[[init_settings]]]<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; com_port = /dev/ttyACM0<br />
	&nbsp;&nbsp;&nbsp; [[[runtime_settings]]]<br />
	&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17912"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Sun, 26/01/2014 - 21:17.</div>
    <div class="content">
     <p>Could it be that the Rock Solid Gateway Forwarder (RSGF)does not activate the USB port on the Pi? It only shows the serial port &nbsp;/dev/ttyAMA0 and it is unable to open that one. Also the LED on the Arduino does not light up when I use the SD card with the RSGF. However, it does when I use the SD card where I have the full environment and the oemgateway code in python from jerome-github. Any help is much appreciated!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17913"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 26/01/2014 - 22:39.</div>
    <div class="content">
     <p>I&#39;ve just done a quick blog post to highlight using the OEM gateway as a serial &gt; emoncms&nbsp;gateway:&nbsp;<a href="http://openenergymonitor.blogspot.co.uk/2014/01/oem-gateway-serial-port-emoncms-link.html">http://openenergymonitor.blogspot.co.uk/2014/01/oem-gateway-serial-port-emoncms-link.html</a></p>
<p>Frank: could you post your entire oemgateway.conf fie so we can check all the emocms&nbsp;setting look OK (remember to strip out your API key!). It sounds like you are nearly there.&nbsp;</p>
<p>I don&#39;t think the RSGF does any sort of disabling of the USB ports&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17917"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 07/03/2014 - 08:45.</div>
    <div class="content">
     <p>Hi guys.</p>
<p>I&#39;m glad this feature proves useful.</p>
<p>Thanks for the highlights, Glyn. I admit my communication is not that good. You first link is wrong (trailing spaces in the URL, or something). In your second link, in the config example (serial -&gt; emoncms), you may remove the socket listener part. It is just an example and not used, so it might be confusing.</p>
<p>I can&#39;t help on the RSGF/USB part. I use Raspbian and added the OEM softwares one by one.</p>
<p>I don&#39;t understand the error message.</p>
<pre>
2014-01-26 20:01:30,984 WARNING Misformed RX frame: [&#39;10&#39;, &#39;4&#39;, &#39;263.56&#39;, &#39;0.36&#39;]</pre><p>This frame seems perfectly well formed to me.</p>
<p>I&#39;ve been a bit dumb when writing the code, as I set several times the same error message. Frank, can you please modify oemgatewaylistener.py to ? Change each &quot;Misformed RX frame&quot; message to something different, like &quot;Misformed RX frame 1&quot;, &quot;Misformed RX frame 2&quot;, etc... So that we know at least where this happens.</p>
<p>Could it be a decimal separator issue ? Maybe the gateway doesn&#39;t understand the dot (.) separator. If the failed test is at line 73, you could add something like this, at least fir the sake of the test:</p>
<p><a href="https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewaylistener.py#L57" title="https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewaylistener.py#L57">https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewayliste...</a></p>
<p># Log data<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.info(&quot;Serial RX: &quot; + f)</p>
<p>
	&nbsp; &nbsp; &nbsp; &nbsp; received.replace(&quot;,&quot;, &quot;.&quot;)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Get an array out of the space separated string<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; received = f.strip().split(&#39; &#39;)</p>
<p>Now, I&#39;m realizing we&#39;ve got a much greater issue. Because I use int(val), all decimal parts are lost. This affects all persons using decimal numbers. Not the ones using the RFM2Pi module (99% of the users). I need to think this through...</p>
<p><a href="https://github.com/Jerome-github/oem_gateway/issues/17" title="https://github.com/Jerome-github/oem_gateway/issues/17">https://github.com/Jerome-github/oem_gateway/issues/17</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17919"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 27/01/2014 - 08:59.</div>
    <div class="content">
     <p>BTW, Glyn if you missed the serial -&gt; emoncms feature, perhaps did you also miss the socket -&gt; emoncms feature.</p>
<p>This allows to communicate with the gateway through a socket. There are examples showing how to do this. The client can be another application on the same host (for instance a software that can manage a specific sensor on the Pi) or on a distant host, provided the communication is routed to the Pi (beware of security issues if open to an external network, there is no password of API key, here).</p>
<p>There is even a listener that listens on a socket and repeats on the RFM2Pi, allowing the gateway to work the other way around, using the radio to command appliances.</p>
<p>Perhaps the config file is not documented enough.</p>
<p>Maybe we should provide a few different config files to chose amongst, instead of relying on the user to do proper modifications. I&#39;m sure most users have the socket listener open but don&#39;t use it. Apparently, it is the default on the ready-to-go SD card:</p>
<p><a href="../sites/default/files/Picture%202.jpg" title="http://openenergymonitor.org/emon/sites/default/files/Picture%202.jpg">http://openenergymonitor.org/emon/sites/default/files/Picture%202.jpg</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17937"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 27/01/2014 - 20:32.</div>
    <div class="content">
     <p>In fact, int() does not remove the decimal pert, if fails with an exception, hence the error message...</p>
<p>Frank, please forget about my gibberish above and pull the latest version of the gateway, where this is hopefully fixed.</p>
<p><a href="https://github.com/Jerome-github/oem_gateway" title="https://github.com/Jerome-github/oem_gateway">https://github.com/Jerome-github/oem_gateway</a></p>
<p>Please tell us how it goes after that.</p>
<p>(So I guess this affected 0% of the users up till now...)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17955"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Tue, 28/01/2014 - 19:47.</div>
    <div class="content">
     <p>Hi Joeroem &amp; Glyn,</p>
<p>thanks for all your advice and sorry for having been offline the last two days.&nbsp;</p>
<p>I have just changed and the &nbsp;.conf file and also used the latest oemgatewaylistener.py. Thanks to Jerome it has no longer issues with decimal data, but it still fails to send.</p>
<p>The .conf looks like this now (do I have to use an API key for the local instance as well?):</p>
<p>&nbsp;</p>
<p># OemGateway Configuration file example<br />
	# Copy this as oemgateway.conf (or any custom name) and edit settings</p>
<p># Each listener and each buffer has<br />
	# - a [[name]]: a unique string<br />
	# - a type: the name of the class it instantiates<br />
	# - a set of init_settings (depends on the type)<br />
	# - a set of runtime_settings (depends on the type)<br />
	# Both init_settings and runtime_settings sections must be defined,<br />
	# even if empty. Init settings are used at initialization, and runtime<br />
	# settings are refreshed on a regular basis.</p>
<p># All lines beginning with a &#39;#&#39; are comments and can be safely removed.</p>
<p>####################<br />
	# Gateway settings #<br />
	####################<br />
	[gateway]<br />
	# loglevel must be one of DEBUG, INFO, WARNING, ERROR, and CRITICAL<br />
	# see here : <a href="http://docs.python.org/2/library/logging.html" title="http://docs.python.org/2/library/logging.html">http://docs.python.org/2/library/logging.html</a><br />
	loglevel = DEBUG</p>
<p>#############<br />
	# Listeners #<br />
	#############<br />
	[listeners]</p>
<p># This listener manages the serial input<br />
	[[Serial]]<br />
	&nbsp;&nbsp;&nbsp; type = OemGatewaySerialListener<br />
	&nbsp;&nbsp;&nbsp; [[[init_settings]]]<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; com_port = /dev/ttyACM0<br />
	&nbsp;&nbsp;&nbsp; [[[runtime_settings]]]</p>
<p></p>
<p>###########<br />
	# Buffers #<br />
	###########<br />
	[buffers]</p>
<p># The two following buffers instantiate the same class,<br />
	# that formats the data for an emoncms instance.<br />
	# One sends the data to a local instance, the other one<br />
	# to a distant one.<br />
	# If active is set to False, the buffer neither records nor sends any data,<br />
	# but it holds unsent data until active becomes True.</p>
<p>[[emoncms_local]]<br />
	&nbsp;&nbsp;&nbsp; type = OemGatewayEmoncmsBuffer<br />
	&nbsp;&nbsp;&nbsp; [[[init_settings]]]<br />
	&nbsp;&nbsp;&nbsp; [[[runtime_settings]]]<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domain = localhost<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; apikey = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protocol = http://<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active = False<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; path = /emoncms</p>
<p>[[emoncms_remote]]<br />
	&nbsp;&nbsp;&nbsp; type = OemGatewayEmoncmsBuffer<br />
	&nbsp;&nbsp;&nbsp; [[[init_settings]]]<br />
	&nbsp;&nbsp;&nbsp; [[[runtime_settings]]]<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; domain = emoncms.org<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; apikey = nobodyneedsttoknow<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protocol = http://<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; active = True<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; path = /emoncms<br />
	&nbsp;</p>
<p>The output says a lot more now (thanks to jerome&#39;s&nbsp;error messaging):</p>
<p>pi@raspberrypi ~/oem_gateway $ chmod +x oemgateway<br />
	pi@raspberrypi ~/oem_gateway $ ./oemgateway<br />
	2014-01-28 19:34:44,450 INFO Logging level set to DEBUG<br />
	2014-01-28 19:34:44,453 INFO Opening gateway...<br />
	2014-01-28 19:34:44,456 INFO Creating buffer emoncms_local<br />
	2014-01-28 19:34:44,460 INFO Creating buffer emoncms_remote<br />
	2014-01-28 19:34:44,471 INFO Creating listener Serial<br />
	2014-01-28 19:34:44,475 DEBUG Opening serial port: /dev/ttyACM0<br />
	2014-01-28 19:34:46,197 INFO Serial RX: 10<br />
	emonTX Shield CT123 Voltage example<br />
	2014-01-28 19:34:46,206 WARNING Misformed RX frame: [&#39;10\nemonTX&#39;, &#39;Shield&#39;, &#39;CT123&#39;, &#39;Voltage&#39;, &#39;example&#39;]<br />
	2014-01-28 19:34:46,421 INFO Serial RX: OpenEnergyMonitor.org<br />
	2014-01-28 19:34:46,435 WARNING Misformed RX frame: [&#39;OpenEnergyMonitor.org&#39;]<br />
	2014-01-28 19:34:46,707 INFO Serial RX: Adjusted by FH to work without RF<br />
	2014-01-28 19:34:46,716 WARNING Misformed RX frame: [&#39;Adjusted&#39;, &#39;by&#39;, &#39;FH&#39;, &#39;to&#39;, &#39;work&#39;, &#39;without&#39;, &#39;RF&#39;]<br />
	2014-01-28 19:34:46,946 INFO Serial RX: 10 23427 428.71 69.23<br />
	2014-01-28 19:34:46,953 DEBUG Node: 10.0<br />
	2014-01-28 19:34:46,956 DEBUG Values: [23427.0, 428.71, 69.23]<br />
	2014-01-28 19:34:46,965 DEBUG Server emoncms.org/emoncms -&gt; buffer data: [10.0, 23427.0, 428.71, 69.23], timestamp: 1390937686.96<br />
	2014-01-28 19:34:46,967 DEBUG Server emoncms.org/emoncms -&gt; send data: [10.0, 23427.0, 428.71, 69.23], timestamp: 1390937686.96<br />
	2014-01-28 19:34:46,970 DEBUG Data string: &amp;time=1390937686.96&amp;node=10.0&amp;json={1:23427.0,2:428.71,3:69.23}<br />
	2014-01-28 19:34:46,974 DEBUG URL string: http://emoncms.org/emoncms/input/post.json?apikey=blackedout&amp;time=1390937686.96&amp;node=10.0&amp;json={1:23427.0,2:428.71,3:69.23}<br />
	2014-01-28 19:34:46,984 INFO Sending to emoncms.org/emoncms<br />
	2014-01-28 19:34:47,701 WARNING Send failure<br />
	2014-01-28 19:34:47,935 DEBUG Server emoncms.org/emoncms -&gt; send data: [10.0, 23427.0, 428.71, 69.23], timestamp: 1390937686.96<br />
	2014-01-28 19:34:47,938 DEBUG Data string: &amp;time=1390937686.96&amp;node=10.0&amp;json={1:23427.0,2:428.71,3:69.23}<br />
	2014-01-28 19:34:47,942 DEBUG URL string:&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17956"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 28/01/2014 - 19:51.</div>
    <div class="content">
     <p>Set active to True to send to local.</p>
<pre>
[[emoncms_local]]
    type = OemGatewayEmoncmsBuffer
    [[[init_settings]]]
    [[[runtime_settings]]]
        domain = localhost
        apikey = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
        protocol = http://
        <strong>active = False</strong>
        path = /emoncms

[[emoncms_remote]]
    type = OemGatewayEmoncmsBuffer
    [[[init_settings]]]
    [[[runtime_settings]]]
        domain = emoncms.org
        apikey = nobodyneedsttoknow
        protocol = http://
        active = True
        path = /emoncms</pre><p>I deactivate by default since many people don&#39;t use local instance.</p>
<p>We should either provide config examples or strss out the fact that the example is just... an example and each parameter should be reviewed.</p>
<p>I&#39;m glad the &quot;decimal numbers fix&quot; worked.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17957"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Tue, 28/01/2014 - 20:11.</div>
    <div class="content">
     <p>Hi Jerome,</p>
<p>I just did the change, however it neither seesm to be successful in seding to local nor to remote. Also I noticed&nbsp;that my voltage value has now increased by roughly factor 1.5??</p>
<p>The node is now a float as well instead of an int, is that&nbsp;ok?</p>
<p>Thanks.</p>
<p>2014-01-28 20:04:33,984 DEBUG Values: [23964.0, 435.68, 69.02]<br />
	2014-01-28 20:04:33,986 DEBUG Server localhost/emoncms -&gt; buffer data: [10.0, 23964.0, 435.68, 69.02], timestamp: 1390939473.99<br />
	2014-01-28 20:04:33,993 DEBUG Server emoncms.org/emoncms -&gt; buffer data: [10.0, 23964.0, 435.68, 69.02], timestamp: 1390939473.99<br />
	2014-01-28 20:04:33,995 DEBUG Server localhost/emoncms -&gt; send data: [10.0, 23964.0, 435.68, 69.02], timestamp: 1390939473.99<br />
	2014-01-28 20:04:34,004 DEBUG Data string: &amp;time=1390939473.99&amp;node=10.0&amp;json={1:23964.0,2:435.68,3:69.02}<br />
	2014-01-28 20:04:34,007 DEBUG URL string: http://localhost/emoncms/input/post.json?apikey=&amp;time=1390939473.99&amp;node=10.0&amp;json={1:23964.0,2:435.68,3:69.02}<br />
	2014-01-28 20:04:34,024 INFO Sending to localhost/emoncms<br />
	2014-01-28 20:04:34,211 WARNING Couldn&#39;t send to server, URLError: [Errno 97] Address family not supported by protocol<br />
	2014-01-28 20:04:34,215 DEBUG Server emoncms.org/emoncms -&gt; send data: [10.0, 23964.0, 435.68, 69.02], timestamp: 1390939473.99<br />
	2014-01-28 20:04:34,232 DEBUG Data string: &amp;time=1390939473.99&amp;node=10.0&amp;json={1:23964.0,2:435.68,3:69.02}<br />
	2014-01-28 20:04:34,234 DEBUG URL string: http://emoncms.org/emoncms/input/post.json?apikey=blackedoutf&amp;time=1390939473.99&amp;node=10.0&amp;json={1:23964.0,2:435.68,3:69.02}<br />
	2014-01-28 20:04:34,253 INFO Sending to emoncms.org/emoncms<br />
	2014-01-28 20:04:34,628 WARNING Send failure</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17958"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 28/01/2014 - 20:26.</div>
    <div class="content">
     <p>Node being float is not elegant, I may change this. But it works for me here.</p>
<p>(You can check this kind of things by logging in your emoncms instance and entering the URL in your browser.)</p>
<p>I don&#39;t know about the voltage.</p>
<p>I don&#39;t know about the failures as well. What if you enter the same URL from your browser ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17959"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Tue, 28/01/2014 - 20:27.</div>
    <div class="content">
     <p>Hi Guys,</p>
<p>i just figured it out. It was just the wrong&nbsp;path (/emoncms) in the .conf file. Now the remote send works!!! excellent, thanks for the help.</p>
<p>the local data still has issues (error 97: Address family not supported by protocol.) what do I need to do there?</p>
<p>&nbsp;</p>
<p>2014-01-28 20:20:31,869 INFO Sending to emoncms.org<br />
	2014-01-28 20:20:32,181 DEBUG Send ok<br />
	2014-01-28 20:20:32,456 DEBUG Server localhost -&gt; send data: [10.0, 23350.0, 428.76, 69.1], timestamp: 1390940431.64<br />
	2014-01-28 20:20:32,464 DEBUG Data string: &amp;time=1390940431.64&amp;node=10.0&amp;json={1:23350.0,2:428.76,3:69.1}<br />
	2014-01-28 20:20:32,467 DEBUG URL string: http://localhost/input/post.json?apikey=&amp;time=1390940431.64&amp;node=10.0&amp;json={1:23350.0,2:428.76,3:69.1}<br />
	2014-01-28 20:20:32,473 INFO Sending to localhost<br />
	2014-01-28 20:20:32,593 WARNING Couldn&#39;t send to server, URLError: [Errno 97] Address family not supported by protocol</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17961"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 28/01/2014 - 21:50.</div>
    <div class="content">
     <p>Great! Thanks for helping debug this Jerome.</p>
<p>No, I was aware of the serial listener. That&#39;s pretty cool. How would this work in practice? Say for incidence I would like to send a data packet to a node. I know how to do this in minicom communicating directly with the RF12Pi, how would I do this remotely&nbsp;using the oem gateway?</p>
<p>I&#39;ve also seen in some of the gateway code that there is an emoncms gui, how does this work? Does this use the same GUI that is already there under the raspberry Pi tab in emoncms? It might be good to use the on the rock solid serial gateway instead of the .conf file although I guess the file system would first need to be put into R/W mode in order to save the chance.&nbsp;</p>
<p>It&#39;s fantastic the work you are doing developing the gateway, its maturing into a very tidy bit of python :-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17973"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Wed, 29/01/2014 - 08:22.</div>
    <div class="content">
     <p>Hi Frank.</p>
<pre>
2014-01-28 20:20:32,593 WARNING Couldn&#39;t send to server, URLError: [Errno 97] Address family not supported by protocol</pre><p>Never seen this, but I suspect the message is misleading.</p>
<p>Can you access your local instance from a browser on the Pi ? If you don&#39;t have a graphical session but only SSh access, you can try links/www-browser.</p>
<p>Did your enter your local API key ? I can&#39;t tell if you removed it from the log. I&#39;m not 100% sure it is necessary when sending locally, I don&#39;t remember, but it&#39;d be worth a try.</p>
<p>(Note that you don&#39;t have to reload the gateway when changing settings.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17974"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Wed, 29/01/2014 - 08:38.</div>
    <div class="content">
     <p>Hi Glyn.</p>
<p>See the examples directory for a sample python code. Basically, chose a port number in the gateway config. Then, in the sample code, use the same port. And There you go. I tested this by sending the commands to change group/freq/nodeID and it worked.</p>
<p>If your use case is to send a packet depending on the output of another program, you can modify the program to write to the socket just like in the example. It is in python, but it shouldn&#39;t be more complicated in C, for instance. Most languages have libraries for this.</p>
<p>There is also a listener to get samples through a port. For instance if you have an application that manages a sensor.</p>
<p>You can open to the outside world if your router is configured so, but there is no auth, so anyone can send anything.</p>
<p>I designed the gateway starting from the raspberrypi module. The GUI is just the same. emoncms GUI writes parameters in DB and those are read by the gateway through the emoncms API (the gateway itself does not have acccess to the DB). The good point is the GUI. It is also its limitation : only parameters accessible from the GUI are usable. Currently, there is no way to use both in the same time. Besides, it is not really suited for the rock-solid since it needs the full emoncms stack with DB and all. And I like the text file, although threads like this one suggest that it can be confusing to new users.</p>
<p>I was thinking of dropping this feature, as I don&#39;t think it is used, and it is limiting, as compared to the text file.</p>
<p>I tried to design the gateway to be as generic and extensible as possible. Unfortunately, it makes the code more complicated than it could be. Perhaps some features are not used because scarce people know about them...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17978"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 29/01/2014 - 14:33.</div>
    <div class="content">
     <p>Nice I understand, just had a look at examples. Seems pretty straightforward. I agree, I like the text file config, it&#39;s simple and works. Maybe closer integration is needed for the emoncms GUI to work well, best talk to Trystan&nbsp;about that.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17983"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Wed, 29/01/2014 - 20:27.</div>
    <div class="content">
     <p>Hi Jerome,</p>
<p>how do l obtain a Local Api key? Do l need to install emon CMS?</p>
<p>Frank</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17984"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1741.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1741.jpg" alt="ukmoose&#039;s picture" title="ukmoose&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1741.html" title="View user profile.">ukmoose</a> on Wed, 29/01/2014 - 20:46.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Franknfurther,</p>
<p>Yes the script is designed to write data into an emoncms&nbsp;database.<br />
	Therefore if you want to store the data locally using this script you will need to install emoncms.&nbsp;</p>
<p>Once you have installed emoncms you can get the API key in the same way as you did for the emoncms.org (it will be a different number)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17993"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 07/03/2014 - 08:44.</div>
    <div class="content">
     <p>Frank, AFAIK, there are two flavors of ready-to-go card. This is because SD cards wear of if written intensely.</p>
<p>One is used read-only and does not contain emonCMS. It is meant to be used s a repeater.</p>
<p>The other one has emoncms and should be used with an external hard-drive.</p>
<p>If you chose the first, it might not be a great idea to install emonCMS on the SD card.</p>
<p>(I leave this for the others to explain, I run my own Raspbian + emonCMS and have never used ready-to-go SD cards. Perhaps should we find them great nicknames to clarify the ambiguity).</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18010"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Thu, 30/01/2014 - 20:11.</div>
    <div class="content">
     <p>Hi guys, that makes sense, I get it. I am still on a steep learning&nbsp;curve here.&nbsp;</p>
<p>I kind of mistakenly thought that the data could be buffered locally short-term (i the RAM) without having to install emoncms. Wishful thinking on my side.</p>
<p>Thanks for your help!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18012"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5146.jpg" alt="franknfurther&#039;s picture" title="franknfurther&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/5146.html" title="View user profile.">franknfurther</a> on Thu, 30/01/2014 - 20:24.</div>
    <div class="content">
     <p>Glyn, do you have any idea&nbsp;why the rock-solid, ready to go SD card does not activate the Arduino? The Rasbian version works fine and the Arduino starts sending. Could it be that the serial port needs to be opened manually?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18039"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: gateway forwarder receiving serial data via USB</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 31/01/2014 - 08:41.</div>
    <div class="content">
     <p>The data is buffered short-term in RAM already.</p>
<p><a href="https://github.com/Jerome-github/oem_gateway/issues/6" title="https://github.com/Jerome-github/oem_gateway/issues/6">https://github.com/Jerome-github/oem_gateway/issues/6</a></p>
<p>The 1000 here</p>
<p><a href="https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewaybuffer.py#L101" title="https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewaybuffer.py#L101">https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewaybuffe...</a></p>
<p>is an arbitrarily hardcoded (and possibly very conservative) value. You can increase it.</p>
<p>Say you expect data strings of length 20 characters (Node + a few vals). Assume 8 bits per character (could be wrong). That is 20 bytes per strings. Current max of 1 000 would be 20 ok. Then 1 000 000 would mean 20 Mo, still safe.</p>
<p>I haven&#39;t been investigating this. Any feedback welcome.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3693"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-nNSqMstMiLD2R8jS9RAsAyBhWifZcK8tXA8GPf4zC_k" value="form-nNSqMstMiLD2R8jS9RAsAyBhWifZcK8tXA8GPf4zC_k"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/3693 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:51:05 GMT -->
</html>
