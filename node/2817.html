<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2817 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:05:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonTX and RFData | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonTX and RFData</h3>
        <span class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Thu, 12/09/2013 - 13:01</span>
        <div class="content"><p>Hry Guys,</p>
<p>&nbsp;</p>
<p>I have setup and configured my emonTX, emonGLCD, and emonCMS.</p>
<p>Currently the the emonTX only sends the following payload &nbsp;{power1, power2, power3, Vrms; }</p>
<p>I want to also be able to read the power factor and any other valuable data,&nbsp;</p>
<p>I am using hte emonTx_CT123_Voltage and can not see where it&#39;s getting the Pf from.&nbsp;</p>
<p>&nbsp;</p>
<p>Also I want to understand how do I calibrate the unit to get the best result..... this link in the sketch is not valid.</p>
<p><a href="../modules/emontx/firmware/calibration.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware/calibration">http://openenergymonitor.org/emon/modules/emontx/firmware/calibration</a></p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2813.html" class="topic-previous" title="Go to previous forum topic">‹ DC current monitoring - help needed</a>
              <a href="2815.html" class="topic-next" title="Go to next forum topic">emonTX / RX consistancy of data sends ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-15109"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX and RFData</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 12/09/2013 - 13:34.</div>
    <div class="content">
     <p><em>&quot;how do I calibrate the unit to get the best result..... this link in the sketch is not valid.&quot;</em></p>
<p>Really?&nbsp; The one you posted above works for me. I&#39;ve recently sent Trystan a (hopefully) improved and enlarged version so that should appear soon.</p>
<p>Power factor is calculated in emonLib right at the end of EnergyMonitor::calcVI( ).&nbsp; It&#39;s public, so you can pick it up as ct1.powerFactor and put it into your payload (make sure all 3 ends use the same payload struct!).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15111"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4277.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4277.jpg" alt="warlock&#039;s picture" title="warlock&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX and RFData</h3>

    <div class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Thu, 12/09/2013 - 14:01.</div>
    <div class="content">
     <p>Thanks Robert,</p>
<p>Really strange I tried that link last night and again before I posted and it was not working, Just checked it now and seem to be fine.&nbsp;</p>
<p>&nbsp;</p>
<p>As for the Power factor thank you for the information, I&#39; give it a ago.</p>
<p>&nbsp;</p>
<p>I just have to say, before I bought into the emon&nbsp;devices I was using TheOwl and also tried the eFergy and found them to limiting, After uploading the&nbsp;sketches last night I am very happy to report it was definitely the correct way to go.</p>
<p>Once I have the emonTX correctly configured and emonCMS&nbsp;setup, I&#39;ll be looking a controlling the solar pump for my solar water collector. The beauty about this system is that it&#39;s virtually limit less and not locked down to the vendors code... If I don;t like something I just change it.</p>
<p>Last one, does anyone use anything special to design their icons for the LCD, like an app or something ?</p>
<p>thanks again</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15122"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4277.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4277.jpg" alt="warlock&#039;s picture" title="warlock&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX and RFData</h3>

    <div class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Thu, 12/09/2013 - 22:07.</div>
    <div class="content">
     <p>ok I manager to get the powerFactor displayed in the Serial Console by doing the following in the emonTX sketch</p>
<p><strong><em>emontx.powerFactor = ct1.powerFactor;</em></strong></p>
<p><strong><em>Serial.print(&quot; &quot;); Serial.print(ct1.powerFactor);</em></strong></p>
<p>I have also added the poer factor to the TX payload</p>
<p><strong><em>typedef struct { int power1, power2, power3, Vrms, powerFactor; } PayloadTX;</em></strong></p>
<p>and in the emonGLCD&nbsp;I have added the same struct</p>
<p><strong><em>typedef struct { int power1, power2, power3, Vrms, powerFactor; } PayloadTX;</em></strong></p>
<p><strong><em>emonGLCD variables</em></strong></p>
<p><strong><em>double usekwh = 0, genkwh = 0, Volts = 0, Pf = 0;</em></strong></p>
<p><strong>Pf = 0;<br />
	Pf += (emontx.powerFactor);</strong></p>
<p><strong>else if (page==4)</strong></p>
<p><strong>{</strong></p>
<p><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; draw_voltage_page(&quot;VOLTAGE :&quot; , Volts, &quot;Pf&quot;, Pf);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; draw_temperature_time_footer(temp, mintemp, maxtemp, hour,minute);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; glcd.refresh();<br />
	&nbsp;&nbsp;&nbsp; }</strong></p>
<p><em><strong>//------------------------------------------------------------------</strong></em></p>
<p><em><strong>// Draws a page showing Voltage and Pokwer Factor Single value in big font<br />
	//------------------------------------------------------------------<br />
	void draw_voltage_page(char* powerstr, double powerval, char* energystr,&nbsp; double energyval)<br />
	{<br />
	&nbsp; glcd.clear();<br />
	&nbsp; glcd.fillRect(0,0,128,64,0);<br />
	&nbsp;<br />
	&nbsp; char str[50];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //variable to store conversion<br />
	&nbsp; glcd.setFont(font_clR6x8);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; strcpy(str,powerstr);&nbsp;<br />
	&nbsp; strcat(str,&quot;&quot;);<br />
	&nbsp; glcd.drawString(0,0,str);<br />
	&nbsp; strcpy(str,energystr);&nbsp;<br />
	&nbsp; strcat(str,&quot;&quot;);<br />
	&nbsp; glcd.drawString(0,38,str);</strong></em></p>
<p><em><strong>&nbsp; // volts value<br />
	&nbsp; glcd.setFont(font_helvB24);<br />
	&nbsp; itoa((int)powerval,str,10);<br />
	&nbsp; strcat(str,&quot;v&quot;);&nbsp;&nbsp;<br />
	&nbsp; glcd.drawString(3,9,str);<br />
	&nbsp;<br />
	&nbsp; // Power Factor<br />
	&nbsp; glcd.setFont(font_clR6x8);<br />
	&nbsp;&nbsp;&nbsp;dtostrf(energyval,0,2,str);&nbsp;<br />
	&nbsp; strcat(str,&quot;&quot;);<br />
	&nbsp; glcd.drawString(20,38,str);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	}</strong></em><br />
	&nbsp;</p>
<p>The voltage shows fine but I can&#39;t get the power factor to show up ? Am I missing something</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15123"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX and RFData</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 12/09/2013 - 22:32.</div>
    <div class="content">
     <p>Yes, you&#39;ve declared powerFactor as an integer inside the struct - it needed to be a float or a double. The value can never exceed 1, and as it gets truncated by the integer conversion, you always get zero. But as you might be using the same struct to pass the data to emoncms (which can only accept integers), you need to leave it as an integer and you must multiply the value by 100 or 1000 as you load it into the struct (thereby giving you two or three significant figures), and divide back down again it prior to displaying in both the GLCD and in emoncms (do the maths there on the Feeds page).</p>
<p>I&#39;m not sure about the lines</p>
<p class="rteindent1">Pf = 0;<br />
	Pf += (emontx.powerFactor);</p>
<p>those seem totally wrong and as memory in the GLCD is tight, it might in any case be better to not use Pf, save a variable and write</p>
<p class="rteindent1">else if (page==4)<br />
	{<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; draw_voltage_page(&quot;VOLTAGE :&quot; , Volts, &quot;Pf&quot;, emontx.powerFactor/100.0);</p>
<p class="rteindent1">[... etc]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15124"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4277.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4277.jpg" alt="warlock&#039;s picture" title="warlock&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX and RFData</h3>

    <div class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Thu, 12/09/2013 - 22:46.</div>
    <div class="content">
     <p>Awesome thanks Robert, I&#39;ll give that a go</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15125"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX and RFData</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 12/09/2013 - 22:48.</div>
    <div class="content">
     <p>Oops - I&#39;ve just edited it a bit! - I&#39;d forgotten you were using it to send to emoncms as well.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2817"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ZSHbksNzAvUgdKz1XbW5UZpfZeO1ynGjSbTrUjxMdRI" value="form-ZSHbksNzAvUgdKz1XbW5UZpfZeO1ynGjSbTrUjxMdRI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
