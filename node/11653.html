<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11653 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:56:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Calibration without reuploading sketch | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Calibration without reuploading sketch</h3>
        <span class="submitted">Submitted by <a href="../user/9039.html" title="View user profile.">danibilabibah</a> on Mon, 23/11/2015 - 16:43</span>
        <div class="content"><p>Im try to make an electrical monitoring unit, im using arduino and emonlib, in calibrating it should reupload the sketch with new value of calibration. any other way to put a calibration value instead of reuploading the sketch? with serial command maybe? or with potentiometer?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11856.html" class="topic-previous" title="Go to previous forum topic">‹ emonTxV3</a>
              <a href="11884.html" class="topic-next" title="Go to next forum topic">Importing data from existing energy counter ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-36260"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration without reuploading sketch</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 23/11/2015 - 17:35.</div>
    <div class="content">
     <p>It would be possible to write new calibration values via a serial command, but to the best of my knowledge, no sketch exists that has that capability. </p>
<p>The normal and most convenient way is to edit the sketch with the new calibration constants and upload it - that is unless you are using emonCMS, when it is possible to calibrate the power there.</p>
<p>It would also be possible to use potentiometers to tap off a variable voltage from the voltage transformer and the current transformer, but I do not recommend that as the calibration can easily be altered by mistake, and you cannot calibrate the phase correction with a potentiometer.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36262"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration without reuploading sketch</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 23/11/2015 - 18:01.</div>
    <div class="content">
     <p>As Robert has said, can&#39;t you calibrate by using the various processes in emoncms?</p>
<p>For example, despite calibrating my emontx, I still found that it still did not match my utility meter, so I multiplied&nbsp;the input by a calibration amount before logging it to a feed. Now it&#39;s still not quite perfect - but not that far away either! Certainly close enough for me.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37514"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9039.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="danibilabibah&#039;s picture" title="danibilabibah&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration without reuploading sketch</h3>

    <div class="submitted">Submitted by <a href="../user/9039.html" title="View user profile.">danibilabibah</a> on Sat, 26/12/2015 - 16:49.</div>
    <div class="content">
     <p>sory, Ive been busy lately,... for this coding :&#39;)</p>
<p>this what I have do to solve my problem:</p>
<p>#include &quot;EmonLib.h&quot;<br />
EnergyMonitor emon1;<br />
unsigned long calibI = 111.1;<br />
unsigned long newCalibI;</p>
<p>void setup() {<br />
&nbsp; Serial.begin(9600);<br />
&nbsp; emon1.current(1, calibI);<br />
&nbsp; double Irms = emon1.calcIrms(1480);<br />
&nbsp; Serial.println(&quot;Berapa arus terukur sekarang?&quot;);&nbsp;&nbsp; //how electrical current measured now?<br />
&nbsp; Serial.print(&quot;Arus terukur oleh emonLib adalah: &quot;); //Current measured by emonlib is:<br />
&nbsp; Serial.println(Irms);<br />
&nbsp; while (Serial.available() == 0) {<br />
&nbsp; }<br />
&nbsp; unsigned long baca = (Serial.parseInt());</p>
<p>&nbsp; newCalibI = calibI * (baca / Irms);<br />
&nbsp; calibI = newCalibI;<br />
&nbsp; emon1.current(1, calibI);<br />
}</p>
<p>void loop() {<br />
&nbsp; double Irms = emon1.calcIrms(1480);</p>
<p>&nbsp; Serial.print(Irms * 230.0);<br />
&nbsp; Serial.print(&quot;&nbsp;&nbsp; &quot;);<br />
&nbsp; Serial.println(Irms);<br />
&nbsp; delay(1000);<br />
}</p>
<p>&quot;omg, how to post a code block?</p>
<p>your calibration value will be requested at first start, after you inputed the calibration value, calculation process will be running at loop function with new calibration value. and it will be back to old value after restart, you can write the value to eeprom if you want</p>
<p>This is not the final code that I use, I have changed emonlib fit my needs, so that the sensor can be viewed online, via icinga.<br />
hopefully the above code can be a little help to anyone who needs</p>
<p>&quot;sory for the indonesian serial output :P</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37517"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration without reuploading sketch</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 26/12/2015 - 17:20.</div>
    <div class="content">
     <p>You should look at using the EEPROM to store your calibration values, because, as you say, when you remove power, calibration will revert to the values in the sketch. This of course is the reason that we always change the calibration constants in the sketch and then reload it. It cannot be changed by accident.</p>
<p>If you have (say) 4 channels of current, a voltage and phase error correction because you are measuring real power, you solution becomes somewhat harder to implement.</p>
<p>Also, can you explain why you are assigning a decimal value to an integer in "unsigned long calibI = 111.1;".  This is surely not good practice, even if you intend the calibration constant to be an integer.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37579"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9039.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="danibilabibah&#039;s picture" title="danibilabibah&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration without reuploading sketch</h3>

    <div class="submitted">Submitted by <a href="../user/9039.html" title="View user profile.">danibilabibah</a> on Mon, 28/12/2015 - 05:41.</div>
    <div class="content">
     <blockquote><p>You should look at using the EEPROM to store your calibration values, because, as you say, when you remove power, calibration will revert to the values in the sketch. This of course is the reason that we always change the calibration constants in the sketch and then reload it. It cannot be changed by accident.</p>
</blockquote>
<p>did I missed something to inform you about writing to eeprom? I thought I has inform it at the last line :P</p>
<blockquote><p>If you have (say) 4 channels of current, a voltage and phase error correction because you are measuring real power, you solution becomes somewhat harder to implement.</p>
</blockquote>
<p>actually, at my last sketch I using 3 voltage sensor and 16x3 current sensor (I using 3 analog mux), and I just need to measuring Vrms and Irms, yet at my last sketch it still need to calibrating especially for phasecal. any suggestion for it?</p>
<blockquote><p>Also, can you explain why you are assigning a decimal value to an integer in &quot;unsigned long calibI = 111.1;&quot;. This is surely not good practice, even if you intend the calibration constant to be an integer.</p>
</blockquote>
<p>any better solution about this? at the sample and the emonlib.c the current calibration constant assigned as &quot;double&quot;, maybe this is what you mean?. yes, it is my fault, sorry, and thanks for correction.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37586"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration without reuploading sketch</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 28/12/2015 - 12:52.</div>
    <div class="content">
     <p>You did indeed mention that EEPROM could be used, but I mentioned it again in case someone with less knowledge reads this thread at some time in the future and does not understand that without using EEPROM, the unit must be calibrated each time it is powered up.</p>
<p>To fully calibrate each channel using serial input from the keyboard, you need to input 3 values: voltage calibration (which will be the same for each channel), current calibration and phase calibration. The only realistic way to get phase calibration correct is with an iterative process where either you enter a test values and observe the result, or it steps through values and you choose the best one based on the result (in this case power factor). You must repeat the current and phase calibration procedure for each channel.</p>
<p>Yes, I did mean that you should be using a float or a double for both the initial calibration constant and the value that the user enters.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11653"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-W91mqNGub1DT44C4oBtnl7K23-xkXpBIWhl23EIXZqg" value="form-W91mqNGub1DT44C4oBtnl7K23-xkXpBIWhl23EIXZqg"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/11653 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:56:09 GMT -->
</html>
