<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11899 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:49:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Send Decimals with RFM | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Send Decimals with RFM</h3>
        <span class="submitted">Submitted by <a href="../user/9046.html" title="View user profile.">Bart</a> on Wed, 30/12/2015 - 10:31</span>
        <div class="content"><p>Hi all,</p>
<p>I&#39;m using the 3&nbsp;phase sketch on Emontx v3.4&nbsp;and I&#39;m interested in exact values (2 decimals) of the Power factor&nbsp;and exact values of the current (1 decimal).</p>
<p>The serial print shows the right decimals but de RF module sends only integers. I can send the data by multiplying the data by 10 or 100 to get a higher accuracy, but that has to be post processed. So not preferable.&nbsp;</p>
<p>Is there a way to include decimals in the data package of rfm?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11897.html" class="topic-previous" title="Go to previous forum topic">‹ Errors after update from pi to pi2</a>
              <a href="11894.html" class="topic-next" title="Go to next forum topic">Emonbase passwords ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-37668"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send Decimals with RFM</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Wed, 30/12/2015 - 10:46.</div>
    <div class="content">
     <p>In the payload structure, try to&nbsp;change the type from &quot;int&quot; to &quot;float&quot;.</p>
<p>I have some values set up this way, and they work. You probably need to edit your emonhub&nbsp;config also.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37669"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send Decimals with RFM</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/12/2015 - 11:33.</div>
    <div class="content">
     <p>You can use floats rather than ints in your payload structure as Biere&nbsp;suggests or scale as you have already mentioned, either will require &quot;post-processing&quot; the difference being firstly the size,&nbsp;range and accuracy of the value, a float is 4 bytes and&nbsp;has a massive range but it&#39;s accuracy is questionable (not likely to be a problem here), a scaled signed int still only uses 2 bytes (so halve the size) with a range of -32767 to 32768 before scaling (so -327.67 to 327.68 at 2 digits of&nbsp;precision) with no question over&nbsp;accuracy.</p>
<p>Using scaling has the added advantage of being transmitted and passed to emoncms with no additional processing until it arrives in enmoncms, where as using the datacodes and/or scaling in emonhub means the real values are available sooner before posting to emoncms or elsewhere&nbsp;.</p>
<p>It was for this reason emonhub&nbsp;has the ability to scale and use other data types, previously the stream of bytes was always post-processed&nbsp;from&nbsp;2byte&nbsp;pairs as unsigned&nbsp;ints without any variation, now the default use of integers is just a backward compatibility&nbsp;legacy.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37671"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9046.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bart&#039;s picture" title="Bart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send Decimals with RFM</h3>

    <div class="submitted">Submitted by <a href="../user/9046.html" title="View user profile.">Bart</a> on Wed, 30/12/2015 - 13:02.</div>
    <div class="content">
     <p>Both thanks!</p>
<p>I have multiplied the values in my sketch and scaled it&nbsp;emoncms.</p>
<p>It seemed to me cumbersome, but in the case of the maximum number of&nbsp;bytes it is better to use scales. I use for ct1-4&nbsp;the power, apparentPower, powerFactor and the current, so it must be 2 bytes otherwise the maximum package of the RFM will be exceeded.</p>
<p>Sketch adjustment:</p>
<blockquote><p>&nbsp; emontx.Irms1 = Irms1 * 10;<br />
&nbsp; emontx.Irms2 = Irms2 * 10;<br />
&nbsp; emontx.Irms3 = Irms3 * 10;<br />
&nbsp; emontx.Irms4 = Irms4 * 10;<br />
&nbsp; emontx.powerFactor1 = powerFactor1 * 100;<br />
&nbsp; emontx.powerFactor2 = powerFactor2 * 100;<br />
&nbsp; emontx.powerFactor3 = powerFactor3 * 100;<br />
&nbsp; emontx.powerFactor4 = powerFactor4 * 100;</p>
</blockquote>
<p>Emonhub.conf node decoder:</p>
<blockquote><p>[[11]]<br />
nodename = emonTx_three_phase<br />
firmware =three_phase<br />
hardware = emonTx_(NodeID_DIP_Switch1:OFF)<br />
[[[rx]]]<br />
names = power1, apparentPower1, powerFactor1, Irms1, power2, apparentPower2, powerFactor2, Irms2, power3, apparentPower3, powerFactor3, Irms3, power4, apparentPower4, powerFactor4, Irms4, Vrms<br />
datacode = h<br />
scales = 1,1,0.01,0.1,1,1,0.01,0.1,1,1,0.01,0.1,1,1,0.01,0.1,1<br />
units =W,W,PF,A,W,W,PF,A,W,W,PF,A,W,W,PF,A,V</p>
</blockquote>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37672"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send Decimals with RFM</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/12/2015 - 14:01.</div>
    <div class="content">
     <p>Shouldn&#39;t&nbsp;Vrms&nbsp;be scaled by 0.01 in emonhub.conf too? otherwise the units should be mV or does your sketch only report whole Volts?</p>
<p>As a side note, if payload size is a concern, and the power factor is always within the -1,27&nbsp;to 1.28 or the&nbsp;0 to 2.55 ranges (I know it should be, but do not know the extremes the sketch could report)&nbsp;you could use a single signed or unsigned byte/char (b or B) saving an additional 4 bytes of payload.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37673"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9046.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bart&#039;s picture" title="Bart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send Decimals with RFM</h3>

    <div class="submitted">Submitted by <a href="../user/9046.html" title="View user profile.">Bart</a> on Wed, 30/12/2015 - 14:43.</div>
    <div class="content">
     <p>First of all thanks for thinking along</p>
<p>About Vrms it can, but accuracy&nbsp;isn&#39;t that interesting for me. I&#39;m going to&nbsp;monitor&nbsp;milking systems&nbsp;of&nbsp;dairy farms and I am now setting up the first Emontx (will be 6 in future). I want to compare different farms and find why there is a big difference in usage. Probably due to efficiency of the systems. The integers will show me that there is a&nbsp;voltage drop, what will be only significant when it&#39;s&nbsp;more than a number of volts.</p>
<p>I&#39;m not that familiar with programming, so I don&#39;t know what to change to&nbsp;save another 4 bytes as you mentioned with changing b or B.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37674"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Send Decimals with RFM</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 30/12/2015 - 15:33.</div>
    <div class="content">
     <p>Power factor <i>should</i> never be greater than 1, however due to rounding errors in the maths, it can be slightly greater. If power is being returned to the supply, it can be negative. What Paul was saying is, if you define the power factor in the Payload as "char powerFactor1", ('char' is a signed byte) then having calculated the value, you fill the payload with<br />
"emontx.powerFactor1 = powerFactor1 * 100;"<br />
then you'll get a number that you can divide by 100 in emonHub to give the correct value (truncated to 2 decimal places) as before, but it occupies only 1 byte in the Payload. Use datacode 'b' in emonHub for each of the power factor values. i.e., you'll need:</p>
<p>datacode<b>s</b> = h, h, b, h, &nbsp; h, h, b, h, &nbsp; h, h, b, h, &nbsp; h, h, b, h, &nbsp; h</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11899"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-92DmyfEuDLf6R8UFJcYUFiF9CfmWJ6cCC3tOvgJSygI" value="form-92DmyfEuDLf6R8UFJcYUFiF9CfmWJ6cCC3tOvgJSygI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
