<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10505 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:00:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonTXv3 creates 13 key in input | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonTXv3 creates 13 key in input</h3>
        <span class="submitted">Submitted by <a href="../user/8009.html" title="View user profile.">astoklas</a> on Wed, 22/04/2015 - 11:07</span>
        <div class="content"><p>Hi,</p>
<p>I&#39;m new to the openEngergymonitor and trying to setup my first home installation. With my first emonTXv3 initial setup worked well, however I do get in the &quot;Inputs&quot; 13 key&#39;s. In other posts and in the setup guide there are always fewer keys. (I just turned on the emonTX, no sensors connected, usb powered)</p>
<p>Key 13, I assume, seems to be the signalStrength, as it&#39;s value is comparable to the emonTH which have this additional key as well.</p>
<p>How do I figure out which inputs are used for what?</p>
<p>Thanks<br />
Alexander</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10525.html" class="topic-previous" title="Go to previous forum topic">‹ Problem in letting rapberry pi to send data to emoncms in localhost</a>
              <a href="10524.html" class="topic-next" title="Go to next forum topic">Raspberry Pi Arduino Java Example Event Handler not triggering ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-29872"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 22/04/2015 - 15:28.</div>
    <div class="content">
     <p>Are you looking at the message from your emonTx as bytes? If yes, then the message format is specified in the default emonTx sketch, which you can download from GitHub.</p>
<p>What you're seeing is the nodeID (probably 10) followed by something like this (V3.4)</p>
<p>typedef struct {<br />
int power1, power2, power3, power4, Vrms, temp[MaxOnewire];<br />
int pulseCount;<br />
} PayloadTX;  </p>
<p>which is 6 integers if you have no temperature sensors connected, and accounts for your 13 bytes.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29891"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8009.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="astoklas&#039;s picture" title="astoklas&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/8009.html" title="View user profile.">astoklas</a> on Wed, 22/04/2015 - 22:26.</div>
    <div class="content">
     <p>Looking at the sketch the struct seems to be updated:</p>
<p>const byte MaxOnewire=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // +1 since arrya starts at 0. maximum number of DS18B20 one wire sensors<span class="rangySelectionBoundary" id="selectionBoundary_1429741269649_6321404111696863" style="line-height: 0; display: none;">﻿</span></p>
<p>typedef struct {<br />
int power1, power2, power3, power4, Vrms, temp[MaxOnewire];<br />
int pulseCount;<br />
} PayloadTX;&nbsp;&nbsp;&nbsp;&nbsp; // create structure - a neat way of packaging data for RF comms<br />
&nbsp; PayloadTX emontx;</p>
<p>So I end up with 12int = 24bytes - it seems that either pulseCount or the one element of temp-array is missing?</p>
<p>At least with the emonhub.conf<br />
[[9]]<br />
datacodes = h, h, h, h, h, h, h,</p>
<p>I get proper feeds (as far as I can tell because I only have 4CTS and 1 Sensor) from the emonhub.log</p>
<p>2015-04-22 22:14:50,299 INFO emonCMS sending: http://xxxxxxx/emoncms//input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1429740890.09,9,46,35,33,40,24708,222,0,0,0,0,0,0,-39]]&amp;sentat=1429740890</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29893"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 22/04/2015 - 22:20.</div>
    <div class="content">
     <p>Hi&nbsp;Alexander</p>
<p>Can you post some more of the log so we can see a data frame arrive a nd get processed. in the log (when loglevel = DEBUG) the &quot;NEW FRAME&quot; shows the raw values and should then show the node id, decoded values and rssi.</p>
<p>​The nodes section is not required for handling integer only frames so remove that from the equasion&nbsp;by commenting or deleting the [[9]] or [[99]] sections.</p>
<p>Some how there are 12 additional zeros being added to the frame, which are taken to be 6 intergers which gives you 6 valid values 6 rogue zero values and an rssi.</p>
<p>How does the data get to emonHub? do you have an RFM2Pi? does it run the stock firmware?</p>
<p>Has the emonTx sketch been altered in anyway? was it pre-installed ? if not can you link to the sketch you used?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29894"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8009.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="astoklas&#039;s picture" title="astoklas&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/8009.html" title="View user profile.">astoklas</a> on Wed, 22/04/2015 - 22:30.</div>
    <div class="content">
     <p>Paul,<br />
I played around quite a bit - and I just revised me original post as I started to understand better:</p>
<p>I&#39;m running emonTX 3.4 with descrete sampling FW 1.6 (previously 1.5) with RFM69CW 868Mhz.<br />
The RFM2Pi has stock firmware, Pi running emonSD-13-03-15.img.</p>
<p>I think it has to do, that in the latest version of the sketch the number of Temp Sensors have been increased - however the math does not sum up to me yet - missing 2 bytes or an integer.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29898"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 22/04/2015 - 23:28.</div>
    <div class="content">
     <p>Only the data is included in the datacodes maths</p>
<p>from the rfm2pi&nbsp;emonhub&nbsp;also&nbsp;receives a node id and an rssi which to not enter into the sums. and to that it adds the unix&nbsp;timestamp.</p>
<p>From the current data above I would expect to see 12 values from the sketch plus the rssi in emoncms</p>
<p>&nbsp; &nbsp; unixtime, nodeid,&nbsp;<strong>power1, power2, power3, power4, Vrms, t1, t2, t3, t4, t5, t6&nbsp;pulseCount</strong>, rssi</p>
<p>​which is indeed a&nbsp;24byte&nbsp;data frame (12 x 2byte integers)&nbsp;</p>
<p>Paul</p>
<p>edit or if its the &quot;+1&quot; comment next to the temp sensors that&#39;s throwing it out possibly&nbsp;that should be expressed as</p>
<p>&nbsp; &nbsp;&nbsp;unixtime, nodeid,&nbsp;power1, power2, power3, power4, Vrms,<strong>&nbsp;t0,&nbsp;t1, t2, t3, t4, t5,</strong>&nbsp;pulseCount, rssi</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29901"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8009.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="astoklas&#039;s picture" title="astoklas&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/8009.html" title="View user profile.">astoklas</a> on Thu, 23/04/2015 - 08:17.</div>
    <div class="content">
     <p>got it working now: thanks for the DEBUG hint</p>
<pre>
2015-04-23 08:11:15,807 DEBUG 4 NEW FRAME : 1429776675.81 OK 9 0 0 14 0 1 0 0 0 112 89 215 0 0 0 0 0 0 0 0 0 0 0 0 0 (-48) 
2015-04-23 08:11:15,817 DEBUG 4 Timestamp : 1429776675.81
2015-04-23 08:11:15,820 DEBUG 4      Node : 9
2015-04-23 08:11:15,823 DEBUG 4    Values : [0, 14, 1, 0, 22896, 215, 0, 0, 0, 0, 0, 0]
2015-04-23 08:11:15,827 DEBUG 4      RSSI : -48
2015-04-23 08:11:15,905 DEBUG 4 Append to &#39;emonCMS&#39; buffer =&gt; time: 1429776675.81, data: [9, 0, 14, 1, 0, 22896, 215, 0, 0, 0, 0, 0, 0, -48], ref: 4</pre><p>I changed the emonhub.conf accrodingly</p>
<pre>
[[9]]
​        datacodes =  h, h, h, h, h, h, h, h, h, h, h, h,</pre><p>​however odd is the reading of CT2 (14) while actually no device is drawing power. I think I need to calibrate the system more.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29902"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 23/04/2015 - 09:08.</div>
    <div class="content">
     <p>Glad you have it working now,</p>
<p>Just for clarity I would like to explain the default datacode for the [[RFM2Pi]] interfacer is &quot;h&quot; so if it is not overridden in the [[RFM2Pi]][[[runtimesettings]]] or in&nbsp;[nodes] it will assume all incoming data to consist of integer type (ie pairs of bytes). It is only necessary&nbsp;to define datacodes&nbsp;if they differ from the default so if you&nbsp;had not added the [[9]] datacodes line emonHub&nbsp;would of processed the frame&nbsp;correctly..</p>
<p>In [nodes] it is possible to define either a single datacode&nbsp;eg&nbsp;&quot;&nbsp;datacode&nbsp;= L&nbsp;&quot; to process all<span style="line-height: 20.7999992370605px;">&nbsp;value</span><span style="line-height: 20.7999992370605px;">s</span><span style="line-height: 1.6;">&nbsp;(ie undefined count)</span><span style="line-height: 1.6;">&nbsp;from that node as longs, or using the plural </span>datacodes<span style="line-height: 1.6;"> eg&nbsp;&quot; </span>datacode<strong>s</strong><span style="line-height: 1.6;"> = L, L &quot; to specify explicitly the frames from that node will be exactly 2 longs (8 bytes) no longer no shorter.</span></p>
<p>Since &quot;h&quot; is the default type,&nbsp;&quot;datacodes = h, h, h, h, h, h, h, h, h, h, h, h,&quot; only serves to define the number of values as 12 (24byte) causing emonhub to discard any frames not 24bytes long, this can be useful as a &quot;belt and braces&quot; check to ensure no additional &quot;pairs of bytes&quot; are dropped or added but the elevated checks are also&nbsp;less flexible and therefore less forgiving when not defined absolutely correct or legitimate changes are made, as you discovered.</p>
<p>the value of 14 isn&#39;t that odd, some noise will be detected and 14w on a 24Kw range is less than a 0.06% error calibration may well help but not guaranteed. at that level.&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29903"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8009.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="astoklas&#039;s picture" title="astoklas&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/8009.html" title="View user profile.">astoklas</a> on Thu, 23/04/2015 - 09:23.</div>
    <div class="content">
     <p>Paul, thanks for your support and pointing me to the right direction. I do not care to much about the 0.06 Error in general - but would like to have a 0 reading on 0.<br />
I might do this on emoncms&nbsp;be reducing the input by 15 or something like this.</p>
<p>Alexander</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29938"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8057.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8057.jpg" alt="Ian Davies&#039;s picture" title="Ian Davies&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/8057.html" title="View user profile.">Ian Davies</a> on Sun, 26/04/2015 - 14:46.</div>
    <div class="content">
     <p>Apologies for joining this thread, but I also have the same problem with a new emon TX 3.4 installation, but I haven&#39;t delved deeply like the OP. I too am seeing a value on Key 13, which is always negative, and has changed slightly when the emonTX was moved around, so it looks like RSSI. I am also using a Raspberry Pi, running emonbase 3.18.7+ with the RFM69Pi RF Board. I assumed this was just due to a change in the code, and that the RSSI had moved to a new key, but this thread suggests this behaviour was not expected?</p>
<p>If I should have raised this in a new thread, then I will happily do so (still learning the protocols for this forum!)</p>
<p>Cheers</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29942"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTXv3 creates 13 key in input</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 26/04/2015 - 17:11.</div>
    <div class="content">
     <p>There is no problem with receiving&nbsp;13 values via an rfm69, yes the last value is the RSSI. This is added to all frames received by the rfm69 but not a rfm12.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10505"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-cyLoKajEdlxndzsTXmN1enMQ46HEXpIXwLccVCGkr30" value="form-cyLoKajEdlxndzsTXmN1enMQ46HEXpIXwLccVCGkr30"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
