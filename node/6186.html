<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6186 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:38:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>erratic time on emonglcd | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">erratic time on emonglcd</h3>
        <span class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Sat, 29/11/2014 - 00:12</span>
        <div class="content"><p>Over the last few days I&#39;ve noticed erratic readings &amp; when I check the time (pressing top of 3 buttons) I get erratic times.</p>
<p>This results in readings of my &#39;consuming&#39;, &#39;solar&#39; &amp; &#39;importing&#39; (kWh) resetting at 00:00 showing on emonGLCD</p>
<p>Current time showing is 02:12 @ true time of 00:08</p>
<p>Anyone else experienced this behaviour?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3336.html" class="topic-previous" title="Go to previous forum topic">‹ Howto Use RFM12pi without emoncms</a>
              <a href="6212.html" class="topic-next" title="Go to next forum topic">iSKRA MT382 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-25398"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 00:48.</div>
    <div class="content">
     <p>The time is sent from your emonCMS server. Which server are you using? What are your timezone settings? Is the server sending the correct time?<br />
Though at first guess it's unlikely that the GLCD sketch is to blame, it might be an idea to say which sketch you are using, so that somebody does not have to search through them all to find the one or ones that show the time when you press the top button.<br />
What do you mean by erratic? Does the time jump about when you press the button at intervals of a few seconds, or what?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25399"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Sat, 29/11/2014 - 01:23.</div>
    <div class="content">
     <p>Thanks for the speedy response Robert</p>
<p>I&#39;m using the &#39;standard&#39; emoncms sever.</p>
<p>I&#39;m also using the &#39;standard&#39; sketch that was posted at the release of the emonglcd (Mk2?) modified slightly for my own use. I should mention that the sketch I&#39;m using has been fine for a couple of years unmodified, it&#39;s only in the last couple of weeks that this problem has arisen.</p>
<p>I&#39;ve always had the Delayed Summer Time issue where the glcd resets at 00:00 in winter time but not until 01:00 in summer time but that is not the issue here.</p>
<p>By &#39;erratic&#39; I mean that when I press the top button I get an unpredictable time. This evening the time reported by the glcd seems to be about 2 hours &#39;fast&#39; (showing 03:20 @ actual time of 01:15) but at other times of the day it can be different. The time shown by the glcd does not change when I press &amp; hold the top button but the time displayed at different times of the day doesn&#39;t follow any set pattern, it seems to jump about randomly not always following the 2 hour &#39;fast&#39; observation mentioned earlier.</p>
<p>If no one else has experienced this problem then I suspect it may be a hardware problem with glcd.</p>
<p>I&#39;ll report back if I find a solution.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25408"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 13:12.</div>
    <div class="content">
     <p>It sounds as if the time message isn't getting through to your GLCD, and/or its internal clock (which keeps time between being corrected/set from the server) is getting screwed up.  It could be RF interference, or another transmitter started up on the same band nearby. Does your display show the time elapsed since the last good message from the base?</p>
<p>A significant clue just might be "a couple of years". That is about the right length of time for a dry joint to corrode just enough to give you problems, so before you look for anything more complicated, get a good hand lens and a good light, and carefully check over as much of the pcb as you can see. If the problem goes away after you've handled it, it almost certainly is a dry joint and you've moved the surfaces enough to scrape it clean - for now!</p>
<p>(I remember very many years ago chasing a dry joint on an audio amplifier - only touching the case 'cured' the problem for a few weeks, it took me about 2 years on and off to find it, then 5 s to cure it.]  </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25427"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Sat, 29/11/2014 - 20:15.</div>
    <div class="content">
     <p>Hi Robert</p>
<p>Handling the board (even wiggling the components) made no difference. Had a good look at the circuit board but nothing obvious, all looks normal</p>
<p>The emon GLCD seems to receive the data from emonbase OK, it&#39;s just the clock that&#39;s not being updated so obviously the wireless connection is OK.</p>
<p>At reset, the clock starts at 12:00 (as determined by the sketch) &amp; then advances normally but after the reset the clock does not get changed to the current correct time from the emonCMS server.</p>
<p>The data sent to the server by the emonTX all seems normal so it appears that the emonGLCD is the problem</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25429"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 29/11/2014 - 22:02.</div>
    <div class="content">
     <blockquote><p><em>The emon GLCD seems to receive the data from emonbase OK, it&#39;s just the clock that&#39;s not being updated so obviously the wireless connection is OK</em></p>
</blockquote>
<p>Is it not <u>just</u> the time that comes from the emonBase? I thought the data came direct from the emonTx, whiich&nbsp;confirms the emonGLCD is receiving ok, therefore the issue is most likely to be the emonBase transmission not being received by the emonGLCD. Have you confirmed the time update&nbsp;is definitely&nbsp;being sent ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25430"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 22:12.</div>
    <div class="content">
     <p>OK, we'll rule out the dry joint. </p>
<p><i>"The emon GLCD seems to receive the data from emonbase OK, it's just the clock that's not being updated so obviously the wireless connection is OK."</i></p>
<p>Are you sure that is the case? In the normal way of things, the GLCD receives the energy/power data direct from the emonTx - it's not retransmitted by the Base, and only the time comes from the emonBase.</p>
<p>If you haven't modified your Base sketch, it's probably still doing that; and in that case, the problem could be anywhere in path from the server via the base to the GLCD. Is the base receiving the time from emonCMS.org? Can you verify that?</p>
<p>Are you sending data to emonCMS.org and is it arriving? I remember a few days ago I saw a post saying that Trystan has stopped an obsolete emonCMS server (or was it a redirection from an obsolete URL? - I can't remember now).  Check with a web browser that you can send the time query <u>using the URL that your emonBase uses</u> and that you get the correct time back. The query string that works now is:</p>
<p>emoncms.org//time/local.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
<p>and it should reply in the format:</p>
<p>t22,10,29</p>
<p>[Paul - you've done it again!]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25431"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 29/11/2014 - 22:13.</div>
    <div class="content">
     <p>I just took a look at your past posts to see if I could tell what emonBase&nbsp;you are using and see your last thread was about a month&nbsp;ago when you had to over-write your existing (unidentifiable)&nbsp;NanodeRF sketch due to a change in emonCMS server&nbsp;IP address. Are you sure it&#39;s worked since then ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25432"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 22:14.</div>
    <div class="content">
     <p>Paul - we're thinking along the same lines here: What's the betting the time query isn't being sent correctly?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25433"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 29/11/2014 - 22:21.</div>
    <div class="content">
     <p>I think the emonBase sketch is definitely&nbsp;the prime suspect, it&#39;s either not fetching or not relaying the time, I&#39;m not familiar enough&nbsp;with the Nanode&nbsp;RF to hazard a guess which !</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25434"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 22:27.</div>
    <div class="content">
     <p>The only way to know that is to hang a serial monitor on it. You'll see the time printed every minute (in between the emonTx data) if it's receiving it from emonCMS.org.<br />
If it's doing that, does the base have the correct nodeID for the GLCD to decode the message? If the default NodeID of the base changed  when dominator reloaded his NanodeRF (or generally it isn't the one the GLCD is expecting the message from), it's now wrong and the GLCD will be ignoring the time broadcast. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25436"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 29/11/2014 - 22:56.</div>
    <div class="content">
     <blockquote><p><em>NanodeRF now seems to be working as normal &amp; serial monitor prints:</em></p>
<p><em>1 emontx packet rx2 {rf_fail:0,solar:0,grid :443}<br />
3 ok | Date: Mon, 27 Oct 2014 00:45:06 GMT</em></p>
<p><em>4 emonbase sent<br />
5 emonglcd: 2787</em></p>
</blockquote>
<p>Does this make sense ? what does 2787 relate to ? it&#39;s from the &quot;<a href="5989.html">Nanode RF thread&quot;</a>&nbsp;the fetched time is around 12 hrs out by the comment time but we don&#39;t know the&nbsp;timezone&nbsp;or how old the log was when posted, but the &quot;2787&quot; is suspect isn&#39;t it ?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25438"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 23:50.</div>
    <div class="content">
     <p>Chris: I don't recognise that output from your NanodeRF, which sketch exactly are you using?<br />
Paul: I think Chris is in the UK - his TZ is presently set to GMT, and his email address is at .UK ISP.</p>
<p>The normal format for the NanodeRF output is:</p>
<p style="margin-left: 2em; font-size: smaller">
[webClient]<br />
DHCP status: 1<br />
IP:  192.168.1.68<br />
GW:  192.168.1.254<br />
DNS: 8.8.8.8<br />
DNS status: 1<br />
SRV: 80.243.190.58<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:1}<br />
Time request sent<br />
Time: t23,37,42<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;node=10&amp;csv=14710,0,0,0,0,0,0,0,0,0,0,0,0,0<br />
OK received<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;node=10&amp;csv=14720,0,0,0,0,0,0,0,0,0,0,0,0,0<br />
OK received<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;node=10&amp;csv=14725,0,0,0,0,0,0,0,0,0,0,0,0,0<br />
OK received<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;node=10&amp;csv=14730,0,0,0,0,0,0,0,0,0,0,0,0,0<br />
OK received<br />
Time request sent<br />
Time: t23,38,42<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:1}<br />
OK received<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;node=10&amp;csv=14750,0,0,0,0,0,0,0,0,0,0,0,0,0<br />
OK received</p>
<p>(The emonTx sketch was the "continuous" one, with no CTs. "147xx" is the message number.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25474"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Mon, 01/12/2014 - 16:11.</div>
    <div class="content">
     <p>Robert</p>
<p>&nbsp;</p>
<p>As can be seen from my serial printout below I&#39;m getting the same as your nanodeRF (emonBase) except I&#39;m not receiving a time reply from the emnoncms server</p>
<p>&nbsp;</p>
<p>Sorry, deleted posting because I left apikey visible!! (stupid boy!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25476"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Mon, 01/12/2014 - 16:47.</div>
    <div class="content">
     <p>Have attached the emonBase &amp; emonGLCD sketches I use to help you narrow down my time problem</p>
<p>My NanodeRF(emonBase) output is:</p>
<p>
[webClient]</p>
<p>DHCP status: 1<br />
IP:&nbsp; 192.168.0.2<br />
GW:&nbsp; 192.168.0.1<br />
DNS: 8.8.8.8<br />
DNS status: 1<br />
SRV: 80.243.190.58<br />
Data sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:1}<br />
Time request sent</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3386,solar:-11,powerC:0}</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3372,solar:-12,powerC:0}</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3386,solar:-12,powerC:0}</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3385,solar:-13,powerC:0}</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3374,solar:-8,powerC:0}</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3393,solar:-11,powerC:0}</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3375,solar:-11,powerC:0}</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3375,solar:-12,powerC:0}</p>
<p>emonTx data rxData sent: /api/post.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=&amp;json={rf_fail:0,grid:3373,solar:-11,powerC:0}<br />
OK received<br />
Time request sent</p>
<p>&nbsp;</p>
<p>But no Time: txx,xx,xx printout</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25488"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 01/12/2014 - 22:19.</div>
    <div class="content">
     <p>Why, in your Nanode sketch, have you set your APIkey to</p>
<p>char apikey[] = "/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=";</p>
<p>You can see in your print that it's sending a garbled message to post the data - "/emoncms3/api/post.json?" is not a legal APIkey - (but somehow it appears to be parsed correctly when posting data), but <i><u>the same "/emoncms3/api/post.json?" is being sent to the time server as well</u></i>, and I strongly suspect that's choking on it and refusing to send back the time. You need to correct that and then see if the time server responds.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25493"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Mon, 01/12/2014 - 22:48.</div>
    <div class="content">
     <p>I replaced my true apikey with the xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx to avoid my key showing for the purposes of this discussion.</p>
<p>My actual sketch contains the proper key &amp; hence is communicating with the emoncms server.</p>
<p>All my printouts that contained my actual apikey I changed for the reason i mentioned above</p>
<p>My data is being sent correctly <em>except</em> the time</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25497"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 02/12/2014 - 00:18.</div>
    <div class="content">
     <p>Yes, I appreciate that about "xxx...", but what about the pre-amble with emoncms3 etc? That must not be part of the APIkey. Read again what I wrote above.<br />
Here is the settings part of my NanodeRF sketch that produced the listing I posted above. </p>
<p style="margin-left: 3ex">
// ethernet interface mac address, must be unique on the LAN<br />
static byte mymac[] = { 0x42,0x31,0x42,0x21,0x30,0x31 };
</p>
<p style="margin-left: 3ex">
// 1) Set this to the domain name of your hosted emoncms - leave blank if posting to IP address<br />
char website[] PROGMEM = "emoncms.org";
</p>
<p style="margin-left: 3ex">
// or if your posting to a static IP server:<br />
static byte hisip[] = { 192,168,1,10 };<br />
// change to true if you would like the sketch to use hisip<br />
boolean use_hisip = false;
</p>
<p style="margin-left: 3ex">
// 2) If your emoncms install is in a subdirectory add details here i.e "/emoncms3"<br />
char basedir[] = "";
</p>
<p style="margin-left: 3ex">
// 3) Set to your account write apikey<br />
char apikey[] = "1db5ae7fd006b80f54f6664d198bb5a2";
</p>
<p>That's a false APIkey of course, but there is NO rubbish on the beginning. You can see your correct APIkey on emonCMS Input API Help. That doesn't have "/emoncms3...." on the front and neither should you have it in your sketch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25503"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 02/12/2014 - 09:53.</div>
    <div class="content">
     <p>In the original sketch <a href="https://github.com/openenergymonitor/NanodeRF/blob/master/NanodeRF_Power_RTCrelay_GLCDtemp/NanodeRF_Power_RTCrelay_GLCDtemp.ino#L253">line&nbsp;253</a>&nbsp;and <a href="https://github.com/openenergymonitor/NanodeRF/blob/master/NanodeRF_Power_RTCrelay_GLCDtemp/NanodeRF_Power_RTCrelay_GLCDtemp.ino#L265">line 265</a>&nbsp;both assemble URL strings, the 1st for posting data and the second to retrieve time, in your sketch the 1st appears to be edited but not the second. Was this &quot;fix&quot; to resolve&nbsp;a&nbsp;data posting issue ? &nbsp;if so the &quot;fix&quot; should&nbsp;be moved to code&nbsp;common to both parts, copying the working edit over to the non-working string may work to test the theory but probably not good coding practice.&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25504"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Tue, 02/12/2014 - 10:34.</div>
    <div class="content">
     <p>Robert</p>
<p>followed your&#39;s &amp; Paul&#39;s advice but still no time being updated from the server.</p>
<p>When I compare your nanodeRF printout above of:-</p>
<p>Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:1}<br />
Time request sent<br />
Time: t23,37,42</p>
<p>with mine today after your sketch mods &amp; Paul&#39;s suggestion:-</p>
<p>&quot;In the original sketch line&nbsp;253&nbsp;and line 265&nbsp;both assemble URL strings, the 1st for posting data and the second to retrieve time, in your sketch the 1st appears to be edited but not the second. Was this &quot;fix&quot; to resolve&nbsp;a&nbsp;data posting issue ? &nbsp;if so the &quot;fix&quot; should&nbsp;be moved to code&nbsp;common to both parts, copying the working edit over to the non-working string may work to test the theory but probably not good coding practice.&quot;</p>
<p>All works apart from the time update!!</p>
<p>[webClient]<br />
NanodeRF_Power_RTCrelay_GLCDtemp_mine_27_10_2014<br />
DHCP status: 1<br />
IP:&nbsp; 192.168.0.2<br />
GW:&nbsp; 192.168.0.1<br />
DNS: 8.8.8.8<br />
DNS status: 1<br />
SRV: 80.243.190.58<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:1}<br />
Time request sent</p>
<p>emonTx data rxData sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:0,grid:-230,solar:617,powerC:0}<br />
OK received</p>
<p>This was received around 10:20 after the suggested sketch mods</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25507"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 02/12/2014 - 11:00.</div>
    <div class="content">
     <p>The &quot;Time request sent&quot; print suggests it reaches <a href="https://github.com/openenergymonitor/NanodeRF/blob/master/NanodeRF_Power_RTCrelay_GLCDtemp/NanodeRF_Power_RTCrelay_GLCDtemp.ino#L264">that point</a> ok and the lack of a &quot;Time :&quot; print means it&#39;s not getting past&nbsp;the <a href="https://github.com/openenergymonitor/NanodeRF/blob/master/NanodeRF_Power_RTCrelay_GLCDtemp/NanodeRF_Power_RTCrelay_GLCDtemp.ino#L281">&quot;if reply begins with &#39;t&#39;&quot;</a> test.</p>
<p>If you add another option to my_callback to print any other reply you maybe able to determine what if anything is being returned. So before the very last } you could add something like</p>
<blockquote><p><em>else</em></p>
<p><em>{</em></p>
<p><em>&nbsp;&nbsp;Serial.print(&quot;Error: incorrect reply received -&gt; &quot;);<br />
&nbsp; Serial.println(line_buf);</em></p>
<p><em>}</em></p>
</blockquote>
<p><em>and see what comes up.</em></p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25513"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Tue, 02/12/2014 - 19:53.</div>
    <div class="content">
     <p>Paul</p>
<p>I modified my_callback as below:</p>
<p>static void my_callback (byte status, word off, word len) {<br />
&nbsp; int lsize =&nbsp;&nbsp; get_reply_data(off);<br />
&nbsp;<br />
&nbsp; if (strcmp(line_buf,&quot;ok&quot;)==0)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; Serial.println(&quot;OK received&quot;); ethernet_requests = 0; ethernet_error = 0;<br />
&nbsp; }<br />
&nbsp; //else<br />
&nbsp; //if(line_buf[0]==&#39;t&#39;)//&#39;t&#39;<br />
&nbsp; //{<br />
&nbsp;&nbsp;&nbsp; Serial.print(&quot;Time: &quot;);<br />
&nbsp;&nbsp;&nbsp; Serial.println(line_buf);<br />
&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp; char tmp[] = {line_buf[1],line_buf[2],0};<br />
&nbsp;&nbsp;&nbsp; byte hour = atoi(tmp);<br />
&nbsp;&nbsp;&nbsp; tmp[0] = line_buf[4]; tmp[1] = line_buf[5];<br />
&nbsp;&nbsp;&nbsp; byte minute = atoi(tmp);<br />
&nbsp;&nbsp;&nbsp; tmp[0] = line_buf[7]; tmp[1] = line_buf[8];<br />
&nbsp;&nbsp;&nbsp; byte second = atoi(tmp);</p>
<p>&nbsp;&nbsp;&nbsp; if (hour&gt;0 || minute&gt;0 || second&gt;0)<br />
&nbsp;&nbsp;&nbsp; { &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char data[] = {&#39;t&#39;,hour,minute,second};<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int i = 0; while (!rf12_canSend() &amp;&amp; i&lt;10) {rf12_recvDone(); i++;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rf12_sendStart(0, data, sizeof data);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rf12_sendWait(0);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; //}<br />
&nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else</p>
<p>&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Error: incorrect reply received -&gt; &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(line_buf);</p>
<p>&nbsp;&nbsp;&nbsp; }</p>
<p>}</p>
<p>&nbsp;</p>
<p>This is what I get back even when I REM&#39;d out the else if(line_buf[0]==&#39;t&#39;)//&#39;t&#39;</p>
<p>&nbsp;</p>
<p>[webClient]<br />
NanodeRF_Power_RTCrelay_GLCDtemp_mine_27_10_2014<br />
DHCP status: 1<br />
IP:&nbsp; 192.168.0.2<br />
GW:&nbsp; 192.168.0.1<br />
DNS: 8.8.8.8<br />
DNS status: 1<br />
SRV: 80.243.190.58<br />
Data sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:1}<br />
Time request sent</p>
<p>emonTx data rxData sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:0,grid:3044,solar:-11,powerC:0}</p>
<p>emonTx data rxData sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:0,grid:3056,solar:-13,powerC:0}</p>
<p>emonTx data rxData sent: /input/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json={rf_fail:0,grid:3063,solar:-11,powerC:0}<br />
OK received<br />
Time: ok<br />
Error: incorrect reply received -&gt; ok</p>
<p>&nbsp;</p>
<p>It seems to be ignoring the block:</p>
<p>char tmp[] = {line_buf[1],line_buf[2],0};<br />
&nbsp;&nbsp;&nbsp; byte hour = atoi(tmp);<br />
&nbsp;&nbsp;&nbsp; tmp[0] = line_buf[4]; tmp[1] = line_buf[5];<br />
&nbsp;&nbsp;&nbsp; byte minute = atoi(tmp);<br />
&nbsp;&nbsp;&nbsp; tmp[0] = line_buf[7]; tmp[1] = line_buf[8];<br />
&nbsp;&nbsp;&nbsp; byte second = atoi(tmp);<br />
&nbsp;&nbsp;&nbsp; if (hour&gt;0 || minute&gt;0 || second&gt;0)<br />
&nbsp;&nbsp;&nbsp; { &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; char data[] = {&#39;t&#39;,hour,minute,second};<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int i = 0; while (!rf12_canSend() &amp;&amp; i&lt;10) {rf12_recvDone(); i++;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rf12_sendStart(0, data, sizeof data);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rf12_sendWait(0);</p>
<p>&nbsp;</p>
<p>Does this help?</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25520"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 02/12/2014 - 22:29.</div>
    <div class="content">
     <p>A little! it tells us it&#39;s not&nbsp;getting past&nbsp;the&nbsp;&quot;if reply begins with &#39;t&#39;&quot;&nbsp;test because the reply doesn&#39;t begin with &#39;t&#39; so either the sketch isn&#39;t asking the right question or emonCMS&nbsp;isn&#39;t giving the right answer, whilst not concrete, I think it&#39;s probably the sketch as no-one else has posted an issue in this area.&nbsp;</p>
<p>If you change&nbsp;the existing <a href="https://github.com/openenergymonitor/NanodeRF/blob/master/NanodeRF_Power_RTCrelay_GLCDtemp/NanodeRF_Power_RTCrelay_GLCDtemp.ino#L264">&quot;Time request&nbsp;sent&quot; line</a>&nbsp;so&nbsp;it reads</p>
<blockquote><p><em>Serial.print(&quot;Time request sent: &quot;); Serial.println(str.buf);</em></p>
</blockquote>
<p>we can then see the string&nbsp;being sent.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25524"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 02/12/2014 - 23:20.</div>
    <div class="content">
     <p>If "ok" appears to be coming back following a request for the time, then surely either (a) your sketch is sending not the time request but something the server is interpreting as data to be stored, or (B) nothing has come back and you're looking at the previous response.<br />
I don't believe the callback is at fault. I think the problem is your "APIkey" string.</p>
<p>Looking at your sketch as originally posted, line 99 is:<br />
char apikey[] = "/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=";<br />
That is WRONG. It should only be:<br />
char apikey[] = "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";<br />
(obviously with your correct APIkey in there).</p>
<p>Looking down the sketch at the line where the normal energy data is sent and reconstructing the message by hand, starting at line 201 you send:<br />
"emoncms.org/api/post.json?apikey=<b>/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=</b><br />
&amp;json={rf_fail:0,grid:GGG,solar:SSS,powerC:CCC"<br />
which ties up exactly with what you actually send - and that is wrong because the APIkey (as you have programmed it, in bold) repeats part of the server URL and the text "apikey" is sent twice.</p>
<p>Doing the same with the time request starting at line 271, you are sending:<br />
emoncms.org/time/local.json?apikey=/emoncms3/api/post.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;json=<br />
This now is totally wrong.</p>
<p>Can I suggest you send that string by pasting it into the address bar of your web browser, of course using your correct APIkey, and send it.</p>
<p>And then send this:<br />
emoncms.org/time/local.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br />
again of course using your correct APIkey. In the first case, I expect nothing. In the second, you should see the time reported. </p>
<p>Does this explain the point I'm trying to make about how you have entered your APIkey in the sketch?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25527"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Tue, 02/12/2014 - 23:35.</div>
    <div class="content">
     <p>Paul</p>
<p>carried out yor suggested mods &amp; un REM&#39;d if statement if(line_buf[0]==&#39;t&#39;) &amp; got this, but only once @ about 23:25:-</p>
<p>Time request sent<br />
/time/local.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br />
Time: t00,23,56<br />
emonGLCD temp recv: 2525</p>
<p>thereafter got this:-</p>
<p>Time request sent<br />
/time/local.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</p>
<p>Obviously the &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot; are to hide my apikey from view</p>
<p>&nbsp;</p>
<p>Weird!?</p>
<p>Chris</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25528"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 03/12/2014 - 00:28.</div>
    <div class="content">
     <p>Well thats&nbsp;a good&#39;ish response I&#39;d say. except it appears the server is still on BST so the time returned is 00:23:56, almost 24 mins past midnight and that has been successfully&nbsp;relayed to the emonGLCD as it seems to have replied with a rather toastie&nbsp;25.25&deg;C, but why only once I&#39;m not sure.</p>
<p><a href="https://github.com/openenergymonitor/NanodeRF/blob/master/NanodeRF_Power_RTCrelay_GLCDtemp/NanodeRF_Power_RTCrelay_GLCDtemp.ino#L259">I think it&#39;s supposed to update every 60 seconds which seems a bit frequent maybe it&#39;s meant to be&nbsp;every 60mins, </a>try Roberts suggestion of using the url in your browser and see if you get a response every time.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25531"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 03/12/2014 - 00:24.</div>
    <div class="content">
     <p>I&#39;ve tried this url in my browser several times and got the correct response every&nbsp;time with my apikey</p>
<blockquote><p><em>http://emoncms.org/time/local.json?apikey=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</em></p>
</blockquote>
<p>Have you set the correct timezone on your emoncms.og account ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25534"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 03/12/2014 - 01:47.</div>
    <div class="content">
     <p>Paul, can you get <b>any</b> response with the faulty string that Chris is sending by virtue of the corrupt APIkey? I couldn't. That makes me think the server is not responding, which is exactly as I would expect.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25541"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Wed, 03/12/2014 - 10:08.</div>
    <div class="content">
     <p>Paul, Robert</p>
<p>I tried all your suggestions last night &amp; I&#39;m now getting a time response from the server.</p>
<p>However, the time is not getting posted correctly to emonGLCD.</p>
<p>Last night there was a time difference of about 5 hours; when the server time was showing 01:00 my emonGLCD time was showing as 20:00ish ( after the initial startup time of 12:00 given by the sketch)</p>
<p>This morning the emonBase printout shows:</p>
<p>Time request sent<br />
Time: t09,43,47 - which is correct for my time zone UTC+00:00 (GMT)<br />
emonGLCD temp recv: 2525</p>
<p>
but the emonGLCD is showing a time of 20:46!</p>
<p>I attached both emonBase &amp; emonGLCD sketches to see if you can help pin down the difference in times</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25544"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 03/12/2014 - 11:13.</div>
    <div class="content">
     <p>Robert - I hadn&#39;t tried the previous string as I had assumed it was a &quot;cut and paste&quot; error when masking apikey</p>
<p>Chris<br />
Hopefully Robert will be&nbsp;of more help to you here but to me the&nbsp;<a href="https://github.com/openenergymonitor/NanodeRF/blob/master/NanodeRF_Power_RTCrelay_GLCDtemp/NanodeRF_Power_RTCrelay_GLCDtemp.ino#L286">char tmp[] ={line_buf[1],line_buf[2],0};</a>&nbsp;<span style="font-size:12.7272720336914px; line-height:18.9090900421143px">line&nbsp;</span><span style="font-size:12.7272720336914px; line-height:18.9090900421143px">loo</span><span style="font-size:12.7272720336914px; line-height:18.9090900421143px">ks</span><span style="font-size:12.7272720336914px; line-height:18.9090900421143px">&nbsp;a bit funky,&nbsp;</span><span style="font-size:13px; line-height:1.6">it looks like it is in effect multiplying the hours value by 10, but I could be wrong.</span></p>
<p><span style="font-size:13px; line-height:1.6">Maybe add another print statement to see what the NanodeRF is actually sending,</span></p>
<p><span style="font-size:13px; line-height:1.6">In the next block after &quot;</span>char data[] = {&#39;t&#39;,hour,minute,second};&quot; you could add something like</p>
<blockquote><p>Serial.print(&quot;Actual time values sent are&nbsp;&quot;);<br />
Serial.println(data);</p>
</blockquote>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25555"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Wed, 03/12/2014 - 14:14.</div>
    <div class="content">
     <p>The sketch I&#39;m using is the original one supplied by openenergy monitor for use with the nanodeRF (emonBase) &amp; it was working until quite recently.</p>
<p>I think the problem may have originated around the time Trystan deleted an old server? thinking it was obsolete.</p>
<p>Having now got the emonBase to receive time from the server (thanks largely to you &amp; Robert) I now need to find out why emonGLCD is not being updated with server time received but instead is updated with an odd time that doesn&#39;t appear to be related to the server time as explained above.</p>
<p>If I reboot the emonGLCD the time shows 12:00 (the start time read from the sketch).</p>
<p>On receipt of the first server time of t13,44,00 the emonGLCD time displayed changed from 12:02 to 20:46; almost exactly 7 hours difference between the two times!</p>
<p>So the emonGLCD time was updated from emonBase but not correctly (my TZ is still UTC+00:00)</p>
<p>Being a newbie at coding, I&#39;m lost as to know what to do to resolve this without changing my TZ!!</p>
<p>Many thanks again for all your help Paul</p>
<p>PS</p>
<p>As an experiment, I changed my TZ to UTC-07:00.</p>
<p>The server issued the correct time of t07,08,47 &amp; my emonGLCD changed from 12:00 (startup time) to</p>
<p>20:08!! so it&#39;s not the server time &#39;shifted&#39; that&#39;s being sent to emonGLCD so where is this &#39;odd&#39; time coming from?? - curiouser &amp; curiouser!</p>
<p>&nbsp;</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25556"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 03/12/2014 - 14:22.</div>
    <div class="content">
     <p>When the serial output from the NanodeRF&nbsp;prints &quot;&nbsp;Time: t00,23,56 &quot; it is printing the time received from the server, then it changes it to the required format to send out to the emonGLCD, we do not know what it actually transmits, which is why I suggested that last print statement. either the transmitted time will be correct, meaning the emonGLCD is at fault or the transmitted time will be incorrect pointing the finger at the NanoeRF, if the emonGLCD is correctly displaying the incorrect transmission it can also be removed from suspicion.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25558"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 03/12/2014 - 14:50.</div>
    <div class="content">
     <p>It may just be coincidence, but unlikely. Have you noticed that aside from that&nbsp;one first&nbsp;successful&nbsp;time&nbsp;setting, every time you set the emonGLCD&nbsp;time&nbsp;it seems to result in a time between 8 and 9pm ie always starts &quot;20&quot; regardless of the current time?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25561"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Wed, 03/12/2014 - 15:07.</div>
    <div class="content">
     <p>This line in the emonGLCD sketch always sets the time to 12:00 at startup:-</p>
<p>RTC.begin(DateTime(&quot;Dec&nbsp; 8 2011&quot; , &quot;12:00:00&quot;)); //start up software RTC - this time will be updated to correct tme from the interent via the emonBase</p>
<p>When the emonBase reads the first time txx.xx.xx from the server only then does the emonGLCD change to the 20:00 time but I don&#39;t know where this time comes from</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25564"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 03/12/2014 - 15:18.</div>
    <div class="content">
     <p>Which is why you need to establish what is actually being transmitted.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25578"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 03/12/2014 - 21:07.</div>
    <div class="content">
     <p>From a post some way back by Paul:<br />
<i>"Hopefully Robert will be of more help to you here but to me the char tmp[] ={line_buf[1],line_buf[2],0}; line looks a bit funky, it looks like it is in effect multiplying the hours value by 10, but I could be wrong."</i><br />
I think that line is OK. The '0' in tmp[2] is a terminating NULL. Remember it's C string.</p>
<p>But when it comes to transferring the time from the Nanode to the GLCD, I too am a bit puzzled by that. I'll look into that later (I may not be able to look until Friday or Saturday) but on the face of it, there's a mismatch in aligning the received data to the time variables.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25581"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Wed, 03/12/2014 - 22:32.</div>
    <div class="content">
     <p>Paul</p>
<p>This is the result of your suggestion:-</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Actual time values sent are &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(data);</p>
<p>Time request sent<br />
Time: t21,56,45<br />
Actual time values sent are t8-Y<br />
emonGLCD temp recv: 2481</p>
<p>Time request sent<br />
Time: t22,10,48<br />
Actual time values sent are t0Y</p>
<p>Time request sent<br />
Time: t22,16,06<br />
Actual time values sent are tY<br />
emonGLCD temp recv: 2493</p>
<p>Time request sent<br />
Time: t22,21,07<br />
Actual time values sent are tY<br />
emonGLCD temp recv: 2493</p>
<p>
I&#39;m none the wiser!</p>
<p>&nbsp;</p>
<p>Incidentally, I&#39;ve noticed that when the emonGLCD receives its first time txx,xx,xx from the server it changes the displayed time from 12:00 to 20:00 but also when the displayed time passes 20:59 it then resets to 20:00 rather than 21:00</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25584"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 04/12/2014 - 00:25.</div>
    <div class="content">
     <p>Printing data[ ] as a string (which is how print will interpret it, because it is defined as type char), was never going to be helpful. Except for the 'signature' 1st character ('t'), it is bytes of data, not printable characters.</p>
<p>You need something like:<br />
for (i=0; i< sizeof(data); i++)<br />
  Serial.print((int)data[i]);</p>
<p>N.B. I've not tested that!</p>
<p>On the face of it, at a quick look (disclaimers!), in your GLCD sketch you should have (line 68):</p>
<p style="margin-left: 2ex;">typedef struct { <b>byte</b> hour, mins, sec; } PayloadBase;<br />
PayloadBase emonbase;</p>
<p>to tie up with the mapping of the time as bytes to the data[ ] array in line 303 of your Base sketch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25594"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 04/12/2014 - 09:26.</div>
    <div class="content">
     <p>ok that wasn&#39;t quite how I expected that to print, (apologies for the&nbsp;misdirection and thanks for the correction RW) still learning c myself too. the intention was sound though,it would still be good to see what is actually being transmitted, so I would try Roberts revised print statement, unless you try editing the payload format in the GLCD&nbsp;1st and it fixes it of course.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25618"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 04/12/2014 - 19:35.</div>
    <div class="content">
     <p>Hmmm...</p>
<p>Looking at a working emonGLCD sketch that was derived from one published a year or two ago, the code that decodes the time and sets the internal clock is:</p>
<p style="margin-left: 3ex">      if (node_id == BASENODE)<br />
      {<br />
      &nbsp;&nbsp;RTC.adjust(DateTime(2012, 1, 1, rf12_data[1], rf12_data[2], rf12_data[3]));<br />
      &nbsp;&nbsp;last_emonbase = millis();<br />
      }
</p>
<p>That is taking the 2nd, 3rd &amp; 4th bytes of the received message and using those (byte) values to directly set the real-time clock. That code is consistent with the way the time is transmitted by the NanodeRF. I'm beginning to think you're a victim of a 'copy-and-paste' mistake by someone who didn't realise that the Nanode sends bytes, not integers of two bytes.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25619"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Thu, 04/12/2014 - 19:52.</div>
    <div class="content">
     <p>Made changes as suggested to:-</p>
<p>typedef struct { byte hour, mins, sec; } PayloadBase;<br />
PayloadBase emonbase;</p>
<p>as suggested to my emonBase &amp; my emonGLCD but problem still remains:-</p>
<p>Time request sent<br />
Time: t15,35,17<br />
Actual time values sent are t#Y</p>
<p>Time request sent<br />
Time: t15,50,41<br />
Actual time values sent are t2)Y</p>
<p>Time request sent<br />
Time: t16,01,37<br />
Actual time values sent are t%Y</p>
<p>Time request sent<br />
Time: t16,30,32<br />
Actual time values sent are t Y</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25621"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Thu, 04/12/2014 - 19:59.</div>
    <div class="content">
     <p>Is there a way to resolve this Robert?</p>
<p>This is way out of my depth from a coding perspective!<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25623"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 04/12/2014 - 21:18.</div>
    <div class="content">
     <p>Hmmm...</p>
<p>Looking at a working emonGLCD sketch that was derived from one published a year or two ago, the code that decodes the time and sets the internal clock is:</p>
<p style="margin-left: 3ex">      if (node_id == BASENODE)<br />
      {<br />
      &nbsp;&nbsp;RTC.adjust(DateTime(2012, 1, 1, rf12_data[1], rf12_data[2], rf12_data[3]));<br />
      &nbsp;&nbsp;last_emonbase = millis();<br />
      }
</p>
<p>That is taking the 2nd, 3rd &amp; 4th bytes of the received message and using those (byte) values to directly set the real-time clock. That code is consistent with the way the time is transmitted by the NanodeRF. I'm beginning to think you're a victim of a 'copy-and-paste' mistake by someone who didn't realise that the Nanode sends bytes, not integers of two bytes.</p>
<p>I'm starting to lose the plot as to where you are now in terms of changes. Can you post the Nanode and GLCD sketches as they stand?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25625"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Thu, 04/12/2014 - 21:55.</div>
    <div class="content">
     <p>These are the current sketches I&#39;m running which gives the result below:</p>
<p>Time request sent<br />
Time: t21,41,51<br />
Actual time values sent are t)3Y<br />
emonGLCD temp recv: 2525</p>
<p>&nbsp;</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25656"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 05/12/2014 - 22:29.</div>
    <div class="content">
     <p>Here is my analysis of your present situation.</p>
<p>In the Nanode, you know the time is being received correctly, as a null-terminated ASCII string, viz: "t21,41,51" and is stored in the variable line_buf. (Line 292 of your sketch, Chris.)<br />
The character array tmp, also destined to become an ASCII string, receives the hours element when it is created and initialised. line_buf[0] ('t') is ignored, line_buf[1] ('2') goes into tmp[0], line_buf[2] ('1') goes into tmp[1], and tmp[2] gets the value 0, which is the terminating null for the string. This is then fed into the standard library function atoi( ) and the string is interpreted as a number, and the number 21 (0x15, ASCII character "NAK") is stored in the single byte variable hour.</p>
<p>Now that tmp has been created, the byte variable minute has to be processed slightly differently. Here, tmp[0] receives directly line_buf[4] ('4') and tmp[1] receives directly line_buf[5] ('1'). tmp[2] still has 0 in it. Again, atoi( ) converts this to the number 41 (0x29, ASCII character ')' ).</p>
<p>Likewise, the byte variable second gets the number 51 (0x33, ASCII character '3' ).</p>
<p>Given that it's not midnight (presumably we can afford to miss that as all-zero values also probably mean a failure somewhere) then (in Line 303), the character array data[ ] is created and initialised with the values 't', hour, minute and second into elements 0 - 3 respectively. This character array is not being treated as an ASCII string, so it does not need a terminating null. Its value is byte 0 - 0x74 (the character 't'), byte 1 - 0x15, byte 2 - 0x29, byte 3 - 0x33.</p>
<p>This array is then sent to the RFM12B and transmitted to the emonGLCD. I hope you can see now why printing the string transmitted results in meaningless characters some of the time. All ASCII characters below 0x20 are non-printing, so most hours and the first third of minutes and seconds result in something non-printable, there's no terminating null so anything in memory following those wanted bytes is also printed, as far as the next null.</p>
<p>In the GLCD, at line 155, the received array is copied into the struct emonbase. Looking at the top of the file, emonbase is a variable of type PayloadBase (line 68). As it <i>was</i>, this was three integers. An integer is two bytes, so the received array mapped into it thus:<br />
byte 0 ('t') - the high byte of hour, byte 1 (0x15) - the low byte of hour.<br />
byte 2 (0x29) - the high byte of mins, byte 3 (0x33) - the low byte of mins.<br />
So hour has the value 0x7415, minute has the value 0x2933. What sec got is anybody's guess, it is what happened to be in memory before the variable was put there. I need not say those are not what was wanted.</p>
<p>As it now <i>is</i>, things are much better, but still not right - but the solution should be clear:<br />
emonbase is now three bytes, so the received array mapped into it thus:<br />
byte 0 ('t') - hour, byte 1 (0x15) - mins, byte 2 (0x29) - sec. We have the 't', which we don't need, and there's nowhere for byte 3 (the transmitted seconds) to go.</p>
<p>There are two solutions (MUTUALLY EXCLUSIVE!). Either you can make the emonBase match what the GLCD is expecting, or vice versa. So either:<br />
change line 68 in the GLCD to<br />
&nbsp;&nbsp;typedef struct { byte junk, hour, mins, sec; } PayloadBase;//was int hour<br />
and never use junk (Actually, if you want, you can test that it is the character 't' to be sure you have a time), or<br />
change line 303 in the Nanode to<br />
&nbsp;&nbsp;char data[] = {hour,minute,second};<br />
i.e. don't send the troublesome 't' in the first place.<br />
There's a third possibility, which would involve more unnecessary complication that would allow you to send integer values, but as the biggest number is 59, well within the range of a byte variable, we'll ignore it.<br />
And there's a fourth possibility: In the GLCD, forget (remove) the struct emonbase and replace line 159 with the equivalent from my post just two posts up this thread. That picks the bytes out of the received data directly, not going through any intermediate variables.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25667"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Sun, 07/12/2014 - 15:37.</div>
    <div class="content">
     <p>Chose the &nbsp;<strong><em>char data[] = {hour,minute,second};</em></strong>&nbsp; option in the NanodeRF sketch Robert &amp; that did the trick</p>
<p>All that hassle over a little &#39;t&#39;!!!</p>
<p>Many thanks again to both Robert &amp; Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25675"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Sun, 07/12/2014 - 21:12.</div>
    <div class="content">
     <p>Robert</p>
<p>Although you managed to sort out the &#39;time&#39; problem for me I have another issue which concerns the original sketch for the emonGLCD.</p>
<p>I&#39;ve been trying to find a copy of the original sketch for the v1.3 circuit board.</p>
<p>I can&#39;t be exactly sure of what sketch I uploaded over 2 years ago but every sketch I&#39;ve tried to upload recently has failed; the most recent with errors:</p>
<p>Arduino: 1.0.6 (Windows 7), Board: &quot;Arduino Uno&quot;<br />
C:\Users\User\Desktop\Arduino 1.0.6\Arduino\libraries\glcdlib\GLCD_proxy.cpp: In member function &#39;void GLCD_proxy::sendLCDMessage(byte)&#39;:<br />
C:\Users\User\Desktop\Arduino 1.0.6\Arduino\libraries\glcdlib\GLCD_proxy.cpp:183: error: no matching function for call to &#39;rf12_sendStart(int, byte [66], byte&amp;, int)&#39;<br />
C:\Users\User\Desktop\Arduino 1.0.6\Arduino\libraries\jeelib/RF12.h:93: note: candidates are: void rf12_sendStart(uint8_t)<br />
C:\Users\User\Desktop\Arduino 1.0.6\Arduino\libraries\jeelib/RF12.h:95: note:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void rf12_sendStart(uint8_t, const void*, uint8_t)</p>
<p>This was the main reason I used your modification to the nanodeRF sketch as I was unable to upload any&nbsp; of the more recent sketches to the emonGLCD (some seemed to employ graphic icons in the coding).</p>
<p>Some of the older sketches have variations in the coding so I can&#39;t be sure which is closest to my original sketch.</p>
<p>I&#39;m not sue if the above errors are library issues relating to the most recent jeelib/RF12 library not being&nbsp; compatible with early sketches.</p>
<p>Your insight would be much appreciated</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25676"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 07/12/2014 - 21:40.</div>
    <div class="content">
     <p>I think you could be right to suspect&nbsp;a lib mismatch, <a href="https://github.com/openenergymonitor/EmonGLCD/commit/665e4338236e89b5cd0266ebb9a765a6dc6bcf00">A change was&nbsp;made in the use of &quot;rf12_sendNow&quot; replacing &quot;rf12_sendStart&quot; there is a reference to a JeeLib issue (no longer accessible) in the glcd&nbsp;sketches commit histor</a>y.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25678"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Sun, 07/12/2014 - 22:37.</div>
    <div class="content">
     <p>Thanks for that Paul</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25680"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/12/2014 - 23:27.</div>
    <div class="content">
     <p>There was indeed a problem with JeeLib - it was locking up. There's a very long thread here:<br />
<a href="1051.html" title="http://openenergymonitor.org/emon/node/1051">http://openenergymonitor.org/emon/node/1051</a>,<br />
and the really interesting bit starts at<br />
<a href="1051.html#comment-9816" title="http://openenergymonitor.org/emon/node/1051#comment-9816">http://openenergymonitor.org/emon/node/1051#comment-9816</a></p>
<p>Basically, you need to get a new copy of Jeelib<br />
( [Edit 3] or maybe not - see this thread: <a href="3850.html" title="http://openenergymonitor.org/emon/node/3850">http://openenergymonitor.org/emon/node/3850</a> )<br />
 (remember you can't leave the old copy, else the compiler is likely to find and use it, the best trick if you feel a need to keep it is to Zip it and then delete the original), and I'd suggest you look at the latest sketches from GitHub and use the RFM12 functions that they use.</p>
<p>So you need to replace your lines 164-166</p>
<p style="margin-left: 3ex">
int i = 0; while (!rf12_canSend() &amp;& i<10) {rf12_recvDone(); i++;}  // if ready to send + exit loop if it gets stuck as it seems too<br />
rf12_sendStart(0, &amp;emonglcd, sizeof emonglcd);                      // send emonglcd data<br />
rf12_sendWait(0);
</p>
<p>with what the HomeEnergyMonitor sketch does:</p>
<p style="margin-left: 3ex">
rf12_sendNow(0, &amp;emonglcd, sizeof emonglcd);<br />
rf12_sendWait(2);
</p>
<p>Then compile with that. I'm pretty sure the receive side is unchanged, but it's best to check.</p>
<p>[Edit]<br />
<strike>And check the current Nanode sketches while you're at it!</strike><br />
For a reason I can't explain, the current Nanode sketches <u>DON'T</u> have that change done. I can't think of a good reason why not, does anybody know?</p>
<p>[Edit 2]<br />
A PM comment from Paul to me suggested that you really ought to change the time data sent from the NanodeRF to the GLCD to be the same as the current "OEM Standard", so that should you ever have to reload with a current sketch again, you won't fall foul of this particular problem again.<br />
(That's bytes, <u>with</u> the 't' being sent by the Nanode but ignored at the GLCD end, i.e. use my 4th suggestion there).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25796"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Fri, 12/12/2014 - 19:56.</div>
    <div class="content">
     <p>Robert</p>
<p>Following our discussion via PM I have now uploaded my original emonGLCD sketch &amp; the old time problem has reappeared but not in the same way as before.</p>
<p>I used the original libraries with the original (attached) sketch from 2012 so as to avoid any problems with the newer jeelib</p>
<p>I&#39;ve tried your mods suggested in earlier posts but I can&#39;t get the time function to work &amp; I&#39;m at a loss as to what to do next</p>
<p>I&#39;ve attached both sketches (emonGLCD &amp; NanodeRF[emonBase])</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25797"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 12/12/2014 - 20:47.</div>
    <div class="content">
     <p>I think you didn't understand what I wrote to explain the problem - or you didn't realise that the C language is zero-based - meaning that you count from zero, not one. Have another read of my post of 5/12/2014, and follow through what is being sent from the Nanode and what is being received by the GLCD.</p>
<p>In the GLCD, you're looking for Hours, Minutes and Seconds in rf12_data[1], rf12_data[2], rf12_data[3]. Note you're <b>NOT</b> looking at rf12_data[0].</p>
<p>In the Nanode, you are sending:<br />
&nbsp;&nbsp;char data[] = {hour,minute,second};<br />
i.e. you're sending hour in the 0th byte, minute in the 1st and second in the 2nd. So with the "standard" OEM data packet, you <b><i>need</i></b> that 't' that's commented out.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25903"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Wed, 17/12/2014 - 11:52.</div>
    <div class="content">
     <p>Robert</p>
<p><em>&quot;I think you didn&#39;t understand what I wrote to explain the problem.....&quot;</em> is true; as mentioned previously, I&#39;m not a programmer, not even close.</p>
<p>I do try &amp; decipher code but only for my own purposes not for the sake of improving my programming skills.</p>
<p>I don&#39;t write/change code frequently enough to become skillful.</p>
<p>I&#39;ve managed to get the correct time sent to my GLCD thanks to your &amp; Paul&#39;s help for which I must thank both of you again.</p>
<p>Refering back to my PM to you regarding correcting the time&nbsp; to display in correct 24 hour format ie 09:05 NOT 9:5 that currently displays on my GLCD could you assist with what code &amp; where I should place in the part of the sketch below.</p>
<p>I think it should take the form:</p>
<p>if (time in hours &lt; 10)</p>
<p>{</p>
<p>Serial.print(&quot;0&quot;);</p>
<p>Serial.print(time in hours);</p>
<p>Serial.print(&quot;:&quot;);</p>
<p>}</p>
<p>else</p>
<p>Serial.print(time in hours);</p>
<p>Serial.print(&quot;:&quot;);</p>
<p>&amp; the similarly for the &#39;time in minutes&#39; - but without the Serial.print(&quot;:&quot;);</p>
<p>but because I can&#39;t fathom the full code below, I&#39;m unsure as to where it needs to be inserted &amp; the relevant code that holds the &#39;hours&#39; &amp; &#39;minutes&#39; that needs to be included for the &#39;time in hours&#39;</p>
<p>&nbsp;</p>
<p>void draw_page_two()<br />
{<br />
&nbsp; glcd.clear;<br />
&nbsp; glcd.fillRect(0,0,128,64,0);<br />
&nbsp;<br />
&nbsp; glcd.setFont(font_clR6x8);<br />
&nbsp; glcd.drawString_P(2,0,PSTR(&quot;Current Time:&quot;));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp; DateTime now = RTC.now();<br />
&nbsp; char str[20];<br />
&nbsp; char str2[5];<br />
&nbsp; itoa((int)now.hour(),str,10);<br />
&nbsp; strcat(str,&quot;:&quot;);&nbsp; &nbsp;<br />
&nbsp; itoa((int)now.minute(),str2,10);<br />
&nbsp; strcat(str,str2);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp; glcd.setFont(font_helvB14); &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//big bold font&nbsp; &nbsp;<br />
&nbsp; glcd.drawString(2,10,str); &nbsp;</p>
<p>&nbsp; glcd.refresh();<br />
&nbsp;<br />
}</p>
<p>Your comments would be appreciated</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 17/12/2014 - 12:45.</div>
    <div class="content">
     <p>Sorry, I'm not going to have time to look at this just now. I'll look later.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25914"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 17/12/2014 - 22:08.</div>
    <div class="content">
     <p>Well, I tried your suggested solution and immediately hit a problem - it appears that the sketch became too large and the result was completely not what I (or you) anticipated.</p>
<p>To get around this, I&#39;ve made the time formatting into a function (so it exists once only) and called it from the two places where you originally wrote the time. Because that&#39;s all a bit complicated, here&#39;s a new display.ino file.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25947"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Thu, 18/12/2014 - 12:51.</div>
    <div class="content">
     <p>Robert</p>
<p>Thanks for the sketch display.ino, a real improvement over the original <u>except</u> I&#39;ve noticed that the GLCD display goes blank after about 15 mins but the Red LED&#39;s are still ON; also page 2 doesn&#39;t display at this same time.&nbsp; The only way to get the display back is to reset the GLCD.</p>
<p>I&#39;ve compared the current display.ino with the previous one but can&#39;t see what might be causing this effect.</p>
<p>Any suggestions?</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25948"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 18/12/2014 - 13:04.</div>
    <div class="content">
     <p>Possibly a memory leak! The GLCD sketches are so tight on memory, that anything like that isn't a surprise to me. I left mine running with the standard Solar PV sketch for longer than that and didn't see a problem. Is you main .ino file still the same? I'll try the last one you posted later.<br />
[Edit: I appear to have an inconsistent set, so I need the full set of files for your GLCD]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25955"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Thu, 18/12/2014 - 14:41.</div>
    <div class="content">
     <p>I&#39;ve attached the current sketch I&#39;m using - My_latest_emonGLCD_SolarPV_15_12_2014.ino, that works fine (except for the rubbish time format) It has a compiled size of 21,398 bytes</p>
<p>I copied &amp; pasted your display.ino into that sketch (after having REM&#39;d out my original display.ino sketch) which I then renamed: My_latest_emonGLCD_SolarPV_18_12_2014.ino.</p>
<p>This is the version that&#39;s causing the blank display. It has a compiled size of 22,084 bytes</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25961"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 18/12/2014 - 16:42.</div>
    <div class="content">
     <p>I'm obviously using different versions of the libraries - compiled size is 22,228 bytes for me. It's been running more than 1 hour so far (but with no incoming data), and is still OK.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25979"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 18/12/2014 - 23:15.</div>
    <div class="content">
     <p>I see you have reverted to using </p>
<p>// if ready to send + exit loop if it gets stuck as it seems to<br />
int i = 0; while (!rf12_canSend() &amp;& i<10) {rf12_recvDone(); i++;}<br />
rf12_sendStart(0, &amp;emonglcd, sizeof emonglcd);                      // send emonglcd data<br />
rf12_sendWait(0);</p>
<p>to send the temperature back to the base. That was the source of much trouble and widespread lock-ups of the GLCD earlier this year, and those lines have now been replaced by</p>
<p>//send temperature data via RFM12B using new rf12_sendNow wrapper -glynhudson<br />
rf12_sendNow(0, &amp;emonglcd, sizeof emonglcd);<br />
rf12_sendWait(2);    </p>
<p>I suggest you do that change and see if it effects a cure.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26011"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Sat, 20/12/2014 - 12:54.</div>
    <div class="content">
     <p>Found the problem.&nbsp; When I re-connected the PSU to the GLCD the blank screen issue never returned.</p>
<p>It seems that the problem only occurs when obtaining power for the GLCD from the USB connection? but why the delay&nbsp; before the screen goes blank?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26019"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: erratic time on emonglcd</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 20/12/2014 - 19:44.</div>
    <div class="content">
     <p><i>"Found the problem."</i> I'm not sure I believe that! - unless the problem is with your programmer or computer. The FTDI and the USB power pins are wired in parallel. I think you're up against the sendStart problem, which always was unpredictable. I strongly recommend you do the above change.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6186"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-fnayf4ukb2c4FfLX9isZ2poLVMjAknb3iH7TgpSYL7g" value="form-fnayf4ukb2c4FfLX9isZ2poLVMjAknb3iH7TgpSYL7g"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/6186 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:38:59 GMT -->
</html>
