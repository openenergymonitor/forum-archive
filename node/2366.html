<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2366 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:39:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Help Needed getting NodeRF  &amp; Emoncms Talking | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Help Needed getting NodeRF  &amp; Emoncms Talking</h3>
        <span class="submitted">Submitted by Guest on Sat, 11/05/2013 - 05:21</span>
        <div class="content"><p>Hi I am hoping someone can help me get my&nbsp;NanodeRF &amp;&nbsp;EmonCMS talking. I have spent some time reading the forum but unfortunately I have not progressed.</p>
<p>
	I have built my EmonTX &amp; EmonGLCD and they seem to be working fine however I am having problems receiving data through my local EmonCMS server via my NanodeRF base station.</p>
<p>
	Firstly following an upload of &quot;NanodeRF_Power_RTCrelay_GLCD.ino&quot; to my base station I was expecting to see the red LED start blinking every 2 seconds. The Red LED however stays fixed and only blinks every time the serial port starts a new cycle beginning with&nbsp; [webClient]</p>
<p>My EmonCMS does not update when Data arrives into the NanodeRF&nbsp;base nor does the EmonGLCD receive time updates back the other way.</p>
<p>These are my setting changes for the NanodeRF_Power_RTCrelay_GLCD.ino file<br />
	//--------------------------------------------------------------------------<br />
	// Ethernet<br />
	//--------------------------------------------------------------------------<br />
	#include &lt;EtherCard.h&gt;&nbsp; //https://github.com/jcw/ethercard</p>
<p>// ethernet interface mac address, must be unique on the LAN<br />
	static byte mymac[] = { 0x42,0x31,0x42,0x21,0x30,0x31 };<br />
	//<strong>Unchanged</strong></p>
<p>
	// 1) Set this to the domain name of your hosted emoncms - leave blank if posting to IP address<br />
	char website[] PROGMEM = &quot;&quot;; &nbsp; &nbsp;&nbsp;<strong style="font-size: 12px;">//Blanked</strong></p>
<p>// or if your posting to a static IP server:<br />
	static byte hisip[] = {10,0,0,115};<br />
	<strong>//This is the IP of my Local Host which runs the Emoncms server.</strong></p>
<p>
	// change to true if you would like the sketch to use hisip<br />
	boolean use_hisip = true;&nbsp;<br />
	<strong>//I assume I set this to true to utilize my EMONCMS Server running on 10.0.0.115.</strong></p>
<p>// 2) If your emoncms install is in a subdirectory add details here i.e &quot;/emoncms3&quot;<br />
	char basedir[] = &quot;/wamp/www/emoncms /&quot;;<br />
	<strong>// Not sure what I should put here. My files exist here C:\wamp\www\emoncms. Will my entry work?</strong></p>
<p>
	// 3) Set to your account write apikey<br />
	char apikey[] = &quot;46c34bc2833697e8d856175f7be36f3e&quot;;</p>
<p></p>
<p><strong>Monitoring the Serial Port I see the following</strong></p>
<p>[webClient]<br />
	DHCP status: 1<br />
	IP:&nbsp; 10.0.0.99</p>
<p><strong>This confuses me since I thought this should be the address of my local server. In my case 10.0.0.115. This seems to be a DHCP assignment for the NanodeRF Card is this correct?</strong></p>
<p>GW:&nbsp; 10.0.0.138<br />
	DNS: 8.8.8.8<br />
	Data sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:1}</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:31,power2:0,power3:0,voltage:3293}<br />
	emonGLCD temp recv: 1950</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:32,power2:0,power3:0,voltage:3293,temperature:19.50}</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:31,power2:2,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:32,power2:0,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:32,power2:0,power3:0,voltage:3293}<br />
	Time request sent</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:36,power2:3,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:31,power2:0,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:33,power2:0,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:32,power2:0,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /wamp/www/emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:32,power2:0,power3:0,voltage:3293}</p>
<p>
	<strong>The Whole process then repeats and my Red LED Flashes at this point</strong><br />
	[webClient]<br />
	DHCP status: 1<br />
	IP:&nbsp; 10.0.0.99<br />
	GW:&nbsp; 10.0.0.138<br />
	DNS: 8.8.8.8</p>
<p>
	Note I have temporarily turned off my firewall and I can get to my local Emoncms server from a different PC on my network by entering 10.0.0.115/emoncms in a browser<br />
	If I click<br />
	<a href="http://localhost/emoncms-master/input/post.json?node=1&amp;csv=100,200,300" title="http://localhost/emoncms-master/input/post.json?node=1&amp;csv=100,200,300">http://localhost/emoncms-master/input/post.json?node=1&amp;csv=100,200,300</a><br />
	on the Input api page I see my feeds get an update so I believe my server is functioning.<br />
	Can anyone see what I am doing wrong?</p>
<p>Cheers&nbsp;</p>
<p>Martin</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2337.html" class="topic-previous" title="Go to previous forum topic">‹ How to check</a>
              <a href="2358.html" class="topic-next" title="Go to next forum topic">RESOLVED - emonGLCD breakout pins? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-12027"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help Needed getting NodeRF  & Emoncms Talking</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 11/05/2013 - 11:25.</div>
    <div class="content">
     <p>You have a wrong directory setting. What you want is the directory as seen from the web side, not the machine side, viz</p>
<p>char basedir[] = &quot;emoncms/&quot;;</p>
<p>(and there should be no space before the &#39;/&#39;)</p>
<p>I&#39;ve found the safest is to instruct your router to use a static IP address for the NanodeRF, and use that rather than allowing DHCP to assign one.</p>
<p>Other than that, it all looks OK. (Unless I&#39;ve missed something).</p>
<p>The red LED is turned on when the data is sent out, and turned off when emoncms replies &quot;ok&quot;. So even if the data is getting through, the reply still needs to get back, or the LED stays on and eventually the timeout resets everything, which is what is happening at the moment.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12052"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Martin&#039;s picture" title="Martin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Help Needed getting NodeRF  & Emoncms Talking</h3>

    <div class="submitted">Submitted by Martin (not verified) on Sun, 12/05/2013 - 00:42.</div>
    <div class="content">
     <p>Thanks Robert.</p>
<p>I have corrected my directory setting and now seem to be getting&nbsp;Time Updates to my EmonGLCD however my local EmonCMS still cant pick up the data being sent.</p>
<p>I have configured my router to allocate the same IP&nbsp;for the NanodeRF now so it should no longer&nbsp;be DNS assigned.</p>
<p>I can manually send input data from a different pc to my server which is seen by my current EmonCMS setup.</p>
<p>I notice that if I send</p>
<p><a href="http://localhost/emoncms/input/post.json?node=1&amp;csv=100,200,300" title="http://localhost/emoncms/input/post.json?node=1&amp;csv=100,200,300">http://localhost/emoncms/input/post.json?node=1&amp;csv=100,200,300</a> the data gets through.&nbsp;</p>
<p>If I try any of the other example JSON post data commands my server responds with ok but the data does not arrive on the feed page.</p>
<p>Do you have any other thoughts as to where my problem may lie?</p>
<p>Thanks again</p>
<p>Martin</p>
<p>&nbsp;</p>
<p><strong>My adjusted settings</strong></p>
<p>// ethernet interface mac address, must be unique on the LAN<br />
	static byte mymac[] = { 0x42,0x31,0x42,0x21,0x30,0x31 };</p>
<p>// 1) Set this to the domain name of your hosted emoncms - leave blank if posting to IP address<br />
	char website[] PROGMEM = &quot;&quot;;</p>
<p>// or if your posting to a static IP server:<br />
	static byte hisip[] = { 10,0,0,115 };</p>
<p>// change to true if you would like the sketch to use hisip<br />
	boolean use_hisip = true;&nbsp;</p>
<p>// 2) If your emoncms install is in a subdirectory add details here i.e &quot;/emoncms3&quot;<br />
	char basedir[] =<strong> &quot;/emoncms&quot;;</strong></p>
<p>// 3) Set to your account write apikey</p>
<p>char apikey[] = &quot;46c34bc2833697e8d856175f7be36f3e&quot;;&nbsp;</p>
<p><strong>My Current Serial Output</strong></p>
<p>[webClient]<br />
	DHCP status: 1<br />
	IP:&nbsp; 10.0.0.106<br />
	GW:&nbsp; 10.0.0.138<br />
	DNS:8.8.8.8<br />
	Data sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json=<strong>{rf_fail:1}</strong></p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:178,power2:6,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:166,power2:4,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:175,power2:6,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:164,power2:6,power3:0,voltage:3293}<br />
	emonGLCD temp recv: 1712</p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:173,power2:7,power3:0,voltage:3293,temperature:17.12}<br />
	Time request sent<br />
	<strong>Time: t09,54,58 &nbsp;//This Now Works</strong></p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:166,power2:9,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:173,power2:4,power3:0,voltage:3293}</p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:167,power2:9,power3:2,voltage:3293}</p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:175,power2:3,power3:0,voltage:3293}<br />
	emonGLCD temp recv: 1712</p>
<p>emonTx data rxData sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json={rf_fail:0,power1:167,power2:3,power3:0,voltage:3293,temperature:17.12}</p>
<p>[webClient]<br />
	DHCP status: 1<br />
	IP:&nbsp; 10.0.0.106<br />
	GW:&nbsp; 10.0.0.138<br />
	DNS: 8.8.8.8<br />
	Data sent: /emoncms/api/post.json?apikey=46c34bc2833697e8d856175f7be36f3e&amp;json=<strong>{rf_fail:1} //Still getting a fail here.</strong><br />
	&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12065"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help Needed getting NodeRF  & Emoncms Talking</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 12/05/2013 - 12:50.</div>
    <div class="content">
     <p>That is your <strong>read &amp; write</strong> apikey, not the read-only one? (because if you&#39;re getting the time back, the time request is getting through but that responds to either apikey).</p>
<p>What do you have on the Input page? The inputs should pop up there automatically and it&#39;s from there you send them on to the Feeds page.</p>
<p>[EDIT]</p>
<p>Argh!&nbsp; I missed that one: Your syntax is wrong. The new emonCMS only responds to</p>
<p class="rteindent1">/emoncms/<strong>input</strong>/post.json......</p>
<p>.... api/post .... was OK for the old version. (I&#39;ll flag that to G&amp;T - you got your example from Github, didn&#39;t you! The example on the emonCMS API help page is correct.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12085"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Martin&#039;s picture" title="Martin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Help Needed getting NodeRF  & Emoncms Talking</h3>

    <div class="submitted">Submitted by Martin (not verified) on Sun, 12/05/2013 - 23:09.</div>
    <div class="content">
     <p>Excellent! Thanks Robert I did indeed grab my files from Git Hub. Is there a better place to grab them from?</p>
<p>I now have&nbsp;NanodeRF_Power_RTCrelay_GLCDtemp working. I have (as you spotted) &nbsp;replaced the term api with input in</p>
<p>line 195</p>
<p>str.print(basedir); str.print(&quot;/<strong>input</strong>/post.json?&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //*************&nbsp; removed api and replaced with local</p>
<p>and Line 225</p>
<p>str.print(basedir); str.print(&quot;/<strong>input</strong>/post.json?&quot;);</p>
<p>I left my api key as the Read/Write version as the Read only version did not allow posts to my server.</p>
<p>My server is now happily logging data. I really appreciate your help,&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12087"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help Needed getting NodeRF  & Emoncms Talking</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 12/05/2013 - 23:32.</div>
    <div class="content">
     <p><em>&quot;I did indeed grab my files from Git Hub. Is there a better place to grab them from?</em>&quot; No, that&#39;s the only place for a complete sketch. The new emonCMS was only recently released, and the Github examples hadn&#39;t been updated. I&#39;ve emailed Glyn &amp; Trystan so they should be on the case soon.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2366"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-GGG4Icdu40Ff0e3fqjg5-SVoV95jL9Rkk9CO2ai1gWM" value="form-GGG4Icdu40Ff0e3fqjg5-SVoV95jL9Rkk9CO2ai1gWM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/2366 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:39:09 GMT -->
</html>
