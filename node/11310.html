<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11310 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:54:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Reading from Raspberry Pi port | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Reading from Raspberry Pi port</h3>
        <span class="submitted">Submitted by <a href="../user/8272.html" title="View user profile.">chuayq</a> on Mon, 28/09/2015 - 08:39</span>
        <div class="content"><p>I have written a python script to get the data from emonTx v3 but I am getting weird symbols instead. I have posted my script below</p>
<div>#!/usr/bin/env python</div>
<div>import time</div>
<div>import serial</div>
<div>ser = serial.Serial(</div>
<div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = &#39;/dev/ttyAMA0&#39;,</div>
<div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; baudrate = 9600,</div>
<div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; parity=serial.PARITY_NONE,</div>
<div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stopbits=serial.STOPBITS_ONE,</div>
<div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bytesize=serial.EIGHTBITS,</div>
<div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;timeout=3,</div>
<div>)</div>
<div>ser.open()</div>
<div>response = ser.readlines()</div>
<div>ser.close()</div>
<div>print response</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><strong><u>Some of the data I received</u></strong></div>
<div>[&#39;!!!!!\x86\84a\x04\xff&#39;]</div>
<div>[&#39;!!!!!\x84\84a\x04\xff&#39;]</div>
<div>[&#39;!!!\xa1!!%!5\xd5&#39;]</div>
<div>&nbsp;</div>
  <div class="forum-topic-navigation clear-block">
          <a href="11332.html" class="topic-previous" title="Go to previous forum topic">‹ Possible to change feed engine interval on emoncms.org?</a>
              <a href="11088.html" class="topic-next" title="Go to next forum topic">Events module and emoncms compatability ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-34595"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8272.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chuayq&#039;s picture" title="chuayq&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/8272.html" title="View user profile.">chuayq</a> on Wed, 30/09/2015 - 10:06.</div>
    <div class="content">
     <p>Anybody know where I did wrong?</p>
<p>If only I can understand how emonhub works, I just started learning Python 2 week ago because of this. Haha. I know that emonhub&nbsp;is in the background&nbsp;receiving, parsing, processing, buffering and forwarding the data to emoncms. But I am afraid the process is too complicated for me to understanding at this moment. So I can&#39;t hitch hike emonhub and get the output from there. So if someone could point me in some direction which (function/method) to focus on then it would be great.</p>
<p>Since I have no idea on that, I proceed to read the port myself but it seems that it is not so straight forward.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34597"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 30/09/2015 - 10:31.</div>
    <div class="content">
     <p>I don't know Python at all, but there are very many tutorials available that should point you in the right direction. Try searching for "python read from serial port example". It might be more helpful if you include in your search the platform that you're working on. </p>
<p>I've programmed in many languages and variants of languages, a few points to think about:<br />
Are you trying to read characters one by one or complete lines?<br />
Are you trying to interpret what comes in, or so you just want to see the ASCII code values?<br />
What happens to your script if no data is available - will it wait forever or fail?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34608"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 30/09/2015 - 19:29.</div>
    <div class="content">
     <p><em>&quot;So if someone could point me in some direction which (function/method) to focus on then it would be great.&quot;</em></p>
<p>What is it that you wish to do ?&nbsp;</p>
<p>there is a small serial logging script written for debugging on the <a href="11062.html#comment-33163">&quot;emonTH Unreliable reading timing?&quot;</a>&nbsp;thread that may help as it is &quot;just&quot; a basic serial reader.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34616"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8272.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chuayq&#039;s picture" title="chuayq&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/8272.html" title="View user profile.">chuayq</a> on Thu, 01/10/2015 - 01:40.</div>
    <div class="content">
     <p>@Robert Wall</p>
<p>Me too! I am not well verse in Python, I only know C++ and C# well. Which is why I did search for examples and got the above script and edited a&nbsp;little to suits my need.</p>
<p>To answer your questions:</p>
<p>I want to read everything that is passed from the emonTx V3 to the raspberry, I believe the readlines() does that,&nbsp;I will filter out the unwanted stuff after I can get the correct reading. One step at a time.</p>
<p>I have included a Timeout at 3secs, so it will not wait forever for the data, if there is no data then my script will read nothing and still stop.&nbsp;I will use write another crontab&nbsp;ftp script to send the data into my server hosted in my laptop.</p>
<p>&nbsp;</p>
<p>@Paul</p>
<p>What I wish to do now is to get everything that is passed into the raspberry. Either by</p>
<ol>
<li>Reading from the serial port(which is what I am trying to do&nbsp;now but not really getting what I want)</li>
<li>Using emontx to do all the parsing and stuff for me and pass the Power readings from the CT into my own database.&nbsp;</li>
</ol>
<p>Both of the above option are not so great for me as I am not well verse in Python, I tried opening up emonhub to read but there are so many files I have no idea where to starts. Which function is the last step where it pass the data into emoncms. Knowing that particular function, I might be able to add in additional functions and pass that data into my own database(so I don&#39;t have to use emoncms).&nbsp;</p>
<p>After I got the above working, I will send those data using a&nbsp;crontab ftp script and send those data into my own server hosted in my laptop. But one step at a time, so I need to get the above working first, before&nbsp;I can proceed this ftp script.</p>
<p>&nbsp;</p>
<p>Thanks for all your help! :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34618"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 01/10/2015 - 05:02.</div>
    <div class="content">
     <p>Any particular reason you want to write it in python? &nbsp;Another option to consider is to just write your program (in the language of your choice) to read from stdin. &nbsp; You can then use stty to configure the serial port as you want it, and when you run your program, simply tell it to read its stdin from the serial port of your choice with something like:</p>
<p>my_prog &lt;&nbsp;&nbsp;/dev/ttyAMA0</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34632"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 01/10/2015 - 22:47.</div>
    <div class="content">
     <p>I would love to help you further but cannot fathom out what you are after, it&#39;s clear emoncms and emonhub&nbsp;are not doing what you want but beyond that it&#39;s really quite vague what you do want, I have read your various other threads and they all seem follow a common&nbsp;theme but I&#39;m still none&nbsp;the wiser.&nbsp;</p>
<p>You want to read the serial port -&nbsp;emonhub does that and&nbsp;you want to save data to a remote sql database -&nbsp;emoncms can do that. but apparently you do not want either of these softwares, If you want to write your own versions you should, as dBC suggests, do it in a language you do know or if you want emonhub/emoncms to &quot;do something else&quot; you need to explain what that is.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34639"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8272.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chuayq&#039;s picture" title="chuayq&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/8272.html" title="View user profile.">chuayq</a> on Fri, 02/10/2015 - 06:51.</div>
    <div class="content">
     <p>@dBC</p>
<p>Reason being I did not know I can write it in another language! Haha, I always thought raspberry pi run in linux so it can only run Python.</p>
<p>&nbsp;</p>
<p>@Paul</p>
<p>For the current system I did now,the data is send from emonTx &gt;&gt; Raspberry(emonhub) &gt;&gt; Emoncms(Remote)&nbsp;</p>
<p>For the current system that I know I can now do,&nbsp;the data is send from&nbsp;emonTx&nbsp;&gt;&gt; Raspberry(emonhub) &gt;&gt;&nbsp;Emoncms(Remote)&nbsp;&gt;&gt; my own MQSQL/MYSQL</p>
<p>For the system I want to develop, the data is send from emonTx &gt;&gt; Raspberry(Any &quot;platform&quot;) &nbsp;&gt;&gt; my own&nbsp;MQSQL/MYSQL.&nbsp;</p>
<p>&nbsp;</p>
<p>This save me a step of using emoncms(don&#39;t really like that apikey thing). And if I can get the data into my own SQL table, I can do analysis using&nbsp;matlab.&nbsp;</p>
<p>Actually, what I want is rather simple. A table with 5 columns.&nbsp;Timestamp, value of CT1, value&nbsp;of CT2, value&nbsp;of CT3, value&nbsp;of CT4.&nbsp;As long as I can get those values in a table in my own database that&#39;s good enough for me. :)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34642"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8272.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chuayq&#039;s picture" title="chuayq&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/8272.html" title="View user profile.">chuayq</a> on Fri, 02/10/2015 - 09:18.</div>
    <div class="content">
     <p>I think I have a better way to explain myself. In emoncms, there is a function to export into csv(under Feed). What I want is exactly like that. The first column is the timestamp, the second is the value. All these values to be inserted into my own database.</p>
<p>I believe this is exactly what is happening behind emoncms. The timestamp and the CT values. If I got a way to get these data, it will be awesome!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34646"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 02/10/2015 - 12:23.</div>
    <div class="content">
     <p><i>"I did not know I can write it in another language! Haha, I always thought raspberry pi run in linux so it can only run Python."</i></p>
<p>You can use any language you like, provided that you have a compiler, linker and libraries that will produce executable code for the processor and operating system in your machine. That is true for any computer, not just your RPi.</p>
<p>See <a href="http://www.dummies.com/how-to/content/top-10-programming-languages-ported-to-the-raspber.html" title="http://www.dummies.com/how-to/content/top-10-programming-languages-ported-to-the-raspber.html">http://www.dummies.com/how-to/content/top-10-programming-languages-porte...</a></p>
<p>Do not confuse the operating system (Linux) with the language you use to program in. There is nothing to directly link the two.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34656"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 02/10/2015 - 21:52.</div>
    <div class="content">
     <p>If you choose to write something from scratch to do this then many of the points raised by Robert with regard reading the serial port will also need considering when forwarding the data across a network, like what happens if there is no network or target found? Timeouts and retries etc. Will you just send the data and move on to the next or will you act on a confirmation of some sort?</p>
<p>You could write something to actually access the remote SQL server directly or you could use a middle man, you mentioned the csv from emonCMS, that is basically a text file, How did you plan on passing the csv files to your SQL tables?</p>
<p>If csv is acceptable you could put together a csv/text reporter for emonhub, that way emonhub is handling the serial read and parsing, buffering the data and/or saving as a text file locally (or remotely?. There have been csv reporters written in the past, see &quot;<a href="11087.html">How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org</a>?&quot; or&nbsp;&quot;<a href="10093.html">Emonhub Write to local sqlite database rather than post to web-target&quot;</a>&nbsp;for a couple of examples.&nbsp;</p>
<p>There are many many different ways you could tackle this I guess.</p>
<p>Paul&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34696"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8272.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chuayq&#039;s picture" title="chuayq&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading from Raspberry Pi port</h3>

    <div class="submitted">Submitted by <a href="../user/8272.html" title="View user profile.">chuayq</a> on Mon, 05/10/2015 - 02:04.</div>
    <div class="content">
     <p>@Robert Wall</p>
<p>Thanks! It&#39;s dumb for me not to know that. That&#39;s good knowledge I have learnt today :)</p>
<p>@Paul</p>
<p>Thanks for the link, I guess I will just use emonhub to write the csv file. Will saved me the work since most functions are already written. (Reading the links now)</p>
<p>As for the passing of csv into SQL table, I have done it before in the past. It uses FTP, goes into a certain directory, recursively looping through all the folders and retrieve the entire directory&#39;s CSV files. Basically, it retrieve, transfer, insert, backup, delete.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11310"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-hQeM9z0Smk7ydOvGXk01JqwKdgNUBsJkG_5cxMPUrgA" value="form-hQeM9z0Smk7ydOvGXk01JqwKdgNUBsJkG_5cxMPUrgA"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/11310 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:54:39 GMT -->
</html>
