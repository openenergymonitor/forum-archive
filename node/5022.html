<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5022 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:42:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Gas monitoring | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Gas monitoring</h3>
        <span class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Thu, 17/04/2014 - 21:14</span>
        <div class="content"><p>My gas meter has an rj11 socket and a reed switch connected&nbsp;across 2 of the wires.</p>
<p>I would like to monitor my usage.</p>
<p>I am aware that it is naughty to connect to it.</p>
<p>Have searched&nbsp;the forums . There is a lot of info spread about all over the place but it is not clear to a numpty like me.</p>
<p>What hardware do I need to connect it to? Does the firmware contain script to decode the signal?</p>
<p>Can anybody point me in the right direction?</p>
<p>Thanks in advance for any&nbsp;help.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="4352.html" class="topic-previous" title="Go to previous forum topic">‹ Arduino uno + ethernet shield</a>
              <a href="5192.html" class="topic-next" title="Go to next forum topic">emonTxV3 - problem after uploading emonTxV3_3Phase_Voltage sketch [SOLVED] ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-20835"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 17/04/2014 - 23:16.</div>
    <div class="content">
     <p>Try looking at Building Blocks - that&#39;s where the theory and example designs tend to be.</p>
<p>The probability is that you&#39;ll connect it to &quot;something&quot; that detects switch closures. What do you want to do then? The classic way is:</p>
<p class="rteindent1">Switch =&gt; emonTx V3 =&gt; (radio link) =&gt; EmonBase (Rasperry Pi) =&gt; (Ethernet) =&gt; Your router =&gt; emoncms.org</p>
<p>which implies you have all that hardware. You can substitute a local hard disk atttached to the RPi instead of the web connection to emoncms.org, and in that case you&#39;ll run emoncms on your RPi. You can also substitute a wired link for the radio link, provided the two are close.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20850"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Fri, 18/04/2014 - 19:33.</div>
    <div class="content">
     <p>Thanks Robert</p>
<p>I already have 2 X EmonTx3&nbsp;&amp;&nbsp;RPi&nbsp;etc for monitoring electricity&nbsp;and Solar production/export etc.</p>
<p>I am not 100% clear on whether the required code is already in the EmonTx3 firmware or if I have to add it.</p>
<p>(I am sure some modification will&nbsp;be necessary though.) and also which pins to wire to?</p>
<p>I think a further battery powered emon Tx3&nbsp;would be best in order to reduce the possibility of sparks??</p>
<p>although hard wiring to an existing mains powered one would be a cheaper option.</p>
<p>I have used arduino and github to alter node id&#39;s and to update firmare but I am not very confident with it.</p>
<p>Just looking for an idiots guide really. Most of the stuff I have found assumes more knowledge than I have unfortunately.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 19/04/2014 - 01:17.</div>
    <div class="content">
     <p>First, nothing here is intrinsically safe, so you must not have anything switching that might generate a spark in a gaseous atmosphere. However, there are no open contacts anywhere (not counting the plugs and sockets) nor should there be any gas escaping. So I don&#39;t think there is any cause for concern.&nbsp;</p>
<p>You will need to add to the software in the emonTx V3, the default sketch only does electrical energy. The semi-idiots guide is&nbsp; in Building Blocks <a href="https://learn.openenergymonitor.org/?redirect=introduction-to-pulse-counting.%c2%a0" title="http://openenergymonitor.org/emon/buildingblocks/introduction-to-pulse-counting. ">http://openenergymonitor.org/emon/buildingblocks/introduction-to-pulse-c...</a> Input Dig 2 is conveniently available on a screw terminal block, together with a supply connection for 3.3 V, and it already has a pull-down resistor fitted.</p>
<p>Provided your meter pulses are fairly long (and they will be), and you&#39;re not measuring electrical energy with emonLib, you don&#39;t need the interrupt code and you can simply &#39;poll&#39; the input to look for it changing state. &quot;Polling&quot; means you put the code to check the input state &quot;digitalRead(2)&quot; inside the main loop and check it each time round the loop.</p>
<p>If you are doing current and voltage measurements as well, then you&#39;ll need to use the &#39;interrupt-driven&#39; method (two pages also in Building Blocks).</p>
<p>All mechanical switches have a habit of bouncing as the contacts make and break, so if you&#39;re not careful you end up with many pulses were you really only have one. There are two ways to deal with this. In hardware, you can add a small capacitor from the input to ground, which acts as an integrator; Or you can do it in software, either with a software integrator or by waiting for the input to remain in the same state for a certain length of time before you recognise it as a pulse. There&#39;s no switch debouncing in the BB code.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20865"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Sat, 19/04/2014 - 12:20.</div>
    <div class="content">
     <p>Hi,</p>
<p>I have been monitoring my gas meter for several weeks with success. It works fine as my Emontx reports the exact index given by my meter. I&#39;m using a software method to debounce the signal coming from the mechanical switch of my gas meter. More info here : <a href="3954.html" title="http://openenergymonitor.org/emon/node/3954">http://openenergymonitor.org/emon/node/3954</a></p>
<p>I&#39;m planning to use a RC circuit to debounce the signal using a hardware method because my software method monopolizes one of my Emontx ... It should work with a 10k resistor and a 0.1 mF capacitor. (T=RC=1s)</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20866"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 19/04/2014 - 14:02.</div>
    <div class="content">
     <p>Eric - thanks for reminding me. I <em>knew</em> I&#39;d seen a post about this recently.</p>
<p>But the time constant is 1 ms, not 1 s. I would have thought that a somewhat larger capacitor might be needed, but that depends on the properties of the reed switch. It might be a good idea to feed the reed switch through a small (say 470 &Omega;) resistor to limit the inrush current into the capacitor - that will reduce the disturbance on the power supply and it might prolong the life of the reed switch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20885"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sun, 20/04/2014 - 08:05.</div>
    <div class="content">
     <p>So forgive my ignorance. Are you saying that I need another Emontx3 to run this code or can it be added to one of my existing units? I have seen these various files in the Arduino sketches for the Emontx but have no idea really what each of them does. So I am not sure if I am using Emonlib or not. I just have the std as delivered fully built units. All I have done is to upgrade firmware and change Node id&#39;s</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20891"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 20/04/2014 - 12:05.</div>
    <div class="content">
     <p>You should not need another emonTx, but you will need the interrupt-driven technique and you&#39;ll also need to learn how the sketches work so that you can merge them into one. And yes, you will be using emonLib - the default emonTx V3 sketch does use it.</p>
<p>The sketch that Eric published on 1/3/2014 does not use interrupts and for that you would need a separate emonTx.</p>
<p>The sketches you&#39;d need to merge are the default one <a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling" title="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3...</a> and the pulse example <a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/Examples/emonTx_V3_Pulse" title="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/Examples/emonTx_V3_Pulse">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3...</a> . If you&#39;re up to learning about the sketches and how they work, the Building Blocks section is where you&#39;ll find most if not all of the information you need. (But bear in mind most of that was written pre-emonTx V3, so pin numbers etc will be different. though the principles are unchanged.) If you&#39;re not confident that you can get it working, let me know and I&#39;ll try to find time to do a merge and test it, but I can&#39;t promise when that might be.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20897"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sun, 20/04/2014 - 14:49.</div>
    <div class="content">
     <p>I&#39;ll have a look and see if I can work it out!</p>
<p>I may however need further help. Thanks for offering to do the merge. I may yet have to take you up on it!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20900"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sun, 20/04/2014 - 15:40.</div>
    <div class="content">
     <p>SO In my Arduino libraries I have found a file called Emon_tx3_Pulse in the examples folder which is in the EmonTxfirmware/Emontx3/rfm12b/ folder.</p>
<p>Can&#39;t yet&nbsp;see how to or where to merge it though!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20919"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 20/04/2014 - 21:56.</div>
    <div class="content">
     <p>When we say &quot;merge&quot;.... it isn&#39;t an automatic, or even semi-automatic, operation. What you have to do is look to see what each line does, whether you want it in the merged sketch, and if you do, copy it across into a suitable place. But sometimes, you&#39;ll find an almost equivalent line and you&#39;ll have to make it one - I&#39;m thinking in particular about the Payload structure.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20923"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Mon, 21/04/2014 - 06:43.</div>
    <div class="content">
     <p>Thanks Robert. I had figured that much but I am pretty sure that I will mess this up! If you can find the time to have a look at it I would be most grateful</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20985"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 23/04/2014 - 14:54.</div>
    <div class="content">
     <p>Here is my merge of the example Pulse sketch into the default Discrete Sampling sketch. I&#39;ve added a contact debounce feature, the timer will need tweaking according to how good or how bad your reed switch is. I found I needed 0.5 s for a bit of tinned copper wire dabbed onto the screw terminal, but in most cases a much smaller time will be needed.</p>
<p>The usual disclaimer: it seems to work for me. Although I have not tested it for accuracy, I don&#39;t anticipate a problem, particularly if you comment out the line that calculates the power between pulses. This isn&#39;t very useful anyway, as that sum is better done in emoncms, and it does depend on the calorific value of your gas as well as the gas volume per pulse.</p>
<p>[Edit: It is impossible to satisfactorily debounce the input in software when it drives the interrupt. It can only be done in hardware. Therefore, I&#39;ve taken out the faulty code that attempted to debounce the switch.]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20986"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Wed, 23/04/2014 - 16:34.</div>
    <div class="content">
     <p>Thanks Robert!</p>
<p>So I just look at the existing sketch and insert your code in the same place?</p>
<p>My Meter appears just to have a reed switch ie 2 wires that short at each rotation of the dial. Am I to connect 1 wire to the interrupt pin and one to 3.3v ? or to Gnd?</p>
<p>I am using an AC adapter on the Emontx&nbsp;this won&#39;t cause it a problem will it?</p>
<p>The wire will need to be pretty long to reach to my emon tx could this present any problems? approx 20m!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20987"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 23/04/2014 - 17:53.</div>
    <div class="content">
     <p>You load the sketch as you do any other. You can have only one sketch in the emonTx at any one time.</p>
<p>The connection instructions are in a comment in the sketch. I don&#39;t see that the ac adapter will affect the operation at all - I tested with that and the programmer supply connected [edit] and as expected it is happy also using just the ac supply[/edit]. Whether you get any pickup on 20 m of lead is debatable and depends very much on where the cable runs and how close it is to sources of interference. I suggest you use twin twisted screened cable (sold as &#39;microphone cable&#39;) using the two inner cores for the switch and earthing the screen only at the switch end.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20988"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 24/04/2014 - 00:13.</div>
    <div class="content">
     <p>Robert, I realise you were the merger, not the original author, but I think that ISR code needs some work, wherever it came from. &nbsp;Most of those variables involved should be flagged as &#39;volatile&#39; and even then this snippet is very problematic:</p>
<p>// Accumulate Pulses<br />
	emontx.pulses = pulseCount;<br />
	pulseCount=0;</p>
<p>There&#39;s the obvious race condition that a pulse could fire between those 2 statements, in which case it would be lost. &nbsp;But on an 8-bit micro the problem is even worse. &nbsp;Neither of those C statements are atomic even within themselves. &nbsp;So if &nbsp;the ISR fires halfway through shuffling bytes to satisfy this assignment:</p>
<p>emontx.pulses = pulseCount;</p>
<p>and that ISR increment involved a carry from one byte to the next, you&#39;ll get inconsistent results.</p>
<p>I suspect it&#39;s mostly working so far because pulseCount&nbsp;never gets bigger than 255, helped also by the debounce logic.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20989"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Thu, 24/04/2014 - 08:42.</div>
    <div class="content">
     <p>I now have a better grasp of what&#39;s going on having read some Arduino tutorials. Thank you Robert for your help and patience.</p>
<p>dBC. I think that there are a good few people interested in this code for reading gas/water meters etc accurately.</p>
<p>I am not able to understand the nuances of how/where errors might appear but I am blessed with plenty of time to experiment with new/modified code if people are prepared to make suggestions and my understanding&nbsp;will improve in leaps I hope!</p>
<p>Any suggestions welcome!</p>
<p>I have some issues installing what is going to be a long cable run but as long as it works I will get up and running asap</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20990"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 24/04/2014 - 08:46.</div>
    <div class="content">
     <p>I agree. The general wisdom is that bouncy switch inputs should not go straight into interrupts in the first place, but should be polled. Also, the debounce - which I threw in quickly without too much thought - has a fault in the algorithm that means it counts double if the switch stays closed for longer than the debounce time. By far the safest is a hardware debounce. I&#39;d also spotted that pulseCount was not declared volatile, there&#39;s floating point maths in the ISR, and interrupts need to be turned off to protect that race condition. You&#39;ll find the Pulse example on GitHub, and it certainly needs proper development.</p>
<p>I dunno, I hurry to try to help someone who on their own admission isn&#39;t sure of what they&#39;re doing, and I get hung for it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20991"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Thu, 24/04/2014 - 09:11.</div>
    <div class="content">
     <p>I think that its all to easy when writing instead of speaking to appear somewhat harsh when its not meant at all. I think that it is great that this stuff is &quot;open&quot; and people with knowledge and skill can bounce ideas off each other leading to better and faster development.</p>
<p>I am going to investigate a hardware debounce system!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20993"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 24/04/2014 - 09:36.</div>
    <div class="content">
     <p>Robert, I certainly didn&#39;t mean it as a hanging, apologies if it came across that way.</p>
<p>webby, it&#39;s probably a bit of an overkill for your application but I&#39;ve had a lot of joy with the MAX6818 device. &nbsp;I need to count 8 pulse inputs, and it does all the debouncing in h/w, &nbsp;throws in ESD protection, and gives me a nice interrupt when something has changed. &nbsp;As I have 8 GPIO pins available, &nbsp;it gives me all the events with a single cycle PORT read (done in the ISR). &nbsp;I think Maxim might have some &quot;narrower&quot; devices, i.e. less than 8-bits wide, but I&#39;ve not explored them.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20995"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Thu, 24/04/2014 - 12:51.</div>
    <div class="content">
     <p>Hi,</p>
<p>Robert&#39;s sketch can not work fine with my gas meter because it will create fake pulses. Actually, the signal coming from the reed switch is too noisy. Sometimes, its state changes twice very quickly (few microsec) without any gas consumption. (electronic interference ? magnetic weakness ? instability of the Vcc ?).</p>
<p>I didn&#39;t manage to filter those fake pulses using interrupts because some of my ISRs are ignored. In fact, those fake pulse seems to be too short to be filtered in software. Anyway, I agree it is better and safer to filter the signal in hardware.</p>
<p>Attached is the RC circuit I am planning to use to filter the signal. It should work with a 10k resistor and a 0.1 mF capacitor. According to me, the time constant (10<sup>4 </sup>* 10<sup>-4</sup> = 1 s) is fine as my reed switch operates slowly (not faster than every 6 seconds).</p>
<p>Robert, I don&#39;t understand why you told me that &quot;the time constant is 1 ms, not 1 s&quot;. Is my calculation wrong ? (or yours ?) Do you mean I need a 1 ms time constant instead of a 1 s time constant ? It is not clear for me.</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20996"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 24/04/2014 - 15:57.</div>
    <div class="content">
     <p>Eric: I think you are misunderstanding the markings on your capacitor.&nbsp; 50 years ago, capacitors were marked mF when they actually meant &micro;F. As far as I know, that has not been the case for a very very long time now. If it was genuinely 0.1 mF, and manufactured within the last 40 years approximately, it would be marked 100 &micro;F.&nbsp; If you have that, when your reed switch closes, you will have a huge inrush of current (with your original circuit) that would cause the power supply to dip - and there is a possibility that it will burn or weld the reed switch contacts too. With today&#39;s circuit, the inrush is limited, of course. I think you have 0.1 &micro;F (10<sup>-7</sup> F).</p>
<p>The time constant you need will depend on the mechanical properties of the switch - at what frequency it bounces, and that depends on the strength of the springs and of the magnet, and the weight of the moving parts. I would start with a time constant of a few tens of ms and see how it performs - 1 s I think is safe but excessive,</p>
<p>I recommend your hardware solution to Webby (in place of the software one!), but I would change the external 10 k resistor to say 1 k (to assure the &#39;high&#39; input is adequately high) and choose a capacitor to give a TC of say 100 ms at most.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20998"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Thu, 24/04/2014 - 18:37.</div>
    <div class="content">
     <p>So a maxim 6816 is a single debouncer available at RS. However I think that it is v small and still needs a 0.1 mcrofarad capacitor so I guess a v small circuit board is required to be made with some pins to stick straight into the connectors on the Emontx3 and a connector block for the reed switch. Can this be done on breadboard from Maplins?</p>
<p>Serious question as although I am an electrician and quite handy with a soldering iron. I have never done anything like this before!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21000"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Thu, 24/04/2014 - 19:32.</div>
    <div class="content">
     <p>In fact, I do no have any capacitor yet. I will buy the appropriate one later.</p>
<p>Here are the specifications of my reed switch:</p>
<p>- max current : 5 mA</p>
<p>- max voltage : 6V</p>
<p>- max bounce time : 1 ms</p>
<p>- initial contact resistance : 0.5 ohm</p>
<p>- insulation resistance : 500 Mohm</p>
<p>&nbsp;</p>
<p>So I need a least an 1 k external resistor (5V/0.005A). Am I right ?</p>
<p>&nbsp;</p>
<p>Another point, I do not understand when you say &quot;when your reed switch closes, you will have a huge inrush of current&quot;. Could you please give more details ?</p>
<p>&nbsp;</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21003"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 24/04/2014 - 21:45.</div>
    <div class="content">
     <p>webby, if you decide to go that Maxim route, there are plenty of SOP to SIP adaptors available that might help with your breadboarding. &nbsp;Here are a few examples:</p>
<p><a href="https://code.google.com/p/opendous/wiki/MultiAdaptor">https://code.google.com/p/opendous/wiki/MultiAdaptor</a></p>
<p><a href="http://www.proto-advantage.com/store/product_info.php?products_id=2400051">http://www.proto-advantage.com/store/product_info.php?products_id=2400051</a></p>
<p>&nbsp;</p>
<p>Eric, as a further datapoint on your time constant, those Maxim de-bounce chips aim for the 15-85 msec range. &nbsp;The one I use nails the debounce pretty &nbsp;close to 40 msecs, and seems to work well. &nbsp;It does mean it can&#39;t count pulses faster than 25Hz&nbsp;but that&#39;s not typically a problem for most gas / water meters. &nbsp; One other heads-up: if anyone is using an &quot;official&quot; reed switch supplied by the meter manufacturer, they often have an in-built series resistor to protect against over-current. &nbsp;From memory, the one in my Elster T-probe (water meter) was a few hundred ohms, so probably not big enough to make a huge difference to your time constant calculation.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21004"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 24/04/2014 - 22:56.</div>
    <div class="content">
     <p>My feeling is the debounce IC is overkill in this application. I suggest trying Eric&#39;s one resistor, 1 capacitor solution first as it&#39;s probably the easiest to put together and certainly the cheapest.</p>
<p>Eric:</p>
<p>Your 1 k&Omega; resistor is correct. Without it, because the capacitor can be completely discharged at the instant the switch closes, the current will be limited by the combined impedance of the power supply rail, the switch contact resistance, the series resistance of the capacitor and the wiring resistance, including the PCB tracks. The current could easily exceed the 5 mA maximum of the switch.</p>
<p>[I once welded back together the filament of a car headlight bulb: it had broken but by holding the bulb at the correct angle and tapping, the ends could be made to touch. So I soldered a photoflash capacitor to the bulb and charged it to about 200 V, held the bulb the correct way and tapped it. There was a big blue flash and the filament was repaired. Without the current limiting resistor, the same could happen to your reed switch. But in your case it would be destroyed, not repaired.]</p>
<p>If you have a 0.1 &micro;F capacitor, the time constant of the rising edge of the pulse is the Th&eacute;venin equivalent of what is effectively a potential divider, the 1 k&Omega; and the 10 k&Omega;, which is 909 &Omega;, and 0.1 &micro;F, so 90.9 &micro;s.&nbsp; The time constant of the falling edge of the pulse is the 10 k&Omega; only and 0.1 &micro;F, so 1 ms. I suggest you aim for a 5-6 ms time constant for the falling edge, which will not allow the voltage to fall far enough in 1 ms to cross from the high input voltage threshold to the low, so 0.47 &micro;F - 0.68 &micro;F should be fine.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21014"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Fri, 25/04/2014 - 08:00.</div>
    <div class="content">
     <p>I agree. Having researched size etc Eric&#39;s solution is the way to go.</p>
<p>So I need a 1kohm&nbsp;resistor a 0.5 microfarad capacitor and some way to make the circuit?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21020"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 25/04/2014 - 12:06.</div>
    <div class="content">
     <p>I would advise a small piece of stripboard with a two-way screw terminal block on one end for the wires out to the switch, and three soldered wires (you can use terminal pins to solder the wires on to, but they&#39;re not necessary) at the other end to go into the emonTx screw terminals.&nbsp;</p>
<p>I&#39;d go for these:</p>
<p><a href="http://spiratronics.com/pcb-terminal-block-2-way.html" title="http://spiratronics.com/pcb-terminal-block-2-way.html">http://spiratronics.com/pcb-terminal-block-2-way.html</a><br />
	<a href="http://spiratronics.com/stripboard-25-x-64-mm.html" title="http://spiratronics.com/stripboard-25-x-64-mm.html">http://spiratronics.com/stripboard-25-x-64-mm.html</a><br />
	<a href="http://spiratronics.com/terminal-pin-pack-of-25.html" title="http://spiratronics.com/terminal-pin-pack-of-25.html">http://spiratronics.com/terminal-pin-pack-of-25.html</a><br />
	<a href="http://spiratronics.com/0.25w-metal-film-resistor-1k-pack-of-10.html" title="http://spiratronics.com/0.25w-metal-film-resistor-1k-pack-of-10.html">http://spiratronics.com/0.25w-metal-film-resistor-1k-pack-of-10.html</a><br />
	<a href="http://spiratronics.com/metallised-polyester-capacitor-63v-680nf.html" title="http://spiratronics.com/metallised-polyester-capacitor-63v-680nf.html">http://spiratronics.com/metallised-polyester-capacitor-63v-680nf.html</a></p>
<p>I presume you&#39;ve used stripboard before?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21033"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 25/04/2014 - 14:24.</div>
    <div class="content">
     <p>The perceived wisdom regarding mechanical switches, debouncing and interrupts is correct - when I stop to think about it, it is impossible to debounce in software when you are directly driving the interrupt with the input pulse. It has to be done in hardware, else you must poll the input to be able to get enough information about the contact state and the timing of the changes.</p>
<p>I&#39;ve edited the sketch I attached to the earlier post and removed the attempted software debounce solution. I&#39;ve also declared the variables properly, and shielded the pulse count accumulator reset from interrupts.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21035"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Fri, 25/04/2014 - 15:02.</div>
    <div class="content">
     <p><em>&quot;it is impossible to debounce in software when you are directly driving the interrupt with the input pulse</em>&quot;</p>
<p>It is also my feeling. I tried many various sketches using interrupt without any success ... But as you said, one can debounce in software by polling the state of the input. This is I what I have done for several weeks with<a href="3954.html"> this sketch</a>. It works perfectly (no missing pulse or fake pulse) but my code consumes a lot a resources. Actually, my Emontx can&#39; do anything else...</p>
<p>So I would like to know whether it is possible to run periodically an ISR&nbsp; ? Let say every second.</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21037"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 25/04/2014 - 16:54.</div>
    <div class="content">
     <p>I saw your sketch and I could see that it would not be possible to do energy measurement at the same time.</p>
<p>I think you would need to set up a timer interrupt, and I assume your 1 s rate is much less than the time that the switch stays in one state - therefore you can know that it has been stable for a period of time.</p>
<p>Timer interrupts are exactly how MartinR&#39;s PLL energy diverter synchronises itself to take exactly 50 readings per cycle of mains frequency (don&#39;t be confused by it changing the clock frequency as well - that is related but not what we are talking about). I think it should be possible using Timer1 and the prescaler, though there is probably no advantage in running that slowly.</p>
<p>Then I suspect you need a section of code that says &#39;if the switch was low for 3 s and then high for 3 s, you have a pulse&#39; - assuming your pulse is at least 4 s long at a frequency of less than 1/8 Hz!</p>
<p>I think it can be done - the core code can be copied from <a href="http://www.instructables.com/id/Arduino-Timer-Interrupts" title="http://www.instructables.com/id/Arduino-Timer-Interrupts">http://www.instructables.com/id/Arduino-Timer-Interrupts</a> - always assuming that you check for subtle bugs first.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21042"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Fri, 25/04/2014 - 19:42.</div>
    <div class="content">
     <p>Thanks a lot !!!&nbsp; This was the piece of code I was looking for ! Moreover, it is very well commented !</p>
<p>I would now be able to poll the state of the input every seconds without using the sleep function.</p>
<p>Next week, I will post a new sketch if it works fine.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21046"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 25/04/2014 - 21:17.</div>
    <div class="content">
     <p>Sorry, Eric, you will be too late. I&#39;ve done it and it seems to work well. Using a push button that was giving anything up to 35 counts per press with the simple GitHub pulse sketch, this seems to work reliably up to 12 pulses per second provided they have a mark:space ratio of 1:1. At lower pulse rates it works with any M:S ratio provided that either the &#39;on&#39; time or the &#39;off&#39; time exceeds 0.4 s.&nbsp; It uses Timer1 running at 10 Hz, and clocks the D2 /IRQ0 input into a char each interrupt. When the value of the char reaches 0x0F, that is 4 consecutive low bits followed by 4 consecutive high bits, it declares a rising edge and increments the pulse count.</p>
<p>I&#39;d appreciate you giving it a try. I have not tried it with temperature sensors present.</p>
<p>[A version for the emonTx V3.4 is available <a href="https://community.openenergymonitor.org/t/pulse-counting-logic-for-water-meter/1046/15">here on the new forum.</a>]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21059"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sat, 26/04/2014 - 03:31.</div>
    <div class="content">
     <p>Won&#39;t that reject a valid rising edge that is immediately preceded by a spike? &nbsp;It sounds like you only count a rising edge if it&#39;s had clear air before it. &nbsp;I guess the spike would have to happen 100msecs before the edge, so is unlikely to be switch bounce related, but it sounded like Eric also had to deal with noise spikes.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21068"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 26/04/2014 - 10:47.</div>
    <div class="content">
     <p>If you have a noise spike that lasts long enough and is in exactly the right place to be seen, remembering that the input is now polled so that it has to be &#39;high&#39; at the exact instant that the value is accessed - in the 400 ms preceding the wanted edge, so that the &quot;history&quot; is (say) 01001111, then it will indeed reject the following valid pulse. Exactly the same argument applies if you get a negative spike following the wanted edge. But if you have noise spikes like that, you need to do better with the wiring - and indeed deal with the source of the interference. By far the best way of dealing with something like that is to remove it at source, rather than try to mitigate the consequences. So after screening the input cable, maybe a hardware debounce filter will also be needed in extreme cases.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21072"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sat, 26/04/2014 - 11:46.</div>
    <div class="content">
     <p>Yes, I agree you&#39;d have to be very unlucky, and agree it&#39;s better to fix the noise at the source where possible. &nbsp;You may well have stumbled across the Airbus de-spiking algorithm. &nbsp;At least in this case if ever everything does align just right, nobody ends up in hospital.... a missed gas meter pulse every few decades will probably never get noticed.</p>
<p><em>Although the FCPC algorithm for processing AOA data was generally very effective, it could not manage a scenario where there were multiple spikes in AOA from one ADIRU that were 1.2 seconds apart. The occurrence was the only known example where this design limitation led to a pitch-down command in over 28 million flight hours on A330/A340 aircraft, and the aircraft manufacturer subsequently redesigned the AOA algorithm to prevent the same type of accident from occurring again.</em></p>
<p><a href="http://www.atsb.gov.au/publications/investigation_reports/2008/aair/ao-2008-070.aspx">http://www.atsb.gov.au/publications/investigation_reports/2008/aair/ao-2008-070.aspx</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21079"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 26/04/2014 - 16:39.</div>
    <div class="content">
     <p>I didn&#39;t know they used Arduinos in the Airbus.... Oh wait.....</p>
<p>Since my license lapsed, I haven&#39;t read any air accident reports, so I didn&#39;t know about that. But in any case, if you do have positive-going noise spikes of 0.7 V<sub>cc</sub> with a low input, or negative-going ones of (Vin - 0.2 V<sub>cc</sub> ) with a high input ( say amplitudes of roughly 2.3 V for an emonTx or 3.5 V for the Shield) then you&#39;ve got serious pickup problems. And if you&#39;ve still got them after you used screened cable and put a simple hardware filter in, there&#39;s no real hope of measuring voltage, current or anything else accurately.</p>
<p>But what do you do about it? You can speed up the clock by a factor of two, or four, and use a 16-bit or 32-bit variable as the shift register, then ignore the middle few bits where you hope the switch bounce is, examine separately the high end and the low end that remain, get the proportion of 1&#39;s and 0&#39;s in each, and make a decision on that basis. But is it worth it, especially as it&#39;s in an interrupt routine where lost time means inaccuracy in the main readings?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21089"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sat, 26/04/2014 - 21:27.</div>
    <div class="content">
     <p>I guess if you really need to run a signal down a very long cable, through a harsh environment, there are much more robust solutions than a GPIO pin with a pull-down. &nbsp;Unfortunately, they generally require logic (and power) at both ends of the link.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21091"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 26/04/2014 - 21:54.</div>
    <div class="content">
     <p>I haven&#39; thought it through, but how does this sound:</p>
<p>The reed switch has a fairly low current handling capacity (5 mA in Eric&#39;s case), and to reduce the voltage pickup, you need a low circuit impedance. So you wire the reed switch from input to ground, with a 1 k&Omega; pulldown in parallel with it, and feed it from 5 V via a 5 mA current source. When the switch is open, the input impedance is one tenth of what is would otherwise be with the standard pull-down, the current source is a high impedance so has little effect. With the switch closed, the impedance is the cable resistance (not much different, as previously the voltage supply should be a very low impedance).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21092"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sun, 27/04/2014 - 01:04.</div>
    <div class="content">
     <p>Sounds promising. &nbsp;What do you use for the 5mA current source? &nbsp;When trying to sketch a schematic of your description, I used a 1K R connected to +5V for the 5mA source, but then with the switch open, I ended up with the input &nbsp;pin connected to the midpoint of a 1K/1K divider running between +5V and GND, which I assume is not what you intended. &nbsp; If it were an analog input you could probably work with that, but I assume you want to keep your AtoDs flat out measuring power.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21093"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 27/04/2014 - 01:58.</div>
    <div class="content">
     <p>You can&#39;t use an analogue input - it takes too long to read! !&nbsp; The classic way to get a current source is with a transistor - clearly a resistor won&#39;t work as there&#39;s not enough voltage available, as you found; we need the input to go past 0.7 Vcc to be a valid &#39;high&#39;, so it might be tricky.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21174"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Fri, 02/05/2014 - 15:51.</div>
    <div class="content">
     <p>Hi,</p>
<p>Thank&#39;s Robert for writing that sketch.&nbsp; I like the way you did it with a shift register. Before trying it, i will modify the polling frequency to 1 Hz to reduce CPU usage as either the &#39;on&#39; time or the &#39;off&#39; time of my reed switch exceeds 6 s.</p>
<p>Unfortunately, I can&#39;t test it right now as I&#39;m not at home until mid-May. I will tell you later how it works.</p>
<p>Regards,</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21275"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Wed, 07/05/2014 - 22:30.</div>
    <div class="content">
     <p>Robert</p>
<p>Thank you very much for your help in all this!</p>
<p>I have now run my cable and built my hardware debouncer. However before uploading your sketch can I confirm a couple of things.</p>
<p>I am using an AC -Ac power supply bought from Glyn. I have connected the pulse to the 5v pin 1 however it seems to be giving 3.3v the same as pin 2. This I guess is because of the power supply. &nbsp;Will it affect my debouncer circuit which uses your suggested resistor and capacitor?</p>
<p>Before uploading the sketch I will take a good look at it to try to understand what is going on. I have been studying some &quot;Arduino for dummies&quot;&nbsp;stuff that I have found. Obviously need to edit for freq and node number.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21279"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 07/05/2014 - 23:06.</div>
    <div class="content">
     <p>Yes, with the power derived from the AC input, there is only 3.3 V available (see the circuit diagram! - the voltage on the 5 V connection is a back feed). It&#39;s probably not a good idea to leave it there, because it will be 5 V with the programmer or USB supply connected, and then closing the switch takes the input outside it&#39;s permitted voltage range unless you have a 1 k&Omega; series resistor that I suggested way up this thread.</p>
<p>The additional bit of software is dead simple. The timer triggers an interrupt and the ISR runs. It moves the &quot;history&quot; 1 place to the left, then adds in the switch value (0 or 1) into the vacant LSB. And so on. When you have 4 zeros and 4 ones (hex 0F), it&#39;s seen an edge.</p>
<p><strong>Eric. </strong>I don&#39;t think changing the timer to 1 s will materially affect CPU usage. It does very little inside the interrupt routine.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21281"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Thu, 08/05/2014 - 09:36.</div>
    <div class="content">
     <p>OK it seems to be working well. A bit early to tell if any pulses being skipped or multi counted but they seem to be accumulating at a steady rate despite 25m cable run!</p>
<p>My meter pulses&nbsp;once per cu.ft. I have written some maths&nbsp;into the input screen to give me total and daily usage in kwh</p>
<p>However I am a bit confused as to how I can produce&nbsp;instantaneous figures to produce a nice line graph in visualisations&nbsp;and dashboards.</p>
<p>There is a feed called total pulse count to pulse increment. I am not quite sure how it works though.</p>
<p>Sorry to pester you again but can you offer some advice on this?</p>
<p>The input processing area on the site does not really help explain it to me anyway.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21284"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 08/05/2014 - 14:21.</div>
    <div class="content">
     <p>Do you want the instantaneous rate in kW?&nbsp; You have a problem. The pulse increment is sent every 10 s or so, if there hasn&#39;t been a pulse since the last reading, zero is sent, otherwise it sends the number of pulses that have been seen since the last reading. Each pulse is in units of energy (kWh with appropriate scaling), hence you need to use &quot;kWh to Power&quot;. That works in principle, but it calculates the power based on the increment since the last refresh, not from the last time the acccumulating pulse count had a non-zero value added to it. You can see where this is going - it will show zero a lot of the time, then a big number. Looking down the list of functions, I think Trystan didn&#39;t anticipate doing it this way, which is why in his (electricity) example he did the timing in the ISR, and transmitted a &quot;Power&quot; based on the interval between the previous pulse and the present one. I think you must do that, but I suggest you split the scaling so that you transmit a sensibly scaled integer from the emonTx, and finish the scaling inside emonCMS where it&#39;s easier to take account of changes in the calorific value and the volume correction factor.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21289"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Thu, 08/05/2014 - 17:07.</div>
    <div class="content">
     <p>Yes I figured that but thought that trystan or somebody had come up with something clever in the pulse to pulse interval option in the input calcs.</p>
<p>So having been out all day I have returned to see an accumulation of pulses which look to be ramping up evenly when my gas appliances are running so so far so good and I can convert these to a total and a daily total.</p>
<p>However as mentioned elsewhere the new daily feed is logging to the wrong day although its yesterday this time instead of tomorrow with my other ones.</p>
<p>So you suggest sending an approx amount of &quot;watts&quot; rather than just a &quot;1&quot; from the emontx and then adjusting the volume and calorific value in the feed calcs?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21290"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 08/05/2014 - 19:17.</div>
    <div class="content">
     <p>No, as well as!&nbsp; And use the two values for their separate purposes. Keep the pulse count (= energy) for the total and daily total, and the power for, well, power.</p>
<p>Note, you send a &quot;1&quot; or a &quot;0&quot; only if the pulse rate is less than 1 every 10 s. If you get more than 1 pulse between sending values, it will send the true count of pulses.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21294"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Fri, 09/05/2014 - 06:12.</div>
    <div class="content">
     <p>Everything was fine until 05.30 this morning when my pulse count jumped instantly by 32!!!!</p>
<p>Without that the pulses would have correlated exactly with the meter reading.</p>
<p>Could that be switch bounce or something else?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21295"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Fri, 09/05/2014 - 06:18.</div>
    <div class="content">
     <p>Further study shows that this was at a time when no gas was being used except a pilot light on my aga. So it could have been one pulse with the dial rotating extremely slowly creating the &quot;bounce&quot; or something else entirely.</p>
<p>There is one other time that I can see that I got 2 pulses when there should have been 1.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21298"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 09/05/2014 - 13:59.</div>
    <div class="content">
     <p>Yikes! I can&#39;t quite see how that could have happened. Assuming you have kept the original timing, the timer fires an interrupt every 0.1 s, which means the switch is polled every 0.1 s. But the &#39;shift register&#39; needs to see 0 0 0 0 1 1 1 1 to count a pulse - at least 0.3 s consistently in each state, therefore to count 32 pulses it needs to see 000011110000111100001111 . . .&nbsp; that&#39;s 3 pulses and it took 2.4 s, so your switch needs to be bouncing in a very controlled manner for half a minute to count that many pulses.</p>
<p>Now the contacts in a reed switch have some inbuilt hysteresis (you can see this given a reed switch, a multimeter, a magnet and a steady hand) so I think that theory doesn&#39;t seem likely.</p>
<p class="rteindent1">[Edit: One particular reed switch and magnet pair that I&#39;ve just checked: make: 18 mm between magnet and switch; break: 28 mm, keeping the same relative orientation between them.]</p>
<p>I think I&#39;d lay the blame on &quot;something else entirely&quot; at this stage. Is the 32 significant, I wonder? Is there a spark ignition anywhere that might have generated something that looked like a repetitive pulse?</p>
<p>Tell me about your 25 m cable run. What type, earthing, proximity to anything electrical (including stuff the other side of walls)?</p>
<p>How have you wired the contacts into the emonTx, is there any hardware filtering?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21307"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Fri, 09/05/2014 - 20:50.</div>
    <div class="content">
     <p>Yes I think you are right! Cable is unscreened alarm wire chosen for its ability to fit into an RJ11 plug and its on the shelf!</p>
<p>Run is around the outside of the house concealed under tile hanging nowhere near any thing until it comes through the wall into my Consumer unit cupboard. There it was running along with the power supply to some outside fluorescent spots which are triggered by a light sensor connected to a relay. I had another spike tonight when the lights came on and have since triggered further ones by switching the lights. The spike this am was the lights turning off! Cable now rerouted for further observation!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21308"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 09/05/2014 - 21:53.</div>
    <div class="content">
     <p>If rerouting doesn&#39;t cure your problem, then I think you need to look at what I wrote above about cables (twin twisted screened) and filters. Eric&#39;s hardware debounce filter should also take interference spikes out fairly well, adding a fast diodes to clamp the input wire to earth and +3.3 V might help if the RC filter isn&#39;t enough.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21314"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sat, 10/05/2014 - 07:29.</div>
    <div class="content">
     <p>I have the hardware debouncer from above in this thread. It is working perfectly. I did read re the wire and screening its just that I had this alarm&nbsp;wire on the shelf in my garage. Now that the concept is proven I can spend some money on proper screened cable.</p>
<p>Is it possible to get breadboard that has the same pitch as the connectors on the emon tx? So that I can connect the debouncer without flexible wire tails.</p>
<p>Here is expanded screenshot showing nice even pulses and the spike this am when the lights turned off.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21316"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 10/05/2014 - 12:40.</div>
    <div class="content">
     <p>As far as I know, only 0.1&quot; and 0.15&quot; Veroboard is available (other equivalent brands exist, I don&#39;t know whether many or any do the 0.15&quot; pitch). I make the emonTx connector 0.14&quot; pitch, so it&#39;s close enough for practical purposes. (I think you&#39;d get away with 0.1&quot; if you used solid tinned copper wires - the 3 terminals you are using are adjacent, so only a slight joggle is required.)</p>
<p>That&#39;s some step you have. I completely understand the appeal of using a cable you had to hand, you could try earthing any unused cores, that might help a little, but it&#39;s a bit like grasping at straws. The cable you want is like this <a href="http://spiratronics.com/twin-screened-cable-per-metre.html" title="http://spiratronics.com/twin-screened-cable-per-metre.html">http://spiratronics.com/twin-screened-cable-per-metre.html</a> (not this: <a href="http://spiratronics.com/stereo-screened-cable-per-metre.html" title="http://spiratronics.com/stereo-screened-cable-per-metre.html">http://spiratronics.com/stereo-screened-cable-per-metre.html</a>).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21322"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sat, 10/05/2014 - 21:54.</div>
    <div class="content">
     <p>So despite reroute of cable a similar spike occurred&nbsp;when lights came on tonight. I have discovered that the cable runs directly alongside the coil trigger wire for the lights relay for a distance of about 4 feet! Will a screened cable prevent the spike because rerouting the cable to avoid this will be difficult! Maybe I should screen the trigger wire as well?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21323"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 10/05/2014 - 22:23.</div>
    <div class="content">
     <p>Screening the source shouldn&#39;t make much difference, but it might help a little.&nbsp; I can&#39;t categorically guarantee that a screened cable will prevent the spike, but it should certainly help a lot more. You could also look into suppressing the relay coil. The usual way is a series resistor-capacitor combination in parallel with the contacts - usually 0.1 &micro;F + 100 &Omega;.&nbsp; Maplin, RS &amp; Farnell sell it as a single component (&quot;contact suppressor&quot;) rated for mains voltages.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21325"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sun, 11/05/2014 - 06:56.</div>
    <div class="content">
     <p>To be fair the relay is a massive one (again off the shelf in my garage) and it is v close to the Emontx&nbsp;(due to space resrictions) I could quite easily replace it with a small one situated within my consumer unit which is much further away from it all. I think I will do that first as funnily enough I have one in stock! It may already have a coil suppressor.</p>
<p>Thanks again for your help!&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21330"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1817.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="StuntMonkeh&#039;s picture" title="StuntMonkeh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/1817.html" title="View user profile.">StuntMonkeh</a> on Sun, 11/05/2014 - 10:59.</div>
    <div class="content">
     <p>Suggest using something like Belden&nbsp;8723 or equivalent twisted pair screened cable. &nbsp;Make sure you earth the screen at only one end.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21332"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 11/05/2014 - 11:31.</div>
    <div class="content">
     <p><em>&quot;Suggest using something like Belden 8723 or equivalent twisted pair screened cable.&nbsp; Make sure you earth the screen at only one end.&quot;&nbsp;</em> Why does he need two screened pairs, and is foil screened any better than a lapped screen? It is probably unnecessary to go to the really expensive double braided screen cable for this application. He already knows to earth the screen at the switch end.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21335"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sun, 11/05/2014 - 20:14.</div>
    <div class="content">
     <p>Spikes much smaller now going to try maplin suppressor.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21337"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 11/05/2014 - 20:47.</div>
    <div class="content">
     <p>A hunky relay or contactor coil can store a good deal of energy, and as the contacts open (or bounce) without a suppressor there&#39;s only one place for it go - into space. Hopefully the addition of the suppressor will solve your problem. Is it a mains voltage ac coil, or low voltage dc? I&#39;ve been assuming it&#39;s mains, but if it&#39;s a low voltage dc, a flywheel diode might work.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21342"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Mon, 12/05/2014 - 18:19.</div>
    <div class="content">
     <p>Mains voltage AC coil. Will get suppressor asap.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21347"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Tue, 13/05/2014 - 08:55.</div>
    <div class="content">
     <p>Hi,</p>
<p>I have been testing Robert&#39;s sketch since 2 days and it seems to work fine with my gas meter without any additional piece of hardware.</p>
<p>Although I had a lot of noise at the source (noise spikes on the line and bounces), it reports the exact number of pulses given by my meter.</p>
<p>Great job !</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 13/05/2014 - 14:32.</div>
    <div class="content">
     <p>That&#39;s good to know, thank you, Eric.</p>
<p>Assuming that the input switches between the voltages of 0 V and V<sub>CC</sub>,&nbsp; the noise spikes need to be about 0.6 or 0.7 V<sub>CC</sub> or more in amplitude (depending on the switch state) in order to get through the Schmitt trigger on the input. (See Figure 13-2 General Digital I/O(1) and Table 28.2 DC Characteristics in the data sheet).&nbsp; Therefore I suspect yours, Eric, are smaller that this and Webby&#39;s are larger.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21352"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Tue, 13/05/2014 - 19:33.</div>
    <div class="content">
     <p>I don&#39;t know if it can affect the noise spikes but note that</p>
<p>&nbsp;&nbsp; - my reed switch is connected between the ground (port4) and the 3.3V (port2) of the EmonTX.</p>
<p>&nbsp;&nbsp; -&nbsp; the EmonTX is powered by the AC/AC adapter</p>
<p>&nbsp;</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21356"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 13/05/2014 - 22:23.</div>
    <div class="content">
     <p>Eric:</p>
<p><em>&quot;- my reed switch is connected between the ground (port4) and the 3.3V (port2) of the EmonTX.&quot;</em>&nbsp; Webby has that too.&nbsp; I wondered whether the noise was getting in to the V<sub>cc</sub> supply and corrupting a register somewhere, but I decided that was silly. I think it is simply that Webby has the switch wiring running for a distance of 1.2 m close to the wires switching a relay that has no suppressor. That is surely more than enough to cause trouble!</p>
<p>Webby:</p>
<p>You mentioned the lights in question are fluorescent. What sort of control gear do they have - electronic ballast or choke and starter?&nbsp; If you turn off the lights but allow the relay to switch, do you still count extra pulses?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21366"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Wed, 14/05/2014 - 06:45.</div>
    <div class="content">
     <p>Hi Robert</p>
<p>That test is a little tricky to do in my case. The coil supply is fed from the same MCB that runs the lights.</p>
<p>They are electronic ballast. I hope to pick up a suppressor today. My Debouncer&nbsp;is still connected to Port 1 on the emon tx. I plan to change that today as well.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Wed, 14/05/2014 - 18:32.</div>
    <div class="content">
     <p>Suppressor working!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21383"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 14/05/2014 - 18:42.</div>
    <div class="content">
     <p>That was a battle, but your experience is not unusual when you are dealing with interference.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21387"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Wed, 14/05/2014 - 21:35.</div>
    <div class="content">
     <p>Now to get my PHP feeds logging to the correct day. Can&#39;t see why it is only affecting a few people. I guess finding out would go some way to solving the issue. I am using emoncms.org but displaying on a Mac using Safari however the same problem is apparent in Chrome as well. Could it be my machine? Wish I had a clue but I don&#39;t.</p>
<p>Prob a topic for another thread.</p>
<p>Thanks again for all your help.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21388"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 14/05/2014 - 21:44.</div>
    <div class="content">
     <p>The wrong day problem has been/is being discussed in other threads, so I think you find someone with similar or the same symptoms that you are experiencing and join in there.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21493"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas monitoring</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 21/05/2014 - 09:47.</div>
    <div class="content">
     <p>Hi,</p>
<p>I have been testing Robert&#39;s sketch since 10 days. It works perfectly with my gas meter without any additional piece of hardware. I am getting the exact number of pulse sent by my meter, about 5000 pulses in 10 days. No pulse have been lost or duplicated. Great !</p>
<p>With the same Emontx, I am now able to count pulses, monitor many temperature and many CT. Great !</p>
<p>According to me, this feature needs to be added in the main EmonTxV3 sketch.</p>
<p>Regards,</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5022"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-QJLguZOpfrnxgSqZejEuDP7y9-9KkKkMktZFkA6qZZ8" value="form-QJLguZOpfrnxgSqZejEuDP7y9-9KkKkMktZFkA6qZZ8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
