<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12189 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:39:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>(BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">(BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>
        <span class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 17/02/2016 - 12:07</span>
        <div class="content"><h2><strong>Update: This image has been superseded&nbsp;by the&nbsp;<a href="12212.html">emonSD-20Feb16</a>&nbsp;RC#1&nbsp;image. This thread is now closed. Please post on the new thread for issues regarding this latest image.&nbsp;</strong></h2>
<p><strong>----------------------------------------------------------------------------------------------------------------------------------------------------------</strong></p>
<h2>This release is &#39;beta&#39; please read comments below before installing. If you require stable release see&nbsp;<a href="10729.html">emonSD-17Jun15</a>.</h2>
<h2><strong>DOWNLOAD BETA #2: <a href="http://openenergymonitor.org/files/emonSD-16Feb16.img.zip">emonSD-16Feb16.zip</a>&nbsp;(1.3GB)</strong></h2>
<p>MD5 Checksum (zip):&nbsp;071dcefd5898c70e17eb44d95f5fe1a0</p>
<p>MD5 Checksum (.img):&nbsp;d667a27c28035a40970916a088aa790c</p>
<p><em>​To check the image version you are currently running look for a file called emonSD-XXX in the /boot partition:</em></p>
<pre>
$ sudo ls /boot | grep emonSD
</pre><p>This post follows on from&nbsp;<a href="11407.html">Steps towards an EmonCMS 9.0 SD Card Image + Upgrade path</a>, the <a href="11695.html">Low-write mode - your thoughts please</a> thread and blog posts on <a href="http://openenergymonitor.blogspot.com/2015/10/emonpi-nodered-and-mqtt.html">node-RED &amp; MQTT</a>, <a href="http://openenergymonitor.blogspot.com/2015/12/openenergymonitor-emonpi-and-openhab.html">openHAB</a> and <a href="http://openenergymonitor.blogspot.co.uk/2015/11/remote-control-of-lightwave-rf-plugs.html">LightWaveRF OOK control</a>. <a href="11799.html">emonSD-22Dec15 beta</a>, <a href="12164.html">emonSD-12Feb16 Alpha</a></p>
<p>Key Features:&nbsp;</p>
<ul>
<li>Based on&nbsp;<a href="https://www.raspberrypi.org/downloads/raspbian/">RASPBIAN JESSIE LITE</a> (2015-11-21)&nbsp;</li>
<li>Built following <a href="https://github.com/openenergymonitor/emonpi/blob/master/docs/SD-card-build.md">emonPi SD card Build Guide</a></li>
<li>4GB min card size download&nbsp;(ships on an 8GB expanded SD card)</li>
<li>Emoncms V9 (<a href="https://github.com/emoncms/emoncms/blob/stable/docs/RaspberryPi/readme.md">RasPi&nbsp;emonPi&nbsp;install</a>&nbsp;- thanks Paul Reed for writing the guide)&nbsp;</li>
<li>Read-only&nbsp;root FS (see <a href="11695.html#comment-36528">discussion thread</a>)</li>
<li><a href="http://openenergymonitor.blogspot.co.uk/2015/10/emonpi-nodered-and-mqtt.html">NodeRED</a>, <a href="http://openenergymonitor.blogspot.com/2015/11/remote-control-of-lightwave-rf-plugs.html">LightWave RF MQTT OOK control</a> and <a href="http://openenergymonitor.blogspot.com/2015/12/openenergymonitor-emonpi-and-openhab.html">openHAB</a>&nbsp;all pre installed and configured</li>
</ul>
<p>Please report any bugs on this thread.&nbsp;</p>
<h1>Data Migration&nbsp;</h1>
<p>If you&#39;re moving from our previous pre-built-SD card, and have Emoncms data you want to migrate, this can be done using the backup module. Backup module is ready installed on this image. You will need to install it on an older image:&nbsp;</p>
<p>See Emopncms&nbsp;backup module readme:&nbsp;<a href="https://github.com/emoncms/backup">https://github.com/emoncms/backup</a></p>
<p>Please report any issues to his thread.&nbsp;</p>
<p>&nbsp;</p>
<h1>Storage&nbsp;&amp;&nbsp;Read-only File system&nbsp;</h1>
<p>The image is based on Lightweight Raspbian&nbsp;Jessie&nbsp;which makes for a very space efficient stack. With everything installed (inc nodeRED&nbsp;&amp; openHAB) total system size is 1.7GB compared to the previous ready-to-go emonPi&nbsp;image, which was&nbsp;over 2GB <em>without</em> nodeRED or openHAB.</p>
<p>As before, the filesystem&nbsp;is in read-only mode by default. <a href="11695.html#comment-36528">discussion thread</a>.</p>
<p>To put the filesystem in read/write mode, use the command: <em>rpi-rw</em>&nbsp;<br />
To return to read-only mode, use the command:<em> rpi-ro</em></p>
<pre>
df -h
/dev/root &nbsp; &nbsp; &nbsp; 3.4G &nbsp;1.8G &nbsp;1.5G &nbsp;56% /
devtmpfs &nbsp; &nbsp; &nbsp; &nbsp;459M &nbsp; &nbsp; 0 &nbsp;459M &nbsp; 0% /dev
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 463M &nbsp; &nbsp; 0 &nbsp;463M &nbsp; 0% /dev/shm
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 463M &nbsp; 13M &nbsp;451M &nbsp; 3% /run
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5.0M &nbsp;4.0K &nbsp;5.0M &nbsp; 1% /run/lock
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 463M &nbsp; &nbsp; 0 &nbsp;463M &nbsp; 0% /sys/fs/cgroup
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;40M &nbsp;6.6M &nbsp; 34M &nbsp;17% /var/lib/openhab
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.0M &nbsp; &nbsp; 0 &nbsp;1.0M &nbsp; 0% /var/lib/dhcp
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;50M &nbsp;7.9M &nbsp; 43M &nbsp;16% /var/log
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30M &nbsp; 36K &nbsp; 30M &nbsp; 1% /tmp
/dev/mmcblk0p1 &nbsp; 60M &nbsp; 20M &nbsp; 41M &nbsp;34% /boot
/dev/mmcblk0p3 &nbsp;194M &nbsp; 32M &nbsp;153M &nbsp;17% /home/pi/data

</pre><p>The main data folder for emoncms is /home/pi/data this folder is always mounted Read/Write. A number of other folders are mounted in RAM (tmpfs), see <a href="https://github.com/openenergymonitor/emonpi/blob/master/fstab">/etc/fstab</a>. A read-only file system presents challenges to some core Linux processes such as DHCP and NTP. A couple of DHCP &amp; Resolv <a href="http://github.com/openenergymonitor/emonpi/blob/master/install#L57">files</a> are located in the writeable ~/data folder and symlinked to /etc and a custom <a href="http://github.com/openenergymonitor/emonpi/blob/master/dhclient-script_minibian">/sbin/dhclient-script</a> is used.<a href="http://github.com/emonhub/ntp-backup">NTP-backup</a> (thanks Paul) is used to enable NTP clock updates in R/O mode. See the original NTP discussion <a href="5877.html">thread</a>.</p>
<h1>emonPi</h1>
<p>Now updates itself on first factory boot so we will always ship with latest software pulled from github. emonPi LCD now shows when it&#39;s updating and also LCD scrip has been updated to include authenticated MQTT support and to display&nbsp;temperature, VRMS and pulse count values as well as power 1 &amp;2.</p>
<p><a href="../sites/default/files/emonpi_update.jpg"><img alt="" src="../sites/default/files/emonpi_update.jpg" style="width: 300px; height: 169px;" /></a></p>
<p>&nbsp;</p>
<h1><strong>Emoncms&nbsp;V9&nbsp;</strong></h1>
<p><strong>Access via</strong>: <a href="http://emonpi/" title="http://emonpi">http://emonpi</a></p>
<p><strong>Authenticate</strong>: Create the admin user account&nbsp;</p>
<p><strong>Configure</strong>: emonhub.conf (located in ~/data) via web interface&nbsp;</p>
<p><strong>Update</strong>: Pull in the latest updates from Emoncms&nbsp;stable branch using the web-based update tool in Administration &gt; update emonPi.&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<h2><strong>SSH &nbsp;</strong></h2>
<p>The default SSH password has been changed from &quot;raspberry&quot; to &quot;<strong>emonpi2016</strong>&quot; since even though we recommend users change their password, not many do. Moving away from the default&nbsp;raspberry will give a little more security. It&#39;s still <strong>HIGHLY RECOMMENDED</strong> to change the SSH password using&nbsp;<em><strong>passwd</strong></em> (be sure the filesystem is in R/W mode before you change the password (rpi-rw)&nbsp;</p>
<p>&nbsp;</p>
<h2><strong>MQTT</strong></h2>
<p>Mosquitto&nbsp;MQTT&nbsp;server is running on port 1883.</p>
<p><a href="https://github.com/openenergymonitor/emonhub">emonHub&nbsp;(emon-pi variant)</a>&nbsp;posts emonPi data to the following&nbsp;topics:</p>
<pre>
<em>emonhub/rx/&lt;nodeID&gt;/values</em> topic

<em>emon/&lt;nodename&gt;/&lt;keyname&gt; (e.g. emon/emontx/power1)</em>

See here for <a href="https://github.com/emoncms/emoncms/blob/master/docs/RaspberryPi/MQTT.md#node-format">more info an emonHub MQTT topics</a></pre><p>Port 1883 is open by default and authentication has been turned on:</p>
<p>mosquitto username &quot;emonpi&quot;</p>
<p>mosquitto password &quot;emonpimqtt2016&quot;</p>
<p>to change password&nbsp;:&nbsp;</p>
<pre>
sudo nano /etc/mosquitto/mosquitto.conf</pre><p>add lines&nbsp;</p>
<pre>
allow_anonymous false
password_file /etc/mosquitto/passwd</pre><p>To generate a password file, use the mosquitto_passwd tool. It will prompt for a password, then create a hashed password file.&nbsp;</p>
<pre>
$ sudo mosquitto_passwd -c /etc/mosquitto/passwd username</pre><address>&nbsp;</address>
<address>Note if mosquitto&nbsp;authentication&nbsp;credentials are change the new credentials will also need to be updated in:</address>
<address>~/data/emonhub.conf</address>
<address>/var/www/emoncms/settings.php</address>
<address>~/emonpi/lcd/emonPiLCD.py</address>
<address>~/oem_openhab/configuration/openhab.cfg</address>
<address>in node-RED MQTT node&nbsp;via web flows editor&nbsp;</address>
<address>&nbsp;</address>
<p>On this image the Nodes module has been depreciated in favor of the mqtt_input script. When data from a particular node is received (as long as it has a relevant entry in emonhub.conf) it will be posted to Inputs when it can be then be logged go feeds. Any data posted to the emon/# MQTT topic will be logged to feeds using tbe topic names as Input name and Key name, e.g: emon/emontx/power1 will result in an input called emontx with a key called power 1 and the value.&nbsp;</p>
<p>The mqtt input script can be stopped, started and restarted using:</p>
<pre>
sudo service mqtt_input restart </pre><p>The mqtt_input scripts logs to the emoncms log which can be viewed in Admin &gt; logger. The default log level is WARN this can be changed to INTO for a more verbose log in emoncms settings.php. The MQTT server authentication details used by the script are also set in settings.php.&nbsp;</p>
<address>&nbsp;</address>
<h2><strong>NodeRED</strong></h2>
<p>Node-RED is installed and set up with a basic (but useful!)&nbsp;demo flow to subscribe to emonHub MQTT&nbsp;topic and send an email to alert the user when emonTH batteries are low. For email to work, you will have to enter your gmail&nbsp;or smtp&nbsp;details into the node-RED email node. See <a href="http://openenergymonitor.blogspot.com/2015/10/emonpi-nodered-and-mqtt.html">node-RED blog post</a>. For &nbsp;our install and&nbsp;setup notes see <a href="https://github.com/openenergymonitor/oem_node-red">oem_node-red repo</a></p>
<p><strong>Access Via</strong>:&nbsp;<a href="http://emonpi:1880/">http://emonpi:1880</a></p>
<p><strong>Authentication</strong>: user &quot;emonpi&quot; and password &quot;emonpi2016&quot;&nbsp;</p>
<p>The User folder is in the R/W partition so flows can be saved via web editor without he need to change to R/W mode&nbsp;/home/pi/data/node-red</p>
<p>Set user name and password in /home/pi/node-red/settings.js. See instructions on out nodeRED&nbsp;github</p>
<p><a href="https://github.com/openenergymonitor/oem_node-red">https://github.com/openenergymonitor/oem_node-red</a></p>
<p><a href="../sites/default/files/nodered2.png"><img alt="" src="../sites/default/files/nodered2.png" style="height: 415px; width: 600px;" /></a></p>
<h2>&nbsp;</h2>
<p><strong>Note: Node-RED as setup in the image is compiled for Pi2, to use with Model B+ Node will need to be recompiled. Follow these instructions:&nbsp;</strong></p>
<p>Check if node &amp; npm are installed/working properly, normally you will get these results:</p>
<pre>
rpi-rw
​sudo apt-get remove nodered
pi@emonpi:~$ node -v
Segmentation fault
pi@emonpi:~$ npm -v
Segmentation fault</pre><p>Install ARM v6 (for a RasPi model B 512MB) LTS version of node.js</p>
<pre>
wget <a href="https://nodejs.org/dist/v4.2.4/node-v4.2.4-linux-armv6l.tar.gz" title="https://nodejs.org/dist/v4.2.4/node-v4.2.4-linux-armv6l.tar.gz">https://nodejs.org/dist/v4.2.4/node-v4.2.4-linux-armv6l.tar.gz</a>
tar -xvf node-v4.2.4-linux-armv6l.tar.gz
cd node-v4.2.4-linux-armv6l/
sudo cp -R * /usr/</pre><p>Check if Node-Red is working (can take up to 40-50s on a RasPi model B 512MB)</p>
<pre>
sudo service nodered start</pre><p>Re-enable the Node-Red service (maybe not nescessary, haven&#39;t tested it)</p>
<pre>
sudo systemctl daemon-reload
sudo systemctl enable nodered.service</pre><p>Check if Node-Red gets auto-started on boot:</p>
<pre>
sudo reboot</pre><h2>&nbsp;</h2>
<h2><strong>OpenHAB&nbsp;</strong></h2>
<p>OpenHAB is installed and setup with the basic skeleton OpenEnegyMonitor config. See <a href="http://openenergymonitor.blogspot.co.uk/2015/12/openenergymonitor-emonpi-and-openhab.html">openHAB blog post</a>.</p>
<p><strong>Access via</strong>:&nbsp;<a href="http://emonpi:8080/">http://emonpi:8080</a></p>
<p><strong>Authenticate</strong>: user &quot;pi&quot; and password &quot;emonpi2016&quot;</p>
<p>Change user name and password in&nbsp;/etc/openhab/configurations/users.cfg</p>
<p><strong>Configure:&nbsp;</strong>oem.items and oem.sites and located in git repo ~/oem-opemhab and symlinked&nbsp;to default.items and default.sitemap in&nbsp;relevant folders in&nbsp;to&nbsp;/etc/openhab/configurations.&nbsp;</p>
<p><em>Note:&nbsp;Config files are symlinked to our <a href="https://github.com/openenergymonitor/oem_openHab">oem_openhab</a> git repo so we can add functionally with git updates, pulled in automatically with emonPi&nbsp;update. It&#39;s recommended to setup your own sitemap and files config so your changes will not be overwritten by out updates: </em></p>
<p><em>e.g. dave.items and dave.sitemaps then navigate to&nbsp;<a href="http://emonpi8081/openhab.app?sitemap=dave">http://emonpi8081/openhab.app?sitemap=dave</a></em></p>
<p><img alt="" src="../../../1.bp.blogspot.com/-lAn2SNSzyLQ/VmVkYfsFDxI/AAAAAAABkic/Wqhp7g4R4uA/s400/OpenEnergyMonitor_openHAB.png" style="width: 385px; height: 400px;" /></p>
<h2>&nbsp;</h2>
<h2>LightWaveRF OOK RF Tx&nbsp;</h2>
<p>Service to control lightwaveRF plugs and relays via OOK (OOK Tx module installed on emonPi) controlled via MQTT&nbsp;and openHAB. See <a href="http://openenergymonitor.blogspot.com/2015/11/remote-control-of-lightwave-rf-plugs.html">LightWaveRF OOK blog post</a>.</p>
<p><a href="../../../3.bp.blogspot.com/-ooKdNYl_8fA/Vlc-c0pyyJI/AAAAAAABj5o/M6wlA5rH_Ko/s640/emonPi_lwrf.png"><img alt="" src="../../../3.bp.blogspot.com/-ooKdNYl_8fA/Vlc-c0pyyJI/AAAAAAABj5o/M6wlA5rH_Ko/s640/emonPi_lwrf.png" style="height: 319px; width: 300px;" /></a></p>
<h1>Timezone&nbsp;</h1>
<p>The timezone can be set by running raspi-config then selecting &#39;Internationalisation Options&#39;:</p>
<pre>
sudo raspi-config</pre><p>Caution: don&#39;t try and run the &#39;Expand file-system option&#39; in raspi-config. This won&#39;t work because of the extra third partition.&nbsp;&nbsp;</p>
<ul></p>
<li>&nbsp;</li>
</ul>
  <div class="forum-topic-navigation clear-block">
          <a href="12108.html" class="topic-previous" title="Go to previous forum topic">‹ Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</a>
              <a href="12200.html" class="topic-next" title="Go to next forum topic">mysolar will not work with Read API key? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-39485"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9478.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jason&#039;s picture" title="jason&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/9478.html" title="View user profile.">jason</a> on Wed, 17/02/2016 - 12:22.</div>
    <div class="content">
     <p>@glyn - now on the new thread ...</p>
<p>I&#39;m now going to try&nbsp;a migration - assuming that other with more experience will be checking functionality.&nbsp;So, here&#39;s what happens:</p>
<p>1 - Start&nbsp;with&nbsp;Jun15&nbsp;image, added backup, then manually ran emoncms-export.sh (did not spend time getting backup to work in the GUI)</p>
<p>2 - On a new SD, run the&nbsp;16feb16sd&nbsp;image. Check that input is working, etc.</p>
<p>3 - Restore from backup in #1</p>
<p>4 - Confirm that inputs look ok :-)</p>
<p>5 - Confirm that feeds look ok ... er ... :-(</p>
<p>The Feeds page says &quot;loading&quot; and sticks there.</p>
<p>Try to create a feed from the input - message &quot;ERROR: Feed could not be created, undefined&quot;</p>
<p>Try to read a feed using the API &quot;http://192.168.16.31/emoncms/feed/list.json&quot;&nbsp;- and get a PHP&nbsp;error:</p>
<pre>
Fatal error: Uncaught exception &#39;Exception&#39; with message &#39;ABORTED: Engine id &#39;1&#39; is not supported.&#39; in /var/www/emoncms/Modules/feed/feed_model.php:71 
Stack trace: 
#0 /var/www/emoncms/Modules/feed/feed_model.php(396): Feed-&gt;EngineClass(&#39;1&#39;) 
#1 /var/www/emoncms/Modules/feed/feed_model.php(279): Feed-&gt;get_timevalue(&#39;10&#39;) 
#2 /var/www/emoncms/Modules/feed/feed_model.php(253): Feed-&gt;redis_get_user_feeds(1) 
#3 /var/www/emoncms/Modules/feed/feed_controller.php(38): Feed-&gt;get_user_feeds(&#39;1&#39;) 
#4 /var/www/emoncms/core.php(64): feed_controller() 
#5 /var/www/emoncms/index.php(146): controller(&#39;feed&#39;) 
#6 {main} thrown in /var/www/emoncms/Modules/feed/feed_model.php on line 71</pre><p>&nbsp;</p>
<p>... tried a reboot, same situation.</p>
<p>Also looked at logs in &quot;Admin-&gt;Logger&quot; and saw:</p>
<pre>
2016-02-17 11:58:42.903|WARN|phpmqtt_input.php|Subscribing to: emon/# 
2016-02-17 11:58:42.904|WARN|phpmqtt_input.php|Not connected, retrying connection 
2016-02-17 11:58:42.905|WARN|phpmqtt_input.php|Connecting to MQTT server: Connection Accepted.: code: 0 
2016-02-17 11:58:42.906|WARN|phpmqtt_input.php|Subscribed to topic: emon/# 
2016-02-17 11:59:18.463|ERROR|feed_model.php|EngineClass() Engine id &#39;1&#39; is not supported. 
2016-02-17 11:59:22.067|ERROR|feed_model.php|EngineClass() Engine id &#39;1&#39; is not supported.</pre><p>I will try to look at this - but any pointers would be useful.<span id="cke_bm_78E" style="display: none;">&nbsp;</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39486"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9478.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jason&#039;s picture" title="jason&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/9478.html" title="View user profile.">jason</a> on Wed, 17/02/2016 - 12:24.</div>
    <div class="content">
     <p>@glyn - again on the new thread</p>
<p>&nbsp;</p>
<p>Now trying &quot;factory reset&quot;</p>
<p>So, from message above, did a factory reset, which should put everything back in place. So tests ...</p>
<p>1 - run factory reset under a root shell - ok</p>
<p>2 - login - password now the &quot;factory&quot; one :-)</p>
<p>3 - Check inputs - working :-)</p>
<p>4 - Go to feeds page - all seems ok :-)</p>
<p>5 - Back to inputs, hit the spanner to create a feed&nbsp;</p>
<p>6 - Hit &quot;add&quot; and ... :-(</p>
<p>When I hit &quot;Add&quot;, I get, in a&nbsp;dialogue&nbsp;box:</p>
<pre>
ERROR: Feed could not be created, undefined</pre><p>What to do now ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39488"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9478.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jason&#039;s picture" title="jason&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/9478.html" title="View user profile.">jason</a> on Wed, 17/02/2016 - 12:35.</div>
    <div class="content">
     <p>@glyn</p>
<p>So, the image that I downloaded this morning emonSD-16feb16 ... has. er, redis&nbsp;2.2.5-1 ...</p>
<p>Installed the new redis&nbsp;per the instructions from the alpha thread, and ended up in the same place - the feeds page says &quot;loading ...&quot; and the API is complaining about the wrong engine ID ...</p>
<p>EDIT: just realised that the apt cache will show the apt installed version number - installing the redis&nbsp;manually will not overwrite this versioning.</p>
<p>So, I&#39;m stuck!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39489"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 17/02/2016 - 12:38.</div>
    <div class="content">
     <p>Yes, that&#39;s right. We&#39;re not running the version obtained via the packages. To check the version we can look at the header file before compiling&nbsp;</p>
<pre>
cat ~/phpredis/php_redis.h | grep VERSION</pre><p>I&#39;m not sure if the engine ID is another separate issue of if it was a side effect of the Redis issue....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39491"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gregl&#039;s picture" title="gregl&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/9051.html" title="View user profile.">gregl</a> on Wed, 17/02/2016 - 12:59.</div>
    <div class="content">
     <p>i too am getting this issue. If i restart apache2 then i can quickly add a feed/input...but it then dies soon after.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39492"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9478.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jason&#039;s picture" title="jason&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/9478.html" title="View user profile.">jason</a> on Wed, 17/02/2016 - 13:43.</div>
    <div class="content">
     <p>@glyn</p>
<p>Yes - when I rebuilt, I overwrote what was on the image with 2.2.7 ...</p>
<p>I guess we need a way of tracking versions for non-apt installed stuff?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39497"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 17/02/2016 - 16:26.</div>
    <div class="content">
     <p>The max backup file that should be able to be uploaded the the web interface should be 200Mb as set in /etc/php5/apache2/php.ini. I will investigate why errors are being reported when uploading smaller files and there is sufficient space in the ~/data partition.&nbsp;</p>
<p>@jason I don&#39;t there there is a way to track version for non apt sutff. The only way I know is the check the version number before compiling and installing. See my post above,&nbsp;</p>
<p>@gregl please could you provide more info regarding the issue you are experiancing&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39500"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8298.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8298.jpg" alt="Jon&#039;s picture" title="Jon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/8298.html" title="View user profile.">Jon</a> on Wed, 17/02/2016 - 16:49.</div>
    <div class="content">
     <p>Glyn - Concerning Backup / Import -&nbsp;for me it filled because of the uploaded tar.gz file in the upload directory (33 MB total)&nbsp;and the uncompressed files in the import directory (~99 MB total). &nbsp;With both of those directories equals&nbsp;132 MB and that filled the /home/pi/data area.</p>
<p><strong>EDIT: </strong>added attachment - Listing of /data directory</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39501"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9478.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jason&#039;s picture" title="jason&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/9478.html" title="View user profile.">jason</a> on Wed, 17/02/2016 - 18:36.</div>
    <div class="content">
     <p>I&#39;ve taken a look at what happens for the &quot;Engine ID&quot; issue. Looking through feed_model.php and adding a pile of debug, I can see how the logic is supposed to work. Clearly there is a feed with an unknown &quot;engine&quot; type.</p>
<p>I looked at what is happening with redis&nbsp;- and using the MONITOR command, I noticed that something is creating 5 nodes:</p>
<pre>
... &quot;EXISTS&quot; &quot;user:feeds:1&quot;

... &quot;SADD&quot; &quot;user:feeds:1&quot; &quot;1&quot;

... &quot;HMSET&quot; &quot;feed:1&quot; &quot;id&quot; &quot;1&quot; &quot;userid&quot; &quot;1&quot; &quot;name&quot; &quot;Node emonpi&quot; &quot;datatype&quot; &quot;0&quot; &quot;tag&quot; &quot;&quot; &quot;public&quot; &quot;0&quot; &quot;size&quot; &quot;&quot; &quot;engine&quot; &quot;1&quot; &quot;processList&quot; &quot;&quot;

... &quot;SADD&quot; &quot;user:feeds:1&quot; &quot;2&quot;

... &quot;HMSET&quot; &quot;feed:2&quot; &quot;id&quot; &quot;2&quot; &quot;userid&quot; &quot;1&quot; &quot;name&quot; &quot;Node emonpi&quot; &quot;datatype&quot; &quot;0&quot; &quot;tag&quot; &quot;&quot; &quot;public&quot; &quot;0&quot; &quot;size&quot; &quot;&quot; &quot;engine&quot; &quot;1&quot; &quot;processList&quot; &quot;&quot;

... &quot;SADD&quot; &quot;user:feeds:1&quot; &quot;3&quot;

... &quot;HMSET&quot; &quot;feed:3&quot; &quot;id&quot; &quot;3&quot; &quot;userid&quot; &quot;1&quot; &quot;name&quot; &quot;Node emonpi&quot; &quot;datatype&quot; &quot;0&quot; &quot;tag&quot; &quot;&quot; &quot;public&quot; &quot;0&quot; &quot;size&quot; &quot;&quot; &quot;engine&quot; &quot;1&quot; &quot;processList&quot; &quot;&quot;

... &quot;SADD&quot; &quot;user:feeds:1&quot; &quot;4&quot;

... &quot;HMSET&quot; &quot;feed:4&quot; &quot;id&quot; &quot;4&quot; &quot;userid&quot; &quot;1&quot; &quot;name&quot; &quot;Node emonpi&quot; &quot;datatype&quot; &quot;0&quot; &quot;tag&quot; &quot;&quot; &quot;public&quot; &quot;0&quot; &quot;size&quot; &quot;&quot; &quot;engine&quot; &quot;1&quot; &quot;processList&quot; &quot;&quot;

... &quot;SADD&quot; &quot;user:feeds:1&quot; &quot;5&quot;

... &quot;HMSET&quot; &quot;feed:5&quot; &quot;id&quot; &quot;5&quot; &quot;userid&quot; &quot;1&quot; &quot;name&quot; &quot;Node emonpi&quot; &quot;datatype&quot; &quot;0&quot; &quot;tag&quot; &quot;&quot; &quot;public&quot; &quot;0&quot; &quot;size&quot; &quot;&quot; &quot;engine&quot; &quot;1&quot; &quot;processList&quot; &quot;&quot;</pre><p>Looking at where this comes from, it seems to be from feed_controller.php:44 - and the &#39;engine&#39; comes from &quot;get(&#39;engine&#39;)&quot; call ...&nbsp;</p>
<p>I will continue tracing this through...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39502"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9478.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jason&#039;s picture" title="jason&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/9478.html" title="View user profile.">jason</a> on Wed, 17/02/2016 - 18:41.</div>
    <div class="content">
     <p>I spent a bit of time with this - from what I can see, by adding debug into feed_model.php and using redis-cli to monitor what is going on, there seems to be a problem right from feed_controller.php:44 where the result of &quot;get(&#39;engine&#39;)&quot; is passed into create() in feed_model.php.</p>
<p>I now need to trace where the &quot;get(&#39;engine&#39;)&quot; goes to ...</p>
<p>My guess is that there is something wrong with the intial set up - so I will re-image the SD card and try again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39503"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 17/02/2016 - 19:18.</div>
    <div class="content">
     <p>@jon if you have flashed the image onto a card larger than 4gb you should expand the data partition to fill the remaining space on the card. There are many ways to do this. My preference would be insert that card into your computer and use gparted on Linux to expand the partition. I'm sure there are equivalent window tools and it's probably possible to do direct on the P</p>
<p>@jason thanks for debug output I will investigate </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39576"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 21/02/2016 - 00:05.</div>
    <div class="content">
     <p>@sheppy Sorry for slow reply, I have been away. Thanks for the backup file. I&#39;m not sure why it&#39;s failing to upload via php. The settings set in php.ini should allow up to&nbsp;200Mb. However for large&nbsp;imports&nbsp;it&#39;s probably best do to manual import. I have added&nbsp;note to backup modules instructions:</p>
<p><a href="https://github.com/emoncms/backup/" title="https://github.com/emoncms/backup/">https://github.com/emoncms/backup/</a></p>
<p>You will need to expand the data partition.&nbsp;Default&nbsp;emonPi&nbsp;image has a RW ~/data partition of&nbsp;150Mb, size of uncompressed backup must be less. If using an SD card &gt; 4GB (default&nbsp;emonPi&nbsp;is 8GB) the data&nbsp;partition&nbsp;can be expanded to fill the rest of the SD card 4GB+ using&nbsp;gparted&nbsp;tool or equivalent.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39590"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8204.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8204.png" alt="Rich.T.&#039;s picture" title="Rich.T.&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/8204.html" title="View user profile.">Rich.T.</a> on Sun, 21/02/2016 - 12:40.</div>
    <div class="content">
     <p>I have been having regular wifi dropouts on my emonPi for ages now and did not realise that there had been several major updates since I received the device, after backing it on Kickstarter. I have asked about this particular problem on the forum without much success, but did not have a lot of time to look through the forum properly. Only recently did I discover that a major update had been released last June which may have solved my problem.</p>
<p>After checking over the last few days, I see that there have recently been major update efforts, including moving to Minibian and then Raspbian Jessie Light (after the PiZero came out), as well as loads of functionality improvements.</p>
<p>I have spent as much time as I have been able to in catching up and have stumbled upon encouraging information and also a few problems during the process.</p>
<p>I discovered by looking through the filesystem, that my device has been running &quot;emonpi-28may2015&quot;, which could have been the cause of my problems. I therefore decided that it would probably be better for me to have a go with the latest beta (rather than installing the June update) as I really wanted to have a look at all the new features I&#39;d missed out on.</p>
<p>The major problem I have come upon has been with the Backup module:</p>
<p>The first issue I had was, although I followed the instructions in the Readme.md at <a href="https://github.com/emoncms/backup" title="https://github.com/emoncms/backup">https://github.com/emoncms/backup</a> and rebooted, I could not find the Backup page in emonCMS, as the web interface was evidently a (pre-release) old-style one (which I intuited from the screenshot on GitHub). Thankfully, I had the idea of manually entering the URL: <a href="http://emonpi/emoncms/*backup*" title="http://emonpi/emoncms/*backup*">http://emonpi/emoncms/*backup*</a> and so was then able to export my data, saving the resulting &quot;.tar.gz&quot; file to my PC.</p>
<p>(This problem should be documented, as, like myself, many people may have many months worth of useful data collecting on their emonPi&#39;s, which they will not want to sacrifice in order to upgrade.)</p>
<p>The second problem I have run into is that I have not been able to import this data into my new emonPi installation. This is the biggie...</p>
<p>(At this stage, I need to tell you how I have gone about the upgrade process and let you draw your own conclusions about my methodology.)</p>
<p>In order to prevent any major downtime; rather than simply backup my data, wipe my emonPi &micro;SD card and DD the new OS image, I did this:</p>
<p>1. After trying to flash the new image on various 4GB cards and failing due to lack of available space (N.B. The card I got with my emonPi was ~3.75GB), I eventually selected a 16GB &micro;SD card and successfully DD&#39;d the image to it. I then expanded it&#39;s partitions using Gparted.</p>
<p>2. I inserted this card into a spare Raspberry Pi 2, booted and then browsed the new web interface from my PC.</p>
<p>3. I navigated to the *backup* page, selected the file &quot;emoncms-backup-2016-02-**.tar.gz&quot; from my home folder and clicked &quot;Import Backup&quot;.</p>
<p>4. It failed!</p>
<p>&nbsp;&nbsp; The result was a simple webpage displaying the message &quot; There was an error uploading the file, only .tar.gz are allowed. &quot;</p>
<p>&nbsp;&nbsp; I tried all of this several times and in several different ways, but was unable to get the new system to accept the backup file at all.<br />
&nbsp; &nbsp;<br />
&nbsp;&nbsp; I then gave up on trying to minimise downtime of my emonPi, taking it apart and replacing the SD card with the new one, rebooting and failing again.</p>
<p>5. Not giving up, I installed *MC* on the emonPi, trawled the filesystem, then checked and noted the ownership and permissions of all of the relevant data files and folders.</p>
<p>6. Next, I extracted the files and folders from the backup archive on my desktop, scp&#39;d them to the Pi, deleted the originals from the Pi and copied the new ones into place:<br />
&nbsp;</p>
<p>&nbsp;&nbsp; &nbsp;Files:&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; User:&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Group:<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/emoncms.conf&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;pi&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; www-data<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/emoncms.sql&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; pi&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; pi<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/emonhub.conf&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; pi&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; www-data</p>
<p>&nbsp;&nbsp; &nbsp;Folders:&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; User:&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; Group:<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/phpfina/&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; www-data&nbsp;&nbsp; &nbsp;root<br />
&nbsp;&nbsp; &nbsp;(contained files)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="http://www.xn--data-yeaa/" title="www.data  ">www.data  </a> &nbsp;www-data<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/phptimeseries/&nbsp; &nbsp; &nbsp;&nbsp; <a href="http://www.xn--data-yeaa/" title="www.data  ">www.data  </a> &nbsp;root<br />
&nbsp;&nbsp; &nbsp;(contained files)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; N/A&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; N/A</p>
<p>7. It failed again!<br />
&nbsp;&nbsp; I have tried to fiddle with the permissions and ownership of the backed-up and restored data, restarted services, clicked on various buttons, updated emonCMS etc. etc. etc...<br />
&nbsp; &nbsp;<br />
&nbsp;&nbsp; Nothing so far has worked.<br />
&nbsp;&nbsp; What am I doing wrong here?</p>
<p>Please help me out,</p>
<p>Rich.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39599"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 21/02/2016 - 14:04.</div>
    <div class="content">
     <p>@ritch&nbsp;</p>
<p>Sorry to hear you having trouble updating. See my comments in line below:</p>
<p>The major problem I have come upon has been with the Backup module:</p>
<p>The first issue I had was, although I followed the instructions in the Readme.md athttps://github.com/emoncms/backup&nbsp;and rebooted, I could not find the Backup page in emonCMS, as the web interface was evidently a (pre-release) old-style one (which I intuited from the screenshot on GitHub). Thankfully, I had the idea of manually entering the URL:&nbsp;http://emonpi/emoncms/*backup*&nbsp;and so was then able to export my data, saving the resulting &quot;.tar.gz&quot; file to my PC.</p>
<p>(This problem should be documented, as, like myself, many people may have many months worth of useful data collecting on their emonPi&#39;s, which they will not want to sacrifice in order to upgrade.)</p>
<p><strong>GLYN: thanks, I&#39;ve <a href="https://github.com/emoncms/backup/commit/f3d9bd3c99392642ada9f984a84967e8339a5752">added note the the backup module</a>&nbsp;</strong></p>
<p>The second problem I have run into is that I have not been able to import this data into my new emonPi installation. This is the biggie...</p>
<p>(At this stage, I need to tell you how I have gone about the upgrade process and let you draw your own conclusions about my methodology.)</p>
<p>In order to prevent any major downtime; rather than simply backup my data, wipe my emonPi &micro;SD card and DD the new OS image, I did this:</p>
<p>1. After trying to flash the new image on various 4GB cards and failing due to lack of available space (N.B. The card I got with my emonPi was ~3.75GB), I eventually selected a 16GB &micro;SD card and successfully DD&#39;d the image to it. I then expanded it&#39;s partitions using Gparted.</p>
<p><strong>GLYN: Great, good work.&nbsp;</strong></p>
<p>2. I inserted this card into a spare Raspberry Pi 2, booted and then browsed the new web interface from my PC.</p>
<p>3. I navigated to the *backup* page, selected the file &quot;emoncms-backup-2016-02-**.tar.gz&quot; from my home folder and clicked &quot;Import Backup&quot;.</p>
<p>4. It failed!</p>
<p>&nbsp;&nbsp; The result was a simple webpage displaying the message &quot; There was an error uploading the file, only .tar.gz are allowed. &quot;</p>
<p>&nbsp;&nbsp; I tried all of this several times and in several different ways, but was unable to get the new system to accept the backup file at all.<br />
&nbsp; &nbsp;<br />
&nbsp;&nbsp; I then gave up on trying to minimise downtime of my emonPi, taking it apart and replacing the SD card with the new one, rebooting and failing again.</p>
<p><strong>GLYN: if your backup file to be restored is large, whch id porobably is if you have been logging since May15 then I recommend you follow the <a href="https://github.com/emoncms/backup/blob/master/readme.md#manual-import-instructions">manual import steps as detailed in the backup module readme</a>. There is still an issue with uploading large files via PHP web interface.&nbsp;</strong></p>
<p>5. Not giving up, I installed *MC* on the emonPi, trawled the filesystem, then checked and noted the ownership and permissions of all of the relevant data files and folders.</p>
<p>6. Next, I extracted the files and folders from the backup archive on my desktop, scp&#39;d them to the Pi, deleted the originals from the Pi and copied the new ones into place:<br />
&nbsp;</p>
<p>&nbsp;&nbsp; &nbsp;Files:&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; User:&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Group:<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/emoncms.conf&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;pi&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; www-data<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/emoncms.sql&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; pi&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; pi<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/emonhub.conf&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; pi&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; www-data</p>
<p>&nbsp;&nbsp; &nbsp;Folders:&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; User:&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; Group:<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/phpfina/&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; www-data&nbsp;&nbsp; &nbsp;root<br />
&nbsp;&nbsp; &nbsp;(contained files)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;www.data&nbsp;&nbsp;&nbsp;&nbsp;www-data<br />
&nbsp;&nbsp; &nbsp;/home/pi/data/phptimeseries/&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;www.data&nbsp;&nbsp;&nbsp;&nbsp;root<br />
&nbsp;&nbsp; &nbsp;(contained files)&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; N/A&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; N/A</p>
<p>7. It failed again!<br />
&nbsp;&nbsp; I have tried to fiddle with the permissions and ownership of the backed-up and restored data, restarted services, clicked on various buttons, updated emonCMS etc. etc. etc...<br />
&nbsp; &nbsp;<br />
<strong>GLYN: You need to restore the Emoncms mysql database as well as restoring the files.&nbsp;I recommend&nbsp;running the emoncms-import.sh script &nbsp;manually (see link above). I would recommend starting with a fresh image using the latest&nbsp;RC&nbsp;image posted this morning:&nbsp;<a href="12212.html">http://openenergymonitor.org/emon/node/12212</a></strong></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39600"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: (BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 21/02/2016 - 14:06.</div>
    <div class="content">
     <p>Thanks for your help testing, I have just posted what I hope is a&nbsp;Release&nbsp;Candidate image emonSD-20Feb16.&nbsp;</p>
<p><a href="12212.html">http://openenergymonitor.org/emon/node/12212</a></p>
<p>Please post issues for this image on the new RC thread.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12189"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-icBrz28CmMSP2KnBumOGwXKVaylFTpfnqknLmk3fcPM" value="form-icBrz28CmMSP2KnBumOGwXKVaylFTpfnqknLmk3fcPM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
