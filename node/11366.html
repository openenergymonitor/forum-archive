<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11366 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:54:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emonhub on python3 and keep alive | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emonhub on python3 and keep alive</h3>
        <span class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Sun, 11/10/2015 - 09:22</span>
        <div class="content"><p>Hi,</p>
<p>I&#39;ve made some changes to emonhub to support running on both python3 and python 2.x (currently it only supports 2.x).</p>
<p>I&#39;ve also tweaked the http reporter to make use of HTTP Keep-Alive&nbsp;- this cuts the amount of network traffic&nbsp;by about half (as the TCP connection stays open between data items, so the repeated TCP set-up and tear-down traffic&nbsp;doesn&#39;t happen).</p>
<p>I&#39;ve based this on&nbsp;git@github.com:openenergymonitor/emonhub.git</p>
<p>If there&#39;s an appetite to merge either of these, please let me know&nbsp;I&#39;ll tidy them up and rebase them if necessary.</p>
<p>Tim.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11377.html" class="topic-previous" title="Go to previous forum topic">‹ emonPi / emonBase, MQTT and node-RED</a>
              <a href="11372.html" class="topic-next" title="Go to next forum topic">Change API keys? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-34831"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub on python3 and keep alive</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sun, 11/10/2015 - 14:29.</div>
    <div class="content">
     <p><em>I&#39;ve based this on&nbsp;git@github.com:openenergymonitor/emonhub.git</em></p>
<p>...which is the&nbsp;emonpi&nbsp;variant - and not the <a href="https://github.com/emonhub/emonhub">emonhub version</a> currently used in v9.0 RC2. <em>(for info)</em></p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34848"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub on python3 and keep alive</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Mon, 12/10/2015 - 08:23.</div>
    <div class="content">
     <p>I find in general that there&#39;s a bit of a dearth of info about which versions developers should be targeting changes at. &nbsp;Something along the lines of a contributing section on the web site, or just a note in the README for each git tree would be fine (e.g. &quot;use this for x, but don&#39;t develop on it unless y, please use the z tree instead&quot;) etc.</p>
<p>OpenVPN (to pick a project at random) has a couple of wiki pages like this:</p>
<p><a href="https://community.openvpn.net/openvpn/wiki/Contributing" title="https://community.openvpn.net/openvpn/wiki/Contributing">https://community.openvpn.net/openvpn/wiki/Contributing</a></p>
<p><a href="https://community.openvpn.net/openvpn/wiki/DeveloperDocumentation" title="https://community.openvpn.net/openvpn/wiki/DeveloperDocumentation">https://community.openvpn.net/openvpn/wiki/DeveloperDocumentation</a></p>
<p>Possibly the info is in the forums somewhere, but it&#39;s difficult to find, and difficult to know if a particular post is&nbsp;up to date -&nbsp;&quot;You are in a maze of twisty little passages, all alike&quot;.</p>
<p>I&#39;ll be happy to get these changes ready to merge against whichever tree I should be targeting, so long as I know that there is an appetite to see these features, and I know which tree that is...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34850"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub on python3 and keep alive</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Mon, 12/10/2015 - 10:43.</div>
    <div class="content">
     <p>I&#39;d certainly like to see this and Paul would know (and has said) which tree to target</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub on python3 and keep alive</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 12/10/2015 - 10:44.</div>
    <div class="content">
     <p>The <a href="https://github.com/emonhub/emonhub">main &#39;emonhub&#39; version</a> was/is being developed&nbsp;by Paul Burnell, and is which is&nbsp;being used in v9.0 RC - which is the current emoncms&nbsp;release.</p>
<p>However, whilst developing the emonpi, Trystan&nbsp;found it necessary to make changes to emonhub, in effect creating a tweaked version solely for the emonpi. The two are not interchangeable.</p>
<p><em>so long as I know that there is an appetite to see these features,</em></p>
<p>I think that there is always an appetite&nbsp;for improvement and further development - see what <a href="11009.html">Chaveiro has achieved</a> in v9, and I would assume that <a href="https://github.com/emonhub/emonhub">development branch</a>&nbsp;of Paul&#39;s git repo would be the appropriate start point, however, let&#39;s hopefully get some feedback from Paul Burnell first.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34854"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub on python3 and keep alive</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 12/10/2015 - 12:10.</div>
    <div class="content">
     <p>@Tim - I had previously&nbsp;looked into the python3 jump for emonHub and the info I found suggested development for both 2.7 and 3.4&nbsp;simultaneously was difficult and it was easier&nbsp;to &quot;convert&quot; 2.7 code to 3.4 than the other way round. so being more familiar with 2.7 and the fact emonHub was already 2.7 I decided this wasn&#39;t a bridge I had to cross just yet. I thought I would postpone the change until after the major changes as I had enough to tackle etc etc. I did wonder at the time how do I continue the simultaneous dev for 2.7 and 3.4&nbsp;after making the switch but again, it wasn&#39;t something I had to figure out if sticking with 2.7 for now.</p>
<p>I am keen to adopt 3.4 changes but need to evaluate the full (ongoing) picture to make an informed decision so please feel free to show me you proposed changes and/or advise/steer me in the correct direction.</p>
<p>The &quot;keep alive&quot; sounds good and was something I had wanted to explore for another part of emonHub, How does this effect the server? would emoncms.org see more or less traffic? when it comes to traffic emoncms.org has to be the biggest concern, unless using a pay per byte data service to a private server etc. How does this scale? does it offer a saving across the board or just frequent posting? Correct me if I&#39;m wrong (which isn&#39;t unlikely)&nbsp;but would there be a point where this becomes efficient and before that occasional posting better as it is? if so it&nbsp;doesn&#39;t mean it cannot be useful, just that some settings or logic applied to manage it.</p>
<p>I&#39;m currently tied up on something that is consuming all my time, which is why I&#39;ve not been about over the last couple of weeks, please don&#39;t think I&#39;m not interested, I would like to pick up the emonHub dev again if the interest is there.</p>
<p>I will post some thoughts and a status of emonhub or maybe add some notes to the repo to help explain the branches, versions and proposed&nbsp;future of emonhub.</p>
<p>Paul&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34858"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub on python3 and keep alive</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Mon, 12/10/2015 - 13:13.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>I&#39;ve not got too much knowledge of Python, but I was chasing a bug which I thought may have been down to a particular library version on python2.7 (it wasn&#39;t in the end), the changes just involved using the 2to3 utility from python3.4, along with some manual changes to work around a couple of language differences (which didn&#39;t seem too offensive).</p>
<p>In my testing, the resultant code worked under both 2.7 and 3.4.</p>
<p>&nbsp;</p>
<p>Re the keepalive&nbsp;support, the upshot should be a saving in bandwidth (should be&nbsp;around a half, but I can check)&nbsp;and CPU on both the client end and the server end due to TCP connection setup and tear down.</p>
<p>With the default Apache config on Debian/Ubuntu etc. the default keep-alive time is 5 seconds, so to be effective the server config would need to be changed to a keep-alive period&nbsp;which is longer than the (typical) emonhub reporting interval. &nbsp;I used 70 seconds in my testing.</p>
<p>When using Apache+mod_php, and longer keep-alives&nbsp;I&#39;d expect the RAM usage to increase (as there will be more apache processes sitting around, and each has a full copy of PHP in-process), so it would probably be better to switch to PHP-FPM.</p>
<p>Having said that PHP-FPM is&nbsp;probably the best thing to use for running PHP these days&nbsp;with or without keep-alive,&nbsp;this would have the effect of making the number of copies of PHP in RAM just dependent on the number of concurrent PHP code executions (instead of being reliant on the number of HTTP connections - including those which are serving static content which are nothing to do with PHP).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34880"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub on python3 and keep alive</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 12/10/2015 - 19:29.</div>
    <div class="content">
     <p>I&#39;m not going to pretend to understand the wizardry&nbsp;of php or the inner workings of a server so I will need to take your word and/or wait to hear from T&amp;G on this, or maybe Chaveiro&nbsp;could comment as I have very little involvement on the emoncms side of things, but certainly if emoncms was &quot;keep alive&quot; ready it could be viable.</p>
<p>I am planning to split the current emoncms http reporter into 2 reporters to help users report to other endpoints without the complication of the emoncms stuff so there will be a basic http reporter and then a emoncmshttp reporter would inherit from that and add the more emoncms specific formatting etc, so it could be possible to add it as a optional setting to the generic http reporter and use as appropriate in the emoncmshttp reporter.</p>
<p>Can you link to some example code?</p>
<p>Regards the python3, I think the better route (for me) at the moment would be to continue in 2.7 and convert later if there is no immediate benefit, your &quot;converted code&quot; won&#39;t necessarily be portable or merge from the&nbsp;<span style="line-height: 20.8px;">&quot;converted&nbsp;</span>emon-pi<span style="line-height: 20.8px;">&quot;&nbsp;</span><span style="line-height: 1.6;">to another repo anyhow, so&nbsp;may as well run the </span>2to3<span style="line-height: 1.6;"> utility once most of the new stuff is in perhaps.</span></p>
<p><span style="line-height: 1.6;">But I would still like to see what you have if it&#39;s possible, a &quot;before and after 2to3&quot; for the emon-pi variant&nbsp;may give me an insight into what to aim for (or avoid) whilst moving closer to the conversion and any pointers/advice or assistance&nbsp;you may be able to offer would be very appreciated too.</span></p>
<p><span style="line-height: 1.6;">Paul</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34882"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub on python3 and keep alive</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 12/10/2015 - 19:50.</div>
    <div class="content">
     <p>Paul, would there be any mileage in creating a new git branch in emonhub which Tim could fork, and lay down his ideas, which you can both work on collaboratively?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11366"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-FOOz7NWIIyHRly2jXo0rtKbS59W-QM3nK0zQCfi6ISk" value="form-FOOz7NWIIyHRly2jXo0rtKbS59W-QM3nK0zQCfi6ISk"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
