<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/167 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:07:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>SD Card Logging Power Monitor with LCD | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">SD Card Logging Power Monitor with LCD</h3>
        <span class="submitted">Submitted by Guest on Sun, 05/06/2011 - 22:12</span>
        <div class="content"><h1>
	SD Card Logging Power Monitor with LCD</h1>
<p>By John (OpenEnergyMonitor username: MaxAmp)</p>
<p><a href="../sites/default/files/email.jpg"><img alt="" src="../sites/default/files/email.jpg" /></a></p>
<table border="1" cellpadding="1" cellspacing="1" height="215" width="582">
<tbody>
<tr>
<td>
<p><a href="../sites/default/files/meter.jpg">&nbsp;<img alt="" height="177" src="../sites/default/files/meter.jpg" width="192" /> </a></p>
</td>
<td>
				&nbsp;&nbsp;<br />
				&nbsp;</p>
<p><a href="../../../community.openenergymonitor.org/emon/sites/default/files/logger.html"><img alt="" height="181" src="../../../community.openenergymonitor.org/emon/sites/default/files/logger.html" width="241" /></a></p>
</td>
<td>
				&nbsp;&nbsp;&nbsp;<a href="../sites/default/files/LCD.jpg"><img alt="" height="213" src="../sites/default/files/LCD.jpg" width="230" /></a>&nbsp;&nbsp;</td>
</tr>
</tbody>
</table>
<p>I combined two projects on this site with an LCD</p>
<p><strong><strong><strong><strong><a href="58.html">Mains AC energy monitor v3.0 - basic setup&nbsp;</a></strong></strong></strong></strong></p>
<p><strong><strong><strong><a href="135.html">Data logging for wind speed (and DC current using invasive hall sensor)</a></strong></strong></strong></p>
<p>&nbsp;</p>
<p>and</p>
<p><strong><strong><strong><a href="http://www.nuelectronics.com/estore/index.php?main_page=product_info&amp;cPath=1&amp;products_id=12&amp;zenid=fa24ff67944c170d2e61045d55c4c4f6">Nokia 3310 LCD shield</a></strong></strong></strong></p>
<p>In the center picture above, the proto board has the voltage and current circuit from the <a href="58.html">Mains AC energy monitor</a>.&nbsp; The +5v, ground, voltage and current signals are connected into the <a href="http://www.nuelectronics.com/estore/index.php?main_page=product_info&amp;cPath=7&amp;products_id=20">data logging shield</a> current to port P5 and voltage to port P6 (<a href="http://www.nuelectronics.com/download/projects/sensor_shield_v1.0.pdf">pdf here</a>).&nbsp; I am using a 100A sensor (<a href="http://www.seeedstudio.com/depot/noninvasive-ac-current-sensor-100a-max-p-547.html?cPath=144_154">here</a>).&nbsp; The LCD (enlarged in right picture above) is displaying from top to bottom: real power, appent power (almost the same as the watt meter which is enlarged in the left picture above), power factor, voltage (US 120V), current, date and time stamp.&nbsp; The <a href="http://www.nuelectronics.com/estore/index.php?main_page=product_info&amp;cPath=7&amp;products_id=20">data logging shield</a> has a real time clock built in.&nbsp; To the right most edge of the&nbsp; <a href="http://www.nuelectronics.com/estore/index.php?main_page=product_info&amp;cPath=7&amp;products_id=20">data logging shield</a>, an SD card is plugged in and data is logged in csv (comma seperated value format) file (see picture below). &nbsp;See attached file below for the source code.&nbsp; The main loop goes throgh a sequence of getting the time stamp, measuring power, sending data to serial output (USB port to computer), sending data to SD for logging, sending data to LCD.&nbsp; This sequence is repeated forever.&nbsp; When power up, it will wait for an SD card to be inserted.&nbsp; After the SD card is instered, there is currently no way to stop data logging or read SD card data from the arduino.&nbsp; Data is currently viewed from a computer.&nbsp; I used the offical arduino SD library built into arduino software <a href="http://arduino.cc/en/Main/Software">here</a>, the DS1302.h file for real time clock <a href="http://www.nuelectronics.com/download/projects/sensor_pff.zip">here</a>, the nokia lcd library <a href="http://www.nuelectronics.com/download/projects/nokia_3310_lcd_180110.zip">here</a>, and the emon library <a href="../sites/default/files/emonLib.tar.gz">here</a>.&nbsp; I got the double to string conversion <a href="http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1207226548/15">here</a>.&nbsp; Note that this is my first time getting two SPI device working at the same time (SD&nbsp;&amp;&nbsp;LCD).&nbsp; If you know of a better way to do it please post.</p>
<p>&nbsp;</p>
<p><img alt="" height="361" src="../../../i1180.photobucket.com/albums/x416/max-amp/SD_data.jpg" width="606" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10315.html" class="topic-previous" title="Go to previous forum topic">‹ Cyble sensor compatibility EmonTx v3.4 (pulse counting)</a>
              <a href="10566.html" class="topic-next" title="Go to next forum topic">Utility meter magnetic attachment?  ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-1819"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Logging Power Monitor with LCD</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 06/06/2011 - 09:58.</div>
    <div class="content">
     <p>&nbsp;Hi John,</p>
<p>Fantastic work! I love it. This will be of use for many people. Couple of minor things:</p>
<ul>
<li>Could you update your name at the top of the page and insert your email address, &nbsp;free to link to any website or blog you might have</li>
<li>I have changed the name of the post to include to words 'SD card' this should make it easier for people to search for it</li>
<li>I have uploaded the image and your code onto our server, see attached at the bottom for your code</li>
<li>I have inserted comments int your code to indicate where the various libraires used have come from. Where did you download the SD card library from? Please could you put a link in the code.&nbsp;</li>
<li>A photo showing what's displayed on the LCD would be great&nbsp;</li>
</ul>
<p>I like how you have posted on the forum then linked through to case studies, I think this is something we might begin to do in the future. Good for keeping things organised.&nbsp;</p>
<p>Keep up the good work!</p>
<p>All the best, Glyn.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1829"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MaxAmp&#039;s picture" title="MaxAmp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Logging Power Monitor with LCD</h3>

    <div class="submitted">Submitted by MaxAmp (not verified) on Tue, 07/06/2011 - 02:00.</div>
    <div class="content">
     <p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1833"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Logging Power Monitor with LCD</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 07/06/2011 - 09:53.</div>
    <div class="content">
     <p>Thanks for making the changes. Looks great.</p>
<p>Glyn. &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1837"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Logging Power Monitor with LCD</h3>

    <div class="submitted">Submitted by Guest on Tue, 07/06/2011 - 16:29.</div>
    <div class="content">
     <p>Hello John,</p>
<p>I've run the last half year the following configuration:</p>
<p>Base station:<br />
- Arduino mega2560 official arduino shield<br />
- official SD card and ethernet shield<br />
- LCD monitor (2x16 chars)<br />
- RFM12 tranceiver<br />
- DS1820 temperature sensor<br />
--> master that logs the power / temperature from the slave(s) and also acts as a PID temperature regulator (for controlling the heaters). It acts also as a webserver:<br />
- when request on client windows, it can send over the .csv logged file to the pc or delete it on the SD<br />
- when rquest , it can send to the client pc a status page of the base station<br />
- sets the time (via ntp)</p>
<p>Slave: jeenode with CT sensor (for power), based on openenergy 3.0 software +  DSB1820 temperature sensor</p>
<p>On my pc, I use the emoncms database. Every day a task gets the csv file (from base station over ethernet), convert it to emoncms rows and insert the new entries in emoncms. I also have written some graphs in JPgraph to follow my energy use.</p>
<p>My experience with several devices on the same SPI bus:<br />
when accessing the ethernet device (fe. send over a 30 MB csv file to the client pc), the mega hangs when receiving on the same time a RF pakkage. (it rarely happen, once a month), but is annoying. As it is a Mega2560, the internal WDT won't work and there are no alternative bootloaders yet available.</p>
<p>So: forsee the watchdogtimer when your processor hangs due to SPI issues.</p>
<p>Best regards,<br />
Jeroen.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1844"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Logging Power Monitor with LCD</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sat, 11/06/2011 - 22:29.</div>
    <div class="content">
     <p>Hi Jeroen,</p>
<p>Sounds like you have a great setup. Very very impressive. &nbsp;</p>
<p>Please could you could share your code and maybe a photo or two? I will then create a page for it in the&nbsp;<a href="57.html">build examples</a>&nbsp;section. It would definatly be usefull to others. Or it would be fantastic if you did it yourself, this whole site is an editable wikki.</p>
<p>I'm afraid I dont have any experiance using a mega2560 so I can't really help you with your watchdog problems. Are you using the RFM12 library from JeeLabs?&nbsp;</p>
<p>We have receantly been working a PCB design for a unit called the emonTx. It is basicly exactly the same as what you have as your slave node:&nbsp;<a href="../emontx.html">http://openenergymonitor.org/emon/emontx</a></p>
<p>All the best, Glyn.&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14424"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mlemos&#039;s picture" title="mlemos&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Logging Power Monitor with LCD</h3>

    <div class="submitted">Submitted by mlemos (not verified) on Sat, 17/08/2013 - 23:10.</div>
    <div class="content">
     <p>Hi Jeroen &amp; John, I saw your thread and I belive you can help me.</p>
<p>I&#39;m having some issues with EmonLib and SD (on the official Arduino Ethernet R3 Shield). It seems that there is some incompatibility between the EmonLib and the SD library. If I have any reading bigger than zero (ground) on the analog input and I try to use the SD on the same time the Arduino resets. Things go fine if reading is zero or if I&#39;m not using the SD (sd card is not inserted).</p>
<p>My code is here:&nbsp;https://gist.github.com/mlemos/6258371</p>
<p>And my wiring is below.</p>
<p>Did you had any similar problem with the SD library?</p>
<p>I did tried my code on the MEGA to exclude any memory issues and I had exactly the same problem. :(</p>
<p>Any help is welcome.</p>
<p>;-)</p>
<p><img alt="" height="562" src="../sites/default/files/Screen%20Shot%202013-08-17%20at%206.59.49%20PM.png" width="638" /></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14427"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Logging Power Monitor with LCD</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 17/08/2013 - 23:45.</div>
    <div class="content">
     <p>The above post has been answered here: <a href="2709.html" title="http://openenergymonitor.org/emon/node/2709">http://openenergymonitor.org/emon/node/2709</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31435"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7718.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hanguyen&#039;s picture" title="hanguyen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Logging Power Monitor with LCD</h3>

    <div class="submitted">Submitted by <a href="../user/7718.html" title="View user profile.">hanguyen</a> on Wed, 17/06/2015 - 12:38.</div>
    <div class="content">
     <p>in the link below is my AC watt meter non invasive, which I follow the code from this site. IT can write data to SD Card modul, then we can extract data to excel to graph it. I dont have time to make instructions because it depend on your modul, library. But you can search the code on internet.<br />
<a href="https://www.youtube.com/watch?v=PWSRRgSsLOQ" title="https://www.youtube.com/watch?v=PWSRRgSsLOQ">https://www.youtube.com/watch?v=PWSRRgSsLOQ</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/167"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-tk-6mGVWGsJjHIm2Z26BlJ5qHzCVZYfl8l722v5I2nw" value="form-tk-6mGVWGsJjHIm2Z26BlJ5qHzCVZYfl8l722v5I2nw"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/167 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:07:35 GMT -->
</html>
