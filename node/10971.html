<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10971 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:46:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Having trouble with Single Phase Power | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Having trouble with Single Phase Power</h3>
        <span class="submitted">Submitted by <a href="../user/8314.html" title="View user profile.">nigel91</a> on Fri, 10/07/2015 - 09:26</span>
        <div class="content"><p>I have recently been taking up tutorials&nbsp;of emoTX. I built my system using a breadboardand taking the emontx3 as a base . my current sensors are standard SCT-013-000, voltage sensor i&nbsp;used a power transformer 230-09V, .</p>
<p>1)CT = Burden resistance = 33 ohm , Capacitor &nbsp;is 10UF , calibration 60.6</p>
<p>2) V = &nbsp;10k&nbsp;and&nbsp;100k&nbsp;divider , 470k&nbsp;divider &nbsp;, 236Vac&nbsp;supply &nbsp;output of my VT =&nbsp;</p>
<p>i attached everything to a relay so you will see my relay code&nbsp;</p>
<p>supply is 5 volts</p>
<p>Using the arduino Mega 2560&nbsp;</p>
<p>###1###The problem i am facing is even when taking reading of items below 50W if measuring from 1 source i get the correct reading .but when i measure from three sources all the values become distorted . Is there any reason to this . I&nbsp;am measuring a&nbsp;single phase&nbsp;system and my at the plug side . so i am connecting my cellphone ,laptop , soldering iron and glue gun. Sometimes i put a 60W&nbsp;bulb and it gives me readings of up to 100W. I dont know if this is normal ###.2##Secondly was wondering if i can print or call each variable individually.because i saw a sketch here but kept getting errors . (&nbsp;https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/Guide/c_ACVoltage/c_ACVoltage.ino )&nbsp;</p>
<p>&nbsp;Below is a sample of my code ....&nbsp;</p>
<p>#include &quot;EmonLib.h&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Include Emon Library<br />
EnergyMonitor emon1, emon2, emon3, emon4,realPower,apparentPower,Vrms,Irms,powerFactor; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Create an instance<br />
#define RELAY1 &nbsp;2&nbsp;<br />
#define RELAY2 &nbsp;3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
#define RELAY3 &nbsp;4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
#define RELAY4 &nbsp;5</p>
<p>&nbsp;<br />
&nbsp;void setup()<br />
{ &nbsp;<br />
&nbsp; pinMode(RELAY1, OUTPUT); &nbsp; &nbsp; &nbsp;&nbsp;<br />
&nbsp; pinMode(RELAY2, OUTPUT);<br />
&nbsp; pinMode(RELAY3, OUTPUT);<br />
&nbsp; pinMode(RELAY4, OUTPUT);<br />
&nbsp; digitalWrite(RELAY1,LOW); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Turns ON Relays 1<br />
&nbsp; &nbsp;delay(2000);&nbsp;<br />
&nbsp; &nbsp; &nbsp;digitalWrite(RELAY1,LOW); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Turns ON Relays 1<br />
&nbsp; &nbsp;delay(2000);<br />
&nbsp; &nbsp; &nbsp;digitalWrite(RELAY2,LOW); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Turns ON Relays 1<br />
&nbsp; &nbsp;delay(2000);<br />
&nbsp; &nbsp; &nbsp;digitalWrite(RELAY3,LOW); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Turns ON Relays 1<br />
&nbsp; &nbsp;delay(2000);<br />
&nbsp; &nbsp; &nbsp;digitalWrite(RELAY4,LOW); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Turns ON Relays 1<br />
&nbsp; &nbsp;delay(2000); &nbsp;<br />
&nbsp; &nbsp;&nbsp;<br />
&nbsp; Serial.begin(9600);<br />
&nbsp;&nbsp;<br />
&nbsp; emon1.voltage(0, 244.7, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon1.current(1, 60.6); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.<br />
&nbsp; emon2.voltage(0, 244.7, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon2.current(2, 60.6); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.<br />
&nbsp; emon3.voltage(0, 244.7, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon3.current(3, 60.6); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.<br />
&nbsp; emon4.voltage(0, 244.7, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon4.current(4, 60.6); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.<br />
&nbsp;&nbsp;<br />
}</p>
<p>void loop()<br />
{<br />
&nbsp; &nbsp;Serial.print (&quot;ct1&quot;);<br />
&nbsp; &nbsp; Serial.print (&quot;&quot;);<br />
&nbsp; emon1.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of half wavelengths (crossings), time-out<br />
&nbsp; emon1.serialprint(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Print out all variables (realpower, apparent power, Vrms, Irms, power factor)</p>
<p>&nbsp;Serial.print (&quot;ct2&quot;);<br />
&nbsp; Serial.print (&quot;&quot;);<br />
&nbsp; emon2.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of half wavelengths (crossings), time-out<br />
&nbsp; emon2.serialprint(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Print out all variables (realpower, apparent power, Vrms, Irms, power factor)</p>
<p>&nbsp;<br />
&nbsp;Serial.print (&quot;ct3&quot;);<br />
&nbsp; Serial.print (&quot;&quot;);<br />
&nbsp; emon3.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of half wavelengths (crossings), time-out<br />
&nbsp; emon3.serialprint(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Print out all variables (realpower, apparent power, Vrms, Irms, power factor)</p>
<p>&nbsp;Serial.print (&quot;ct4&quot;);<br />
&nbsp; Serial.print (&quot;&quot;);<br />
&nbsp; emon4.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of half wavelengths (crossings), time-out<br />
&nbsp; emon4.serialprint(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Print out all variables (realpower, apparent power, Vrms, Irms, power factor)</p>
<p>
}</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10979.html" class="topic-previous" title="Go to previous forum topic">‹ Measuring the energy usage</a>
              <a href="10955.html" class="topic-next" title="Go to next forum topic">Design for gas meter reader using optical mouse chip ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-32095"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Having trouble with Single Phase Power</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 10/07/2015 - 10:08.</div>
    <div class="content">
     <p>Yikes! What have you done here:</p>
<p><i>EnergyMonitor emon1, emon2, emon3, emon4, realPower,apparentPower,Vrms,Irms,powerFactor;             // Create an instance</i></p>
<p><i>EnergyMonitor</i> is a Class definition, and inside it you can have 'methods' that are equivalent to functions, and data members, that are equivalent to variables.</p>
<p>If you look at the declaration of EnergyMonitor in emonLib.h, you'll see some of each. calcVI is a method, and (this is where you've got in a tangle) realPower, apparentPower, Vrms, Irms and powerFactor are members. </p>
<p>So you should not use those names as instances of the class, because what you have there is four class instances called emon1, emon2, emon3 and emon4, which is fine, and 5 more. The fun begins, answering your other thread, when you want the real powers, because if you put the correct statements in setup( ), you could have<br />
realPower.realPower<br />
as a data member. I'd need to check the language spec to see if that's legal, but for sure you'll confuse all mere mortals.</p>
<p>So you need to tidy up the instances of EnergyMonitor, and you need to look at the library to see what values you can print. They are listed as "public" and are basically the ones that you wrongly had as class instances.</p>
<p>You get at the values of them with lines like</p>
<p>Serial.println(emon1.realPower);<br />
Serial.println(emon3.powerFactor);</p>
<p>I think you need to read up on C++. </p>
<p><u>Reference Textbooks</u><br />
My bible for C is of course "Kernigan &amp; Ritchie" <a href="http://www.amazon.co.uk/C-Programming-Language-2nd/dp/0131103628/ref=sr_1_3?s=books&amp;ie=UTF8&amp;qid=1292502807&amp;sr=1-3" title="http://www.amazon.co.uk/C-Programming-Language-2nd/dp/0131103628/ref=sr_1_3?s=books&amp;ie=UTF8&amp;qid=1292502807&amp;sr=1-3">http://www.amazon.co.uk/C-Programming-Language-2nd/dp/0131103628/ref=sr_...</a>. This is the standard text book.  The normal place I point people at who want to move up to C++ is <a href="http://www.relisoft.com/book/index.htm" title="http://www.relisoft.com/book/index.htm">http://www.relisoft.com/book/index.htm</a>  and that assumes you know C. Because the Arduino environment normally uses a very small subset of the language, neither are the best place for a beginner to start, nor are many of the other on-line tutorials. I'd still suggest you have both of those, and maybe Bruce Eckel's "Thinking in C++" <a href="http://www.planetpdf.com/developer/article.asp?ContentID=6634" title="http://www.planetpdf.com/developer/article.asp?ContentID=6634">http://www.planetpdf.com/developer/article.asp?ContentID=6634</a> available for reference.</p>
<p>However, there is this: <a href="http://www.me.umn.edu/courses/me2011/arduino/arduinoGuide.pdf" title="http://www.me.umn.edu/courses/me2011/arduino/arduinoGuide.pdf">http://www.me.umn.edu/courses/me2011/arduino/arduinoGuide.pdf</a> which does look to be a good starting place for a beginner. It does not go as far as classes and methods that are used here, though.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32097"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8314.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nigel91&#039;s picture" title="nigel91&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Having trouble with Single Phase Power</h3>

    <div class="submitted">Submitted by <a href="../user/8314.html" title="View user profile.">nigel91</a> on Fri, 10/07/2015 - 11:13.</div>
    <div class="content">
     <p>thank you for your fast response ,, works like a charm . however i am still getting the weird reading from the results.. is this normal .can i counter it .or&nbsp;maybe add component. i am mildly familiar with C programming . but a bit rusty&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32099"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Having trouble with Single Phase Power</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 10/07/2015 - 12:39.</div>
    <div class="content">
     <p>If you paste the output into a message, I might be able to help. But without knowing exactly what 'weird' means, I can't do much. But first of all, try using a sensible load. The system you're describing is designed for "whole house" measurements up to 100 A, that's about 24 kW. A load of only 60 W is below the point where we expect even reasonably accurate results with an emonTx, so you might be measuring noise from the digital circuits inside your Arduino.</p>
<p>Think about the input to the ADC in your Arduino. If 100 A gives you the maximum peak-peak input (not exactly, but it's a good rough approximation) and the ADC output is 10 bits, then how much of the ADC range does 60 W cover in terms of bits? </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32116"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7718.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hanguyen&#039;s picture" title="hanguyen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Having trouble with Single Phase Power</h3>

    <div class="submitted">Submitted by <a href="../user/7718.html" title="View user profile.">hanguyen</a> on Sat, 11/07/2015 - 03:32.</div>
    <div class="content">
     <p>How can we measure the noise from the digital circuits inside your Arduino ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32122"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Having trouble with Single Phase Power</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 11/07/2015 - 15:13.</div>
    <div class="content">
     <p>If you measure an input when there is none, that must be noise. The place to look is probably on the supply pin to the analogue circuitry, A<sub>VCC</sub>, as we think that the route the noise takes is onto the digital supply pin V<sub>CC</sub> then, provided there's no filter between the two as is the case with at least some Arduino boards, into A<sub>VCC</sub> and into the ADC via the voltage reference (the supply voltage). But you should not discount ground loops, nor inductive or capacitive coupling to the analogue input pins.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32124"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8314.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nigel91&#039;s picture" title="nigel91&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Having trouble with Single Phase Power</h3>

    <div class="submitted">Submitted by <a href="../user/8314.html" title="View user profile.">nigel91</a> on Sat, 11/07/2015 - 19:14.</div>
    <div class="content">
     <p>Thank you all you are really helpful.i am considering placing a voltage regulator for my 5v input to the circuit to stabilise the input. Maybe it will help. May I ask for energy calculations do I just use the pulse measurement sketch because for me I do not get any reading.. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32127"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Having trouble with Single Phase Power</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sat, 11/07/2015 - 21:27.</div>
    <div class="content">
     <p>Yes, a ripply&nbsp;Vcc from a poor choice of power supply is a common cause. &nbsp;There&#39;s some more on that here: &nbsp;<a href="10111.html">http://openenergymonitor.org/emon/node/10111</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10971"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-_asgC2OqaaGYf60R61P25McumvbxpQ3HQPVPbDtpJoQ" value="form-_asgC2OqaaGYf60R61P25McumvbxpQ3HQPVPbDtpJoQ"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/10971 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:46:35 GMT -->
</html>
