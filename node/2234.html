<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2234 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:53:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Forward Data to Remote Domain | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Forward Data to Remote Domain</h3>
        <span class="submitted">Submitted by Guest on Sun, 14/04/2013 - 20:09</span>
        <div class="content"><p>Hi, I&#39;m having some problems getting Raspberry Pi forwarding to remote server. It works no problem towards emoncms.org account, however when I point to own domain it won&#39;t authenticate. I&#39;ve searched forum and also tried own domain&nbsp;with install latest emoncms (&nbsp;with and without emoncms folder) . I&#39;ve looked at mysql using phpmyadmin and it is updating raspberry pi - only difference is one has remote send set to 1 in raspberrypi&nbsp;mysql&nbsp;table (emoncms.org - which authenticates ok) and same is set to 0 (private domain - authenticates fails).</p>
<p>Thanks in advance.</p>
<p>Peter</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2247.html" class="topic-previous" title="Go to previous forum topic">‹ Feedconvert Module [SOLVED]</a>
              <a href="2226.html" class="topic-next" title="Go to next forum topic">emoncms v5 now available ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-11284"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 15/04/2013 - 08:32.</div>
    <div class="content">
     <p>Please check you have correct values for those parameters (examples between brackets) :</p>
<p>- protocole (http//)</p>
<p>- domain (domain.tld)</p>
<p>- path (/emoncms)</p>
<p>Also check your remote APIKEY.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11287"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Mon, 15/04/2013 - 09:17.</div>
    <div class="content">
     <p>Hi J&eacute;r&ocirc;me,</p>
<p>&nbsp; Yes, these are correct, I&#39;ve checked loads of times and tried more then one domain. I was using a sub domain, but created a new .com domain to test with emoncms folder.</p>
<p>I tried using RPI helper but get the same response for domain that works and one that doesn&#39;t&nbsp; see below</p>
<p>privatedomain.com which doesn&#39;t work returns</p>
<p>&quot;success&quot;:true,&quot;message&quot;:&quot;Field updated&quot;,&quot;remotesend&quot;:false}</p>
<p>emoncms.org which works returns</p>
<p>{&quot;success&quot;:true,&quot;message&quot;:&quot;Field updated&quot;,&quot;remotesend&quot;:false}</p>
<p>Thanks</p>
<p>Peter</p>
<p>I can send private mail with above tests and also domain, login etc. I&#39;m interested in this as it happened me before and I ended up building new SD card which worked, but didn&#39;t shed any light&nbsp; on issue.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11288"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 15/04/2013 - 09:34.</div>
    <div class="content">
     <p>What do you get when entering this URL in your browser ?</p>
<p><a href="http://domain.tld/your_path/time/local.json?apikey=your_remote_apikey" title="http://domain.tld/your_path/time/local.json?apikey=your_remote_apikey">http://domain.tld/your_path/time/local.json?apikey=your_remote_apikey</a></p>
<p>(You don&#39;t need to add apikey if you&#39;re already connected to emonCMS within your browser.)</p>
<p>You should have something like this:</p>
<p>t11,31,00</p>
<p>(This it the time, obviously.)</p>
<p>This is the test that is used by local emonCMS to check remote emonCMS is working.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11289"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Mon, 15/04/2013 - 11:31.</div>
    <div class="content">
     <p>Hi J&eacute;r&ocirc;me,</p>
<p>Works fine for emoncms.org but not for any of the others - blank. Note I have used the same database for all other domains so in essence they are the same except for domain name.</p>
<p>Thanks</p>
<p>Peter</p>
<p>P.S. I&#39;ll build a completely new install at remote end with new domain and test. Completed no luck.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11293"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 15/04/2013 - 11:44.</div>
    <div class="content">
     <p>You mean you have a remote install located at <a href="http://domain.tld/emoncms" title="http://domain.tld/emoncms">http://domain.tld/emoncms</a> of whatever, you can log into it, but you don&#39;t get the &quot;time&quot; page ?</p>
<p>I wonder what goes wrong, here. Do you mind sharing the URL (at least in private, although I don&#39;t swear I&#39;ll have the time, let alone the skills, to do something) ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11295"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Mon, 15/04/2013 - 12:04.</div>
    <div class="content">
     <p>Hi J&eacute;r&ocirc;me,</p>
<p>Sent login details to your contact page in your profile page. It would be great if you could test with one of your installs to see what you get.</p>
<p>Thanks again</p>
<p>Peter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11297"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 15/04/2013 - 12:40.</div>
    <div class="content">
     <p>Hello PeterN, sorry about this my fault, looks like I missed adding the time module in the latest release. I will put it back in now.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11298"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 15/04/2013 - 12:43.</div>
    <div class="content">
     <p>Ok its back in there now <a href="http://github.com/emoncms/emoncms" title="http://github.com/emoncms/emoncms">http://github.com/emoncms/emoncms</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11299"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 15/04/2013 - 12:50.</div>
    <div class="content">
     <p>Great.</p>
<p>Peter, I erased your message with the login parameters.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11301"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Mon, 15/04/2013 - 13:13.</div>
    <div class="content">
     <p>Hi Trystan,</p>
<p>Thanks, downloaded latest version emoncms from <a href="https://github.com/emoncms/emoncms" title="https://github.com/emoncms/emoncms">https://github.com/emoncms/emoncms</a> and uploaded to new domain. Worked first time great thanks for fix. Note between the ready to go SD image and great instructions its now possible to get a new system working in minutes&nbsp; excellent works guys.</p>
<p>Cheers</p>
<p>Peter</p>
<p>P.S. thanks J&eacute;r&ocirc;me for support testing earlier</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11311"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Mon, 15/04/2013 - 21:12.</div>
    <div class="content">
     <p>Hi,</p>
<p>Thanks for help above, one more issue I hope someone can help me with.</p>
<p>One thing I noticed in new releases emoncms &amp; emoncmspi is that the remote send does not come back after a reboot for 3G dongle (3G was like this in previous releases also). I had a crude work around in previous release but it&#39;s no longer working. I have attached code in hope that someone will spot my mistake, basically a cron job is scheduled to run php script every minute to kick start remote send for 3G - needed to start TCP communication after reboot.</p>
<p>Process to kick start remotesend: note this works when I use http:// below in raspberry pi browser but not when I run attached php script.</p>
<p>update raspberrypi with wrong parameters</p>
<p>http://localhost/emoncms/raspberrypi/set.json?field={&quot;remotedomain&quot;:&quot;xxxxxland.co&quot;,&quot;remoteprotocol&quot;:&quot;http://&quot;,&quot;remotepath&quot;:&quot;/emoncms&quot;,&quot;remoteapikey&quot;:&quot;c98cdf6b42360bf333850c30a52d56ca&quot;,&quot;remotesend&quot;:&quot;1&quot;,&quot;sendtimeinterval&quot;:&quot;0&quot;}&#39;);</p>
<p>update raspberrypi with correct parameters</p>
<p>http://localhost/emoncms/raspberrypi/set.json?field={&quot;remotedomain&quot;:&quot;xxxxxland.com&quot;,&quot;remoteprotocol&quot;:&quot;http://&quot;,&quot;remotepath&quot;:&quot;/emoncms&quot;,&quot;remoteapikey&quot;:&quot;c98cdf6b42360bf333850c30a52d56ca&quot;,&quot;remotesend&quot;:&quot;1&quot;,&quot;sendtimeinterval&quot;:&quot;0&quot;}&#39;);</p>
<p>&nbsp;</p>
<p>Thanks</p>
<p>Peter</p>
<p>p.s. one important observation is that if remote send is working on ethernet lan and 3G dongle is connected, when I unplug lan connection the remotesend works fine on 3G. My thoughts are that something happens on reboot up before 3G dongle is connected (typically take about 30 seconds), any ideas could we delay some network activities for 30 seconds or till 3G is up.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11312"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 15/04/2013 - 20:38.</div>
    <div class="content">
     <p>Thanks PeterN, good to hear!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11314"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 15/04/2013 - 21:03.</div>
    <div class="content">
     <p>Peter, I&#39;m not sure I understand what you mean. Are you saying that after a reboot of the Pi, the data stops being sent remotely ?</p>
<p>I had such an issue when I daemonized the RFM2Pi Gateway : it started before the network was up. I added a retry every few seconds in case the network is down.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11316"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Tue, 16/04/2013 - 07:32.</div>
    <div class="content">
     <p>Hi J&eacute;r&ocirc;me,</p>
<p>Yes when 3G dongle is used it stops sending remotely after reboot.</p>
<p>My thoughts exactly, I can see the 3G dongle takes about 30-40 seconds to connect to network. Problem is I&#39;m not sure what code to use to rectify or where to start. Either delay some code on reboot (e,g, raspberrypi_run.php - not sure this is used anymore, no cronjob) or like you suggest retry after time period (??). I can send dmesg logs for different each scenario if that would help point to issue.</p>
<p>Thanks</p>
<p>Peter</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11331"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 16/04/2013 - 07:57.</div>
    <div class="content">
     <p>Yes, raspberry_run.php is still in use. I meant the py script to be an alternative, but it&#39;s still a bit young, let&#39;s say, and currently, users chose between the two of them. I&#39;m not sure where we&#39;re going, here. I believe that by design (language, use of classes) the python script is easier to modify and extend. While the two are in use, it means double work each time we want to add something.</p>
<p>Actually, I was wrong in my earlier message. The issue I had at startup was that the script would start before the database is initialized, and it couldn&#39;t get the settings, so it would just stop.</p>
<p>When the network is done, the sample is just lost, that&#39;s all, and the script goes on.</p>
<p>I don&#39;t see why the script would stop when the network is unreachable.</p>
<p>And I don&#39;t understand your workaround.</p>
<p>Did you try with both gateway scripts (php and py) ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11334"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Tue, 16/04/2013 - 09:31.</div>
    <div class="content">
     <p>Hope I didn&#39;t confuse things.&nbsp; The default script is running ok after reboot (latest ready to go image), this is case for both lan connection&nbsp; and 3G. However the remote send is not sending data when 3G connection is used (only). I traced in wireshark and TCP is not sent at all.</p>
<p>For what ever reason the process I&nbsp; use to get working again is:</p>
<p>In raspberrypi dashboard:</p>
<ol>
<li>
		input wrong remote domain&nbsp; and save (no auth)</li>
<li>
		input correct remote domain and save (auth succ)</li>
</ol>
<p>The above process can be done manually or using a php script and cron job to automate. Not ideal solution. I&#39;m not sure why this is happening and think it may be because 3G takes 40 seconds to connect. Note 3G does come up and I can ping google etc. it just for some reason remote send doesn&#39;t start resending automatically.</p>
<p>Question hope you can answer at what stage in boot process does remote send start and could this be delayed.</p>
<p>Thanks</p>
<p>Peter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11335"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 16/04/2013 - 09:52.</div>
    <div class="content">
     <p>What happens if you shut down the network (unplug 3G dongle) while remotesend is active ?</p>
<p>Does remote sending work again when you replug the dongle ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11336"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Tue, 16/04/2013 - 11:25.</div>
    <div class="content">
     <p>Yes</p>
<p>Test:</p>
<ol>
<li>
		Start position - raspberry pi 3G dongle connection only and posting to remote domain ok</li>
<li>
		unplugged 3G dongle - stopped posting as expected</li>
<li>
		plugged in 3G dongle - took about 30 - 40 seconds for 3G dongle led to light (solid) and show its connected. Posting to remote domain ok a few seconds later.</li>
</ol>
<p>FYI Here original post on subject. <a href="1903.html" title="http://openenergymonitor.org/emon/node/1903">http://openenergymonitor.org/emon/node/1903</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11339"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 16/04/2013 - 12:22.</div>
    <div class="content">
     <p>I&#39;m sorry if you already answered that, but what if you</p>
<p>- unplug the 3G dongle (no cable connected either, otherwise it&#39;s cheating)</p>
<p>- stop (kill) the script</p>
<p>- launch the script</p>
<p>- wait a bit</p>
<p>Is the script still alive ?</p>
<p>- plug the dongle</p>
<p>Does the script send data ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11344"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Tue, 16/04/2013 - 13:52.</div>
    <div class="content">
     <p>Hi J&eacute;r&ocirc;me,</p>
<p>Apologies can you please guide me. Assuming the script is RFM12 to Pi, how can I view this with LXTerminal and start/ stop same.</p>
<p>Thanks</p>
<p>Peter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11345"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 16/04/2013 - 14:13.</div>
    <div class="content">
     <p>Hmmm... I&#39;m not sure what your exact setup is. If you&#39;re using latest master, you can choose between the php and the python script, and you can have it launched at startup using an init script. In this case, you have instructions in the readme and the command looks like this for the python script (out of memory):</p>
<p>$ sudo /etc/init.d/rfm2pigateway start</p>
<p>$ sudo /etc/init.d/rfm2pigateway stop</p>
<p>$ sudo /etc/init.d/rfm2pigateway status</p>
<p>&nbsp;</p>
<p>You can check whether a script is running with ps:</p>
<p>$ ps ax | grep rfm2</p>
<p>Assuming no script is running, you can launch one of them manually and see what happens:</p>
<p>$ python /var/www/emoncms/Modules/raspberrypi/rfm2pigateway.py</p>
<p>or</p>
<p>$ php /var/www/emoncms/Modules/raspberrypi/raspberry_run.php</p>
<p>If you choose the python script, when launched manually, the logging info appears in the terminal. (The default config if using the init script is to log into /var/log/rfm2pigateway/)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11347"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Tue, 16/04/2013 - 16:14.</div>
    <div class="content">
     <p>A lot to take in. I have downloaded latest raspberrypi and emoncms to make it easier. Seems php is working ok. Not sure command to stop php&nbsp;? (normally&nbsp;use&nbsp;# in crontab)&nbsp;and I will run test for php first.</p>
<p>root@raspberrypi:~# ps ax | grep rfm2</p>
<p>21322 pts/0&nbsp;&nbsp;&nbsp; S+&nbsp;&nbsp;&nbsp;&nbsp; 0:00 grep rfm2</p>
<p>&nbsp;</p>
<p>root@raspberrypi:~# python /var/www/emoncms/Modules/raspberrypi/rfm2pigateway.py</p>
<p>Traceback (most recent call last):<br />
	&nbsp; File &quot;/var/www/emoncms/Modules/raspberrypi/rfm2pigateway.py&quot;, line 23, in &lt;module&gt;<br />
	&nbsp;&nbsp;&nbsp; import serial<br />
	ImportError: No module named serial</p>
<p>&nbsp;</p>
<p>&nbsp;root@raspberrypi:/var/www/emoncms/Modules/raspberrypi# php raspberrypi_run.php</p>
<p>Remote upload enabled - details correct<br />
	DATA RX: 20 71 9<br />
	DATA RX: 11 0 0 0 0 2 0 244 11 85 0</p>
<p>I don&#39;t remember being offered option to use python but will look at readme etc.It sounds interesting and if it could be started 60 seconds after boot may be potential solution.</p>
<p>Thanks</p>
<p>Peter</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 16/04/2013 - 16:36.</div>
    <div class="content">
     <p>&gt; Not sure command to stop php&nbsp;? (normally&nbsp;use&nbsp;# in crontab)</p>
<p>crontab line starts it regularly in case of crash. Removing it won&#39;t kill the running process. To do so, first remove line in crontab to avoid the process to be relaunched, then kill runnign process :</p>
<p>$ ps ax | grep raspberry</p>
<p>identify the line that corresponds to the process, get its ID number, then</p>
<p>$ kill process_ID (you may need to sudo that)</p>
<p>BTW, if you&#39;re using latest version, you could get rid of the crontab line and use the daemon instead. See readme.</p>
<p>&gt; ImportError: No module named serial</p>
<p>Yes, there are two dependencies you need for it so run. See readme.</p>
<p>&gt; root@raspberrypi:/var/www/emoncms/Modules/raspberrypi# php raspberrypi_run.php</p>
<p>&gt; Remote upload enabled - details correct<br />
	&gt; DATA RX: 20 71 9<br />
	&gt; DATA RX: 11 0 0 0 0 2 0 244 11 85 0</p>
<p>It seems to be working. Does it stop here or does it go on and you only pasted the first three lines ?</p>
<p>In other words, what I suggested is to :</p>
<p>- Disconnect from network to reproduce startup condition before it is up.</p>
<p>- Launch the php script manually.</p>
<p>- ps ax | grep raspberry_run to get its process ID (PID)</p>
<p>- Wait a bit and see if it the process is still up : again ps ax | grep raspberry_run&nbsp;</p>
<p>- If it is dead, we need to figure out why. If not</p>
<p>- Plug dongle to get network</p>
<p>- See what happens.</p>
<p>If nothing happens and the process is not dead, we need to figure out why.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11351"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Tue, 16/04/2013 - 20:23.</div>
    <div class="content">
     <p>Hi J&eacute;r&ocirc;me,</p>
<p>This is great stuff thanks a mil. I need more time to digest above information. Below is result of test you suggested and also interesting observation if order is changed.</p>
<p>Cheers</p>
<p>Peter</p>
<p>Test 1:</p>
<p>- Disconnect from network to reproduce startup condition before it is up.</p>
<p><font color="#800000">ok - Raspberry Pi powered up, network disconnected, RFM12 Pi stopped</font></p>
<p>- Launch the php script manually.</p>
<p><font color="#800000">ok</font></p>
<p>- ps ax | grep to get its process ID (PID)</p>
<p><font color="#800000">ok</font></p>
<p>- Wait a bit and see if it the process is still up : again ps ax | grep raspberry_run&nbsp;</p>
<p><font color="#800000">Warning failed to open stream remote domain, data RX RFM12 ok. Dashboard shows RFM12 to pi running (green).</font></p>
<p>- If it is dead, we need to figure out why. If not</p>
<p><font color="#800000">above seem ok as internet is not connected but RFM12 data still being received</font></p>
<p>- Plug dongle to get network</p>
<p><font color="#800000">Dongle connects ok, can browse internet from Raspberry Pi </font></p>
<p>- See what happens.</p>
<p><font color="#800000">Not updating remote domain</font></p>
<p>If nothing happens and the process is not dead, we need to figure out why.</p>
<p><font color="#800000">Observation, if I change order of events slightly, power up network disconnected, then stop RFM12 to Pi, then connect 3G Dongle and wait till connected to internet, then run raspberrypi_run.php. This time it posts data to remote every time. </font></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11355"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 16/04/2013 - 19:24.</div>
    <div class="content">
     <p>OK now I think I know. I&#39;m sorry I had you go through all these steps, I could have found earlier if I had taken a little bit of time to dig into the php script, but I was not totally concentrated on this issue. Anyway, it&#39;s good for the future if it made you learn stuff...</p>
<p>In the php script, the remote server reachability is tested twice :</p>
<p>- once at startup:</p>
<p>&nbsp; $sent_to_remote = false;<br />
	&nbsp; if ($remoteprotocol &amp;&amp; $remotedomain &amp;&amp; $remotepath &amp;&amp; $remoteapikey)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; $result = file_get_contents($remoteprotocol.$remotedomain.$remotepath.&quot;/time/local.json?apikey=&quot;.$remoteapikey);</p>
<p>	&nbsp;&nbsp;&nbsp; if (isset($result[0]) &amp;&amp; $result[0]==&#39;t&#39;) {echo &quot;Remote upload enabled - details correct \n&quot;; $sent_to_remote = true; }</p>
<p>- once every iteration *if settings were changed*:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($settings-&gt;remotedomain !=$remotedomain || $settings-&gt;remoteapikey !=$remoteapikey || $settings-&gt;remotepath !=$remotepath || $settings-&gt;remoteprotocol !=$remoteprotocol)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $result = file_get_contents($remoteprotocol.$remotedomain.$remotepath.&quot;/time/local.json?apikey=&quot;.$remoteapikey);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($result[0]==&#39;t&#39;) {echo &quot;Remote upload enabled - details correct \n&quot;; $sent_to_remote = true; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>	This explains your workaround : you modify the settings, thus trigger a refresh</p>
<p>You could add a timer to check regularly for the availability of the remote server:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; every 30 seconds</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $result = file_get_contents($remoteprotocol.$remotedomain.$remotepath.&quot;/time/local.json?apikey=&quot;.$remoteapikey);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($result[0]==&#39;t&#39;) {echo &quot;Remote upload enabled - details correct \n&quot;; $sent_to_remote = true; }<br />
	&nbsp;</p>
<p>Or perhaps even remove all those tests and rely on the remotesend setting set in the GUI. This is what the python script does and I believe it should be the way to go.</p>
<p>You should probably file an issue in github about this, with a link to this. If the fix is as simple as I think, I could even provide it, who knows...</p>
<p>Can you please test it works if you replace all occurrences of sent_to_remote by $settings-&gt;remotesend ?</p>
<p>I believe the python script does not have the same problem. You may want to have a try as well.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11358"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Tue, 16/04/2013 - 20:29.</div>
    <div class="content">
     <p>Hi J&eacute;r&ocirc;me,</p>
<p>Works, really appreciated your time and effort.&nbsp; I&#39;ve tested your fix twice and it worked both times - raspberry pi posting to remote domain after reboot with 3G dongle. I&#39;ll raise issue as you suggested. I&#39;d like to test python script also over next few days - keep you posted.</p>
<p>Thanks again</p>
<p>Peter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11364"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2765.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="casestudies&#039;s picture" title="casestudies&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/2765.html" title="View user profile.">casestudies</a> on Tue, 16/04/2013 - 23:24.</div>
    <div class="content">
     <p>I can&#39;t seem to get emoncms on my Raspberry Pi to &nbsp;send the data &nbsp;to emoncms.org. I&#39;m pretty sure I&#39;ve entered all the data correctly &nbsp;(http:// selection, emoncms.org, /emoncms, api r/w key from emoncms.org). Hit save, says it&#39;s saved but displays &quot;Incorrect server details&quot;.</p>
<p>I saw somewhere something about remotesend in the raspberrypi table. If I change the value manually in the DB, I get a green Successful message. But when I change a value in emoncms to a bad value and change it back (click save after each), it goes back to unsuccessful and the remotesend field is again equal to 0, not 1.</p>
<p>Is there something special I&#39;m missing to get the Raspberry Pi to forward data to emoncms.org. The Pi is behind a router firewall that the ISP setup in the house. I&#39;m just curious how to get this to work (for backup purposes really) as the emoncms installation on the Pi works fine for now. Though I&#39;m thinking about reinstalling it so it&#39;s running off of a HDD instead of the SD card.</p>
<p>Thanks in advance.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11374"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward Data to Remote Domain</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Wed, 17/04/2013 - 07:34.</div>
    <div class="content">
     <p>What do you get when entering this URL in your browser ?</p>
<p><a href="http://emoncms.org/your_path/time/local.json?apikey=your_remote_apikey" title="http://emoncms.org/your_path/time/local.json?apikey=your_remote_apikey">http://emoncms.org/your_path/time/local.json?apikey=your_remote_apikey</a></p>
<p>I believe it should work thanks to Trystan&#39;s fix.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2234"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-vYDQBjLXAaFaSy4wdmc_ObYrR8a0cHdDfV4AnlG2Zus" value="form-vYDQBjLXAaFaSy4wdmc_ObYrR8a0cHdDfV4AnlG2Zus"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/2234 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:53:42 GMT -->
</html>
