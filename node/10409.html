<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10409 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:48:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonCMS in a Software as a Service Infrastructure | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonCMS in a Software as a Service Infrastructure</h3>
        <span class="submitted">Submitted by <a href="../user/3657.html" title="View user profile.">Mattia Rossi</a> on Mon, 30/03/2015 - 13:10</span>
        <div class="content"><p>Hello guys, long time no see, a new family member and a job switch has kept me away from (most&nbsp;of) the fun stuff.</p>
<p>I have been recently given the opportunity to connect what I do for a living (design software,network and hardware systems) and what I do when I want to have fun (play with cool stuff like arduino&nbsp;and emoncms):&nbsp;specifically I have been asked to evaluate costs and benefit of building a complete Software as a Service infrastructure with the specific goal of monitoring fleets of photovoltaic installations.</p>
<p>The current number of installations is about 6K, all of which would be retrofitted with a monitoring system that is able to post sensors data to an url, initially:</p>
<ul>
<li>PV production &nbsp;kWh counter</li>
<li>HOUSE consumption kWh counter</li>
<li>PV inverter status</li>
<li>temperatures</li>
<li>local energy diversion system state</li>
<li>possibly wheather data</li>
</ul>
<p>Since all of this data will probably have to be transmitted through mobile/gprs, sampling frequency will be between 1-15 min depending on gsm SIM data projected costs (no pseudo real time power reading, that is)</p>
<p>The system should be able to:</p>
<ul>
<li>gather sensors data</li>
<li>display aggregated data at various levels</li>
<li>react to events like inverter failure and trigger notifications</li>
<li>integrate power production and consumption data with local weather conditions</li>
<li>(in the future) act as the base for more detailed analitycs&nbsp;reasonings</li>
</ul>
<p>&nbsp;</p>
<p>I believe that, with the correct approach, a modicum of new modules, and a lot of forward thinking and coding, emoncms could be one of the basic building blocks for such an infrastructure.</p>
<p>Specifically, I would like to try and use emoncms as the part that:</p>
<ul>
<li>collects data with single photovoltaic install granularity :
<ul>
<li>one user per site (and relative write apikey)</li>
<li>nodes preconfigured based on templates (the monitoring hardware will be uniform through the sites, but will undergo different revisions and could log more/less data depending on connectivity availability)</li>
</ul>
</li>
<li>displays such data to at least three levels of users (with different granularity):
<ul>
<li>fleet owners&nbsp;
<ul>
<li>​&nbsp;global data visualization&nbsp;(read only)</li>
<li>&nbsp;partners data&nbsp;breakdown and visualization&nbsp;(read only)</li>
<li>&nbsp;sites data breakdown and visualization&nbsp;(read only)</li>
<li>new partners/sites management</li>
<li>device/node management&nbsp;</li>
</ul>
</li>
<li>partners/installers
<ul>
<li>partners data visualization</li>
<li>sites data breakdown&nbsp;(read only)</li>
<li>device/node setup/assignment to specific sites</li>
</ul>
</li>
<li>site users/end clients
<ul>
<li>data visualization (read only)</li>
</ul>
</li>
</ul>
</li>
<li>reacts to events and forwards alerts</li>
</ul>
<p>I know it would probably mean a lot of work, but in the eventuality that it moves from the thinking and prototipying stage to reality I would like to do it in &nbsp;such a way that benefits all users of the emoncms platform.</p>
<p>Things that I think would be necessary to handle all the listed functionality:</p>
<p>Emoncms:</p>
<ul>
<li>superuser module: a module that allows an admin/partner to
<ul>
<li>create new users and assign them to the appropriate (fleet/partner/site) category</li>
<li>associate specific&nbsp;hardware nodes (see below) to sites</li>
<li>handle hardware node maintenance: an admin should be able to enable/disable posting of sensor data from a data node depending on pre-set conditions</li>
</ul>
</li>
<li>supernode module: a module that allows the definition of specific nodes in terms of inputs and related processes:
<ul>
<li>hardware node: should reflect different versions/configurations of the hrdware doing the actual monitoring</li>
<li>collector node: should define the logic with which to pre-aggregate sensors reading at the partner/fleet level</li>
</ul>
</li>
<li>custom frontend app module: should take care of correctly displaying data to various levels of users, would probably start from the mysolarpv&nbsp;view and expand on that</li>
</ul>
<p>At the moment I think emoncms could handle all the requirements except the visual analytics part (displaying data aggregated on variables like site installs, weather condition, pools of sites/partners ) for which emoncms would still be the provider of pre-computed data.</p>
<p>Data collection would be performed through either emonhub or a custom mqtt interface to emoncms, still undecided on that and will depend on the result of stress tests if/when we come to that</p>
<p>I am using this post as a general brainstorming session, mainly for myself ... I have been thinking/tinkering on how to shape it up using emoncms for a week now, and will probably start to play with basic versions of the superuser and supernode modules in the next week.</p>
<p>I have read other posts that discussed strategies for adding hierarchies of users to emoncms, but I honestly don&#39;t see how a hierarchical model could work using the actual interface, specifically I see no way of easily aggregating data if the single users have control on feeds and processes, and see no way (other that with an external app) of displaying in a secure way limited amount of information</p>
<p>&nbsp;</p>
<p>I also have been thinking a lot about system requirements, both in terms of storage and in terms of connectivity, will probably post my reasonings in another message</p>
<p>All modules developed for this purpose would naturally be shared with&nbsp;&nbsp;the community, and this would apply to the frontend, if it turns out to be feasible to keep everything in sync with emoncms development.</p>
<p>&nbsp;</p>
<p>Please&nbsp;keep in mind that as of now everything is still at the design level, and all of this exists only in my mind (and on a couple of test installations on AWS :) )</p>
<p>Wil keep updating as soon as I have more specifics.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10506.html" class="topic-previous" title="Go to previous forum topic">‹ Starting today to build a Robin Mk2 with an emontx 2.2 - what software version does reporting and divertion</a>
              <a href="10455.html" class="topic-next" title="Go to next forum topic">Post Processing ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-29284"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS in a Software as a Service Infrastructure</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 01/04/2015 - 21:22.</div>
    <div class="content">
     <p>Hello Mattia, this sounds like a really interesting project and great to hear that your considering using emoncms. I can see these features being useful for quite a few people installing systems in this way. I think <a href="../user/877.html">Ildefonso Mart&iacute;nez</a> may have been working on something similar. Very interested to hear how this develops, I&#39;ve also got a cloud focused version of emoncms in the works with the option to have as many storage servers as you need as well as a more streamlined input stage which may be of interest as you get to the numbers of sites your talking about.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29304"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7878.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7878.jpg" alt="Mandela&#039;s picture" title="Mandela&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS in a Software as a Service Infrastructure</h3>

    <div class="submitted">Submitted by <a href="../user/7878.html" title="View user profile.">Mandela</a> on Wed, 01/04/2015 - 23:46.</div>
    <div class="content">
     <p>It is awesome Mattia I would like to encourage you to try as am now struggling to learn how to come up with such wonderful module for emonCMS_user privileges and permission. Keep it ups</p>
<p>Mandela.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29602"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3657.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3657.jpg" alt="Mattia Rossi&#039;s picture" title="Mattia Rossi&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS in a Software as a Service Infrastructure</h3>

    <div class="submitted">Submitted by <a href="../user/3657.html" title="View user profile.">Mattia Rossi</a> on Tue, 14/04/2015 - 15:26.</div>
    <div class="content">
     <p>Hi, sorry for the late reply,</p>
<p>in these two weeks I have been experimenting more with backend options, the frontend (and the user module) are for the moment still in the planning department (s.g. some ideas in my head :)<br />
Unfortunately the time I am able to dedicate to this project is small, so I am procedding, but at a really slow pace.</p>
<p>I have evaluated/experimented with a couple of options regarding storage, specifically:</p>
<ul>
<li>using the existing storage technology, augmented by MQTT and mqttwarn to pre-aggregate data based on static logic: fairly easy to implement, but unflexible and even more taxing with regards to storage and system requirements</li>
<li>adding an aggregation layer using a Module, not so easy to create a flexible enough solution, probably would incur in performance issues pretty soon</li>
<li>adding an additional storage engine like InfluxDB (<a href="http://influxdb.com/" title="http://influxdb.com/">http://influxdb.com/</a>) that in its latest incarnation has the concept of tags and would allow for queries like</li>
</ul>
<p>SELECT mean(prod_kwh),mean(kw),mean(solar_kwh) FROM /emoncms.feed_*/<br />
WHERE substr(geohash,1,6) = &#39;dr5ru4&#39;<br />
&nbsp; AND company =&#39;ACME&#39;<br />
&nbsp; AND installer = &#39;installer1&#39;<br />
&nbsp; AND time &gt; now() - 4h<br />
GROUP BY time(5m), *</p>
<p>Influxdb has support for graphite style data posting (that I have used for my experiments since there was some experimental support in emoncms), but in order to be able to use the tagging feature I would need to write an engine that speaks directly to the InfluxDb API</p>
<p>For the frontend, I am way behind schedule, and my experiments have been focused in toying with the myelectric and mysolarpv app in order to display additional data.&nbsp;</p>
<p>Next on my todo list is to think/experiment with the user hierarchy/model. Will keep you guys updated</p>
<p>&nbsp;</p>
<p>PS:</p>
<p>@Trystan-Glynn: Is it too soon to request a 868 Mhz version of the emonpi ? Got me one the day the kickstarter project started :)</p>
<p>&nbsp;</p>
<p><i>[Duplicate post deleted - <a href="10391.html">please read this</a>. Moderator (RW)]</i> </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29801"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS in a Software as a Service Infrastructure</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 20/04/2015 - 16:31.</div>
    <div class="content">
     <p>Hello Mattia, good to hear your progress and thankyou for supporting the kickstarter, I&#39;ve added a note against your pledge for the 868Mhz module.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10409"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-qYgYebLCMR-wPPkjGuHgAvO9bvvy0YFrURSzO3KVflI" value="form-qYgYebLCMR-wPPkjGuHgAvO9bvvy0YFrURSzO3KVflI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
