<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/4072 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:05:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonTx LED Stays Red When Booting | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonTx LED Stays Red When Booting</h3>
        <span class="submitted">Submitted by <a href="../user/5740.html" title="View user profile.">Purplemeanie</a> on Sun, 16/03/2014 - 10:26</span>
        <div class="content"><p>Hi All,</p>
<p>&nbsp; This week I received a pre-built&nbsp;EmonTx, RaspPi&nbsp;RFM12Pi board and LCD module. I&#39;ve yet to build the LCD but have configured the Pi and set it up with a USB stick for an external harddrive&nbsp;(for the moment) - I followed the external harddrive instructions but using the USB stick and a&nbsp;Raspbian&nbsp;build that I already had on a Pi. The Pi and&nbsp;EmonCMS all seems to be working and logging from the Pi RF module seems to be ok.</p>
<p>&nbsp; I have a number of other Pi projects running and have also implemented a number of other Arduino&nbsp;home-brew projects. I&#39;ve also been running a Wattson for a number of years - I have solar PV and solar hot water systems installed for around 10 years now.</p>
<p>&nbsp; So, to my problem: on booting the EmonTx&nbsp;I get a solid red LED that does not flash. I&#39;ve reseated the RF module and have tried booting from AC, batteries and USB with the same results (setting JP2 as appropriate). I did manage to get the system to flash the LED once when I&#39;d taken the boards out of the enclosure and disconnected the CT&#39;s - the LED was solid for the expected 10s, flashed a few times then went out completely. However, subsequent boot attempts failed to get the LED to flash. I have what I&#39;d consider to be &quot;some&quot; experience with electronics (modesty excludes a stronger emphasis :) ) and have put the RF module under a Mantis stereo microscope to look for dry and open joints, but couldn&#39;t see anything obvious.</p>
<p>&nbsp; I&#39;ve seen other posts where this has indicated that the Arduino sketch is getting stuck initializing the RF module and that the RF module needs replacing.&nbsp;</p>
<p>&nbsp; I don&#39;t have an Arduino&nbsp;UART&nbsp;cable to hand so haven&#39;t looked at the debug output from the Arduino yet.</p>
<p>&nbsp; I would appreciate suggestions on something I&#39;ve overlooked or course of action please - I&#39;m new to this project, so be gentle with your replies, I&#39;ve probably overlooked something obvious :-)</p>
<p>&nbsp;</p>
<p>Many thanks, John</p>
  <div class="forum-topic-navigation clear-block">
          <a href="4093.html" class="topic-previous" title="Go to previous forum topic">‹ emonTx or  emonTH  device limit </a>
              <a href="4096.html" class="topic-next" title="Go to next forum topic">Input OnTime ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-19310"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Sun, 16/03/2014 - 11:53.</div>
    <div class="content">
     <p>Have you disabled the console output on the GPIO serial?</p>
<p><a href="http://www.hobbytronics.co.uk/raspberry-pi-serial-port" title="http://www.hobbytronics.co.uk/raspberry-pi-serial-port">http://www.hobbytronics.co.uk/raspberry-pi-serial-port</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19312"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5740.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Purplemeanie&#039;s picture" title="Purplemeanie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5740.html" title="View user profile.">Purplemeanie</a> on Sun, 16/03/2014 - 12:03.</div>
    <div class="content">
     <p>Hi CyberGibbons,</p>
<p>&nbsp; my problem is with the EmonTX not the Pi. I have the Pi working well with comms to the RF module working - as far as I can tell at the moment.</p>
<p>&nbsp; My issue is with the EmonTX and the fact that the red LED stays lit.</p>
<p>thanks, John</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19313"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Sun, 16/03/2014 - 12:31.</div>
    <div class="content">
     <p>Sorry, I didn&#39;t read that properly at all - on my phone.</p>
<p>I think that means that the RFM12B isn&#39;t initialising correctly.</p>
<p>When you say you haven&#39;t got a Arduino UART cable to hand, do you have one at all?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19314"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5740.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Purplemeanie&#039;s picture" title="Purplemeanie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5740.html" title="View user profile.">Purplemeanie</a> on Sun, 16/03/2014 - 12:57.</div>
    <div class="content">
     <p>I&#39;ll have to look for a cable, I tend to use USB for my Arduino projects. If not I&#39;ll have to buy/make one and will take a few days to build/arrive.</p>
<p>John</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19315"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 16/03/2014 - 13:23.</div>
    <div class="content">
     <p>Have you tried pressing the reset button? My V3 gives exactly the same symptoms when powered from the ac adapter, but after resetting it, all is OK. (Note to self - must track that down and tell Glyn! - probably it&#39;s something to do with the rate at which the power rails establish themselves.)</p>
<p>If it doesn&#39;t respond to that, I&#39;ll go along with the idea that the RFM12B is the likely culprit. If you look at the default code, then almost the first thing that happens is the LED is turned on, then the RFM12B is initialised. If that doesn&#39;t happen and it locks up there, then you get the symptoms you&#39;re experiencing.</p>
<p>If you have no ac supply, the LED will be on for 10 s, off for 1 s, then on again for a 2 s, then it won&#39;t flash again as it thinks it&#39;s battery powered and it&#39;s saving ampere-hours. But if you have an ac supply and no ct&#39;s, it should still do the standard sequence - 10 s on, 10 flashes, then a flash every 10 s.</p>
<p>But I don&#39;t understand why it worked once - unless there really is an iffy joint there somewhere.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19321"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5740.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Purplemeanie&#039;s picture" title="Purplemeanie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5740.html" title="View user profile.">Purplemeanie</a> on Sun, 16/03/2014 - 16:23.</div>
    <div class="content">
     <p>Thanks for the help Robert. I did try resetting the board after power up (after giving it various delays) but that didn&#39;t help.</p>
<p>It would probably be a good idea that the LED is flashed during the reset cycle so that you know the board is running code... it could then continue with the 10s&nbsp;etc sequence.</p>
<p>I&#39;ve found an old USB to serial converter and a PCB mounted D-Sub, so I&#39;m going to try and make a USB to UART cable. If I power the EmonTX from the AC or USB then looks like I don&#39;t need the 5V on the UART... that just leaves GND,&nbsp;RST, TX and RX - that shouldn&#39;t be too difficult to get going.</p>
<p>John</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19324"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5740.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Purplemeanie&#039;s picture" title="Purplemeanie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5740.html" title="View user profile.">Purplemeanie</a> on Sun, 16/03/2014 - 16:59.</div>
    <div class="content">
     <p>Ok, Robert. You were right. After playing around with my USB to Serial converter it seemed that I could get the unit to boot if I had the ground connected from the converter to the board. I then played around with the reset and realized that I wasn&#39;t holding the reset button for long enough before. I need to have a look at the circuit as well because if I short the UART&#39;s&nbsp;RST line to ground then the reste happens immediately, more like I&#39;d expect (that&#39;s how a realized initially that a reset would kick it into life too).</p>
<p>So, I can now get the EmonTX&nbsp;to boot if I hit the reset button after powering it. At least I think it&#39;s booting as it goes through the 10s red, 10xflash and then flashes every 10s with no CT&#39;s (AC-AC powering it).</p>
<p>I now need to connect it back up to the CTs&nbsp;and see if I can get it to communicate with the Pi.</p>
<p>That&#39;s about as much as I can do today - I&#39;ll get the scope out later in the week and report back on this thread.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19326"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5740.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Purplemeanie&#039;s picture" title="Purplemeanie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5740.html" title="View user profile.">Purplemeanie</a> on Sun, 16/03/2014 - 17:27.</div>
    <div class="content">
     <p>Ok, I now have two CTs connected and the EmonTX communicating with the Pi... Pi is logging data and I just need to set up the inputs, feeds, etc.</p>
<p>Thanks for all your support today - I&#39;ll have a look at the non-booting at power up issue later in the week.</p>
<p>thanks, John</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19329"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 16/03/2014 - 19:59.</div>
    <div class="content">
     <p>I&#39;ll see what Glyn has to say about this. I had a look at the information about the RF&micro; and the RFM12B but I&#39;m not convinced the version I was looking at is accurate.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19330"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 16/03/2014 - 22:36.</div>
    <div class="content">
     <p>I have simply put a &quot;delay(5);&quot; immediately before &quot;rf12_initialize(...);&quot; at the top of the setup(...) method and that seems to do the trick. 2 ms was not enough, 3 ms seemed to be ok so 5 ms is probably enough to let the supply settle before attempting to initialise the RFM12B.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19333"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5740.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Purplemeanie&#039;s picture" title="Purplemeanie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5740.html" title="View user profile.">Purplemeanie</a> on Mon, 17/03/2014 - 00:07.</div>
    <div class="content">
     <p>Thanks again Robert, I&#39;ll give that a try.</p>
<p>All seems to be working with my setup now. With one proviso about having to change the timestore directory in the Timestore.php engine source. Took me a while to find my way through the source but got there in the end.</p>
<p>For others watching this thread, if you follow the Pi&nbsp;harddisk setup guide then you end up creating a mount on /data with the timestore data in a sub-dir at /data/timestore. The emoncms/Modules/feed/engine/Timestore.php flle points to the old /var/lib/timestore directory so changing the source to point to /data/timestore did the trick for me.</p>
<p>In the git version I pulled Timestore.php line 15 becomes:</p>
<p>private $dir = &quot;/data/timestore/&quot;;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19402"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5740.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Purplemeanie&#039;s picture" title="Purplemeanie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/5740.html" title="View user profile.">Purplemeanie</a> on Tue, 18/03/2014 - 21:44.</div>
    <div class="content">
     <p>Final post on this thread:</p>
<p>I have now updated the firmware on the EmonTx with today&#39;s latest updates in Git. The 10ms&nbsp;delay before initializing the RF module seems to have done the trick.</p>
<p>My board now boots reliably.</p>
<p>John</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19404"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTx LED Stays Red When Booting</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 18/03/2014 - 22:17.</div>
    <div class="content">
     <p>With further testing, I found that 5 ms wasn&#39;t enough over the full range of possible supply voltages, so I upped it to 10 (not that it makes much difference as a once-only event at startup).&nbsp; I&#39;ve also pointed out and Glyn has corrected another bug in the calculations that I spotted that doesn&#39;t appear to have caught anyone yet.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/4072"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-U6kE3-UPo1ugWQMQ_D3z-3PIK45FJRyLr6O-5N1JTZ0" value="form-U6kE3-UPo1ugWQMQ_D3z-3PIK45FJRyLr6O-5N1JTZ0"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/4072 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:05:23 GMT -->
</html>
