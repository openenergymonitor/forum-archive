<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6050 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:11:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>How to use ac-ac adapter to read voltage | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">How to use ac-ac adapter to read voltage</h3>
        <span class="submitted">Submitted by <a href="../user/6151.html" title="View user profile.">João Almeida</a> on Mon, 03/11/2014 - 17:24</span>
        <div class="content"><p>Hello there.</p>
<p>I&#39;m currently using an emonTx Shield V1, and I have 4 CT current sensors. This is almost ideal to me, but the problem is I need to be able to get the values of the real power, apparent power, powerfactor, etc, for each of the 4 circuits i&#39;m reading.&nbsp;</p>
<p>If I understant correctly, I can do this using the ac-ac adapter. I understand the &quot;waveform scale down&quot; schematic. my problem is that the example code of the VOLTAGE_AND_CURRENT example is:</p>
<p>##############################################################################<br />
#include&nbsp;&quot;EmonLib.h&quot; // Include Emon Library</p>
<p>EnergyMonitor&nbsp;emon1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;// Create an instance</p>
<p>void setup() {&nbsp;&nbsp; &nbsp;&nbsp;</p>
<p>Serial.begin(9600); &nbsp;&nbsp; &nbsp;&nbsp;</p>
<p>emon1.voltage(2,&nbsp;234.26,&nbsp;1.7);&nbsp;&nbsp;// Voltage: input pin, calibration, phase_shift &nbsp;&nbsp;</p>
<p>emon1.current(1,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration. }</p>
<p>void loop() { &nbsp;&nbsp;</p>
<p>emon1.calcVI(20,2000);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calculate all. No.of crossings, time-out &nbsp;&nbsp;</p>
<p>emon1.serialprint();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Print out all variables }<br />
############################################################################</p>
<p>
My problem is that, since I have 4 CT sensors, I use something like this:<br />
#################################################################<br />
emon1.current(1,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>emon2.current(2,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>emon3.current(3,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>emon4.current(4,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>##################################################################</p>
<p>And the sample code provided states that the input pin for the emon1.voltage is the input pin 2.</p>
<p>Does this cause any kind of problems in the readings of the currents and apparent and real power?</p>
<p>Also if not, what I have to do is something sort of like&nbsp;this:</p>
<p>##################################################################</p>
<p>emon1.current(1,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>emon1.voltage(1,&nbsp;234.26,&nbsp;1.7);&nbsp;&nbsp;// Voltage: input pin, calibration, phase_shift&nbsp;</p>
<p>emon2.current(2,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>emon2.voltage(2,&nbsp;234.26,&nbsp;1.7);&nbsp;&nbsp;// Voltage: input pin, calibration, phase_shift&nbsp;</p>
<p>emon3.current(3,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>emon3.voltage(3,&nbsp;234.26,&nbsp;1.7);&nbsp;&nbsp;// Voltage: input pin, calibration, phase_shift&nbsp;</p>
<p>emon4.current(4,&nbsp;111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>emon4.voltage(4,&nbsp;234.26,&nbsp;1.7);&nbsp;&nbsp;// Voltage: input pin, calibration, phase_shift&nbsp;</p>
<p>#####################################################################</p>
<p>I&#39;m asking because I haven&#39;t ordered the ac-ac adapter yet, and so I cannot test this by my self. Also, is the &quot;scale down circuit&quot; really necessary? And if so do I have to make 4 of those circuits, one for each of the CT current sensors?</p>
<p>Thanks in advance for any help you guys can provide.</p>
<p>Best regards,<br />
Jo&atilde;o Almeida.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6055.html" class="topic-previous" title="Go to previous forum topic">‹ emonCMS not recognizing PHPFIWA feed meta data</a>
              <a href="6054.html" class="topic-next" title="Go to next forum topic">Cross-Origin Request Blocked - Calling get.json on emoncms.org (free account) from outside? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-24954"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to use ac-ac adapter to read voltage</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 03/11/2014 - 19:53.</div>
    <div class="content">
     <p>I think you were looking at the wrong sample code - the code you copied is not for the emonTx Shield.</p>
<p>First, a question: Do you have a single phase supply or a 3-phase one? If you do not know, ask your electricity supply company, or a local qualified electrician, or look <a href="https://learn.openenergymonitor.org/?redirect=3-phase-power">here</a> for some things that might help you.<br />
Assuming that you have a single phase supply, you will use one of the sketches with "voltage" in the name - like <a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxShield/Shield_CT1234_Voltage">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxShield/Shield_CT1234_Voltage</a></p>
<p>If you have a single phase supply, you do not need 4 voltage inputs. The voltage is the same, to within a very small tolerance, throughout your house, therefore it is normal to measure at one place only. But you <b>MUST</b> use the shield with the correct ac adapter that it was designed to be used with. The correct voltage divider for the ac adapter is already part of your emonTx Shield. You do not need to add anything else.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24971"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6151.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="João Almeida&#039;s picture" title="João Almeida&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to use ac-ac adapter to read voltage</h3>

    <div class="submitted">Submitted by <a href="../user/6151.html" title="View user profile.">João Almeida</a> on Tue, 04/11/2014 - 17:20.</div>
    <div class="content">
     <p>First&nbsp;I&#39;d like to thank you in advance for the quick response Robert.</p>
<p>As for the sample code, I got it from the Emonlib examples.</p>
<p>Regarding the first question, I currently have a single phase supply, although&nbsp;I suspect that later on in my project I&#39;ll have to switch to a 3-phase supply.</p>
<p>Now I feel dumb, because as you said, of course the voltage is the same. I don&#39;t even know why I said or even thought that, so I apologize for my &quot;momentary&nbsp;brain freeze&quot;&nbsp;xD</p>
<p>So, from what you said, me having a system with 4 CT current sensors, and the ac-ac adapter, I can use the sample code you provided, giving it a few alterations, for example, that code strikes me as if the system is communicating&nbsp;with another system trough some kind of wireless device (which I don&#39;t need to do), am I right?</p>
<p>Anyway, I&#39;ll order the ac-ac adapter and will give it a try once I get it.</p>
<p>Once again, thank you very much for your help Robert, and again, I apologize for the &quot;dumb&quot; question I posted.</p>
<p>Best regards,<br />
Jo&atilde;o Almeida.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24973"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to use ac-ac adapter to read voltage</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 04/11/2014 - 19:57.</div>
    <div class="content">
     <p>You are correct about using the radio. On the emonTx Shield, there is a RFM12B radio module that sends data to an emonBase (these days a Raspberry Pi) that can either operate a web server that receives the data and stores it locally using emonCMS, and then displays it on a web page; or with an Internet connection via your router, it can forward the data to emonCMS.org where you can have an account and store and examine your data on-line.</p>
<p>That is the normal way in which we view the data collected. You can if you wish use an Ethernet Shield or a direct serial connection instead of the radio.</p>
<p>If you do not have a RFM12B module fitted in your Shield, then you must remove (or comment out) the lines that control the RFM12B. If you do not do this, the sketch will hang and not go past that line.</p>
<p>If you do progress to a 3-phase installation, then we have "3-phase" sketches that use a delayed copy of the first phase voltage to compute an approximation for real power etc on the second and third phases. "Approximation" because it assumes the voltage on all 3 phases is identical, which of course is not guaranteed. If that is not good enough, then you need to ask somebody who knows about shields whether it is possible to stack 3 and communicate with them separately. I suspect you cannot. An alternative to that is 3 emonTx's stacked (<a href="1170.html" title="http://openenergymonitor.org/emon/node/1170">http://openenergymonitor.org/emon/node/1170</a>) or as you originally suggested - 2 extra voltage inputs using spare analogue I/O channels on your Arduino.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24974"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to use ac-ac adapter to read voltage</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 04/11/2014 - 21:30.</div>
    <div class="content">
     <p><em>then you need to ask somebody who knows about shields whether it is possible to stack 3 and communicate with&nbsp;them separately</em></p>
<p>There&#39;s nothing magical about shields. &nbsp;Those IO pins simply pass on up through the headers. &nbsp;From a schematic point of view, wherever you see A2 on your Arduino schematic, and all your shield schematics, they&#39;ll be connected.&nbsp; As a general rule you can stack as many shields as you want, so long as they don&#39;t conflict on IO pins. Additional constraints might come into play like power requirements, signal integrity etc. &nbsp;Also, some signals (like MISO, MOSI and SCLK on the SPI bus)&nbsp;are designed to be shared, so they wouldn&#39;t be considered a conflict (provided unique /CS signals are chosen for each device on the SPI bus).</p>
<p>Some shield designers go to some lengths to improve stackability, for example by adding dip-switches, jumpers etc.&nbsp;to allow the end user to configure which IO pins the shield connects to. &nbsp;A quick glance at the emonTx shield makes me think it wouldn&#39;t be stackable as you&#39;d have multiple shields driving the same analog inputs at the same time.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6050"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-4cAxllT5ke4JDSWgTPGV3PrNozqUt43qJhSDC-y72_o" value="form-4cAxllT5ke4JDSWgTPGV3PrNozqUt43qJhSDC-y72_o"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
