<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2734 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:08:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Made a meter, but some questions on readings. | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Made a meter, but some questions on readings.</h3>
        <span class="submitted">Submitted by Guest on Fri, 23/08/2013 - 15:33</span>
        <div class="content"><p>Hi,</p>
<p>Thanks to the replies from this forum, I finally made my own Open Energy&nbsp;Meter with seven segment displays as display unit. But, my readings were not matching the readings from standard devices (I requested an engineering college to provide their labs and instruments.) So I calibrated the values and got the voltages and current right but some problems &nbsp;in power and power factor.</p>
<p>I have attached a log file from the serial monitor. I used resistive load (a rheostat)</p>
<p>Standard values. from the lab equipment are &nbsp; &nbsp; <strong>Voltage 40V Current 3.95A Power 154.8W </strong></p>
  <div class="forum-topic-navigation clear-block">
          <a href="2815.html" class="topic-previous" title="Go to previous forum topic">‹ emonTX / RX consistancy of data sends</a>
              <a href="2810.html" class="topic-next" title="Go to next forum topic">emonTX issue ? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-14536"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 23/08/2013 - 15:45.</div>
    <div class="content">
     <p>1. You need to tick &quot;List&quot; when you have attached a file, else nobody can see it &quot;List&quot;-ed.</p>
<p>2. If your load is a pure resistance, then a power factor of 0.5 indicates that you have not calibrated PHASECAL. You should do that according to <a href="../modules/emontx/firmware/calibration.html">the instructions</a>.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14537"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dsantosh&#039;s picture" title="dsantosh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by dsantosh (not verified) on Fri, 23/08/2013 - 16:00.</div>
    <div class="content">
     <p>1. Thanks.</p>
<p>2. I tried both inductive and resistive loads, but forgot logging the data from inductive load. Anyway, I think I calibrated all voltage, current and phase_shift values. Let me calibrate the power factor to 1.0 for pure restive load(rheostat ?) and get the results here.</p>
<p>&nbsp;I have also uploaded the sketch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14898"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dsantosh&#039;s picture" title="dsantosh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by dsantosh (not verified) on Fri, 06/09/2013 - 05:05.</div>
    <div class="content">
     <p>Hi,&nbsp;</p>
<p>After calibrating, I am now getting fairly accurate values, but the values are fluctuating all the time. It is quite difficult since I am using 7 segments for output. Is there a way to get the output somewhat stable?&nbsp;</p>
<p>(P.S Sorry for late reply, but to get hands on the university labs is not that easy.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14914"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 06/09/2013 - 11:18.</div>
    <div class="content">
     <p>Fluctuating? How much?&nbsp; I suspect you need to put a software low pass filter in between reading the power and the display. The <a href="http://en.wikipedia.org/wiki/Low-pass_filter">Wikipedia article</a> is a good starting point - and you can look at the high pass equivalent in EmonLib - calcVI to see exactly how that is implemented.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14950"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dsantosh&#039;s picture" title="dsantosh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by dsantosh (not verified) on Sat, 07/09/2013 - 17:03.</div>
    <div class="content">
     <p>I know a little bit of filters. But the software LPF is something new to me, something like <a href="http://playground.arduino.cc/main/smooth">this</a>? Will start looking for it. Care to elaborate or some links?&nbsp;</p>
<p>San.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15074"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dsantosh&#039;s picture" title="dsantosh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by dsantosh (not verified) on Wed, 11/09/2013 - 15:24.</div>
    <div class="content">
     <p>About fluctuations, I am using a 40W soldering iron for testing, and the value I am getting ranges from 30 to 47 watts    and changing rapidly. The reading is actually difficult to read. Any suggestions? </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15079"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 11/09/2013 - 15:51.</div>
    <div class="content">
     <p>Is your iron temperature-controlled? Or you might be trying to read power + digital noise from the processor. If your full-scale current is 100 A, it&#39;s more likely to be noise. You have a high pass filter in emonLib. All you need to do is copy the way that is done and change the equation into the low-pass equivalent one from the Wikipedia article. You can change the time constant to give you fast readings with some flicker or slow readings with little or no flicker, it&#39;s your choice.</p>
<p>High Pass: y[i] := &alpha; * (y[i-1] + x[i] - x[i-1])</p>
<p>which in emonLib is&nbsp; filteredV = 0.996*(lastFilteredV+sampleV-lastSampleV)</p>
<p>Low Pass: y[i] := y[i-1] + &alpha; * (x[i] - y[i-1])</p>
<p>so you should end up with something like filteredX = lastFilteredX + 0.001 * (sampleX-lastFilteredX)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15098"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dsantosh&#039;s picture" title="dsantosh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by dsantosh (not verified) on Thu, 12/09/2013 - 06:52.</div>
    <div class="content">
     <p>No, it is not a temperature controlled.&nbsp;</p>
<p>As you said I replaced these lines &nbsp;in Emonlib.cpp:</p>
<p>filteredV = 0.996*(lastFilteredV+sampleV-lastSampleV); &nbsp; to &nbsp; filteredV = lastFilteredV+0.001*(sampleV-lastFilteredV);<br />
	filteredI = 0.996*(lastFilteredI+sampleI-lastSampleI); &nbsp;to &nbsp;filteredI = lastFilteredI+0.001*(sampleI-lastFilteredI);</p>
<p>filteredI = 0.996*(lastFilteredI+sampleI-lastSampleI); &nbsp;to &nbsp;filteredI = lastFilteredI+0.001*(sampleI-lastFilteredI);</p>
<p>But now I am getting these values which are nearly identical with(LPF_load.txt) or without load(LPF_no_load.txt), my load being the same 40W soldering iron.</p>
<p>The ouput without the modifications in filters is named HPF_load.txt</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15104"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 12/09/2013 - 13:18.</div>
    <div class="content">
     <p>You did not understand what you needed to do. You do <strong>not</strong> <em>replace</em> the lines in emonLib, so put that back as it was.</p>
<p>You are stealing the parts of emonLib that are the software filter to use to filter your power. So you will <strong>copy</strong> all the bits of emonLib that deal with the filtered voltage, call them filteredPower (or any name that you wish) and put those into your loop( ) in similar places.</p>
<p>Look at emonLib.h&nbsp; In there, you have the last sample and the last filtered variables declared, so copy those into the sketch where all the other static variables are declared and call them lastPower etc<br />
	Look at emonLib.cpp&nbsp; and in there, find where those same variables are used and put them (with your new names of course) into your loop(&nbsp; ) before you calculate the power so that you can remember the values from the previous time.<br />
	Then, after you&#39;ve calculated the (flickering) power, add in the line that is the actual filter. The input to the filter - I called it sampleX - is the power you calculated (that flickers), and the filtered output - I called it filteredX - is the power value that you send to your display.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15113"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dsantosh&#039;s picture" title="dsantosh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Made a meter, but some questions on readings.</h3>

    <div class="submitted">Submitted by dsantosh (not verified) on Thu, 12/09/2013 - 15:39.</div>
    <div class="content">
     <p>Ok got it. I was all wrong till now.&nbsp;</p>
<p>Thanks.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2734"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-J6GgH3cTWIpyvhjtrLkouYiUkiKG_vVip6KBcHhChag" value="form-J6GgH3cTWIpyvhjtrLkouYiUkiKG_vVip6KBcHhChag"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
