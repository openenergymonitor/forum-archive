<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12569 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:19:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Need help with pulsed-based gas feed. | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Need help with pulsed-based gas feed.</h3>
        <span class="submitted">Submitted by <a href="../user/9662.html" title="View user profile.">MikeSims</a> on Wed, 27/04/2016 - 13:46</span>
        <div class="content"><p>I am trying to record my gas usage in Watts from my pulse-based gas feed. I used a mod to the firmware in the Arduino from an example sketch on github that tracks the time of each detected pulse in the ISR, and uses that to derive the watts value from the duration since the previous pulse, and writes it into emonPi.power2, as this isn&#39;t otherwise in use, and it gets sent to emoncms in the usual manner, and the Input is logged to a feed using phpFina engine.</p>
<p>Once sent, the Arduino clears emonPi.power2 to zero, until the next pulse is detected.</p>
<p>The point is that the calculation has to wait until the current pulse is detected, but in the meantime, 0-Watts are being constantly written to the feed except at the time of a pulse detection. That gets me a non-zero watts value that gets written to the feed, and then we are back to a stream of zeros again. It makes no sense to me to keep streaming the last Watts value after the last pulse, because that value was only relevant to the time prior to the pulse. In fact it is relevant to all the previous datapoints in the feed going back to the previous pulse, and not to any future datapoints beyond the current pulse.</p>
<p>So I want to take that watts value and write it into all the relevant prior datapoints, going back all the way to the previous pulse, or only as far back as, say, 15 minutes ago, which ever period is shorter.</p>
<p>But I don&#39;t know how to do it.</p>
<p>I think I want to have a modified log to feed process that takes the zero watts and writes them into current time slots as normal, but if it gets a non-zero reading it writes that as normal, then calculates how far back the reading was relevant for, and writes it retrospectively into all the earlier slots within that period.</p>
<p>It sounds perfectly doable, but I am struggling to work out how to achieve it. Can anyone help? I&#39;d rather have advice than have someone do it for me, my main limitation is I am unaccustomed to php and the interactions with the feeds at low level, especially checking what the feed&#39;s sampling interval is.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12573.html" class="topic-previous" title="Go to previous forum topic">‹ Monitor two feeds with one Clip-on CT sensor</a>
              <a href="12567.html" class="topic-next" title="Go to next forum topic">Using SCT013 30A by Raspberry Pi ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
