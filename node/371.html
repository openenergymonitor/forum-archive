<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/371 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:42:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonBase not sending same data as emonTX | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonBase not sending same data as emonTX</h3>
        <span class="submitted">Submitted by <a href="../user/532.html" title="View user profile.">Tailzer</a> on Sun, 22/01/2012 - 17:34</span>
        <div class="content"><p>Hi</p>
<p>I have added a voltage input to my TX so needed to update the firmware, it now outputs correct values every 10 secs (I added a zero to the wait count as it was too often), when I check the output via the serial port all looks well.</p>
<p>I then updated the code on the emonBase (nanodeRF) and it outputs the wrong values?? nothing like what is being transmitted by the emonTX.</p>
<p>this is the payload for the TX</p>
<blockquote><p><strong><sub><sup>&nbsp;Serial.print(emontx.real1);</sup></sub></strong></p>
<p><strong><sub><sup>&nbsp; &nbsp; Serial.print(' ');</sup></sub></strong></p>
<p><strong><sub><sup>&nbsp; &nbsp; Serial.print(emon1.apparentPower);</sup></sub></strong></p>
<p><strong><sub><sup>&nbsp; &nbsp; Serial.print(' ');</sup></sub></strong></p>
<p><strong><sub><sup>&nbsp; &nbsp; Serial.print(emon1.Vrms);</sup></sub></strong></p>
<p><strong><sub><sup>&nbsp; &nbsp; Serial.print(' ');</sup></sub></strong></p>
<p><strong><sub><sup>&nbsp; &nbsp; Serial.print(emon1.Irms);</sup></sub></strong></p>
<p><strong><sub><sup>&nbsp; &nbsp; Serial.print(' ');</sup></sub></strong></p>
<p><strong><sub><sup>Serial.println(emon1.powerFactor);</sup></sub></strong></p>
</blockquote>
<p>and this is the payload on the Base</p>
<p>&nbsp;</p>
<blockquote><p><strong><sup><sub>str.print(&quot;{rf_fail:0,&quot;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(&quot;RealPower:&quot;); &nbsp; &nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(emontx.real1); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(&quot;,ApparentPower:&quot;); &nbsp; &nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(emontx.apparentpower); &nbsp; &nbsp; &nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(&quot;,Mains:&quot;); &nbsp; &nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(emontx.Vrms); &nbsp; &nbsp; &nbsp; &nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(&quot;,Current:&quot;); &nbsp; &nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(emontx.Irms);&nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(&quot;,PowerFactor:&quot;); &nbsp; &nbsp;</sub></sup></strong></p>
<p><strong><sup><sub>&nbsp; &nbsp; str.print(emontx.powerFactor);</sub></sup>&nbsp;</strong></p>
<p>&nbsp;</p>
</blockquote>
<p>I have tried taking our the rf_fail flag also but didnt make a difference.</p>
<p>&nbsp;</p>
<p>This is driving me crazy, any one have any idea what im doing wrong?</p>
<p>&nbsp;</p>
<p>Thanks</p>
<p>Gary</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="372.html" class="topic-previous" title="Go to previous forum topic">‹ Embedding charts from a remote server</a>
              <a href="319.html" class="topic-next" title="Go to next forum topic">Basic configuration of ethercard library and arduino 1.0 for posting to emoncms3 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-2834"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase not sending same data as emonTX</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 23/01/2012 - 00:20.</div>
    <div class="content">
     <p>When we refer to the 'payload' we are refering to the RF transmission payload. I think you have mixed this up with what the units are printing out to ther serial terminal. For example the emonTx single CT example transmitts the RF payload emontx.power and emontx.battery as defined near the beginning of the sketch:</p>
<pre>
typedef struct { int power, battery; } PayloadTX;     
PayloadTX emontx;   </pre><p>It is this that must be the same on the emonTx and emonBase. Name of variables does not matter but number of and order does.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2844"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/532.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-532.jpg" alt="Tailzer&#039;s picture" title="Tailzer&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase not sending same data as emonTX</h3>

    <div class="submitted">Submitted by <a href="../user/532.html" title="View user profile.">Tailzer</a> on Tue, 24/01/2012 - 12:58.</div>
    <div class="content">
     <p>&nbsp;ok, i wrongly assumed that the serial print would be in the format the RF payload was sent? i changed the names to the same as a long shot.</p>
<p>So if i had the right values but in the worng order they would just be assigned to the wrong inputs?</p>
<p>I have started again with the latest sketches from GITHUB and its working fine with just the CT info, im using CT123Voltage and it seems to be more accruate than just using a CT on its own (voltage here is normally around 233V)</p>
<p>So how do I get it to send the Powerfactor etc and mains volatge as these would be interesting to trend. Is there a wiki type page on settingup the payload? (I have looked but may have missed)</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2845"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase not sending same data as emonTX</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 24/01/2012 - 13:12.</div>
    <div class="content">
     <p>Good to hear you got it working.&nbsp;</p>
<p>To send another variable (e.g 'PF' and 'Vrms') just add it in to the payload on both the emonTx and emonBase:</p>
<pre>
typedef struct { int power, battery, PF, Vrms; } PayloadTX;</pre><p>&nbsp;Yes your correct, the order in which the variables are on the Tx will be the same order that they are received on the Rx, independant of what their called. The name of the variables in the payload don't matter, it's the order that does.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2848"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/532.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-532.jpg" alt="Tailzer&#039;s picture" title="Tailzer&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase not sending same data as emonTX</h3>

    <div class="submitted">Submitted by <a href="../user/532.html" title="View user profile.">Tailzer</a> on Tue, 24/01/2012 - 15:39.</div>
    <div class="content">
     <p>&nbsp;ok I understand now, got it sending all the data I want from Mains, next up Tempreture!</p>
<p>I might try and write up about fidling with payloads as its not so straight forward...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2849"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase not sending same data as emonTX</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 24/01/2012 - 16:00.</div>
    <div class="content">
     <p>&nbsp;That would be fantastic. If you post what you write up on the forum initally then I will make it into a page titled 'customising the emonTx' or something similar.&nbsp;</p>
<p>Remember all pages on the site are an open wiki (once logged in) feel free to edit any page if you think you can improve it. Revision history is always saved.&nbsp;</p>
<p>Thanks.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/371"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-8hlavWUM-CARKWNtPJn6sxgc2N1lmJAE0a7zjHu3TzA" value="form-8hlavWUM-CARKWNtPJn6sxgc2N1lmJAE0a7zjHu3TzA"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/371 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:42:20 GMT -->
</html>
