<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2028 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:43:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>[arduino] How to mensure if does current in a wire - UP codes 03-05 | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">[arduino] How to mensure if does current in a wire - UP codes 03-05</h3>
        <span class="submitted">Submitted by Guest on Mon, 18/02/2013 - 19:34</span>
        <div class="content"><p>Hi everyone.</p>
<p>&nbsp;</p>
<p>First of all, i want to apologie for my poor english.</p>
<p>&nbsp;</p>
<p>I live in Brazil, and I have a little home automatization projetc with Asterisk + Arduino + PHP</p>
<p>&nbsp;</p>
<p>The project it&#39;s running very well, until i need to know if does or not current in a wire!!</p>
<p>I&#39;m using&nbsp;this current sensor:</p>
<p><a href="http://dx.com/p/ac-ta12-100-current-sensor-module-for-arduino-white-red-161183" title="http://dx.com/p/ac-ta12-100-current-sensor-module-for-arduino-white-red-161183">http://dx.com/p/ac-ta12-100-current-sensor-module-for-arduino-white-red-...</a></p>
<p>&nbsp;</p>
<p>If a set the arduino programing like this:</p>
<p>int sensorValue = analogRead(A0);</p>
<p>Serial.println(sensorValue);</p>
<p>&nbsp;</p>
<p>If the light it&#39;s on, the value in the Serial monitor keeps uping and down (0 ~ 50), if light&#39;s off, the value on serial monitor, lock&#39;s on &quot;0&quot;.</p>
<p>&nbsp;</p>
<p>How can i know if the light it&#39;s on, or off?&nbsp;</p>
<p>Tank you</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2083.html" class="topic-previous" title="Go to previous forum topic">‹ rate-of-change process....</a>
              <a href="2098.html" class="topic-next" title="Go to next forum topic">Best input method to log usage ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-9982"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 18/02/2013 - 21:14.</div>
    <div class="content">
     <p>I think you need to connect the sensor <a href="https://learn.openenergymonitor.org/?redirect=ct-sensors-interface">like this</a>. Look at the code for the emonTx, and use the basic sketch emonTx_CT123.ino from <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_CT123/emonTx_CT123.ino">GitHub</a>&nbsp;&nbsp; You will also need to download and use EmonLib</p>
<p>You need to use CT 1 only, but you must change the input pin for the one you wish to use. After</p>
<pre class="rteindent1">
ct1.calcVI(20,2000);  </pre><p>you can write</p>
<pre class="rteindent1">
if (ct1.Irms &gt; 5.0)
{        // current is greater than 5 - the light is on, do something

}
else
{       // it is 5.0 or less - the light is off, do something else

}</pre><p>Change &quot;5.0&quot; to a number that is less than the current you see when the light is on.</p>
<p>You do not need the RFM12 parts, nor CT2 or CT3, so you can delete these lines:</p>
<p>&nbsp; rf12_initialize(nodeID, freq, networkGroup);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // initialize RF<br />
	&nbsp; rf12_sleep(RF12_SLEEP);<br />
	&nbsp; send_rf_data();&nbsp;</p>
<p class="rteindent1">
	&nbsp;</p>
<p class="rteindent1">&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9993"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="igorayres&#039;s picture" title="igorayres&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by igorayres (not verified) on Tue, 19/02/2013 - 11:55.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9994"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="igorayres&#039;s picture" title="igorayres&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by igorayres (not verified) on Tue, 19/02/2013 - 12:10.</div>
    <div class="content">
     <p>All right Robert Wall, tank you very much!!</p>
<p>I have some questions yet:</p>
<p>#define FILTERSETTLETIME 5000<strong> // Do i need this?</strong></p>
<p>const int CT1 = 1&nbsp;&nbsp;&nbsp; /<strong>/ What means that variable?</strong></p>
<p>
	<strong>// What its that all? I need?</strong></p>
<p>#define freq RF12_433MHZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	const int nodeID = 10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	const int networkGroup = 210;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>const int UNO = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // My arduino it&#39;s MEGA 2560, this it&#39;s correct?<br />
	#include &lt;avr/wdt.h&gt;&nbsp;&nbsp;&nbsp;</p>
<p>#include &quot;EmonLib.h&quot;<br />
	EnergyMonitor ct1,ct2,ct3;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Create&nbsp; instances for each CT channel</p>
<p><strong>// ================================================================</strong></p>
<p>
	typedef struct { int power1, power2, power3, battery; } PayloadTX;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // create structure - a neat way of packaging data for RF</p>
<p>comms&nbsp;PayloadTX emontx;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>&nbsp;//I NEED DO DECLARE ALL THOSE POWERS?&nbsp;</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>const int LEDpin = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>boolean settled = false;&nbsp; <strong>// WHAT this variable DOES?</strong></p>
<p>void setup()<br />
	{<br />
	&nbsp; Serial.begin(9600);<br />
	&nbsp; Serial.print(&quot;Node: &quot;); // I all read aks before, but what it&#39;s that &quot;node&quot; i don&#39;t need right?<br />
	&nbsp; Serial.print(nodeID);<br />
	&nbsp; Serial.print(&quot; Freq: &quot;);<br />
	&nbsp; if (freq == RF12_433MHZ) Serial.print(&quot;433Mhz&quot;);<br />
	&nbsp; if (freq == RF12_868MHZ) Serial.print(&quot;868Mhz&quot;);<br />
	&nbsp; if (freq == RF12_915MHZ) Serial.print(&quot;915Mhz&quot;);<br />
	Serial.print(&quot; Network: &quot;);<br />
	&nbsp; Serial.println(networkGroup);</p>
<p>	<strong>// What it&#39;s all this?</strong><br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; if (CT1) ct1.currentTX(1, 111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Setup emonTX CT channel (ADC input, calibration)<br />
	&nbsp; if (CT2) ct2.currentTX(2, 111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration factor = CT ratio / burden resistance<br />
	&nbsp; if (CT3) ct3.currentTX(3, 111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration factor = (100A / 0.05A) / 33 Ohms</p>
<p>	&nbsp; rf12_initialize(nodeID, freq, networkGroup);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // initialize RFM12B<br />
	&nbsp; rf12_sleep(RF12_SLEEP);<br />
	<strong>//==========================================================</strong><br />
	&nbsp; pinMode(LEDpin, OUTPUT);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Setup indicator LED<br />
	&nbsp; digitalWrite(LEDpin, HIGH);</p>
<p>	&nbsp; if (UNO) wdt_enable(WDTO_8S);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Enable anti crash (restart) watchdog if UNO bootloader is selected. Watchdog does not work with duemilanove bootloader&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Restarts emonTx if sketch hangs for more than 8s<br />
	}</p>
<p>void loop()<br />
	{<br />
	&nbsp; if (CT1) {&nbsp; <u><strong>//here it&#39;s the most important part of this programing. How can i make to know if the light its on or of, then do something?</strong></u><br />
	&nbsp;&nbsp;&nbsp; emontx.power1 = ct1.calcIrms(1480) * 240.0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //ct.calcIrms(number of wavelengths sample)*AC RMS voltage<br />
	&nbsp;&nbsp;&nbsp; Serial.print(emontx.power1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; }</p>
<p>	&nbsp; emontx.battery = ct1.readVcc();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong> //I need this?</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //read emonTx battey (supply voltage)</p>
<p>	&nbsp; Serial.print(&quot; &quot;); Serial.print(emontx.battery);<br />
	&nbsp; Serial.println(); delay(100);</p>
<p>&nbsp; // because millis() returns to zero after 50 days !<br />
	&nbsp; if (!settled &amp;&amp; millis() &gt; FILTERSETTLETIME) settled = true;</p>
<p>&nbsp; if (settled)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // send data only after filters have settled<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; send_rf_data();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // *SEND RF DATA* - see emontx_lib<br />
	&nbsp;&nbsp;&nbsp; digitalWrite(LEDpin, HIGH); delay(2); digitalWrite(LEDpin, LOW);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // flash LED<br />
	&nbsp;&nbsp;&nbsp; emontx_sleep(5);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // sleep or delay in seconds - see emontx_lib<br />
	&nbsp; }<br />
	}</p>
<p>I sorry for too much questions.Once more, tank you</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9995"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 19/02/2013 - 13:13.</div>
    <div class="content">
     <p>I have not tested it, but I think this will work.&nbsp; It will read the current transformer 1480 times over a time of about 0.25 s and calculate the average current and print it. Then it will go to sleep for 5 s and repeat the measurement.</p>
<p>You will not get an accurate measurement for the first 5 s after power-on because the filter will not be at the correct operating point (FILTRERSETTLETIME).</p>
<p>&nbsp;</p>
<p>#define FILTERSETTLETIME 5000</p>
<p>const int UNO = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // My arduino it&#39;s MEGA 2560, this it&#39;s correct? -<em>It enables the watchdog timer</em>.<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; <em>Set UNO = 0 if your bootloader does not have the watchdog timer</em><br />
	#include &lt;avr/wdt.h&gt;&nbsp;&nbsp;&nbsp;</p>
<p>#include &quot;EmonLib.h&quot;<br />
	EnergyMonitor ct1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Create an instance</p>
<p><strong>// ================================================================</strong></p>
<p>const int LEDpin = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>boolean settled = false;&nbsp; <strong>// WHAT this variable DOES?</strong> - <em>allows time for the high pass filter to settle.</em></p>
<p>void setup()<br />
	{<br />
	&nbsp; Serial.begin(9600);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; ct1.currentTX(1, 111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Setup emonTX CT channel (ADC input, calibration)<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration factor = CT ratio / burden resistance<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration factor = (100A / 0.05A) / 33 Ohms</p>
<p><strong>//==========================================================</strong><br />
	&nbsp; pinMode(LEDpin, OUTPUT);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Setup indicator LED<br />
	&nbsp; digitalWrite(LEDpin, HIGH);</p>
<p>&nbsp; if (UNO) wdt_enable(WDTO_8S);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Enable anti crash (restart) watchdog if UNO bootloader<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // &nbsp; is selected. Watchdog does not work with duemilanove<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; //&nbsp; &nbsp; bootloader. Restarts emonTx if sketch hangs for more than 8s<br />
	}</p>
<p>void loop()<br />
	{<br />
	&nbsp;&nbsp;&nbsp; ct1.calcIrms(1480);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //ct.calcIrms(number of wavelengths sample)<br />
	&nbsp;&nbsp;&nbsp;</p>
<p>&nbsp; &nbsp; if (ct1.Irms &gt; 5.0)<br />
	&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // current is greater than 5 - the light is on, do something</p>
<p>&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // it is 5.0 or less - the light is off, do something else</p>
<p>&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp; // because millis() returns to zero after 50 days !<br />
	&nbsp; if (!settled &amp;&amp; millis() &gt; FILTERSETTLETIME) settled = true;</p>
<p>&nbsp; if (settled)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // send data only after filters have settled<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; digitalWrite(LEDpin, HIGH); delay(2); digitalWrite(LEDpin, LOW);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // flash LED</p>
<p>&nbsp;&nbsp;&nbsp; Serial.print(&quot;I = &quot;);Serial.println(ct1.Irms);</p>
<p>&nbsp;&nbsp;&nbsp; emontx_sleep(5);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // sleep or delay in seconds - see emontx_lib<br />
	&nbsp; }<br />
	}</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9997"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 19/02/2013 - 14:20.</div>
    <div class="content">
     <p>The link you posted earlier, Robert, didn&#39;t work for me.&nbsp; My browser shows this 404 page as:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_CT123/emonTx_CT123.ino " title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_CT123/emonTx_CT123.ino%C2%A0">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_C...</a></p>
<p>But if the characters after the &quot;.ino&quot; are removed, it works fine:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_CT123/emonTx_CT123.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_CT123/emonTx_CT123.ino</a></p>
<p>(the odd characters at the end of the line don&#39;t appear in the browser&#39;s address window, only when I copy and paste that address here)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9999"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 19/02/2013 - 14:53.</div>
    <div class="content">
     <p>Thanks. The 404 was due to the way the &quot;link&quot; was parsed and automatically turned into a link by Drupal (the back-end code behind this website) - it had added a space that GitHub didn&#39;t ignore.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10011"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="igorayres&#039;s picture" title="igorayres&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by igorayres (not verified) on Tue, 19/02/2013 - 19:25.</div>
    <div class="content">
     <p>Robert Walll Tank you so much!!</p>
<p>&nbsp;</p>
<p>I don&#39;t understand yet where a configrue the pin who will read the current,</p>
<p>&nbsp;</p>
<p>LedPin&nbsp;it&#39;s pin n&ordm; 9, who will blik (HIGH or LOW)</p>
<p>&nbsp;</p>
<p>I conect the current sensor in a alanog port of my ARDUINO, how i set then up?</p>
<p>&nbsp;</p>
<p>Tanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10014"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 19/02/2013 - 19:57.</div>
    <div class="content">
     <p>I think you need to connect the sensor <a href="https://learn.openenergymonitor.org/?redirect=ct-sensors-interface">like this</a>, but I am not certain. The link you gave to the sensor contained confusing and probably incorrect technical information.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10049"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 22/02/2013 - 09:48.</div>
    <div class="content">
     <p>Hi Igor,&nbsp; in your first message, you wrote:</p>
<p><em>If a set the arduino programing like this:</em></p>
<p><em>int sensorValue = analogRead(A0);</em></p>
<p><em>Serial.println(sensorValue); </em></p>
<p><em>If the light it&#39;s on, the value in the Serial monitor keeps uping and down (0 ~ 50), if light&#39;s off, the value on serial monitor, lock&#39;s on &quot;0&quot;. </em></p>
<p><em>How can i know if the light it&#39;s on, or off? </em></p>
<p>I hope you now realise that the Arduino cannot measure current using a single analogRead() statement.&nbsp; You need to use a program (sketch) which calls analogRead() many times and then works out the average value.&nbsp; Robert has already given you some information about how to do this.</p>
<p>If you simply connect a CT to the Arduino, then you would probably get exactly the kind of behaviour that you were seeing.&nbsp; One of the tasks of the current sensor circuit is to bias the signal at 2.5V which is the mid-point of the Arduino&#39;s ADC range.&nbsp; Then you would see values which lie equally either side of the midpoint, e.g. 450 - 550, rather than being right near the bottom of the range (i.e. 0 to 50).&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10303"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="igorayres&#039;s picture" title="igorayres&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by igorayres (not verified) on Tue, 05/03/2013 - 11:37.</div>
    <div class="content">
     <p>Hi everyone!! I have some upgrades in this project.</p>
<p>&nbsp;</p>
<p>I using the exemple who follow the emon.Library off current only. Well done...</p>
<p>&nbsp;</p>
<p>When I use the exemple &quot;current only&quot; and upload the code for arduino, he whorks very well! When the light it&#39;s OFF the value in the monitor keeps in 0.00 or -0.00 and when the light it&#39;s on the value keep between &nbsp; &nbsp; -0.49 &nbsp; &nbsp;~ &nbsp; -0.51.</p>
<p>&nbsp;</p>
<p>But when I apply this code in my code of this project, wher I turn ON the lights, the value keeps correct, but my problem is, when I &nbsp;shut down the light!! The monitor goes NUT&quot;s!! The valou goes to - 4.00 -3.48 i have to send an &quot;1&quot; to normalize the values.</p>
<p>&nbsp;</p>
<p>Can you guys, please, help me?</p>
<p>&nbsp;</p>
<p>Follow the code i using:</p>
<p>&nbsp;</p>
<pre>
// Incluindo bibliotecas (includiing libraries)

#include &quot;EmonLib.h&quot;                   // Include Emon Library
EnergyMonitor emon1;                   // Create an instance

//Declarando variaveis globais (globals variables)

char readpin[2] = &quot;&quot;; //Variavel que recebe os dados da Serial (3 digitos)
int porta = 0;  // Variavel que ira receber os pinos
char sensorValue; //Variavel que recebe os valores dos sensores

//Variaveis para conversao de char, para int (calculos)
int d = 0;
int u = 0;
int c = 0;  

//===============================================================

void setup(){ 

  Serial.begin(9600);
  Serial.println(&quot;Iniciando o Programa);
  pinMode(13,OUTPUT);
  emon1.current(13, 111.1);  // Calibrando o pino de entrada
 
}

void loop(){   
   
      double Irms = emon1.calcIrms(1480) * 240.0;  <u><strong> // Is this correct?</strong></u>
      Serial.println(Irms);  //this print it&#39;s only for debug propose
      delay(100);
   
  if (Serial.available() &gt; 0) {
      for (int i=0;i&lt;3;i++){
      //Armazena na string (array de char)
      readpin[i] = Serial.read();
      delay(10);
   }
     
      d = (int) (readpin[0] - &#39;0&#39;);
      u = (int) (readpin[1] - &#39;0&#39;);
      c = (int) (readpin[2] - &#39;0&#39;);  
      porta = (int) (d*10+u);
     // d * 10 + u;
     // porta = 13;

      Serial.println(porta);
      Serial.println(c);  
     
     
      switch(c){
        case 1:
          delay(20);
          Serial.println(&quot;Ligando luz&quot;);
          Serial.println(Irms);
            if (Irms &gt; -0.15){
              delay(200);
              digitalWrite(porta,!digitalRead(porta));
              int Irms = 0;
          }
        delay(20);
        break;

<strong>// SO FAR IT&#39;s ALL RIGHT!! MY PROBLEM BEGGIN WHEN I SHUTDOWN THE LIGHT&#39;s!!!</strong>
        

        case 0:
          delay(20);
          Serial.println(&quot;​Desligando luz&quot;);
          Serial.println(Irms);
          //Irms = &#39;\0&#39;;
            if (Irms &lt; -0.10){
              delay(200);
              digitalWrite(porta,!digitalRead(porta));
             // byte Irms = 0.00;
          }
        delay(20);
        break; 
     
        case 2:
        sensorValue = analogRead(porta);
        delay(200);
        if (sensorValue &gt; 0){
          Serial.print(1);
          delay(20);
        }
        else {
          Serial.print(0);
          delay(20);
        }
        delay(20);
        break; 
      }
      //digitalWrite(porta,c);
     
   }
  

} </pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10306"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 05/03/2013 - 17:20.</div>
    <div class="content">
     <p>What is the light that you are talking about?&nbsp; The CT measures AC current that is flowing along one core of a cable.&nbsp; That current could be taken by any kind of load, such as a heater or a light bulb.&nbsp; If you want to detect when your room goes from light to dark, you would need a different type of sensor which can measure illumination (brightness) rather than AC current.</p>
<p>Here is a display which shows the AC current that is taken by my 3 kW kettle.&nbsp; I am also measuring the voltage, but there is no need for you to do this.&nbsp; You could measure and display just the current by itself.</p>
<p><a href="../sites/default/files/normal_3kW.jpg"><img alt="" height="300" src="../sites/default/files/normal_3kW.jpg" width="500" /></a></p>
<p>The sketch that I used for this is my RawSamplesTool.&nbsp; You can download this tool and run it for yourself.&nbsp; Because it gives you a display rather than just numbers, you may find it more helpful than the standard OEM current-only sketch.&nbsp; All of the tools that I&#39;ve posted are listed at <a href="1757.html">http://openenergymonitor.org/emon/node/1757</a></p>
<p>I hope this is useful.&nbsp; If you could tell us exactly what you are trying to do, we may be able to give you more help.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10307"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="igorayres&#039;s picture" title="igorayres&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by igorayres (not verified) on Tue, 05/03/2013 - 18:18.</div>
    <div class="content">
     <p>calypso_rae sorry by my poor description.</p>
<p>&nbsp;</p>
<p>When a I said light, i means a commun lamp connect in a trii way wich a commun&nbsp;switch, just like this:</p>
<p><a href="../../../4.bp.blogspot.com/-P0xxbggy_0g/T_D2Bsfx_EI/AAAAAAAAAJE/r_8MpTfuqOE/s1600/tree_way_03.jpg" title="http://4.bp.blogspot.com/-P0xxbggy_0g/T_D2Bsfx_EI/AAAAAAAAAJE/r_8MpTfuqOE/s1600/tree_way_03.jpg">http://4.bp.blogspot.com/-P0xxbggy_0g/T_D2Bsfx_EI/AAAAAAAAAJE/r_8MpTfuqO...</a></p>
<p>&nbsp;</p>
<p>The left switch its a commum&nbsp;triway switch, and the right, its my relay board.</p>
<p>&nbsp;</p>
<p>I put the current sensor in the positive wire who goes to the lamp (right switch), &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10309"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 05/03/2013 - 21:51.</div>
    <div class="content">
     <p>The circuit that you&#39;ve shown is what is known here as a 2-way light circuit.&nbsp; This means that the light can be operated using either of the switches.&nbsp;</p>
<p>The Arduino can only detect when current is flowing in the wire that goes through its CT.&nbsp; Not all of the wires in that diagram carry current when the light is on.&nbsp; It depends on which switches you have operated.&nbsp;</p>
<p>If you clip your CT around one of the main wires, either Live or Neutral, it should always be able to detect whether the light is on or off.&nbsp; When the light is off, the sketch should detect 0W.&nbsp; When the light is on, the sketch should detect 60W or whatever power your light is taking.</p>
<p>Have you tried my RawSamplesTool yet?&nbsp; This sketch  will show you whether your Voltage and Current sensors are giving good waveforms.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10336"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="igorayres&#039;s picture" title="igorayres&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by igorayres (not verified) on Wed, 06/03/2013 - 15:12.</div>
    <div class="content">
     <p>All Right Calypso, tankyou very mych.</p>
<p>&nbsp;</p>
<p>I have seen you RawSampleTool and its a very nice sketch.</p>
<p>&nbsp;</p>
<p>The current sensor is flowing the Live wire (relay - lamp), and what I need, its justa a simple scketh to know if does or not current in this wire, so i can make something, just this, can you please help me?</p>
<p>&nbsp;</p>
<p>Exemple</p>
<p>I declare&nbsp;a variable to recived&nbsp;informaton of the current sensor,</p>
<p>&nbsp;</p>
<p>If does current in the wire (how you said, 60W, or something ...), do something, if not (0W) does something else.</p>
<p>&nbsp;</p>
<p>Just this.</p>
<p>&nbsp;</p>
<p>Can you help me please?</p>
<p>&nbsp;</p>
<p>Tank you</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10338"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 06/03/2013 - 18:15.</div>
    <div class="content">
     <p>On Fri, 22/02/2013 - 09:48, I explained that you can&#39;t just take a single measurement from the CT.&nbsp; Readings from the CT have to be processed by some kind of sketch which calculates the amount of current that is flowing.&nbsp; Looking at your code, I&#39;m not sure that you have understood this point yet.</p>
<p>The simplest sketch for you to use is probably the current-only one in the Building Blocks section.&nbsp; This sketch will only work if your sensors are set up correctly.&nbsp; You can check this using RawSamplesTool, but it does require a voltage sensor.</p>
<p>If you only have a current sensor (not a voltage sensor) then you could check that it is working correctly by using my MinAndMaxValues tool.&nbsp; When there is no current in your wire, the values should stay at around 512.&nbsp; But when the light is turned on, the Min and Max values should immediately change.&nbsp;</p>
<p>Once you can get results like this, you will know that your current sensor is working.&nbsp; Then we can help you with the rest of your sketch.&nbsp;</p>
<p>Robin</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10339"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [arduino] How to mensure if does current in a wire - UP codes 03-05</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 06/03/2013 - 18:33.</div>
    <div class="content">
     <p>In your code, in setup(), you need an extra &quot; character in the line:</p>
<pre>
  Serial.println(&quot;Iniciando o Programa);
</pre><p>Without this, your code would not compile for me.&nbsp;</p>
<p>To use any results from the current-only sketch, you need to extract the data from inside the EnergyMonitor structure, of which there is one instance, called emonTx.&nbsp; That&#39;s what the following two lines are doing:</p>
<pre>
      double Irms = emon1.calcIrms(1480) * 240.0;   // Is this correct?
      Serial.println(Irms);  //this print it&#39;s only for debug propose
</pre><p>To find out whether the circuit is on or off, you could just compare the value of Irms with some constant value:</p>
<p>if (Irms &gt; 0.1)</p>
<p>&lt;circuit is on&gt;</p>
<p>else</p>
<p>&lt;circuit is off&gt;</p>
<p>Does that make sense?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2028"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ogMD5Bvp0FgKXlsCxK2gNn64BQHBxb5UsALAOYUWj_U" value="form-ogMD5Bvp0FgKXlsCxK2gNn64BQHBxb5UsALAOYUWj_U"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/2028 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:43:54 GMT -->
</html>
