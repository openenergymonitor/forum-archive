<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10890 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:30:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>RFM2PI v2 (ATMEGA328) Automatic upgrade - timeouts | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">RFM2PI v2 (ATMEGA328) Automatic upgrade - timeouts</h3>
        <span class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Tue, 23/06/2015 - 20:55</span>
        <div class="content"><p>If I try the automatic upgrade on emonCMS, the following happens..</p>
<pre>
avrdude-original: Version 5.11.1, compiled on May 23 2012 at 11:08:25
                  Copyright (c) 2000-2005 Brian Dean, <a href="http://www.bdmicro.com/" title="http://www.bdmicro.com/">http://www.bdmicro.com/</a>
                  Copyright (c) 2007-2009 Joerg Wunsch

                  System wide configuration file is &quot;/etc/avrdude.conf&quot;
                  User configuration file is &quot;/root/.avrduderc&quot;
                  User configuration file does not exist or is not a regular file, skipping

                  Using Port                    : /dev/ttyAMA0
                  Using Programmer              : arduino
                  Overriding Baud Rate          : 115200
avrdude-original: Using autoreset DTR on GPIO Pin 7
avrdude-original: stk500_getsync(): not in sync: resp=0xe0</pre><p>​</p>
<p>However, If I run this, it works fine.</p>
<pre>
avrdude -v -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 38400 -U flash:w:/home/pi/RFM2Pi/firmware/RFM69CW_RF_Demo_ATmega328/RFM12_Demo_ATm
ega328.cpp.hex

</pre><p>Looks like a baud rate issue - anyone else have this?</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10853.html" class="topic-previous" title="Go to previous forum topic">‹ Powering EmonTX via battery and AC adpter at the same time ?</a>
              <a href="10882.html" class="topic-next" title="Go to next forum topic">Incorrect temperature from emonTH ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31643"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM2PI v2 (ATMEGA328) Automatic upgrade - timeouts</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 23/06/2015 - 21:38.</div>
    <div class="content">
     <p>That update routine is really configured for the&nbsp;emonpi&nbsp;rather than a rfm2pi, You could edit the update command usually located in the&nbsp;<a href="https://github.com/openenergymonitor/emonpi/blob/master/Atmega328/update#L5">/home/pi/emonpi/Atmega328/update</a> script</p>
<p>Change the &quot;-b&nbsp;= 115200&quot; to 38400 and also point it at&nbsp;the correct target hex&nbsp;file as it will try and upload the emonpi sketch.</p>
<p>The changes you make could get over written by future updates and may even fail to get used at all&nbsp;as I believe the emonpi&nbsp;software containing the firmware will be updated prior to uploading the new firmware, hopefully the local changes will prevent git from pulling in any changes without stalling the process.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31651"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM2PI v2 (ATMEGA328) Automatic upgrade - timeouts</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Wed, 24/06/2015 - 08:16.</div>
    <div class="content">
     <p>Ah, thats where I&#39;m getting mixed up, how does the script detect that its an emonPi rather than rfm2pi ?</p>
<p>Does the emonpi firmware work on the rfm2pi ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31652"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM2PI v2 (ATMEGA328) Automatic upgrade - timeouts</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 24/06/2015 - 10:24.</div>
    <div class="content">
     <p>No mixup :-)</p>
<p>Currently the emonPi&nbsp;settings are hardcoded so it will only work for the emonPi. Ideally the update script should use the hardware and firmware information in emonhub.conf [nodes] to construct the avrdude commandline but that&#39;s not yet implemented.</p>
<p>The emonPi uses the standard &quot;uno&quot; settings while the rfm2pi&#39;s use a different bootloader&nbsp;due to using it&#39;s internal 8MHz clock rather an external 16MHz&nbsp;xtal and that bootloader&nbsp;requires a baud of 38400.</p>
<p>This current update routine also causes a problem for user calibration values and any customisation of the sketches as it uses precompiled&nbsp;hex files, the next step is to compile the sketch&nbsp;locally at update/upload time, but that&#39;s&nbsp;quite involved.</p>
<p>For now just edit the update file directly with the corrected commandline or continue to do updates manually.It maybe better to go with the latter to avoid the hassle of upsetting git or over writing you edits, plus there is no check to see if the firmware has changed so every time you update emoncms and&nbsp;emonhub&nbsp;or the other&nbsp;emonpi&nbsp;files the hex file gets burned to the AVR&nbsp;regardless, which really isn&#39;t needed.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10890"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-_t0kFBLEbAv3BIo80zD9dTnkCz9jkMbuf9f36uXB6YQ" value="form-_t0kFBLEbAv3BIo80zD9dTnkCz9jkMbuf9f36uXB6YQ"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
