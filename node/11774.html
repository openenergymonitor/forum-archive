<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11774 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:47:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emoncms 9.2 - power to kwh feed stopped incrementing | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emoncms 9.2 - power to kwh feed stopped incrementing</h3>
        <span class="submitted">Submitted by <a href="../user/8609.html" title="View user profile.">JumpMaster</a> on Mon, 07/12/2015 - 17:52</span>
        <div class="content"><p>Hi,</p>
<p>I have my power input going to three feeds. &nbsp;wh accumilator, power to kwh/d, and power to kwh. &nbsp;As of Saturday the power to kwh feed has stopped incrementing but the other two feeds are working as expected.</p>
<p>If I create a new feed it increments as expected but if I import my data using the useful script&nbsp;power_to_kwh.php it stops pretty quickly. &nbsp;There seem to be a rounding error from my brief look at the logs. &nbsp;I&#39;ve just ran the&nbsp;power_to_kwh.php script and here you can see the feed is stuck jumping between 1018.240 and 1018.241.</p>
<p>&nbsp;</p>
<p>2015-12-07 17:48:01.140|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510481">1449510481</a> feedtime=<a href="tel:1449510481">1449510481</a> value=1018.2429833333 arg=join<br />
2015-12-07 17:48:01.142|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510481">1449510481</a> value=1018.2429833333 padding=join<br />
2015-12-07 17:48:11.047|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510491">1449510491</a> feedtime=<a href="tel:1449510491">1449510491</a> value=1018.2408666667 arg=join<br />
2015-12-07 17:48:11.049|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510491">1449510491</a> value=1018.2408666667 padding=join<br />
2015-12-07 17:48:21.058|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510501">1449510501</a> feedtime=<a href="tel:1449510501">1449510501</a> value=1018.241275 arg=join<br />
2015-12-07 17:48:21.059|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510501">1449510501</a> value=1018.241275 padding=join<br />
2015-12-07 17:48:31.067|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510511">1449510511</a> feedtime=<a href="tel:1449510511">1449510511</a> value=1018.2409916667 arg=join<br />
2015-12-07 17:48:31.069|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510511">1449510511</a> value=1018.2409916667 padding=join<br />
2015-12-07 17:48:41.075|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510521">1449510521</a> feedtime=<a href="tel:1449510521">1449510521</a> value=1018.2409916667 arg=join<br />
2015-12-07 17:48:41.077|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510521">1449510521</a> value=1018.2409916667 padding=join<br />
2015-12-07 17:48:51.085|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510531">1449510531</a> feedtime=<a href="tel:1449510531">1449510531</a> value=1018.2412277778 arg=join<br />
2015-12-07 17:48:51.087|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510531">1449510531</a> value=1018.2412277778 padding=join<br />
2015-12-07 17:49:01.144|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510541">1449510541</a> feedtime=<a href="tel:1449510541">1449510541</a> value=1018.2409916667 arg=join<br />
2015-12-07 17:49:01.146|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510541">1449510541</a> value=1018.2409916667 padding=join<br />
2015-12-07 17:49:11.108|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510551">1449510551</a> feedtime=<a href="tel:1449510551">1449510551</a> value=1018.2411722222 arg=join<br />
2015-12-07 17:49:11.110|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510551">1449510551</a> value=1018.2411722222 padding=join<br />
2015-12-07 17:49:21.105|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510561">1449510561</a> feedtime=<a href="tel:1449510561">1449510561</a> value=1018.2410472222 arg=join<br />
2015-12-07 17:49:21.107|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510561">1449510561</a> value=1018.2410472222 padding=join<br />
2015-12-07 17:49:31.128|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510571">1449510571</a> feedtime=<a href="tel:1449510571">1449510571</a> value=1018.2409694444 arg=join<br />
2015-12-07 17:49:31.130|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510571">1449510571</a> value=1018.2409694444 padding=join<br />
2015-12-07 17:49:41.129|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510581">1449510581</a> feedtime=<a href="tel:1449510581">1449510581</a> value=1018.2412666667 arg=join<br />
2015-12-07 17:49:41.131|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510581">1449510581</a> value=1018.2412666667 padding=join<br />
2015-12-07 17:49:51.135|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510591">1449510591</a> feedtime=<a href="tel:1449510591">1449510591</a> value=1018.2409777778 arg=join<br />
2015-12-07 17:49:51.137|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510591">1449510591</a> value=1018.2409777778 padding=join<br />
2015-12-07 17:50:01.154|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510601">1449510601</a> feedtime=<a href="tel:1449510601">1449510601</a> value=1018.2410055556 arg=join<br />
2015-12-07 17:50:01.156|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510601">1449510601</a> value=1018.2410055556 padding=join<br />
2015-12-07 17:50:11.137|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510611">1449510611</a> feedtime=<a href="tel:1449510611">1449510611</a> value=1018.2412222222 arg=join<br />
2015-12-07 17:50:11.139|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510611">1449510611</a> value=1018.2412222222 padding=join<br />
2015-12-07 17:50:21.152|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510621">1449510621</a> feedtime=<a href="tel:1449510621">1449510621</a> value=1018.2412333333 arg=join<br />
2015-12-07 17:50:21.154|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510621">1449510621</a> value=1018.2412333333 padding=join<br />
2015-12-07 17:50:31.163|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510631">1449510631</a> feedtime=<a href="tel:1449510631">1449510631</a> value=1018.241025 arg=join<br />
2015-12-07 17:50:31.165|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510631">1449510631</a> value=1018.241025 padding=join<br />
2015-12-07 17:50:41.168|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510641">1449510641</a> feedtime=<a href="tel:1449510641">1449510641</a> value=1018.2409916667 arg=join<br />
2015-12-07 17:50:41.170|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510641">1449510641</a> value=1018.2409916667 padding=join<br />
2015-12-07 17:50:51.161|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510651">1449510651</a> feedtime=<a href="tel:1449510651">1449510651</a> value=1018.2413138889 arg=join<br />
2015-12-07 17:50:51.164|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510651">1449510651</a> value=1018.2413138889 padding=join<br />
2015-12-07 17:51:01.168|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510661">1449510661</a> feedtime=<a href="tel:1449510661">1449510661</a> value=1018.2409944444 arg=join<br />
2015-12-07 17:51:01.169|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510661">1449510661</a> value=1018.2409944444 padding=join<br />
2015-12-07 17:51:11.208|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510671">1449510671</a> feedtime=<a href="tel:1449510671">1449510671</a> value=1018.241175 arg=join<br />
2015-12-07 17:51:11.210|INFO|PHPFina.php|post() id=3 timestamp=<a href="tel:1449510671">1449510671</a> value=1018.241175 padding=join<br />
2015-12-07 17:51:21.217|INFO|feed_model.php|insert_data() feedid=3 updatetime=<a href="tel:1449510681">1449510681</a> feedtime=<a href="tel:1449510681">1449510681</a> value</p>
<p>&nbsp;</p>
<p>If anyone needs a copy of my data or to test a patch let me know.</p>
<p>Thanks,<br />
Kev</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12316.html" class="topic-previous" title="Go to previous forum topic">‹ Trouble downloading Emoncms.org feed to local Emoncms and seeing it</a>
              <a href="12280.html" class="topic-next" title="Go to next forum topic">New emoncms data viewer: Graph ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-36828"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8839.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/8839.html" title="View user profile.">joyrider3774</a> on Tue, 08/12/2015 - 09:28.</div>
    <div class="content">
     <p>i had the same problem and i described it somewhere&nbsp;near the end of&nbsp;the first page on this thread (<a href="11009.html#comment-35658">openenergymonitor.org/emon/node/11009#comment-35658</a>) it&#39;s a huge thread so scroll down till you see my screenshots a bit further in the post. On one of the screenshots you can see a straight line while after recalculating kwh using the script that was gone. This was the same problem as you are describing.&nbsp;Ii also found out the culprit and a solution. basically it&#39;s a mysql problem. value is defined as float which has a precision of .XXX which is not precise enough following statements alters the value in the feeds table to be more precise to be 12 points after the decimal point and 14 before</p>
<p>try this statement ALTER TABLE `feeds` CHANGE `value` `value` FLOAT(26,12) NULL DEFAULT NULL;</p>
<p>or ALTER TABLE `feeds` CHANGE `value` `value` DECIMAL(26,12) NULL DEFAULT NULL;</p>
<p>it will change the precision of float or switch to decimal. for more info look up my posts in that thread above</p>
<p>&nbsp;</p>
<p>just make sure 26 total&nbsp;digits is enough (the 1st value is total digit&#39;s the 2nd number, digit&#39;s after decimal point) so this should give you 26-12 14 number before decimal point (could be 13 also if decimal point is included) so 99999999999999.999999999999 is the max value then (for all feeds)</p>
<p><em>Edit - fixed link to point to relevant comment in thread - Moderator, BT</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36845"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8609.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8609.jpg" alt="JumpMaster&#039;s picture" title="JumpMaster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/8609.html" title="View user profile.">JumpMaster</a> on Tue, 08/12/2015 - 17:40.</div>
    <div class="content">
     <p>Having to edit the DB is one hell of a change. &nbsp;I&#39;d like to know what&nbsp;chaveiro thinks of this issue and fix and how it will affect future updates.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36850"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Tue, 08/12/2015 - 22:31.</div>
    <div class="content">
     <p>Hi JumpMaster, there is no problem altering the feeds table to increase precision.<br />
This problem can be mitigated by using redis in alternative.</p>
<p>Anyway can you add this log line to process_processlist.php about line 289 to get more details:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($time_elapsed&gt;0 &amp;&amp; $time_elapsed&lt;7200) { // 2hrs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // kWh calculation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $kwh_inc = ($time_elapsed * $value) / 3600000.0;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $new_kwh = $last_kwh + $kwh_inc;<br />
<strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;log-&gt;info(&quot;power_to_kwh() feedid=$feedid last_kwh=$last_kwh kwh_inc=$kwh_inc new_kwh=$new_kwh last_time=$last_time time_now=$time_now&quot;);</strong></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else {</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36853"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8609.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8609.jpg" alt="JumpMaster&#039;s picture" title="JumpMaster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/8609.html" title="View user profile.">JumpMaster</a> on Tue, 08/12/2015 - 23:04.</div>
    <div class="content">
     <p>Hi,</p>
<p>Thanks for replying Chaveiro. &nbsp;I did previously use redis but must have left it disabled after having to replace the settings.php file.</p>
<p>I changed the feeds table as Joyrider suggested and it did indeed fix the issue. &nbsp;This was easily reverted using update and check database button from the administration menu. &nbsp;I have now enabled redis and hopefully the accuracy will return without having to modify the database.</p>
<p>Thanks for your help,<br />
Kev</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36880"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8609.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8609.jpg" alt="JumpMaster&#039;s picture" title="JumpMaster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/8609.html" title="View user profile.">JumpMaster</a> on Wed, 09/12/2015 - 17:21.</div>
    <div class="content">
     <p>Hi,</p>
<p>I just wanted to confirm that enabling redis&nbsp;seems to have fixed the issue and the kwh is incrementing as expected and matches the kwh/d feed in myelectric or the android app.</p>
<p>Thanks everyone for your help!<br />
Kev</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36885"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Wed, 09/12/2015 - 19:07.</div>
    <div class="content">
     <p>No problem Kev.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36896"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8839.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/8839.html" title="View user profile.">joyrider3774</a> on Thu, 10/12/2015 - 12:48.</div>
    <div class="content">
     <p>since not all of us are using redis, any chanse to get more precision on the feed value column in the official version, or would i need to change it myselve with every new emoncms release ?</p>
<p>if redis is used the precision on the last value in redis is probably good enough but if redis is not used mysql is used to get the last value from the feed table and then we can stumble upon this problem.</p>
<p>Since i&#39;ve seen already 3 people, including myselve and jumpmaster that had this problem when redis is not used it might be a good idea to increase precision on the official version in mysql as well.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37196"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8733.jpg" alt="CidiRome&#039;s picture" title="CidiRome&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/8733.html" title="View user profile.">CidiRome</a> on Fri, 18/12/2015 - 21:05.</div>
    <div class="content">
     <p>Hi.</p>
<p>On another thread I was advised to make this change because I was having problems with KWh calculations</p>
<p><em>ALTER TABLE `feeds` CHANGE `value` `value` DECIMAL(26,12) NULL DEFAULT NULL;</em></p>
<p>But, today I noticed that I was having wrong values again and it was changed again to <em>float</em>.</p>
<p>I suspect that it was the last updates of EmonCMS that &quot;undone&quot; that change.</p>
<p>Wasn&#39;t it a good idea to change the distribution to the correct value in order to avoid this kind of errors?</p>
<p>Cheers.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37197"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8839.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/8839.html" title="View user profile.">joyrider3774</a> on Fri, 18/12/2015 - 21:11.</div>
    <div class="content">
     <p abp="717">@CidiRome</p>
<p abp="718">this is what i do before each database update i do from a new version i make sure that in \Modules\feed\feed_schema.php the value is not defined as float but as decimal(26,12) instead of float. If you only do the statement in mysql it will revert to float as soon as you hit the update database button in the administration section. making the change in that file above will make sure that it won&#39;t revert to float. But it&#39;s possible, depeninding how you update your version that you need to do it with each new install</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39428"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3296.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3296.jpg" alt="CapnBry&#039;s picture" title="CapnBry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3296.html" title="View user profile.">CapnBry</a> on Mon, 15/02/2016 - 02:45.</div>
    <div class="content">
     <p>I haven&#39;t been home for a couple of weeks and noticed that my power usage was also so low that it was unbeievable (0.3-0.6kWh/day). I just spent about 2 hours tracking down what was happening,&nbsp;suspecting the PHPFina&nbsp;engine was having a problem with single precision floats. Turns out it is fine, because the running total is actually stored on in the MySQL server! I was trying to go from 1257.77 to&nbsp;1257.7721511111 and MySQL was doing me a favor and rounding that back to 1257.77 despite there being plenty of bits of precision in a 32 bit float to store that increment.</p>
<p>I couldn&#39;t imagine I was the only person with this issue so google brought me here. I actually updated my mysql feeds table to type &quot;double&quot;. I really think this should be what emoncms uses as well, because everyone&#39;s kWh feeds will fail eventually once the value gets high enough (unless they&#39;re using redis).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39430"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 15/02/2016 - 09:18.</div>
    <div class="content">
     <p>Yes, I&#39;ve noticed the same, since February 3rd/4th my kwh accumulated values have significantly dropped too. See the attached screenshot, from that date onwards the graph almost flattens.<br />
The process has been in place since last September, and the increments have remained fairly consistent since then, until 3/4 Feb. I&#39;m presuming that was the date that I updated emoncms, because nothing else has changed locally....</p>
<p>Something has&nbsp;changed...</p>
<p><img alt="" src="../sites/default/files/kwh_0.png" style="width: 700px; height: 332px;" /></p>
<p>I <a href="https://github.com/emoncms/emoncms/issues/407#issuecomment-184052513">saw this issue flagged in github</a>, but then I&#39;m using Redis&nbsp;so doesn&#39;t apply to me.</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39431"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 15/02/2016 - 11:05.</div>
    <div class="content">
     <p>Paul - do you know when you last updated emoncms&nbsp;prior to the &quot;change&quot; ? Could it&nbsp;have been before the 26th&nbsp;Jan?&nbsp;</p>
<p>See <a href="12088.html">&quot;Power to kWh feed playing up&quot;</a>&nbsp;thread too. Despite there being no PV installed (ie no reason for a reverse flow) the log clearly shows the running total reducing slightly in places, having now read this thread I think &quot;rounding&quot; could cause the same effect, if the last value is rounded down and very little is consumed between the &quot;last&quot; and &quot;now&quot; reading then the rounded &quot;last&quot; could well&nbsp;be less than the unrounded&nbsp;&quot;now&quot; value.</p>
<p><a href="https://github.com/emoncms/emoncms/commit/8c5895a90098dc3dfc2d92e29df770a8f05f708e#diff-7a5fc29a048cdb28ba3de6032e343abdR9">2 days ago a comment was added to the feeds db schema</a>&nbsp;that suggests the stored feed precision is linked to this value, shouldn&#39;t&nbsp;the precision of this &quot;last value&quot; always be a double to ensure accurate input calculations? I would think we&nbsp;always want highest precision for input calcs regardless&nbsp;of storage size.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39433"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 15/02/2016 - 11:18.</div>
    <div class="content">
     <p>Paul, afraid not, this is my main system which I don&#39;t update that regularly, I&#39;ll have a look tonight and see if there is anyway I can get the local update history via git.</p>
<p>i seem to recall that the accumulator only uses MySQL for increments if Redis&nbsp;is not running. I&#39;m running Redis.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39435"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Mon, 15/02/2016 - 11:36.</div>
    <div class="content">
     <p>I have also experienced a problem with power to kWh feed suddenly not counting right.<br />
I have also a powdr to kwh/d on the same input.</p>
<p>When i pull a daily graph from both feeds the graph from the power to kWh shows a couple days with a lot less data counted compared to the graph from the power to kWh/d.</p>
<p>I have since done the database change AND enabled redis.</p>
<p>Seems to count fine now i think. Should check more thorougly now.  </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39436"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 15/02/2016 - 11:46.</div>
    <div class="content">
     <p>Paul - Possibly, but don&#39;t ask me how though!</p>
<p>The trouble is making sense of any&nbsp;info you find, not only will it matter when you updated but also from which branch, when the branches were last merged at the repo, when the changes were merged into the emoncms repo and the original commit date - it&#39;s a proper maze! But had you been religiously updating every day (eg a dev machine)&nbsp;then that may of ruled out a link with the other thread.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39439"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 15/02/2016 - 12:19.</div>
    <div class="content">
     <p>Reference the comment added to the feeds db schema,</p>
<p>&#39;value&#39; =&gt; array(&#39;type&#39; =&gt; &#39;float&#39;), <strong>// use double for more precision, database space will double</strong></p>
<p>Surely the use of float or double can only impact that db table by a max of 4bytes&nbsp;per feed defined, as it only has one &quot;last value&quot; per feed. Since the phpTimeseries engine is hardcoded as 9 bytes per datapoint this field setting cannot effect the file&nbsp;size&nbsp;(on the most space constrained sdcard&nbsp;installs), surely&nbsp;it can only double the storage size of pure SQL feeds.</p>
<p>IF this is the case I suggest the default is made &quot;double&quot; and if any mySQL&nbsp;users are concerned about storage space then reduce the size of the data feeds but not in the feed schema, if it&nbsp;is linked to the &quot;feeds&quot; schema then that link should be removed so that the more precise calcs are always used and then rounded for storage only.</p>
<p>Paul&nbsp;&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39443"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Mon, 15/02/2016 - 14:02.</div>
    <div class="content">
     <p>Hi pb66, you are correct on your last statement, will only affect mysql feeds.<br />
As a note, use of redis eliminate the problem because last value is cached in it with highest precision.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39446"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 15/02/2016 - 14:55.</div>
    <div class="content">
     <p>I may of found the issue that&#39;s&nbsp;caused my problem;</p>
<p>Redis&nbsp;is installed and running, but when I last updated (copying default.settings.php to settings.php) I neglected to re-enable redis&nbsp;in settings, so it was falling back to using MYSQL.</p>
<p>Should the default redis&nbsp;setting be changed to &#39;true&#39; in default.settings.php?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39447"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Mon, 15/02/2016 - 15:22.</div>
    <div class="content">
     <p>In default.settings.php ? I wouldn&#39;t because it&#39;s optional and not every body will install redis...</p>
<p>Just ensure your own settings.php is correct for your install options.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39450"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3296.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3296.jpg" alt="CapnBry&#039;s picture" title="CapnBry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3296.html" title="View user profile.">CapnBry</a> on Mon, 15/02/2016 - 22:42.</div>
    <div class="content">
     <p>Yup exactly. If you have redis, then enable it in settings.php. If not, then edit the modules/feed/feed_schema.php and switch the float to double and update your schema from the administration page. </p>
<p>I'm not sure why float is used in the database, I know all the feed data storage is float and that's fine, but each feed only has one "last value" in the database so the storage cost of expanding that to double precision is the same as storing /a single point in the feed file/. For systems where we're storing hundreds of thousands of points per feed, storing one more is nothing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39451"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 15/02/2016 - 23:02.</div>
    <div class="content">
     <p>Agree, but should the process be allowed to run if it&#39;s results are grossly&nbsp;inaccurate?</p>
<p>IMO there are two options;</p>
<p>1) Fix MYSQL so that the same results are obtained with, or without Redis.<br />
2) Disable the process if Redis&nbsp;is not installed and enabled.</p>
<p>Consider newbies&nbsp;to emoncms, where does it say that you have to enable Redis for the power to kwh process to work?</p>
<p>Also, as in my case, with the frequent updates to the settings file, it&#39;s easy to overlook the Redis&nbsp;enablement, which may not become apparent for some considerable time thereafter...</p>
<p>Thoughts please...</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39458"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3296.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3296.jpg" alt="CapnBry&#039;s picture" title="CapnBry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3296.html" title="View user profile.">CapnBry</a> on Tue, 16/02/2016 - 03:08.</div>
    <div class="content">
     <p>I don&#39;t think the process is supposed to be grossly inaccurate, or that redis is supposed to be required for this to work.&nbsp;The issue only surfaces at this level (1000 kwh) if your (power usage) * (update frequency in hours) is less than a certain amount. A less frequent update period (say every 5 minutes) or a higher power usage (say 500W) all properly increment the counter At 10,000 total kwh you&#39;ll again need an order of magnitute&nbsp;increase in the power usage to keep it ticking on.</p>
<p>Eventually at some point, everyone&#39;s kwh feeds will stop updating. This is true for even redis or double precision feed &quot;last values&quot;, however for those people it will be when their total accumulated kwh is in the billions (enough to consume 100 kwh a day for over 25,000&nbsp;years). I think it is really just an oversight because the feeds table is supposed to store tha latest value, which is inserted as an absolute number. With normal feeds eventually the input value will be high enough to tick it to the next rounding point or way beyond. However, in this case the code is trying to do its own tallying and given the size of the increment it just can&#39;t overcome rounding errors.</p>
<p>Having redis&nbsp;enabled handles it properly because its datatypes are wide enough. The MySQL feeds table just needs to have its own data type widened to match redis and the precision needed to perform the math that emoncms is trying to do on it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39459"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Tue, 16/02/2016 - 11:00.</div>
    <div class="content">
     <p>What is Redis? I see it mentioned a lot but have no idea what it does.</p>
<p>It is obviously an optional element but why? What are the pros and cons?</p>
<p>I&#39;m on a custom install V 9.2</p>
<p>{edit}</p>
<p>2 other things; How do I know if it is installed and is it a service that should be running?</p>
<p>Cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39462"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 16/02/2016 - 09:58.</div>
    <div class="content">
     <p><em>I don&#39;t think the process is supposed to be grossly inaccurate</em></p>
<p>Well no, but it is grossly inaccurate if Redis is <u>not</u> activated.<br />
Just to give you an idea of the magnitude of error, I&#39;ve examined the data recorded on the same &#39;power to kWh&#39; feed over 2 different &#39;10 day&#39; periods, the first with Redis enabled, the second with Redis disabled;</p>
<p>25th Jan - 4th Feb - Redis enabled - <strong>59.1kWh</strong><br />
5th - 15th&nbsp;Feb - Redis not enabled - <strong>8.6kWh</strong></p>
<p>Since re-enabling Redis, the increments are again looking realistic, and as expected.</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39465"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3296.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3296.jpg" alt="CapnBry&#039;s picture" title="CapnBry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3296.html" title="View user profile.">CapnBry</a> on Tue, 16/02/2016 - 13:36.</div>
    <div class="content">
     <p>@borpin123: redis is a caching server process, used to store data in RAM instead of a database. If you haven&#39;t actively installed it, you don&#39;t have it. I don&#39;t think it is part of any default distribution. It isn&#39;t something made for desktop users and usually is used on server systems as a caching mechanism. For a single user emoncms&nbsp;system, there is no reason to install it because its purpose it is to increase performance on high load systems.</p>
<p>@Paul Reed: I&#39;m noticing the same thing, even with feeds which don&#39;t have lot of power running through them. I have a monitored outlet that pulls 50 watts pretty consistently (especially because I haven&#39;t been home in 2 weeks).&nbsp;</p>
<p>Calculated 50W x 24h = 1.2kWh/day<br />
Feeds table float, Feb 8-13th: 0.9kWh/day<br />
Feeds table double, Feb 14-15th: 1.2kWh/day</p>
<p>There is a 30% loss due to the rounding down. I&#39;ve just started this feed a few months ago, but once it reaches the 100 kWh mark it would lose more or stop updating completely.</p>
<p>It really seems to be a no-brainer to just increase the size of the field to 8 bytes in the feeds table. The recent commit that says &quot;database space will double&quot; is technically accurate, the size of the _field_ will double, but the row is 54 bytes at a minimum. This would bump it up to 58 bytes or AT MOST a 7% space increase (it is actually much less because the feed names and node tags add another 15+&nbsp;bytes). Again, we&#39;re on a system that is storing THOUSANDS OF POINTS OF DATA per feed, however seems to be concerned about adding the storage equivalent of a single point to actually make the &quot;power to kwh&quot; feed actually work (redis or not). Doesn&#39;t literally every user use the power to kwh feed? One might argue that the storage space of the feed data for that feed is wasted space if the value isn&#39;t correct at all! :-D</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39468"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Tue, 16/02/2016 - 20:48.</div>
    <div class="content">
     <p>@capnbry seems though that redis was originally used to reduce the wear on sd cards. It is also part of the install instructions so I have it installed.</p>
<p>Can I simply enable redis in the settings then reboot?</p>
<p>{edit}</p>
<p>Actually, will enabling Redis solve anything if none of my feeds are sql.&nbsp; They are all phpfina.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39469"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 16/02/2016 - 21:13.</div>
    <div class="content">
     <p><em>Can I simply enable redis in the settings then reboot?</em></p>
<p>Yes</p>
<p><em>Actually, will enabling Redis solve anything if none of my feeds are sql.&nbsp; They are all phpfina.</em></p>
<p>Yes, if you are using a &#39;power to kWh&#39; process, no if you aren&#39;t. (see the posts above!)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39508"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 17/02/2016 - 21:47.</div>
    <div class="content">
     <p>O dear not sure why I did not pick up on this earlier! Thanks for all the debugging work</p>
<p>Given that the key here is the last value stored in the mysql feeds meta data table if redis is not present then I cant see an issue with setting the value field to be a double in the feeds table schema as you identified Paul:</p>
<p><a href="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_schema.php#L9" title="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_schema.php#L9">https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_schema....</a></p>
<p>Would someone running emoncms without redis be able to confirm if changing the datatype here to double and running the emoncms database update to apply the change solves the issue?</p>
<p>&#39;value&#39; =&gt; array(&#39;type&#39; =&gt; &#39;float&#39;), to &#39;value&#39; =&gt; array(&#39;type&#39; =&gt; &#39;double&#39;),</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39509"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 17/02/2016 - 22:16.</div>
    <div class="content">
     <p>I don&#39;t have a test-bed&nbsp;system at the moment, but have made the necessary changes to my main system (I need to rebuild the feed later anyway!), so I&#39;ll report back in a couple of days with the results.</p>
<p>Could do with a few more volunteers to try though!</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39511"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3296.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3296.jpg" alt="CapnBry&#039;s picture" title="CapnBry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3296.html" title="View user profile.">CapnBry</a> on Thu, 18/02/2016 - 00:12.</div>
    <div class="content">
     <p>@trystanlea I have been running the code that way since Sunday. @joyrider3774 had suggested that the schema file just be changed and I thought it was a pretty sweet piece of coding that the generator file could just be changed and emoncms could figure out what it needed to change. Brilliant! </p>
<p>Since updating the file to change it to a double type and updating the database, ALL my kwh/day fields are incrementing differently now. The good news is that they are more accurate! I have an outlet pulling a constant 6W,one that pulls 50W pretty consistently, and my whole house power usage. </p>
<p>6w x 24h, was reading <0.1kwh/d, now 0.14kwh/d<br />
50w x 24h, was 0.9kwh/d, now 1.2kwh/d<br />
House (peak 350w), was 0 kwh/d, now 6.9kwh/d</p>
<p>The difference in resolution of error is because of the accumulated kwh value. The house has a much larger total so its error is peaked at recording no data unless the watt usage was high enough. This point would be reached by the other outlets once their values got high enough as well. </p>
<p>I've seen no down sides to the double value in the feeds table and the values I took for granted were calculating out properly actually are accurate now given the fixed power usage while I am away from home! </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39567"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 20/02/2016 - 15:47.</div>
    <div class="content">
     <p>I've tried the fix since Wednesday, and with Redis deactivated I'm getting much more realistic readings.<br />
So yes, I would say that it does solve the problem.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39588"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 21/02/2016 - 13:27.</div>
    <div class="content">
     <p>I have to agree with CaptBry&nbsp;that the float v double decision is a &quot;no-brainer&quot;, there is no justifiable reason to not use AT LEAST a double, the size of the persisted data should not be directly linked to the calculation precision, we want the highest accuracy for calculations and the smallest size for storage.</p>
<p>float rounding should only affect persisted datapoints until the rounding ticks over to the next step i.e. from round down to round up for example. Using floats in the calcs&nbsp;could easily result in a low power reading read in frequently always being rounded to the point that a known power consumption could register as zero consumed energy forever, an&nbsp;essential element of an energy monitor is that it monitors energy,&nbsp;wouldn&#39;t you agree?</p>
<p>Also see <a href="12192.html">&quot;Rounding on large incrementing counter values&quot;</a>&nbsp;this issue also impact high meter readings as well as small unit/time&nbsp;increments too.</p>
<p>That thread links to <a href="11175.html">&quot;SQL rounds my inputs&quot;</a>&nbsp;which also puts forward a good case for using &quot;decimal&quot; over float or double, I do not like the way floats work in calculations and using decimal should not only eliminate any platform or OS influence due to the defined sizes (something that can affect floats) but it also&nbsp;makes a clear distinction between a value persisted for calculations from&nbsp;those persisted as dataponts, reducing confusion, adding cross-platform&nbsp;consistency and improving&nbsp;accuracy&nbsp;too, what&#39;s not to like, especially as there is no downside beyond a few bytes per feed, not per datapoint.</p>
<p>As for the settings, as OEM recommends the use of redis and all it&#39;s guides seem to recommend it, it would seem daft to me to then assume no one is using it and default to &quot;not installed&quot;, that seems contradictory to me. Given Paul was given no indication that redis was not being used and that&nbsp;Borpin123&nbsp;was not made aware he could benefit from it, it would seem a better choice to assume it is being used (as recommended) and those that cannot use it (windows &amp; shared servers) disable it, mainly because if it is there is should be used if it isn&#39;t there emoncms&nbsp;would raise an error to alert the user &quot;install it or disable it!&quot; rather than fail silently with it installed and not used.</p>
<p>Paul&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39618"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sun, 21/02/2016 - 21:15.</div>
    <div class="content">
     <p>The &#39;master&#39; branch has just been updated to change the database value to a &#39;double&#39; instead of &#39;float&#39;.</p>
<p>Don&#39;t forget to update your database following a git pull.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39647"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 22/02/2016 - 16:38.</div>
    <div class="content">
     <p>@pb66, I agree about setting the default to redis enabled and then providing a &quot;install it or disable it&quot; notification, shall I go ahead and do this?</p>
<p>I&#39;d be also happy to change the meta table value to decimal as you suggest Paul if it is the best way to go. What would you suggest for the decimal value? We would need sub Watt hour resolution probably down to around 0.000001 kWh. DECIMAL (20,9)? Should give plenty?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39676"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 23/02/2016 - 00:14.</div>
    <div class="content">
     <p>I do think it&#39;s the right thing to do, a double may have the scope for massive numbers but at a cost of precision, to me there is no point having&nbsp;the facility to store 100&#39;s of billions of kW&#39;s if we cannot see every kW increment, we could just as easily use a megawatt feed&nbsp;instead if the precision wasn&#39;t important.</p>
<p>What are the implications of not getting the decimal size right first time? if it can be changed as easy as the float to double I would say lets just try it and see, I would however,&nbsp;probably&nbsp;increase the overall size to allow 20 places to the left of the decimal point to accommodate&nbsp;an unsigned LongLong&nbsp;(Datacode&nbsp;Q) so&nbsp;perhaps (29,9). The 9 seems plenty as that will allow precision down to a&nbsp;microWatt&nbsp;even on a kW feed although there is a recommendation to use 12 decimal places in a few posts&nbsp;towards the end of the first page in the&nbsp;<a href="11009.html">EmonCMS 9.31 | 2016.02.13 released</a>..</p>
<p>will this mean that the accuracy will be greater on a non-redis&nbsp;setup? what defines the data type used by redis, is it governed by the feed meta or will it remain a double?</p>
<p>Would it be possible to consider &quot;double&quot; php datafeeds&nbsp;as mentioned <a href="12192.html#comment-39598">here</a>? perhaps allow other types too, I have various feeds tracking on/off status, this could be done in a single byte char rather than a 4byte&nbsp;float so the data feed could easily be a quarter of the size.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40204"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 09/03/2016 - 14:59.</div>
    <div class="content">
     <p>@Trystan - didn't want this thread to get buried without a final decision!<br />
Is this to be changed to decimal, or are we sticking with double?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40210"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 9.2 - power to kwh feed stopped incrementing</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 09/03/2016 - 17:13.</div>
    <div class="content">
     <p>Apologies for the delay on this, I have not forgotten. There&#39;s more I need to get a handle on here, reading through this page <a href="http://php.net/manual/en/language.types.float.php" title="http://php.net/manual/en/language.types.float.php">http://php.net/manual/en/language.types.float.php</a></p>
<p>Thinking aloud: Do we ideally need to avoid floating point math all together and have a bucket that accumulates up to 3600 Joules and then increases a watt hour count which is then stored as a long / unsigned long. I&#39;ll do some more reading on this.</p>
<p>If we move over to doing this on the emontx as standard: <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_continuous_kwhtotals/emonTxV3_4_continuous_kwhtotals.ino#L478" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_continuous_kwhtotals/emonTxV3_4_continuous_kwhtotals.ino#L478">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3...</a></p>
<p>then the requirement would be to store a watt hour value up to a maximum amount...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11774"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-MlCTj1KgRDp1hy4kbpK6M8WVzsvcMwCO8sRFUr_s9LU" value="form-MlCTj1KgRDp1hy4kbpK6M8WVzsvcMwCO8sRFUr_s9LU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
