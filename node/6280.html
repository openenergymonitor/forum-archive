<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6280 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:39:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>MediaTek Link-it One  and EmonLib | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">MediaTek Link-it One  and EmonLib</h3>
        <span class="submitted">Submitted by Guest on Wed, 10/12/2014 - 13:56</span>
        <div class="content"><p>Dear Open Monitor&nbsp;</p>
<p>We based out of India, we recently import your Link-it board &nbsp;( <a href="http://www.seeedstudio.com/blog/2014/10/31/let-s-make-linkit-one/">http://www.seeedstudio.com/blog/2014/10/31/let-s-make-linkit-one/)</a>&nbsp; , It is ARM core processor...</p>
<p>, We are in Sensor Analytics, and we use OpenEnergyMonitor (<a href="../index.html" title="http://openenergymonitor.org/emon/">http://openenergymonitor.org/emon/</a>) method to monitor the power. They have the API library , EmonLib.cpp and .h, It is working perfectly with Aurduino based boards, Now I use the same for the Link-it, The compilation is fine, after I upload the sketch...The processor is taking too much time to process the Arithmetic operation it seems,&nbsp;</p>
<p>&nbsp;In the Arduino this loop takes, 1 -2 secs, but in Link-It is taking more than 60 secs, Is there any thing wrong, or Math library issues, Or the way analogRead being used?,&nbsp;</p>
<p>We are kind of stuck here, could you help Us...</p>
<p>----------------------------------------------------------------------------------------------------------------------</p>
<p>float EnergyMonitor::calcIrms(int NUMBER_OF_SAMPLES)<br />
{<br />
&nbsp;Serial.println(&quot;Enter CalcIrms.. &quot;);&nbsp;<br />
&nbsp; int SUPPLYVOLTAGE = 3300; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//SPARK delete readVcc();<br />
&nbsp;&nbsp;<br />
&nbsp; for (int n = 0; n &lt; NUMBER_OF_SAMPLES; n++)<br />
&nbsp; {<br />
&nbsp; &nbsp;<br />
&nbsp; &nbsp; lastSampleI = sampleI;<br />
&nbsp; &nbsp; sampleI = analogRead(inPinI);<br />
&nbsp; // &nbsp;delayMicroseconds(250); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//SPARK this delay spaces samples to allow phase correction<br />
&nbsp; &nbsp; lastFilteredI = filteredI;<br />
&nbsp; &nbsp; filteredI = 0.996*(lastFilteredI+sampleI-lastSampleI);</p>
<p>&nbsp; &nbsp; // Root-mean-square method current<br />
&nbsp; &nbsp; // 1) square current values<br />
&nbsp; &nbsp; sqI = filteredI * filteredI;<br />
&nbsp; &nbsp; // 2) sum&nbsp;<br />
&nbsp; &nbsp; sumI += sqI;<br />
/*&nbsp;&nbsp; &nbsp;Serial.print(&quot;Sampling Loop.. CalcIrms. Loop Number . &quot;);&nbsp;<br />
&nbsp;&nbsp; &nbsp;Serial.print(n);<br />
&nbsp;&nbsp; &nbsp;Serial.print(&quot;....Value....&quot;);<br />
&nbsp;&nbsp; &nbsp;Serial.println(sumI); */<br />
&nbsp; }<br />
&nbsp;&nbsp;</p>
<p>&nbsp; float I_RATIO = ICAL *((SUPPLYVOLTAGE/1000.0) / 4096.0);<br />
&nbsp; Irms = I_RATIO * sqrt(sumI / NUMBER_OF_SAMPLES);&nbsp;</p>
<p>&nbsp; //Reset accumulators<br />
&nbsp; sumI = 0;<br />
//-------------------------------------------------------------------------------------- &nbsp; &nbsp; &nbsp;&nbsp;<br />
&nbsp;Serial.println(&quot;Exit CalcIrms.. &quot;);&nbsp;<br />
&nbsp; return Irms;<br />
}</p>
<p>&nbsp;</p>
<p>Thanks&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6288.html" class="topic-previous" title="Go to previous forum topic">‹ Bricked EmonTX?</a>
              <a href="6257.html" class="topic-next" title="Go to next forum topic">Troubleshooting RFM12Pi ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-25741"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MediaTek Link-it One  and EmonLib</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 10/12/2014 - 15:08.</div>
    <div class="content">
     <p>Unless somebody here has that board, I doubt we can help you.</p>
<p>You need to start from basics, not lift a library that's designed for one processor family and expect it to work with another. You need to use our algorithm, but not (necessarily) our code. Start with reading an analogue port and time that. On the Atmel328P, we get roughly 2500 sample pairs (voltage and current) per second, and that's with doing the maths for rms calculations using floating point arithmetic. Then you can add the part of the maths that's performed every sample, and time it. The add the 'end of loop' maths and repeat. Finally, add the calibration maths. I suspect that's where the delay will be because of the need to measure the internal reference voltage so as to work out the actual rail voltage (assuming you need to do that - it's really only needed for battery operation where the rail voltage can change markedly).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6280"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-gR4KLCn0mlZUAgsZIbNsiB5-dFwmUUyEtByyadrRyCw" value="form-gR4KLCn0mlZUAgsZIbNsiB5-dFwmUUyEtByyadrRyCw"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/6280 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:39:00 GMT -->
</html>
