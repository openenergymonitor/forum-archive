<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12216 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:10:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emontx with rfm12 v2 stuck at rf12_sendWait(2)  | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>
        <span class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Mon, 22/02/2016 - 10:12</span>
        <div class="content"><p>Hi all,</p>
<p>I started building my openEnergyMonitor&nbsp;some months ago, then I stopped to move to a new home and now I am restarting the project.<br />
I have updated all the code (jeelib, emonlib&nbsp;and emontxFirmware) to the last versions.</p>
<p>Now I am stuck with a problem and need some help to debug it, it seems that the&nbsp;rf12_sendWait(2) is blocking everything. (I tried with 0, 1, 2, or 3 but the result seems to be the same)<br />
To simplify the debugging and exclude some problems I am now using this sample sketch:<br />
<a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/Guide/g_TransmittingData/g_TransmittingData.ino" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/Guide/g_TransmittingData/g_TransmittingData.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2...</a><br />
If I comment out all the&nbsp;rf12_sleep() calls and the&nbsp;rf12_sendWait() the loop runs.</p>
<p>The rfm12&nbsp;seems to work as when the wait/sleep are commented out the pi is receiving the data (not every time the data is sent, only some times but I thnk&nbsp;this will be a problem to solve after).</p>
<p>The question now is: there are known bugs/problems/solutions to this issue? could it be solved in some way? if not, how could I try to investigate more on this?</p>
<p>Thanks</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12290.html" class="topic-previous" title="Go to previous forum topic">‹ emonGLCD case and backlight support</a>
              <a href="2960.html" class="topic-next" title="Go to next forum topic">Dodgy CT ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-39634"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 22/02/2016 - 12:01.</div>
    <div class="content">
     <p>It does sound like a problem with your RFM12B&nbsp;(is that what you have?) radio module. I cannot remember anyone reporting an issue like this, that was not traced to a faulty radio module or a bad connection to it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39698"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 23/02/2016 - 11:48.</div>
    <div class="content">
     <p>I have this:<br />
<a href="http://it.farnell.com/rf-solutions/alpha-trx433s/rf-module-transceiver-fsk-433mhz/dp/1718689" title="http://it.farnell.com/rf-solutions/alpha-trx433s/rf-module-transceiver-fsk-433mhz/dp/1718689">http://it.farnell.com/rf-solutions/alpha-trx433s/rf-module-transceiver-f...</a><br />
I read on the oem site when I bought all the components that these were the same as the RFM12B, the radio seems to be not entirely faulty as without the sleep stuffs the pi sometimes receives the data. I ordered some RFM69CW&nbsp;but they will arrive in 2-3 weeks so I would try to make it working with the RFM12.<br />
I have understood correctly that I can mix RFM12 and RFM69? for example have the RFM12 on the pi and RFM69 on the tx?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39702"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 23/02/2016 - 13:31.</div>
    <div class="content">
     <p>That module does indeed look like a RFM12B. Do you have an emonTx, or an emonTx&nbsp;Shield and Arduino, and if so, which Arduino?</p>
<p>Yes, the RFM12B and RFM69CW can work with each other.</p>
<p>This <em>&quot;the radio seems to be not entirely faulty as without the sleep stuffs the pi sometimes receives the data.&quot;</em> is what is confusing me. Usually, a fault with the radio module or the soldering will result in the sketch stopping forever at the point where it initialises the radio module.</p>
<p>rf12_sendWait(2); waits for the send to finish - this means blocking the processor and preventing it from continuing&nbsp;until the message has been sent. It is this that makes me think that the library cannot detect that the radio has actually finished sending the message, so it waits.</p>
<p>rf12_sleep(RF12_SLEEP); only sends the radio to sleep.</p>
<p>Taking those commands out will allow the loop to run, but may result in incomplete messages, which emonHub will reject (but log).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39720"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Wed, 24/02/2016 - 01:29.</div>
    <div class="content">
     <p>@Robert,  </p>
<p>> rf12_sendWait(2); waits for the send to finish</p>
<p>Does this routine wait for a "quiet" channel before starting the send?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39722"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 24/02/2016 - 02:02.</div>
    <div class="content">
     <p>I don&#39;t think that&#39;s its function. It&#39;s hard to see exactly how it operates, as it&nbsp;means chasing interrupts, but it doesn&#39;t wait <em><strong>to</strong></em> send, it waits <em><strong>for</strong></em> the send (which I presume is - it must be - interrupt-driven) to complete before returning. [In the RFM69CW, there&#39;s a buffer to look at and when it&#39;s empty, it&#39;s safe to release the processor to continue.]&nbsp;So&nbsp;it&#39;s quite possible that by taking this out, Valerio is sending incomplete messages but sometimes a complete one gets through and is decoded. It would be worth trying any sort of wait to see if the messages get through.&nbsp;</p>
<p>If you look at MartinR&#39;s PLL sketch, you&#39;ll see he sends 3 dummy bytes after the end of the message - I think that&#39;s to achieve the same end. My 3-phase sketch also has Martin&#39;s code - and the &#39;69 equivalent.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39739"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 24/02/2016 - 13:46.</div>
    <div class="content">
     <p>Hi,</p>
<p>I have ad emontx&nbsp;, not the arduino shield.</p>
<p>The fact that it&#39;s sometimes sending confuses me too...</p>
<p>I forgot to mention that I have added a delay(1000) in place of the&nbsp;rf12_sendWait(2), so the sketch is waiting 6 seconds between the loops (delay(1000) +&nbsp;Sleepy::loseSomeTime(5000)). Could this be the problem with the data sent only sometimes? If I comment out the delay(1000) and leave only the&nbsp;Sleepy::loseSomeTime(5000) the loop is continous (without waiting 5 seconds). To &quot;monitor&quot; the loops I added a led flash in the loop().</p>
<p>There&#39;s another way to wait for the message to be sent? could be the delay(1000) that is stopping the sending process?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39740"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 24/02/2016 - 14:39.</div>
    <div class="content">
     <p><em>&quot;I forgot to mention that I have added a delay(1000) in place of the&nbsp;rf12_sendWait(2), so the sketch is waiting 6 seconds between the loops (delay(1000) +&nbsp;Sleepy::loseSomeTime(5000)). Could this be the problem with the data sent only sometimes?&quot; .... &quot;could be the delay(1000) that is stopping the sending process? &quot;</em></p>
<p>I don&#39;t think so. I&#39;ve loaded that demonstration sketch (g_TransmittingData.ino) into an emonTx V3.4 with RFM12B radio and it works just fine for me with <em>delay(1000)</em> in place of <em>rf12_sendWait(2);</em> sending every 6 s or so without fail.</p>
<p>&quot;<em>If I comment out the delay(1000) and leave only the Sleepy::loseSomeTime(5000) the loop is continous (without waiting 5 seconds).&quot;</em></p>
<p>I too see that behaviour. It is not right, but JeeLabs say that if an interrupt occurs, <em>loseSomeTime</em> will return immediately, so I&#39;m guessing that the RFM12B is firing an interrupt inside that first second. I find mine works most times with&nbsp;<em>delay(4),</em>&nbsp;never (does not send at all) with <em>delay(3)</em> or less, and always works with <em>delay(5)</em>. That&#39;s with a 4-byte message. If I increase the message to 10 bytes, it sometimes fails with <em>delay(5).</em> This demonstrates what <em>rf12_sendWait( )</em> should do.</p>
<p>I think all this is pointing to a hardware problem with your radio module, or the connections. Have you looked very carefully at the soldering - with a magnifying lens - and checked every joint? Did you buy the emonTx assembled with its radio from the shop, or did you add the radio yourself?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39748"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 24/02/2016 - 16:47.</div>
    <div class="content">
     <p>I bought only the pcb and some other parts and added the radio myself, as I had a problem with a radio in the pi I soldered &nbsp;in a &quot;temporary&quot; way on this board to check the radio before soldering it permanently, I checked all the joins when I soldered them, I will do it again when I will be back home just to be sure.<br />
With the delay &gt; 5 you are always receiving the packets on the other side? so the fact that I am not always getting the packets to the raspberry is not caused by the delay.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39749"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 24/02/2016 - 17:28.</div>
    <div class="content">
     <p>I was using an emonGLCD&nbsp;running my own diagnostic sketch to check the transmissions, I did not notice any failures when the delay was long enough to be sure that the message had completed sending. &quot;<em>so the fact that I am not always getting the packets to the raspberry is not caused by the delay.&quot; </em>- Yes, I think that is correct.</p>
<p>Is there another transmitter nearby on the same frequency band that could be &#39;jamming&#39; your emonTx? - if you have the delay and not sendWait( ), then while it does not mean that your transmitter always works, it&nbsp;<em>could</em>&nbsp;be working and something else is corrupting the message.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39800"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Thu, 25/02/2016 - 15:06.</div>
    <div class="content">
     <p>Hi,</p>
<p>I rechecked everything and there were no shorts, but yesterday it started to deliver all the messages, so I added the sleep and then the send_wait and all is working except that after some time it gets stuck again and the tx stops working, if I power down and power it up again it starts again and stops after some time (less than an hour of 5-sec transmissions)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39818"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 25/02/2016 - 19:43.</div>
    <div class="content">
     <p>This has all the signs of a faulty connection. You handled and checked it, then it worked for a time. You left it for a time and it stopped working.&nbsp;I wonder whether there is a hairline break somewhere, that connected when you handled it and then broke the connection as something cooled or relaxed back into position?&nbsp;Can you check continuity on all the tracks that connect to the RFM12B module - and while you are doing that, bend and twist the PCB so as to stress the joints and the tracks.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39830"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Fri, 26/02/2016 - 01:14.</div>
    <div class="content">
     <p>If Robert&#39;s suggestion of very close track examination show nothing, there is a further possibility.&nbsp; If the catalog photo is accurate, the radio module is the &#39;epoxy blob&#39; type.&nbsp; The silicon die is flipped and pushed directly against pads on the PCB, then the epoxy holds this in place and (mostly) keeps out contaminants.</p>
<p>If the module has been stored for long periods in high humidity, the chip to pad interface can be compromised during soldering and give symptoms all the way from intermittent operation to completely dead.&nbsp; Once in a while you can actually demonstrate this by pressure on the blob restoring function for a time.</p>
<p>Later versions from Hope RF moved away from the &#39;blob&#39; and used conventional lead-frame packaging with welded bonding wires.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39987"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 01/03/2016 - 08:30.</div>
    <div class="content">
     <p>hi all, I&#39;m back here to update you with some good news as finally it&#39;s working, I don&#39;t know why but after checking everything another time and &quot;bending and twisting the PCB&quot; at the end it started working properly, so I uploaded the power+voltage sketch, calibrated everything and saturday morning I installed it on the main&nbsp;panel and from then it&#39;s working ok!&nbsp;</p>
<p>Thanks to all for the quick support!!!</p>
<p>I modified the sketch to use the&nbsp;Sleepy::loseSomeTime(5000) instead of the delay as it&#39;s consuming much less power (I think is has been commented on the github code for the 2.5 board that is powered directly by the ac adapter).</p>
<p>For now the board is hanging from the panel, I am now looking for a solution to put it somewhere less visible. if I cannot find sufficient space inside the panel do you think I can extend the CT wire or it&nbsp;will cause problems to the readings? I don&#39;t have solar or other, so I am evaluating the idea to try to design a &quot;small as possible&quot; single CT + voltage board, do you think it could be useful for someone else too?</p>
<p>If extending the CT cable is not a solution do you think I can extend the ac voltage cable?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40002"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 01/03/2016 - 14:05.</div>
    <div class="content">
     <p>First,&nbsp;<strong>don&#39;t trust it</strong>.&nbsp;What you describe exactly fits a bad connection somewhere.&nbsp;You have a badly soldered joint or the problem that&nbsp;emjay&nbsp;described.&nbsp;I can almost guarantee that it will come back, my guess would be in about 2 years&#39; time when a bit of&nbsp;oxidation&nbsp;sets in.</p>
<p>[I once spent&nbsp;<strong>two years</strong>&nbsp;trying to find a badly soldered joint in an audio amplifier - every time I as much as touched the screws holding the lid on, the problem went away. It was only after the joint had tarnished enough for the fault to remain while I got inside that I could find the problem, one touch with the iron and it was fixed.]</p>
<p>You can extend either or both cables. The CT is a current source (unless you have one with an internal burden) so voltage drop isn&#39;t a problem, but if you&#39;re extending it by more than a&nbsp;metre&nbsp;or two, you just need to get the screening right. I&#39;ve repeated what you must&nbsp;do many times here. Voltage drop with the ac adapter, if&nbsp;it&#39;s also the power supply,&nbsp;might&nbsp;be a problem if you use the thinnest of wires, otherwise that too will be fine.&nbsp;</p>
<p>I don&#39;t think many people would want a single channel board, most of those who aren&#39;t happy with the&nbsp;emonTx&nbsp;want many more channels than&nbsp;four.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40037"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 02/03/2016 - 11:52.</div>
    <div class="content">
     <p>Thanks for the explanation.</p>
<p>i will not trust it, it&#39;s just to get a visualization of the data, so if it one day fails and stop sending data the only problem will be that I will not know how much I&#39;m consuming, and the rf module is still &quot;temporarily soldered&quot; so there&#39;s the possibility that I will work on the board again to solder it. If it would work for 2 years then I will surely know if I really need it and then if I will need to replace/rework it or not.</p>
<p>I have a ct bought from the oem shop so it should be a current source, and the burden is on the board. I have a relatively small pcb-mountable&nbsp;ac ac adapter, from what I can find it&#39;s 9V 222mA, the one sold in the shop is 666mA, do you think it could be used for ac measurements? I think it could be a little underpowered to also power the board (and the tx v2.2 could not be powered from AC so it should need a board redesign) am I right?<br />
My problem is that I can&#39;t fit the standard pluggable&nbsp;AC adaptor in the panel, so I need to move the adaptor away and fit the rest in the panel or move everyhing&nbsp;away, extend the CT cable and plug it or use the pcb ac adapter and try to fit everything in the panel.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40040"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 02/03/2016 - 12:51.</div>
    <div class="content">
     <p>The 9 V adapter should be fine for the ac measurements, but if you have an emonTx V2, then that needs a separate 5 V d.c. supply to power it. As your adapter isn&#39;t the standard one, you&#39;ll need to recalculate (or adjust by trial and error) the voltage calibration coefficient so that your emonTx reads the correct voltage. All that is in Resources &gt; Building Blocks.</p>
<p>The problem with powering the emonTx from the ac adapter isn&#39;t so much power (200 mA is more than enough), but you can only have a half-wave rectifier to get the d.c., and the current pulse when the reservoir capacitor (which needs to be twice the size you&#39;d expect) charges causes a dip in the voltage wave that makes it inaccurate. Therefore you need an adapter that&#39;s capable of delivering a short, high-current pulse without too much dip, and you need to stretch the current pulse as much as possible to limit the amplitude.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40045"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 02/03/2016 - 14:57.</div>
    <div class="content">
     <p>the voltage calibration is not a big problem, I did it for the node that is now running.</p>
<p>could a large&nbsp;capacitor make it more stable? if I remember well the moment when the circuit draws more current is when the rf is sending, and it&#39;s not in the same moment as when it&#39;s reading the voltage (the next voltage reading is 5-10 seconds after, so the capacitor should be recharged in that time?).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40054"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx with rfm12 v2 stuck at rf12_sendWait(2) </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 02/03/2016 - 17:35.</div>
    <div class="content">
     <p>No, a large reservoir capacitor makes no real difference, the problem is the current&nbsp;<em>charging</em>&nbsp;that capacitor. Every cycle, you need to restore the charge that&#39;s drained away running the emonTx for the last 19 ms or so, and it&#39;s that 1 ms pulse of current that distorts the voltage wave while you&#39;re measuring the voltage. I&#39;ve published a simulation showing the dip, which a search should find for you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12216"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-z1sSUAQlYiAeHPgucYNxYPpP_qSro5HOSU0tA26NlQs" value="form-z1sSUAQlYiAeHPgucYNxYPpP_qSro5HOSU0tA26NlQs"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
