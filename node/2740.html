<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2740 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:21:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Temperature display | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Temperature display</h3>
        <span class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Sun, 25/08/2013 - 14:14</span>
        <div class="content"><p>Hi, given the temp on the glcd is about 2 degrees out due to the cpu&nbsp;rather than mod the location of the sensor I would like to drop it in the code.</p>
<p>I found this&nbsp;</p>
<p>emonglcd.temperature = (int) (inttemp * 100);</p>
<p>so i tried</p>
<p>emonglcd.temperature = (int) (inttemp * 100 - 2);</p>
<p>But it didnt seem to work, any ideas? im using the code kindly put together by others found in this link</p>
<p><a href="2639.html" title="http://openenergymonitor.org/emon/node/2639">http://openenergymonitor.org/emon/node/2639</a></p>
  <div class="forum-topic-navigation clear-block">
          <a href="2793.html" class="topic-previous" title="Go to previous forum topic">‹ Enomtx shield</a>
              <a href="2668.html" class="topic-next" title="Go to next forum topic">how to emongLCD and emonTX produce a beep? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-14588"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 25/08/2013 - 16:59.</div>
    <div class="content">
     <p>You need to read up on <a href="http://en.cppreference.com/w/cpp/language/operator_precedence"><strong>operator precedence</strong></a>. In the C language, there are well-understood rules for the order in which mathematical operations are performed. I&#39;ll bet any money it did work. Hint 1: what is the&nbsp; * 100 doing?&nbsp; Hint 2: emonglcd.temperature is an integer and can&#39;t be changed, so it can accept only whole number values. Hint 3: You subtracted 2 hundredths of a degree so you couldn&#39;t see the difference.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14623"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Tue, 27/08/2013 - 14:55.</div>
    <div class="content">
     <p>Thanks Robert,</p>
<p>My ever so helpful friend explains to me Operator precedence.</p>
<p>And in turn shows me how clever you guys are !</p>
<p>Okay, operator precedence. What you wrote is actually doing:</p>
<p>emonglcd.temperature = (int) ((inttemp * 100) - 2);</p>
<p>because multiplication has a higher precedence than subtraction, so it&#39;s always done first.</p>
<p>This means that you&#39;re only subtracting two hundredths of a degree, like the man said, so you&#39;re not getting the result you want.</p>
<p>You need to either do this:</p>
<p>emonglcd.temperature = (int) (inttemp * 100 - 200);</p>
<p>or</p>
<p>emoglcd.temperature = (int) ((inttemp - 2) * 100);</p>
<p>The second one does need the brackets, or it&#39;ll do 2*100 and subtract that from inttemp which is definitely not what you want!</p>
<p>For future reference, / and * have the same precedence, which is higher than + and - which are the same as each other. It&#39;s normal for multiplicative operators to have higher (or &#39;tighter&#39;) precedence than additive operators.</p>
<p>&nbsp;</p>
<p>Thanks again</p>
<p>&nbsp;</p>
<p>Dave</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14631"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 27/08/2013 - 17:58.</div>
    <div class="content">
     <p>That&#39;s all correct. I figured all you&#39;d need was a QDM.</p>
<p>My preference would be emoglcd.temperature = (int) ((inttemp - 2) * 100); because it&#39;s the most obvious form. Remember, if 6 months on you can&#39;t figure it out, it was too complicated to begin with.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14634"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Tue, 27/08/2013 - 19:09.</div>
    <div class="content">
     <p>Oddly it still reports 24.4 before and after the change?</p>
<p>before</p>
<p>emonglcd.temperature = (int) (inttemp * 100);</p>
<p>after</p>
<p>emonglcd.temperature = (int) ((inttemp - 2) * 100);</p>
<p>&nbsp;</p>
<p>Current script attached</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14636"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 27/08/2013 - 21:38.</div>
    <div class="content">
     <p>&quot;Reports&quot;? Where to? emonglcd.temperature is the temperature you&#39;re passing on to emoncms. It&#39;s still<em> displaying</em> inttemp. Methinks oops! you did the right correction, but in the wrong place. (And I haven&#39;t even looked at your code yet!). It needs to go in a few lines up immediately after the temperature is got from the sensors (and in the startup too, to get max and min correct).</p>
<p>I don&#39;t see what rawtemp is doing - if the temperature is out of range at startup it displays zero, else the last good value. That doesn&#39;t strike me as being sensible, but if you want it that way, OK.</p>
<p>And being pedantic, a marginally better form would be rawtemp = rawtemp - 2.0;&nbsp; (which is what you need after the getTemp)</p>
<p>The constant 2 is promoted to a double anyway by the compiler before it does the subtraction, writing 2.0 saves it the trouble.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14659"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Wed, 28/08/2013 - 21:17.</div>
    <div class="content">
     <p>Hi Robert, Its not my code its martin &amp; Pauls, im just using it as it covers 2 pv&#39;s &amp; grid.</p>
<p>I noted that it was updating cms not the lcd, I will see if I can figure it out if not I will be back!</p>
<p>&nbsp;</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14663"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 28/08/2013 - 22:42.</div>
    <div class="content">
     <p>If you look at what I wrote earlier alongside the sketch, it ought to make sense!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14824"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Tue, 03/09/2013 - 18:10.</div>
    <div class="content">
     <p>No I failed :-(</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14826"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 03/09/2013 - 18:51.</div>
    <div class="content">
     <p>The value is read from the sensor and it actually exists in 3 versions with 3 different names. What you need to do is track each version and see where it is used, and <strong>why</strong>. One is the raw version, one is used in the LCD display, and one is the number multiplied by 100 and sent on over the r.f. link to the base and onwards to emoncms. Therefore, you need to get at the temperature and apply your correction as soon as it is got from the sensor. Look again at my post on Tue, 27/08/2013 - 22:38. I actually spelled it out there.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14947"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Sat, 07/09/2013 - 13:30.</div>
    <div class="content">
     <p>Ok so I changed the part that sends it to the pi back to&nbsp;</p>
<p>emonglcd.temperature = (int) (inttemp * 100);</p>
<p>and I changed the line</p>
<p>&nbsp;</p>
<p>inttemp = (sensors.getTempCByIndex(0)) ;</p>
<p>to</p>
<p>inttemp = (sensors.getTempCByIndex(0)) - 2;</p>
<p>It looks ok do I get a biscuit :-)</p>
<p>&nbsp;</p>
<p>edit: &nbsp;maybe not, on startup its fine but after about 30 seconds the temp jumps up two degrees.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14948"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Sat, 07/09/2013 - 13:43.</div>
    <div class="content">
     <p>looks like i needed to also modify</p>
<p>&nbsp;</p>
<p>double rawtemp = (sensors.getTempCByIndex(0)) - 2;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14954"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Temperature display</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 07/09/2013 - 19:55.</div>
    <div class="content">
     <p>I did warn you earlier - &quot;It needs to go in a few lines up immediately after the temperature is got from the sensors (and in the startup too, to get max and min correct).&quot;&nbsp; Only one problem, it sounds as if you did it ONLY in the startup. It looks like you&#39;ve found both places now.</p>
<p>What are you using to edit the sketch? Over the years, I&#39;ve found that a really good editor that you know well and has good search (and search-and-replace) is indispensable. Needless to say, I don&#39;t use the editor in the Arduino IDE. I suspect you looked at the code and didn&#39;t do a search for the different mutations of temperature as the sketch progresses. I think that would have helped you here.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2740"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-tmWaj16T3lmnbxtRd7KSrvuRe-dato64m0OTS8aV6Qw" value="form-tmWaj16T3lmnbxtRd7KSrvuRe-dato64m0OTS8aV6Qw"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
