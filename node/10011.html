<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10011 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:33:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonTx_continuous_watthours - Add Voltage reading | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonTx_continuous_watthours - Add Voltage reading</h3>
        <span class="submitted">Submitted by <a href="../user/1039.html" title="View user profile.">mattwire</a> on Fri, 16/01/2015 - 23:22</span>
        <div class="content"><p>I&#39;ve added a voltage (Vrms) reading to the emonTx_continuous_watthours sketch for the emonTxV2.</p>
<p>See:&nbsp;<a href="https://github.com/mattwire/emonTxFirmware/blob/57c8ce7bc6c0812f32235631d141d9a33f138e6b/emonTxV2/emonTx_continuous_watthours/emonTx_continuous_watthours.ino">https://github.com/mattwire/emonTxFirmware/blob/57c8ce7bc6c0812f32235631d141d9a33f138e6b/emonTxV2/emonTx_continuous_watthours/emonTx_continuous_watthours.ino</a></p>
<p>&nbsp;</p>
<p>What I&#39;m not sure of is the voltage calibration starting at line 115. &nbsp;It was originally set to 276.9 but that gives wildly inaccurate voltage readings. &nbsp;Using the value for the mascot adapter (<a href="https://learn.openenergymonitor.org/?redirect=calibration">http://openenergymonitor.org/emon/buildingblocks/calibration</a>) of 234.26 the voltage seems spot on. &nbsp;All values on the calibration page are around this value so can anyone explain the 276.9 and will my changes affect the accuracy of the current readings?</p>
<p>&nbsp;</p>
<p>Cheers,</p>
<p>Matthew</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10251.html" class="topic-previous" title="Go to previous forum topic">‹ emonPi Update Form </a>
              <a href="10167.html" class="topic-next" title="Go to next forum topic">RFM12Pi vs RFM69Pi differences and implications ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26805"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 16/01/2015 - 23:44.</div>
    <div class="content">
     <p>The voltage calibration (in most sketches, but not that one) affects only the voltage reading.<br />
The current calibration (in most sketches, but not that one) affects only the current reading.<br />
Again, in most sketches but not that one, both affect the power calculation.</p>
<p>In the 'continuous' sketch, because voltage and current are not reported separately, only a combined power calibration is needed. It is however, derived from the separate voltage and current calibration constants.</p>
<p>The value of the voltage calibration constant in that sketch is most likely a carry-over from previous adapters and/or voltage divider component values (that's without checking back). The whole purpose of calibration is to remove the uncertainty introduced by component tolerances, therefore it should be the norm if you want accurate measurements. There's more about that, and the derivation of the calibration constants, elsewhere in Building Blocks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26813"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1039.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/1039.html" title="View user profile.">mattwire</a> on Sat, 17/01/2015 - 13:45.</div>
    <div class="content">
     <p>Thanks Robert. I&#39;m aware of the purpose of calibration hence my link and question since the value in this sketch is so wildly different to what I expected.</p>
<p>Upon further investigation I think the value (276.9) was selected based on assumptions for emonTxV3 and is therefore wrong:</p>
<p>From <a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory:%c2%a0%22On" title="http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor-installation-and-calibration-theory: &quot;On">http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor...</a> the EmonTx PCB, the voltage is further reduced by the potential divider formed by R13 and R14, the ratio being 1/11 in the emonTx V2 but 1/13 in the emonTx V3. This voltage is then measured by the analog input of the processor relative to the processor supply voltage (in this case 3.3 V), which is used as the reference, and scaled so that the reference voltage would give the maximum count of 210&nbsp;( = 1024).&quot;</p>
<p>From the comments in the sketch muliplying 21.3 x 11 instead of 13 gives 234.3 which is roughly&nbsp;what I expected and would give a fairly accurate reading &quot;out-of-the-box&quot;.</p>
<p>Matthew</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26826"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1039.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/1039.html" title="View user profile.">mattwire</a> on Sat, 17/01/2015 - 20:05.</div>
    <div class="content">
     <p>I have now also added temperature reading and changed the Wh totals so they give import/export totals allowing me to calculate house consumption, total export, total import, total generated etc.</p>
<p>See&nbsp;<a href="https://github.com/mattwire/emonTxFirmware/tree/master/emonTxV2/emonTx_continuous_importexport_watthours_V_temp">https://github.com/mattwire/emonTxFirmware/tree/master/emonTxV2/emonTx_continuous_importexport_watthours_V_temp</a></p>
<p>Thanks to&nbsp;Robin Emley&#39;s&nbsp;mk2pvrouter (Mk2_RFdatalog_4) for the temperature/Vrms code.</p>
<p>Thanks to Dave Dixon for the import/export totals&nbsp;(<a href="5309.html" title="http://openenergymonitor.org/emon/node/5309">http://openenergymonitor.org/emon/node/5309</a>)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 20/01/2015 - 21:55.</div>
    <div class="content">
     <p>The way that temperature is being measured in this code will unfortunately cause some data from the ADC to be lost (for roughly 10 ms on each occasion).&nbsp; This happens because the OneWire protocol for the Dallas temperature sensor is much slower that the ADC&#39;s sampling scheme.&nbsp; This loss of data may not be much in percentage terms, but is not ideal.</p>
<p>In the Mk2_RFdatalog_4 sketch on my website, this problem has been overcome by a complete restructuring of the code.&nbsp; In that sketch, all of the logic for calculating and controlling the flow of energy is contained within the ISR, not just the ADC&#39;s operation.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28276"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7764.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hercules71035&#039;s picture" title="hercules71035&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/7764.html" title="View user profile.">hercules71035</a> on Sat, 28/02/2015 - 14:41.</div>
    <div class="content">
     <p>Hi, I have a simple question.</p>
<p>What are&nbsp;the differences between&nbsp;emonTxV3_continuous_kwhtotals_noeeprom&nbsp;and&nbsp;emonTxV3_RFM12B_DiscreteSampling.</p>
<p>​Obviously, I know the different output. Which is the best? The most accurate?</p>
<p>Now, I&#39;m using the last one and then I compute the Kwh in emoncms&#39; feed.</p>
<p>Thanks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28278"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 28/02/2015 - 16:30.</div>
    <div class="content">
     <p>Discrete sampling is the practice of only sampling for a fraction of each period and assuming the rest of the period is the same, it&#39;s done to reduce power requirements for battery use. So any continuous sampling sketch should be an improvement in accuracy.</p>
<p>As for the ...kwhtotals part, it can also&nbsp;be more accurate to do the calcs&nbsp;&quot;continuously&quot;&nbsp;on board the emonTx, There can also be a marked improvement in accuracy if&nbsp;the rfm network is subject to interference or poor signal etc that can result in dropped packets before they can be included in the emoncms&nbsp;derived totaling. However the on-board totals get reset at each restart of the device so it requires a whaccumulator &quot;ratchet mechanism&quot; at emoncms. It could be prone to a greater inaccuracy if the emonTx gets&nbsp;reset ( ie power supply issues&nbsp;etc) whilst holding totals that haven&#39;t reached emoncms yet ie one big loss rather than a occasional inaccuracy.</p>
<p>So &quot;kwhtotals&quot; can be better depending on your set up, but&nbsp;&nbsp;&quot;continuous&quot; is definitely better than&nbsp;&nbsp;&quot;discrete&quot; if you are running on a power supply (not batts).</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28279"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7764.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hercules71035&#039;s picture" title="hercules71035&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/7764.html" title="View user profile.">hercules71035</a> on Sat, 28/02/2015 - 16:38.</div>
    <div class="content">
     <p>Thaks Paul,</p>
<p>So I&#39;m&nbsp;going to modify the firmware in order to use&nbsp;emonTx&nbsp;via serial (there are a lots of info on the serial). How can&nbsp;I add the voltage? In the standard there is&nbsp;no voltage. Moreover, I&#39;ll use&nbsp;emonTx&nbsp;with AC/AC adapter.</p>
<p>Sorry, I&#39;ve forgot to say that I use emonTx&nbsp;V3</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28282"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sat, 28/02/2015 - 18:10.</div>
    <div class="content">
     <p>My recently posted <a href="10171.html">Mk2 Router code for use with the emonTx V3.2</a> should do exactly what you want.&nbsp; It monitors &quot;real power&quot; continuously on all four CT channels and also measures the RMS voltage and temperature.&nbsp; Data is routinely transmitted by RF and is also presented to the serial interface.&nbsp; Equivalent code for the emonTx V3.4 is <a href="10203.html">here</a>.</p>
<p>If you have PV on-site, this code can also identify and divert any surplus power for some useful purpose.&nbsp; But it can function just as well as a monitor only.</p>
<p>As posted, cumulated energy is calculated for just one of the channels, this being CT3 which is intended for&nbsp; &quot;diverted power&quot;.&nbsp; This logic could be easily extended to cover the other three channels if &quot;kwhtotals&quot; were required for all of them.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28284"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 28/02/2015 - 18:44.</div>
    <div class="content">
     <blockquote><p><em>&quot;As posted, cumulated energy is calculated for just one of the channels, this being CT3 which is intended for&nbsp; &quot;diverted power&quot;.&nbsp; This logic could be easily extended to cover the other three channels if &quot;kwhtotals&quot; were required for all of them.&quot;</em></p>
</blockquote>
<p>Hi Robin, just curious, I don&#39;t currently have a need but for future reference. Is there enough processor time and memory to do all 4? and how easy would it be to also implement &quot;directional&nbsp;subtotals&quot; ie total exported and total imported rather than (or as well as) a nett total?</p>
<p>My arduino coding isn&#39;t strong so I would need to study the code for some time to get to grips with it, but I would also assume there isn&#39;t likely to be an issue using longs rather than ints&nbsp;for the totals, correct?&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28297"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sat, 28/02/2015 - 23:30.</div>
    <div class="content">
     <p>Hi Paul, there should be no problem with memory.&nbsp; My sketches generally display how much free RAM is available; less that half of the RAM is being used for this sketch.</p>
<p>Floating-point maths is relatively slow, but most of the Mk2&#39;s code uses integers and longs.&nbsp; If you carefully replicate the logic which accumulates energy for CT3, I sure you won&#39;t have any difficulty to get similar results for the other channels.&nbsp; I think the accumulaors are all &#39;long&#39;, with the transmitted datafields being &#39;int&#39;.</p>
<p>Take it carefully, one stage at a time, and keep checking and saving.&nbsp; While developing any new code, I keep frequent copies in an adjacent folder called archive.&nbsp; The various copies are simply dev_1, dev_2 etc.&nbsp; I also keep a log file into which results and ramblings can be copied.&nbsp; This record can be really useful for later reference, and is much easier than writing notes on paper.</p>
<p>I&#39;m not sure about &quot;directional subtotals&quot;.&nbsp; The whole point about the Mk2&#39;s design is that the flow of energy changes direction so quickly that it is ignored by the meter.&nbsp; To record such minor flows would not seem useful if they are not seen by the meter.&nbsp; But if this requirement can be adequately specified, I see no reason why it could not be implemented by additional&nbsp;Mk2&#39;s logic.&nbsp;</p>
<p>Within each datalog period, the minimum number of sample sets per mains cycle is recorded.&nbsp; This number provides a good indication that the processor is not being overloaded.&nbsp; With my latest code, as released for the emonTx V3.2 and V3.4, measurements of temperature do not affect the underlying sampling process, as confirmed by this number.&nbsp; If temperature measurements were to be performed in older versions, the sampling process would be disrupted but there is no easy way to detect this (albeit small) loss of data.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28305"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 01/03/2015 - 03:08.</div>
    <div class="content">
     <blockquote><p><em>&quot;The whole point about the Mk2&#39;s design is that&nbsp;the flow of energy changes direction so quickly that it is ignored by the meter.&nbsp; To record such minor flows would not seem useful if they are not seen by the meter. &nbsp;&quot;</em></p>
</blockquote>
<p>Indeed, it&#39;s a bit of a no mans land as the net total&#39;s usefulness&nbsp;can also be questioned when the main reason for monitoring (for most users) is to know how much energy they are buying and how much&nbsp;PV is exporting (or escaping) and since we don&#39;t have net metering in the uk, import and export ideally need to be sub-totaled but&nbsp;without the sweetzone modulation included..&nbsp;</p>
<p>Is there a way that the diverter code can indicate when it&#39;s operating in the &quot;sweet zone&quot; ? to prevent the movement being added to the running total. I recall reading about a related solution using the meters led to confirm operation in the &quot;sweet zone&quot;.</p>
<p>My current system does count the to&#39;ing and fro&#39;ing&nbsp;but since most of the year there is no actual export, the recorded export can actually be used to correct the import value (assumming any to&#39;ing has corresponding fro&#39;ing)&nbsp;however that goes out the window at the height of summer if I fail to use all PV.</p>
<p>Would having&nbsp;a virtual 1w &quot;sweetzone&quot; in the code be a solution? I understand a fixed point may not align with the meters &quot;sweetzone&quot; but is it feasible to recognize&nbsp;when modulating rapidly&nbsp;within a small range and only count values straying outside of a 1w zone centered on rolling short&nbsp;term mean average&nbsp;instead?&nbsp;</p>
<p>As I said just curiosity at this point, I&#39;m not suggesting I would attempt to tackle something like this myself,</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28306"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 01/03/2015 - 08:06.</div>
    <div class="content">
     <p><em>Would having&nbsp;a virtual 1w &quot;sweetzone&quot; in the code be a solution? I understand a fixed point may not align with the meters &quot;sweetzone&quot; but is it feasible to recognize&nbsp;when modulating rapidly&nbsp;within a small range and only count values straying outside of a 1w zone centered on rolling short&nbsp;term mean average&nbsp;instead?&nbsp;</em></p>
<p>Yes, this kind of arrangement should be entirely possible.&nbsp; Not all meters have the same penalty-free range, so that would complicate matters.&nbsp; Getting the spec nailed down is likely to be the difficult part.&nbsp; The coding itself should be relatively straightforward.</p>
<p>Unless a positive export rate has been deliberately included, the Mk2&#39;s design will not allow any energy to &quot;escape&quot;.&nbsp; Unless the amount of surplus power exceeds the ability of the loads to consume it, the Mk2&#39;s processor will always believe that a correct balance is being maintained.&nbsp; If a small amount of &quot;escaped&quot;energy is recorded by the meter, that will be because the two systems are measuring the flow of energy differently.&nbsp; This effect can be minimised by ensuring that the Router has been properly set up, in particular so that the current and voltage sensors are using most of the available range of the ADC.&nbsp; When operating in AF mode, the energy thresholds and calibration become important too.</p>
<p>In some parts of the world, the rate for exported power is tiered.&nbsp; For the first X hours per month, it is relatively beneficial to export, but then the rate drops.&nbsp; Without a real-time clock on board, it does not seem practical to include this level of complexity in the Router itself.&nbsp; Maybe it could be implemented in some associated controller and then communicated to the Router via one or more of the IO pins.&nbsp; Polling IO pins is a very simple and effective way of communicating with the processor, so a &quot;diversion enabled/disabled&quot; flag protocol could be easy implemented.</p>
<p>Once the tank is up to temperature and surplus power is being exported, the average power at the supply point will go from approximately zero to negative.&nbsp; EmonCMS should be able to spot this and increment its export register rather than decrementing its import register.&nbsp; Having an extra field in the RF payload so that the Router can convey something useful to emonCMS may be a useful addition.</p>
<p>These days, I tend to be driven by what my potential customers are asking for.&nbsp; Since starting my own business, all new developments of mine have been customer-led. But if there are spin-offs, I&#39;m generally happy to post them here on the forum for others to use, and to peer-review.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28316"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTx_continuous_watthours - Add Voltage reading</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 01/03/2015 - 17:03.</div>
    <div class="content">
     <p>I agree a &quot;1w&quot; sweetzone probably wouldn&#39;t be the best way to go, using the existing &nbsp;sweetzone settings used by the diverter would make far more sense.</p>
<p>My use of the term &quot;escaping&quot; was referring to energy&nbsp;escaping the grasp of the user and exporting back to grid unused rather than suggesting a &quot;leakage&quot; due to error or accuracy. There is no disputing the accuracy and it&#39;s only because of that accuracy that it&nbsp;would be worth considering such a level of fine-tuning through further development .</p>
<p>Indeed there are tiered export rates in parts of the globe that may reduce the &quot;out of the box&quot; usefulness of the added accuracy, but those same users and many many more besides are already currently unable to get an&nbsp;acceptably accurate export total, Plus&nbsp;that same philosophy would also apply&nbsp;to the usefulness of any form of watt hour totaling for&nbsp;many users, if they&nbsp;buy their energy at a multi-tariff&nbsp;rates, including UK&#39;s own off-peak&nbsp;economy7.</p>
<p>These tariffed and tiered calculations could be done quite accurately outside the sketch IF there was an accurate import/export value to work from, or indeed as the control side of OEM gets a footing the sketches totals could be reset as each new tier/tariff commences. but my own opinion is that these calculations involving time, money and tiers etc should be done in emoncms as tariff rates and T&amp;Cs can change quite frequently.&nbsp;</p>
<p>The use of the flag is interesting and would&nbsp;work well for on-board inclusion/exclusion logic for totaling, the reason I say &quot;on-board&quot; is the emonTx to emonCMS reporting interval would introduce heavy inaccuracies if the flag&#39;s state is only updated once per reporting interval.&nbsp;</p>
<p>Surely he best place to reduce the additional import and export reported due to modulating in the sweetzone has to be at source, the diversion codes &quot;flag&quot; would just indicate if the movement should be included in an import/export total. Almost all the inaccuracy could be eliminated, if the Router is using for example 90% of the sweetzone to avoid straying into &quot;chargeable territory&quot; then 90% of the sub-totaling inaccuracy would be eliminated.</p>
<p>Maybe even that can be improved if the router is working to a defined safe area. ie if your best guess or the meters tech spec says the sweetzone is X and you run the router at 90% of X maybe it&#39;s possible to use X in the sub-totaling calcs.</p>
<p>As a side note, the way I can currently &quot;see&quot; the unmetered amount accumulating is an excellent indicator of how well (hard) the diverter is working as opposed to how effective it is. The amount diverted and the absence of any export tells me the diverter is effective, but on a high PV day the inaccuracy is far less than a cloudy day, effectively because the diverter can just switch to divert and remain there. Whilst on the cloudy day it has to work harder and the amount that is reported as export but not metered is actually a direct indication of how much energy was saved by modulating the diverter rather than just &quot;diverting&quot;.</p>
<p>None of this is considered or intended to be criticism, I am already totally sold on the diversion concept, however the act of diverting introduces&nbsp;an inaccuracy (which I consider&nbsp;to be a small price to pay) that wouldn&#39;t previously of been noticeable if present. It would be a valuable addition to the diverters code to be able to remove as much of that as it can, especially as it is the most efficient method.&nbsp;In fact it has occurred to me whilst writing this that the diverter effectively imposes it&#39;s own&nbsp;sweetzone&nbsp;within the meters&nbsp;sweetzone&nbsp;and since that defines the boundaries of the diverting my previous 90% example isn&#39;t totally true as the diverter is capable of removing 100% of the inaccuracy derived from utilizing 90%&nbsp;of the&nbsp;sweetzone&nbsp;for&nbsp;diversion. wouldn&#39;t it??</p>
<p>Nor was it intended to be&nbsp;a feature request, more as an interesting discussion about future development in the area of energy monitoring, Although&nbsp;<em>&quot;These days, I tend to be driven by what my potential customers are asking for. &quot;</em>&nbsp;I would expect&nbsp;accurate monitoring&nbsp;and reporting of separate export and import in non-net-metering countries to be high on the users wish list, especially here on an energy monitoring forum. Advances in this area would also negate the need for any explanation of &quot;why is&nbsp;my system&nbsp;exporting?&quot; when it&#39;s not, when&nbsp;the subtotaling&nbsp;is&nbsp;done off-board.</p>
<p>Either way it&#39;s fantastic kit, :-)</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10011"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-L8u9QbVa6bVAfkDcOVA0tpSVscJvanbnHieEcCMrK8U" value="form-L8u9QbVa6bVAfkDcOVA0tpSVscJvanbnHieEcCMrK8U"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
