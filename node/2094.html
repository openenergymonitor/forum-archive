<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2094 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:37:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>how do i intergrate temp + current | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">how do i intergrate temp + current</h3>
        <span class="submitted">Submitted by Guest on Mon, 04/03/2013 - 23:52</span>
        <div class="content"><p>on my TX station i want to use the current sensors, however, also use the tempature sensors.&nbsp;</p>
<p>i figured out today how to use the temp sensors, using the device ID and to turn the reading from C to F. &nbsp;</p>
<p>going through the sketches (mind you, i&#39;m&nbsp;slowly trying to figure out programming the AT mega, i know little, but understand programing somewhat.) i dont see one that intergrates all three (phase, temp, and current sensors) &nbsp;</p>
<p>&nbsp;</p>
<p>doing some quick reading, most of the current sensors are based on 220 single phase, am i right? &nbsp;as i want to measure 480 three phase, but i am going to monitor 4 lines that are split off of two legs. &nbsp;&nbsp;</p>
<p>the only things i have used were the sketches from the github. &nbsp;</p>
<p>also, with the low power nodes, do i need to find the Device ID for those as well? &nbsp;i&#39;m&nbsp;also trying to figure out where in the programing to turn the calculations from C to F. &nbsp;</p>
<p>&nbsp;</p>
<p>quick run down of what i am doing, i have 2 TX stations and 2 remote low power nodes. &nbsp;4 current, 2 temp sensors, to have 4 current and 4 temp. &nbsp; &nbsp;i&#39;m&nbsp;attempting to monitor tempature, 2 generation lines and 2 ups&#39;ed lines in my datacenter. &nbsp;(one of each in each server cab). &nbsp;i have them all together, and have the PI running as well as pulling data from the remote Nodes. &nbsp;</p>
<p>guess i should also say hi :) &nbsp;my first post!&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2127.html" class="topic-previous" title="Go to previous forum topic">‹ System Configuration Emontx and Emonglcd only</a>
              <a href="2084.html" class="topic-next" title="Go to next forum topic">Simple test rig for RFM12Bs ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-10311"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: how do i intergrate temp + current</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 05/03/2013 - 23:48.</div>
    <div class="content">
     <p>Hello Mark, welcome.</p>
<p>You believe in jumping in at the deep end, don&#39;t you?</p>
<p>I see you&#39;re in USA. I assume your 3-phase supply is 480 V between lines, with earthed neutral? If it&#39;s what I would call a 6-phase supply (i.e. the supply transformer windings are centre-tapped and the centre taps are earthed), then life gets a lot more complicated). You have two choices. If you want accuracy, you need to measure the three phase voltages and the 3 line currents. (or maybe 6 voltages and 6 currents!) To do that you need 6 (12) analogue inputs. If you don&#39;t need great accuracy and the three phase voltages are well balanced, you can cheat and measure just one, delay that voltage in software and use it delayed by 120&deg; for the second phase and 240&deg; for the third. You of course need the right combination of transformer (voltage adapter) and resistors to correctly scale the voltage.</p>
<p>Once you&#39;ve got your head around that problem ( ! ), it&#39;s a relatively simple matter to just add together the bits of code that do the various functions, and copying bits from the various sketches is the best way to start (but of course get each bit working individually first). Basically, there&#39;s temperature and 1 power here: <a class="js-directory-link js-slide-to css-truncate-target" href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_temperature_examples" id="06744d213ee8d573d8a563cc33a3541f-389e3506241ddd77e950de9061ff23b853b96efe" title="emonTx_temperature_examples">emonTx_temperature_examples</a> and 3 power/current readings here:&nbsp;<span class="js-directory-link js-slide-to css-truncate-target"><a class="js-directory-link js-slide-to css-truncate-target" href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_CT123_Voltage" id="6264041740ed3f44517a9c8475db3048-19222c65059e9d71735ed0efc5d6b766ffa8f315" title="emonTx_CT123_Voltage">emonTx_CT123_Voltage</a>&nbsp; </span>and you need to pull the additional 2 currents/powers into the temperature sketch.</p>
<p>You turn &deg;C into &deg;F wherever you like, there&#39;s no right and wrong! I would normally do it immediately after you have read the value, simply to reduce the chance of inadvertently using the wrong value when you come to change the sketch in a year or two&#39;s time.</p>
<p>You&#39;ll find quite a lot of data in the Building Blocks section of the site, which should help you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10313"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gangaskan&#039;s picture" title="gangaskan&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: how do i intergrate temp + current</h3>

    <div class="submitted">Submitted by gangaskan (not verified) on Wed, 06/03/2013 - 02:07.</div>
    <div class="content">
     <p>haha, yes that i do! &nbsp; it is for a BS senior project, &nbsp;i was given a task, and that task was to do telemetry or something to that effect with the Raspi&nbsp;my instructor said my project was ok! &nbsp;i was initially wanting to just do temperature. however, once i saw that i can do current i thought of the possibilities. &nbsp;</p>
<p>i will look at those sketches again and see what i can &nbsp;come up with in terms of that. &nbsp;</p>
<p>in regards to the three phase power, i&#39;m not sure if its earth neutral, my guess is yes if its a US Standard, being a Govt Office. &nbsp;&nbsp;</p>
<p>i really am not too interested in measuring 3 phase, just really want to see the current in wattage (or amps if possible either or) &nbsp; on 4 breakers, they &nbsp;are, however, on three phase power. &nbsp;does that kind of make sense? &nbsp;unless i&#39;m confused robert!&nbsp;</p>
<p>basing on your post &nbsp;i may need min 6 or up to 12 inputs, i&#39;m going to assume that you can not calculate wattage on each leg without calculating each phase? &nbsp;</p>
<p>&nbsp;</p>
<p>also with the tempature, you would do just that in the inputs of eamon? or would you save it in the sketch itself &nbsp;</p>
<p>&nbsp;</p>
<p>my other question is can you sense UPS battery voltages with the clip on sensors? &nbsp;this may be what i might end up doing if i cant measure what i want with what equipment i have now. &nbsp;if this is possible in the future i could also then monitor the battery voltage on our Generator&nbsp;which i would love to do as well. &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10347"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: how do i intergrate temp + current</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 07/03/2013 - 00:11.</div>
    <div class="content">
     <p>You need to talk to the electricians who maintain the building to find out about the power supplies. Until you know, it will all be guesswork. I&#39;m in the UK and I only know about UK practice.</p>
<p>If you need to measure &quot;real power&quot; (which is what you get charged for) accurately, then you need to measure the voltage on the associated wire as well as the current. The emonTx sketches that measure voltage do the correct sum to calculate &quot;real power&quot;. If you&#39;re only interested in current, or only need a rough estimate of power, or only the &quot;apparent power&quot;, then you may not need to measure all the voltages.</p>
<p>Each emonTx has a temperature input. It&#39;s a OneWire bus so you can daisy-chain many sensors and read them individually. The results need to be sent to your Raspi, of course.</p>
<p><em>You can&#39;t measure</em> <strong>voltage</strong> <em>with a split core current transformer</em><em>! </em>But does your UPS not have a data output that you can interrogate to get the battery state? I&#39;d be surprised if it did not, and the servers might already have that information. If not, you&#39;d probably need some fairly advanced programming to achieve that - something similar to the <a href="http://openenergymonitor.blogspot.co.uk/2012/08/reading-watt-hour-data-from-elster.html">Elster meter interface</a>.</p>
<p>Do you want to measure the generator starter battery? If so, that&#39;s probably a job for a separate emonTx for each generator as the presence of battery chargers will complicate matters. You&#39;d need to design a d.c. voltage interface and not use the c.t. input if you use the emonTx as the starting point.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10373"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gangaskan&#039;s picture" title="gangaskan&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: how do i intergrate temp + current</h3>

    <div class="submitted">Submitted by gangaskan (not verified) on Thu, 07/03/2013 - 20:43.</div>
    <div class="content">
     <p>our UPS is actually close to 40 some years old i think. &nbsp; our building was built in 73&#39;&nbsp;ish &nbsp;and i&#39;m pretty sure it was installed around that time as well. &nbsp;</p>
<p>&nbsp;</p>
<p>the individual ones we have in the data center do have a serial port and or USB built in, so that i have taken care of :)&nbsp;</p>
<p>&nbsp;</p>
<p>i found the transformer breaker for our Datacenter, three power legs, a neutral and a ground is all i see, but i&#39;ll talk to our building dept about the power. &nbsp; &nbsp;i should be fine just measuring those correct? &nbsp;assuming i want to just measure datacenter usage. &nbsp;but in the meantime i will have to figure out something else, perhaps humidity sensing in exchange for current. &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>nevertheless, i&#39;m pretty happy with what iv&#39;e done and seen so far :) &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10459"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gangaskan&#039;s picture" title="gangaskan&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: how do i intergrate temp + current</h3>

    <div class="submitted">Submitted by gangaskan (not verified) on Wed, 13/03/2013 - 18:17.</div>
    <div class="content">
     <p>Robert, i found out our transformer that goes into the datacenter splits each line to 120 single phase power. &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>i &nbsp;am sure i can do that without any issues right?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10461"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: how do i intergrate temp + current</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 14/03/2013 - 00:46.</div>
    <div class="content">
     <p>So you have a neutral at earth potential (or nearly so), and three phases each measuring 120 V line-neutral (and measuring 208 V between any two lines)?</p>
<p>If that&#39;s correct, then it&#39;s basically one emonTx per phase, as <a href="1170.html">here</a>. In addition you need 3 ac-ac voltage adapters to measure the voltages and 3 c.t&#39;s to measure the currents. If you want to measure more than the total per phase (e.g. individual racks) then this is the way to go as you have 3 current inputs per emonTx.</p>
<p>If you only want to measure the total, you could alternatively add two extra voltage channels to a single emonTx (the analogue inputs are available on headers, you&#39;d need a handful of components on strip-board) and that would give you 3 channels each of voltage and current. It would necessarily sample each phase in turn, whereas the &quot;Full-fat&quot; project samples the phases concurrently.&nbsp;</p>
<p>If you want a really cheap solution, and provided the three phase voltages are relatively stable in relation to each other, then you might get by with one emonTx and just measuring one voltage and generating the two other voltages in software. But again, you have only 3 c.t. inputs so only the total can be measured. By presuming the voltage for the two phases that aren&#39;t measured, you will potentially lose accuracy. You need to judge whether this is important.</p>
<p>In each case, you would have voltage, current, real power, apparent power and power factor for each phase, and a temperature input. The values you measure would need combining to give you the total for the entire data centre.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2094"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-64Maz27Wr4RhfX1hZm8ALWPX9-gQ8zypvnXmVUgv5nQ" value="form-64Maz27Wr4RhfX1hZm8ALWPX9-gQ8zypvnXmVUgv5nQ"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
