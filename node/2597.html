<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2597 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:46:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>My Pi PV Monitor and immersion heater Journey, finished with a bash (script) | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">My Pi PV Monitor and immersion heater Journey, finished with a bash (script)</h3>
        <span class="submitted">Submitted by <a href="../user/3988.html" title="View user profile.">EricD</a> on Thu, 18/07/2013 - 15:06</span>
        <div class="content"><p>Hello everybody, this site is amazing; I&#39;ve been lurking around for a month or two now and am now ready to start. I&#39;m looking for things here that I may have missed.</p>
<p>There is so much info here, and I&#39;ve found a lot of it, but, you can&#39;t possibly know what you haven&#39;t found, so if you can point to any good stuff that I should be aware of, that&#39;d be great.</p>
<p>I&#39;ve got a 12 panel ( 2 .5 KW max) PV installation talking to a SMA Sunny Boy 2500HF inverter who in turns blu-tooths to a Sunny Beam monitor. Like pretty much everybody, I tried to use as much of the surplus as I could. Started by getting an Immersion Heater Power Reducer (<a href="http://powerreducer.co.uk/" title="http://powerreducer.co.uk/">http://powerreducer.co.uk/</a>) for my immersion heater - which luckily had never been used or wired up before so was in good condition. Now according to my British Gas Energy Monitor this takes about 1.2 ish Kw and heats the tank up in a couple of hours. This unit was probably over priced at 50 gbp, but there you go, live and learn.</p>
<p>So, after a few months, of running up and down the stairs (good exercise mind) to turn it on and off as the sun goes in and out, I started thinking about some sort of automatic control and came across this site. And, I had a RasberryPi - as an old coder from just before BBC B Micro days, I couldn&#39;t resist buying one last year, but it didn&#39;t have a problem to solve - now it does!</p>
<p>I am a type 2 installation. I can&#39;t put a CT clip-on on my solar output as this comes to my solar meter (a JWI PRO75D) from the inverter in twin cable. So I intend to monitor it&#39;s output with a pulse sensor - is that a straight forward option?&nbsp; The grid import/export to be monitored with a CT clip-on and an AC-AC sensor for it&#39;s direction.</p>
<p>My ultimate aim, well firstly is to have fun and enjoy the journey, and then at some time to be able to switch the immersion heater on and off according to some strategy that I might devise. In fact better than that to have a selection of plug-in strategies that can be activated according to circumstances of power available, time of day, time of year, probably other things as well.</p>
<p>Are there pins left unused on the Pi&#39;s gpio&nbsp; after the RFM12Pi has been plugged in ?</p>
<p>Is there a design for a gpio output from the Pi to switch a mains relay?</p>
<p>I would love the option of a further halving the power as well (so that&#39;d make it about 600watts), but I&#39;m guessing cos my AC theory is a bit shakey, that having already halved the power with my Power Reducer which has presumably chopped one half of the sine wave off, any options to play further with it are limited?</p>
<p>I also toyed with the idea of interrogating the SMA inverter via blu-tooth to get it&#39;s estimation of it&#39;s output, there is a PC application around that can be used to control the inverter, but I abandoned that as the intricacies of the blu-tooth and SMA protocols seemed a bit overwhelming.</p>
<p>So sorry, it&#39;s a long post, but my TSL257 fell thro the letterbox today, my other stuff is on route from &quot;The Shop&quot;, I have installed a double 13amp socket and a little shelf under the stairs where the EmonTx is going to live and I&#39;ve sorted out all the hardware and power supply stuff that Pi needs to keep it happy - and, as I said earlier, I&#39;m ready to go!</p>
<p>Thanks for all your help,</p>
<p>Eric</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10165.html" class="topic-previous" title="Go to previous forum topic">‹ Turnkey system for the US?</a>
              <a href="11129.html" class="topic-next" title="Go to next forum topic">Question regarding stepping down voltage ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-13693"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: My Pi PV Monitor and immersion heater Journey, finished with a bash (script)</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 18/07/2013 - 18:31.</div>
    <div class="content">
     <p>I think you should look at <a href="../mk2.html">Robin Emley&#39;s Mk2 controller</a> or, if you want monitoring too, it&#39;s derivative MartinR&#39;s <a href="1535.html">Solar PV power diversion with emonTx, emonGLCD and temperature measurement</a> to solve your immersion heater problem. Both use the same underlying principle, only the software is radically different, as Robin&#39;s is completely autonomous and does not have monitoring. You can read all the details for yourself, briefly Robin&#39;s has one c.t. on the meter tail and it attempts to balance PV generation with a controlled load, so making the most of your free energy before it get donated back to the grid. It doesn&#39;t need a c.t. on the PV feed as it seeks to set up zero nett energy flow through your meter. Martin&#39;s has a second c.t. for monitoring and a display, and the ability to send logging data too.</p>
<p>I think you should keep on looking here. We know how to get information out of a few meters, and there&#39;s an article about <a href="https://learn.openenergymonitor.org/?redirect=interfacing-with-sma-sunnyboy-pv-inverters-bluetooth">Sunnyboy and Bluetooth</a> in Building Blocks, so don&#39;t reinvent the wheel!</p>
<p>The best hint I think I can give you is don&#39;t use the site&#39;s search. Instead use Google like this:</p>
<p class="rteindent1">[search-term] site:openenergymonitor.org</p>
<p>(without the square brackets of course).</p>
<p>And of course, use the forums. There are a fair number of helpful people here with quite a bit of accumulated knowledge between them.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13700"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3988.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="EricD&#039;s picture" title="EricD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: My Pi PV Monitor and immersion heater Journey, finished with a bash (script)</h3>

    <div class="submitted">Submitted by <a href="../user/3988.html" title="View user profile.">EricD</a> on Fri, 19/07/2013 - 08:51.</div>
    <div class="content">
     <p>Thanks Robert for those pointers, I hadn&#39;t found those and they&#39;re right on the button.</p>
<p>Thanks also for the Google search hint, that&#39;s a real advance, I just didn&#39;t know that about Google.</p>
<p>Very grateful for your help.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13701"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: My Pi PV Monitor and immersion heater Journey, finished with a bash (script)</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Fri, 19/07/2013 - 09:25.</div>
    <div class="content">
     <p>Let me know if you need help interfacing with the SMA inverter - thats my specialty!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13708"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3988.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="EricD&#039;s picture" title="EricD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: My Pi PV Monitor and immersion heater Journey, finished with a bash (script)</h3>

    <div class="submitted">Submitted by <a href="../user/3988.html" title="View user profile.">EricD</a> on Fri, 19/07/2013 - 15:03.</div>
    <div class="content">
     <p>Thanks Stuart, that seemed to me to be an area that was almost rude not to pursue. I had downloaded the Sunny Explorer ( SunnyExplorerSetup10615.exe) but did get a bit frightened off with talk in the user manual of potentially mangling the plant.</p>
<p>So yes, I&#39;ll almost certainly be in touch a bit further down the road when I&#39;ve got something up and going, I like the idea of getting information straight from the horses mouth a lot!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13709"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: My Pi PV Monitor and immersion heater Journey, finished with a bash (script)</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Fri, 19/07/2013 - 16:12.</div>
    <div class="content">
     <blockquote><p>Submitted by stuart on Fri, 19/07/2013 - 11:25.<br />
		Let me know if you need help interfacing with the SMA inverter - thats my specialty!</p>
</blockquote>
<p>&nbsp;</p>
<p>Does this mean that you have managed to make the smagateway working, i.e. from bluetooth to rdm12b like one of the jeelabs example scripts show ? I tried to make it today for a good two hours without success so would appreciate some help and pointers where to dig deeper...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13757"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3623.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="manicmoddin&#039;s picture" title="manicmoddin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: My Pi PV Monitor and immersion heater Journey, finished with a bash (script)</h3>

    <div class="submitted">Submitted by <a href="../user/3623.html" title="View user profile.">manicmoddin</a> on Mon, 22/07/2013 - 11:44.</div>
    <div class="content">
     <p>Just getting my renta roof system set up.</p>
<p>I am wanting to look at power diversion as we use very little in the day, but get a lot at night with washing machine etc.</p>
<p>For accurcy sake, has anyone ever looked into aurora inverters? This has been installed and has rs485 apparently.</p>
<p>Using the spare power to power a heater of types will be perfect and hopefully cut the gas bill. Also would push onto oil filled radiator so as to help dry clothes indoors.</p>
<p>Each day a different thing to learn.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33423"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3988.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="EricD&#039;s picture" title="EricD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: My Pi PV Monitor and immersion heater Journey, finished with a bash (script)</h3>

    <div class="submitted">Submitted by <a href="../user/3988.html" title="View user profile.">EricD</a> on Tue, 18/08/2015 - 16:57.</div>
    <div class="content">
     <p>As&nbsp;you can see, this project stalled for a couple of years, but I started looking at it again in June this year.</p>
<p>It is now up and running, and thanks very much for all the help I&#39;ve received from the entries in this Forum.</p>
<p>My software solution was necessitated by my PV installation and immersion heater power location, and to some degree, my skills set.</p>
<p>Briefly I have a rev B pi running a bash script that gathers the emonTX&nbsp;raw data,&nbsp;provided by tailing the emonhub.log (set to INFO loglevel). It uses that data, plugged into a&nbsp;configurable strategy,&nbsp;to switch on/off a latching relay that controls my 1.5kW immersion heater. The script has a 10 second (configurable)&nbsp;delay between decisions. It writes to a log and has evolved over the weeks; it&nbsp;is configurable to send confirmation emails, write a CSV file for analysis and write a very verbose commentary in the log and other stuff as well. The main strategy variable are re-read on each of it&#39;s decision cycles so they can be altered on the fly. It shuts itself down in the evening (time is configurable) and emails a summary of the days&#39;s activities to me. A cron&nbsp;entry&nbsp;gets it up in the morning.</p>
<p>I had to lift up the&nbsp;rfm12pi&nbsp;module with a stand-off so I could get to some&nbsp;GPIO&nbsp;ports to drive the relay switch box.</p>
<p>The latching relay switch box, powered by two AA cells, has a 16 amp&nbsp;Ciseco relay in it, which is apparently good for 10 million operations. I have another script that gathers information from the ongoing log and gives a &quot;story so far&quot; picture, including&nbsp;the times of on and off and the&nbsp;number of relay &quot;clicks&quot;.</p>
<p>On an overcast day, with washing machine and kettle activity, it clicked around 200 times. And on a bright and sunny day, or a totally overcast day it clicked maybe 20 times. Reckoning on an average 100 clicks per day gives the relay&nbsp;an expected life of 274 years, the batteries (Poundland&#39;s finest)&nbsp;may need replacing before then.</p>
<p>It obviously cannot react instantaneously&nbsp;to changing household demands or the varying solar generation, but it seems to be doing a pretty good job of heating the hot water tank without using any imported power.</p>
<p>Thanks again for all of your help, there&#39;s been times when I&#39;ve had maybe 8 tabs open in my browser scouring through these Forum entries. Quite a journey.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2597"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-s8nIdH685RuCL9upJfEcdmXRrwW8YW2muBYG5Xaeo-c" value="form-s8nIdH685RuCL9upJfEcdmXRrwW8YW2muBYG5Xaeo-c"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/2597 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:46:13 GMT -->
</html>
