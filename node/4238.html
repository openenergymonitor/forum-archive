<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/4238 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:27:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>3 Voltage and 3 Current readings sketch | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">3 Voltage and 3 Current readings sketch</h3>
        <span class="submitted">Submitted by <a href="../user/5826.html" title="View user profile.">sette</a> on Thu, 20/03/2014 - 14:02</span>
        <div class="content"><p>Hi,</p>
<p>I&#39;m just starting play with arduino&nbsp;and current/voltage measurement, and found your project, it is amazing!</p>
<p>What I want to do is to read exactly the value of current and voltage on a three phase system. In fact without the approximation of a single ac-ac transformer used by you, I don&#39;t care about invasivity of the project ;-)</p>
<p>Is there already any example sketch of an arduino&nbsp;reading 3 analog and 3 current? I was starting editing one of your example but then I think that, maybe, I can start from an already working example ;-)</p>
<p>I know that, theorically, I will able to do 30 measurement per cycle, but for now is enough, next i&#39;ll want to extend it with a more powerful ADC, but it will be another story ;-)</p>
<p>&nbsp;</p>
<p>Thank you a lot!</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5098.html" class="topic-previous" title="Go to previous forum topic">‹ phase_shift </a>
              <a href="2429.html" class="topic-next" title="Go to next forum topic">PV to immersion diverter idea? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-19539"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 20/03/2014 - 15:38.</div>
    <div class="content">
     <p>I don&#39;t know of an example sketch that does that, because our hardware has only one voltage input. That&#39;s because a 3 phase domestic supply is extremely rare in the UK. You could stack 3 x emonTx V2, as in <a href="1170.html">Martin Robert&#39;s design</a> or (what I suspect you want) design your own front-end interface and write your own sketch - which will be quite simple, the major change you&#39;ll need is to the library to allow the voltage pin to be defined so as to pair with a c.t. pin on the same phase. The rest of the sketch would be almost unchanged.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19541"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 20/03/2014 - 16:01.</div>
    <div class="content">
     <p>I posted a sketch last year which measures two current paths on each of two phases.&nbsp; This could be easily changed for measuring one current path on each of three phases.&nbsp; I used strip-board for the front-end sensors and a standard Arduino Uno.</p>
<p>Details are in the zip file some way down t<a href="2917.html">his thread</a> (posted 17/10/14)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19563"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5826.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sette&#039;s picture" title="sette&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/5826.html" title="View user profile.">sette</a> on Fri, 21/03/2014 - 07:41.</div>
    <div class="content">
     <p>Thank you both! I&#39;ll take a look on calypso_rae&nbsp;sketch and I&#39;ll going to edit it to adapt it to my need...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19583"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 21/03/2014 - 20:29.</div>
    <div class="content">
     <p>OK, sette, send me a PM if you need any help.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19730"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5826.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sette&#039;s picture" title="sette&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/5826.html" title="View user profile.">sette</a> on Mon, 24/03/2014 - 10:09.</div>
    <div class="content">
     <p>Thanks Calypso,</p>
<p>now i&#39;m trying to calibrate my arduino&nbsp;setup, i&#39;m using an AC-AC 9v industrial trafo&nbsp;and one allegro ACS712 to measure current.</p>
<p>I want to compare this with professional meter and see if it will be good enough.</p>
<p>Until now i&#39;ve some problem on &quot;centering&quot; the 0 of ACS712, the inputs always fluctuate between 510-515.... This afternoon i&#39;ll check it with an oscilloscope...</p>
<p>&nbsp;</p>
<p>Bye!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19739"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 24/03/2014 - 10:54.</div>
    <div class="content">
     <p><em>Until now i&#39;ve some problem on &quot;centering&quot; the 0 of ACS712, the inputs always fluctuate between 510-515....&nbsp; </em></p>
<p>If the ADC in your Arduino has its maximum range set to 5V, each step of the ADC will correspond to just 1 mV.&nbsp; The fluctuation that you are seeing is therefore only 5 mV.&nbsp; Do you think you&#39;ll be able to see this reliably on your oscilloscope?&nbsp;</p>
<p>If you do connect an oscilloscope to the input signal, it may be worth checking that the ADC&#39;s output has not been affected.&nbsp; The analogue input pins on the Atmega processor are very sensitive.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19768"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5826.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sette&#039;s picture" title="sette&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/5826.html" title="View user profile.">sette</a> on Mon, 24/03/2014 - 19:39.</div>
    <div class="content">
     <p>It should be 5 mV each ADC's step, and so less or more 20-25 mV, I think that i'll be able to see it....</p>
<p>you said "The analogue input pins on the Atmega processor are very sensitive.", is there somethign that i can do? like a circuit to stabilize it? or to remove this "noise"?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19776"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 24/03/2014 - 22:12.</div>
    <div class="content">
     <p>Sorry, my mistake; the ADC is indeed 5mV per step.</p>
<p>I&#39;ve never had much success measuring these inputs with a scope.&nbsp; All I know is that the amount of noise on a supposedly quiet channel is usually very small.&nbsp; I wouldn&#39;t expect to see more than a couple of steps between the min and max values.&nbsp; Unless any background signal is correlated with the mains voltage, the calculated power in the signal will be very small.</p>
<p>What happens to your readings if you earth the analogue input pin?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20014"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5826.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sette&#039;s picture" title="sette&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/5826.html" title="View user profile.">sette</a> on Sat, 29/03/2014 - 00:21.</div>
    <div class="content">
     <p>Hy calypso_rae,</p>
<p>sorry for the delay but i was out for work.</p>
<p>Today i did all the try, with input connected to earth it read 0, correctly. I&#39;ve connect the oscilloscope and i i&#39;ve a lot of noise, and the peak/peak voltage is 30mV! amazing, arduino read exactly the same value (it&#39;s float between 5-6 number)!</p>
<p>Now i&#39;m making some testing using a normal CT with burder resistor and DC bias and on another input the ACS712. With little voltage ACS has a lot of noise, these famous 25-30mV... and i think that this give me problems also on reading correctly the power factor.</p>
<p>With a capacitor on DC bias i&#39;ve a very good voltage waveform, but in current it is not so good. Have you got an idea on how i can calculate the capacitor for that?</p>
<p>thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20681"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4090.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="kurtkr&#039;s picture" title="kurtkr&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/4090.html" title="View user profile.">kurtkr</a> on Thu, 10/04/2014 - 15:36.</div>
    <div class="content">
     <p>Hi there</p>
<p>I have already made a PCB with the following specs:</p>
<p>1. 3 phase current input from f.ex. 3 phase solar inverter.<br />
	2. 3 phase current input from the grid<br />
	3. 3 voltage input for measuring grid voltage<br />
	4. 2 burglar alarm inputs<br />
	5. 2 alarm outputs for light and siren.<br />
	6.&nbsp; pot for calibration adjustment.</p>
<p>the PCB is designed as a shield for Arduino Mega 2560.<br />
	I think that it will also interface to Arduino Due with ARM processor.</p>
<p>I am a very experienced PCB high speed designer, but a &quot;new bee&quot; in programming.</p>
<p>I will kindly ask if anybody had made a sketch (software) for a system like this or similar.</p>
<p>thanks&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20730"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 12/04/2014 - 23:42.</div>
    <div class="content">
     <p>have a look here:</p>
<p>&nbsp;</p>
<p><a href="1170.html" title="http://openenergymonitor.org/emon/node/1170">http://openenergymonitor.org/emon/node/1170</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20731"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 13/04/2014 - 01:02.</div>
    <div class="content">
     <p>That is 3 sketches running on 3 processors, hardly <strong>a</strong> sketch, and not all that helpful (sorry, Bo).</p>
<p>I think, Kurt, you need to look at the &quot;continuous&quot; monitoring sketch for the emonTx V3 (in emonTxV3 &gt; RFM12B &gt; Examples &gt; emonTxV3_continuous ) because I think it will be easier to merge the alarm inputs into that one. You will need to extend the code to handle your 3 voltage and 6 current inputs, plus the alarm inputs.</p>
<p>The sketch is quite advanced in terms of the techniques it uses, but expanding it should be fairly straightforward, once you understand that the analogue input is working independently of the main loop, so at each step you are setting the ADC up for the next step but processing the last one.</p>
<p>Out of interest, why do you think you need a pot for calibration?</p>
<p>[Edit]<br />
	Robin Emley, who is the author of the continuous monitoring sketch, has pointed out that he thinks this <a href="2917.html" title="http://openenergymonitor.org/emon/node/2917">http://openenergymonitor.org/emon/node/2917</a> (already linked to further up this thread) and the sketch in the file <a href="../sites/default/files/NZ_project.zip" title="http://openenergymonitor.org/emon/sites/default/files/NZ_project.zip">http://openenergymonitor.org/emon/sites/default/files/NZ_project.zip</a> (in a post about half-way down that thread) would be a better starting point.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20976"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4090.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="kurtkr&#039;s picture" title="kurtkr&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/4090.html" title="View user profile.">kurtkr</a> on Wed, 23/04/2014 - 07:26.</div>
    <div class="content">
     <p>Hi<br />
	Thank you for the responses.</p>
<p>Sorry for the late answer, but I have been away a few days.<br />
	You are right Robert, I cannot use node 1170, as you said this is a design for 3 sketches, but very nice and neat.<br />
	I will look into your suggestions and I will come back later with the result.</p>
<p>By the way, the pot is for calibration, I want to make a calibration sketch for setup of all constants and place them in the EEPROM area.<br />
	I think it is in the end easier to make readjustments, when changing&#39;s occur.</p>
<p>Is it possible to get an email when someone is responding on a topic where you is participating?</p>
<p>Thank you in advance</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20983"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 3 Voltage and 3 Current readings sketch</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 23/04/2014 - 12:50.</div>
    <div class="content">
     <p>&quot;<em>Is it possible to get an email when someone is responding on a topic where you is participating?&quot;</em> I believe that is broken, and has been for a long time.</p>
<p>I think you would be better not relying on a pot with mechanical adjustment. What is there that is likely to change? There is little that is likely to drift far with age, once the uncertainty in the initial component values is accounted for (and a pot wouldn&#39;t help with the main cause of variation - temperature changes).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/4238"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-oyadhYXYMqMrLxTQyff-gdVn_YTHvJ1KdXfBS16fc2k" value="form-oyadhYXYMqMrLxTQyff-gdVn_YTHvJ1KdXfBS16fc2k"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/4238 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:27:54 GMT -->
</html>
