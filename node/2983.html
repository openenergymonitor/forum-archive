<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2983 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:08:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>How to Calibrate PHASECALL | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">How to Calibrate PHASECALL</h3>
        <span class="submitted">Submitted by Guest on Mon, 21/10/2013 - 20:11</span>
        <div class="content"><p>I&#39;ve try to change value PHASECALL In the function EnergyMonitor. it start from 0.9 increase. but i didnt see real power and power factor value change.&nbsp; whereas the difference real power of my system between multimeter about 11 W.</p>
<p>Can anyone explain it to me in simple terms?</p>
<p>Thanks.</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2640.html" class="topic-previous" title="Go to previous forum topic">‹ Transformer Theory</a>
              <a href="3000.html" class="topic-next" title="Go to next forum topic">Introduction ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-15851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 21/10/2013 - 21:19.</div>
    <div class="content">
     <p>PHASECAL is an adjustment to correct the errors in the input sensors. You adjust the value so that, with a purely resistive load, you have power factor = 1.00</p>
<p>The method is here: <a href="../modules/emontx/firmware/calibration.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware/calibration">http://openenergymonitor.org/emon/modules/emontx/firmware/calibration</a></p>
<p>If your test load is 11 W, I think it is very unlikely that you will see any difference, as the true current will be masked by electrical noise.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15852"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="shaulagara&#039;s picture" title="shaulagara&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by shaulagara (not verified) on Mon, 21/10/2013 - 21:54.</div>
    <div class="content">
     <p>How normally the range of work to read power??</p>
<p>i&#39;ve try to change the constant of PHASECALL from 0.9 - 2 but the value of power didnt change, so far i know it should have changed.</p>
<p>electrical noise?? you mean THD?</p>
<p>how about THD? In the function EnergyMonitor there is no filter. I&#39;m also still confused this section.</p>
<p>Can you explain it to me in simple terms?</p>
<p>thanks in advance.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15854"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 21/10/2013 - 22:10.</div>
    <div class="content">
     <p><em>&quot;How normally the range of work to read power??</em>&quot;&nbsp; Sorry, but I do not understand what you are asking.</p>
<p><em>&quot;electrical noise?? you mean THD?</em>&quot;&nbsp; No, I mean electrical noise from the digital part of the processor.&nbsp; It causes the input to change randomly by two or three counts even with nothing connected. You read that as a &quot;current&quot; of maybe 200 mA and a&nbsp; &quot;power&quot; of maybe a few tens of watts maximum. This is not real current nor is it real power. That is normal and you can do nothing about it. To set PHASECAL, you need a much larger load than that - say 500 W - so that the true current is much larger than the &quot;noise current&quot;. When you do that, you should see the power factor change as you change PHASECAL.</p>
<p>The real power calculation in emonLib <strong>will</strong> correctly calculate the power even when the current and voltage waves are distorted - provided there is no significant power in the harmonics above the 25th.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15857"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="shaulagara&#039;s picture" title="shaulagara&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by shaulagara (not verified) on Tue, 22/10/2013 - 21:37.</div>
    <div class="content">
     <p>i mean large load that can be read correctly? &gt;500, &lt;500 ??</p>
<p>im sorry i dont use emonLib.h library. my code use in the book &quot;arduino projects to save the world&quot;</p>
<p>I&#39;m&nbsp; confused when the current and voltage waves are distorted. because there is no filter.</p>
<p>from this code, if i change constan of PHASECALL, the real power doesnt change.</p>
<p>this is the code :</p>
<blockquote><p><em>#include &lt;LiquidCrystal.h&gt;<br />
		LiquidCrystal lcd(3, 5, 6, 7, 8, 9);</em></p>
<p><em>const int voltageSensor = A0;<br />
		const int currentSensor = A1;</em></p>
<p>	<em>const int numberOfSamples = 3000;</em></p>
<p><em>// Calibration constants<br />
		const float AC_WALL_VOLTAGE = 220.0;<br />
		const float AC_ADAPTER_VOLTAGE = 6.37;<br />
		const float AC_VOLTAGE_DIV_VOUT = 1.12;<br />
		const float CT_RATIO = 30;</em></p>
<p>	<em>// Calibration coefficients<br />
	const float VCAL = 1.0;<br />
	const float ICAL = 1.0;<br />
	const float PHASECAL = 1.0;<br />
	// Calculated ratio constants, modified by VCAL/ICAL<br />
	const float AC_ADAPTER_RATIO = AC_WALL_VOLTAGE / AC_ADAPTER_VOLTAGE;<br />
	const float AC_VOLTAGE_DIV_RATIO = AC_ADAPTER_VOLTAGE / AC_VOLTAGE_DIV_VOUT;<br />
	const float V_RATIO = AC_ADAPTER_RATIO * AC_VOLTAGE_DIV_RATIO * 5/1024 * VCAL;<br />
	const float I_RATIO = CT_RATIO * 5 / 1024 * ICAL;</p>
<p>	// Sample variables<br />
	int lastSampleV, lastSampleI, sampleV, sampleI;</em></p>
<p><em>// Filter variables<br />
		float lastFilteredV, lastFilteredI, filteredV, filteredI;</em></p>
<p>	<em>// Power sample totals<br />
	float sumI, sumV, sumP;</em></p>
<p><em>// Phase calibrated instantaneous voltage<br />
		float calibratedV;</em></p>
<p>	<em>// Calculated power variables<br />
	float realPower, apparentPower, powerFactor, voltageRMS, currentRMS;<br />
	unsigned long last_kWhTime, kWhTime;<br />
	float kilowattHour = 0.0;</em></p>
<p><em>void setup() {<br />
		lcd.begin(16,2);<br />
		}</em></p>
<p>	<em>void loop() {<br />
	calculatePower();<br />
	displayPower();<br />
	}</em></p>
<p><em>void calculatePower() {<br />
		for (int i = 0; i &lt; numberOfSamples; i++) {<br />
		// Used for voltage offset removal<br />
		lastSampleV = sampleV;<br />
		lastSampleI = sampleI;</em></p>
<p>	<em>// Read voltage and current values<br />
	sampleV = analogRead(voltageSensor);<br />
	sampleI = analogRead(currentSensor);</em></p>
<p><em>// Used for voltage offset removal<br />
		lastFilteredV = filteredV;<br />
		lastFilteredI = filteredI;</em></p>
<p>	<em>// Digital high pass filters to remove 2.5V DC offset<br />
	filteredV = 0.996 * (lastFilteredV + sampleV - lastSampleV);<br />
	filteredI = 0.996 * (lastFilteredI + sampleI - lastSampleI);</em></p>
<p><em>// Phase calibration<br />
		calibratedV = lastFilteredV + PHASECAL * (filteredV - lastFilteredV);</em></p>
<p>	<em>// Root-mean-square voltage<br />
	sumV += calibratedV * calibratedV;</em></p>
<p><em>// Root-mean-square current<br />
		sumI += filteredI * filteredI;</em></p>
<p>	<em>// Instantaneous Power<br />
	sumP += abs(calibratedV * filteredI);</em></p>
<p><em>}</em></p>
<p>	<em>// Calculation of the root of the mean of the voltage and current squared (rms)<br />
	// Calibration coeficients applied<br />
	voltageRMS = V_RATIO * sqrt(sumV / numberOfSamples);<br />
	currentRMS = I_RATIO * sqrt(sumI / numberOfSamples);</em></p>
<p><em>// Calculate power values<br />
		realPower = V_RATIO * I_RATIO * sumP / numberOfSamples;<br />
		apparentPower = voltageRMS * currentRMS;<br />
		powerFactor = realPower / apparentPower;</em></p>
<p>	<em>// Calculate running total kilowatt hours<br />
	// This value will reset in 50 days<br />
	last_kWhTime = kWhTime;<br />
	kWhTime = millis();</em></p>
<p><em>// Convert watts into kilowatts and multiply by the time since the last reading in ms<br />
		kilowattHour += (realPower / 1000) * ((kWhTime - last_kWhTime) / 3600000.0);</em></p>
<p>	<em>// Reset sample totals<br />
	sumV = 0;<br />
	sumI = 0;<br />
	sumP = 0;<br />
	}<br />
	void displayPower() {<br />
	lcd.clear();<br />
	lcd.print(realPower, 0);<br />
	lcd.print(&quot;w &quot;);<br />
	lcd.print(apparentPower, 0);<br />
	lcd.print(&quot;va &quot;);<br />
	lcd.print(powerFactor * 100, 0);<br />
	lcd.print(&quot;%&quot;);<br />
	lcd.setCursor(0,1);<br />
	lcd.print(voltageRMS, 0);<br />
	lcd.print(&quot;v &quot;);<br />
	lcd.print(currentRMS, 1);<br />
	lcd.print(&quot;a &quot;);<br />
	lcd.print(kilowattHour, 4);<br />
	}</em></p></blockquote>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15874"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 22/10/2013 - 13:42.</div>
    <div class="content">
     <p>That code looks as if it has been copied from here and altered for your book. Sorry, but I don&#39;t have the time to debug someone else&#39;s code. The author of the book is the person best placed to provide you with support.</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_CT123_Voltage">Try this sketch.</a> You will need emonLib. It will not drive a local display, and if you do not have the radio module, you will need to remove that from the sketch or it will hang.</p>
<p>[Edit]<br />
	I can see a mistake in the code. The power calculation is incorrect. It appears to be a deliberate change and if you have not changed the code out of the book, you&#39;ll need to ask the authors of the book why they have changed it from the original on this site. If it is their change, I think their understanding of electrical theory is suspect.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15876"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="shaulagara&#039;s picture" title="shaulagara&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by shaulagara (not verified) on Tue, 22/10/2013 - 15:19.</div>
    <div class="content">
     <p>the power calculation is incorrect??</p>
<p>what do you mean? which part is wrong?? can you explain it? I&#39;ve contacted the author but not yet replied.</p>
<p>im sorry, I forgot to remove the serial begin. I just changed Calibration coefficients and constans.</p>
<p>so this code will correctly calculate the power even when the current and voltage waves are distorted?? i didnt get it.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15884"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 22/10/2013 - 19:44.</div>
    <div class="content">
     <p>shaulagara, I&#39;ve just posted <a href="../sites/default/files/JPRelec_6V_3VA_PCBmtg.txt">a set of results</a> on a <a href="1912.html">different thread</a> which show a voltage and current waveform that are nicely in phase.&nbsp;&nbsp; That&#39;s because the current is passing through a resistive load (a 2 kW heater), and the voltage transformer is not introducing much phase shift.&nbsp;</p>
<p>PhaseCal is a software technique that introduces a phase shift in the voltage waveform.&nbsp; When measuring a resistive load, phase shift has very little effect on Real Power.&nbsp; I posted a video some months ago in which I introduced a phaseCal value of 5, and it made very little difference to the circuit&#39;s performance.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15886"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="shaulagara&#039;s picture" title="shaulagara&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by shaulagara (not verified) on Tue, 22/10/2013 - 21:36.</div>
    <div class="content">
     <p>calypso_rae,</p>
<p>so in order to have a large effect on the real power I have tried in capacitive or inductive loads?</p>
<p>What&#39;s the title of the thread that you post video???</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15891"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to Calibrate PHASECALL</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 23/10/2013 - 08:33.</div>
    <div class="content">
     <p>All the videos that I&#39;ve posted are listed on my <a href="1757.html">Summary Page</a>.</p>
<p>The particular one that I mentioned is at&nbsp; <a href="http://www.youtube.com/watch?v=v8ifoUJvcXY%C2%A0" title="http://www.youtube.com/watch?v=v8ifoUJvcXY&nbsp;">http://www.youtube.com/watch?v=v8ifoUJvcXY&nbsp;</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2983"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-HVjkw4bjdNwBdR5WKCvvwARyeALb0qhtnvLSf7o5e4c" value="form-HVjkw4bjdNwBdR5WKCvvwARyeALb0qhtnvLSf7o5e4c"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
