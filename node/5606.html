<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5606 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:23:51 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Using Emonhub with the emoncms PacketGen module | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Using Emonhub with the emoncms PacketGen module</h3>
        <span class="submitted">Submitted by <a href="../user/689.html" title="View user profile.">tgmaxx</a> on Wed, 20/08/2014 - 20:44</span>
        <div class="content"><p>First, in the guide to install emonhub, found here:</p>
<p><a href="http://emonhub.org/documentation/install/raspberrypi/" title="http://emonhub.org/documentation/install/raspberrypi/">http://emonhub.org/documentation/install/raspberrypi/</a></p>
<p>The debian package installer is not working. I was able to install the development version of emonhub as described below, but this needs to be prefaced with a &quot;cd ~&quot; to go to your&nbsp;homedir before doing the git clone.</p>
<p><a href="https://github.com/emonhub/dev-emonhub/blob/master/README.md" title="https://github.com/emonhub/dev-emonhub/blob/master/README.md">https://github.com/emonhub/dev-emonhub/blob/master/README.md</a></p>
<p>Then, in the following guide, &quot;Using Emonhub with the emoncms PacketGen module&quot; found here:</p>
<p>&nbsp; <a href="https://github.com/emoncms/emoncms/blob/bufferedwrite/docs/emonhubmod.md" title="https://github.com/emoncms/emoncms/blob/bufferedwrite/docs/emonhubmod.md">https://github.com/emoncms/emoncms/blob/bufferedwrite/docs/emonhubmod.md</a></p>
<p>There are some issues with the guide:</p>
<p>1) There is no file called:</p>
<p>&nbsp; /home/pi/emonhub/src/emonhub_listener.py</p>
<p>Member pb66&nbsp;let me know the file is now called, &quot;emonhub_interfacer.py&quot;</p>
<p>2) If the &quot;RFM12b Packet Generator&quot; &quot;Send Packet every:&quot; seconds is changed, it doesn&#39;t change the transmitting interval of packets. No matter what I set the time to, packets are sent every 5 seconds. How can the interval be changed? And, can custom intervals be available in the future? Packets can be seen by using minicom to monitor the serial port as follows:</p>
<p>minicom -b9600 -D/dev/ttyAMA0</p>
<p>3) Modifying the packet structure to other than default appears buggy. If deleting variables other than&nbsp;glcdspace and time, some data is still transmitted after the variables are deleted. Does emonhub need to be restarted? Seems a restart has no effect.</p>
<p>Thanks to all for these new features being developed.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5574.html" class="topic-previous" title="Go to previous forum topic">‹ phpmyadmin on Raspberry Pi</a>
              <a href="5591.html" class="topic-next" title="Go to next forum topic">Can&#039;t configure processing or feeds ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-23250"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using Emonhub with the emoncms PacketGen module</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 21/08/2014 - 00:21.</div>
    <div class="content">
     <p>Hi Tom</p>
<p>With regard to using emonhub with packetgen, it is possible,&nbsp;Trystan&nbsp;kindly wrote a temporary mod prior to the renaming changes which is why I advised you to replace all occurrences of &quot;listener&quot; with &quot;interfacer&quot;. It is a work around and is subject to change. However his guide says &quot;&nbsp;We can modify emonhub to poll the packetgen module periodically and send the packetgen packet state over serial to the rfm12/69.&quot; this tells us that the data is retrieved&nbsp;by emonhub&nbsp;from packetgen which is why altering the un-used &quot;send packet every&quot; has no effect as the packets are not sent.</p>
<p>In this code you added to emonhub</p>
<blockquote><p>if now - self._control_timestamp &gt; 5:<br />
		&nbsp;&nbsp;&nbsp; self._control_timestamp = now<br />
		&nbsp;&nbsp;&nbsp; packet = urllib2.urlopen(&quot;http://localhost/emoncms/packetgen/rfpacket.json?apikey=APIKEY&quot;).read()<br />
		&nbsp;&nbsp;&nbsp; packet = packet[1:-1]<br />
		&nbsp;&nbsp;&nbsp; self._log.debug(self.name + &quot; broadcasting control packet &quot; + packet + &quot;s&quot;)<br />
		&nbsp;&nbsp;&nbsp; self._ser.write(packet+&quot;s&quot;)</p>
</blockquote>
<p>The first line is basically &quot;if more than 5 seconds has passed since this last happened&quot; so if you want to alter how frequently emonhub&nbsp;retrieves the data you can change it here.</p>
<p>As pointed out in my PM and Trystans&nbsp;guide how this is implemented in the future is not yet determined (hence the temp mod) there will be significant change to the way emonhub and emoncms inter-communicate and the control functions in both parties will be built around that connection,&nbsp;</p>
<p>See if the result is still buggy now you are aware of the interval timing and allow time for packets to filter though to the nodes. if you edit/delete immediately after the packet has just been retrieved it is feasible for it to appear to be delivered after editing/deletion when you consider its route and browser refreshing etc, give it another try with this info and see how you get on.</p>
<p>Again this is a hack and is far from perfect but your participation is appreciated and any feedback can help development.</p>
<p>Just to recap and clarify a couple of your other points that were discussed by PM. &nbsp;There has been no package installer version developed yet, so there isn&#39;t a problem with it as such,, other than it doesn&#39;t exist. which is why I directed you to the development version installer.</p>
<p>The guide you refer to is amongst a few pages on the website I experimented with during the early stages of planning and development of emonhub&nbsp;has taken priority over the website, so I will temporarily take the site down to avoid any further confusion.</p>
<p>The development installer is intended to be run from the homedir as this is the normal starting point,&nbsp;As you were installing to the Modules folder of emoncms &nbsp;I prompted you to use cd to get back to the&nbsp;homedir. I have now altered the script to automatically change the current working directory to the homedir to remove the chance of error, therefore cd is not required regardless of current location.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5606"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Wen4G5bN-KnhfDNeok8tv8yCARpWvKD0TsdjOW7aUKQ" value="form-Wen4G5bN-KnhfDNeok8tv8yCARpWvKD0TsdjOW7aUKQ"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
