<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11491 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:12:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Flow sensor help | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Flow sensor help</h3>
        <span class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Wed, 28/10/2015 - 20:57</span>
        <div class="content"><p>I&#39;m gathering all the hardware pieces to start logging a new to be installed heatpump.<br />
Temperature sensors should be easy, flow rate however not so much.</p>
<p>&nbsp;</p>
<p>We have flow sensors readily available of the type SIKA&nbsp;VVX 25<br />
<a href="http://www.sika.net/en/products/flow-measuring-instruments/vortex-flow-sensors/series-vvx/item/1154-vortex-flow-sensor-type-vvx-25.html">http://www.sika.net/en/products/flow-measuring-instruments/vortex-flow-sensors/series-vvx/item/1154-vortex-flow-sensor-type-vvx-25.html</a><br />
&nbsp;</p>
<p>Looking at page 32 of the datasheet <a href="http://www.sika.net/images/Operating_Instructions/Flow_Measuring_Instruments/Vortex_VVX/Ba_VVX.pdf">here</a> it should provide a pulse output.<br />
I am however not familiar with this so was wondering if anybody could look at this and tell if this sensor is easily connected to an emonpi?</p>
<p>Any help is highly appreciated!</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11806.html" class="topic-previous" title="Go to previous forum topic">‹ emonTX Connectivity</a>
              <a href="11760.html" class="topic-next" title="Go to next forum topic">emonTx 3 phase ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-35457"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 28/10/2015 - 22:21.</div>
    <div class="content">
     <p>The centre diagram (NPN Open Collector) looks as if it should work - you'll need the pull-up resistor (R<sub>L</sub>) at 5.1 (or 4.7 or 5.6) k&Omega; and you'll use pins 2 (U+) and 6 (pulse) on the "temperature sensor" RJ45 connector.</p>
<p>However, if I've done my sums correctly, the maximum pulse rate is 250 per second, so the sketch inside the emonPi might well need tweaking to accommodate that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35530"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Fri, 30/10/2015 - 20:32.</div>
    <div class="content">
     <p>Thx for looking.<br />
I got a chance to look at the sensor in question today.<br />
Turns out it's not the version with pulse output but with analoge output (see p33).</p>
<p>Looking aht the datasheet, is this version easily connectable?</p>
<p>Thx for the help!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35534"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 30/10/2015 - 22:06.</div>
    <div class="content">
     <p>It should be possible, though I've not tested it. A6 appears on pin 8 of the RJ45 connector, but that is only good to 3.3 V whereas your output possibly goes to 4 V - certainly to 3.5 V - therefore you'll need to lose a small fraction of the input voltage with a voltage divider.</p>
<p>And of course you'll need to modify the sketch in the emonPi to handle that input.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35538"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Sat, 31/10/2015 - 05:36.</div>
    <div class="content">
     <p>For the vvx 25 3,5v means 150 l/min.<br />
I will be far from it.<br />
Even the vvx15's max of 40l/min won't be hit.</p>
<p>So this means i don't have to adjust the voltage?</p>
<p>Is there a post or something describing how to adjust the sketch?<br />
I'm totally new to rasperrby pi and arduino.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35542"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 31/10/2015 - 12:42.</div>
    <div class="content">
     <p>Maybe you do not expect the voltage to rise above 3.3 V, but in the case of a fault, it is possible that the voltage will rise above 3.3 V and the ADC input of the Atmel328P could be destroyed, therefore your input circuit should protect against that possibility. As the 3.3 V supply is not available on the connector, the only practical way is to add a series resistor (say 10 k&Omega;) to limit the current and hope that the internal protection diodes are adequate.</p>
<p>There are no instructions on this site for changing the sketch, though there are very many web pages about measuring voltages with the Arduino.</p>
<p>In outline, you must<br />
1. In the header, add a suitable variable to the PayloadTX struct.<br />
2. In setup(), be sure that the No. 6 analogue port is set to be an input (this is the default).<br />
3. In loop(), do an analogRead() of the input pin and scale the number to engineering units, copy the result into the new variable.<br />
4. Compile the sketch and transfer the hex file to the emonPi.<br />
5. Change the configuration of emonHub to include the new variable that you added. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35609"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Tue, 03/11/2015 - 10:49.</div>
    <div class="content">
     <p>Allright, thx!<br />
Seems is missed your post, hence the late reply!</p>
<p>I&#39;ll go ahead and order everiything i need.<br />
Where can i download the original sketch loaded in every emonpi by default?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35611"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 03/11/2015 - 11:34.</div>
    <div class="content">
     <p>Github, as normal. You need all the .ino files, even though you'll only edit the one:</p>
<p><a href="https://github.com/openenergymonitor/emonpi/tree/master/Atmega328/emonPi_RFM69CW_RF12Demo_DiscreteSampling" title="https://github.com/openenergymonitor/emonpi/tree/master/Atmega328/emonPi_RFM69CW_RF12Demo_DiscreteSampling">https://github.com/openenergymonitor/emonpi/tree/master/Atmega328/emonPi...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36090"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Thu, 19/11/2015 - 21:25.</div>
    <div class="content">
     <p>A bit has changed lately.</p>
<p>I have the EmonPI with connected temp. sensors and edited Vcal (thx!).<br />
Also i have the flow sensor wired to the emonpi. I measured the voltage coming into pin 8 of the RJ45 sensors, and it seems to work fine.</p>
<p>However, i have been looking at your instructions for editing the sketch to accommodate the new sensor, with no real success.<br />
The only reference to pin 8 in the sketch seems to be this line:</p>
<p>//const byte emonPi_RJ45_8_IO= &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; A6; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // RJ45 pin 8 - Analog 6 (D19) - Aux I/O</p>
<p>Can you explain this in a bit more detail? if possible.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36092"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 19/11/2015 - 22:02.</div>
    <div class="content">
     <p>You need to be looking at the ISR for handling the pulses. That's in the file "emonPi_Interrupt_Pulse.ino". And it gets into the ISR via the file "emonPi_Startup.ino" for the pull-up and "emonPi_int1_pin" and the main sketch for the interrupt itself. It's "emonPi_int1_pin" that you are looking for, and it's actually pin 6 on the RJ45 (see the Wiki).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36101"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Thu, 19/11/2015 - 23:23.</div>
    <div class="content">
     <p>But, i'm using 0-3,5v.not pulses.<br />
Isn't pin 8 the one i need for analog signal?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36153"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 20/11/2015 - 23:27.</div>
    <div class="content">
     <p>Sorry, I'd forgotten that. Most flow sensors send pulses. Pin 8 is ADC 6 so it should be readable with a normal analogRead(emonPi_RJ45_8_IO).</p>
<p>"A6" is a predefined constant in one of the Arduino library files, so "emonPi_RJ45_8_IO" is really just giving a meaningful name to that input - after you've uncommented that line, of course.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36355"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Thu, 26/11/2015 - 19:40.</div>
    <div class="content">
     <p>I&#39;ve started fiddling with the sketch, not knowing half of what i&#39;m doing to be honest.</p>
<p>Is the added sketch anywhere near what i&#39;m supposed to be doing?</p>
<p>Doen&#39;t compile though:</p>
<p>flowValue&nbsp;was not declred in this scope...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36357"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Thu, 26/11/2015 - 20:26.</div>
    <div class="content">
     <p>or should i just add&nbsp;</p>
<p>&nbsp; emonPi.flowValue=int(analogRead(emonPi_RJ45_8_IO)*28.5714);</p>
<p>to loop()</p>
<p>&nbsp;</p>
<p>EDIT:</p>
<p>I&#39;m getting somewhere, with this above command i&#39;m now getting a value in emonhub!</p>
<p>It&#39;s not correct (bit high), but i can go from here now.</p>
<p>Thx for the help robert, your posts have been great! (although difficult to understand for me :) )</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36435"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Sun, 29/11/2015 - 09:16.</div>
    <div class="content">
     <p>I have been playing around&nbsp;with this some more.<br />
There seem to be 2 problems still.</p>
<p>1. The measured Voltage coming in on the input is incorrect. ( Arduino&nbsp;measured value is higher than manually measured with multimeter. Calculated flow is as expected also too high. 0 flow reads as 18l/min...</p>
<p>2. Highly fluctuating values, very unstable.<br />
Could this be an effect of the power supply? Measured +5VDC is fluctuating between 4.82 V and 4.86 V.<br />
Besides the fact its unstable, isn&#39;t it too low?<br />
I&#39;m using the PS delivered with the emonPi.</p>
<p>My power feed coming from the CT&#39;s also isn&#39;t very stable, i&#39;m not sure how stable it is supposed to be actually.</p>
<p>Can i read the actual Vcc measured by the arduino in my calculations?<br />
In the sketch is written i shouldn&#39;t use readvcc?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36843"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 08/12/2015 - 16:44.</div>
    <div class="content">
     <p>Hello Beire</p>
<p>Looking at your code I can see a few potential problems, although by the looks of it you got a bit further as you have the data in emoncms. I would do something like this for the analog reading:</p>
<p>&nbsp;&nbsp;&nbsp; double sum = 0; byte n = 0;<br />
&nbsp;&nbsp;&nbsp; // try increasing this for a more stable reading<br />
&nbsp;&nbsp;&nbsp; for (byte i=0; i&lt;10; i++) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // calculate voltage in Volts on A6 and add to sum&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sum += (analogRead(A6)/1023.0)*3.3;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n++;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; double flowVoltage = (sum / n);<br />
&nbsp;&nbsp;&nbsp; double flowValue = flowVoltage&nbsp; * 28.5714;<br />
&nbsp;&nbsp;&nbsp; emonPi.flow = flowValue * 10;</p>
<p>if you add that just above the line<br />
&nbsp;&nbsp;&nbsp; send_emonpi_serial();</p>
<p>The above lines calculates an average which might help with stability a little, the result is also multiplied by 10 in order to make it possible to send it as an integer and then divide by 10 to obtain L/min to one decimal place in emoncms.</p>
<p>The power feed does look quite noisy, what are you measuring with it? do you have an ACAC voltage sensor for realpower measurement? I&#39;ve attached an screenshot of my emonpi at ~30W load, the standard deviation measured in emoncms is 1.9W over that period, Im using an ACAC adapter for voltage measurement.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36846"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Tue, 08/12/2015 - 19:14.</div>
    <div class="content">
     <p>Hello Beire,</p>
<p>I wonder where you got these from - I have been looking for a flow meter for a while.&nbsp; Are you in the UK (I&#39;m guessing not)?</p>
<p>Cheers, Brian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36847"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Tue, 08/12/2015 - 19:19.</div>
    <div class="content">
     <p>Hey Trystan,</p>
<p>Thank you for taking the time looking at my problem!</p>
<p>You mention multiplying by 10 to send as an integer. Up until now i sent the value as a float:</p>
<p>Payload:</p>
<p>float flow;<br />
float flowVoltage;</p>
<p>Is it better to send as an integer?</p>
<p>I have edited and attached the sketch. Is it correct this way? I changed the value * 28.5714.<br />
This value was a prelimenary&nbsp;test value. The calculation should now be correct with that formula and correspond to the output graph of the sensor.</p>
<p>Exactly what value should i change to have a more stable reading?</p>
<p>I&#39;m having a bit delay now, as the sensor i placed in the system seems to be defective (wasn&#39;t new). So i&#39;m now waiting for the time to go over there and change with a new model.</p>
<p>As far as the instable value&#39;s are concerned...<br />
I&#39;m measuring the power draw from the heat pump compressor. BUT as this is the first heatpump&nbsp;of this brand / model we are logging, i&#39;m not sure how it compares to other brands we are logging.<br />
Could just be the compressor load. Don&#39;t know. I&#39;m having the electrical resistance also logged, i&#39;ll&nbsp;try forcing that one on as a test and look at that output.</p>
<p>I am using an AC-AC adapter btw (from the store EU model). I had to change the value of calibration in the sketch to 244 to correspond to the actual voltage.<br />
This is far off the &quot;default&quot; recommended setting for the EU adapter no?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36848"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Tue, 08/12/2015 - 19:22.</div>
    <div class="content">
     <p>Hi borpin123,</p>
<p>I&#39;m not from the UK now, i&#39;m located in belgium.</p>
<p>I&#39;m an installer of heatpumps (stiebel eltron and daikin).<br />
These sensors are used in Daikin&#39;s models. BUT grundfoss sensors have a habit of dying after a while due to bad resistance to poorer water quality.<br />
Daikin have issued an RMA procedure for al these sensors to change them with SIKA VVX sensors.</p>
<p>That is why i have quite a lot of them at my disposal.</p>
<p>Now as this is only temporary as a test case, i will be needing to source them elsewhere also.<br />
I&#39;ll keep an eye out for them and let you know where i can buy them from.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36993"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 14/12/2015 - 14:53.</div>
    <div class="content">
     <p>Great looks good, you can increase the 10 here: for (byte i=0; i&lt;<strong>10</strong>; i++) { to say 100 to average over 100 samples.</p>
<p>Sending as an integer uses 2 bytes rather than the 4 needed for a float which reduces the packet size helping with low power operation but if the node is powered from a usb supply it shouldn&#39;t really matter.</p>
<p>Yes the calibration can be different due to component and 1.1v reference tolerance, I recently fine tuned a test emontx to 260.4 to get closer results, there&#39;s a bit on voltage adapter calibration here: <a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory" title="http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor-installation-and-calibration-theory">http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor...</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37000"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 14/12/2015 - 16:48.</div>
    <div class="content">
     <p><i>"I had to change the value of calibration in the sketch to 244 to correspond to the actual voltage. This is far off the "default" recommended setting for the EU adapter no?"</i></p>
<p>Actually, it is just inside the tolerance band. The calculated coefficient is 260, with a 6% tolerance for the adapter, and divider resistor chain tolerances. Adding those in, the lower limit is 244.4. Then you must add the tolerance on the 3.3 V power supply, which is "typical" 0.4% (you are using an emonPi?), and that takes you below your value of 244. At the regulator limit tolerance of 3%, that takes the worst possible calibration factor well outside your value.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37003"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Beire&#039;s picture" title="Beire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flow sensor help</h3>

    <div class="submitted">Submitted by <a href="../user/8783.html" title="View user profile.">Beire</a> on Mon, 14/12/2015 - 17:13.</div>
    <div class="content">
     <p>Thx for verifying trystan!</p>
<p>Robert,<br />
Good to know it's not abnormal.<br />
I wasn't worrying too much about it, just wondering if it's still within 'normal' spec :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11491"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-6LmrKTnFpuLdMFyW-21bvnLk8V9hEB2nbGsDYMpNd0s" value="form-6LmrKTnFpuLdMFyW-21bvnLk8V9hEB2nbGsDYMpNd0s"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/11491 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:12:57 GMT -->
</html>
