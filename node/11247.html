<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11247 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:43:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emonhub and OEM Gateway [SOLVED] | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emonhub and OEM Gateway [SOLVED]</h3>
        <span class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Sat, 12/09/2015 - 19:37</span>
        <div class="content"><p>I have Emonhub/EmonPi and did configure OEM Gateway to send data from Arduino directly to my Raspberry USB. I had 3 issues:</p>
<p>1) /var/log/oemgateway is deleted all the time automatically.<br />
2) localhost url do not updates Nodes directly, but inputs.<br />
3) node sent from Arduino is just &quot;5&quot;, and in serial I have &quot;5&quot;, but in URL I have 5.0 and data is sent to a wrong place.</p>
<p>Does I really need to do this special configuration and execute OEM Gateway or it can be done directly from EmonPi? (read Arduindo data from USB port)</p>
<p>Is possible to solve the node number problem?</p>
<p>Thanx a lot!</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11442.html" class="topic-previous" title="Go to previous forum topic">‹ Type 2 with one CT clamp? Pulse meter instead of AC-AC?</a>
              <a href="11439.html" class="topic-next" title="Go to next forum topic">Emoncms v9 and minus temperatures ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-34102"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 13/09/2015 - 08:28.</div>
    <div class="content">
     <p>I&#39;m not quite sure what it is exactly you have or are trying to achieve but you should not be using OEMG and emonHub together, emonHub&nbsp;replaced OEMG sometime ago and is included on the emonSD images.</p>
<p>When you say <em>&quot;send data from Arduino directly to my Raspberry USB&quot;&nbsp;</em>do you mean you have an&nbsp;Arduino connected by USB to the Pi? if so you can search this forum for &quot;serial-direct&quot; to get info on connecting a emonTx&nbsp;to the Pi via the (GPIO) serial port and it&#39;s pretty much the same&nbsp;except the serial port is /dev/ttyUSB0 (assuming the arduino is the first or only usb device).</p>
<p>regarding the 3 issues</p>
<p>1) IF&nbsp;you are using a read-only OS which is normal for an OEM SDcard image,&nbsp;then this would be&nbsp;normal behavior.</p>
<p>2) I&#39;m not sure but think you maybe referring to the nodes module in emoncms here, in which case yes, that to can be expected if you are using the emonPi&nbsp;SDcard image which has&nbsp;variants of emonHub and emonCMS&nbsp;written to work almost exclusively&nbsp;together, you can probally&nbsp;&quot;get it to work&quot; with OEMG but I have no clue as to why you would want to, you are certainly not likely to find anyone else having done it.</p>
<p>3) Yes, that was a bug in OEMG that fixed in emonHub depite not being a problem at the time, but it would seems to have become a problem in later versions if you are seeing an issue.</p>
<p>The simplest solution to most of the issues&nbsp;seems to be don&#39;t use&nbsp;OEMG,</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34124"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7376.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7376.jpg" alt="allmac&#039;s picture" title="allmac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Sun, 13/09/2015 - 20:18.</div>
    <div class="content">
     <p>Thanx&nbsp;again... I did remove&nbsp;OEMG&nbsp;instalation.</p>
<p>Now I did Serial-direct configuration, solving error&nbsp;messagens&nbsp;using&nbsp;infos&nbsp;from forum:</p>
<p><a href="10941.html" title="http://openenergymonitor.org/emon/node/10941">http://openenergymonitor.org/emon/node/10941</a></p>
<p>However, as adding&nbsp;NodeID&nbsp;as first item,&nbsp;I am not able understand the error message.<br />
I have 7 items, but it asks for 6? Emoncms.org and Local are not receiving data, and I understood in log&nbsp;informations&nbsp;that at least Emoncms.org should be receiving something.</p>
<p>2015-09-13 17:09:35,171 INFO&nbsp;emoncms&nbsp;remoto&nbsp;sending: http://emoncms.org/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[]&amp;sentat=1442174975<br />
2015-09-13&nbsp;17:09:35,183 WARNING&nbsp;SerialDirect&nbsp;611 RX data length: 6 is not valid for&nbsp;datacodes&nbsp;[&#39;h&#39;, &#39;h&#39;, &#39;h&#39;, &#39;h&#39;, &#39;h&#39;, &#39;h&#39;, &#39;h&#39;]<br />
2015-09-13 17:09:36,001 DEBUG&nbsp;emoncms&nbsp;remoto&nbsp;acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
2015-09-13 17:09:38,016 DEBUG&nbsp;SerialDirect&nbsp;612 NEW FRAME : 5 94 64 33 2 126 28<br />
2015-09-13 17:09:38,023 WARNING&nbsp;SerialDirect&nbsp;612 RX data length: 6 is not valid for&nbsp;datacodes&nbsp;[&#39;h&#39;, &#39;h&#39;, &#39;h&#39;, &#39;h&#39;, &#39;h&#39;, &#39;h&#39;, &#39;h&#39;]</p>
<p>Like this, but I am not able to find what can be wrong, or if I should just remove&nbsp;NodeID&nbsp;infor.<br />
<a href="6167.html" title="http://openenergymonitor.org/emon/node/6167">http://openenergymonitor.org/emon/node/6167</a></p>
<p>[[5]]<br />
&nbsp; &nbsp;&nbsp;nodename&nbsp;=&nbsp;emonTxShield<br />
&nbsp; &nbsp; firmware =&nbsp;emonTxShield<br />
&nbsp; &nbsp; hardware =&nbsp;emonTxShield<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; names = Node,&nbsp;Corrente1,&nbsp;Corrente2,&nbsp;Corrente3,&nbsp;Corrente4,&nbsp;Voltagem,&nbsp;Temperatura<br />
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;datacodes&nbsp;= h, h, h, h, h, h, h<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1, 1, 1, 1, 1, 1, 1<br />
&nbsp; &nbsp; &nbsp; &nbsp; units = N, W, W, W, W, V, C</p>
<p>I am loosing something?</p>
<p>Thanx!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34133"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7376.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7376.jpg" alt="allmac&#039;s picture" title="allmac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Mon, 14/09/2015 - 02:39.</div>
    <div class="content">
     <p>Just to update information about Serial-Direct... now it is working.<br />
Hope this will help somebody else.<br />
Here is my&nbsp;configuration to keep Emonhub&nbsp;working modifying RFM2Pi&nbsp;configuration:</p>
<blockquote><p>[hub]<br />
loglevel = INFO #(default:WARNING)</p>
<p>[interfacers]<br />
[[SerialDirect]]<br />
&nbsp; &nbsp; &nbsp;Type = EmonHubSerialInterfacer<br />
&nbsp; &nbsp; &nbsp; [[[init_settings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;com_port = /dev/ttyACM0 #USB<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;com_baud = 9600<br />
&nbsp; &nbsp; &nbsp; [[[runtimesettings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pubchannels = ToEmonCMS,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;subchannels = ToRFM12<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;calibration = 110V #(UK/EU: 230V, US: 110V)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;baseid = 5 #(emonPi default:5)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;quiet = false #(default:true)</p>
<p>[[emoncms remoto]]<br />
&nbsp; &nbsp; Type = EmonHubEmoncmsHTTPInterfacer<br />
&nbsp; &nbsp; [[[init_settings]]]<br />
&nbsp; &nbsp; [[[runtimesettings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; pubchannels = ToRFM12,<br />
&nbsp; &nbsp; &nbsp; &nbsp; subchannels = ToEmonCMS,<br />
&nbsp; &nbsp; &nbsp; &nbsp; url = <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
&nbsp; &nbsp; &nbsp; &nbsp; apikey = xxxxxxxxxxxxxxxxxxxxxxx<br />
&nbsp; &nbsp; &nbsp; &nbsp; senddata = 1<br />
&nbsp; &nbsp; &nbsp; &nbsp; sendstatus = 1</p>
<p>[nodes]<br />
[[5]]<br />
&nbsp; &nbsp; nodename = emonTxShield<br />
&nbsp; &nbsp; firmware = emonTxShield<br />
&nbsp; &nbsp; hardware = emonTxShield<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; names = CT1, CT2, CT3, CT4, Volt, Temp<br />
&nbsp; &nbsp; &nbsp; &nbsp; #datacodes = h, h, h, h, h, h #RFM2Pi<br />
&nbsp; &nbsp; &nbsp; &nbsp; #scales = 1, 1, 1, 1, 1, 1 #RFM2Pi<br />
&nbsp; &nbsp; &nbsp; &nbsp; #units = W, W, W, W, V, C #RFM2Pi</p>
</blockquote>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34964"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8835.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johlhausen&#039;s picture" title="johlhausen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/8835.html" title="View user profile.">johlhausen</a> on Thu, 15/10/2015 - 23:04.</div>
    <div class="content">
     <p>Hello Paul and allmec,</p>
<p>Not sure if anyone is out there still (last post was a month ago for this thread). I&#39;m curious about the connection on the Arduino side- is it from Rx/Tx or the Arduino&#39;s USB port?</p>
<p>This begs the question: is it possible to interface with emonHub from the Arduino&#39;s USB port and how is that different from UART?</p>
<p>Thanks, Jake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34967"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 15/10/2015 - 23:16.</div>
    <div class="content">
     <p>I&#39;m not really familiar with an actual &quot;Arduino&quot;&nbsp;I have only ever used Arduino type boards, but I would expect it depends on how your sketch is written. From emonHub&#39;s&nbsp;side it can use the serial port via gpio or a USB connection, I have a rfm2pi on /dev/ttyAMA0&nbsp;and a jeelink&nbsp;on /dev/ttyUSB0, I also frequently connect a emonTx&nbsp;or emonTH&nbsp;via a FTDI&nbsp;on USB too,&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34971"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8835.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johlhausen&#039;s picture" title="johlhausen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/8835.html" title="View user profile.">johlhausen</a> on Thu, 15/10/2015 - 23:35.</div>
    <div class="content">
     <p>Thanks for responding Paul.</p>
<p>The sketch uses Serial.print() just like the EmonTx Firmware- in fact it is a copy of &quot;current only&quot; EmonTx Shield sketch that adds in the node ID before each transmission. Viewing the serial monitor shows that data is cleanly displayed (for example, 7 69 3799 3482 3646) but I&#39;m not sure if this data is passed through the USB connection on the Arduino or only through the Arduino&#39;s UART.</p>
<p>This seems like it would be an attractive solution since it would power the Arduino as well as provide transmission for someone building a custom front end. Do you think there is interest here for that? Is it worth starting a new thread or would I be better off looking elsewhere or trying another solution?</p>
<p>Thanks, Jake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34973"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 15/10/2015 - 23:45.</div>
    <div class="content">
     <p>I see no reason why it shouldn&#39;t work, if I had one I would probably know the answer so perhaps someone else can chip in,&nbsp;</p>
<p><em>&quot;Viewing the serial monitor shows that data is cleanly displayed(for example, 7 69 3799 3482 3646) but I&#39;m not sure if this data is passed through the USB connection on the Arduino or only through the Arduino&#39;s UART.&quot;</em></p>
<p>How is it connected for that result? I assume you don&#39;t have both connected at once so&nbsp;if it&#39;s by USB then yes it will work, using&nbsp;the same &quot;/dev/tty???&quot; and baud your serial monitor is using, or if it&#39;s a different machine try /dev/ttyUSB0 or Allmac seems to be using&nbsp;/dev/ttyACM0.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34974"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8835.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johlhausen&#039;s picture" title="johlhausen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/8835.html" title="View user profile.">johlhausen</a> on Fri, 16/10/2015 - 00:07.</div>
    <div class="content">
     <p>To get that result, the Arduino is connected via its USB port to a USB port on my desktop machine. When I plug the Arduino into my Pi running emonHub, I get the &quot;SerialDirect Thread is dead&quot; error. I am unclear on how to proceed from here- I&#39;m using allmac&#39;s interfacer above and I know that I also need to use /dev/ttyACM0.</p>
<p>Any further insights/questions are welcome. I will keep googling &amp; troubleshooting, and if I end up creating a new thread I will link it here.</p>
<p>Thanks, Jake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34976"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 16/10/2015 - 00:30.</div>
    <div class="content">
     <p><em>&quot;and I know that I also need to use /dev/ttyACM0.&quot;</em></p>
<p>Are you sure? have you tried ttyUSB0? is it the only or first connected usb device?</p>
<p>At the commandline&nbsp;type&nbsp;</p>
<p>ls -la /dev/tty*&nbsp;</p>
<p>is your Arduino found?</p>
<p>In emonhub.conf set loglevel = DEBUG and restart emonhub, the creation of&nbsp;each interfacer&nbsp;is logged in emonhub.log you may find some info there, are the attempts settings correct?&nbsp;is the creation successful?&nbsp;or does it &quot;die&quot; during creation?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34978"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8835.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johlhausen&#039;s picture" title="johlhausen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/8835.html" title="View user profile.">johlhausen</a> on Fri, 16/10/2015 - 01:17.</div>
    <div class="content">
     <p>After typing ls-la /dev/tty* at the command line, one line is</p>
<p>crw-rw---T 1 root dialout 166,&nbsp; 0 Jun 17 14:40 /dev/ttyACM0</p>
<p>whereas there is no result for /dev/ttyUSB0. Further, that line is absent when I unplug the Arduino, leaving me fairly confident that ACM0 is what I should use.</p>
<p>My loglevel was set to INFO, I have changed it to DEBUG. How does one restart emonhub? Regardless, I restarted the Pi and got the same result.</p>
<p>The creation of the interfacer does not fail according to emonhub.log. It reads as follows:</p>
<ul>
<li>MainThread Creating EmonHubSerialInterfacer &#39;SerialDirect&#39;</li>
<li>MainThread Opening serial port: /dev/ttyACM0 @ 9600 bits/s</li>
<li>MainThread Setting SerialDirect subchannels: ToRFM12</li>
<li>MainThread Interfacer: Subscribed to channel&#39; : T</li>
<li>MainThread Interfacer: Subscribed to channel&#39; : o</li>
<li>MainThread Interfacer: Subscribed to channel&#39; : R</li>
<li>MainThread Interfacer: Subscribed to channel&#39; : F</li>
<li>MainThread Interfacer: Subscribed to channel&#39; : M</li>
<li>MainThread Interfacer: Subscribed to channel&#39; : 1</li>
<li>MainThread Interfacer: Subscribed to channel&#39; : 2</li>
<li>MainThread Setting SerialDirect pubchannels: [&#39;ToEmonCMS&#39;]</li>
<li>MainThread Interfacer: Subscribed to channel&#39; : T (then o, R, F, M, 1, 2 as above)</li>
<li>MainThread MQTT Subscribed to channel&#39; : ToEmonCMS</li>
<li>MainThread emoncmsorg Subscribed to channel&#39; : ToEmonCMS</li>
<li>MainThread SerialDirect thread is dead...</li>
</ul>
<p>Therefore I don&#39;t believe that the creation of the interfacer &quot;dies&quot; during creation. Is it worrisome that the interfacer runs through ToRFM12 in &quot;subscribed to channel&quot;?</p>
<p>Thanks, Jake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34986"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 16/10/2015 - 10:13.</div>
    <div class="content">
     <p>Try adding a comma to the end of the &quot;subchannels = ToRFM12&quot; line in [[SerialDirect]], it looks like the missing comma causes the list to be interpreted as a list of letters rather than a list containing one item.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34992"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7376.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7376.jpg" alt="allmac&#039;s picture" title="allmac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Fri, 16/10/2015 - 13:03.</div>
    <div class="content">
     <p>Where are you connecting your Arduinos&#39;s&nbsp;EMONCMS USB?&nbsp;Windows? Linux? Mac?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34996"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8835.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johlhausen&#039;s picture" title="johlhausen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/8835.html" title="View user profile.">johlhausen</a> on Fri, 16/10/2015 - 13:52.</div>
    <div class="content">
     <p>Paul, adding that comma changes the log to &quot;MainThread Interfacer: Subscribed to channel&#39; : ToRFM12&quot; as desired, but I still get the warning &quot;MainThread SerialDirect thread is dead.&quot; After backing up and trying to implement SerialDirect on a standard emonTx shield connected <strong>via serial (AMA0)</strong>, I&#39;m realizing that the Tx LED never comes on and I get the same results as above. I think I&#39;d better search around more on here to solve that problem first. Any hints or suggestions on what to search for?</p>
<p>allmac, not entirely sure what you mean by my Arduino&#39;s &quot;emoncms USB.&quot; In my previous attempts, I connected Arduino USB to desktop (ubuntu) USB to load the sketch and got the serial monitor results stated above (expected serial output). Then I would connect Arduino USB to Pi USB and get &quot;MainThread SerialDirect thread is dead.&quot; Does that help?</p>
<p>Thanks, Jake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34999"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7376.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7376.jpg" alt="allmac&#039;s picture" title="allmac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Fri, 16/10/2015 - 15:41.</div>
    <div class="content">
     <p>I have in my Pi the following:</p>
<p>1) Arduino&#39;s&nbsp;software output to Serial... you can try it using Arduino&#39;s Devtool&nbsp;Serial Monitor.</p>
<p>2)&nbsp;Arduino&nbsp;USB connected to Raspberry USB (OK)!</p>
<p>3)&nbsp;Serial Monitor tool installed in my Pi:&nbsp;http://www.hobbytronics.co.uk/raspberry-pi-serial-port</p>
<p>Now Arduino is sending data do serial, and you can use Serial Monitor software to view data in your Pi.</p>
<p>If you can see data in your Pi&#39;s Serial Monitor, than you are already receiving all right. My configuration file here at the top can help in EMONCMS configuration reading Serial Monitor&#39;s data.</p>
<p>I have also Arduino&#39;s Serial Tools&nbsp;installed in my Pi. Than I can use Pi to modify and update Arduino software:&nbsp;http://inotool.org</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35004"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7376.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7376.jpg" alt="allmac&#039;s picture" title="allmac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Fri, 16/10/2015 - 21:58.</div>
    <div class="content">
     <p>This is an working version of my Arduino&#39;s&nbsp;software.<br />
I need to clean,&nbsp;optimize and calibrate, because I have some negative data do CT.<br />
But it works fine, receiving Arduino&#39;s&nbsp;data in Pi&nbsp;via USB.</p>
<p>To view data in my Pi&nbsp;I use this:&nbsp;minicom -b 9600 -o -D /dev/ttyACM0</p>
<p>​</p>
<blockquote><p>/*Recommended node ID allocation</p>
<p>------------------------------------------------------------------------------------------------------------</p>
<p>-ID-&nbsp;&nbsp; &nbsp;-Node Type-&nbsp;</p>
<p>0&nbsp;&nbsp; &nbsp;- Special allocation in JeeLib RFM12 driver - reserved for OOK use</p>
<p>1-4 &nbsp; &nbsp; - Control nodes&nbsp;</p>
<p>5-10&nbsp;&nbsp; &nbsp;- Energy monitoring nodes</p>
<p>11-14&nbsp;&nbsp; &nbsp;--Un-assigned --</p>
<p>15-16&nbsp;&nbsp; &nbsp;- Base Station &amp; logging nodes</p>
<p>17-30&nbsp;&nbsp; &nbsp;- Environmental sensing nodes (temperature humidity etc.)</p>
<p>31&nbsp;&nbsp; &nbsp;- Special allocation in JeeLib RFM12 driver - Node31 can communicate with nodes on any network group</p>
<p>-------------------------------------------------------------------------------------------------------------</p>
<p>*/</p>
<p>&nbsp;</p>
<p>#define FILTERSETTLETIME 5000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //&nbsp; Time (ms) to allow the filters to settle before sending data</p>
<p>&nbsp;</p>
<p>const int CT1 = 1;&nbsp;</p>
<p>const int CT2 = 1;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Set to 0 to disable&nbsp;</p>
<p>const int CT3 = 1;</p>
<p>const int CT4 = 1;</p>
<p>&nbsp;</p>
<p>#define RF_freq RF12_868MHZ&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Frequency of RF12B module can be RF12_433MHZ, RF12_868MHZ or RF12_</p>
<p>915MHZ.</p>
<p>const int nodeID = 5;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // emonTx RFM12B node ID</p>
<p>const int networkGroup = 210;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // emonTx RFM12B wireless network group - needs to be same as emonBas</p>
<p>e and emonGLCD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;</p>
<p>const int UNO = 1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Set to 0 if your not using the UNO bootloader (i.e using Duemilano</p>
<p>ve)</p>
<p>#include &lt;avr/wdt.h&gt;</p>
<p>&nbsp;</p>
<p>#define RF69_COMPAT 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // set to 1 to use RFM69CW&nbsp;</p>
<p>#include &lt;JeeLib.h&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // make sure V12 (latest) is used if using RFM69CW</p>
<p>ISR(WDT_vect) { Sleepy::watchdogEvent(); } &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Attached JeeLib sleep function to Atmega328 watchdog -enables MCU&nbsp;</p>
<p>to be put into sleep mode inbetween readings to reduce power consumption&nbsp;</p>
<p>&nbsp;</p>
<p>#include &quot;EmonLib.h&quot;</p>
<p>EnergyMonitor ct1,ct2,ct3, ct4;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Create&nbsp; instances for each CT channel</p>
<p>&nbsp;</p>
<p>#include &lt;OneWire.h&gt;</p>
<p>#include &lt;DallasTemperature.h&gt;</p>
<p>#define ONE_WIRE_BUS 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Data wire is plugged into port 2 on the Arduino</p>
<p>OneWire oneWire(ONE_WIRE_BUS); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Setup a oneWire instance to communicate with any OneWire devices (</p>
<p>not just Maxim/Dallas temperature ICs)</p>
<p>DallasTemperature sensors(&amp;oneWire); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Pass our oneWire reference to Dallas Temperature.</p>
<p>&nbsp;</p>
<p>// By using direct addressing its possible to make sure that as you add temperature sensors the temperature sensor to variable mapping will&nbsp;</p>
<p>not change.</p>
<p>// DeviceAddress address_Temperatura = { 0x28, 0x57, 0x6E, 0x7F, 0x04, 0x00, 0x00, 0xAA };</p>
<p>&nbsp;</p>
<p>DeviceAddress address_Temperatura = { 0x28, 0x57, 0x6E, 0x7F, 0x04, 0x00, 0x00, 0xAA };</p>
<p>&nbsp;</p>
<p>typedef struct { int Corrente1, Corrente2, Corrente3, Corrente4, Voltagem, Temperatura;} PayloadTX; &nbsp; &nbsp; // create structure - a neat way of&nbsp;</p>
<p>packaging data for RF comms</p>
<p>PayloadTX emontx;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;</p>
<p>const int LEDpin = 9; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // On-board emonTx LED&nbsp;</p>
<p>&nbsp;</p>
<p>boolean settled = false;</p>
<p>&nbsp;</p>
<p>void setup()&nbsp;</p>
<p>{</p>
<p>&nbsp; Serial.begin(9600);</p>
<p>&nbsp; digitalWrite(LEDpin, HIGH); delay(1000);</p>
<p>&nbsp; digitalWrite(LEDpin, LOW); delay(1000);</p>
<p>&nbsp; digitalWrite(LEDpin, HIGH); delay(1000);</p>
<p>&nbsp; digitalWrite(LEDpin, LOW);</p>
<p>&nbsp;</p>
<p>&nbsp; //Serial.println(F(&quot;\n================================================&quot;));</p>
<p>&nbsp; //Serial.println(F(&quot;Ligado...\n&quot;));</p>
<p>&nbsp; //Serial.print(&quot;Node: &quot;);&nbsp;</p>
<p>&nbsp; //Serial.println(nodeID);&nbsp;</p>
<p>&nbsp; //Serial.print(&quot;Freq: &quot;);</p>
<p>&nbsp; //if (RF_freq == RF12_433MHZ) Serial.println(&quot;433Mhz&quot;);</p>
<p>&nbsp; //if (RF_freq == RF12_868MHZ) Serial.println(&quot;868Mhz&quot;);</p>
<p>&nbsp; //if (RF_freq == RF12_915MHZ) Serial.println(&quot;915Mhz&quot;);&nbsp;</p>
<p>&nbsp; //Serial.print(&quot;Network: &quot;);&nbsp;</p>
<p>&nbsp; //Serial.println(networkGroup);</p>
<p>&nbsp; //Serial.println(F(&quot;================================================\n&quot;));</p>
<p>&nbsp;</p>
<p>&nbsp; &nbsp;</p>
<p>&nbsp; if (CT1) ct1.current(1, 60.606); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Setup emonTX CT channel (ADC input, calibration)</p>
<p>&nbsp; if (CT2) ct2.current(2, 60.606); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Calibration factor = CT ratio / burden resistance</p>
<p>&nbsp; if (CT3) ct3.current(3, 60.606); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // emonTx Shield Calibration factor = (100A / 0.05A) / 33 Ohms</p>
<p>&nbsp; if (CT4) ct4.current(4, 60.606);&nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; if (CT1) ct1.voltage(0, 134.7, 1.7);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // ct.voltageTX(ADC input, calibration, phase_shift) - calibration for</p>
<p>&nbsp;AC-AC adapter&nbsp; <a href="../modules/emontx/firmware/calibration.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware/calibration">http://openenergymonitor.org/emon/modules/emontx/firmware/calibration</a>. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp; if (CT2) ct2.voltage(0, 134.7, 1.7);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Default set for Ideal Power adapter 268.97 for the UK adapter, 260&nbsp;</p>
<p>for the Euro and 130 for the US.</p>
<p>&nbsp; if (CT3) ct3.voltage(0, 134.7, 1.7);</p>
<p>&nbsp; if (CT4) ct4.voltage(0, 134.7, 1.7);</p>
<p>&nbsp;&nbsp; &nbsp;</p>
<p>&nbsp; rf12_initialize(nodeID, RF_freq, networkGroup);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // initialize RFM12B</p>
<p>&nbsp; rf12_sleep(RF12_SLEEP);</p>
<p>&nbsp;</p>
<p>&nbsp; pinMode(LEDpin, OUTPUT); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Setup indicator LED</p>
<p>&nbsp; digitalWrite(LEDpin, HIGH);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>}</p>
<p>&nbsp;</p>
<p>void loop()&nbsp;</p>
<p>{</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; if (UNO) wdt_enable(WDTO_8S);&nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; sensors.requestTemperatures(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Send the command to get temperatures</p>
<p>&nbsp; emontx.Temperatura = sensors.getTempC(address_Temperatura);</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; if (CT1) {</p>
<p>&nbsp; &nbsp; ct1.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of crossings, time-out&nbsp;</p>
<p>&nbsp; &nbsp; emontx.Corrente1 = ct1.realPower;</p>
<p>&nbsp; &nbsp; //Serial.print(emontx.Corrente1);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp; }</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; if ((ct1.Vrms) &lt; 10) { ct1.Vrms = 0;}</p>
<p>&nbsp; emontx.Voltagem = ct1.Vrms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // AC Mains rms voltage</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; if (CT2) {</p>
<p>&nbsp; &nbsp; ct2.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of crossings, time-out&nbsp;</p>
<p>&nbsp; &nbsp; emontx.Corrente2 = ct2.realPower;</p>
<p>&nbsp; &nbsp; //Serial.print(&quot; &quot;); Serial.print(emontx.Corrente2);</p>
<p>&nbsp; }&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp; if (CT3) {</p>
<p>&nbsp; &nbsp; ct3.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of crossings, time-out&nbsp;</p>
<p>&nbsp; &nbsp; emontx.Corrente3 = ct3.realPower;</p>
<p>&nbsp; &nbsp; //Serial.print(&quot; &quot;); Serial.print(emontx.Corrente3);</p>
<p>&nbsp; }&nbsp;</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; if (CT4) {</p>
<p>&nbsp; &nbsp; ct4.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of crossings, time-out&nbsp;</p>
<p>&nbsp; &nbsp; emontx.Corrente4 = ct4.realPower;</p>
<p>&nbsp; &nbsp; //Serial.print(&quot; &quot;); Serial.print(emontx.Corrente4);</p>
<p>&nbsp; }</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp; //Serial.print(&quot; &quot;); Serial.print(emontx.Voltagem);</p>
<p>&nbsp; //Serial.print(&quot; &quot;); Serial.print(emontx.Temperatura);</p>
<p>&nbsp; //Serial.println(); delay(100);</p>
<p>&nbsp;</p>
<p>&nbsp; if (!settled &amp;&amp; millis() &gt; FILTERSETTLETIME) settled = true;&nbsp; &nbsp; &nbsp; &nbsp; // because millis() returns to zero after 50 days !&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp; if (settled)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // send data only after filters have settled</p>
<p>&nbsp; {&nbsp;</p>
<p>&nbsp; &nbsp; if (UNO) wdt_reset();</p>
<p>&nbsp; &nbsp; send_rf_data(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // *SEND RF DATA* - see emontx_lib</p>
<p>&nbsp; &nbsp; Serial.print(&quot;5&quot;);Serial.print(&quot; &quot;);</p>
<p>&nbsp; &nbsp; Serial.print(emontx.Corrente1);Serial.print(&quot; &quot;);</p>
<p>&nbsp; &nbsp; Serial.print(emontx.Corrente2);Serial.print(&quot; &quot;);</p>
<p>&nbsp; &nbsp; Serial.print(emontx.Corrente3);Serial.print(&quot; &quot;);</p>
<p>&nbsp; &nbsp; Serial.print(emontx.Corrente4);Serial.print(&quot; &quot;);</p>
<p>&nbsp; &nbsp; Serial.print(emontx.Voltagem);Serial.print(&quot; &quot;);</p>
<p>&nbsp; &nbsp; Serial.print(emontx.Temperatura);Serial.println();</p>
<p>&nbsp; &nbsp; digitalWrite(LEDpin, HIGH); delay(2); digitalWrite(LEDpin, LOW);&nbsp; &nbsp; &nbsp; // flash LED</p>
<p>&nbsp; &nbsp; delay(2000);&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // delay between readings in ms</p>
<p>&nbsp; }</p>
<p>}</p>
<p>&nbsp;</p>
<p>void send_rf_data()</p>
<p>{</p>
<p>&nbsp; rf12_sleep(RF12_WAKEUP);</p>
<p>&nbsp; // if ready to send + exit loop if it gets stuck as it seems too</p>
<p>&nbsp; int i = 0; while (!rf12_canSend() &amp;&amp; i&lt;10) {rf12_recvDone(); i++;}</p>
<p>&nbsp; rf12_sendStart(0, &amp;emontx, sizeof emontx);</p>
<p>&nbsp; // set the sync mode to 2 if the fuses are still the Arduino default</p>
<p>&nbsp; // mode 3 (full powerdown) can only be used with 258 CK startup fuses</p>
<p>&nbsp; rf12_sendWait(2);</p>
<p>&nbsp; rf12_sleep(RF12_SLEEP);</p>
<p>}</p>
</blockquote>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35005"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 16/10/2015 - 22:19.</div>
    <div class="content">
     <p>It is not as important now to allow time for the filters to settle, since emonLib now uses a low pass filter which can be initialised to a value that is close to the final, settled, value. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35192"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8835.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johlhausen&#039;s picture" title="johlhausen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub and OEM Gateway [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/8835.html" title="View user profile.">johlhausen</a> on Wed, 21/10/2015 - 02:07.</div>
    <div class="content">
     <p>Hi friends,</p>
<p>Thank you for all your help and advice. After feeling frustrated and quitting over the weekend, I came back tonight with encouraging results. I will attempt to document my progress here. Background: I have an emonTx shield (v. 2.5) on a knock-off Arduino Uno. It is connected from the Arduino&#39;s USB-B type port to a USB port on a Raspberry Pi B+ running the standard emonHub image.</p>
<ol>
<li>On my desktop, I opened the Shield_CT1234 in Arduino IDE and made the following modifications:
<ul>
<li>Change RF_COMPAT to 1<span style="display: none;">&nbsp;</span></li>
<li>Added &quot;Serial.print(nodeID); Serial.print(&quot; &quot;);&quot; after void loop()</li>
<li>(Changed the AC RMS voltage from 240.0 to 120.0 because America)</li>
</ul>
</li>
<li>Uploaded to Arduino and verified output formatting of type &quot;6 53 42 16 33&quot; via serial monitor.</li>
<li>Opened emoncms by typing in Pi&#39;s IP address in my desktop&#39;s web browser and made the following changes to the stock emonHub.conf:
<ul>
<li>com_port to /dev/ttyACM0</li>
<li>com_baud to 9600</li>
<li>datacode to B</li>
<li>(calibration to 110V)</li>
<li>From node 6, eliminate Vrms and its scale &amp; units. Also change datacode to B</li>
</ul>
</li>
<li>Plug Arduino into Pi via USB and it works!</li>
</ol>
<p>I feel pleased with this since it modifies existing OEM code as little as possible. Perhaps this will be useful to others desiring an easy serial connection. Paul, allmac, what questions can I answer to make this thread as useful to you and other visitors as possible?</p>
<p>My endgame with this is to create a custom Arduino front-end with an Arduino Mega to measure 16 CTs at once. With two such custom Arduinos connected to a Pi, perhaps I can build an all-in-one box to measure all 30 circuits in a full standard U.S. breaker box plus the two mains. This should cost less than $400 and have only one power cord. If I&#39;m successful, I&#39;ll do my best to post here and make a guide for others.</p>
<p>Again, thanks for your help Paul and allmac. Jake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11247"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-bw9C-IJ9AHyMq_8RbTc6pWty4z_mQ37ggaFgN1gvnuo" value="form-bw9C-IJ9AHyMq_8RbTc6pWty4z_mQ37ggaFgN1gvnuo"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/11247 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:43:47 GMT -->
</html>
