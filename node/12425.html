<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12425 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:16:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>enable/configure redis and swiftmailer + emonhub not start at boot | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">enable/configure redis and swiftmailer + emonhub not start at boot</h3>
        <span class="submitted">Submitted by <a href="../user/6548.html" title="View user profile.">billvolz</a> on Tue, 29/03/2016 - 06:46</span>
        <div class="content"><p>I reinstalled emoncms&nbsp;using this link:</p>
<p><a href="https://github.com/lafrech/emoncms_emoncms/blob/master/docs/RaspberryPi/readme.md" title="https://github.com/lafrech/emoncms_emoncms/blob/master/docs/RaspberryPi/readme.md">https://github.com/lafrech/emoncms_emoncms/blob/master/docs/RaspberryPi/...</a></p>
<p>I&#39;m at 9.4 on Jessie OS on an RPI3.&nbsp;</p>
<p>I noticed that there was a step to install redis and swittmailer but they aren&#39;t configured.&nbsp;</p>
<p>I&#39;ve searched the forum and found some info but not much, especially for 9.4.</p>
<p>Instructions for enabling and configuring them would be helpful.</p>
<p>Also, emonhub is not starting on reboot. Something is wrong with the service command.</p>
<p>service emonhub status</p>
<p>gives:</p>
<p>&nbsp;emonhub.service<br />
&nbsp; &nbsp;Loaded: not-found (Reason: No such file or directory)<br />
&nbsp; &nbsp;Active: inactive (dead)</p>
<p>but /etc/init.d/emonhub status gives</p>
<p>[ ok ] Checking OpenEnergyMonitor emonHub: emonhub process is running.</p>
<p>Clearly as I&#39;m getting the feed data in emoncms, emonhub is working. What&#39;s are things to check?</p>
<p>Thanks,</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12394.html" class="topic-previous" title="Go to previous forum topic">‹ Emoncms.org site doesn&#039;t support iframe anymore [SOLVED]</a>
              <a href="10065.html" class="topic-next" title="Go to next forum topic">How to send feed data from emoncms to emonGLCD? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-40709"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6548.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="billvolz&#039;s picture" title="billvolz&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: enable/configure redis and swiftmailer + emonhub not start at boot</h3>

    <div class="submitted">Submitted by <a href="../user/6548.html" title="View user profile.">billvolz</a> on Tue, 29/03/2016 - 18:31.</div>
    <div class="content">
     <p>The redis issue seems resolved - just had to enable it in settings.php</p>
<p>The Swiftmail issue is still there. Emoncms cannot find the swiftmail code. The log file shows this:</p>
<p>ERROR|email.php|check() Could not find SwiftMailer, email functions are ignored.</p>
<p>And the emonhub&nbsp;service problem is still with me.</p>
<p>Any help or pointers would be appreciated.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41057"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6548.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="billvolz&#039;s picture" title="billvolz&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: enable/configure redis and swiftmailer + emonhub not start at boot</h3>

    <div class="submitted">Submitted by <a href="../user/6548.html" title="View user profile.">billvolz</a> on Mon, 11/04/2016 - 06:40.</div>
    <div class="content">
     <p>Ok I figured out Swift - in the /var/www/emoncms/Lib/email.php I had to change the path to the location of swift_require.php, in this case /usr/share/php.</p>
<p>I also had to set the parameters for sending email&nbsp;for the smtp_email_settings in settings.php. Works fine now.</p>
<p>It would have been far easier if you&#39;d send mail via the mail command - almost eveyone has&nbsp;that installed. A simple system() command with the mail command would have worked just fine.</p>
<p>But what I&#39;m really after is to get an email notice if I don&#39;t get an update from emonhub in some specified period, say 60 seconds.My understanding is the Events module is supposed to be able to do that, but it&#39;s not being maintained.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41074"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: enable/configure redis and swiftmailer + emonhub not start at boot</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 11/04/2016 - 16:44.</div>
    <div class="content">
     <p>The event module isn&#39;t supported anymore, but there is the beginnings of a replacement built into the core of emoncms now. There is an event process that can email you based on various criteria defined using the logic processes introduced by chaveiro.</p>
<p>You won&#39;t be able to <em>&quot;get an email notice if I don&#39;t get an update from emonhub in some specified period&quot; </em>per se, as emoncms&nbsp;doesn&#39;t log the origin. But you can set it up for any/all of the inputs arriving from emonhub, which is probably what you want.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41079"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6548.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="billvolz&#039;s picture" title="billvolz&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: enable/configure redis and swiftmailer + emonhub not start at boot</h3>

    <div class="submitted">Submitted by <a href="../user/6548.html" title="View user profile.">billvolz</a> on Mon, 11/04/2016 - 20:15.</div>
    <div class="content">
     <p>Where is this event process in the code? I&#39;d like to take a look at it.</p>
<p>And I really do want to be notified if emonhub doesn&#39;t send any data. I&#39;m not that interested in the data itself, just that I hadn&#39;t gotten any recently. It appears that emonhub init.d&nbsp;service scripts are not compatible with Jessie systemd scripts - it does not start upon boot but I can start it manually. Yes, I&#39;ve enabled it with update-rc.d.</p>
<p>The receiver and emontx&nbsp;are&nbsp;separated by&nbsp;50 feet and several walls and a floor. When I moved the Raspberry to it&#39;s current location in a closet&nbsp;downstairs I was getting intermittent messages until I reoriented the antenna which gave me an additional 10dB of signal. If it drops out again I want to know.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41080"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: enable/configure redis and swiftmailer + emonhub not start at boot</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 11/04/2016 - 20:17.</div>
    <div class="content">
     <p>The eventp&nbsp;module is in the &quot;Modules&quot; directory of emoncms.</p>
<p>Emonhub&nbsp;is only supposed to forward the data passed to it. If no data is passed to emonhub, it cannot forward anything, so monitoring emonhub isn&#39;t the solution. The absence of data arriving from the emonTx&nbsp;is what you need to be alerted to, and that can be easily achieved by using the eventp&nbsp;process. This will alert you if the RF packets stop being forwarded by emonhub, whether that be due to emonhub&nbsp;not starting, or because transmissions have dropped out.</p>
<p>The init script is currently the only supported way of starting emonhub. The &quot;init.d&quot; method is supported in Jessie, as the system.d method is backwards compatible. It&#39;s used in the emonhub installer script, the OEM emonSD SDcard image, and it&#39;s the tried and tested method recommended in the install guides. I have used it myself.</p>
<p>The only 2 cases I can recall that emonhub wouldn&#39;t start correctly at boot both came from the install scripts being run as root rather than user pi, the specific reason was never confirmed as those users then chose to reinstall using the user pi.</p>
<p>I suspect, but cannot be sure, that it may be the case here too, since all your quoted commands are absent of any use of &quot;sudo&quot;, The link you provide is to a clone of the original &quot;docs&quot; and has&nbsp;not been updated for some time (9th of Dec 2015 for the docs dir). Whilst I do not think there have been any significant changes in that time, I don&#39;t know why you wouldn&#39;t be using the official and up&nbsp;to date version. Regardless, I have just checked and the same line is used to install emonhub. It references the homedir which if you did run as a different user, will be different.</p>
<p>I suspect the files may not be&nbsp;where they are expected to be, hence the <em>&quot;Loaded: not-found (Reason: No such file or directory)&quot;. </em>To get emonhub to (very reliably) start at boot, you can either reinstall as intended, or perhaps just&nbsp;locate the emonhub directory&nbsp;and try editing /etc/default/emonhub so the init script can find the files or move the emonhub dir to /home/pi/. If this is not the case, it could be a permissions issue. Did you use the installer or create the&nbsp;emonhub&nbsp;system user?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41088"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6548.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="billvolz&#039;s picture" title="billvolz&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: enable/configure redis and swiftmailer + emonhub not start at boot</h3>

    <div class="submitted">Submitted by <a href="../user/6548.html" title="View user profile.">billvolz</a> on Tue, 12/04/2016 - 00:22.</div>
    <div class="content">
     <p>I uninstalled emonhub. Reinstalled as user pi using this command from the latest install page.</p>
<p>
git clone <a href="https://github.com/emonhub/dev-emonhub.git" title="https://github.com/emonhub/dev-emonhub.git">https://github.com/emonhub/dev-emonhub.git</a> ~/dev-emonhub &amp;&amp; ~/dev-emonhub/install<br />
&nbsp;</p>
<p>rebooted and emonhub did not start. I tried to start as user pi and it said I needed to be root to start it. service emonhub start failed again as root. but /etc/init.d/emonhub start worked. The link in /etc/init.d/emonhub is owned by root while the file it points to is owned by pi.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41128"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: enable/configure redis and swiftmailer + emonhub not start at boot</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 13/04/2016 - 22:36.</div>
    <div class="content">
     <p>You don&#39;t need to BE root, using &quot;sudo&quot; elevates&nbsp;the user pi to have root privileges. I can only assume there was something left from the failed install that has thwarted this latest attempt,&nbsp;I think you will need to look at the installer script and step through it, making sure each part is in place with the correct permissions.&nbsp;so few users have had any sort of trouble&nbsp;with the installer that&nbsp;this is&nbsp;not really a scenario I have off-hand experience of&nbsp;I&#39;m afraid.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12425"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-_QUFwGJ5SN6BO7Rqb2JxDXDpNSnTbMH3NfYnCgTjTg0" value="form-_QUFwGJ5SN6BO7Rqb2JxDXDpNSnTbMH3NfYnCgTjTg0"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
