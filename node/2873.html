<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2873 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:05:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonBase caching data for emoncms while ADSL down | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonBase caching data for emoncms while ADSL down</h3>
        <span class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Wed, 25/09/2013 - 16:59</span>
        <div class="content"><p>Hey Guys,</p>
<p>&nbsp;</p>
<p>I noticed today when my internet connection went down for the past 2 days, my local emoncms&nbsp;still captures data but, it does not cache and update the emoncms.org when the ADSL returns ?, is there a setting that I can enable for the local enomcms&nbsp;to push data that it missed while the ADSL was down and if not is this something we could look at implementing ?</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2981.html" class="topic-previous" title="Go to previous forum topic">‹ Newbie wants to ask a few questions before starting</a>
              <a href="2962.html" class="topic-next" title="Go to next forum topic">EmonCMS data incorrect ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-15425"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase caching data for emoncms while ADSL down</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Thu, 26/09/2013 - 10:22.</div>
    <div class="content">
     <p>Hi.</p>
<p>There is nothing done currently regarding this, and no plan to my knowledge.</p>
<p>The alternative gateway I&#39;m working on does this partially:</p>
<p><a href="https://github.com/Jerome-github/oem_gateway" title="https://github.com/Jerome-github/oem_gateway">https://github.com/Jerome-github/oem_gateway</a></p>
<p><a href="https://github.com/Jerome-github/oem_gateway/issues/6" title="https://github.com/Jerome-github/oem_gateway/issues/6">https://github.com/Jerome-github/oem_gateway/issues/6</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15440"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4277.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4277.jpg" alt="warlock&#039;s picture" title="warlock&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase caching data for emoncms while ADSL down</h3>

    <div class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Fri, 27/09/2013 - 09:46.</div>
    <div class="content">
     <p>Hi Jerome,</p>
<p>&nbsp;</p>
<p>Looks good, I have a suggestion why don&#39;t you create a table in the database that records the raw data from the last good transmission to the next good transmission, and truncate when transmission s good, or &nbsp;a threshold if no data is uploaded after 5 attempts start logging to the DB, always attempt to upload the oldest data first, once all is successful truncate the table,</p>
<p>The only thing is the public emoncms needs to understand the values received are historic first. I am not sure on how received data is stored, does the local emoncms&nbsp;transmit with the data with a timestamp for that row or is the timestamp created on the receiving&nbsp;cms when it receives data ?</p>
<p>I have 2 monitoring systems in place while I fine tune the emonTX, I use THEOWL Intuition-PV as a secondary, I must add though THEOWL can be anywhere from 5% to 20% so it&#39;s actually useless which is why I got the emonTX, however during the 2 day while my internet was off THEOWL buffered all data till it returned and when it did returned it uploaded the data, so I have no gap&#39;s in my feeds, which is pretty cool and why I prompted this discussion.</p>
<p>Unfortunately I live in a country where the ADSL service is really shocking and unreliable.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15515"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase caching data for emoncms while ADSL down</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 01/10/2013 - 08:23.</div>
    <div class="content">
     <p>As Jerome mentioned the python gateway does this by storing the unsent values in RAM this is clever as it means you wont be using up SD card writes on your raspberrypi.</p>
<p>You could use the python gateway instead of raspberrypi_run.php to both direct data to you local emoncms installation and to forward the data with the buffering to emoncms.org or other remote server.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15776"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4277.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4277.jpg" alt="warlock&#039;s picture" title="warlock&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase caching data for emoncms while ADSL down</h3>

    <div class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Fri, 18/10/2013 - 12:36.</div>
    <div class="content">
     <p>Hi Jerome</p>
<p>With this last outage of emoncms, the buffer worked like a charm the only thing is it only lasted for about 1 hour and outage was 21+ hours,&nbsp;</p>
<p>it would be awesome if we can rectify or come up with a solution&nbsp;to ensuring that we loose zero data over long outages.</p>
<p>An idea I had was to send the data to a proxy service, either locally to another PC or on the internet, this proxy service would then attempt to upload the data once the connection is re established. Or on failure&nbsp;keep details in memory and once buffer size has reached 1000 set system to ipe-rw and flush the buffer to a file then set the system to ipe-ro again, and continue doing this until such time a connection is reestablished, Once the connection is resolved, flush the file to the live servers and delete the file. ?</p>
<p>Shot</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15871"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase caching data for emoncms while ADSL down</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 22/10/2013 - 12:08.</div>
    <div class="content">
     <p>Hi.</p>
<p>Normally, you should have lost everything except the values from the end of the interruption period. In other words, I assume you lost all values except for the last hour of the interruption. If not, please tell me, it would mean I missed something.</p>
<p>The easy and short-term solution is to increase the (hardcoded) buffer size here:</p>
<p><a href="https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewaybuffer.py#L106" title="https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewaybuffer.py#L106">https://github.com/Jerome-github/oem_gateway/blob/master/oemgatewaybuffe...</a></p>
<p>1000 stands for 1000 requests, regardless of the number of samples in the request. This is totally arbitrary, I didn&#39;t think of what kind of RAM usage it represents. Perhaps 100 000 is totally feasible. I&#39;d need to look into python&#39;s string representation.</p>
<p>We could add this as a parameter, but I&#39;m not sure it is so useful.</p>
<p>I didn&#39;t think of sending to another server, as the use case I was thinking of was rather a local network issue, but why not ?</p>
<p>The file buffer was my next option. See here:</p>
<p><a href="https://github.com/Jerome-github/oem_gateway/issues/6" title="https://github.com/Jerome-github/oem_gateway/issues/6">https://github.com/Jerome-github/oem_gateway/issues/6</a></p>
<p>Yes, this could mean having to &quot;ipe-rw&quot;, which means give the user that runs the gateway the privilege to do so.</p>
<p>I may not follow every thread on the forum, so feel free to comment on Github about this issue to be sure I&#39;m notified.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15877"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4277.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4277.jpg" alt="warlock&#039;s picture" title="warlock&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase caching data for emoncms while ADSL down</h3>

    <div class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Tue, 22/10/2013 - 15:24.</div>
    <div class="content">
     <p>Thanks Jerome,</p>
<p>I shall use githib going forward, you implementation&nbsp;works 100%, I am purely looking to see if we can&#39;t buffer to loger periods or idefinatly&nbsp;till connectivity is restored. I&#39;ll take a look at the hard buffer and see how this effects the sytem&nbsp;if we increase it to 100 000.</p>
<p>&nbsp;</p>
<p>Thanks again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15880"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase caching data for emoncms while ADSL down</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 22/10/2013 - 15:57.</div>
    <div class="content">
     <p>I think 100 000 is probably safe for a 24h break. Hard to tell as it depends on the data and all, but a quick and conservative estimation makes me think it should be fine.</p>
<p>Actually, it would be interesting to use the resource module to see how the memory usage grows when the link is down (easy to simulate: just change the target URL to a dummy one).</p>
<p><a href="http://docs.python.org/2/library/resource.html" title="http://docs.python.org/2/library/resource.html">http://docs.python.org/2/library/resource.html</a></p>
<p><a href="http://pythonforbiologists.com/index.php/measuring-memory-usage-in-python/" title="http://pythonforbiologists.com/index.php/measuring-memory-usage-in-python/">http://pythonforbiologists.com/index.php/measuring-memory-usage-in-python/</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15889"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4277.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4277.jpg" alt="warlock&#039;s picture" title="warlock&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase caching data for emoncms while ADSL down</h3>

    <div class="submitted">Submitted by <a href="../user/4277.html" title="View user profile.">warlock</a> on Wed, 23/10/2013 - 09:23.</div>
    <div class="content">
     <p>I have set the buffer to 100 000, I created a fake enter to emoncms in my hosts file to simulate a network issue,</p>
<p>After 3 hours I hashed the new entry out and it seemed fine, data is being put back into emoncms, the only issue I see here is that it&#39;s take a long time, eg. to buffer out the 3 hours of downtime to emoncms.org took about 6 hours to complete.&nbsp;</p>
<p>Memory usage on the Pi was negligible. I am going to test again, this time I&#39;ll try 12 hours.</p>
<p>My only concern is the time it takes to catch up. basically meaning I can&#39;t have a power outage for this period. but that said it&#39;s still better than nothing.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2873"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-OZn0X7BHVnt_g9jbUEOAIgFyfaPR3hhW-dOdj2VZyMs" value="form-OZn0X7BHVnt_g9jbUEOAIgFyfaPR3hhW-dOdj2VZyMs"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
