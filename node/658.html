<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/658 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:34:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonTX autodetecting and autocalibration of CT&#039;s | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonTX autodetecting and autocalibration of CT&#039;s</h3>
        <span class="submitted">Submitted by Guest on Sat, 05/05/2012 - 16:28</span>
        <div class="content"><p>I&#39;ve just modified the emonTX sketch for autodetecting CT&#39;s and it works well with the CT&#39;s i&#39;m using (SCT-013-030).</p>
<p>The CT&#39;s need to be plugged in but not connected to any live wire (so in theorie it should read a port value of 512 = Vref/2 )</p>
<p>In the setup part it reads the CT&#39;s ports (3, 0 and 1) and checks if the measured value is above 509. It tries this for about 30 seconds per port because after applying power for the first time to the emonTX the port value is building up and not available at first read. It could take a while before the analog ports are in &#39;rest&#39; .</p>
<p>If a CT is found its sets the corresponding CTx value to 1 and sends out the value instead of 0 (it will sent out 0 if a CT is not connected) in the RF string.</p>
<p>Next thing I want to do is some sort of auto-calibration because i&#39;ve noticed that each sct-013-030 has different offset when measuring the same source !</p>
  <div class="forum-topic-navigation clear-block">
          <a href="651.html" class="topic-previous" title="Go to previous forum topic">‹ emonTX polling from emonBase instead of pushing values ?</a>
              <a href="657.html" class="topic-next" title="Go to next forum topic">Time setting on emonglcd ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-4236"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX autodetecting and autocalibration of CT's</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 05/05/2012 - 18:53.</div>
    <div class="content">
     <blockquote><p>&quot;in theorie it should read a port value of 512 = Vref/2 )&quot;</p>
</blockquote>
<p>Not so in practice. The divider chain resistors supplied in the emonTx kit are +/- 10% tolerance, so you could have a quiescent value that lies between 460 and 563, or if you used 1% tolerance resistors between 507 and 517.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4237"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="prensel&#039;s picture" title="prensel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX autodetecting and autocalibration of CT's</h3>

    <div class="submitted">Submitted by prensel (not verified) on Sat, 05/05/2012 - 19:52.</div>
    <div class="content">
     <p>Yes i know, with the standard 10% resistors it will give a wide range of possible &#39;error&#39; , thats why i&#39;m considering changing the chain resistors to 1% and set the trigger value on 507 instead of 509.</p>
<p>For now it seems to work with 3 different emonTX&#39;s with the 509 value and 10% R but to get it more reliable i&#39;ll be using 1% R.</p>
<p>Is there another way of detecting an attached CT ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4249"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX autodetecting and autocalibration of CT's</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 06/05/2012 - 16:11.</div>
    <div class="content">
     <p>Why do you want to do this? Connecting the CTs should be a one-time exercise, done when you install the monitor. Unplugging a CT might be OK when it has an internal burden, but when it has not, unless you first remove it from the current-carrying conductor, you will have high voltages that might damage the winding and might hurt. (A CT of the size you have probably will not transfer enough energy to be fatal, but I would not want my fingers anywhere near. It is standard practice to <strong>short-circuit </strong>a CT if it has to be, or if there is a possibility that it might be, disconnected from the burden).</p>
<blockquote><p>&quot;Next thing I want to do is some sort of auto-calibration&quot;</p>
</blockquote>
<p>Are you confusing gain and offset? The offset is removed in software by the high pass filter in EmonLib, it will automatically self-adjust even if the offset drifts over time. The calibration constants in the software adjust the system gain, and you cannot measure that without a known primary current flowing. So the only way that you could auto-calibrate would be to connect a known load and then enter a calibration routine (a push-button labelled &quot;Calibrate&quot;?).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4253"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="prensel&#039;s picture" title="prensel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX autodetecting and autocalibration of CT's</h3>

    <div class="submitted">Submitted by prensel (not verified) on Sun, 06/05/2012 - 19:57.</div>
    <div class="content">
     <p>Well for the option of autodetection of ct&#39;s:</p>
<p>My primary use for the emon system would be at first for measuring the AC output of PV systems. I&#39;m building a 15.000Wp PV system spread over different places and some systems are equiped with just one 500W inverter at this time but could be expanded with more inverters and by having an autodetection option i just have to plugin another CT, and i&#39;m ready to go without software modification. For the CT&#39;s not connected the emontx just sents out value 0 instead of the random analog port value. When it detects a CT on startup it uses the real value instead of 0. So finaly i would have 10 emonTX with 30 CT&#39;s connected for the AC side of the system. I&#39;m also thinking of setting up emontx for measuring the DC side of my systems.</p>
<p>I&#39;ve modified the emonbase sketch so that it auto picks up another or new emonTX and start pushing out values power1,power2,power3, Vcc to the same pachube/emoncms feed used by the other emontx&#39;s&nbsp; by preceding the values with the nodeID.</p>
<p>For autocalibration:</p>
<p>I&#39;ve noticed there is some spread in accuracy between similiar type of CT&#39;s.&nbsp; The correction factor in the sketch is just right for that particular CT but not for others although they are the same type. I already figured i need some sort of known current to calibrate the CT&#39;s by modifying the constant value in the sketch and write a new autocalibrated factor to EEPROM and use that for the CT connected.</p>
<p>Another thing i&#39;m working on is how to differentiate between my emontx and a &#39;strange&#39;&nbsp; one. Say for example my neighbour is also going to use an emontx/emonbase for his PV system and i dont want to pickup his emontx values but just mine..</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4255"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX autodetecting and autocalibration of CT's</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 06/05/2012 - 22:47.</div>
    <div class="content">
     <p>Ah, now I understand, thanks. (I was a bit concerned that you might have been on a wild goose chase).</p>
<blockquote><p>&quot;The correction factor in the sketch is just right for that particular CT but not for others although they are the same type.&quot;</p>
</blockquote>
<p>How much difference are you seeing? It is probably manufacturing tolerances, and it might be worth checking on the burden resistor if you are using the 30 A with a built-in burden, and if necessary replacing that with a 1% type. When I tested some 100 A CTs (current output, no internal burden), I had 1 from an early batch and 2 from a later batch. The second pair were almost indistinguishable electrically, but the first one had been underwound by nearly 8%. I would have thought that someone could wind 2000 turns to within a few, but 150 out is a bit much. I don&#39;t think that could have been due to manufacturing tolerance and would not have been surprised if I had been told it was done deliberately to save on copper.</p>
<p>Whatever the cause turns out to be, my inclination given your setup would be to trim the burden resistor (by adding high values in parallel) to make every CT develop the same voltage at a known current (say at around 80% of maximum to stay well out of saturation). Then you have one standard calibration for all.</p>
<blockquote><p>&quot;how to differentiate between my emontx and a &#39;strange&#39;&nbsp; one&quot;</p>
</blockquote>
<p>I think the &quot;network group&quot; does that for you. Just make sure your neighbour uses a different group (or different RF frequency).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="prensel&#039;s picture" title="prensel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX autodetecting and autocalibration of CT's</h3>

    <div class="submitted">Submitted by prensel (not verified) on Mon, 07/05/2012 - 07:27.</div>
    <div class="content">
     <p>I&#39;m using either the SCT-013-000, the SCT-013-030 or the TA17L-04 as CT&#39;s at this time.</p>
<p>Because only the SCT-013-030 has the burden R built in, so for the other two i took the burden out of the emontx and moved them into the CT&#39;s jackplug: i&#39;ll never get &#39;hit&#39;&nbsp; by a loose CT on active current because of the always built-in burden and i can use the same emontx for all kinds of different CT&#39;s without soldering. Also for detecting any attached CT&#39;s i had to remove the burden from the emontx otherwise it would always have a port value of around 512 even without CT attached. I&#39;m now working on using 1% or even 0.1% R for the burden and divider chain R&#39;s and have to do some more testing to get a clear picture of the real differences of the CT&#39;s.</p>
<p>&nbsp;</p>
<p>About the network group: i&#39;ve thought about that but its just a matter of time until all of my neighbours have an emontbase/emontx floating around with their networkgroups and nodeID&#39;s (just in theorie ;-)) so it will ruin my setup eventually. I&#39;ll need to make something better with some sort of handshake at first contact between emonTX and emonBase and use that for all further communication.</p>
<p>I&#39; m thinking of a having all &#39;out of the box virgin&#39; emontx&#39;s working on nodeID 1 and listening to an emonbase in the same network who will provide them their final nodeID, anything other then 1 and not in use already (by pressing pairing buttons or something) the final nodeID gets stored into the emontx EEPROM and used from that point on. Still this would not prevent any neighbour ruining my system so i will use some sort of key too which the emontx will use in the RF string when sending data.. Only known nodeID&#39;s with known keys will be accepted by the emonbase. I did some testing with the aProtocol and XRF modules but not with RFM sofar so and dont know (yet) if there are any other means of &#39;pairing&#39;&nbsp; emontx and emonbase.</p>
<p>&nbsp; &nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4328"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="prensel&#039;s picture" title="prensel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX autodetecting and autocalibration of CT's</h3>

    <div class="submitted">Submitted by prensel (not verified) on Wed, 09/05/2012 - 20:39.</div>
    <div class="content">
     <p>In my quest for an emonTX with autodetecting and autocalibrating CT&#39;s i took a different route.</p>
<p>Sure the autodetecting did work but i was not happy with it.</p>
<p>The autocalibrating was probably not feasable at all so i let that idea go.</p>
<p>I&#39;ve now decided to have the emonTX be configurable from the serial port (FTDI)&nbsp; for the existence of CT&#39;s and their corresponding calibation factors. Much easier to setup, one sketch will fit all versions of CT&#39;s because you can set them later on and also the nodeID and group id are configurable. The config items are saved in EEPROM.</p>
<p>If someone is interested i can sent/upload the sketch somewhere.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4337"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTX autodetecting and autocalibration of CT's</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 10/05/2012 - 09:08.</div>
    <div class="content">
     <p>Hi Prensel,</p>
<p>That sounds very interesting. It would be great if you could post up your code up on the forum.&nbsp;</p>
<p>&#39;pairing&#39; an emonTx to a certian emonBase&nbsp;is not something we&#39;ve touched on yet but am away it will be needed in the future.&nbsp;</p>
<p>We are currently in the design phase for an emonTx SMT, I&#39;m considering including a push button which could be configured for pairing.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/658"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-v9tiqz0BM3V0sJcuMSR69-ERUTUSeSZupq7Vrc_dyDg" value="form-v9tiqz0BM3V0sJcuMSR69-ERUTUSeSZupq7Vrc_dyDg"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/658 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:34:46 GMT -->
</html>
