<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11087 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:58:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>
        <span class="submitted">Submitted by <a href="../user/8547.html" title="View user profile.">SeksakUoN</a> on Fri, 07/08/2015 - 13:04</span>
        <div class="content"><p>Hi&nbsp;</p>
<p>I have purchased the emonTxV3 and raspberry pi2 (the set of EmonTxV3) with the pre-loaded software to log the data from a school. And the problem is if the school did not have an internet access, can we log the data (power, voltage, energy) into a USB memory stick connected to the raspberry pi? I am a new user so I am not familiar with the raspberry pi. I have found there are so many files and sort codes on the raspberry pi and I have not idea&nbsp;where to start.&nbsp;Could anyone help me with this please?</p>
<p>Many thanks</p>
<p>&nbsp;</p>
<p>Seksak</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11168.html" class="topic-previous" title="Go to previous forum topic">‹ EmonCMS - how to move from vlow-write to standard 8.5</a>
              <a href="11165.html" class="topic-next" title="Go to next forum topic">EmonPi Capabilities ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-33102"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 07/08/2015 - 13:34.</div>
    <div class="content">
     <p>You&#39;ll need to tell us more about what you want to do with the data, if using a data stick to pass from one machine to another you may&nbsp;get&nbsp;gaps in the data.etc.</p>
<p>The pre-loaded image includes a server and emoncms&nbsp;so if you attach a monitor and keyboard, which I guess you must if you have no network. You can just open a browser on the Pi and the &quot;localhost/emoncms&quot; website will be available on that Pi so you can create dashboards and graphs etc and the data will be coming in live from the emonTx.</p>
<p>Paul&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33106"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8547.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="SeksakUoN&#039;s picture" title="SeksakUoN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/8547.html" title="View user profile.">SeksakUoN</a> on Fri, 07/08/2015 - 14:03.</div>
    <div class="content">
     <p>Hi Paul&nbsp;</p>
<p>Many thanks for your response, I want to use the logged power data (which is the school power profile)&nbsp;to&nbsp;design how big PV panels and energy storage for the school are required and for the research study. The equipment will be installed at the school as a standalone equipment and the data will be logged into the USB stick&nbsp;in the form of a text file or a CSV file. Every one or two months I will go to a school to collect the data from the USB stick.&nbsp;I have all software ( from openenergymonitors)&nbsp;downloaded into emonTxV3 and raspberry pi2 and it works well and shows something on the emoncms website. I just need the raspberry pi2 to send the data to the USB stick and I do not know how to modify the exist code at all. Do you have know&nbsp;how to add any commands or sort codes so that the raspberry pi can write the logged data into the USB stick at all? (it does not matter that much about the delay of the data sending)</p>
<p>Many thanks</p>
<p>Seksak</p>
<p><i>Duplicate post deleted - Moderator (RW)</i></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33112"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 07/08/2015 - 15:17.</div>
    <div class="content">
     <p>What is your timescale ?&nbsp;</p>
<p>There is no current capability for this but I have in the past had a &quot;csv reporter&quot; functioning with emonHub&nbsp;that would suit your needs, emonHub has changed since it was last used so I will need to locate,&nbsp;revive it and make some changes.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33189"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8547.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="SeksakUoN&#039;s picture" title="SeksakUoN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/8547.html" title="View user profile.">SeksakUoN</a> on Mon, 10/08/2015 - 14:13.</div>
    <div class="content">
     <p>Hi Paul&nbsp;</p>
<p>I am planning to install the equipment by the end of August so if you could help me with this, I would appreciate it.&nbsp;</p>
<p>Many thanks</p>
<p>&nbsp;</p>
<p>Seksak</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33203"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 10/08/2015 - 20:12.</div>
    <div class="content">
     <p>I&#39;ll see what we can do.&nbsp;No promises, but I&#39;m sure we can knock something up, if you are not too fussy :-)</p>
<p>It will however,&nbsp;be for &quot;original&quot;&nbsp;emonHub, can you confirm which version you have? I think the best option would be to just have emonhub&nbsp;on a read-only OS, simpler to set up, less going on and better suited to a remote un-supervised install.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33270"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8547.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="SeksakUoN&#039;s picture" title="SeksakUoN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/8547.html" title="View user profile.">SeksakUoN</a> on Wed, 12/08/2015 - 09:34.</div>
    <div class="content">
     <p>Hi Paul</p>
<p>I have emonTX V3 433MHz&nbsp;and raspberry pi2. The programme which was downloaded into the raspberry pi2 is emonSD-17Jun2015.&nbsp;</p>
<p>Seksak</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33420"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5911.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gggsartori&#039;s picture" title="gggsartori&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/5911.html" title="View user profile.">gggsartori</a> on Tue, 18/08/2015 - 12:32.</div>
    <div class="content">
     <p>Hi,</p>
<p>I&#39;ve added a class to emonhub that writes csv files with data received from emontx and a emonlcd.</p>
<p>It is compatible with current emonhub and ads writing file capability plus interface with arduino that receives data from old oregon scientific sensors I had home</p>
<p>It produces one file per day and per node.</p>
<p>If you are interested I can share the code.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33421"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8547.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="SeksakUoN&#039;s picture" title="SeksakUoN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/8547.html" title="View user profile.">SeksakUoN</a> on Tue, 18/08/2015 - 15:21.</div>
    <div class="content">
     <p>Hi&nbsp;</p>
<p>Certainly, I am very interested in that. Could you please share the code with me? Does&nbsp;the code run on raspberry&nbsp;Pi?</p>
<p>&nbsp;</p>
<p>Many thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33443"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7546.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="humphrey&#039;s picture" title="humphrey&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/7546.html" title="View user profile.">humphrey</a> on Wed, 19/08/2015 - 11:46.</div>
    <div class="content">
     <p>This is the code I use, it is very rough and can be much nicer, but just in case it is useful for someone:</p>
<p>Append to emonhub_reporter.py:</p>
<p>(/home/pi/emonhub/src/emonhub_reporter.py)</p>
<blockquote><p>
class USBReporter(EmonHubReporter):</p>
<p>&nbsp;&nbsp;&nbsp; def __init__(self, reporterName, queue, **kwargs):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;&quot;&quot;Initialize reporter</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;&quot;&quot;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # Initialization<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; super(USBReporter, self).__init__(reporterName, queue, **kwargs)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # add or alter any default settings for this reporter<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._settings.update({&#39;file&#39;: &#39;&#39;})</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # This line will stop the default values printing to logfile at start-up<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._settings.update(self._defaults)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # set an absolute upper limit for number of items to process per post<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._item_limit = 250</p>
<p>&nbsp;&nbsp;&nbsp; def _process_post(self, databuffer):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;&quot;&quot;Save data in csv file.&quot;&quot;&quot;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # databuffer is of format:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # [[timestamp, nodeid, datavalues][timestamp, nodeid, datavalues]]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # [[1399980731, 10, 150, 250 ...]]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f = open(self._settings[&#39;file&#39;], &#39;a&#39;)&nbsp; #open file for appending<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer = csv.writer(f)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; writer.writerows( databuffer )<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return True<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except IOError,v:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._log.warning(&quot;IO error upon writing to USB drive: &quot;+self._settings[&#39;file&#39;]+&#39;error code&#39;+str(v[0])+str(v[1]))<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finally:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f.close()<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; except:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pass</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
</blockquote>
<p>&nbsp;</p>
<p>And in the config (/boot/emonhub.conf)</p>
<blockquote><p><hints id="hah_hints"></hints></p>
<p>[reporters]</p>
<p># This reporter sends data to emonCMS<br />
#[[emonCMS]]</p>
<p>#etc</p>
<p>#usb logging<br />
[[usb]]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Type = USBReporter<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [[[init_settings]]]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [[[runtimesettings]]]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file = /media/usb/data.csv</p>
<p>&nbsp;</p>
</blockquote>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33469"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5911.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gggsartori&#039;s picture" title="gggsartori&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/5911.html" title="View user profile.">gggsartori</a> on Thu, 20/08/2015 - 09:28.</div>
    <div class="content">
     <p>My solution was more complicated, I think this one is better, I would just add a date in the file name to avoid files to big to handle, instead of</p>
<p><em>f = open(self._settings[&#39;file&#39;], &#39;a&#39;)&nbsp; #open file for appending</em></p>
<p>use:</p>
<p><em>f = open(</em><br />
<em>date.today().strftime(&quot;%y-%m-%d&quot;) + &#39;_&#39; +</em><br />
<em>self._settings[&#39;file&#39;] + , &#39;a&#39;)&nbsp; #open file for appending</em></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33470"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7546.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="humphrey&#039;s picture" title="humphrey&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/7546.html" title="View user profile.">humphrey</a> on Thu, 20/08/2015 - 09:50.</div>
    <div class="content">
     <p><hints id="hah_hints">That&#39;s a good idea for certain situations!</hints></p>
<p>I forgot to mention, you also need to import the csv module. So at the top of the emonhub_reporters.py:</p>
<p><em>#csv module for USB LOGGING<br />
import csv</em></p>
<p>By the way, I use the word &#39;USB&#39; a lot in the code, of course this code will work for any location not only your USB drive. So I should have called the reporter a CSVreporter instead.</p>
<p>To check if it is working you can do a:</p>
<p><em>tail -f /media/usb/data.csv</em></p>
<p>in your command line (replace &#39;data.csv&#39; with the correct filename), you should see the data being added to the csv file.</p>
<p>If it is not working (possibly the emonhub daemon has no access to the file) you can check the emonhub log with this command line command:</p>
<p>tail -f /var/log/emonhub/emonhub.log</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33471"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8547.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="SeksakUoN&#039;s picture" title="SeksakUoN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/8547.html" title="View user profile.">SeksakUoN</a> on Thu, 20/08/2015 - 10:18.</div>
    <div class="content">
     <p>Hi&nbsp;</p>
<p>Thank you for your help. But I need some more instruction for how to do it then. So I have tried as:</p>
<p>1.&nbsp;I do not actually have the&nbsp;&nbsp;emonhub_reporter.py file in the folder and therefore I have created it and put all the code on and save the file as&nbsp;&nbsp;emonhub_reporter.py at&nbsp;/home/pi/emonhub/src/.</p>
<p>2. Then I have added the code [reporters] into the config file which is emonhub.conf.</p>
<p>Is this the right way to do? How to test the code is working?&nbsp;Do I need to type&nbsp;any command on LXTerminal to activate the code at all?</p>
<p>(I have done as 1 and 2 but there is no csv file on the USB stick at all)</p>
<p>Please advise</p>
<p>Many thanks&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33472"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7546.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="humphrey&#039;s picture" title="humphrey&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/7546.html" title="View user profile.">humphrey</a> on Thu, 20/08/2015 - 10:36.</div>
    <div class="content">
     <p><hints id="hah_hints">Apparently the source code has moved.. you need to find where the original file is located and then replace that with you modified code (after making a backup copy of the original).</hints></p>
<p>Try to issue the command</p>
<p><em>locate emonhub_reporter </em></p>
<p>in your LXTerminal to locate the original file.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33473"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 20/08/2015 - 10:48.</div>
    <div class="content">
     <p>Using a custom reporter is how I have done it in the past, the concept is pretty much the same. I didn&#39;t use the csv module however so I will take a look at that.</p>
<p>Interesting point about the log file naming, I haven&#39;t used this for a prolonged time so hadn&#39;t experienced a problem with file size, but it is true that even the 5mb logfiles are cumbersome to handle on a Pi. do you then need to open each file or do you have a way of opening and&nbsp;concatenating the contents of multiple files in one go?&nbsp;</p>
<p>Something else to consider is writing to disc in blocks of data to prevent SDcard (or usb stick) failure, due to the small data size the packets get rewritten several times until that on-disc-block&nbsp;is full, for example by writing on&nbsp;every 10th frame increases disc life expectancy ~10x,</p>
<p>@Seksak - These examples are for original emonHub not the emon-pi variant, you will need to switch to another&nbsp;image or create your own <a href="10163.html">Raspberry Pi 2 pre-built SD card image (emonSD-13-03-15.img)</a> &nbsp;( <a href="11139.html">also see this thread for some links</a> ) as the emon-pi variant doesn&#39;t have reporters and the&nbsp;<span style="line-height: 20.7999992370605px;">imports/</span><span style="line-height: 1.6;">threading/messaging is all very different.</span></p>
<p><span style="line-height: 1.6;">Paul</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33475"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7546.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="humphrey&#039;s picture" title="humphrey&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/7546.html" title="View user profile.">humphrey</a> on Thu, 20/08/2015 - 14:00.</div>
    <div class="content">
     <p>Interesting thoughts about the blocks of data being rewritten each time. The block size is probably 512 bytes isn&#39;t it?</p>
<p>What is your implementation of this 10th frame solution?</p>
<p>I guess something like this might work:</p>
<p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # add or alter any default settings for this reporter<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._settings.update({&#39;interval&#39;:10, &#39;batchsize&#39;: 100, &#39;file&#39;: &#39;&#39;})</em></p>
<p>In case your data interval is 1 second, this will result in 10 datapoints written at once I guess?</p>
<p>I am not sure about the batchsize, but after quickly scanning through the code it seemed like it defaults at 1 and is a bottleneck for the number of datapoints that is saved at once. The EmonCMS reporter also has batchsize at 100.</p>
<p>You could even increase the interval to make sure it is writing a block max two times in the worst case scenario.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33477"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 20/08/2015 - 14:56.</div>
    <div class="content">
     <p>The interval and batchsize&nbsp; in the emoncms reporter are used to regulate the traffic to server, the interval defines the minimum interval between sends and the batchsize&nbsp;then limits the number of frames in each send as a network outage could result in a backlog of 1000&#39;s of frames buffered, originally implemented in case rmoncms.org was down for maintenance etc when it came back up there was some traffic calming.</p>
<p>However the variables are defined in the root reporter/interfacer&nbsp;so they can be used or redefined in each new class, I was thinking interval could be the max time to go between saves, just to persist any data held in ram for a prolonged time due to slow updates and batchsize&nbsp;could define the min (target) sizr for saving, This can easily use the existing frame count method, from which a user can calculate from frame size/frequency how often to save or it could perhaps be changed to calculate the actual size on disc for each save.</p>
<p>I don&#39;t think it would be too difficult but, I also don&#39;t think it is worth being too accurate, unfortunately even if we did&nbsp;know&nbsp;how to determine&nbsp;<span style="line-height: 20.7999992370605px;">the block size of each SDcard, we do not know where the blocks start so even if we matched the size exactly, it would hit 2 blocks.But that would be the most efficient scenario I guess.</span></p>
<p>The close method would also need to save any outstanding packets.</p>
<p><span style="line-height: 20.7999992370605px;">Paul</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33602"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7546.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="humphrey&#039;s picture" title="humphrey&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/7546.html" title="View user profile.">humphrey</a> on Tue, 25/08/2015 - 12:49.</div>
    <div class="content">
     <p>By coincidence I was working on the USB logger again because I added a second USB stick to my setup for redundant logging. I noticed that when the USB stick is unplugged the reporter keeps trying to write to it, without delay.</p>
<p>Looking at the source code I concluded that the interval setting is only taken into account for successfull attemps:</p>
<p>if self._process_post(databuffer):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [....]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # log the time of last succesful post<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self._interval_timestamp = time.time()</p>
<p>Which means that when the USB drive is not connected, or emonCMS is down, the reporters will retry constantly without pause. This may not be a problem for the USB stick, but might be worth considering for emonCMS.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33612"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to log the data into USB memory stick via raspberry pi2 instead of sending to emoncms.org?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 25/08/2015 - 22:52.</div>
    <div class="content">
     <p>Yes the emoncms&nbsp;interfacer could probably&nbsp;have some throttling added, although there is actually a 60sec&nbsp;timeout on each request attempt so it is only if there is no connection that the retry frequency increases at which time it shouldn&#39;t&nbsp;cause emoncms an issue.</p>
<p>The CSV interfacer would also benefit from slowing the retries and reduced&nbsp;error logging. in v2.0 I had experimented with a retry 5 times quickly which would then pause for a time before retrying at a regular interval pattern.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11087"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-nWo9kH7uHAgLTqMl_sMZCMqH4QwWok_K-je0VJYd41Y" value="form-nWo9kH7uHAgLTqMl_sMZCMqH4QwWok_K-je0VJYd41Y"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
