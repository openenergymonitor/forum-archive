<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2372 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:53:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>How to calibrate emonTX Shield? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">How to calibrate emonTX Shield?</h3>
        <span class="submitted">Submitted by Guest on Sun, 12/05/2013 - 14:00</span>
        <div class="content"><p>Hi</p>
<p>I bought the emonTX Shield, an Arduino Duemilanove, 2 CT sensors, a&nbsp;9V power supply (<a href="http://shop.openenergymonitor.com/9v-550ma-plug-in-power-supply-euro-plug/">this one</a>)</p>
<p>I soldered all the components on the Shield and attached it to the Arduino. Now I&#39;m using the code provided on the website to monitor the power usage of a desk lamp (examples/current_only.ino)</p>
<blockquote><p>// EmonLibrary examples openenergymonitor.org, Licence GNU GPL V3</p>
<p>&nbsp;</p>
<p>#include &quot;EmonLib.h&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Include Emon Library<br />
		EnergyMonitor emon1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Create an instance</p>
<p>void setup()<br />
		{&nbsp;<br />
		&nbsp; Serial.begin(9600);<br />
		&nbsp;<br />
		&nbsp; emon1.current(1, 111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.<br />
		}</p>
<p>&nbsp;</p>
<p>void loop()<br />
		{<br />
		&nbsp; double Irms = emon1.calcIrms(1480);&nbsp; // Calculate Irms only<br />
		&nbsp;<br />
		&nbsp; Serial.print(Irms*230.0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Apparent power<br />
		&nbsp; Serial.print(&quot; &quot;);<br />
		&nbsp; Serial.println(Irms);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Irms<br />
		}</p>
</blockquote>
<p>I attached 2 photos of the configuration. I had to connect the Arduino and the shiled using jumper wires because the shield&#39;s pins don&#39;t enter completely in the arduino.</p>
<p>I uploaded the code to the board and I&#39;m getting the following values:</p>
<p>When lamp is <strong>OFF</strong></p>
<p>102.44 0.45<br />
	95.89 0.42<br />
	98.77 0.43<br />
	95.72 0.42<br />
	89.83 0.39<br />
	95.02 0.41<br />
	89.78 0.39<br />
	89.76 0.39<br />
	86.63 0.38<br />
	96.09 0.42<br />
	102.98 0.45</p>
<p>When lamp is <strong>ON</strong></p>
<p>150.47 0.65<br />
	153.34 0.67<br />
	137.24 0.60<br />
	142.86 0.62<br />
	138.51 0.60<br />
	144.90 0.63<br />
	158.38 0.69<br />
	157.98 0.69<br />
	150.99 0.66<br />
	142.28 0.62<br />
	138.02 0.60<br />
	141.13 0.61<br />
	144.51 0.63<br />
	151.28 0.66</p>
<p>How can I get 0 when the lamp is off and the power usage (watts) when it is on?<br />
	Also, as you can see, values are changing frequently, how can I &quot;stabilize&quot; them?</p>
<p>Thank you.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2353.html" class="topic-previous" title="Go to previous forum topic">‹ SOLVED - getting the time working on emonGLCD with Pi and RFM12Pi Step by Step</a>
              <a href="2340.html" class="topic-next" title="Go to next forum topic">forward  data to emoncms.org ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-12068"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hkproj&#039;s picture" title="hkproj&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How to calibrate emonTX Shield?</h3>

    <div class="submitted">Submitted by hkproj (not verified) on Sun, 12/05/2013 - 14:02.</div>
    <div class="content">
     <p>forgot files</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12069"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to calibrate emonTX Shield?</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 12/05/2013 - 14:18.</div>
    <div class="content">
     <p>The library function, calcIrms(), calculates the RMS current by squaring the value of each sample that is taken.&nbsp; Any noise in the system will always be converted to a positive value.&nbsp; Hence I don&#39;t think you could ever expect to see 0 when there is no current flowing,&nbsp; Your value will always be &quot;noise squared&quot;.</p>
<p>If you were to use a voltage sensor too, and call the library function calcVI() instead, then each power contribution could be positive or negative so they would tend to cancel out.&nbsp; Your zero power value would then be much closer to 0 Watts.</p>
<p>It might be worth trying a much larger load, such as 2000 W, to see how well your system is working at higher currents.&nbsp; The first few tools on my <a href="1757.html">Summary Page</a> should help you with scaling your system to operate over the correct range, and with calibration.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12070"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hkproj&#039;s picture" title="hkproj&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: How to calibrate emonTX Shield?</h3>

    <div class="submitted">Submitted by hkproj (not verified) on Sun, 12/05/2013 - 14:49.</div>
    <div class="content">
     <p>Thank you for your fast response.</p>
<p>When I connect the second sensor (which I&#39;ll be using with the calcVI function), I need to connect it to the same wire as the sensor I use for current? How many turns do you suggest for a good value?</p>
<p>Also, I would like to know if the values I supplied as &quot;Calibration&quot; are correct? What should I use as &quot;Calibration&quot; and &quot;Phase shift&quot; in calcVI based on my configuration?</p>
<p>Sorry for my nearly-zero knowledge of electronics.</p>
<p>Thank you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12072"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to calibrate emonTX Shield?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 12/05/2013 - 15:45.</div>
    <div class="content">
     <p>You have the wrong current calibration constant for the shield. There is a different example sketch for the shield as compared to the emonTx, which also has the correct port numbers. That should be your starting point. From memory, you want a number around 60 instead of 111.1</p>
<p>[Edit] Your photo shows something plugged in to the voltage input of the shield. If that is the power supply you bought, you have the wrong one. The voltage input requires an a.c. adapter in order to measure the mains voltage. A 9 V d.c. regulated power supply will not provide an alternating voltage proportional to the mains voltage.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12074"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to calibrate emonTX Shield?</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 12/05/2013 - 19:18.</div>
    <div class="content">
     <p>To get the right result for power, you should only clip your CT once around your chosen wire (either Live and Neutral), not several times.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12077"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to calibrate emonTX Shield?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 12/05/2013 - 19:31.</div>
    <div class="content">
     <p>Robin, I presume he&#39;s multiplying up his load so that he&#39;s got larger numbers to work with for minimum energy cost - a 240 W load at the cost of a 60 W lamp! That&#39;s the way I test c.t&#39;s up to 250 A using only a 48 VA 6.3 V transformer to supply the current.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12080"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to calibrate emonTX Shield?</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 12/05/2013 - 19:57.</div>
    <div class="content">
     <p>Maybe, Robert, but if the standard calibration values are to work, the wire must only go through the CT once.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12084"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How to calibrate emonTX Shield?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 12/05/2013 - 22:34.</div>
    <div class="content">
     <p>hkproj:</p>
<p>To address the original question: What test instruments do you have? If you have a multimeter that can accurately measure current and voltage, then adjust the voltage calibration constant (if you&#39;re using the &#39;voltage&#39; sketch and have a voltage sensor) so that the sketch reports the same value for the mains voltage that you measure, or if you&#39;re not using the voltage input change the &quot;230.0&quot; to your average mains voltage. Then, using the highest current you can measure, adjust the current calibration constant (&quot;111.1&quot; or &quot;60.6&quot; as you should have it) so that the sketch reports the same value that you measure for the current (each c.t. and input might be different by a small amount - less than 2%). Finally (and only if you have the voltage sensor and are using the &#39;voltage&#39; sketch), with a resistive load, adjust the phase angle calibration &quot;1.7&quot; so that the sketch reports unity power factor.</p>
<p>If you haven&#39;t got an accurate meter to measure current or voltage, the best you can do is assume the current reading will be accurate, which it should be to within 2% if you&#39;ve used a 1% burden resistor, then calculate power from the rate that your tariff meter clocks up energy and adjust the voltage calibration so that the sketch reports the same value.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2372"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-2FsFgnT-lgtZip6oHc6XEzFrwbl_E-hVLn9MoAAvIc4" value="form-2FsFgnT-lgtZip6oHc6XEzFrwbl_E-hVLn9MoAAvIc4"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
