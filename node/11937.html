<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11937 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:48:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Publish to MQTT from a MQTT feed input | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Publish to MQTT from a MQTT feed input</h3>
        <span class="submitted">Submitted by <a href="../user/8169.html" title="View user profile.">cab123</a> on Tue, 05/01/2016 - 00:25</span>
        <div class="content"><p>Hi!</p>
<p>I have found that if i try to &quot;publish to MQTT&quot; from a regular input (using the http API) it works great, however if the input is received from MQTT itself it doesn&#39;t get published at all.</p>
<p>i need to use input logic engine to derive a completely new feed and export it to the MQTT broker so other bits of software can use it.</p>
<p>Functioning as designed, bug?</p>
<p>I&#39;m with emoncms 9.2 on debian and a slightly modified mqtt input script to have the topics organized:</p>
<p>&nbsp;</p>
<p>root@debian:/# mosquitto_sub -v -t emoncms/#</p>
<p>emoncms/to/2 293,1,0,5,7,23574<br />
emoncms/from/andar1/MainPower 217.77<br />
emoncms/from/andar1/LightsPower 52.47<br />
emoncms/from/andar1/SocketsPower 105.76<br />
emoncms/from/andar1/ACPower 0<br />
emoncms/from/andar1/TVsPower 56.17<br />
emoncms/from/andar1/KitchenPower 0<br />
&nbsp;</p>
<p>&nbsp;</p>
<p>Thanks!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11995.html" class="topic-previous" title="Go to previous forum topic">‹ Calculation issue in virtual feed</a>
              <a href="11984.html" class="topic-next" title="Go to next forum topic">Publishing to EmonPi: Missing Values ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-37887"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Tue, 05/01/2016 - 08:48.</div>
    <div class="content">
     <p>Perhaps not very helpful but you are not alone, I raised this issue back in September but got no response and ended up changing my strategy. See&nbsp;<a href="11306.html">http://openenergymonitor.org/emon/node/11306</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37889"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 05/01/2016 - 09:33.</div>
    <div class="content">
     <p>I wonder if the issue could be caused by an attempt to create a second connection here:<br />
<a href="https://github.com/emoncms/emoncms/blob/master/Modules/process/process_processlist.php#L677" title="https://github.com/emoncms/emoncms/blob/master/Modules/process/process_processlist.php#L677">https://github.com/emoncms/emoncms/blob/master/Modules/process/process_p...</a></p>
<p>I dont have a test system handy at the moment would you mind trying to see if changing the line:</p>
<p>if ($this-&gt;mqtt &amp;&amp; $this-&gt;mqtt-&gt;connect(true,NULL,$mqtt_server[&#39;user&#39;],$mqtt_server[&#39;password&#39;]))</p>
<p>to</p>
<p>if ($this-&gt;mqtt)</p>
<p>solves it in this instance? We would need to have a way to establish if a connection has already been created by the parent phpmqtt_input.php script for a longer term solution.</p>
<p>It may also need a couple of lines added just below line 49 here:</p>
<p><a href="https://github.com/emoncms/emoncms/blob/master/Modules/process/process_processlist.php#L49" title="https://github.com/emoncms/emoncms/blob/master/Modules/process/process_processlist.php#L49">https://github.com/emoncms/emoncms/blob/master/Modules/process/process_p...</a></p>
<p>} elseif ($mqtt==true) {<br />
&nbsp;&nbsp;&nbsp; $this-&gt;mqtt = $mqtt;<br />
}</p>
<p>The parent script phpmqtt_input which includes and creates an instance of the process_processlist class has already created a mqtt connection which is available in the global namespace and needs to be transferred to the process_processlist class properties.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37894"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8169.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cab123&#039;s picture" title="cab123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8169.html" title="View user profile.">cab123</a> on Tue, 05/01/2016 - 11:16.</div>
    <div class="content">
     <p>Hi <strong>Bra1n,</strong> your issue is exactly the same can you share your workaround?</p>
<p>Hi<strong> TrystanLea</strong>, i&#39;ll try to change those later today when i get home.</p>
<p>&nbsp;</p>
<p>I could build the input logic to create the new feed on a exisitng feed that is received via traditional http API, rather than a MQTT feed, but i would like to migrate everything to MQTT so this would be useless in the future.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37896"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Tue, 05/01/2016 - 11:55.</div>
    <div class="content">
     <p>Not really a work round I changed strategy and moved to MySQL for all my feeds doing some of my processing there and&nbsp;node-red for the rest of the processing</p>
<p>I&#39;m starting to find I only use MQTT to notify node-red an event has occured&nbsp;and processing is required</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37904"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8839.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8839.html" title="View user profile.">joyrider3774</a> on Tue, 05/01/2016 - 16:00.</div>
    <div class="content">
     <p>am i correct in understanding that you use the phpmqttinput script to receive data from mqtt&nbsp;as an input on a certain node and then you do publish to mqtt again ? and this last mqtt publish does not work then ? only reason i can see for doing this is if you alter the incoming mqtt data somehow. Unless i don&#39;t understand the problem correctly.</p>
<p>i can test this out this evening to see if i have the same problem. what i do already is have phpmqttinput script get data for a certain node (rx/nodeid) and i also publish to mqtt although not with the inputs getting their data from mqtt only with other inputs getting their data from http api. and that does seem to work together.</p>
<p>I&#39;ll try to add a new publish to mqtt from one of these mqtt inputs again and see if iget the same problem. If that&#39;s the problem i wonder if starting the mqttinput script before or after launching wamp has an impact somehow)</p>
<p>&nbsp;</p>
<p>on side note, the only problem i seem to be having is that the phpmqttinput script errors out from time to time saying that the (remote ?) host closed the connection and then no input is received anymore but i&#39;m guessing this is a windows / wamp related issue although not certain. my way around this is to run the input mqtt script from within a batch file in an etneral loop using goto statement so that when it does crash / errors out it&#39;s automatically restarted</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37905"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8169.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cab123&#039;s picture" title="cab123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8169.html" title="View user profile.">cab123</a> on Tue, 05/01/2016 - 16:15.</div>
    <div class="content">
     <p>Hi <strong>joyrider3774</strong>, your undestanding is absolutely correct. I want to change the incoming MQTT feed by adding and subtracting two different input feeds. You confirmed that the workaround i suggested on my previous post would work if&nbsp; a existing HTTP API feed is used to to create the new feed.</p>
<p>I think you will easily replicate this issue.</p>
<p><strong>Bra1n</strong>, i am still in a MQTT-centric-begginer approach :-) i want everything&nbsp; in there so i can share data easily between my progs.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37916"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8839.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8839.html" title="View user profile.">joyrider3774</a> on Tue, 05/01/2016 - 19:54.</div>
    <div class="content">
     <p abp="717">@TrystanLea</p>
<p abp="718">I found a (possible) solution for the problem. I could replicate the problem with me. so i thought i&#39;d change all variablenames of $mqtt inside phpmqtt_input.php to $mqttnew to make sure a new connection is made. but when running the script i got this weird stack trace:</p>
<pre>
C:\wamp\www\emoncmsnew\scripts&gt;php C:\wamp\www\emoncmsnew\scripts\phpmqtt_input.php

Fatal error: Cannot redeclare class phpMQTT in C:\wamp\www\emoncmsnew\Lib\phpMQT
T.php on line 36

Call Stack:
    0.0010     266808   1. {main}() C:\wamp\www\emoncmsnew\scripts\phpmqtt_input
.php:0
    0.0120    1036168   2. Process-&gt;__construct() C:\wamp\www\emoncmsnew\scripts
\phpmqtt_input.php:75
    0.0120    1036360   3. Process-&gt;get_process_list() C:\wamp\www\emoncmsnew\Mo
dules\process\process_model.php:34
    0.0120    1036440   4. Process-&gt;load_modules() C:\wamp\www\emoncmsnew\Module
s\process\process_model.php:59
    0.0130    1039496   5. Process-&gt;get_module_class() C:\wamp\www\emoncmsnew\Mo
dules\process\process_model.php:103
    0.0150    1359464   6. Process_ProcessList-&gt;__construct() C:\wamp\www\emoncm
snew\Modules\process\process_model.php:132
    0.0150    1457720   7. require(&#39;C:\wamp\www\emoncmsnew\Lib\phpMQTT.php&#39;) C:\
wamp\www\emoncmsnew\Modules\process\process_processlist.php:46</pre><p abp="738">don&#39;t really understand why though but if i change the the require(&#39;Lib\phpMQTT.php&#39;) to require_once(&#39;Lib\phpMQTT.php&#39;) inside process_processlist.php and also inside phpmqtt_input.php that error goes away and then in combination with renaming $mqtt to $mqttnew in phpmqtt_input.php&nbsp;&nbsp;the problem is solved, then the publish to&nbsp; mqtt from a node comming from mqtt works. at least it does with me.</p>
<p abp="739">i do think it is actually using 2 connections now one for publishing and one for listening although not 100% certain, but it would probably be safer to have 2 connections, does it not ?</p>
<p abp="740">while before it seemed it was somehow sharing the connection or at least i think so but am not certain. Also since i don&#39;t fully understand the impacts from the require to require_once statements i&#39;ll wait some comments from u. As to my understanding require includes the lib\phpmqtt.php eacht time while require_once only includes it once</p>
<p abp="741">if you want me to try something else please tell me what or if the info given above has enough info to find the culprit or is the actual solution then all is fine :)</p>
<p abp="742">edit:</p>
<p abp="743">not certain but with my changes looking at the mosquito output it seems i have 2 emoncms input suscriber connections or at least i think so since it&#39;s sending a ping and receives ack from input suscriber 2 times after each other or are 2 pings send each time or does it just get displayed like that ?</p>
<p abp="744">the publisher one always connects and then disconnects which is normal</p>
<pre abp="745">
1452023351: New connection from 127.0.0.1 on port 1883.
1452023351: New client connected from 127.0.0.1 as Emoncms Publisher (c1, k10, u
&#39;joyrider3774&#39;).
1452023351: Sending CONNACK to Emoncms Publisher (0, 0)
1452023351: Received PUBLISH from Emoncms Publisher (d0, q0, r0, m0, &#39;Plug5 Watt
&#39;, ... (1 bytes))
1452023351: Received DISCONNECT from Emoncms Publisher
1452023351: Client Emoncms Publisher disconnected.
1452023352: Received PINGREQ from Emoncms input subscriber
1452023352: Sending PINGRESP to Emoncms input subscriber
1452023352: Received PINGREQ from Emoncms input subscriber
1452023352: Sending PINGRESP to Emoncms input subscriber</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37945"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8169.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cab123&#039;s picture" title="cab123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8169.html" title="View user profile.">cab123</a> on Wed, 06/01/2016 - 16:22.</div>
    <div class="content">
     <p>Hi here are my findings:</p>
<p><strong>process_processlist.php_new</strong> -&gt; with the changes suggested by&nbsp;<strong>TrystanLea </strong></p>
<p><strong>process_processlist.php_bck</strong> -&gt; original file from emoncms 9.2</p>
<p>emoncms/from/<strong>floor1</strong>/MainPower -&gt; regular input feed from a emontx (http api) that is published to MQTT</p>
<p>emoncms/from/<strong>floor2</strong>/MainPower -&gt; MQTT input feed that is transformed and is published back to MQTT</p>
<p>&nbsp;</p>
<p>%reboot the system%</p>
<p>root@debian:/# mosquitto_sub -v -t emoncms/from/+/MainPower/#<br />
emoncms/from/floor1/MainPower 625.19<br />
emoncms/from/floor1/MainPower 623<br />
emoncms/from/floor1/MainPower 624.52<br />
emoncms/from/floor1/MainPower 643.54<br />
emoncms/from/floor1/MainPower 636.44<br />
emoncms/from/floor1/MainPower 644.81<br />
emoncms/from/floor1/MainPower 675.98<br />
&nbsp;-------------------------------------&gt; /etc/init.d/mqtt_input restart</p>
<p>emoncms/from/floor1/MainPower 680.58<br />
emoncms/from/floor1/MainPower 678.09<br />
emoncms/from/floor1/MainPower 666.66<br />
emoncms/from/floor1/MainPower 647.47</p>
<p>&nbsp;-------------------------------------&gt; cp<strong> process_processlist.php_new</strong> process_processlist.php</p>
<p>(nothing!)</p>
<p>
&nbsp;-------------------------------------&gt; /etc/init.d/mqtt_input restart<br />
&nbsp;<br />
emoncms/from/<strong>floor2</strong>/MainPower 806.022<br />
emoncms/from/<strong>floor2</strong>/MainPower 925.282<br />
emoncms/from/<strong>floor2</strong>/MainPower 741.592<br />
emoncms/from/<strong>floor2</strong>/MainPower 778.282<br />
emoncms/from/<strong>floor2</strong>/MainPower 827.392</p>
<p>&nbsp;-------------------------------------&gt; cp <strong>process_processlist.php_bck</strong> process_processlist.php<br />
&nbsp;<br />
emoncms/from/floor1/MainPower 1108.22<br />
emoncms/from/floor1/MainPower 1025.05<br />
emoncms/from/<strong>floor2</strong>/MainPower 835.452<br />
emoncms/from/floor1/MainPower 1011.89<br />
emoncms/from/floor1/MainPower 1000.62<br />
emoncms/from/<strong>floor2</strong>/MainPower 857.882<br />
emoncms/from/floor1/MainPower 1014.04<br />
emoncms/from/floor1/MainPower 1021.8<br />
emoncms/from/<strong>floor2</strong>/MainPower 818.702</p>
<p>&nbsp;</p>
<p>If i reboot the system i get back to the original issue.</p>
<p>Does this help?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37963"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8839.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8839.html" title="View user profile.">joyrider3774</a> on Wed, 06/01/2016 - 22:10.</div>
    <div class="content">
     <p abp="976">could you try what i changed ? i only tested it rather quickly but it did seem to post the data to mqtt comming form an mqtt input fine. I just don&#39;t know if the changes are any good even if it worked :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37975"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8169.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cab123&#039;s picture" title="cab123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8169.html" title="View user profile.">cab123</a> on Thu, 07/01/2016 - 15:18.</div>
    <div class="content">
     <p>Hi <strong>joyrider3774</strong>, indeed your changes worked. Rebooted and the system and seems stable for now, i&#39;ll keep those settings and report back if i find any issue.</p>
<p>&nbsp;</p>
<p>Thanks!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37979"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8839.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8839.html" title="View user profile.">joyrider3774</a> on Thu, 07/01/2016 - 16:09.</div>
    <div class="content">
     <p>Lets hope some variant of it makes it to the official version otherwise you&#39; might have to keep changing the files again with each update but i think that depends on how your updating</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38221"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7376.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7376.jpg" alt="allmac&#039;s picture" title="allmac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Wed, 13/01/2016 - 16:43.</div>
    <div class="content">
     <p>Cab123,</p>
<p>How did you added MQTT publishing INPUT data from HTTP?<br />
I am able to publish the reverse... no HTTP input data, but only MQTT&nbsp;input data.</p>
<p>To publish MQTT received data to MQTT broker I have the following in my Emonhub&nbsp;config file:</p>
<blockquote><p>[[MQTT]]<br />
&nbsp; &nbsp; Type = EmonHubMqttInterfacer<br />
&nbsp; &nbsp; [[[init_settings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; mqtt_host = localhost<br />
&nbsp; &nbsp; &nbsp; &nbsp; mqtt_port = 1883<br />
&nbsp; &nbsp; [[[runtimesettings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; pubchannels = ToRFM12,<br />
&nbsp; &nbsp; &nbsp; &nbsp; subchannels = ToEmonCMS,<br />
&nbsp; &nbsp; &nbsp; &nbsp; basetopic = emonhub/</p>
</blockquote>
<p>And I receive this MQTT data via Serial (USB):</p>
<blockquote><p>[[SerialDirect]]<br />
&nbsp; &nbsp; &nbsp;Type = EmonHubSerialInterfacer<br />
&nbsp; &nbsp; &nbsp; [[[init_settings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;com_port = /dev/ttyACM0 #USB<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;com_baud = 9600<br />
&nbsp; &nbsp; &nbsp; [[[runtimesettings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pubchannels = ToEmonCMS,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;subchannels = ToRFM12<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;baseid = 5 #(emonPi default:5)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;quiet = false #(default:true)</p>
</blockquote>
<p><strong>EMONHUB LOG:</strong><br />
<em>SerialDirect Publishing: emonhub/rx/5/values 220,52,40,110,124,33</em></p>
<p><strong>EMONCMS LOG:</strong><br />
<em>Received mqtt message: emonhub/rx/5/values 346,180,40,111,124,33</em></p>
<p>How do you receive your MQTT data? RF?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38224"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8169.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cab123&#039;s picture" title="cab123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/8169.html" title="View user profile.">cab123</a> on Wed, 13/01/2016 - 17:29.</div>
    <div class="content">
     <p>Hi, yes, i have a standard emonTx v2 and a RF link that posts data to a standard RFM2Pi interfacer. From there the data is passed to the MQTT broker just like you do.</p>
<p>My HTTP API is from another emonTx, that has built-in ethernet and deliver the data directly to emoncms. I want to change that to MQTT in the future.</p>
<p>&nbsp;</p>
<p>To send data to HTTP you need a different interfacer type, like this one:</p>
<p>[[Local_CMS]]<br />
&nbsp;&nbsp;&nbsp; Type = EmonHubEmoncmsHTTPInterfacer<br />
&nbsp;&nbsp;&nbsp; [[[init_settings]]]<br />
&nbsp;&nbsp;&nbsp; [[[runtimesettings]]]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pubchannels = ToRFM12,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; subchannels = ToEmonCMS,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; url = <a href="http://localhost/emoncms" title="http://localhost/emoncms">http://localhost/emoncms</a><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; apikey = XXXXXXXXXXXXXXXXXXXX<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; senddata = 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sendstatus = 1</p>
<p>&nbsp;</p>
<p>This was working and is just commented on my emonhub.conf since i don&#39;t need it anymore. Hope it helps</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38227"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7376.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7376.jpg" alt="allmac&#039;s picture" title="allmac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Publish to MQTT from a MQTT feed input</h3>

    <div class="submitted">Submitted by <a href="../user/7376.html" title="View user profile.">allmac</a> on Wed, 13/01/2016 - 18:18.</div>
    <div class="content">
     <p>Thanx! I am already able to send data to HTTP. I was looking for send data received via HTTP to MQTT.<br />
But I found how to.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11937"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-QWu1s-7iAde0Yesar-aaunDmoIb3IW82FNl9CZO75q0" value="form-QWu1s-7iAde0Yesar-aaunDmoIb3IW82FNl9CZO75q0"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
