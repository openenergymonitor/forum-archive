<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Local EmonCMS server died (old version) Upgrade to new help | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/5">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Local EmonCMS server died (old version) Upgrade to new help</h3>
        <span class="submitted">Submitted by <a href="/emon/user/3623" title="View user profile.">manicmoddin</a> on Wed, 25/06/2014 - 21:38</span>
        <div class="content"><p>Hi,</p>
<p>	Its been a while since I have been dabbling with this side of the monitoring, it has beenin going strong for the last year or so.</p>
<p>	I have been using the server for more and more, since the monitoring does not load it up and like a fool, made one change to the OS and it has wiped out a load of info that makes it run the way it should.</p>
<p>	Currently I am still running rfm12piphp and this is still logging and working, but it no longer works as DNS server etc. etc so I&#39;m going to do a bare bones install again, and get this sucker up and running again.</p>
<p>	Dailey I take a mysql dump and an emoncms folder dump, zip and backup to nas drive, (cron job) so data is not too bad, dont mind loosing a day or so, but dont want to loose the years worth.</p>
<p>	Now I can copy over the apache config, and be cool and up and running, but I wouldnt mind trying out the new(er) versions of emoncms, so when I do the new install going to virtualise the servers and have a couple running which I think will be better, however all the feeds I have are mysql feeds from something like V5/6, are these still valid or will I need to convert to something else / table structure etc?</p>
<p>Many thanks</p>
<p>Jimmy</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/10371" class="topic-previous" title="Go to previous forum topic">‹ emonCMS send failure: wanted &#039;ok&#039; but got &#039;&lt;br /&gt;</a>
              <a href="/emon/node/3995" class="topic-next" title="Go to next forum topic">Development: Calculating Wh totals on the emontx ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-28915"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3623" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="manicmoddin&#039;s picture" title="manicmoddin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Local EmonCMS server died (old version) Upgrade to new help</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3623" title="View user profile.">manicmoddin</a> on Sun, 22/03/2015 - 16:13.</div>
    <div class="content">
     <p>Found out using the way bach machine how to put it all together and have thesystem working, but it took an age to copy over the database.</p>
<p>I&#39;ve been using percona xtrabackup to get hot backups from the server, and last night I looked into the swap over again, With a 4 Gb database, The backup and restore using the percona took approx 30 mins including the copy over to the new machine for testing.</p>
<p>However after firing it all into life and installing emoncms V8 I cannot see my feeds etc. If I go into the database check, it wants to alter the structure of the database, which I have no problem doing, but it gives be errors about not being able to find a object.</p>
<p>Unfortunatley I cannot get onto the server at the moment as the box is down, but I will update the error message when it comes back alive.</p>
<p>I am guessing that I will need to convert to time store to get the feeds working again, but not sure how to go about this.</p>
<p>Also looking into the issues lastnight (while tired) I noticed that the settings.php ask for a timestore key?</p>
<p>Many thanks for any info that can be shed.</p>
<p>Jimmy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28922"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Local EmonCMS server died (old version) Upgrade to new help</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3" title="View user profile.">TrystanLea</a> on Sun, 22/03/2015 - 23:46.</div>
    <div class="content">
     <p>Hello Jimmy</p>
<p>You should be able to view your mysql data ok using the master branch of emoncms. However if I remember correctly you may be missing the engine field in the feeds table which is a newer addition.</p>
<p>Try running the database update tool in admin -&gt; check &amp; update db.</p>
<p>Then check if the engine field for your feeds are 0 in the mysql table, you could try manually changing them to 0 if not.</p>
<p>To convert to the newer engines you will want to skip timestore and go straight to the newer engines, the easiest conversion from MYSQL is to phptimeseries (it uses the same data file format), but maybe see if you can see the data in MYSQL first and then I can try and help you move them to phptimeseries.</p>
<p>Can you elaborate on the missing object error?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28980"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3623" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="manicmoddin&#039;s picture" title="manicmoddin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Local EmonCMS server died (old version) Upgrade to new help</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3623" title="View user profile.">manicmoddin</a> on Tue, 24/03/2015 - 21:06.</div>
    <div class="content">
     <p>Hi Trystan</p>
<p>The Missing object, error is when I go into the admin and do the update db.</p>
<p>It tkes me to the URL <a href="http://&lt;ip&gt;/emoncms/admin/db" title="http://&lt;ip&gt;/emoncms/admin/db">http://&lt;ip&gt;/emoncms/admin/db</a> and tells me it needs to update the following:</p>
<blockquote><p>Update database</p>
<p>Todo: - these changes need to be applied</p>
<p>&nbsp;</p>
<p>Database schema</p>
<p>ALTER TABLE `event_settings` ADD `mqttbrokerip` varchar(60) NOT NULL<br />
ALTER TABLE `event_settings` ADD `mqttbrokerport` varchar(5) NOT NULL<br />
ALTER TABLE `event_settings` ADD `mqttusername` varchar(60) NOT NULL<br />
ALTER TABLE `event_settings` ADD `mqttpassword` varchar(60) NOT NULL<br />
ALTER TABLE `event` ADD `mqtttopic` text NOT NULL<br />
ALTER TABLE `event` ADD `mqttqos` int(3) NOT NULL DEFAULT &#39;0&#39;<br />
ALTER TABLE input MODIFY `nodeid` text;<br />
CREATE TABLE myelectric (`userid` int(11), `data` text) ENGINE=MYISAM<br />
CREATE TABLE node (`userid` int(11), `data` text) ENGINE=MYISAM<br />
CREATE TABLE notify (`userid` int(11) not null primary key, `email` varchar(30), `enabled` int(11) not null) ENGINE=MYISAM<br />
CREATE TABLE openbem_projects_v3 (`project_id` int(11) not null auto_increment primary key, `project_name` varchar(30), `project_description` text, `project_owner` int(11), `project_collaborators` text, `project_mdate` int(11)) ENGINE=MYISAM<br />
CREATE TABLE openbem_scenarios_v3 (`scenario_id` int(11) not null auto_increment primary key, `project_id` int(11), `scenario_meta` text, `scenario_data` text) ENGINE=MYISAM<br />
CREATE TABLE report (`userid` int(11) primary key, `settings` text) ENGINE=MYISAM<br />
CREATE TABLE applist (`id` int(11) not null auto_increment primary key, `userid` int(11), `name` text, `list` text) ENGINE=MYISAM</p>
</blockquote>
<p>To which I click Apply, and then it appends the ?apply=true to the URL, and gives the following error</p>
<blockquote><p>
Notice: Trying to get property of non-object in /var/www/emoncms/Lib/dbschemasetup.php on line 41</p>
<p>Notice: Trying to get property of non-object in /var/www/emoncms/Lib/dbschemasetup.php on line 41</p>
<p>Notice: Trying to get property of non-object in /var/www/emoncms/Lib/dbschemasetup.php on line 41</p>
<p>Fatal error: Call to a member function fetch_object() on a non-object in /var/www/emoncms/Modules/user/user_model.php on line 440</p>
</blockquote>
<pre>
Now looking in the code on line 440, which to me is where the main error is
 (the fatal one) this is querying the db looking for my api write key, but this
 is as far as I can get.

I think it is a simple fix that I am over looking.

As for the feeds table, I get the following:
mysql&gt; show columns in feeds;
+----------+------------+------+-----+---------+----------------+
| Field    | Type       | Null | Key | Default | Extra          |
+----------+------------+------+-----+---------+----------------+
| id       | int(11)    | NO   | PRI | NULL    | auto_increment |
| name     | text       | YES  |     | NULL    |                |
| userid   | int(11)    | YES  |     | NULL    |                |
| tag      | text       | YES  |     | NULL    |                |
| time     | datetime   | YES  |     | NULL    |                |
| value    | float      | YES  |     | NULL    |                |
| datatype | int(11)    | NO   |     | NULL    |                |
| public   | tinyint(1) | YES  |     | NULL    |                |
| size     | int(11)    | NO   |     | NULL    |                |
| engine   | int(11)    | NO   |     | 0       |                |
+----------+------------+------+-----+---------+----------------+
10 rows in set (0.00 sec)
</pre><p>which all looks fine to what you say.</p>
<p>Many thanks for the info so far, I am looking through the code and if I get to it I will post what I find.</p>
<p>Jimmy</p>
<p>&nbsp;</p>
<p><em>Edit - fixed table - BT</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29055"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3623" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="manicmoddin&#039;s picture" title="manicmoddin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Local EmonCMS server died (old version) Upgrade to new help</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3623" title="View user profile.">manicmoddin</a> on Thu, 26/03/2015 - 23:32.</div>
    <div class="content">
     <p>Ok a fresh install of the version 8 seems to have worked.</p>
<p>At least on the test machine, now I need to get a Jeenode plugged in and have that updating in tandem with current live system, then when happy it all works, migrate over to the new version, and try to keep up to date.</p>
<p>I think it may have been a permissions thisg, an owner etc, not 100% sure, but version 8 seems light years ahead of what I used to use.</p>
<p>Also I need to figure out how to convert to phptimeseries now... Think I&#39;ve found something in the useful scripts for that though</p>
<p>Jimmy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/5343"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-X6vU-I7z8FHRunBtPo9v8Lv_fd2jhN_NfD301Rs9vts" value="form-X6vU-I7z8FHRunBtPo9v8Lv_fd2jhN_NfD301Rs9vts"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>

</html>
