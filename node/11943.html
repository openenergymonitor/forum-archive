<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11943 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:30:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>AC design and safety questions | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">AC design and safety questions</h3>
        <span class="submitted">Submitted by <a href="../user/4849.html" title="View user profile.">Javalin</a> on Tue, 05/01/2016 - 16:14</span>
        <div class="content"><p>Hi All,</p>
<p>I have a questions around AC PCB design and safety, for my own home monitoring system which I would like to improve and simplify the power bits.&nbsp; It monitors AC use, Solar generation, etc, so similar to the open energy monitor stuff.</p>
<p>So I wonder about directly powering from 230V AC (UK) and transforming and rectifying to ~12V AC then taking (1) a feed to get a AC representative voltage from it and indication of current flow and (2) then using a LDO voltage reg to drop it to 5v and 3.3v DC to power the project.</p>
<p>But I want to do it safely.&nbsp; Are there any recommendations available?&nbsp; Don&#39;t want&nbsp;get electrocuted or burn the house down.</p>
<p>My thoughts are currently:</p>
<p>(1) metal box - grounded.</p>
<p>(2) Encased transformer such as <a href="http://www.maplin.co.uk/p/2x12v-32va-encapsulated-pcb-transformer-a53qk">http://www.maplin.co.uk/p/2x12v-32va-encapsulated-pcb-transformer-a53qk</a> for example.</p>
<p>(3) good isolation space of mains AC, low volts AC and DC on the PCB&nbsp;+ fuse.</p>
<p>(4) mains cable support</p>
<p>Does having AC + DC on a PCB create noise issues I would have to take into account?&nbsp; Thinking of interference issues with the ADC...</p>
<p>My other plan (B if you will) is to use a 230V AC&nbsp;-&gt; ~20V AC wall transformer and then just do low voltage AC in the box....?</p>
<p>thanks for your thoughts,</p>
<p>James</p>
<p>(PS no this isn&#39;t in competition with OEM, private project for my own amusement)</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11955.html" class="topic-previous" title="Go to previous forum topic">‹ how critical is to have exactly 2.5v at the mid point</a>
              <a href="11949.html" class="topic-next" title="Go to next forum topic">Measuring single appliance energy usage ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-37910"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC design and safety questions</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 05/01/2016 - 17:15.</div>
    <div class="content">
     <p>If you have no experience of PCB layout and design for mains voltages, then you've got a lot of learning to do if you go with Plan A. Plan B gets around most if not all of the safety issues immediately.</p>
<p>On the minus side for Plan B, you're using the same transformer for voltage sampling and for power. If you use the typical bridge rectifier configuration, you need another transformer or an op.amp to isolate the transformer voltage that you're going to use for measurement from the one that goes to the bridge rectifier and regulators for the low voltage dc power supply rails. Even then, the current pulses as the smoothing capacitor charges will dent the waveform and introduce errors. If you want to avoid the extra transformer or op.amp, you can only use a half-wave rectifier, as the emonTx does.</p>
<p>Plan A is essentially the configuration that Robin Emley uses in his Mk2 Router (<a href="http://www.mk2pvrouter.co.uk/" title="http://www.mk2pvrouter.co.uk/">http://www.mk2pvrouter.co.uk/</a>). Having two separate secondary windings (one for the voltage sample, one for power) largely overcomes the waveform distortion problems. Point 3 mentions isolation - apart from observing the necessary tracking distances, which is an absolute must, I'd make sure that there is earthed copper between the mains connections (both line &amp; neutral) and the low voltages so that any leakage or flashover is to earth. Have a read of "GIVMon" to get some idea of the proper way to do it (that project was to obtain a 'better' voltage sample, but the safety precautions are relevant to you).</p>
<p>The main source of interference that we've encountered is from the digital circuits in the processor; so good grounding, shielding with earthed copper and filtering in the supply (there's plenty of advice on the Atmel website) are most important.</p>
<p>Those are the main points that come to mind.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37930"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4849.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Javalin&#039;s picture" title="Javalin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC design and safety questions</h3>

    <div class="submitted">Submitted by <a href="../user/4849.html" title="View user profile.">Javalin</a> on Wed, 06/01/2016 - 09:24.</div>
    <div class="content">
     <p>Hi Robert - thanks for the input :-)</p>
<p>Happy enough with low voltage DC PCB design, but&nbsp;think option B sounds the best plan.&nbsp; I had a look at the mk2 router, and can see the isolation gap you mention for leakage.</p>
<p>I did some circuit simulations last night and a transformer with a center tap and two diodes seems a good option.&nbsp; I don&#39;t have a circuit schematic to hand, but will post later.</p>
<p>Is the 9V AC-AC in the shop (and that I have already) suitable for a supply?</p>
<p>James</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37931"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC design and safety questions</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 06/01/2016 - 10:53.</div>
    <div class="content">
     <p>Hi James, I&#39;m always happy to supply parts for DIY constructors to experiment with, at their own risk.&nbsp;</p>
<p>One of my original PCBs (<a href="../../../mk2pvrouter.co.uk/mediac/450_0/media/f131d0ad8ebdac6affff8010ffffffd3.jpg">the orange one</a>) and a matching mains transformer (either 2 x 6V or 2 x 9V) including postage would be &pound;10.&nbsp; There&#39;s an email address on my Shop page for all such enquiries.</p>
<p>The original PCB layout has a tracking error in the vicinity of the display but it doesn&#39;t affect the operation of the processor, so will be fine for basic experimentation.&nbsp; The error can be easily fixed if need be.&nbsp; My latest (Rev 2.1a) PCB is listed as &pound;7, but I&#39;m always open to offers.</p>
<p>Robin Emley</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37936"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC design and safety questions</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 06/01/2016 - 13:48.</div>
    <div class="content">
     <p>If you use the shop ac adapter, you've got all the problems with separating the voltage monitor and the power supply that I mentioned above. Otherwise, there's enough power for a basic 'emonTx look-alike' but no more without distorting the voltage waveform that you're using for measurement.</p>
<p>(Hint: you need to add the transformer impedance / secondary winding resistance to your simulation, then check how the voltage is disturbed by the current pulse.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37943"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4849.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Javalin&#039;s picture" title="Javalin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC design and safety questions</h3>

    <div class="submitted">Submitted by <a href="../user/4849.html" title="View user profile.">Javalin</a> on Wed, 06/01/2016 - 15:22.</div>
    <div class="content">
     <p>Thanks for the posts both.</p>
<p>Would a multiple winding transforms solve the voltage/current issues with a single transformer?&nbsp; One for power supply and one for measurement.&nbsp; This is where my lack of knowledge starts to show....</p>
<p>i.e. <a href="http://uk.rs-online.com/web/p/pcb-transformers/1739737/">http://uk.rs-online.com/web/p/pcb-transformers/1739737/</a></p>
<p>Robert -&gt; I&#39;ll check the simulation, but I suspect the software isn&#39;t that clever.&nbsp; Its LiveWire (<a href="http://www.new-wave-concepts.com/ed/livewire.html">http://www.new-wave-concepts.com/ed/livewire.html</a>) mainly for home use.</p>
<p>James</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37944"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC design and safety questions</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 06/01/2016 - 16:15.</div>
    <div class="content">
     <p>As I wrote: "Having two separate secondary windings (one for the voltage sample, one for power) largely overcomes the waveform distortion problems." Largely, but not completely.</p>
<p>For simulations, I (and Glyn) use Linear Technology Corporation's LTspice IV (free, from their website). </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37951"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC design and safety questions</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 06/01/2016 - 17:53.</div>
    <div class="content">
     <p>I have occasionally used the LiveWire simulator from New Wave Circuits, but doubt whether it would be able to cope with this kind of application.&nbsp; I also use their PCB Wizard 3 tool for PCB layouts.&nbsp; Although the &#39;pro&#39; version features double-sided auto-layout, I have always preferred to do my layouts manually.&nbsp; Using this tool, creating Gerber files for PCB manufacture is straightforward enough.&nbsp; These files can then be checked using the free GCpreview tool from graphicode.com.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38036"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4849.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Javalin&#039;s picture" title="Javalin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC design and safety questions</h3>

    <div class="submitted">Submitted by <a href="../user/4849.html" title="View user profile.">Javalin</a> on Fri, 08/01/2016 - 19:46.</div>
    <div class="content">
     <p>Hi</p>
<p>So lots to ponder, and work out - thanks for the comments.</p>
<p>Robin - I prefer Eagle atm as I then use oshpark.com for cheap boards.&nbsp; I&#39;ve used expressPCB before which is very good and very quick, but also very expensive...</p>
<p>James</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11943"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-iosnTgbCuqGupui_Sc5AgONZ7Go2ke_gJ1P4UtjnREs" value="form-iosnTgbCuqGupui_Sc5AgONZ7Go2ke_gJ1P4UtjnREs"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
