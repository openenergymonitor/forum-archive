<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/257 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:53:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Hmm - was working now, isnt... | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Hmm - was working now, isnt...</h3>
        <span class="submitted">Submitted by Guest on Sun, 09/10/2011 - 18:39</span>
        <div class="content"><p>Having just documented the build, I&nbsp;decided to tidy up the water monitoring.</p>
<p><strong>The Tx now doesnt seem to be working properly</strong> - the LED, which used to flash on a pulse, is now constantly but dimly lit when a signal cables is connected. The Tx reads data, but is very sensitive to any input on the pulse counter circuit, e.g touching the input signal connections (when cable not connected) causes the LED to part illuminate and random data is sent.</p>
<p>There is +3.3V across the pulse input (I cant remember if this was there before, but expected zero).</p>
<p>What I changed: I had a commercial pulse meter from Enica connected in parallel - could this have been pulling the signal to zero? Ive reconnected the Enica with no joy.</p>
<p>Ive also tried removing R8 from the TX.</p>
<p>Ive resoldered a few dry joints, and this helped somewhat - I can now detect a voltage change pulse, but not a zero-volt (closed circuit) pulse.</p>
<p>&nbsp;</p>
<p>Will the TX's interrupt line detect a zero voltage pulse?&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="259.html" class="topic-previous" title="Go to previous forum topic">‹ A few questions</a>
              <a href="258.html" class="topic-next" title="Go to next forum topic">NanodeRF static IP. ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-2194"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hmm - was working now, isnt...</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 12/10/2011 - 00:20.</div>
    <div class="content">
     <p>Hi Andy,</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
<p>From the information you've provided I have an idea as to what the problem could be.&nbsp;</p>
<p>Have you read the section on wired pulse counting at the bottom of this page:&nbsp;<a target="_blank" href="79.html">http://<wbr></wbr>openenergymonitor.org/emon/<wbr></wbr>node/79</a>. The input to the meter/output of emonTx should be 3.3V. The solid-state relay in the water meter should then output a 3.3V pulse and 0V when there is no pulse.</p>
<p>My guess is that 3.3V is a bit low for the solid-state relay in your water meter. Have you got a datasheet for the meter? &nbsp;The Enica meter probable supplied the meter with a higher voltage (5V?). &nbsp;This can easily be measured, to find out if what I think is true. This would explain why the system stopped working when the Enica meter was removed. Out of interest how long is the cable run from the meter to the emonTx?</p>
<p>The fix for this problem involves a bit of hack on the emonTX PCB to route 5V to the pulse output socket. This is assuming you are powering the emonTx from a 5V USB supply, its this true? The emonTx has got two positive power rails +3.3V and PWR. The PWR rail is connected directly to the USB/FTDI socket while the 3V power rail is the output from the MCP1702 voltage regulator. In order to route 5V to the emonTx pulse socket you will need to physically break the track on the top the PCB and then solder a wire from the PWR power rail (broken out onto all the JeePort sockets) to the positive terminal on the pulse socket (see image attached below). Unfortunately this hack will make the readings from CT2 and CT3 incorrect and might stop the temperature port working since due to how the PCB is routed they will also now receive 5V when the Atmega is running at 3.3V. The Atmega needs to run at 3.3V since the RFM12B cannot take 5V. &nbsp;</p>
<p>I plan to incorporate a user selectable jumper in newer versions of the emonTx to allow voltage selection to the pulse socket.&nbsp;</p>
<p>Let me know how you get on.&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
<p>&nbsp;</p>
<p><a href="../sites/default/files/emonTx%205v%20pulse%20hack.png"><img width="400" height="297" alt="" src="../sites/default/files/emonTx%205v%20pulse%20hack.png" /></a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2197"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andygodber&#039;s picture" title="Andygodber&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Hmm - was working now, isnt...</h3>

    <div class="submitted">Submitted by Andygodber (not verified) on Wed, 12/10/2011 - 06:50.</div>
    <div class="content">
     <p>I'll give that a go - thanks. (I'm away from the project at the moment, with limited net access, so will be a week or so before I update)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2264"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andygodber&#039;s picture" title="Andygodber&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Hmm - was working now, isnt...</h3>

    <div class="submitted">Submitted by Andygodber (not verified) on Mon, 31/10/2011 - 18:38.</div>
    <div class="content">
     <p>Can I just verify - should I be able to 'record a pulse' just by making and breaking the circuit between pin 3 (vcc) and pin 2 (IRQ/data) of the pulse plug? (forget any other devices connected).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2265"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hmm - was working now, isnt...</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 01/11/2011 - 10:55.</div>
    <div class="content">
     <p>Hi Andy,</p>
<p>Yes this will work fine. In this case I would leave the resistor R8 in place to pull down the IRQ line. For the firmware Use the emonTx pulse counting example from:&nbsp;<a href="https://github.com/openenergymonitor/emonTxFirmware">https://github.com/openenergymonitor/emonTxFirmware</a></p>
<p>Good luck, Glyn.&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2266"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andygodber&#039;s picture" title="Andygodber&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Hmm - was working now, isnt...</h3>

    <div class="submitted">Submitted by Andygodber (not verified) on Tue, 01/11/2011 - 15:29.</div>
    <div class="content">
     <p>In that case, there's something wrong.</p>
<p>I wonder if Ive shafted the IRQ line - if I bridge the data to Vcc, its like the circuit is bouncing - instead of 1 pulse, it registers a random value - would I need to generate a 'clean', single pulse to prove this?</p>
<p>&nbsp;</p>
<p>Its odd - the rest of the functionality seems ok (although I do get occasional problems uploading sketches) - serial output ok, as is the RF12b to the Nanode.</p>
<p>Anyway, you'll see that Ive sent an email for a couple of new PCB's just in case.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2277"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hmm - was working now, isnt...</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 04/11/2011 - 00:38.</div>
    <div class="content">
     <p>&nbsp;New PCB's are in the post! RFM12 boards should be here in a week or so.</p>
<p>An easy way to test the puse counting is to use another Arduino or emonTX to generate a simple square wave pulse, try and get it to match the pulse your meter is suppost to be generating. Then connect this square wave to the emonTx puse input and see if it works. If you dont have another Arduino you could use a different digital output on the same emonTx although this might cause some strage timming issues..&nbsp;</p>
<p>Might be a good idea to read my post above rearding voltage. I think 3.3V could be a bit low for most meters. Follow the modification in the above post to change this I'm designing an voltage selectable jumper conneciton in for the next version of the emonTx. Proabably available beginning of next year.&nbsp;</p>
<p>Hope you get to the bottom of the problem.</p>
<p>Good luck.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/257"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-JkPxqKDKInyCCnQsXqoo2CTJfiMfO5j1-lV2dAKWtSg" value="form-JkPxqKDKInyCCnQsXqoo2CTJfiMfO5j1-lV2dAKWtSg"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
