<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/581 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:29:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonBase enc28j60 initialization issue | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonBase enc28j60 initialization issue</h3>
        <span class="submitted">Submitted by Guest on Thu, 12/04/2012 - 11:27</span>
        <div class="content"><p>Hi all,</p>
<p>Last week&nbsp;I received my&nbsp;monitor kit; everything is working fine except for the emonBase.&nbsp;I found out that&nbsp;the following piece of code&nbsp;hangs the ethernet&nbsp;initialization routine:</p>
<p>enc28j60.cpp:</p>
<p>&nbsp;&nbsp;&nbsp; while (!readOp(ENC28J60_READ_CTRL_REG, ESTAT) &amp; ESTAT_CLKRDY)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ;</p>
<p>I&#39;ve&nbsp;applied the capacitor fix&nbsp;as described in step&nbsp;25b of the emonBase&nbsp;build guide.&nbsp;When my finger&nbsp;touches the&nbsp;back of&nbsp;74HCT125 initialization suddenly succeeds.&nbsp;</p>
<p>Any suggestions?</p>
<p>Thanks in advance.</p>
<p>Nik</p>
  <div class="forum-topic-navigation clear-block">
          <a href="657.html" class="topic-previous" title="Go to previous forum topic">‹ Time setting on emonglcd</a>
              <a href="401.html" class="topic-next" title="Go to next forum topic">Alternative Power Supply ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-3789"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 12/04/2012 - 17:21.</div>
    <div class="content">
     <p>Mm might be a faulty chip. I&#39;ll send you out another to test.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3794"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Thu, 12/04/2012 - 18:18.</div>
    <div class="content">
     <p>Could it be a dry joint. If touching the chip makes it work it seems that its pressure thats making a contact. Have a look around.</p>
<p>Again you may have tried this so sorry for stating the obvious</p>
<p>.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3795"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hopslink&#039;s picture" title="hopslink&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by hopslink (not verified) on Thu, 12/04/2012 - 19:04.</div>
    <div class="content">
     <p>Your chip may not be fully seated in the IC holder. As above, apologies if you have tried this, but it can take a surprising amount of force to seat them fully.</p>
<p>Have a look all round it. If one corner / end seems higher than the other then make sure the legs are all entering their sockets correctly. If all the legs look ok give the high corner / end a firm push into the socket, support the back of the PCB in that area to ensure it doesn&#39;t snap.</p>
<p>Typically the back of the IC will sit around 1mm above the top of the socket.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3799"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nikschuiling&#039;s picture" title="nikschuiling&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by nikschuiling (not verified) on Fri, 13/04/2012 - 08:12.</div>
    <div class="content">
     <p>Thank you all for your quick responses.&nbsp;I&#39;ve already tested&nbsp;with a new&nbsp;74HCT125, but no difference. All chips seem to be seated&nbsp;fully in the IC&nbsp;holders.&nbsp;With touching the back of the chip, I mean touching the back of the PCB.&nbsp;By the way,&nbsp;I just ordered an additional kit to do some more testing.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3822"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jonathanfurness&#039;s picture" title="jonathanfurness&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by jonathanfurness (not verified) on Sat, 14/04/2012 - 11:11.</div>
    <div class="content">
     <p>NIk,</p>
<p>I thought it was just me, but I have EXACTLY the same issue. Fingers on the back of the board results in some activity in the serial window. I&#39;m still unsuccessful in getting my NanodeRF to initialize at all. No Ethernet, no nothing. Everything is seated, resoldered, tested voltages, all correct. It&#39;s odd that a few of us are struggling with this issue.</p>
<p>I&#39;d love to know what results in your building another kit, as that&#39;s my only resort now.</p>
<p>Thanks for posting, I feel like I&#39;m not alone now!</p>
<p>Jonathan</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3840"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="prensel&#039;s picture" title="prensel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by prensel (not verified) on Sun, 15/04/2012 - 11:37.</div>
    <div class="content">
     <p>Similar problems here, fresh build from kit received yesterday.</p>
<p>The RF part works but ethernet fails.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3876"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nikschuiling&#039;s picture" title="nikschuiling&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by nikschuiling (not verified) on Tue, 17/04/2012 - 14:24.</div>
    <div class="content">
     <p>Hi all,</p>
<p>This issue seems to be&nbsp;caused by&nbsp;faulty MCP1702 Voltage Regulators, see&nbsp;http://openenergymonitor.blogspot.com/2012/04/faulty-batch-of-mcp1702-voltage.html#!/&nbsp;for details. I jjust ordered my replacements and will test again soon.</p>
<p>@Glyn: thank you for quickly sending&nbsp;a new&nbsp;ENC28J60 chip. I just&nbsp;tested the new chip,&nbsp;but I guess you understand this didn&#39;t fix the problem ;-). By the&nbsp;way, the new&nbsp;ENC28J60 chip looked like it has been hit by a&nbsp;big truck (bended pins). Be careful with sending such small&nbsp;components.</p>
<p>Thanks all.</p>
<p>Nik</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3894"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Wed, 18/04/2012 - 20:03.</div>
    <div class="content">
     <p>I have assembled mine yesterday and i have the same problem.</p>
<p>It the board transmits anything it hangs rx and serial stays quiet. If i touch some parts of the board thr receive is activated again.. Very strange behavior, cost-me already a day of work.</p>
<p>I was looking for a software problem, looks its hardware based.</p>
<p>The 3.3v regulator near the ethernet chip stays very hot. Any suggestions</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3898"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 19/04/2012 - 07:42.</div>
    <div class="content">
     <p>Hello Pcunha, does the ethernet&nbsp;chip initialize? Do you get a DHCP lease?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4000"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Tue, 24/04/2012 - 13:38.</div>
    <div class="content">
     <p>Yes it did initialize, get IP from dhcp, in some cases reply to pings. but if i make it send packages it chashes.</p>
<p>I&acute;ve swaped the 3.3v regularors&nbsp;from the nanodeRF&nbsp;with the one of the Glcd&nbsp;and the problem was solved.</p>
<p>one more regulator problem...</p>
<p>Be wise that the regulator problem not always cause the chip to fail in initialization.</p>
<p>Thanks you all.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4161"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="schepparn&#039;s picture" title="schepparn&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by schepparn (not verified) on Wed, 02/05/2012 - 09:13.</div>
    <div class="content">
     <p>I have gone through quite a few Nanode boards side by side and noticed the same problem on them (initializing DHCP but getting stuck on DNS) and I believe I have a few experiences that could be interesting for this disussion.&nbsp;</p>
<p>While I think that the voltage regulator could alleviate the problem I think that the real problem is the design of the power traces on the PCB from the USB contact and more or less sensitive ethernet chips causing it.</p>
<p>Why do I say that?</p>
<p>Well by switching power supplies to ones with more stable voltage output (USB power plugs has quite a large voltage range, especially cheap ones) I managed to get the DNS working.</p>
<p>This doesn&#39;t rule out the voltage regulator though!?</p>
<p>However, when I switch a fully functional ENC28 to a board with DNS problems it runs without hesitation.</p>
<p>Also, when looking at the schematic of the Nanode RF it is clear that the originally intended power input should be around where the diode is (pin 0V = ground and VIN). Here it has extra wide traces compared to the miniscule ones running all over the board from the USB and programming pins. By powering the board with the same, previously unstable, USB supply it now works. See attached picture for more details.&nbsp;I have a couple of other hacks here that shouldn&#39;t be confused with this power hack (switched the 5V voltage regulator and tristate buffer&nbsp;for bridges - I&#39;m not using this functionality).</p>
<p>I&#39;m not saying that the regulator fix is not working, it obviously is (maybe I didn&#39;t get any faulty regulators in the whole batch). I just wanted to point out that there might be other things to try before heating up those trusty MCP1702 :)</p>
<p>Hope that helps someone!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4163"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Wed, 02/05/2012 - 11:37.</div>
    <div class="content">
     <p>I&#39;m either going mad, or there is no attached picture.&nbsp; Quite keen to see what you have done.</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4179"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="schepparn&#039;s picture" title="schepparn&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by schepparn (not verified) on Thu, 03/05/2012 - 06:44.</div>
    <div class="content">
     <p>I don&#39;t know what is wrong, I can&#39;t seem to see it either. If you can&#39;t see it in this post just send me an email at schepparn-&gt;gmail and I&#39;ll send it to you directly.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4214"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Fri, 04/05/2012 - 15:57.</div>
    <div class="content">
     <p>Here is schepparn&#39;s&nbsp;picture</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4230"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="schepparn&#039;s picture" title="schepparn&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by schepparn (not verified) on Sat, 05/05/2012 - 10:58.</div>
    <div class="content">
     <p>Team work :) - thanks!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4244"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonBase enc28j60 initialization issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Sun, 06/05/2012 - 11:28.</div>
    <div class="content">
     <p>I&#39;m intrigued that if I use an external 10v psu, through the 7805 with heatsync, my emon base fails almost permanently. &nbsp;I had expected it to be at least as good as a random usb psu, which works most of the time. &nbsp;I have not got a scope to view the output of the 10v supply, but I would not have expected it to be that bad. &nbsp;It is not a random unbranded unit.</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/581"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-SwYijhfBi32F4GowF9YriVI9kzG66Sg3TS-AIT3EVJ4" value="form-SwYijhfBi32F4GowF9YriVI9kzG66Sg3TS-AIT3EVJ4"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
