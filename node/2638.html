<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2638 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:45:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>New emonTX continous monitor software 3CT &amp; Voltage | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">New emonTX continous monitor software 3CT &amp; Voltage</h3>
        <span class="submitted">Submitted by <a href="../user/733.html" title="View user profile.">ianjm</a> on Tue, 30/07/2013 - 11:56</span>
        <div class="content"><p>Hi, I have found a problem with emonTX when I started testing my PV diverting hardware and have written a new version that provides a solution by continuously&nbsp;monitoring 3 CT inputs + voltage. &nbsp;I have been running this for a few weeks now and thought I should post it for others to look at, comment on, suggest improvements and use if they wish to.</p>
<p>When I started to test my PV divert software I found the readings on my emonGLCD were very erratic with the original software. &nbsp;</p>
<p>My PV diverter&nbsp;is fed through the house consumer unit so it was reading house load + divert load on CT1, PV on CT2 and divert load on the third CT3. &nbsp;I changed the emonGLCD to deduct the CT3 from CT1. &nbsp;With steady loads on the divert hardware everything works fine with the original emonTX software. &nbsp;It was when I started to test my&nbsp;SSR based diverter with faster load changes that I noticed that readings from the emonTX were wrong.</p>
<p>The standard emonTX &nbsp;software is written to monitor CT1 for 20 cycles/crossings then moves onto CT2, then CT3. &nbsp;At the end it reports data via the wireless hardware. &nbsp;My test software highlighted that this method of monitoring power is not suitable where PV is being diverted and in my setup just compounded the problem as the divert value measured with CT1&nbsp;is not the same as measured with CT3. &nbsp;I was just getting large errors in the data.</p>
<p>Moving my divert hardware onto a separate&nbsp;feed from my house would alleviate the problem (expensive) but the only true solution would be to read all 3 CTs at the same time.</p>
<p>The only way to do this though would be have 3 synchronized&nbsp;emonTX devices or to make the emonTX hardware read data faster. &nbsp;I think I have put together a viable solution that just runs the data capture faster by reducing the time analog reads are taken. &nbsp;This still gives over 50 sets of readings per cycle for each CT and tripple that for the voltage values.</p>
<p>The only problem encountered was what to set the voltage phase shift value to for faster read times. &nbsp;I used 1.28 - I don&#39;t know if this is correct but it seems to work well. &nbsp;In the original software I never bothered to change it and had no problems with accuracy once calibrated. &nbsp;Can anyone shed some light on what this should be please.</p>
<p>I have just done a calibration check of my PV values over 5 days. From my original calibration done two weeks ago it is within 1% of the PV meter. &nbsp;I measured&nbsp;84.03 from daily totals PV off my emonGLCD and&nbsp;83.4 from the PV export meter. &nbsp;Otherwise I have noticed that when less than 500 watts the value is slightly high and for very large values the reading is slightly low when compared to the reading on the export meter and inverter.</p>
<p>Please have a look, use and post comments</p>
<p>Ian</p>
  <div class="forum-topic-navigation clear-block">
          <a href="1160.html" class="topic-previous" title="Go to previous forum topic">‹ Adding new visualisations to emoncms</a>
              <a href="2642.html" class="topic-next" title="Go to next forum topic">Problem to upload my sketches ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-13939"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 30/07/2013 - 13:15.</div>
    <div class="content">
     <p>MartinR&#39;s PLL sketch does this - but genuinely continuously, meaning that all (in his case two c.t&#39;s) and the voltage are each sampled in sequence. You can find his sketch here: <a href="1535.html">Solar PV power diversion with emonTx, emonGLCD and temperature measuremen</a>t</p>
<p>And an earlier post giving a bit more details on the phase-locked loop here: <a href="1377.html">Phase-locking emonTx to the 50Hz supply</a></p>
<p>It should be quite easy to extend that to 3 c.t&#39;s, Dan Woodie is doing that now <a href="2624.html" title="http://openenergymonitor.org/emon/node/2624">http://openenergymonitor.org/emon/node/2624</a></p>
<p>Martin has also done 3 synchronised emonTx&#39;s, but for monitoring only on a 3-phase supply: <a href="http://openenergymonitor.org/">Full-fat 3-phase monitor</a>.</p>
<p>You can read up on the phasecal algorithm in Building Blocks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13946"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ianjm&#039;s picture" title="ianjm&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/733.html" title="View user profile.">ianjm</a> on Tue, 30/07/2013 - 19:49.</div>
    <div class="content">
     <p>Thanks Robert</p>
<p>I&#39;ve had a quick look at those and they contain some low level code that I don&#39;t fully understand to control the transmission of data using RF12.</p>
<p>The sequence of reading data and applying voltage offsets also seems a bit confusing and follows</p>
<p>Wait for time interupt - voltage read initiated<br />
	ADC interrupt for voltage - start CT1 read<br />
	Process voltage reading - calcs include power calcs for the previous CT1 and CT2 readings<br />
	ADC interrupt for CT1 - start CT2 reading<br />
	Process CT1 data<br />
	ADC interrupt for CT2&nbsp;<br />
	Process CT2&nbsp;data<br />
	Wait for next timer interrupt</p>
<p>This seems confusing to me or do the CT1/2 readings really lag the voltage by that much?</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13948"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 30/07/2013 - 21:55.</div>
    <div class="content">
     <p>The ADC is semi-autonomous and it is allowed to free run. When it completes a measurement, it throws an interrupt, switches the multiplexer to the next channel and carries on with the next reading, in the meantime the main loop processes the result and then hangs about doing nothing particularly useful while it waits for the next conversion result. But you need to tell the ADC what it&#39;s going to switch the multiplexer to before it&#39;s finished the conversion it is on, hence the next instruction to the multiplexer appears to be one step ahead of processing the result.</p>
<p>This actually goes a lot quicker than the standard library routines because in that mode, the ADC completes its conversion, returns to the library routine called by the sketch, the answer is processed, then it send the instruction for the next conversion, the ADC goes away and does it, etc.</p>
<p>The low level code for the RFM12B is doing exactly what is needed and nothing more. It is simply more efficient than the library routines, which have to cater for every possible situation.</p>
<p>It works well. In Dan&#39;s thread, Martin reports that he tried Dan&#39;s code with 3 c.t&#39;s and at 60 Hz, and there was plenty of time to spare, but that was with 25 samples per cycle I believe. Martin&#39;s original works with 2 c.t&#39;s and 50 samples at 50 Hz,</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13949"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3367.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3367.jpg" alt="Dan Woodie&#039;s picture" title="Dan Woodie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/3367.html" title="View user profile.">Dan Woodie</a> on Wed, 31/07/2013 - 04:13.</div>
    <div class="content">
     <p>I am currently running Martin&#39;s code in a 120 V / 60 Hz environment, but with only 2 CTs running. As I posted in my original thread asking for assistance, I could not get it running with 3 CTs, but that was probably more due to errors in my code additions than any fundamental hardware limitation that cannot be overcome. I am currently running a 3+ day benchmark on this code versus my electric utility meter and a Fluke 3 phase power analyzer. I then plan on running a similar benchmark on the standard sketch and some other variants, with intentions to share all that I learn here in the forums.</p>
<p>Dan</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13951"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Wed, 31/07/2013 - 07:42.</div>
    <div class="content">
     <p>ianjm wrote: <em>This seems confusing to me or do the CT1/2 readings really lag the voltage by that much?</em></p>
<p>The way this works is that the ADC goes through the repeated sequence Volts,CT1,CT2,Volts etc. After each voltage reading the sketch determines what the voltage would have been at the current sampling points by linear interpolation between 2 consecutive voltage samples. The interpolation fraction is made up from a fixed delay due to the ADC read sequence, plus a delay dependent on the relative phase shift of the current and voltage transformers.</p>
<p><a href="../user/1936.html">mad_dad</a>&nbsp;(Paul) is also looking at a 3-CT solution <a href="1535.html">on the main thread</a> so you (and Dan) might want to look at what he&#39;s done.</p>
<p>Oh, and thanks for all your support Robert.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13954"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ianjm&#039;s picture" title="ianjm&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/733.html" title="View user profile.">ianjm</a> on Wed, 31/07/2013 - 11:21.</div>
    <div class="content">
     <p>Thanks everyone - theres some really&nbsp;good work being done that I have missed</p>
<p>My PV diverter using an SSR&nbsp;and should be on a PPL as its very sensitive to late control pulses and misses a cycle - I will convert to interrupt driven.</p>
<p>I have had a look at Martin&#39;s PPL code and the building blocks and still cannot see how the phase correction number is derived.</p>
<p>Martin In your&nbsp;PPL version where the phase shift is calculated behind the current voltage reading the phase shift is&nbsp;I1PHASESHIFT (((5+63)*256)/400) and&nbsp;I2PHASESHIFT (((5+127)*256)/400)&nbsp;<br />
	These work out as the last voltage + 0.17 &amp; 0.33 the difference between the last and current voltage difference<br />
	why 5&nbsp;<br />
	if the ADC is running at around 60 micro seconds then 63 &amp; 127 means your board at 63.5 is that correct?</p>
<p>In my sketch I read the voltage before the current and use 1.2 to move the voltage forward&nbsp;</p>
<p>In the&nbsp;Mk2i_PV_Router_rev5b sketch a value of 1 is used - no phase movement (this sketch is using standard ADC timings)</p>
<p>Does anyone know how I should calculate values for the standard CTs from openenergyorg&nbsp;shop</p>
<p>Thanks</p>
<p>Ian</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13956"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 31/07/2013 - 13:18.</div>
    <div class="content">
     <p>There are two &quot;phase&quot; shifts to consider. The one is actually a time shift between readings, the other is the difference between the phase shifts of the v.t. and c.t. Those two are variable, depending on the voltage and current respectively. You can read up about those in the reports on the two sensors. So yes, if you can say at what voltage and current you want the correction to be accurate, you can see what the time difference needs to be that will give you the best correction. At any other value, it will be wrong. However, Robin has found, given that most domestic loads that draw a substantial power are very close to unity power factor anyway, that the phase correction in practice makes little difference to the operation of his diverter. If you are interested in measuring smaller loads that can have a very poor power factor, then the phase correction assumes a greater importance.</p>
<p>I should point out that both Martin&#39;s and Robin&#39;s designs only use the signal from one c.t. on the common grid connection to control the dump load. Martin&#39;s uses the second purely for indication.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13958"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3367.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3367.jpg" alt="Dan Woodie&#039;s picture" title="Dan Woodie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/3367.html" title="View user profile.">Dan Woodie</a> on Wed, 31/07/2013 - 15:55.</div>
    <div class="content">
     <p>I did determine (or best guess) that the equation you listed:</p>
<p>I1PHASESHIFT (((5+63)*256)/400) and I2PHASESHIFT (((5+127)*256)/400)</p>
<p>the 400 value represents the time in microseconds between sampling points. The 5 represents the amount of phase lag inherent between the two transformers (I would assume that is mostly hardware dependent) and the 127 is the timing difference the sampling times. Martin and others please correct me if I am wrong. So changing to the 60 Hz frequency I had to adjust the 400 in the denomenator to 333, as my samples are closer together at 60 Hz.</p>
<p>Dan</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13959"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Wed, 31/07/2013 - 16:08.</div>
    <div class="content">
     <p>Ian,</p>
<p>The values of 5 for I1LEAD and I2LEAD are just placeholders, they should be replaced by the actual number of microseconds that current leads voltage by at the inputs to the ATmega328. The PHASECAL value of 1.7 used in the standard sketches is equivalent to an IxLEAD value of about 158, so that might be a good start. Maybe I should have used that as the default.</p>
<p><em>if the ADC is running at around 60 micro seconds then 63 &amp; 127 means your board at 63.5 is that correct?</em></p>
<p>I&#39;m not quite sure what you mean by that but 63.5 microseconds is the delay between consecutive ADC samples so the third CD will require a fixed delay of 190.</p>
<p>The sum of IxLEAD plus the fixed delay can&#39;t exceed 400 microseconds so there may be an issue with the third CT if IxLEAD exceeds 210 microseconds.</p>
<p>-martin</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13961"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Wed, 31/07/2013 - 16:20.</div>
    <div class="content">
     <p>Dan,</p>
<p>You posted while I was typing.</p>
<p>I&#39;m not sure 333 is the correct value for your sketch. You have 25 samples in 16.666r milliseconds so I make that 666 microseconds between samples?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13963"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 31/07/2013 - 16:38.</div>
    <div class="content">
     <p>Surely 25 samples in 16.666 <strong>milli</strong>seconds, so&nbsp; 666 microseconds per set of 4 samples?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13966"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ianjm&#039;s picture" title="ianjm&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/733.html" title="View user profile.">ianjm</a> on Wed, 31/07/2013 - 17:05.</div>
    <div class="content">
     <p>Thanks for info Robert</p>
<p>I&#39;ve now had a good read of the&nbsp;Yhdc SCT-013-000 Current Transformer page</p>
<p>Looking at the&nbsp;SCT-013-000 CT with a burden resister of 18 ohms it looks like a 2 degree leading shift for higher currents and up to 4 degrees at lower currents. &nbsp;With 1 degree arc at&nbsp;50Hz&nbsp;being 20000/360 = 55.5&nbsp;&micro;s<br />
	2&ordm; to 4&deg; is 111 to 222&micro;s - on standard reads of about 113&micro;s that&#39;s a lag of 1 or 2 sample periods.<br />
	Running the ADC faster at PS_64 gives about 60&micro;s per reading that is nearly 2 to 4 sample periods!</p>
<p>Is this maths correct?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13968"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Wed, 31/07/2013 - 19:09.</div>
    <div class="content">
     <p>The absolute phase shift is not important Ian, what matters is the <strong>difference</strong> in phase shift between voltage and current.</p>
<p>Also, the sample period for a complete set of results (i.e the time between voltage samples) is around 400&micro;s so the phase difference is usually less than that and that&#39;s what&#39;s important if you are going to interpolate between voltage samples.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13970"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3367.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3367.jpg" alt="Dan Woodie&#039;s picture" title="Dan Woodie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/3367.html" title="View user profile.">Dan Woodie</a> on Wed, 31/07/2013 - 20:05.</div>
    <div class="content">
     <p>Martin,</p>
<p>The math I used was this:</p>
<p>For a 50 Hz mains and 50 samples per cycle:</p>
<pre>
50 Hz * 50 samples/wave = 2500 Hz (samples taken per second)
1/2500 Hz = 0.0004 seconds = 0.4 milliseconds = 400 microseconds between sample interrupts</pre><p>For a 60 Hz mains and still 50 samples per cycle:</p>
<pre>
60 Hz * 50 samples/wave = 3000 Hz
1/3000 Hz = 0.000333 seconds = 0.333 milliseconds = 333 microseconds between sample interrupts</pre><p>So, higher mains frequency while holding the samples per wave to 50 leads to a shorter interval between sampling interrupts. It made sense at the time. I left the phase error of the CTs at the 5 microseconds you had in the code since I didn&#39;t believe my alternate CTs to be that different. I do not have the equipment to accurately measure that but it seemed to be OK on the standard sketch. Let me know if you think I made any errors here. Thanks.</p>
<p>Dan</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13971"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ianjm&#039;s picture" title="ianjm&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/733.html" title="View user profile.">ianjm</a> on Wed, 31/07/2013 - 20:26.</div>
    <div class="content">
     <p>Thanks Martin</p>
<p>I&#39;ve now read the Mascot adaptor&nbsp;page and from my experience it fluctuates between low 230 to low 240 - from the graph of voltage against lead that would seem to be just above 4 to just less than 5&ordm; lead on the voltage.<br />
	Adjusting this with the CT lead of between 2 and 4 the combined spans worst case high voltage + high current (5 &amp; 2) net 3 (voltage leading the current) and best of low voltage + low current (4 &amp; 4) in phase.</p>
<p>Pitching a middle ground of 1.5 gives about 83&micro;s of voltage leading current. &nbsp;Do you think this is &nbsp;reasonable assumption?</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13977"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Thu, 01/08/2013 - 06:59.</div>
    <div class="content">
     <p>Dan,</p>
<p>Your maths is correct but in the sketch that you posted you are using 25 samples/cycle...</p>
<p>#define NUMSAMPLES 25 // number of times to sample each 50Hz cycle</p>
<p>...that&#39;s what Robert and I were responding to. If you&#39;re running with 50 samples and 3 CTs in a 16ms cycle then you are doing much more per cycle than my code so you need to make sure that you&#39;re not running out of time anywhere.</p>
<p>&nbsp;</p>
<p>Ian,</p>
<p>There&#39;s nothing wrong with your reasoning and 83&micro;s is certainly within the range I have seen. It may not be the optimum value but it&#39;s probably close enough.</p>
<p>-martin</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13980"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ianjm&#039;s picture" title="ianjm&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/733.html" title="View user profile.">ianjm</a> on Thu, 01/08/2013 - 12:45.</div>
    <div class="content">
     <p>Thanks Martin</p>
<p>You said&nbsp;<em><strong>&quot;It may not be the optimum value but it&#39;s probably close enough&quot;</strong></em><br />
	Could you suggest a better value for general use please?</p>
<p>I can see now that for some CTs it will be possible to use a better value - A CT measuring my immersion circuit will always have full cycles at a fairly constant current so it should be easy to set a better phase adjustment value around the mid point of voltage fluctuations.</p>
<p>The house CT is difficult as its low except when a heavy usage appliance is switched on. &nbsp;Is it possible to cater for this?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13997"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 01/08/2013 - 23:39.</div>
    <div class="content">
     <p>Ian,</p>
<p>I think you&#39;re expecting too much from an &quot;economy&quot; c.t. Any split-core c.t. will struggle to maintain accuracy over a large range, you could look at the Magnelab range that Robin thinks are better constructed - especially the &quot;revenue&quot; grade.&nbsp; Alternatively, you need to look at a ring core one, which will almost certainly be better in any case, and you can get - for a price - very high precision in that format. (And for obvious reasons - there&#39;s no iffy joint in the magnetic path that can introduce a variable air gap.) You&#39;d need a registered sparks to install it for you though, as it would mean breaking your electricity provider&#39;s seals to thread the meter tail through it.</p>
<p>But beware - many have a maximum 0.333 V rms output so will only use less than one third of the emonTx&#39;s input range.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14017"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ianjm&#039;s picture" title="ianjm&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/733.html" title="View user profile.">ianjm</a> on Fri, 02/08/2013 - 15:24.</div>
    <div class="content">
     <p>Thanks Robert</p>
<p>I&#39;m not expecting a budget CT to be supper accurate and my question wasn&#39;t&nbsp;about that.</p>
<p>I am more concerned at getting the correct value for phase shift or now as I have learnt more the best compromise value.<br />
	&nbsp;</p>
<p>I now realise that my 3CT&nbsp;sketch is using the wrong phase shift value by a large measure - it is however accurate at measuring daily KWh totals for my PV due to its calibration - it however shows low at higher values and too high for low values.&nbsp;</p>
<p>Ian</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14022"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 02/08/2013 - 18:17.</div>
    <div class="content">
     <p><em>my question wasn&#39;t about that.</em>&nbsp; Well, I think it was, at least in part, because phase error is an integral part of the transformer accuracy specification, and a revenue grade c.t. will show a much smaller and nearly constant phase error.</p>
<p>Your problem now looks more like the familiar problem of noise pickup in the c.t. inputs rather than a problem with the c.t. itself. It&#39;s been known for a long time that there are two effects - mains voltage pickup that can be minimised in a single phase installation by measuring the neutral rather than the line, and digital noise from the processor itself. Unfortunately, there is little that can be done about that, though extra decoupling on the 3.3 V rail might help. Unfortunately because it is noise and uncorrelated with the input signal, it appears as a current with a random phase, usually manifesting itself as a power error of a few watts and a somewhat larger VA error.</p>
<p>In addition, there are systemic errors in the A-D conversion process, see:<br />
	<a href="https://learn.openenergymonitor.org/?redirect=measurement-implications-of-adc-resolution-at-low-current-values" title="http://openenergymonitor.org/emon/buildingblocks/measurement-implications-of-adc-resolution-at-low-current-values">http://openenergymonitor.org/emon/buildingblocks/measurement-implication...</a><br />
	<a href="../emontx/accuracy.html" title="http://openenergymonitor.org/emon/emontx/accuracy">http://openenergymonitor.org/emon/emontx/accuracy</a><br />
	<a href="1385.html" title="http://openenergymonitor.org/emon/node/1385">http://openenergymonitor.org/emon/node/1385</a><br />
	<a href="2311.html" title="http://openenergymonitor.org/emon/node/2311">http://openenergymonitor.org/emon/node/2311</a><br />
	Trystan did some wonderful animated pages demonstrating how the errors vary here:&nbsp; <a href="http://vis.openenergymonitor.org/dev/adc/noiseless" title="http://vis.openenergymonitor.org/dev/adc/noiseless">http://vis.openenergymonitor.org/dev/adc/noiseless</a>, here: <a href="http://vis.openenergymonitor.org/dev/adc/noisy" title="http://vis.openenergymonitor.org/dev/adc/noisy">http://vis.openenergymonitor.org/dev/adc/noisy</a> and here: <a href="http://vis.openenergymonitor.org/dev/adc/noise.mp4" title="http://vis.openenergymonitor.org/dev/adc/noise.mp4">http://vis.openenergymonitor.org/dev/adc/noise.mp4</a>.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14069"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ianjm&#039;s picture" title="ianjm&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonTX continous monitor software 3CT & Voltage</h3>

    <div class="submitted">Submitted by <a href="../user/733.html" title="View user profile.">ianjm</a> on Sun, 04/08/2013 - 16:39.</div>
    <div class="content">
     <p>Thanks for the info Robert</p>
<p>Sorry about the delay I went live on PV diverting to my HW tank at about 5:30 pm on Friday - very pleased with how its working.<br />
	Saturday (mixed sun and cloud) I had over 9kWh&nbsp;diverted, I wasn&#39;t expecting that much-:) &nbsp;<br />
	Today is very cloudy but even so its diverting with low surplus available.. &nbsp;Red light seems to be solid on my meter so my divert sketch looks as though its working well.</p>
<p>I had read about keeping all CTs on the neutral line and all mine are. &nbsp;The animated pages look nice - I haven&#39;t quite worked out what they are trying to tell me.</p>
<p>I still cannot see how a phase shift value above 1 can be achieved when both CT and AC adaptors are giving +ve phase shifts and the voltage shift is larger. &nbsp;I will draw a diagram and someone can tell me if I am not thinking down the correct lines.</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2638"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Q9ObT9_3u_KENM6NP-QmrnDS1-oSeCs1O935HMxuUbA" value="form-Q9ObT9_3u_KENM6NP-QmrnDS1-oSeCs1O935HMxuUbA"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
