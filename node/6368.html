<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6368 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:38:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Extremely high values being read from CT at random intervals | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Extremely high values being read from CT at random intervals</h3>
        <span class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Sat, 27/12/2014 - 11:58</span>
        <div class="content"><p>Hi,</p>
<p>I have an emonTX shield running 4 CTs monitoring 3 phase + 1 for off peak hot water, with voltage monitoring and 230v (Australia).</p>
<p>In my prior tests, everything has been working fine. I have now moved the CTs to the meter box and am seeing some weird values being read on the blue phase. Here is a link to the graph:&nbsp;</p>
<p><a href="http://emoncms.org/vis/auto?feedid=63828" title="http://emoncms.org/vis/auto?feedid=63828">http://emoncms.org/vis/auto?feedid=63828</a></p>
<p>As you can see, there are a number of spikes which completely throw out the measurements. Here&#39;s a link to the other two phases for reference:</p>
<p><a href="http://emoncms.org/vis/auto?feedid=63790" title="http://emoncms.org/vis/auto?feedid=63790">http://emoncms.org/vis/auto?feedid=63790</a></p>
<p><a href="http://emoncms.org/vis/auto?feedid=63785" title="http://emoncms.org/vis/auto?feedid=63785">http://emoncms.org/vis/auto?feedid=63785</a></p>
<p>I&#39;m not sure what could be causing this. Maybe a faulty input on the Arduino? I have tried switching the CTs between phases, so that has been ruled out as the issue.</p>
<p>Any assistance is much appreciated. Let me know if there is any additional information that is required.</p>
<p>Cheers</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6401.html" class="topic-previous" title="Go to previous forum topic">‹ RFM12Pi group and baseid</a>
              <a href="6345.html" class="topic-next" title="Go to next forum topic">What hardware would I need to monitor? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26160"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 27/12/2014 - 12:14.</div>
    <div class="content">
     <p>It might not even be your Arduino! What are the units of the 'y' axis, Watts? The maximum you can measure, given 230 V and the input scaled for a 100 A CT, is 23 kW. OK, there's some 'headroom' above that but you won't get anywhere near 800 kW from the maths. I think you can rule out the ADC and the input side.<br />
So if you are reading 800 kW it's either the Arduino inventing big numbers - meaning it is picking up interference that is coming in via your electricity supply, or your base is picking up something that's being interpreted as a transmission from your Shield. Does your electricity company put HF signals on the network for control purposes? If so, you could be picking that up.</p>
<p>You could add a software limit inside your Arduino sketch - that would indicate whether it is the Arduino (the peaks get clipped at the limit you set) or not.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26162"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Sat, 27/12/2014 - 12:28.</div>
    <div class="content">
     <p>Thanks for the quick reply!</p>
<p>The y axis is indeed watts. The 3 phase MCB&nbsp;is only rated to 80A, and there aren&#39;t any loads which would come close to that on that phase.&nbsp;</p>
<p>There are no HF signals where I live. Off peak power is controlled by a timer supplied by the distribution provider and is located in the meter box. Not sure if this timer may be emitting some interference, but the timer sits on the red phase, whereas the &#39;noise&#39; is on the blue phase.&nbsp;</p>
<p>Can&#39;t be the base picking up random signals, as the arduino is connected directly to an OpenWRT&nbsp;router via USB running emonhub to submit the values to emoncms.&nbsp;</p>
<p>Wonder if I can put in the sketch something like this:</p>
<p>if value &gt; 10000, then use the last value measured for that phase.&nbsp;</p>
<p>although it would be preferred to get to the root of the issue. I have ordered a (knockoff) Arduino Leonardo to rule out the ADC on that channel.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26163"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 27/12/2014 - 12:46.</div>
    <div class="content">
     <p><i>"although it would be preferred to get to the root of the issue. I have ordered a (knockoff) Arduino Leonardo to rule out the ADC on that channel."</i></p>
<p>Yes, finding the cause is best, but wrong about the ADC. In the 328P at least, there is only one ADC, it is switched between inputs (see the Atmel data sheet).</p>
<p>And that is indeed the sort of limit I was thinking about (but I would force it to zero so that you at least know about it). Looking more closely at your data, the rogue numbers all appear to be single values, but there also appear to be some single zero values. This might be telling us something.</p>
<p>What values is emonHub getting, can you monitor and check? If you can see exactly what is coming in, that might indicate the area to look at. IS the data sent as ASCII characters or bytes? Is the USB link dropping characters and it's concatenating consecutive numbers? We need to ask Paul (pb66) about that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26165"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Sat, 27/12/2014 - 13:14.</div>
    <div class="content">
     <p>Looking at the logs, it appears there is some weird rounding going on. Here&#39;s an example of a line with the blown out value for CT3</p>
<p>
2014-12-27 09:49:34,350 INFO emonCMS sending: http://emoncms.org/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1419635974.2000002,5,672.63,227.98,194.85,-24.48,242.08,20.1,38.9,19.5,23.5]]&amp;sentat=1419635974</p>
<p>&nbsp;</p>
<p>The headers for the arduino values are: [[Node ID, CT1 power, CT2 power, CT3 power, CT4 power, Voltage, temp, humidity, &nbsp;temp, temp]]</p>
<p>here is the full log (~4mb)&nbsp;(you&#39;ll see what I mean by weird rounding with excessive decimal points):&nbsp;http://www.users.on.net/~teepingkoh/emonlog.txt</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26174"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 27/12/2014 - 17:00.</div>
    <div class="content">
     <p>Weird indeed. (Sorry, but I'm not going to wade through 4 MB of data!) You need to discover where that corruption is happening, have you put a limit on the Arduino output?</p>
<p>Have you got anything that could be causing conducted or radiated interference? I think it is an appliance. Looking at the emoncms output, there appears to be a fairly regular pattern. There is a bunch of spikes about 4 mins apart (sometimes it misses one or two, so 8 mins, and sometimes there's one in between, then there is a gap of about 40 mins. You are looking for something that is cycling, running for about 15 mins every hour (give or take 10 mins), a boiler or aircon, or a fridge or freezer? If you can't tie it down to something of yours, is it a neighbour's? </p>
<p>Which phase is your Arduino powered off?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26185"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Sun, 28/12/2014 - 01:38.</div>
    <div class="content">
     <p>The only thing that has changed is that now I am using a router with emonhub on it which is connected back to the internet via Wifi which sits in the meter box with the arduino, so within 10cm&nbsp;of each other. Previously I was using a laptop which sat a meter or so away. The router + arduino is inside an oldish metal meter box outdoors.</p>
<p>The only cyclic appliances would be fridges. Hot water is solar, so we have the booster off for the summer to conserve power.&nbsp;</p>
<p>Arduino is powered off the router via USB, which is powered off phase 1. Maybe it would help powering the arduino directly.&nbsp;</p>
<p>Are you sure that the rounding issues would be caused by inteference? Would wifi be able to cause this kind of inteference?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26186"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Sun, 28/12/2014 - 06:49.</div>
    <div class="content">
     <p>Hmm interesting. I have wrapped the arduino&nbsp;in aluminium foil and grounded it to make a faraday cage of sorts. seems that the spikes have stopped for now.&nbsp;</p>
<p><a href="http://emoncms.org/vis/auto?feedid=63828" title="http://emoncms.org/vis/auto?feedid=63828">http://emoncms.org/vis/auto?feedid=63828</a></p>
<p>check the last few hours</p>
<p>&nbsp;</p>
<p>edit: looks like i spoke too soon. I will edit the code tomorrow and see how it goes. Weird that it&#39;s only on a single phase though.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26195"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 28/12/2014 - 13:52.</div>
    <div class="content">
     <p>Hi Guys, interesting stuff!</p>
<p>I&#39;m inclined to agree with Robert about the stray values being interference and suspect they are more likely to be conducted rather than radiated&nbsp;(therefore<span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">&nbsp;</span>unfoiled<span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">&nbsp;by the foil), It would be good to see the input as well as the output values from emonHub&#39;s logs to confirm the issue is not related to the rounding issue we see.</span></p>
<p><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">The rounding is odd and I believe peculiar to your set-up (as far as I&#39;m aware) which makes me wonder if openWRT&nbsp;does something different with floats. None of the values with additional decimal places are significantly changed. This is illustrated&nbsp;with the unix time stamps, derived from <a href="https://docs.python.org/2/library/time.html#time.time">time.time()</a>&nbsp;and&nbsp;although the precision isn&#39;t enforced in emonHub&nbsp;the &quot;natural&quot; level of precision I have&nbsp;experienced&nbsp;in windows and linux&nbsp;has always been 3 decimal places, but in your log we can clearly see 7 places, frequently.</span></p>
<p><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">I took a small sample from your data and stuck it in excel (sidenote - excel wouldn&#39;t even display the extra decimal places as the significance was so minor). In the sample I took there were 4 obviously abnormal occurrences, in</span><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">&nbsp;the attached excerpt, you can see by the preceding&nbsp;and following datapoints&nbsp;there was nothing abnormal outside the fact that the ct3 value is momentarily out of range.&nbsp;ie no effect to other phases, no missing packets, no concatenating of values etc.</span></p>
<p><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">Could you run emonHub with loglevel set to DEBUG? and then from emonCMS&nbsp;identify a &quot;spike&quot; and find that packets full journey through emonhub in the log by&nbsp;</span><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">the timestamp</span><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">&nbsp;to confirm the value is passed faithfully by emonHub.</span></p>
<p><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">If you are confident this was previously working ok you could try switching back to the previous set-up to&nbsp;confirm that is still the case&nbsp;and then&nbsp;either switch to using the laptop with the CT&#39;s where they are now or move the router so that you can put the ct&#39;s back where they were previously to try and narrow the search.</span></p>
<p><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">Paul</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26197"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Sun, 28/12/2014 - 15:23.</div>
    <div class="content">
     <p>Thanks for the insight Paul! I have change the log level to debug, so I will let that run overnight and post the relevant bits of the log in the morning.</p>
<p>&nbsp;for now, here&#39;s a single entry with the extra precision being added:</p>
<p>2014-12-29 01:50:41,623 DEBUG 338 NEW FRAME : 1419780041.62 5 947.24 132.67 388.81 -24.25 243.72 19.40 58.40 17.75 24.37<br />
2014-12-29 01:50:41,628 DEBUG 338 Timestamp : 1419780041.62<br />
2014-12-29 01:50:41,632 DEBUG 338 &nbsp; &nbsp; &nbsp;Node : 5<br />
2014-12-29 01:50:41,636 DEBUG 338 &nbsp; &nbsp;Values : [947.24, 132.66999999999997, 388.81, -24.25, 243.72, 19.4, 58.4, 17.75, 24.37]</p>
<p>So it would appear to be something in the script processing which is doing that. WIll need to see in the morning with an abnormal reading to confirm.</p>
<p>With the previous setup, I was using the older oemgateway script running on os x. I can try running the oemgateway script on openwrt, or emonhub on my laptop to try and pinpoint if openwrt is doing something odd.</p>
<p>Will report back with logs in the morning!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26198"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 28/12/2014 - 15:38.</div>
    <div class="content">
     <p>I think the data above confirms that the python float behaves differently on openWRT&nbsp;the value &quot;132.67&quot; is fine as a string but when converted to a float it becomes &quot;132.66999999999997&quot; which is incorrect, some would say &quot;near enough&quot; but none the less it&#39;s not &quot;132.67&quot;. This is not seen on windows or raspbian. I do not know enough about openWRT&nbsp;or the &quot;floats&quot; minefield to offer an explanation or a solution I&#39;m afraid. I don&#39;t think forcing emonhub to round at a&nbsp;preselected&nbsp;level is the answer as this would then produce unfaithful results for higher precision floats.</p>
<p>Although you may get a very very small level of inaccuracy introduced by the precision I think this will be lost in the overall results and only poses an increase in the number of characters posted to emoncms from emonHub and is most&nbsp;probably unconnected to the issue in hand.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26211"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Mon, 29/12/2014 - 04:36.</div>
    <div class="content">
     <p>I&#39;ll have to look into that further. My eventual plan is to get an Arduino&nbsp;Yun and put the shield on that to have a fully contained unit. Such a small inaccuracy is not much of a concern though.&nbsp;</p>
<p>The results of the debug log are in. I have taken out a few samples of the abnormal results and pasted them below.</p>
<p>Here&#39;s the full log:&nbsp;http://www.users.on.net/~teepingkoh/emonlog-debug.txt</p>
<p>Abnormal values are on (approx) lines: 254, 1535, 2088, 2942, 3547, 4359, 4709, 5367, 7696, 8844, 10144, 11150 ,11297, 11318, 11381, 11402, 11871, 12410, 13040, 14448, 17398, 18154, 19260, 19601, 26425, 30953, 31023, 32639, 33825</p>
<pre>
2014-12-29 11:16:25,618 DEBUG 13177 NEW FRAME : 1419813985.62 5 915.81 230.67 155684.90
 -24.23 244.51 20.80 50.00 20.44 24.62
2014-12-29 11:16:25,623 DEBUG 13177 Timestamp : 1419813985.62
2014-12-29 11:16:25,627 DEBUG 13177      Node : 5
2014-12-29 11:16:25,631 DEBUG 13177    Values :
 [915.81, 230.67, 155684.9, -24.23, 244.51, 20.8, 50, 20.44, 24.62]
2014-12-29 11:16:25,671 DEBUG 13177 Append to &#39;emonCMS&#39; buffer =&gt; time: 1419813985.62,
 data: [5, 915.81, 230.67, 155684.9, -24.23, 244.51, 20.8, 50, 20.44, 24.62],
 ref: 13177</pre><p>&nbsp;</p>
<pre>
2014-12-29 11:24:29,378 DEBUG 13360 NEW FRAME : 1419814469.38 5 930.55 229.98 2797536.25
 -24.03 244.14 21.10 50.20 20.81 24.81
2014-12-29 11:24:29,383 DEBUG 13360 Timestamp : 1419814469.38
2014-12-29 11:24:29,387 DEBUG 13360      Node : 5
2014-12-29 11:24:29,391 DEBUG 13360    Values :
[930.55, 229.98, 2797536.25, -24.03, 244.14, 21.1, 50.2, 20.81, 24.81]
2014-12-29 11:24:29,407 DEBUG 13360 Append to &#39;emonCMS&#39; buffer =&gt; time: 1419814469.38,
 data: [5, 930.55, 229.98, 2797536.25, -24.03, 244.14, 21.1, 50.2, 20.81, 24.81],
 ref: 13360</pre><p>&nbsp;</p>
<pre>
2014-12-29 11:27:58,167 DEBUG 13439 NEW FRAME : 1419814678.17 5 927.28 231.82 16579931.00
 -24.12 245.15 21.30 48.50 21.00 24.87
2014-12-29 11:27:58,173 DEBUG 13439 Timestamp : 1419814678.17
2014-12-29 11:27:58,177 DEBUG 13439      Node : 5
2014-12-29 11:27:58,181 DEBUG 13439    Values :
[927.28, 231.82, 16579931, -24.12, 245.15, 21.3, 48.5, 21, 24.87]
2014-12-29 11:27:58,276 DEBUG 13439 Append to &#39;emonCMS&#39; buffer =&gt; time: 1419814678.17,
 data: [5, 927.28, 231.82, 16579931, -24.12, 245.15, 21.3, 48.5, 21, 24.87],
 ref: 13439</pre><p>&nbsp;</p>
<p>Cheers</p>
<p>&nbsp;</p>
<p><em>Edit - wrapped long lines&nbsp; - BT</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26217"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 29/12/2014 - 15:57.</div>
    <div class="content">
     <p>The examples you&#39;ve picked out all show the &quot;spike&quot; is present before the packet is processed by by emonHub, so the issue isn&#39;t related to the float precision or being introduced by emonHub.</p>
<p>Another test that may help you narrow the search could be to swap 2 ct leads over at the emontx and swap the input numbers&nbsp;in emoncms (while emonhub is stopped), so you have same phase, same ct, different channel via emontx/sketch/emonhub etc and still logging&nbsp;to the same feeds so your data isn&#39;t effected. If the &quot;spikes&quot; remain on the same phase the source&nbsp;is definitely&nbsp;external to both the software and the hardware as you have already ruled out the ct&#39;s themselves.</p>
<p>Beyond tips on narrowing the search or eliminating parts I&#39;m not sure I can help you much if it is interference&nbsp;as we suspect, Maybe&nbsp;Robert can assist you further with some prevention or filter tips but it&#39;s probably&nbsp;just&nbsp;going to be a process of elimination unless you add some sanity checks to the sketch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26219"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Mon, 29/12/2014 - 16:08.</div>
    <div class="content">
     <p>I &nbsp;think swapping the CTs over to different channels isn&#39;t as easy as it seems due to me using direct voltage sampling and 3 phase, meaning i need to probably change some parameters in the sketch to account for this. I might give it a shot and see tomorrow.&nbsp;</p>
<p>If that leads to the same issue, I will just add some error checking into the sketch.</p>
<p>&nbsp;</p>
<p>Would it do any good to add some ferrite chokes to the CT leads to possibly stop interference there?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26222"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 29/12/2014 - 17:37.</div>
    <div class="content">
     <p>That might help. If you're pretty sure the source is not under your control, then ferrite chokes on the mains input would be a better (but more expensive) solution. There are commercial mains filters available.</p>
<p>First, try taking the CTs off their cables and moving them as far away as possible. If the problem is still there the same, I'd bet it's not getting in via the CTs, and you need to look at the power supply.</p>
<p>If it is coming via the CTs, then it's probably capacitive coupling onto the secondary winding.<br />
You could try to fashion an earthed foil screen around the CT secondary winding, but make absolutely sure you don't form a single shorted turn anywhere.</p>
<p>The real problem with the CT leads (all the YHDC ones that I've looked at) is that they are twin twisted screened cable, the screen has no connection at the CT end (correct) but it might or might not have a connection at the plug end - I've seen all 3 variants: a deliberate connection, no connection and an 'iffy' connection. If you have an 'iffy' or no connection, a deliberate connection to the plug sleeve might help. Better, probably, would be if you stripped the screen back a little, brought it out and connected it to GND (directly, not via the plug sleeve and the capacitor). A ferrite bead then on the inner cores might help.</p>
<p>(If you do swap the phases around, you need to swap in "G" section in "sumP1 += phaseShiftedV1 * filteredI1;" ) If you don't swap, the powers and power factors will be wildly wrong (because there's now &plusmn;120&deg; of artificial phase shift in there), but the spikes will surely still be huge in relation to the wanted input.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Tue, 30/12/2014 - 14:09.</div>
    <div class="content">
     <p>So today I switched around CTs 3 and 4, and just changed the pin assignment in the sketch (seemed like the easiest way to swap it around).</p>
<p>No spikes in the data recorded since! CT4 has currently no power draw on it but it&#39;s not seeing any spikes at all. seems odd?</p>
<p>Will monitor how it goes over the next day or so to confirm that the issue is gone. Is it possible that there is something wrong with that input on the Arduino?</p>
<p>&nbsp;</p>
<p><a href="http://emoncms.org/vis/auto?feedid=63828" title="http://emoncms.org/vis/auto?feedid=63828">http://emoncms.org/vis/auto?feedid=63828</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26260"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Tue, 30/12/2014 - 14:30.</div>
    <div class="content">
     <p>Maybe a CT cable plug not pushed all the way home in its jack?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26261"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Tue, 30/12/2014 - 14:37.</div>
    <div class="content">
     <blockquote><p>Maybe a CT cable plug not pushed all the way home in its jack?</p>
</blockquote>
<p>Definitely not the issue. Could be a cold solder join, but it all looks fine.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26262"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 30/12/2014 - 15:43.</div>
    <div class="content">
     <p><i>"Is it possible that there is something wrong with that input on the Arduino?"</i><br />
I can't see how that on its own could account for the values you saw. The sampled value, which just <b>has</b> to be within the range 0 - 1023 as that's all you can get out of the ADC, must go through the library power or rms algorithm and come out as several hundred kW? Even if it was a square wave, it couldn't be that big - only about 34 kW maximum (given a 100 A input), unless of course you are getting values bigger than 10 bits out of the ADC, then there's the effect that would have on the software HP filter to consider.  </p>
<p>Let's just assume the software filter sits at 512 and stays there, and you get out of the ADC a square wave with 25 samples of 0 followed by 25 samples of 65535. And assume (to make the answer worse and the maths easier!) the voltage wave is similar but values of 0 and 1023. V x I is then -512 x -512 for the first half, and 512 x 65023 for the second. Averaging and taking the root gives 4096 (and a bit - ignore it). Now the 'standard' input is a sine wave that swings 512 maximum, usually about 470 allowing some for tolerances, so the average of two of those multiplied together is about 330, which scales to 24 kW, so the maximum I can envisage given those quite extreme conditions is about 300 kW. That's still not enough - only a third of what you recorded.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26308"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7431.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="renza&#039;s picture" title="renza&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Extremely high values being read from CT at random intervals</h3>

    <div class="submitted">Submitted by <a href="../user/7431.html" title="View user profile.">renza</a> on Thu, 01/01/2015 - 03:30.</div>
    <div class="content">
     <p>Well I&#39;m completely lost as to why switching pins in the code seems to have fixed the issue. I have a spare arduino coming so will swap that out and see if that is any different.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6368"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-n4ft2l2U3FoT_7fY42QPKnxaXcVyWw0D9sRLKD_-Y2w" value="form-n4ft2l2U3FoT_7fY42QPKnxaXcVyWw0D9sRLKD_-Y2w"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
