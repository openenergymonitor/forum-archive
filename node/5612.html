<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5612 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:05:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonLib Problem on energy monitor | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonLib Problem on energy monitor</h3>
        <span class="submitted">Submitted by <a href="../user/6540.html" title="View user profile.">drinu16</a> on Thu, 21/08/2014 - 17:36</span>
        <div class="content"><p>Hi, I am trying to do like this project -&nbsp;<a href="https://learn.openenergymonitor.org/?redirect=how-to-build-an-arduino-energy-monitor">http://openenergymonitor.org/emon/buildingblocks/how-to-build-an-arduino-energy-monitor</a></p>
<p>for the&nbsp;2x 470kOhm for both current and voltage i used 10Kohm resistors as it says in the brackets or am I wrong ?</p>
<p>Is it because of the above resistors that arduino is displaying like below</p>
<p>&nbsp;</p>
<p>205.95 371.65 1.59 233.22 0.55<br />
	246.01 561.49 2.88 195.03 0.44<br />
	144.10 374.21 2.27 164.52 0.39<br />
	51.57 286.41 2.05 139.39 0.18<br />
	94.71 269.44 2.32 116.34 0.35<br />
	58.18 237.18 2.51 94.63 0.25<br />
	40.82 201.50 2.75 73.17 0.20<br />
	-5.99 83.30 1.45 57.36 -0.07<br />
	12.74 98.79 2.35 42.05 0.13<br />
	-4.25 58.44 1.90 30.75 -0.07<br />
	-11.78 31.83 1.30 24.57 -0.37<br />
	6.38 46.03 2.28 20.20 0.14<br />
	6.11 37.70 2.21 17.08 0.16<br />
	3.79 30.10 2.08 14.46 0.13<br />
	0.06 8.81 2.03 4.33 0.01<br />
	0.12 1.81 1.88 0.96 0.07<br />
	0.07 0.68 1.91 0.36 0.11<br />
	0.26 1.87 1.92 0.97 0.14<br />
	0.07 3.18 2.58 1.23 0.02<br />
	-0.30 1.88 2.17 0.87 -0.16<br />
	-0.28 2.48 1.80 1.38 -0.11</p>
<p>....</p>
<p>&nbsp;</p>
<p>I am using everything the same as the diagram apart from those 471Kohm resistors and I am using Mega 2560</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6230.html" class="topic-previous" title="Go to previous forum topic">‹ Getting Started For the First TIme</a>
              <a href="6075.html" class="topic-next" title="Go to next forum topic">How to read eltako electricitymeter with 2 pulses ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-23273"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 21/08/2014 - 19:12.</div>
    <div class="content">
     <p>Are those the first readings displayed after you start/restart the sketch?&nbsp; If so, what you are looking at is the output of the high pass filter in the library as it finds the quiescent level of the input (which should be 512, but probably won&#39;t be exactly). When the filter has had time to settle, I would expect you to see small random variations in current values, and a small residual power value. This is because the ADC converter seems - especially with Arduino boards - to pick up a small amount of digital noise from the processor itself.</p>
<p>It should be nothing to do with those resistors, which are perfectly OK if you&#39;re mains powered, but will add unnecessary current drain if you&#39;re running on batteries.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23275"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 21/08/2014 - 20:21.</div>
    <div class="content">
     <p>For the sketch that you are using, the AC voltage needs to be sent to the processor via Analog input No 2.&nbsp; The&nbsp; corresponding Vrms should then appear as the 3rd value in each set of results, but this does not appear to be happening.&nbsp;</p>
<p>Are you sure that your voltage signal is being fed to the correct pin of the processor?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23276"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6540.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="drinu16&#039;s picture" title="drinu16&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6540.html" title="View user profile.">drinu16</a> on Thu, 21/08/2014 - 21:01.</div>
    <div class="content">
     <p>@Robert Wall, Yes they are the first readings and running on mains.</p>
<p>&nbsp;</p>
<p>@calypso_rae, yes the AC voltage is being sent to A2.</p>
<p>&nbsp;</p>
<p>I have quickly re done the current &quot;circuit&quot; and it sort of was showing something but what i was running was 18W&nbsp;and it was showing about 8W (as the second reading). Then it started &quot;refreshing&quot; at about 5 times a second instead of following those 2 sec delay.</p>
<p>&nbsp;</p>
<p>I will re wire everything from scratch tomorrow in case I made a mistake, lest hope this fix it :/</p>
<p>&nbsp;</p>
<p>Thanks for your replies, will keep you posted.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23282"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 22/08/2014 - 08:13.</div>
    <div class="content">
     <p><em>Then it started &quot;refreshing&quot; at about 5 times a second ...</em></p>
<p>If the code that you&#39;re using is as below, that behaviour sounds correct.&nbsp; Each measurement process will run for 20 half-cycles which takes 200 ms.&nbsp; With no additional delay, loop() will be executed at about 5 times a second</p>
<pre>
void loop()
{
  emon1.calcVI(20,2000);         // Calculate all. No.of wavelengths, time-out
  emon1.serialprint();           // Print out all variables
}</pre><p>The 2-second time-out is only used to terminate the measurement process if the normal mechanism fails to work.&nbsp; This would presumably happen if the AC voltage signal were not&nbsp; available.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23290"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6540.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="drinu16&#039;s picture" title="drinu16&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6540.html" title="View user profile.">drinu16</a> on Fri, 22/08/2014 - 17:41.</div>
    <div class="content">
     <p>I have made some progress but not quite sure if it working as it should. I ended up re wiring everything from scratch which might have fixed a mistake Ive made.&nbsp;</p>
<p>&nbsp;</p>
<p>Anyway, I hooked up a 15&quot; TFT on stand by (No signal mode) to a wall socket meter (below pic) and as you can see it displays 18W, a constant 18W.</p>
<p><a href="../../../s9.postimg.org/k9myboda7/2014_08_22_19_33_01.jpg"><img alt="" src="../../../s9.postimg.org/k9myboda7/2014_08_22_19_33_01.jpg" style="width: 250px; height: 309px;" /></a></p>
<p>This is the output from the arduino while the TFT is switched on</p>
<p>36.08 178.29 134.34 1.33 0.20<br />
	-1.08 237.42 134.42 1.77 -0.00<br />
	23.45 114.38 132.27 0.86 0.21<br />
	24.37 80.28 133.43 0.60 0.30<br />
	-2.08 110.30 133.94 0.82 -0.02<br />
	27.76 106.46 133.84 0.80 0.26<br />
	21.00 69.12 133.85 0.52 0.30<br />
	23.71 114.36 134.32 0.85 0.21<br />
	38.20 129.76 134.18 0.97 0.29<br />
	36.93 95.94 134.34 0.71 0.38<br />
	17.77 132.56 134.76 0.98 0.13<br />
	27.84 131.05 134.68 0.97 0.21<br />
	3.44 112.42 135.31 0.83 0.03<br />
	24.53 70.27 135.12 0.52 0.35</p>
<p>&nbsp;</p>
<p>And this is a few secs after it is switched off</p>
<p>8.74 56.31 134.95 0.42 0.16<br />
	13.31 114.21 134.29 0.85 0.12<br />
	4.73 40.29 133.98 0.30 0.12<br />
	1.45 94.06 134.29 0.70 0.02<br />
	-1.70 98.00 134.18 0.73 -0.02<br />
	-6.48 185.53 134.96 1.37 -0.03<br />
	6.24 194.18 134.26 1.45 0.03<br />
	-8.21 157.65 134.53 1.17 -0.05<br />
	-2.14 150.33 131.01 1.15 -0.01<br />
	-2.04 204.84 134.33 1.52 -0.01<br />
	-10.37 228.85 134.33 1.70 -0.05<br />
	5.72 87.61 134.29 0.65 0.07<br />
	11.76 113.15 134.61 0.84 0.10</p>
<p>&nbsp;</p>
<p>My question : Is it what it should display as Ive seen someone elses output and when switched off it shows zeros&nbsp;</p>
<p>&nbsp;</p>
<p>Could it be a calibration issue (second number from the below voltage parameters ?</p>
<p>&nbsp;</p>
<pre>
emon1.voltage(2, 234.26, 1.7);  // Voltage: input pin, calibration, phase_shift</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23291"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 22/08/2014 - 18:35.</div>
    <div class="content">
     <p>On your first set of results, the third value did not appear to be showing any voltage signal.&nbsp; But now there is a sensible looking value which is nice and stable, whether or not any current is flowing.&nbsp;</p>
<p>The first two columns should be showing power, but it&#39;s not obvious what&#39;s going on.&nbsp; Have you tried with a larger load, say a kW or two?&nbsp; Then you should see much more effect.&nbsp; When only 18 Watts is flowing, very little of the ADC&#39;s range will be in use, maybe only a step or two depending on the value of your burden resistor.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23294"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 22/08/2014 - 20:24.</div>
    <div class="content">
     <p>As calypso_rae says, you are trying to read next to nothing. Your input is designed (unless you&#39;ve changed things) to read up to 100 A, or about 24 kW. 18 W is only 0.075% of maximum reading, and as I wrote above, I think you&#39;re seeing mainly noise and your wanted measurement is buried in the noise.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23437"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6540.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="drinu16&#039;s picture" title="drinu16&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6540.html" title="View user profile.">drinu16</a> on Fri, 29/08/2014 - 17:39.</div>
    <div class="content">
     <p>Some progress :) I did put a larger load and it gave me a more stable readings</p>
<p>I have noticed that the wall monitor is giving me an average because that is what the arduino&nbsp;gave me when I made an average of the readings.</p>
<p>Anyway, I am a little confused on how to calculate the units just like the electricity provider caculates them.</p>
<p>Do i add up all the watts for 1 hour and get an average of those readings (1 reading every second) and then divide by 1000 which should result in units or is there a much more precise formula than that ?</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23439"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 29/08/2014 - 21:06.</div>
    <div class="content">
     <p>I do not understand what a wall monitor is.</p>
<p>The output from SerialPrint is (in order) real power (W), apparent power (VA), rms voltage (V), rms current (A) and power factor.</p>
<p>Your supplier&#39;s meter registers kWh, which is real power integrated over time. If you want to do that sum inside your Arduino, the theory is this: you must take the real power samples at whatever time interval you want (normally we use 10 s in the &quot;discrete samples&quot; sketch), multiply it by the interval between readings in seconds - this gives you the energy in Ws (watt seconds, or Joules) and continuously add these resulting values to an accumulator. To convert to kWh, you divide that by 3600000.</p>
<p>It is harder in practice because you cannot have an infinitely long number in the maths, so it is usually best to do the maths in two stages. You accumulate the readings as before in a long integer, then each time before you add the next reading, you test for the accumulated value is greater than 3600000. When it is, you subtract 3600000 from your first accumulator and add 1 to a second accumulator (probably also a long integer). Therefore the second accumulator increments in steps of 1 kWh and is exactly the same as your supplier&#39;s meter.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23440"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Fri, 29/08/2014 - 21:11.</div>
    <div class="content">
     <p>Your revenue meter measures energy, and you&#39;re measuring power. &nbsp; Energy is power x time. &nbsp;So if you use a 2kW heater for 3 hours, it will cost you 6kWH, &nbsp;as will a 3kW heater for 2 hours.</p>
<p>If you&#39;ve arranged things such that your monitor gives you one power reading every second, a steady&nbsp;18W say, and we assume that was the power reading for the entire second (or an average power reading throughout the second) then you&#39;ve used 18W x 1sec = 18WattSeconds of energy in that second. &nbsp;A WattSecond is also known as a Joule. &nbsp;There are 3600 WattSeconds in a WattHr, and 3,600,000 WattSeconds in a kWH.</p>
<p><em>Do i add up all the watts for 1 hour</em></p>
<p>If you want to mimic your revenue meter, you add up the WattSeconds forever, not just for an hour. &nbsp;The number should always get bigger. &nbsp;Then simply divide it by 3,600,000 if you want to display your accumulated WattSeconds in kWH (which is what most revenue meters display).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23441"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Fri, 29/08/2014 - 22:37.</div>
    <div class="content">
     <p>I&#39;ll bet good money that the 18W being displayed by your plug-through monitor is completely bogus. &nbsp;That particular monitor should go in the bin. &nbsp;In the attached photo you&#39;ll see two monitors both monitoring my microwave oven while it&#39;s in standby (i.e. just being a clock). &nbsp; The good meter claims it&#39;s using 2.5W(*) with a PF of 0.1, the bad meter (which looks identical to yours) claims it&#39;s using 98W with a PF of 1 (displayed as a %-age so 100).</p>
<p>I&#39;ve confirmed the good meter&#39;s results with my precision front-end. &nbsp;Further analysis reveals the power supply in the microwave (while in standby) looks like one massive capacitor. &nbsp;It draws a lot of amps (about 98 &quot;watts&quot; worth) with a nice clean sine wave on I, but that sine wave is almost exactly 90 degrees shifted compared to V. &nbsp;So the PF is indeed close to 0, as is the real power being used.</p>
<p>There&#39;s something about that signal that completely confuses that make of meter into thinking the PF is 1, so it counts all that apparent power as real power. &nbsp;It&#39;s very unlikely that your TFT in standby would have a PF of 1, so I&#39;m guessing the meter is showing the same bug.</p>
<p>(*) some of which will be the power being consumed by the bad meter, given the way I&#39;ve piggybacked them.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Fri, 28/11/2014 - 23:46.</div>
    <div class="content">
     <p>I prepare energy monitor on arduino &nbsp;and i have problem. Without any load i have value :</p>
<p>-37.41 74.64 238.59 0.31 -0.50&nbsp;</p>
<p>-38.75 75.23 237.49 0.32 -0.52&nbsp;</p>
<p>-37.15 74.25 237.58 0.31 -0.50&nbsp;</p>
<p>Load 100W</p>
<p>-143.56 157.94 237.53 0.66 -0.91&nbsp;</p>
<p>-142.66 157.37 237.54 0.66 -0.91&nbsp;</p>
<p>My calibration:&nbsp;</p>
<p>&nbsp; emon1.voltage(A3, 116.8, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon1.current(A0, 30); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.</p>
<p>CT sensor:</p>
<p>30A SCT-013-030</p>
<p>Where i should to look for bug?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25397"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 00:11.</div>
    <div class="content">
     <p>Which circuit diagram have you used?<br />
Which sketch are you using - what do those numbers represent?</p>
<p>We cannot help you when we do not know what you have.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25403"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Sat, 29/11/2014 - 11:43.</div>
    <div class="content">
     <p>Circuit diagram</p>
<p><img alt="" src="../sites/default/files/Arduino%20AC%20current%20input%20A.png" style="height:439px; width:735px" />&nbsp;and&nbsp;</p>
<p><img alt="" src="../sites/default/files/Arduino%20AC%20voltage%20input_1.png" style="height:459px; width:650px" /></p>
<p>Arduino sketch - voltage and current:</p>
<p>&nbsp;</p>
<p>// EmonLibrary examples openenergymonitor.org, Licence GNU GPL V3</p>
<p>#include &quot;EmonLib.h&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Include Emon Library<br />
EnergyMonitor emon1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Create an instance</p>
<p>void setup()<br />
{ &nbsp;<br />
&nbsp; Serial.begin(9600);<br />
&nbsp;&nbsp;<br />
&nbsp; emon1.voltage(A3, 116.8, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon1.current(A0, 30); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.<br />
}</p>
<p>void loop()<br />
{<br />
&nbsp; float sensorValue = analogRead(A0); &nbsp;</p>
<p>&nbsp; emon1.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of half wavelengths (crossings), time-out<br />
&nbsp; emon1.serialprint(); &nbsp; &nbsp; &nbsp; // Print out all variables (realpower, apparent power, Vrms, Irms, power factor)</p>
<p>&nbsp; float realPower &nbsp; &nbsp; &nbsp; = emon1.realPower; &nbsp; &nbsp; &nbsp; &nbsp;//extract Real Power into variable<br />
&nbsp; float apparentPower &nbsp; = emon1.apparentPower; &nbsp; &nbsp;//extract Apparent Power into variable<br />
&nbsp; float powerFActor &nbsp; &nbsp; = emon1.powerFactor; &nbsp; &nbsp; &nbsp;//extract Power Factor into Variable<br />
&nbsp; float supplyVoltage &nbsp; = emon1.Vrms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //extract Vrms into Variable<br />
&nbsp; float Irms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= emon1.Irms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //extract Irms into Variable<br />
}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25404"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 29/11/2014 - 12:00.</div>
    <div class="content">
     <p>Do you have just the 1 burden resistor per CT channel ? the SCT-013-030 has an internal burden resistor where as the usual SCT-013-000&nbsp;CT does not.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25406"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Sat, 29/11/2014 - 12:27.</div>
    <div class="content">
     <p>I use only internal burden resistor. Maybe is it problem in my power supply because of on my supply i have&nbsp;5,22V and middle point have 2.61V?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25407"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 12:43.</div>
    <div class="content">
     <p>The power supply being high should not cause the problem you have.</p>
<p>The numbers you are seeing are Real power, Apparent power, Vrms, Irms and Power factor. The negative power means that you must reverse your CT on its cable.</p>
<p>However, you are reading a current when there should be none. That is almost certainly due to noise being picked up by the analogue to digital converter, which sees it as a current. This is likely to be digital noise from the digital part of your Arduino being transferred via the 5 V supply, but it could also be from your power supply itself. As far as I know, the Arduino PCB has no filtering to reduce this problem, whereas with our emonTx V3, great care was taken with the PCB layout and filtering to reduce this interference. You might be able to reduce the noise a little by putting additional capacitors (say 0.22 &mu;F plastic film) across your 5 V supply to ground, positioned as close to the microprocessor as possible. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25414"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Sat, 29/11/2014 - 16:25.</div>
    <div class="content">
     <p>I turned wires and values are correct. If the noise is constant whether it can be calibrated in software? If i good understand i should improve power 5v or get new better power supply on 5v?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25419"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 16:56.</div>
    <div class="content">
     <p>Unfortunately, although the noise is not true random (white) noise, I cannot say exactly where it comes from and so I cannot guarantee that the noise will be constant. As you can see from the numbers you read, it appears to have a power factor of 0.5, which means that there is both a real part and a reactive part. These two things together mean that it will be difficult to remove it completely in the software. It will be best to try first to remove as much as possible in hardware, then, if it is still a problem, look to subtracting the average value in your sketch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25423"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Sat, 29/11/2014 - 18:00.</div>
    <div class="content">
     <p>I exchange power supply and effect is the same:</p>
<p>-36.17 77.07 235.93 0.33 -0.47&nbsp;</p>
<p>-35.16 77.18 236.02 0.33 -0.46&nbsp;</p>
<p>-35.00 73.67 235.87 0.31 -0.48&nbsp;</p>
<p>-37.42 75.87 236.04 0.32 -0.49&nbsp;</p>
<p>-35.83 75.33 235.98 0.32 -0.48&nbsp;</p>
<p>Maybe I&#39;m connect incorrect?<span class="rangySelectionBoundary" id="selectionBoundary_1417283860413_9523440627381206" style="display:none; line-height:0">﻿</span></p>
<p><img alt="" src="../../../91.222.126.240/foto/trzy%20fazy_bb.html" style="height:797px; width:800px" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25425"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 29/11/2014 - 19:27.</div>
    <div class="content">
     <p><i>"I exchange power supply and effect is the same:"</i></p>
<p>Then I think the problem is digital noise from the microprocessor finding a route in to the analogue to digital converter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25437"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Sat, 29/11/2014 - 22:58.</div>
    <div class="content">
     <p>What arduino is the best for emoncms? Now I have&nbsp;Pro Mini 5V and probably&nbsp;analog digital converter have a lot of noise.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25439"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 30/11/2014 - 00:05.</div>
    <div class="content">
     <p>I know very little about the Arduino range, so I cannot advise you.</p>
<p>But I can tell you two things:<br />
(1) Most of the people who report that they have a noise problem are using the Arduino and not the emonTx.<br />
(2) When I looked at the PCB layout of an Arduino, there was no power supply filtering between the supply pin to the analogue side and the supply pin for the digital side. When Glyn Hudson was laying out the PCB for the emonTx V3, he was very careful to run the analogue circuits as far as possible away from the digital circuits, and screened them with a ground plane. The analogue ground is also separated from the digital ground to prevent 'ground noise' from getting into the ADC.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25440"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sun, 30/11/2014 - 03:49.</div>
    <div class="content">
     <p>Some Arduinos do have the AVR recommended inductor between AVCC and VCC. &nbsp;From memory I think the Leonardo might have it. &nbsp;A quick check of your ProMini reveals it doesn&#39;t, and nor do my Mega2560s. &nbsp;Here&#39;s a very simple check you could start off with. &nbsp;When I try this on my Mega2560&nbsp;(powered from my desktop&#39;s USB port)&nbsp;I see:</p>
<p>Min: 510, Max: 511</p>
<p>Very occasionally&nbsp;Min drops down to 509, and that seems to happen more often on A1 (with the 150K divider) than on A0 (10K divider). &nbsp;You might need to reduce the size of the array depending on how much RAM your Arduino has. The array is only there so you can look at the signal should your rmin/max show something more exciting than 510/511, in which case you&nbsp;can paste the values into a spreadsheet and plot them. &nbsp;</p>
<p>Assuming yours also shows just 510/511 then you could start adding back in the components of your energy monitoring schematic, and see if/when that changes.</p>
<p><img alt="" src="../sites/default/files/anoise.jpg" style="height:519px; width:600px" /></p>
<p><strong>[EDIT-1]&nbsp;</strong>P.S. &nbsp;I used 1% resistors which would explain why both dividers have nailed the mid-point so well. &nbsp;If you don&#39;t have 1%&#39;ers you might see a different value from 510/511, which doesn&#39;t matter. &nbsp;You&#39;re looking for stability rather than accuracy.</p>
<p><strong>[EDIT-2]&nbsp;</strong>P.P.S. If I stick my finger on the mid-point of the divider, the readings go to 505/515 for the low impedance source (A0) and 490/531 for the high impedance source (A1).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25446"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Sun, 30/11/2014 - 14:54.</div>
    <div class="content">
     <p>Power from USB:</p>
<p>Min: 512, Max: 512</p>
<p>Min: 511, Max: 513</p>
<p>Power from supply:</p>
<p>Min: 508, Max: 514</p>
<p>Do I need better power supply?</p>
<p>PS. I exchanged resistor on middle point and now is better:</p>
<p>load = 0</p>
<p>1.89 25.21 237.43 0.11 0.07&nbsp;</p>
<p>4.43 26.12 237.41 0.11 0.17&nbsp;</p>
<p>4.27 25.63 237.52 0.11 0.17&nbsp;</p>
<p>2.73 26.89 237.57 0.11 0.10&nbsp;</p>
<p>2.40 24.60 237.39 0.10 0.10&nbsp;</p>
<p>4.68 26.69 237.42 0.11 0.18&nbsp;</p>
<p>3.11 26.58 237.72 0.11 0.12&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25448"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 30/11/2014 - 21:44.</div>
    <div class="content">
     <p>Those values are much more like the numbers we expect to see with an Arduino module project. You might not be able to improve much more than that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25452"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Sun, 30/11/2014 - 22:43.</div>
    <div class="content">
     <p>I hope last question. Is it correct code for 3 phases?</p>
<p>&nbsp;</p>
<p>// EmonLibrary examples openenergymonitor.org, Licence GNU GPL V3</p>
<p>#include &quot;EmonLib.h&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Include Emon Library<br />
EnergyMonitor emon1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Create an instance<br />
EnergyMonitor emon2; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Create an instance<br />
EnergyMonitor emon3; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Create an instance</p>
<p>void setup()<br />
{ &nbsp;<br />
&nbsp; Serial.begin(115200);<br />
&nbsp;&nbsp;<br />
&nbsp; emon1.voltage(A3, 115.8, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon1.current(A0, 29); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.<br />
&nbsp; emon2.voltage(A4, 115.8, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon2.current(A1, 29); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.<br />
&nbsp; emon3.voltage(A5, 115.8, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift<br />
&nbsp; emon3.current(A2, 29); &nbsp; &nbsp; &nbsp; // Current: input pin, calibration.</p>
<p>
}</p>
<p>void loop()<br />
{</p>
<p>&nbsp; emon1.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of half wavelengths (crossings), time-out<br />
&nbsp; emon1.serialprint(); &nbsp; &nbsp; &nbsp; // Print out all variables (realpower, apparent power, Vrms, Irms, power factor)<br />
&nbsp; emon2.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of half wavelengths (crossings), time-out<br />
&nbsp; emon2.serialprint(); &nbsp; &nbsp; &nbsp; // Print out all variables (realpower, apparent power, Vrms, Irms, power factor)<br />
&nbsp; emon3.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; // Calculate all. No.of half wavelengths (crossings), time-out<br />
&nbsp; emon3.serialprint(); &nbsp; &nbsp; &nbsp; // Print out all variables (realpower, apparent power, Vrms, Irms, power factor)</p>
<p>&nbsp;</p>
<p>&nbsp; float realPower &nbsp; &nbsp; &nbsp; = emon1.realPower; &nbsp; &nbsp; &nbsp; &nbsp;//extract Real Power into variable<br />
&nbsp; float apparentPower &nbsp; = emon1.apparentPower; &nbsp; &nbsp;//extract Apparent Power into variable<br />
&nbsp; float powerFActor &nbsp; &nbsp; = emon1.powerFactor; &nbsp; &nbsp; &nbsp;//extract Power Factor into Variable<br />
&nbsp; float supplyVoltage &nbsp; = emon1.Vrms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //extract Vrms into Variable<br />
&nbsp; float Irms &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= emon1.Irms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //extract Irms into Variable<br />
&nbsp; float realPower2 &nbsp; &nbsp; &nbsp; = emon2.realPower; &nbsp; &nbsp; &nbsp; &nbsp;//extract Real Power into variable<br />
&nbsp; float apparentPower2 &nbsp; = emon2.apparentPower; &nbsp; &nbsp;//extract Apparent Power into variable<br />
&nbsp; float powerFActor2 &nbsp; &nbsp; = emon2.powerFactor; &nbsp; &nbsp; &nbsp;//extract Power Factor into Variable<br />
&nbsp; float supplyVoltage2 &nbsp; = emon2.Vrms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //extract Vrms into Variable<br />
&nbsp; float Irms2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= emon2.Irms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //extract Irms into Variable<br />
&nbsp; float realPower3 &nbsp; &nbsp; &nbsp; = emon3.realPower; &nbsp; &nbsp; &nbsp; &nbsp;//extract Real Power into variable<br />
&nbsp; float apparentPower3 &nbsp; = emon3.apparentPower; &nbsp; &nbsp;//extract Apparent Power into variable<br />
&nbsp; float powerFActor3 &nbsp; &nbsp; = emon3.powerFactor; &nbsp; &nbsp; &nbsp;//extract Power Factor into Variable<br />
&nbsp; float supplyVoltage3 &nbsp; = emon3.Vrms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //extract Vrms into Variable<br />
&nbsp; float Irms3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= emon3.Irms; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //extract Irms into Variable<br />
}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25455"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sun, 30/11/2014 - 23:00.</div>
    <div class="content">
     <p>[Discussion about grounding has been moved to <a href="6196.html">a new thread</a> - RW]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25459"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 01/12/2014 - 00:33.</div>
    <div class="content">
     <p>maglo:</p>
<p>That code looks OK, you have created an instance of EnergyMonitor for each phase, and I think you have set each one up with the correct input pins and calibration. You will probably find that, because of component tolerances, you might need different calibration values on each phase. That is perfectly OK.</p>
<p>But there is no need to copy all the values from the instances of EnergyMonitor, and the values will remain in the class members until they are overwritten when you next call calcVI(..).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25462"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 01/12/2014 - 03:43.</div>
    <div class="content">
     <p>I think &#39;double&#39; and &#39;float&#39; are identical in the AVR gcc implementation. &nbsp;If you&#39;ve got an ARM based Due, then a it makes a difference.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25464"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 01/12/2014 - 09:51.</div>
    <div class="content">
     <blockquote><p><em>PS. I exchanged resistor on middle point and now is better:</em></p>
</blockquote>
<p>It would be interesting&nbsp;to know what changes you made, maglo. What values were you using before and after ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25469"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Mon, 01/12/2014 - 11:49.</div>
    <div class="content">
     <p>Now is 10k before was 330.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25470"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 01/12/2014 - 12:08.</div>
    <div class="content">
     <p>I assume you mean they were&nbsp;330K before (not ohms),</p>
<blockquote><p><em>Power from USB:</em></p>
<p><em>Min: 512, Max: 512</em></p>
<p><em>Min: 511, Max: 513</em></p>
<p><em>Power from supply:</em></p>
<p><em>Min: 508, Max: 514</em></p>
</blockquote>
<p>and these readings were using the 10K dividers, is that correct ?</p>
<p>also were they just average&nbsp;resistors or did you use higher precision ones ?</p>
<p>hope you don&#39;t mind me asking.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25473"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Mon, 01/12/2014 - 14:31.</div>
    <div class="content">
     <p>No. I didn&#39;t &nbsp;use &nbsp;yours&nbsp;sketch&nbsp;before&nbsp;for&nbsp;measure.&nbsp;</p>
<p>330 ohm resistor:</p>
<p>-36.17 77.07 235.93 0.33 -0.47&nbsp;</p>
<p>-35.16 77.18 236.02 0.33 -0.46&nbsp;</p>
<p>-35.00 73.67 235.87 0.31 -0.48&nbsp;</p>
<p>-37.42 75.87 236.04 0.32 -0.49&nbsp;</p>
<p>10k resistor :</p>
<p>1.89 25.21 237.43 0.11 0.07&nbsp;</p>
<p>4.43 26.12 237.41 0.11 0.17&nbsp;</p>
<p>4.27 25.63 237.52 0.11 0.17&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25479"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 01/12/2014 - 18:06.</div>
    <div class="content">
     <p>Maglo18,</p>
<p>In the image that you posted (copy below), you have only one passive Vref supply and it is being shared between all of your sensors.&nbsp; That system will not work at all well, there will a lot of crosstalk between your analogue channels.&nbsp; You should either have a separate Vref circuit for each analog channel, or add an op amp to buffer the single Vref rail so that it remains constant.</p>
<p><img alt="" src="../../../91.222.126.240/foto/trzy%20fazy_bb.html" style="height:498px; width:500px" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25482"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Mon, 01/12/2014 - 19:39.</div>
    <div class="content">
     <p>If i good understand i should add 6 x different&nbsp;middle point for 3 x voltage meter and 3 x ampere meter?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25485"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Mon, 01/12/2014 - 20:34.</div>
    <div class="content">
     <p>Maybe&nbsp;better way will be use&nbsp;Micropower Voltage&nbsp;Reference Diodes ex. LM385-2.5 for each analog input?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25492"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 01/12/2014 - 22:43.</div>
    <div class="content">
     <p>I do not recommend Zener diodes / voltage reference diodes. To get the best range from your meaurements, you want the midpoint to be exactly the midpoint, whatever the supply voltage happens to be, and not exactly 2.5 V (except of course when the supply happens to be exactly 5.0 V). </p>
<p>As calypso_rae says, if you do not want 6 sets of resistors &amp; capacitor, then use an op. amp. as a voltage follower, as he did in his Mk2 Diverter <a href="../sites/default/files/Mk2_CircuitSchematic.pdf">http://openenergymonitor.org/emon/sites/default/files/Mk2_CircuitSchematic.pdf</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25494"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6146.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="maglo18&#039;s picture" title="maglo18&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6146.html" title="View user profile.">maglo18</a> on Mon, 01/12/2014 - 23:08.</div>
    <div class="content">
     <p>Thank you for help. I used 6 sets resistor (24k) and capacitor 100 &micro;F. I hope it is fine because on schematic capacitor doesn&#39;t have value</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25519"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonLib Problem on energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 02/12/2014 - 22:24.</div>
    <div class="content">
     <p>"Building Blocks", where you found the diagram you posted, are not fully engineered circuits. They are examples to explain the theory of how the circuit works. If you want working fully engineered circuits, you should be looking at the schematic diagrams for, in this case, the emonTx. On the Wiki, you will find a link to the diagrams, which are on Solderpad.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5612"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-x7JsM6eHim8wDsuuIBBm2zs3-7MyaWP0ZA46DC1Pv6g" value="form-x7JsM6eHim8wDsuuIBBm2zs3-7MyaWP0ZA46DC1Pv6g"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
