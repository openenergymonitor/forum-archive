<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/595 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:04:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>AC Analog conversion for UNO | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">AC Analog conversion for UNO</h3>
        <span class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Tue, 17/04/2012 - 17:17</span>
        <div class="content"><p>Can any one advise me regarding what to use to convert AC to DC to input the UNO for voltage and two current sensors. I have all the hardware and have &nbsp;used some true rms to dc converters but they don&#39;t seem to interface properly with the UNO.</p>
<p>Thanks</p>
<p>Mark.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="623.html" class="topic-previous" title="Go to previous forum topic">‹ BASE RF FAIL</a>
              <a href="632.html" class="topic-next" title="Go to next forum topic">Energy Monitoring Project ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-3902"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 19/04/2012 - 08:12.</div>
    <div class="content">
     <p>See here:&nbsp;<a href="https://learn.openenergymonitor.org/?redirect=ct-sensors-interface">http://openenergymonitor.org/emon/buildingblocks/ct-sensors-interface</a>&nbsp;We have gone along the route of calculating true rms on the arduino itself.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3909"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Thu, 19/04/2012 - 13:15.</div>
    <div class="content">
     <p>Thanks Trystan, I have build a&nbsp;voltage input&nbsp;circuit&nbsp;but the&nbsp;sketch is throwing up problems as errors below.</p>
<p>voltage_and_current_ex.cpp.o: In function `loop&#39;:<br />
	C:\DOCUME~1\MARK~1.BEA\LOCALS~1\Temp\build2352948031508961507.tmp/voltage_and_current_ex.cpp:17: undefined reference to `EnergyMonitor::calcVI(int, int)&#39;<br />
	C:\DOCUME~1\MARK~1.BEA\LOCALS~1\Temp\build2352948031508961507.tmp/voltage_and_current_ex.cpp:18: undefined reference to `EnergyMonitor::serialprint()&#39;<br />
	voltage_and_current_ex.cpp.o: In function `setup&#39;:<br />
	C:\DOCUME~1\MARK~1.BEA\LOCALS~1\Temp\build2352948031508961507.tmp/voltage_and_current_ex.cpp:11: undefined reference to `EnergyMonitor::voltage(int, double, double)&#39;<br />
	C:\DOCUME~1\MARK~1.BEA\LOCALS~1\Temp\build2352948031508961507.tmp/voltage_and_current_ex.cpp:12: undefined reference to `EnergyMonitor::current(int, double)&#39;</p>
<p>Any Ideas, I&#39;m a little green with this.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3910"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Thu, 19/04/2012 - 17:53.</div>
    <div class="content">
     <p>I can&#39;t seem to get the sketch to compile Trystan. Errors are as follows.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div>
	voltage_and_current_ex.cpp.o: In function `loop&#39;:</div>
<div>
	C:\Users\Mark\AppData\Local\Temp\build6210930148339193694.tmp/voltage_and_current_ex.cpp:17: undefined reference to `EnergyMonitor::calcVI(int, int)&#39;</div>
<div>
	C:\Users\Mark\AppData\Local\Temp\build6210930148339193694.tmp/voltage_and_current_ex.cpp:18: undefined reference to `EnergyMonitor::serialprint()&#39;</div>
<div>
	voltage_and_current_ex.cpp.o: In function `setup&#39;:</div>
<div>
	C:\Users\Mark\AppData\Local\Temp\build6210930148339193694.tmp/voltage_and_current_ex.cpp:11: undefined reference to `EnergyMonitor::voltage(int, double, double)&#39;</div>
<div>
	C:\Users\Mark\AppData\Local\Temp\build6210930148339193694.tmp/voltage_and_current_ex.cpp:12: undefined reference to `EnergyMonitor::current(int, double)&#39;</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3930"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Fri, 20/04/2012 - 17:07.</div>
    <div class="content">
     <p>Can anyone help with this? I am not seeing something here in the example script. I want to get my immersion heater device finish then I can post it on here.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3937"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Sat, 21/04/2012 - 08:51.</div>
    <div class="content">
     <p>It seems that I am stuck out on a limb here, tried my hardest to workout what is wrong with the sample sketch here&nbsp;<span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 14px; text-align: left; background-color: rgb(238, 238, 238); ">&nbsp;</span><a href="https://learn.openenergymonitor.org/?redirect=ct-sensors-interface" style="color: rgb(51, 153, 204); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 14px; text-align: left; background-color: rgb(238, 238, 238); ">http://openenergymonitor.org/emon/buildingblocks/ct-sensors-interface</a>.</p>
<p>I have put the emon&nbsp; lib in but still keeps coming up with error &quot;undefined reference to `EnergyMonitor::current(int, double)&#39; for voltage and current. &nbsp; &nbsp;Please help someone.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3951"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="prensel&#039;s picture" title="prensel&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by prensel (not verified) on Sat, 21/04/2012 - 17:44.</div>
    <div class="content">
     <p>Maybe silly question but did you copy the EmonLib directory&nbsp; into the libraries directory of Arduino ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3952"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Sat, 21/04/2012 - 18:08.</div>
    <div class="content">
     <p>Yes I have done that prensel; with all the post regarding the example others seem to get it working ok. I&#39;m just learning about the Arduino&nbsp;and have carried out what is said but it throws the fore mentioned errors on compile.I&#39;ve tried messaging Trystan but have no reply as yet. I&#39;m not one for throwing the towel in but i&#39;m getting very frustrated with the sketch. Thanks for your reply anyway.</p>
<p>Mark.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3953"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Sat, 21/04/2012 - 18:24.</div>
    <div class="content">
     <p>Another simple question - did you restart arduino&nbsp;after copying the libraries into place?</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3954"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Sat, 21/04/2012 - 18:46.</div>
    <div class="content">
     <p>Yes Lloyd I have done that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3955"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Sat, 21/04/2012 - 19:02.</div>
    <div class="content">
     <p>&nbsp;</p>
<div>
	This is the sketch..............</div>
<div>
	&nbsp;</div>
<div>
	#include &quot;EmonLib.h&quot; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Include Emon Library</div>
<div>
	EnergyMonitor emon1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Create an instance</div>
<div>
	&nbsp;</div>
<div>
	void setup()</div>
<div>
	{ &nbsp;</div>
<div>
	&nbsp; Serial.begin(9600);</div>
<div>
	&nbsp;&nbsp;</div>
<div>
	&nbsp; emon1.voltage(2, 234.26, 1.7); &nbsp;// Voltage: input pin, calibration, phase_shift</div>
<div>
	&nbsp; emon1.current(1, 111.1); &nbsp; &nbsp; &nbsp; &nbsp;// Current: input pin, calibration.</div>
<div>
	}</div>
<div>
	&nbsp;</div>
<div>
	void loop()</div>
<div>
	{</div>
<div>
	&nbsp; emon1.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Calculate all. No.of wavelengths, time-out</div>
<div>
	&nbsp; emon1.serialprint(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Print out all variables</div>
<div>
	}</div>
<div>
	&nbsp;</div>
<div>
	These are the errors when I click on compile.....</div>
<div>
	&nbsp;</div>
<div>
<div>
		voltage_and_current_ex.cpp.o: In function `loop&#39;:</div>
<div>
		C:\Users\Mark\AppData\Local\Temp\build1517359345261135376.tmp/voltage_and_current_ex.cpp:17: undefined reference to `EnergyMonitor::calcVI(int, int)&#39;</div>
<div>
		C:\Users\Mark\AppData\Local\Temp\build1517359345261135376.tmp/voltage_and_current_ex.cpp:18: undefined reference to `EnergyMonitor::serialprint()&#39;</div>
<div>
		voltage_and_current_ex.cpp.o: In function `setup&#39;:</div>
<div>
		C:\Users\Mark\AppData\Local\Temp\build1517359345261135376.tmp/voltage_and_current_ex.cpp:11: undefined reference to `EnergyMonitor::voltage(int, double, double)&#39;</div>
<div>
		C:\Users\Mark\AppData\Local\Temp\build1517359345261135376.tmp/voltage_and_current_ex.cpp:12: undefined reference to `EnergyMonitor::current(int, double)&#39;</div>
</div>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3957"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Sat, 21/04/2012 - 19:16.</div>
    <div class="content">
     <p>Have I got to set anything in the Emonlib would anyone know?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3958"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Sat, 21/04/2012 - 19:22.</div>
    <div class="content">
     <p>In the Emonlib&nbsp;it says the following</p>
<div>
	&nbsp; private:</div>
<div>
	&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	&nbsp; &nbsp; //Set Voltage and current input pins</div>
<div>
	&nbsp; &nbsp; int inPinV&nbsp;;</div>
<div>
	&nbsp; &nbsp; int inPinI&nbsp;;</div>
<div>
	&nbsp; &nbsp; //Calibration coeficients</div>
<div>
	&nbsp; &nbsp; //These need to be set in order to obtain accurate results</div>
<div>
	&nbsp; &nbsp; double VCAL;</div>
<div>
	&nbsp; &nbsp; double ICAL;</div>
<div>
	&nbsp; &nbsp; double PHASECAL;</div>
<div>
	&nbsp;</div>
<div>
	Anyone know what I need to do here?</div>
<div>
	&nbsp;</div>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3959"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Sat, 21/04/2012 - 19:45.</div>
    <div class="content">
     <p>Is this a test? well I have failed.. someone put me out of my misery pleeeeeeeeeeeeeezzzzz.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4030"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Wed, 25/04/2012 - 16:57.</div>
    <div class="content">
     <p>Your sketch compiles fine.</p>
<ol>
<li>
		Open arduino</li>
<li>
		Paste your code on the blank window;</li>
<li>
		open windows explorer and browse to folder where the emonlib.c and emonlib.h are;</li>
<li>
		drag emonlib.c and emonlib.h into the arduino&nbsp;screen, so it will have 3 open files ( your stetch, emonlib.c and emonlib.h)</li>
<li>
		upload the code.</li>
</ol>
<p class="rtecenter"><a href="../sites/default/files/emon_help.png"><img alt="" src="../sites/default/files/emon_help.png" style="width: 500px; height: 300px; " /></a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4031"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Wed, 25/04/2012 - 18:00.</div>
    <div class="content">
     <p>Thanks Pcunha, It was the emonlib.c I didn&#39;t have in, when i put that in the lib folder it worked.</p>
<p>I&#39;m just experimenting with a sketch that Paul Reed uses but that throws up errors, if you could try that as below.</p>
<p>Paul said it works ok but he used the older version of Arduino IDE.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	/ Mains AC Non-Invasive Energy Monitor (2 channel)&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	// Last revision 27th Oct 2010</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	// Licence: GNU GPL</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	// By Trystan Lea (updated to support two channel energy monitoring by Glyn Hudson)</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	// VARIABLE DECLERATION</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //--ENERGY MEASURMENT VARIABLES------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //Power measurement/time variables</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; unsigned long t_now, t_diff, t_last, t_culm;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //kwhTotal is cumulative kwh today.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; double Solarkwh =0.0;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; double Mainskwh =0.0;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	// EMON</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	// include the library code:</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	#include &lt;LiquidCrystal.h&gt; &nbsp;// initialize the library with the numbers of the interface pins</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	LiquidCrystal lcd(8, 9, 10, 11, 12, 13);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int menuState = 0;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int menu = 0;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int wavelengths = 3000; &nbsp; //number of wavelengths to sample</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int inPinV = 1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Analog input pin number that voltage signal is connected to</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int inPinI_1 = 3; &nbsp; &nbsp; &nbsp; &nbsp; //Analog input pin number that current signal is connected to. Channel 1</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int inPinI_2 = 2; &nbsp; &nbsp; &nbsp; &nbsp; //Analog input pin number that current signal is connected to. Channel 2&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int menupin = 1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Arduino pin 1 goes to pushbutton for menu</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int RelayOn = 4; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Arduino pin 4 goes to the opto isolator (full power)</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int HRelayOn = 3; &nbsp; &nbsp; &nbsp; &nbsp; //Arduino pin 3 goes to opto isolator (half power)</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int led_on = 6; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Arduino pin 6 goes to panel LED</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//channel 1</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	double VCAL = 1.28348; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Voltage calibration scaler</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	double ICAL_1 = 0.05815; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Current calibration scaler</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	double ICAL_2 = 0.05806;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	double PHASECAL = 2.3; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Shifts voltage relative to current,&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //subtracting any phase shifting caused by components</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	int emon_timeout = 2000; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //how long to wait ms if something goes wrong.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	class Channel</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; public:</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; void emon_calc(int,double); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//create pulse function&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; double realPower, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Output variables</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;apparentPower,</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;powerFactor,</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;Vrms,</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;Irms,&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;whInc,&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;wh;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; private: // Variable declaration for emon_calc procedure</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;int lastSampleV,sampleV; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//sample_ holds the raw analog read value, lastSample_ holds the last sample_</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; int lastSampleI,sampleI; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; double lastFilteredV,filteredV; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Filtered_ is the raw analog value minus the DC offset</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; double lastFilteredI, filteredI; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; double phaseShiftedV; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Holds the calibrated phase shifted voltage.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; double sqV,sumV,sqI,sumI,instP,sumP; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//sq = squared, sum = Sum, inst = instantaneous</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; int startV; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //Instantaneous voltage at start of sample window.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; boolean lastVCross, checkVCross; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//Used to measure number of times threshold is crossed.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; int crossCount; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // &#39;&#39;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; unsigned long lwhtime, whtime; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//used to calculate energy used.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	};</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	Channel ch1,ch2; &nbsp; &nbsp;//create two incidence of class channel for the two channels</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	// SETUP</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	void setup()</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;lcd.begin(16, 4); // set up the LCD&#39;s number of columns and rows:</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;Serial.begin(9600);&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;pinMode(RelayOn,OUTPUT); // this sets the pin named RelayOn to be an output</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;pinMode(HRelayOn,OUTPUT); // this sets the pin named RelayOn to be an output</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;pinMode(menupin, INPUT); // this sets the pin named menupin to be an input</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;pinMode (led_on, OUTPUT); //this sets the pin named led_on to be an output</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;t_culm = (3600000 * 12); &nbsp; &nbsp; &nbsp; //On first run, advances the 24hr timer by 12hrs (so can restart at midday!) &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;//t_culm = (3600000 * 23.75); &nbsp;//FOR TESTING ONLY</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;digitalWrite(RelayOn,HIGH); &nbsp; //Switches relay off</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;digitalWrite(HRelayOn,HIGH); &nbsp;//Switches relay off</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;//Introduces 15 second delay to allow caps to charge up</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot; &nbsp;Please Wait &nbsp;&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Initialising....&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; delay (15000);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	unsigned long wtime;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	// MAIN LOOP</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	//--------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	void loop()</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	{&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //-------------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; // 1) Calculate energy monitor values</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //-------------------------------------------------------------------------------------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;/ch1.emon_calc(inPinI_1,ICAL_1); &nbsp;//Energy Monitor calc function for channel 1, pass Arduino analog in pin nummber and calibration coefficient&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; ch2.emon_calc(inPinI_2,ICAL_2); &nbsp;//Energy Monitor calc function, for channel 2, pass Arduino analog in pin nummber and calibration coefficient</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //--ENERGY MEASURMENT CALCULATION---------------- &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;//Power measurement</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; t_now = millis();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if ( t_now &gt; t_last ) { &nbsp; //check to see if millis has overflowed back to zero (after approx 49 days)</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; t_diff = t_now - t_last; } //if not, the time each emon cycle takes</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; else { &nbsp;//if millis has reset...</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; t_diff = 4127; } &nbsp; //t_diff = (the amount of time each average emon cycle takes), again dealing with the millis reset.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; t_culm += t_diff;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; t_last = t_now;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; if ( t_culm &gt; (3600000 * 24)){ //check to see if 24hrs has elapsed</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; Solarkwh = 0; // RESET</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; Mainskwh = 0; // RESET</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; t_culm = 0; &nbsp; // RESET</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; }</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //ch1.realPower = 2534; &nbsp;//FOR TESTING ONLY</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //ch2.realPower = 1522; &nbsp;//FOR TESTING ONLY</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; //Calculate number of kwh generated.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; Solarkwh = Solarkwh + ((ch1.realPower/1000.0) * 1.0/3600.0 * (t_diff/1000.0));</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; Mainskwh = Mainskwh + ((ch2.realPower/1000.0) * 1.0/3600.0 * (t_diff/1000.0)); &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; //------------Data Output-------------</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; //Read menupin to see what menu to display</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; menuState = digitalRead(menupin);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if ( menuState == LOW) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; menu = menu+1; }</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if (menu &gt; 4){</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; menu = 0;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; } &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; //MENU 0 &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if (menu == 0) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; // clear the lcd screen</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; //if-else statement to alter LCD print format depending upon power reading</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; if (ch1.realPower &gt;= 1000) &nbsp;{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; lcd.print(&quot;Solar &quot;); lcd.print(ch1.realPower / 1000.0, 3); lcd.print(&quot; kW&quot;); &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; else &nbsp;{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; lcd.print(&quot;Solar &quot;); lcd.print(ch1.realPower, 0); lcd.print(&quot; Watts&quot;); &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; if (ch2.realPower &gt;= 5000) &nbsp;{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; lcd.print(&quot;M/Power over 5kW&quot;); }</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; else</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; if (ch2.realPower &gt;= 1000) &nbsp;{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; lcd.print(&quot;Mains &quot;); lcd.print(ch2.realPower / 1000.0, 3); lcd.print(&quot; kW&quot;); &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; else &nbsp;{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; lcd.print(&quot;Mains &quot;); lcd.print(ch2.realPower, 0); lcd.print(&quot; Watts&quot;); &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;lcd.setCursor(0, 2);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Voltage &quot;); lcd.print(ch1.Vrms, 0); lcd.print(&quot; V&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; }</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; //MENU 1 - to enable detailed readings for calibration</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if (menu == 1) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Solar &quot;); lcd.print(Solarkwh); lcd.print(&quot; kWh&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Mains &quot;); lcd.print(Mainskwh); lcd.print(&quot; kWh&quot;); &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; //MENU 2 - to enable detailed readings for calibration</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if (menu == 2) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;PowerF &quot;); lcd.print(ch1.powerFactor, 2);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Voltage &quot;); lcd.print(ch1.Vrms, 0); lcd.print(&quot; V&quot;); &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; //MENU 3 - to enable detailed readings for calibration</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if (menu == 3) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Solar &quot;); lcd.print(ch1.realPower, 0); lcd.print(&quot; W&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Mains &quot;); lcd.print(ch2.realPower, 0); lcd.print(&quot; W&quot;); &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; //MENU 4 - DEMO MODE</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if (menu == 4) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print (&quot;Press button for&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;3 secs for demo&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; delay (3000);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; if (digitalRead(menupin)== LOW) { &nbsp;//check to see if button is still pressed</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print (&quot;DEMO MODE&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; delay (2000);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Solar 1.326 kW&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Mains 298 Watts&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; digitalWrite (led_on,HIGH);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; delay (10000);&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Solar 18.36 kWh&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Mains 4.29 kWh&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; digitalWrite (led_on,HIGH);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; delay (10000);&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.clear();</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 0);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;PowerF 0.98&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.setCursor(0, 1);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; lcd.print(&quot;Voltage 247 V&quot;);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; digitalWrite (led_on,HIGH);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; delay (10000);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; menu = 0; }</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; else {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; menu = 0; }</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; }</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;//checks to see if can run at full power</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; if (ch1.realPower &gt; (ch2.realPower +1090)) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; digitalWrite(HRelayOn,HIGH); //turn the half power output off</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; digitalWrite(RelayOn,LOW); //turn the full output on</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; else{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; digitalWrite(RelayOn,HIGH); //turn the output off</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;//checks to see if can run at half power</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp;if (ch1.realPower &gt; (ch2.realPower +545)) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; digitalWrite(HRelayOn,LOW); }//turn the output on</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else &nbsp;{</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digitalWrite(HRelayOn,HIGH); //turn the output off</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;//LED control&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;if (digitalRead(RelayOn) == LOW) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp;analogWrite(led_on, 200); &nbsp;}</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;else if (digitalRead(HRelayOn) == LOW) {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp;analogWrite(led_on, 30); &nbsp; } //quarter brightness</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp;else {</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digitalWrite (led_on,HIGH);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;delay (100);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;digitalWrite (led_on,LOW);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp; &nbsp; &nbsp; &nbsp; }</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; text-align: left; ">
	&nbsp;}</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4080"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Sat, 28/04/2012 - 18:16.</div>
    <div class="content">
     <p>&nbsp;</p>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 11px; line-height: 15px; text-align: left; background-color: rgb(238, 238, 238); ">
	&nbsp;/ch1.emon_calc(inPinI_1,ICAL_1); &nbsp;//Energy Monitor calc function for channel 1, pass Arduino analog in pin nummber and calibration coefficient&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 11px; line-height: 15px; text-align: left; background-color: rgb(238, 238, 238); ">
	&nbsp; ch2.emon_calc(inPinI_2,ICAL_2); &nbsp;//Energy Monitor calc function, for channel 2, pass Arduino analog in pin nummber and calibration coefficient</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 11px; line-height: 15px; text-align: left; background-color: rgb(238, 238, 238); ">
	&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	You shoud remove a slash in the first line above.</div>
<div>
	You shoud add one slash at the very first line of the code, as its a comment.</div>
<div>
	&nbsp;</div>
<div>
	It looks to me that the code is not complete. it trows an compilation error. the&nbsp;<span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 11px; line-height: 15px; text-align: left; ">emon_calc</span>&nbsp;funcion&nbsp;does not have any code.</div>
<div>
	&nbsp;</div>
<div>
	In my opinion you shoud start with a working example at openenergymonitor github and then modify for your needs.</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4081"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-531.jpg" alt="markbeal2&#039;s picture" title="markbeal2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: AC Analog conversion for UNO</h3>

    <div class="submitted">Submitted by <a href="../user/531.html" title="View user profile.">markbeal2</a> on Sat, 28/04/2012 - 20:35.</div>
    <div class="content">
     <p>Thanks pcunha for the advice, I have a script that works now and have modified it to my needs. Thanks again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/595"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-NrPxtfsWZ0o19XuXRSM7lzVsSlPB9GlJyDBvgA07KBE" value="form-NrPxtfsWZ0o19XuXRSM7lzVsSlPB9GlJyDBvgA07KBE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
