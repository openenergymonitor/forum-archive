<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/45 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:30:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>7 segment display | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
          <span class="submitted"></span>
      <div class="taxonomy"></div>
      <div class="content"><h2>How to add a 7 segment display</h2>
<p>This guide details how to add a four-digit seven-segment display with a mode changer that makes it possible to cycle through the various values to be displayed, and a frequency indicator.</p>
<p><img alt="" height="450" src="../sites/default/files/display_1.jpg" width="600" /></p>
<p>The four 7-segment digits are driven by a MAX7221 driver and the mode changer by a shift register to minimize the number of Arduino digital pins needed. The value displayed is controlled by rotating a potentiometer.</p>
<p>There are already excellent guides on building the 7-segment display and the shift register for the mode changer, independently of each other so they won&#39;t be repeated here. This guide details how to integrate both, including some pictures of the circuits I built as a layout suggestion, and the adapted Arduino code which is detailed below.</p>
<p>Here are the guides for the 7-segment display and shift register, both in the Arduino playground:</p>
<h3>7-segment display</h3>
<p><a href="https://www.arduino.cc/playground/Main/LEDMatrix">Controlling an LED matrix or 7-segment display with the MAX7219 or the MAX7221</a> - This is the main page that links to the two pages below.</p>
<p><a href="https://www.arduino.cc/playground/Main/MAX72XXHardware">The MAX7219 and MAX7221 LED drivers</a> - details the 7-segment display hardware, including circuit diagrams and discussion of various factors that need to be taken in to account.</p>
<p><a href="https://www.arduino.cc/playground/Main/LedControl">LED Control Library</a> by Eberhard Fahle - details the Arduino library required to drive the display, including download.</p>
<h3>Mode chooser</h3>
<p><a href="https://www.arduino.cc/en/Tutorial/ShiftOut">Serial to Parallel Shifting-Out with a 74HC595</a> - By Carlyn Maw and Tom Igoe. Details how to build the shift register circuit that allows us to have 8 digital output pins with only 3 input pins.&nbsp;I&#39;ve used 6 of the outputs for the mode chooser and 2 for the frequency indicator.<strong> </strong></p>
<h3>Layout suggestions</h3>
<p>Here are pictures of the boards I built, in case they are useful when trying to work out how to place the components. Let me know if there&#39;s any detail that isn&#39;t clear. More pictures can be found <a href="https://picasaweb.google.com/trystan.lea/Display?feat=directlink">here</a>.</p>
<p><strong><em>Left:</em></strong><em> Circuit board with 7-segment display, mode chooser, frequency indicator, potentiometer and socket.<br />
<strong>Right: </strong>Circuit board with the 7-segment display removed.</em></p>
<p><a href="../sites/default/files/display01.jpg"><img align="left" alt="" height="281" hspace="5" src="../sites/default/files/display01.jpg" width="375" /></a><a href="../sites/default/files/display02.jpg"><img alt="" height="281" hspace="5" src="../sites/default/files/display02.jpg" width="375" /></a></p>
<p>Back side of the 7-segment display and mode chooser:</p>
<p><a href="../sites/default/files/display03.jpg"><img align="left" alt="" height="281" hspace="5" src="../sites/default/files/display03.jpg" width="375" /></a><a href="../sites/default/files/display04.jpg"><img alt="" height="281" hspace="5" src="../sites/default/files/display04.jpg" width="211" /></a></p>
<p>Pictures of installation on wall. Communication wire goes through a hole in the wall to the main unit.</p>
<p><a href="../sites/default/files/display05.jpg"><img align="left" alt="" height="188" hspace="5" src="../sites/default/files/display05.jpg" width="250" /></a></p>
<p><a href="../sites/default/files/display06.jpg"><img align="left" alt="" height="188" hspace="5" src="../sites/default/files/display06.jpg" width="250" /></a></p>
<p><a href="../sites/default/files/display07.jpg"><img alt="" height="188" hspace="5" src="../sites/default/files/display07.jpg" width="139" /></a></p>
<h2>Arduino software:</h2>
<p>The Arduino sketch works with the display and an Arduino independently of other energy monitor hardware and code. The intent is to make it easier to see what&#39;s happening and to make it easier to use the code in other projects. For an example of how to add it to a full setup, have a look here&nbsp;<a href="https://openenergymonitor.org/node/43">home energy monitor documentation page</a>.</p>
<p>The main addition to the example code by Eberhard Fahle is code to make the decimal point work.<br />
The position of the decimal point depends on the number of significant figures.</p>
<p><strong>Software steps:</strong></p>
<ol>
<li>Download the sketch here: <a href="../sites/default/files/SAdisplay.tar.gz">SAdisplay.tar.gz</a></li>
<li>Compile and upload the sketch to the Arduino. For a guide on compiling and uploading the sketch to the Arduino have a look <a href="https://openenergymonitor.org/node/12">here</a>.</li>
<li>You should now see the display light up, and be able to select the values set in the sketch, with the mode chooser.</li>
</ol>
<h2>Further detail on hardware</h2>
<p>The display is made up of 3 independent parts:</p>
<p><strong>1) The 7 segment display</strong></p>
<p>To build the display, follow this link:</p>
<p><a href="http://www.arduino.cc/playground/Main/LEDMatrix">Controlling a Led matrix or 7-segment displays with the MAX7219 or the MAX7221</a>&nbsp;-</p>
<p><strong>2) The mode chooser indicator LEDs and the Large Red and Green Led&#39;s</strong></p>
<p>The mode chooser LEDs (the 6 small green LEDs) and the 2 larger LEDs are all driven by the shift register.<br />
To build the mode selector, follow this link:</p>
<p><a href="http://www.arduino.cc/en/Tutorial/ShiftOut">Serial to Parallel Shifting-Out with a 74HC595</a>&nbsp;</p>
<p><strong>3) The mode chooser potentiometer</strong></p>
<p>This potentiometer is connected directly to one of the Arduino analog inputs, As you turn the potentiometer it provides a varying voltage from 0V to 5V which is read by the Arduino via analogRead() The voltage is used to select the mode.</p>
<p>The only thing the 3 parts share in terms of hardware are the same 5V supply and ground.</p>
<ul>
<li>There are 3 control lines for the 7 segment to the Arduino</li>
<li>There are 3 control lines for the shift register</li>
<li>One analog line from the potentiometer</li>
</ul>
<p>If you wish to build the unit, I recommend building each section individually first, per the linked guides. In terms of actual order of connection to the Arduino this is how I have it organised, but feel free to choose different pins if you require.</p>
<p>&nbsp;</p>
<div><strong>7-segments display</strong></div>
<div>Arduino pin 11 is connected to the DataIn (pin 1)</div>
<div>Arduino pin 12 is connected to the CLK (pin 13)</div>
<div>Arduino pin 13 is connected to LOAD (pin 12)</div>
<div>&nbsp;</div>
<div><strong>Shift register</strong></div>
<div><strong>Arduino -&gt;&nbsp;74HC595&nbsp;</strong></div>
<div>
<div>int latchPin = 9;&nbsp;//Pin connected to ST_CP of 74HC595 pin 12</div>
<div>int clockPin = 8;&nbsp;&nbsp;//Pin connected to SH_CP of 74HC595 &nbsp;pin 11</div>
<div>int dataPin = 10;&nbsp;&nbsp;////Pin connected to DS of 74HC595 pin 14</div>
<div>&nbsp;</div>
<div><strong>Potentiometer</strong></div>
<div>to analog input pin 0</div>
<p>&nbsp;</p>
</div>
    
    
      </div>
<div id="comments">
  <a id="comment-1545"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Wed, 16/02/2011 - 15:19.</div>
    <div class="content">
     <p>mode chooser, frequency indicator, potentiometer... can you give me more info about these, and how theyr connected please ?? :D.. i think the socket is to connect with the arduino...therefore it should be connected in a specific way???</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-1546"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 16/02/2011 - 18:05.</div>
    <div class="content">
     <p>&nbsp;Hey Polidano, added a bit more info above, does it answer your question?</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-1547"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Thu, 17/02/2011 - 06:32.</div>
    <div class="content">
     <p>what can I say...your just number 1 :D.. I really appreciate </p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div></div><a id="comment-1531"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by Guest (not verified) on Fri, 11/02/2011 - 09:45.</div>
    <div class="content">
     <p>can you please explain to me more how these two are connected together?? cause I got kind of lost..thanks :)</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-1537"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 15/02/2011 - 08:57.</div>
    <div class="content">
     <p>The 595 is actually independent of the 7219. The 7219 part of the circuit is used to drive the 7-segment while the 595 is used to drive the row of led's.&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div><a id="comment-1482"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by Guest (not verified) on Mon, 27/12/2010 - 04:17.</div>
    <div class="content">
     <p>may I ask please, where are you using the 8*8 LED matrix, and why?? thanks</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-1484"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 28/12/2010 - 12:27.</div>
    <div class="content">
     <p>&nbsp;there's no matrix here? :)</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-1497"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by Guest (not verified) on Thu, 06/01/2011 - 13:16.</div>
    <div class="content">
     <p>but when you follow other links, there are two max722.. connected together and one of them is connected to an 8*8 LED matrix..thats why im asking why</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-1498"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 06/01/2011 - 14:40.</div>
    <div class="content">
     <p>&nbsp;I think the same chip can be used for matrixes and 7segments. Im just using it for 7 segments only, so just ignore the matrixes.</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div></div></div><a id="comment-1362"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Alan&#039;s picture" title="Alan&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: 7 segment display</h3>

    <div class="submitted">Submitted by Alan (not verified) on Wed, 28/07/2010 - 15:22.</div>
    <div class="content">
     <p>I really like this project! I'm working on a similar project so this is a big help! </p>
<p>Would you post a schematic of the mode chooser? I'm designing a circuit using the MAX7221, and I don't follow why you don't use another 7221/7219 for the mode indicators. I also don't at all follow how the mode chooser pot sends data back to the Arduino. </p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="item-list"><ul class="pager"><li class="pager-current first">1</li>
<li class="pager-item"><a href="https://learn.openenergymonitor.org/?redirect=7-segment-display?page=1" title="Go to page 2" class="active">2</a></li>
<li class="pager-next"><a href="https://learn.openenergymonitor.org/?redirect=7-segment-display?page=1" title="Go to next page" class="active">next ›</a></li>
<li class="pager-last last"><a href="https://learn.openenergymonitor.org/?redirect=7-segment-display?page=1" title="Go to last page" class="active">last »</a></li>
</ul></div></div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
