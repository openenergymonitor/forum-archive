<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Mk2i PV Router, interrupt-based | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/3">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Mk2i PV Router, interrupt-based</h3>
        <span class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 14/01/2013 - 15:48</span>
        <div class="content"><p>Just a few hours after posting my last version of Mk2a, the same code was returned to me having been converted to run on an interrupt-basis.&nbsp; Although <a href="http://openenergymonitor.org/emon/user/1332" title="View user profile.">JBecker</a> was not able to check this himself, it worked perfectly at the first attempt.&nbsp; My heater flicked on and off just as before.&nbsp;</p>
<p>But was this new version really any better than the previous one, and did I actually want to go down the route of interrupts?&nbsp; After a bit of rearrangement, I got TALLYMODE working again and the true benefit of this new scheme became immediately apparent.&nbsp; With my previous version, I was seeing around 89 samples per mains cycle.&nbsp; But with this alternative arrangement, that value had increased to 96.&nbsp;&nbsp; Before, the main processor used to wait in a while() loop until the ADC had set a particular bit in the ADCSRA register.&nbsp; Only then could it reconfigure and restart the ADC.&nbsp; But when in free-running mode, the ADC restarts automatically, which is clearly a much better arrangement.</p>
<p>A second interrupt-based scheme soon appeared from the same source.&nbsp; This version uses a hardware timer of a specified duration.&nbsp; By this means, the sampling rate can be varied to suit the workload of the system.&nbsp; Perfect for anyone who wants to add lots of extra functionality.</p>
<p>But how much spare time is there.&nbsp; My SPEEDCHECK facility no longer worked with these new arrangements, but J&ouml;rg soon came up with a nifty routine which determines how much spare processing capacity is available.&nbsp; This is achieved by introducing an increasing amount of per-loop delay using delayMicroseconds() until all available time is used up.&nbsp; By repeating each stage several times (my contribution!), minimal disruption to the underlying measurement system is caused and the numbers are easier to see.&nbsp; This mechanism has been included in Mk2i&nbsp; as WORKLOAD_CHECK. &nbsp;</p>
<p>So, who might want to use this latest version?</p>
<p>For anyone who simply wants a system for diverting surplus power, as do I, the free-running version of Mk2i should be ideal.&nbsp; This runs faster than any previous version and the sampling rate should be nice and steady.&nbsp; In this mode, WORKLOAD_CHECK reveals that the amount of spare time per sample pair is around 120uS, so the main processor is only busy for approx 60% of the time.&nbsp; Occasional serial statements are OK with this setup.</p>
<p>For anyone who wants a system that can divert surplus power but must also do other tasks as well, the timer-based version of Mk2i may be better.&nbsp; By increasing the duration of the timer, the amount of spare processing capacity can be increased as necessary.&nbsp; With a timer duration of 200uS, i.e. 50 sample pairs per mains cycle, the amount of spare time per sample pair is around 300uS.&nbsp; The Arduino&#39;s main processor is therefore idle for around 75% of the time. &nbsp;</p>
<p>Only one ADC mode may be enabled at a time.&nbsp; This is ensured by the use of #error flags at the compiler stage.&nbsp; When using the ADC_TIMER mode, the standard library directory Timer1 must be available (for TimerOne.cpp).</p>
<p>TALLYMODE and WORKLOAD_CHECK are extra features, only one of which may be enabled at a time.&nbsp; Again, this requirement is enforced at compile time.&nbsp; TALLYMODE now displays the mid-point value of each tally rather than the value of its index.&nbsp; This makes it much easier to display such data on a spreadheet.</p>
<p>ANTI_FLICKER mode is still available as in Mk2a rev3.&nbsp; It is activated by changing the value of operatingMode near the top of the code.&nbsp; The Serial monitor now displays the version and basic details of the code that is being run.&nbsp; So never again will I have to worry about which version is actually running in the garage!</p>
<p>A spreadsheet with two pages of tallymode results is attached.&nbsp; All results are for runs of 10-seconds only.&nbsp; On the first sheet, powers of 0W and 60W are shown as measured using the free-running ADC mode.&nbsp; One of the raw data files is attached in which the number of sample pairs per mains cycle is shown as 96 (integer rounded).&nbsp; The second sheet compares the results of measuring a 60W load using four different settings:&nbsp; free-running (x1), and timer-based (x3) with durations of 125uS, 150uS and 200uS.&nbsp; The same graph, at an enlarged scale, is attached to this posting.</p>
<p>If you find any bugs or typos, or there is obviously a better way of doing something in the code, do please let me know.&nbsp; Cheers J&ouml;rg, IOU a bier!</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/5780" class="topic-previous" title="Go to previous forum topic">‹ best placement of temp sensor</a>
              <a href="/emon/node/5749" class="topic-next" title="Go to next forum topic">how much space does logging take? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-9116"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1774" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1774.jpg" alt="PaulOckenden&#039;s picture" title="PaulOckenden&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1774" title="View user profile.">PaulOckenden</a> on Mon, 14/01/2013 - 15:55.</div>
    <div class="content">
     <p>We&#39;ll soon have more forks than a Frankie and Bennys!</p>
<p>P.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9117"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 14/01/2013 - 15:57.</div>
    <div class="content">
     <p>No, that&#39;s only with Github :D</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9118"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Mon, 14/01/2013 - 16:01.</div>
    <div class="content">
     <p>wow, i cant keep up with all of this. I haven&#39;t spoken to the wife for ages!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9120"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1774" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1774.jpg" alt="PaulOckenden&#039;s picture" title="PaulOckenden&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1774" title="View user profile.">PaulOckenden</a> on Mon, 14/01/2013 - 16:03.</div>
    <div class="content">
     <p>Actually, Github (or maybe another repository) would solve a lot of these forking problems.</p>
<p>(Don&#39;t say that out loud).</p>
<p>P.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9122"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 14/01/2013 - 17:35.</div>
    <div class="content">
     <p><em>Github (or maybe another repository) would solve a lot of these forking problems.</em></p>
<p>That depends on the path that the developer has taken to get to version N+1.&nbsp; Over the last few months, I&#39;ve acquired all sorts of useful bits and pieces, and things pretty much get cut-and-pasted together as required to meet the need of the day.&nbsp;</p>
<p>When writing code for Marconi some years ago, all softies had to abide by the official Revision Control system that controlled everything.&nbsp; The dates of future builds were known - more or less - and code had to compile and link to everything else by that deadline.&nbsp; Then there were all those offline tests, hundreds of them, and then the system tests ...</p>
<p>No thanks, this ad-hoc arrangement suits me just fine :)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9139"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 15/01/2013 - 14:20.</div>
    <div class="content">
     <p>With some welcome sunshine today, I&#39;ve loaded the new code onto my rig in the garage, and it does indeed behave as expected.&nbsp;</p>
<p>In WORKCHECK_MODE, I was getting a few 1uS readings amongst the normal ones.&nbsp; This appears to be because the double print statement is too much for the processor to do given that it has just been overloaded to the point of complaint.&nbsp; This effect can be avoided by printing these statements on consecutive loops (at around line 540):</p>
<p>#ifdef WORKLOAD_CHECK<br />
	&nbsp; switch (displayFlag)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; case 0: // the result is available now, but don&#39;t display until the next loop<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayFlag++;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp;&nbsp;&nbsp; case 1: // with minimum delay, it&#39;s OK to print now<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(res);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayFlag++;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp;&nbsp;&nbsp; case 2: // with minimum delay, it&#39;s OK to print now<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot;uS&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; displayFlag++;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp;&nbsp;&nbsp; default:; // for most of the time, displayFlag is 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; }<br />
	#endif<br />
	&nbsp;</p>
<p>Just as I was about to capture some decent readings with &gt;1kW of PV, the clouds appeared.&nbsp; But with around 350W of total PV still available, that was just enough to keep the system ticking over so I grabbed a 60s &#39;tallymode&#39; run with the ADC in free-running mode.&nbsp; These results have been processed on sheet 3 of the revised spreadsheet, with resulting graphs as attached (and hopefully below too).&nbsp; This gives a lot of insight as to what&#39;s going on in normal mode (not anti-flicker).</p>
<p><a href="http://openenergymonitor.org/emon/sites/default/files/balanceWithPV_HiRes.jpg"><img alt="" height="200" src="http://openenergymonitor.org/emon/sites/default/files/balanceWithPV_HiRes.jpg" width="600" /></a></p>
<p>Throughout this run, the net flow of energy at our supply point was approx. 125W of export.&nbsp; That sounds about right, the neon was flashing at around 2-3 Hz (each active cycle consumes 60 Joules).</p>
<p>The twin peak effect at around -1500W is caused by the floating nature of the non-invasive CT.&nbsp; This effect can be seen whenever there&#39;s an isolated cycle of the dump load (or anything else for that matter).&nbsp; The first half of the active cycle is always seen to contain less energy than the second half.&nbsp;</p>
<p>The small peak at around -2750W is the signature of two (or more) active cycles occurring consecutively.&nbsp; This allows the triac to remain on for the full duration of a 20mS measurement window.&nbsp; Because of the interleaving of the measurement and power distribution cycles, this is not the normal behaviour at low levels of surplus power.&nbsp; The energy values for each of the 3000 recorded cycles were all in one peak or another, the &#39;hit&#39; values being:&nbsp; +100W: 2688;&nbsp; -1200W: 145; &nbsp; -1700W: 156;&nbsp;&nbsp; -2700W: 11.&nbsp; I think this means that there were 145 firings of the triac for one cycle, and 11 firings for two cycles.&nbsp;</p>
<p>During this run, the free-running Mk2i code recorded 96 energy calculations per mains cycle (average).&nbsp; My rig has not been accurately calibrated, hence the 3kW dump load appears to be around 10% lower than its proper value.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9203"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Fri, 18/01/2013 - 01:39.</div>
    <div class="content">
     <p>Robin, I&#39;ve just built one of these using this new code and it&#39;s great.&nbsp;Using it in flicker mode first.&nbsp;I would like to have a second output pin for if the solar output (less house load) is greater than the immersion load for example. I have 11 kw of pv.&nbsp;I don&#39;t have any knowledge at all with sketches and have seen that you have mentioned elsewhere you just need to put in an output for a larger bucket size. I&#39;m unsure how to do that and where to put it. I guess it would be possible to use the same output as the onboard bucket overrun led but guess this isn&#39;t ideal. (My led&nbsp;flashes when theres no load on at all, after a while, but i guess that&#39;s because i haven&#39;t got the values quite right yet.)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9211"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 18/01/2013 - 08:31.</div>
    <div class="content">
     <p>Hi Nick, I&#39;m pleased to hear that this latest version of the Mk2 Router is working nicely for you.&nbsp; Having resisted going down the road of interrupts for some time, it does appear to be the optimum way to go.&nbsp;</p>
<p>An alternative scheme for diverting surplus power should be fairly straightforward once the underlying requirements are known.&nbsp; An anti-flicker algorithm for 11kW will be interesting.&nbsp; Hopefully you will be able to distribute the power across several loads.&nbsp; On the measurement side, you would presumably need to re-scale your current sensor for all that power.</p>
<p>If you send me a PM with some more details, I&#39;m sure that some suitable scheme can be devised.&nbsp; The Flicker Demo tool that&#39;s mentioned in the index at <a href="http://openenergymonitor.org/emon/node/1757" title="http://openenergymonitor.org/emon/node/1757">http://openenergymonitor.org/emon/node/1757</a> may be a good place to start.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9214"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Fri, 18/01/2013 - 09:36.</div>
    <div class="content">
     <p>Thanks Robin.</p>
<p>I was wondering about the current transformer, as at the moment&nbsp;I have&nbsp;the 50A one from Rapid as mentioned in your post. It has the internal burden resistor and at the moment&nbsp;I have not added&nbsp;an external one. What I&#39;ve found is, obviously, it only does 0.33v at 50A so my readings are very low and&nbsp;I have a PowerCal value of 0.81.But it works fine at that.&nbsp;If everything&nbsp;is working as it should then the actual current to be measured &nbsp;should be&nbsp;virtually zero when generating PV so do you need a larger CT?. What happens&nbsp; even in a small system when your generating no PV and have heaters, oven, kettle etc on in the house. The current transformer will be measuring a large current. Does this not overload it or is it ok to run saturated?</p>
<p>I will PM details of the system to you, It&#39;s quite complex with battery backups (but they will use most of the spare PV initially to recharge the batteries. That&#39;s automatic and built&nbsp;in to the backup units), so it&#39;s probably only going to be like having 2 3KW elements run off your system switched in sequence. First one to&nbsp;be used for the first 3KW of surplus PV and then when above 3KW&nbsp;that would be permanently on and the second element would then be in anti flicker mode.</p>
<p>PS,&nbsp;I have to admit I&#39;d bought a couple of commercial power diverter units but&nbsp;I don&#39;t think I&#39;ll be fitting them!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9217"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 18/01/2013 - 10:28.</div>
    <div class="content">
     <p><em>If everything&nbsp;is working as it should then the actual current to be measured &nbsp;should be&nbsp;virtually zero when generating PV so do you need a larger CT?. </em></p>
<p>Although the average current over a period of time will be close to zero, the current within individual cycles will certainly not be zero.&nbsp; Between adjacent cycles where the triac is &#39;on&#39; and &#39;off, there will be a net difference of 3kW (or whatever your dump load happens to be).</p>
<p><em>What happens&nbsp; even in a small system when your generating no PV and have heaters, oven, kettle etc on in the house. The current transformer will be measuring a large current. Does this not overload it or is it ok to run saturated?</em></p>
<p>So far, our CT hasn&#39;t objected to running at higher currents such as taken by our 8kW electric shower.&nbsp; And thanks to the protection diodes, neither has my Arduino.&nbsp; Some constructors have added a gain stage immediately after the CT in order to make better use of the ADC&#39;s range. &nbsp; <a href="http://www.youtube.com/watch?v=WVqL30uOluQ%C2%A0">Video footage</a> that I&#39;ve posted of the basic Mk2&#39;s operation with a disc-type meter in our supply line show that good balance can be achieved without this refinement.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9237"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Sat, 19/01/2013 - 17:01.</div>
    <div class="content">
     <p>Robin,</p>
<p>&nbsp;</p>
<div>
	I&#39;ve just ben trying to alter the program for using an additional Triac output and&nbsp;I think I&#39;ve come across something that may want slight adaption in the&nbsp;anti flicker&nbsp;part of the program.&nbsp;It seems as if the ant flicker timer&nbsp;starts from when the triac turns on and not when it turns off. This means if the load is only just slightly&nbsp;more than the surplus PV the triac will turn on shortly after turning off. Should the time not start from when the triac turns off?</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9241"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 19/01/2013 - 20:05.</div>
    <div class="content">
     <p><em>This means if the load is only just slightly&nbsp;more than the surplus PV the triac will turn on shortly after turning off.&nbsp; </em></p>
<p>My reason for placing a restriction on the off-&gt;on event was that the consequence of delaying this transition is at worst some loss of energy to the grid when the bucket overflows.&nbsp; Whereas delaying the on-&gt;off transition could result in a direct cost to the user.&nbsp; Loss of micro-pennies to the grid seems less bad than having them added unexpectedly to the bill.&nbsp; With 80% hysteresis in place, it&#39;s difficult to see how the a/f measures can be further tightened without significant less of energy at certain times.</p>
<p>I can&#39;t recall the state of the anti-flicker demo tool that I posted some weeks ago.&nbsp; It would make sense for this to be aligned with the latest version of Mk2, i.e this one.&nbsp; If it needs to be updated, I will try to do that and post a new version.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9242"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Sat, 19/01/2013 - 21:01.</div>
    <div class="content">
     <p>Yes&nbsp;I &nbsp;understand its better to lose energy to the grid rather than the the other way round, but but as it runs at the moment if the triac is on for more than the delay time the delay time is &#39;used up&#39; during that on time so the triac can come straight back on. A delay time starting at &#39;triac off&#39; would still result in energy going to the grid and no import.</p>
<p>As I&#39;m&nbsp;trying to set up&nbsp;an additional&nbsp;&nbsp;traic anyway- this could be activated to take up any&nbsp;energy bucket overflow&nbsp;during any A/F&nbsp;delay time</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9243"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 19/01/2013 - 21:44.</div>
    <div class="content">
     <p><em>&quot;this could be activated to take up any&nbsp;energy bucket overflow&nbsp;during any A/F&nbsp;delay time&quot;</em></p>
<p>Nope. Flawed logic there I&#39;m afraid. I fell into that trap until I realised that both are using the same &quot;bucket&quot; and once the bucket is full, it&#39;s full. And once one has put a transition onto the supply, it applies to both.</p>
<p>If you want a second load to take over when the first one can&#39;t take any more energy, you need two more thresholds each slightly (i.e. a couple of &#39;load.cycles&#39; , say 120 - 150 J) above the corresponding original thresholds. But both need to feed into the anti-flicker timer.</p>
<p>Of course, if you are generating more than the first dump can dissipate, you can leave that permanently on and the flicker restriction applies to the second triac only.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9245"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 19/01/2013 - 23:28.</div>
    <div class="content">
     <p>This all sounds very complicated when written down in words.&nbsp; I&#39;ve just sketched out a couple of pictures and I think there are various ways of doing it.&nbsp; Robert&#39;s idea for having multiple &quot;tiered&quot; limits sounds fine but they will consume some of the operating range that the first triac has to play with.&nbsp; Push the limits outwards, and cost is likely to be incurred unless the system&#39;s calibration is spot-on.&nbsp; Bring them in towards each other and you&#39;re likely to have to hold the triac(s) off sooner to avoid infringing the a/f timescales, hence lost energy.</p>
<p>Another approach would be to have just one pair of limits as before, as close as possible to the 0 and 3600J points, but to always switch, say, the lowest valued triac when a limit is reached.&nbsp; If that doesn&#39;t have sufficient effect, then the next triac can be switched too after waiting for a few cycles.&nbsp; Unlike the existing algorithm, this variant would need to maintain knowledge of the state of each triac.&nbsp;</p>
<p>I had a quick look at the a/f demo tool but got bogged down with the different formats between it and the Mk2i code.&nbsp; One uses integer maths, the other is floating point.&nbsp; For demo purposes, FP is probably best. &nbsp; May have another go tomorrow ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9246"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Sat, 19/01/2013 - 23:32.</div>
    <div class="content">
     <p>Oh I&#39;m daft- Of course the first triac won&#39;t turn off because the first dump can&#39;t handle the surplus! Forgot that bit.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9247"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 19/01/2013 - 23:33.</div>
    <div class="content">
     <p>On second thoughts, I think Robert&#39;s explanation/ ideas on this one are better than mine.&nbsp;</p>
<p>Time to bow out gracefully ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9248"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Sat, 19/01/2013 - 23:37.</div>
    <div class="content">
     <p>All your sketches are really complicated to me as my computer programing knowledge is based on &#39;basic&#39; and that was from x years ago and&nbsp;I cant remember that!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9249"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 20/01/2013 - 01:55.</div>
    <div class="content">
     <p>If you go back to basics (not BASIC) the meter &#39;window&#39; (AKA &#39;bucket&#39;) capacity is 1 Wh or 3600 J.&nbsp; For a 3 kW heater, 1 load.cycle = 3 kW x 20 mS = 60 J.&nbsp; If your first load can&#39;t absorb the energy, I think you can afford 2&frac12; cycles&#39; worth - 150 J - that&#39;s only 4and-a-bit percent of the &#39;bucket&#39;, so setting the 1st load&#39;s thresholds 2% lower than you otherwise would, and the 2nd load&#39;s 2% above won&#39;t eat into your margins all that much.</p>
<p>(Or to put it another way, of your calibration was out by 2%, you&#39;d be there anyway and not know it).</p>
<p>Knowing the state of the triac won&#39;t help much, because it isn&#39;t the only thing controlling the load, there&#39;s the thermostat as well...</p>
<p>Tinbum:</p>
<p>If you&#39;re struggling with C++, there&#39;s a reasonably good free on-line resource <a href="http://www.relisoft.com/book/index.htm">here</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9251"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 20/01/2013 - 09:08.</div>
    <div class="content">
     <div class="content">
<p><em>Tinbum: All your sketches are really complicated to me as my computer programing knowledge is based on &#39;basic&#39; and that was from x years ago and&nbsp;I cant remember that!</em></p>
<p>My flicker demo tool will hopefully not be to challenging for you.&nbsp; For ease of understanding, it uses floating point maths as per all the standard OEM sketches.&nbsp; That way, the computer has to do all the hard work, rather than the user.&nbsp; I hope to re-release it soon in a form that functionally aligns with the Mk2i code.&nbsp; All Mk2x versions use integer maths which includes re-scaling of the energy bucket.&nbsp; Although greatly improving the speed of the underlying operation, integer maths does not provide a good vehicle for thinking about anti-flicker measures.</p>
<p>With a 3kW dump load, the simple anti-flicker measure that have been included in Mk2i seem just about OK.&nbsp; There are two thresholds between which the triac oscillates with hysteresis.&nbsp; To ensure compliance, there is also a time element.&nbsp; With a 3kW load, the timescale for the bucket to fill and then empty is comparable with the a/f requirements, so a/f seems do-able.</p>
<p>But with an 11kW system, things are very different.&nbsp;&nbsp; If a passing cloud suddenly drops the output by 8kW, you need to react quickly otherwise serious incursions into the cost-penalty zone will occur. &nbsp; Waiting until the bucket is nearly empty is no good because turning off one triac will not arrest the descent.&nbsp; You can&#39;t turn then off the second and third ones immediately it seems because of the multiple flicks that this would cause.</p>
<p>With such a high powered system, I think you&#39;ll need to go with phase-angle control.&nbsp; The control logic would be straightforward then.&nbsp; For example, you could split the 3600J bucket into six equal zones of 600J each.&nbsp; The upper and lower zones would be safety buffers to allow for calibration being up to 30% out.&nbsp; Each of the inner zones would be for fine control of one of the triacs, and within each zone p-a control would be used.&nbsp;</p>
<p>Here&#39;s a few snapshots of the action:</p>
<p>599J - all triacs off</p>
<p>900J - triac 1 % 50%, triacs 2-4 off</p>
<p>1500J - triac 1 fully on, triac 2 @ 50%, triacs 3&amp;4 off</p>
<p>2100 - triacs 1 &amp; 2 fully on, triac 3@ 50%, triac 4 off</p>
<p>2800 - triacs 1-3 fully on, triac 4 @ 50%</p>
<p>3000 - triacs 1-3 fully on, triac 4 @ 5/6 capacity</p>
<p>3101 - all triacs on</p>
<p>Such a system would be able to control any rapid change in surplus power without risk of undershoot or overshoot. &nbsp; At no time is 11kW being switched, so EMC protection would only be needed for 3kW transitions.&nbsp; But such protection may need to be fitted to each of the loads, especially if long wiring is involved.</p>
<p>&nbsp;</p>
</div>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9253"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 20/01/2013 - 10:41.</div>
    <div class="content">
     <p>OK, here&#39;s an updated version of my Flicker Demo tool that works in just the same way as the Mk2i PV Router.&nbsp; (The previous version did so too, but some of the code had been rearranged).&nbsp; This demo works best with a bulb as the dump load, much easier to see than the on-board LED.&nbsp; Note that pin 13 LED shows the triac state, not the overflow status as per the corresponding Router sketch.</p>
<p>It uses FP maths, so the various thresholds are obvious.&nbsp; As posted, the min time between triac activations is 5s.&nbsp; This value has been deliberately set long so that overflow of the energy bucket can be easily seen.&nbsp; With 1500W of simulated PV, look for 3600 on the display.&nbsp; That&#39;s the overflow.&nbsp; Then reduce the time constraint to 3s and it disappears.&nbsp;</p>
<p>As posted, Mk2i only uses 60% of the bucket&#39;s capacity for anti-flicker measures.&nbsp; This range can be extended at risk of running outside the sweet zone of 0.001kWh that&#39;s allowed by most meters.</p>
<p>Creating a phase-angle version of this tool, suitable for higher powers (eg 11kW and 4 triacs), should be straightforward enough.&nbsp; If this would be helpful, let me know and I&#39;ll be happy to write one.&nbsp; But it may not be for a week or two ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9254"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Sun, 20/01/2013 - 11:34.</div>
    <div class="content">
     <p>Thanks Robin- it&#39;ll take me a while to digest all the info especially as I was up nearly all night trying a few ideas myself.</p>
<p>I&#39;m not really wanting to go down the phase control route for this part as I&#39;d&nbsp;like to run loads other than just resistive loads, the main ones being battery chargers. I have two sets of batteries, one&nbsp;set is near to the DNO supply and the SMA backup units so that is totally controlled by the SMA backups automatically. The other set is more remote and this is where i&#39;d like to use the battery chargers off the surplus PV.</p>
<p>The actual flicker doesn&#39;t seem to be noticeable here and wouldn&#39;t effect anyone else as we have our own transformer off the high voltage line. Its the fact that the switching is either off or on and nothing between that&#39;s the main advantage to me.</p>
<p>In my experimenting last night i have actually come up with something that seems to work (but no where near your standard), using two triacs. 3 variable&nbsp;heaters and a kettle. (didn&#39;t run out of tea to keep me awake)!&nbsp;&nbsp;&nbsp;Running it through a spare 3 phase meter it results in the LED staying lit, but i must admit i have no knowledge of sketches and its a bit of a bodge using the bucket overflow LED &nbsp;part of the sketch to drive the second triac. If a little power goes into the grid I&#39;m not worried- its far easier than watching the sun and walking over to turn the chargers of and on individually depending on how bright it is. I have another spare 3 phase meter so i may wire this up to check the power i would lose to the grid.</p>
<p>Problem is I&#39;m a perfectionist and&nbsp;I wont be happy with myself till its spot on!!!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9255"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 20/01/2013 - 12:50.</div>
    <div class="content">
     <p>OK, I do recommend working with the demo tool though rather than the actual Mk2i code.&nbsp; With its FP maths, the demo&#39;s logic is much easier to follow/modify.&nbsp; Unlike real life, the simulator is 100% accurate, so there&#39;s no doubt as to the actual rating of your loads. Interesting &#39;near-limit&#39; conditions can be easily set up and analysed/recorded/repeated.&nbsp; The demo tool will run on any rig that Mk2 code runs on.&nbsp; It just needs a voltage source and ideally a triac on pin 9.</p>
<p>Using the simulator will also allow uninterrupted access to your kettle :)</p>
<p>If some loss of surplus power to the grid is not a problem, then devising a compliant on:off scheme for 11kW should be entirely straightforward, albeit it not very efficient when conditions change.&nbsp; It would still be a 1000000 times more efficient than &quot;<em>watching the sun and walking over to turn the chargers of and on individually depending on how bright it is</em>&quot; - heaven forbid!! If you&#39;re not happy with changing things around in the software, just send me a PM with all the details.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9256"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 20/01/2013 - 14:21.</div>
    <div class="content">
     <p>Tinbum,</p>
<p>If you&#39;ve got your own step-down transformer, then clearly flicker is much less of a worry, because (I don&#39;t know about the post-2001 standard, but...) the previous rules related to the &quot;PCC&quot; - the point of common coupling, which in your case is the junction where the line to your transformer joins up with your neighbour&#39;s supply. The transformer itself will obviously add to the supply impedance so the flicker on the supply side will be less than on the low voltage side. If you&#39;re on good terms with your neighbours and they can&#39;t see any flicker (or you can&#39;t measure it in their houses) then I would think everyone is going to be happy.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9257"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 21/01/2013 - 17:23.</div>
    <div class="content">
     <p>For anyone with their own step-down transformer, the &quot;neighbours&quot; could be miles away ;)</p>
<p>How&#39;s this for a possible anti-flicker scheme for 3 triacs/loads (as attached).&nbsp; It&#39;s basically three 1Wh windows stacked on top of each other.&nbsp; Within each zone, the relevant triac operates with hysteresis between its specified limits.&nbsp; The other two triacs will be in a constant state, either on or off.&nbsp; There would still need to be an overall timer to prevent any transitition from occurring too soon after the previous one.&nbsp;</p>
<p>Moving up between zones will cause some loss of real energy to the grid, 1Wh per zone.&nbsp; Similarly, moving down between zones will incur a real consumption charge of 1 Wh per zone change.&nbsp; For an 11kW system, this is unlikely to be seen as a problem.&nbsp; While the surplus PV rate remains constant, the system should provide normal flicker-compliant operation across the full range of powers (i.e 0 - 9kW with 3 x triacs and 3 x 3kW loads).</p>
<p>[Update - I&#39;ve just started a new thread for anti-flicker ideas at <a href="http://openenergymonitor.org/emon/node/1941" title="http://openenergymonitor.org/emon/node/1941">http://openenergymonitor.org/emon/node/1941</a> ]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9301"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 22/01/2013 - 20:18.</div>
    <div class="content">
     <p>With some welcome sunshine today, my Mk2i build was flashing away nicely with our panels generating 1.3 kW.&nbsp; Out of consideration for the neighbours, I though it best to switch over to anti-flicker mode.&nbsp; As so often seems to happen, by the time that I&#39;d hooked up the laptop, the clouds had appeared and we were down to just 250W or so.&nbsp;</p>
<p>No matter, there was still some surplus PV because the neon was slowly flashing.&nbsp; But after switching to a/f mode, it all went very quiet.&nbsp; So was there now any surplus power, or not, there was no way of knowing.&nbsp; This calls for an LED or two.</p>
<p>Mk2i_rev2 has gained 3 LEDs.&nbsp; The first one illuminates whenever the energy in a mains cycle is positive, i.e. export.&nbsp; In idle conditions, this LED rattles on &amp; off rapidly at random, as one would expect.&nbsp; Although the average flow of energy may be zero, the measured energy content of individual mains cycles will be either positive or negative, hopefully in roughly equal numbers.</p>
<p>The second LED illuminates whenever the energy bucket overflows.&nbsp; This indicates a likely loss of (real) surplus energy to the grid and should only occur when the dump-load&#39;s thermostat trips.&nbsp; If this LED ever illuminates while diverting surplus power, the a/f logic/settings should be checked.</p>
<p>The third LED illuminates whenever the energy bucket underflows.&nbsp; This indicates a likely charge for consumption from the grid.&nbsp; If this LED ever illuminates while diverting surplus power, the a/f logic/settings should be checked.&nbsp; [With the present logic that I&#39;ve included to date for a/f mode, this should never occur because the triac is always turned off at the lower energy threshold.&nbsp; But it&#39;s probably a useful safeguard to have in place in case the a/f logic were ever to change, e.g. to the symmetrical scheme which I posted yesterday on another thread].</p>
<p>(aside) To verify the operation of this build, I needed some serious currents to be flowing.&nbsp; While checking that the CT and wires were all the right way round, I did a 10sec Tallymode run for which the results are attached.&nbsp; The &#39;PV&#39; was a 60W light bulb and my dump load was a 1kW heater.&nbsp; From the results file, it can be seen that during the 500 mains cycles, the triac fired exactly 29 times.&nbsp; Because of the imbalance between the source and sink, each firing was for only one mains cycle.&nbsp; The first half of each active cycle contained power at around 455W, the second half contained power at around 565W.&nbsp; Together, these values add up to just over 1kW, as expected.&nbsp; With 58 cycles having been accounted for, there should be 500-58=442 cycles in which just the bulb&#39;s power is showing.&nbsp; Sure enough, at around the 60W mark, there are 441 cycles, and there&#39;s one odd &#39;hit&#39; at the 25W mark.&nbsp; Why that one cycle went a bit awry remains a mystery.&nbsp; Maybe one of the neighbours switched on a kettle ...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9354"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Thu, 24/01/2013 - 10:12.</div>
    <div class="content">
     <p>Sounds a great idea having the led&#39;s.</p>
<p>When i was fitting mine, all be it just in a testing manor,&nbsp;I was thinking exactly the same as the Arduino is 75m from the triacs. Of course just like you Robin, the sun hasn&#39;t shown its face since!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9357"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 24/01/2013 - 11:12.</div>
    <div class="content">
     <p>No LEDS have been fitted yet to my &#39;working&#39; rig, only to the lash-up that&#39;s next to my PC.&nbsp; If some sun were to appear, my trusty LED board may get moved back into the garage ...</p>
<p>That particular offcut of stripboard has done good service.&nbsp; Long before Mk2 put in an appearance, it showed me how much power was being diverted by my first lash-up.&nbsp; Ah, those were the days, warm and sunny, with more surplus power than one knew what to do with!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9358"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Thu, 24/01/2013 - 12:11.</div>
    <div class="content">
     <p>Oh Yes, my meters now averaging about 35 units a day from the grid, compared with about 6 in the late summer.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9362"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 24/01/2013 - 13:17.</div>
    <div class="content">
     <p>I&#39;ve just moved the LED-board into the garage with results much as expected.&nbsp;</p>
<p>With 50-100W of surplus power, the &quot;surplusPV&quot; LED is great.&nbsp; In a/f mode, it sits there, steadily on, until the bucket&#39;s level reaches the upper threshold and then goes off while 0.6 * 3600J is dumped.&nbsp; Then it comes back on again, nice and steadily.</p>
<p>But with approx zero surplus power, the red and green LEDs both flicker away furiously.&nbsp; Maybe this upgrade needs a health warning!&nbsp; I think what it really needs is a good old fashioned switch in the 0V line to the LEDs.&nbsp; Then no LEDs need be lit unless I&#39;m interested in looking at them.&nbsp;</p>
<p>FWIW, I&#39;ve used Red for underflow (pin 11), Blue for overflow (pin 12), and Green for surplusPV (pin 13)&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 25/01/2013 - 22:17.</div>
    <div class="content">
     <p>Anti-flicker mode may be OK on a good day, but in weather like this it&#39;s a real pain.&nbsp; You can wait for ages before a pulse appears at the neon, and if you blink, you&#39;ve missed it.&nbsp; Normal mode seems much better when there&#39;s so little spare power available.&nbsp; Wouldn&#39;t it be nice if you could switch from one mode to the other at run-time, with no need to recompile?</p>
<p>	Well, now you can.&nbsp; Mk2i_rev3 can be changed on-the-fly between NORMAL and ANTI_FLICKER modes at the flick of a switch.&nbsp; The state of the input pin is checked every mains cycle and persisted for a short while.&nbsp; Whenever a change of state has been confirmed, the new settings are displayed on the Serial monitor and operation continues in the new mode.&nbsp; Sample output attached.</p>
<p>	The power-distribution code is the same as before except that &quot;normal&quot; is now a special case of the anti-flicker logic (where the upper and lower thresholds are the same, and there is no time constraint between consecutive activations).</p>
<p>	The code is backwards compatible so the output mode can still be configured at compile-time as before.&nbsp; But, with a simple switch between digital pin 4 and ground, the new way of working feels much better.</p>
<p>	To check that nothing unintended has crept in, I&#39;ve compared this version against the previous one using KDiff3.&nbsp; A superb piece of free software from <a href="http://kdiff3.sourceforge.net/">Source Forge</a>.</p>
<p>	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9401"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1824" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1824" title="View user profile.">MartinR</a> on Sat, 26/01/2013 - 12:50.</div>
    <div class="content">
     <p>calypso_rae wrote: <em>&quot;How&#39;s this for a possible anti-flicker scheme for 3 triacs/loads (as attached).&nbsp; It&#39;s basically three 1Wh windows stacked on top of each other...&quot;</em></p>
<p>That stacked buffer idea of yours works really well Robin. I currently have 2 immersion heaters and 3 under floor heating zones connected to 5 triacs and I tried it out today with a 5Wh buffer. It behaves very well, both when the solar power rises and falls and when a hot water cylinder gets up to temperature.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9407"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 26/01/2013 - 16:25.</div>
    <div class="content">
     <p>I&#39;m pleased the hear that this one worked as intended Martin.&nbsp; It was only a thought experiment.</p>
<p>Robert suggested to me that the various zones could be overlaid rather than being stacked, and I think I agree.&nbsp; That&#39;s how the &#39;multiload&#39; demo works that I (eventually!) posted on your a/f thread.&nbsp; By that means, slightly less energy is lost as the system moves between the various zones, I think.&nbsp;</p>
<p>Our DHW cyclinder hasn&#39;t got itself up to temperature for a while using PV alone.&nbsp; But the days are starting to get longer now.&nbsp; I really must get my rig boxed up and onto the wall ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9409"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1824" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1824" title="View user profile.">MartinR</a> on Sat, 26/01/2013 - 16:39.</div>
    <div class="content">
     <p>I did have overlaid zones originally but it seemed to get confused with the 2&nbsp;immersion heaters sharing the load&nbsp;sometimes rather than one being fully on. I need to investigate this a bit more before rejecting the idea though.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9415"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 26/01/2013 - 18:42.</div>
    <div class="content">
     <p>Yes, my multi-load demo tool started to work in that way too.&nbsp; I ended up by turning on the lowest valued triac that was off to increase the load, but turning off the highest one that was on to decrease it,&nbsp; Hope I&#39;ve got that right.&nbsp;&nbsp; I suppose it all depends on how you want to prioritise all that power.&nbsp;</p>
<p>Although the demo seems to work OK as a stand-alone tool, I got in an awful mess when trying to transfer its logic across for my latest Mk2i build.&nbsp; The two environments just weren&#39;t compatible.&nbsp; In the end I gave up and started again next day.&nbsp;&nbsp;</p>
<p>void increaseLoadIfPossible()<br />
	{<br />
	&nbsp; // if permitted by anti-flicker restrictions, turn on the lowest valued<br />
	&nbsp; // triac that is not already on.<br />
	&nbsp; boolean done = false;<br />
	&nbsp;<br />
	&nbsp; if (cycleCount &gt; cycleCountAtLastTransition + minCycleCountsBetweenTransitions)<br />
	&nbsp; {&nbsp;<br />
	&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; noOfTriacs; i++)<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!done)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (triacState[i] == TRIAC_OFF)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nextStateOfTriac[i] = TRIAC_ON;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cycleCountAtLastTransition = cycleCount;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; done = true;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp; }<br />
	}<br />
	&nbsp;<br />
	byte decreaseLoadIfPossible()<br />
	{<br />
	&nbsp; // if permitted by anti-flicker restrictions, turn off the highest valued<br />
	&nbsp; // triac that is not already off.<br />
	&nbsp; boolean done = false;<br />
	&nbsp;<br />
	&nbsp; if (cycleCount &gt; cycleCountAtLastTransition + minCycleCountsBetweenTransitions)<br />
	&nbsp; {&nbsp;<br />
	&nbsp;&nbsp;&nbsp; for (int i = (noOfTriacs -1); i &gt;= 0; i--)<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!done)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (triacState[i] == TRIAC_ON)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nextStateOfTriac[i] = TRIAC_OFF;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cycleCountAtLastTransition = cycleCount;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; done = true;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp; }<br />
	}<br />
	&nbsp;<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9442"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 27/01/2013 - 21:57.</div>
    <div class="content">
     <p>Tonight, I wanted to check how similar my power readings are with the CT in either direction.&nbsp; Unfortunately, my latest build (Mk2i_rev3) won&#39;t run in &#39;tallymode&#39;, and I&#39;ve yet to work out why.&nbsp; Sorry about this, a corrected version will appear in due course.</p>
<p>The previous version, _rev2 is fine, and I&#39;ve attached a couple of output files using that sketch to show how a 60W bulb is measured in each direction.&nbsp; In each case, there are two runs, the first one being with no current flowing.&nbsp; There does appear to be a Watt or so of offset between the two directions, perhaps there&#39;s something amiss with the calculations.&nbsp; A rounding up or down error maybe?&nbsp;</p>
<p>In today&#39;s sunshine, _rev2 heated our water very nicely in anti-flicker mode.&nbsp; The LEDs were behaving as expected with the green one operating in anti-phase with the immersion heater&#39;s neon, and no blue or red interruptions.&nbsp; After the thermostat had tripped, the blue one was fully on.&nbsp; Then, later in the afternoon, after the sun had moved away, the red one was fully on.&nbsp;</p>
<p><em>&nbsp;I&#39;ve used Red for underflow (pin 11), Blue for overflow (pin 12), and Green for surplusPV (pin 13)&nbsp;</em></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9482"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 28/01/2013 - 19:28.</div>
    <div class="content">
     <p>After chasing myself around in circles for a while, it finally dawned on me that my rev3 build had run out of RAM.&nbsp; Too many print statements!&nbsp; By heeding the advice at <a href="http://jeelabs.org/2011/05/22/atmega-memory-use/" title="http://jeelabs.org/2011/05/22/atmega-memory-use/">http://jeelabs.org/2011/05/22/atmega-memory-use/</a> , things soon fell into place and everything started to work properly again.</p>
<p>	From that same article, I&#39;ve lifted a routine which shows how much RAM is unused.&nbsp; This is now called at three places in the code, the result being displayed each time to the Serial monitor.&nbsp; One of these occasions is whenever the mode switch is changed, there being 24 bytes less at that time than during setup().&nbsp; This seems an ideal place to check RAM availability because the processor is several levels up (down?) the stack by then.</p>
<p>	In standard mode, I&#39;m now seeing &#39;freeRam&#39; values of around 1180 bytes;&nbsp; this drops by exactly 600 when tallymode is enabled.&nbsp; Some of this will be due to its 102-element array of &#39;long&#39; tallies; the rest is consumed by various print statements and variables.&nbsp; Tallymode can be made less RAM-hungry by simply reducing NUMBER_OF_TALLIES to something less than 100.&nbsp; It was working fine today with just 5 of them while I was trying to figure out what was going on.</p>
<p>	In the previous version, I disposed of a lot of global variables.&nbsp; If they were only required by one function, but need to persist between calls, I made them static within the function that needed them.&nbsp; Turns out that a &#39;long&#39; variable consumes only 4 extra bytes if declared as a global, but 12 if declared as the only &#39;static&#39; variable in a code block.</p>
<p>	Sorry if all this is obvious to many.&nbsp; I&#39;ve not encountered the Arduino&#39;s RAM limitation before and it certainly does cause some headaches when things start going all wrong for no obvious reason.</p>
<p>	It turns out that &#39;tallymode&#39; has always had a rounding error of half a tally-step.&nbsp; This has now been fixed in Mk2i_rev4, as attached, but it is still present in other versions.&nbsp; This error affects +ve and -ve values equally so does not explain the 2W difference that I&#39;ve noted when measuring a 60W bulb with the CT in different directions.&nbsp;</p>
<p>PS. As posted, the anti-flicker settings in Mk2i_rev4 (as below) are intended for the test bench rather than for real.&nbsp; The offset value below needs to be around 0.4 so that 80% of the bucket&#39;s capacity can be used.</p>
<p><em><strong>// these settings are only used if anti-flicker mode is enabled<br />
	float minTimeBetweenActivationsinAFmode = 3;&nbsp;&nbsp; // &lt;-- anti-flicker requirement (seconds)<br />
	float offsetOfEnergyThresholdsInAFmode = 0.1; // &lt;-- must not exceeed 0.5</strong></em><br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9905"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 16/02/2013 - 15:55.</div>
    <div class="content">
     <p>I&#39;ve just posted a video <span class="watch-page-link"> at: <a href="http://youtu.be/h_DrZHlstXk" target="_blank">http://youtu.be/h_DrZHlstXk </a></span>of the latest Mk2i build in action.&nbsp; This uses a 3-phase meter to record the three flows of energy that are present: base-load and dump load in one direction, and simulated PV in the other.&nbsp; The setup is more or less like this:</p>
<p>&nbsp;</p>
<p><a href="http://openenergymonitor.org/emon/sites/default/files/Schematic4Video.jpg"><img alt="" height="400" src="http://openenergymonitor.org/emon/sites/default/files/Schematic4Video.jpg" width="600" /></a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10477"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 15/03/2013 - 12:28.</div>
    <div class="content">
     <p>When adding an RFM12B module to my Arduino Uno, several pins that I&#39;ve previously used for LEDs are no longer available.&nbsp; Here is my proposed rearrangement.&nbsp; All input welcome.</p>
<p>For Mk2i_rev4, with no RF:</p>
<p>0&nbsp; - Serial Rx<br />
	1&nbsp; - Serial Tx<br />
	2&nbsp; - LED detector i/p (for polling)<br />
	3&nbsp; - (spare)<br />
	4&nbsp; - output mode selector i/p (normal / anti-flicker)<br />
	5&nbsp; - (spare)<br />
	6&nbsp; - (spare)<br />
	7&nbsp; - (spare)<br />
	8&nbsp; - (spare)<br />
	9&nbsp; - trigger o/p<br />
	10 - led repeater o/p - not essential<br />
	11 - underflow LED o/p<br />
	12 - overflow LED o/p<br />
	13 - surplus PV LED o/p<br />
	&nbsp;</p>
<p>For Mk2i_rev5, with RF module for remote load:</p>
<p>0&nbsp; - Serial Rx<br />
	1&nbsp; - Serial Tx<br />
	2&nbsp; - RFM12B module (IRQ)<br />
	3&nbsp; - LED detector i/p (for polling or interrupts)<br />
	4&nbsp; - output mode selector i/p (normal v. anti-flicker)<br />
	5&nbsp; - priority mode selector i/p (local v. remote)<br />
	6&nbsp; - underflow LED o/p<br />
	7&nbsp; - overflow LED o/p<br />
	8&nbsp; - surplus PV LED o/p<br />
	9&nbsp; - trigger o/p for local load<br />
	10 - RFM12B module (SEL)<br />
	11 - RFM12B module (SDI)<br />
	12 - RFM12B module (SDO)<br />
	13 - RFM12B module (CLK)</p>
<p>Never imagined I could use all of those pins!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10486"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1775" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1775.jpg" alt="Brian D&#039;s picture" title="Brian D&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1775" title="View user profile.">Brian D</a> on Fri, 15/03/2013 - 15:32.</div>
    <div class="content">
     <p>There are two LED&#39;s that I consider essential. Which two doesn&#39;t matter but the function I use is this:</p>
<p>// **************************************************************************************<br />
	// The REDLED1 indicates when the energy bucket level is rising</p>
<p>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((availableEnergy - previousAvailableEnergy)&gt;stepsize) // Check if level is rising<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(REDLED1,ON);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(REDLED1,OFF);</p>
<p>	// REDLED2 indicates when the energy bucket level is falling</p>
<p>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ((previousAvailableEnergy - availableEnergy)&gt;stepsize) // Check if level is falling<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(REDLED2,ON);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(REDLED2,OFF);<br />
	&nbsp;<br />
	// *************************************************************************************&nbsp;&nbsp;&nbsp;</p>
<p>These make a very useful tool for testing as well as providing operational information at a glance.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10488"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 15/03/2013 - 15:44.</div>
    <div class="content">
     <p>My surplusPV_LED does much the same as this, but without the &#39;stepsize&#39; criterion.&nbsp; It just goes &#39;on&#39; when the energy level is rising, and &#39;off&#39; when it&#39;s falling, so tends to flicker when conditions are marginal.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10492"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 15/03/2013 - 18:39.</div>
    <div class="content">
     <p>There&#39;s a video of my RF link in action <span class="watch-page-link">at: <a href="http://youtu.be/a1fngTaD4Iw" target="_blank">http://youtu.be/a1fngTaD4Iw</a></span>.&nbsp; The sketch that&#39;s supporting it is still in development, but if all goes to plan, Mk2i_rev5 will have:</p>
<p>- a new A/F algorithm which needs no calibration;</p>
<p>- selectable priority for the remote load;</p>
<p>- any number of dump loads;</p>
<p>- an associated sketch for the receiving end.</p>
<p>A long-standing bug at startup has also been fixed.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10523"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 18/03/2013 - 16:50.</div>
    <div class="content">
     <p></p>
<p>Here is rev_5 of my Mk2i PV Router.&nbsp; There&#39;s a demo of it in action <span class="watch-page-link">at: <a href="http://youtu.be/BHOTkBZLdig" target="_blank">http://youtu.be/BHOTkBZLdig </a></span></p>
<p>The base-station hardware is a standard Arduino Uno with an RFM12B module attached as shown on the <a href="http://openenergymonitor.org/emon/buildingblocks/rfm12b-wireless">Building Blocks page</a>.&nbsp; In my garage rig, the input circuits are still on a breadboard but my indoor test rig setup is a bit tidier.&nbsp; The remote end hardware is a sub-equipped emonTx with wires soldered to the four DIO ports for the LEDs.&nbsp; Photos of each platform are attached.</p>
<p>Power is diverted using a new type of algorithm which has only one energy threshold.&nbsp; It&#39;s similar in concept to the original on/off scheme but with the additional criterion that the triac may not switch within a specified period after the level has crossed the mid-point.&nbsp; As posted, that period is 0.5 seconds.&nbsp; This means that the logic is always homing in on the mid-point of the energy bucket rather than wandering away towards one end and then the other.&nbsp; With a 3kW system, the energy state should always remain within the central 80% of the energy bucket, so there&#39;s effectively a 10% safety margin at either end.</p>
<p>This alternative scheme &#39;flicks&#39; a little faster than the equivalent twin-threshold arrangement, but works really well when multiple loads are involved.&nbsp; That&#39;s because there&#39;s more time for the logic to advance to the next lower priority load - decisions don&#39;t have to taken right at the edge of the meter&#39;s sweet zone when time is so critical.</p>
<p>Decisions about which loads should be on/off are taken on a logical basis with loads running from 0 to N-1.&nbsp; A mapping is then performed between the physical and logical loads loads.&nbsp; This stage takes into account the state of a front-panel switch, which allows the priorities of the local and remote loads can be reversed at run-time.&nbsp; Any number of loads can be supported - if you can find the pins to run them from!</p>
<p>As posted, the rev_5 sketch will not run unless the RF module is present.&nbsp; In the absence of this module, the flag <strong>RF_moduleIsAvailable</strong> must be set to <strong>false</strong>.&nbsp;&nbsp; Similarly, the switches for output mode and priority selection will only work if <strong>runTimeSelectionIsEnabled</strong> to set to <strong>true</strong>.&nbsp;</p>
<p>The receiver&#39;s logic is very straightforward.&nbsp; If transmission is lost, the triac defaults to &#39;off&#39;.&nbsp; The receiver has a pair of LEDs to show whether transmission is OK or not, and there&#39;s a third LED to show the state of the remote load.&nbsp;</p>
<p>As posted, the &quot;transmission lost&quot; period is set to 3.0 seconds, which is probably not a good choice with the refresh rate from the transmit side being once per second.&nbsp; Something-and-a-bit seconds would be a better arrangement, then the receiver would abort after failing to detect a specified number of transmissions.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10609"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Sun, 24/03/2013 - 15:58.</div>
    <div class="content">
     <p><em>Any number of loads can be supported - if you can find the pins to run them from!</em></p>
<p>I&#39;ve just put it on a Mega 2560- just need to find a few more loads now!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10660"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1704" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Keith Walker&#039;s picture" title="Keith Walker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1704" title="View user profile.">Keith Walker</a> on Tue, 26/03/2013 - 23:08.</div>
    <div class="content">
     <p>Hi Robin,</p>
<p>I&#39;ve taken the plunge and loaded your new MK2i sketch but I can&#39;t get it to run. I&#39;ve tried loading the MK2a again but that wont run either.</p>
<p>I&#39;ve spent some time looking at your tools and the basic Arduino sketches. I know what the problem is and just wondered if you&#39;ve seen it before.</p>
<p>If I use :-<br />
	int sampleI = analogRead(A5);<br />
	I can see the waveforms correctly.</p>
<p>But not when I use :-<br />
	byte voltageSensorPin = 2;<br />
	byte currentSensorPin = 1;<br />
	sampleI = analogRead(currentSensorPin);&nbsp;&nbsp;<br />
	sampleV = analogRead(voltageSensorPin);<br />
	&nbsp;</p>
<p>So it seems that my compiler wants the serial ports&nbsp;referenced by&nbsp;&quot;A4 and&nbsp; A5&quot; and not &quot;1 and 2&quot;.</p>
<p>&nbsp;</p>
<p>Have you seen this before? Is there a setting I need to make within the Arduino compiler?</p>
<p>Thanks in advance, Keith</p>
<p>PS You&#39;re right, I&#39;m enjoying playing with the sketches :-)</p>
<p>PPS More details of my problem can be found at <a href="http://www.talkingsolar.co.uk/index.php/forum/10-other-threads/1001-if-it-ain-t-broke-don-t-fix-it?limit=6&amp;start=6#1022">http://www.talkingsolar.co.uk/index.php/forum/10-other-threads/1001-if-it-ain-t-broke-don-t-fix-it?limit=6&amp;start=6#1022</a>&nbsp;but it only shows more details</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10662"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 27/03/2013 - 00:29.</div>
    <div class="content">
     <p>(Robin is away on a course this week.)</p>
<p>The link between the numeric pin designations (0 - 5) and the alpha-numeric pin designations (A0 - A5) and their conversion to constants that eventually find their way to switching (I presume) the multiplexer input register is done in the header file pins_arduino.h (different versions according to your processor variant).</p>
<p>There&#39;s a macro at line 32 (&#39;standard&#39; version) that I guess has gone awry somehow - or maybe not! The macro does:</p>
<p class="rteindent1">#define analogInputToDigitalPin(p)&nbsp; ((p &lt; 6) ? (p) + 14 : -1)</p>
<p>and a bit further down there is (inter alia):</p>
<p class="rteindent1">static const uint8_t A1 = 15;<br />
	static const uint8_t A2 = 16;</p>
<p>so both end up as the same thing. I&#39;m using Arduino V1.0.3 and it compiles quite happily for me with either</p>
<p class="rteindent1">const byte voltageSensorPin = 2;&nbsp; // analogue<br />
	const byte currentSensorPin = 1;&nbsp;&nbsp; // analogue</p>
<p>or</p>
<p class="rteindent1">const byte voltageSensorPin = A2;&nbsp; // analogue<br />
	const byte currentSensorPin = A1;&nbsp;&nbsp; // analogue</p>
<p>Out of interest, why did you choose to use A4 &amp; A5 rather than A1 &amp; A2? If you change the input pins that the sensors are wired to, the sketch has got to be wrong!</p>
<p>I suggest you change your code as you have done to suit your layout and leave it at that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10675"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1704" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Keith Walker&#039;s picture" title="Keith Walker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1704" title="View user profile.">Keith Walker</a> on Wed, 27/03/2013 - 10:11.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Thanks for your quick reply.</p>
<p>I bought a pre-built and preloaded setup from Trader9. I just used the pins he provided in the instructions that came with the parts.</p>
<p>So maybe all I need to do is change the input pins I use.</p>
<p>The Mk2i version of the sketch read the input in a different way.</p>
<p>ADMUX = 0x40 + currentSensorPin;<br />
	ADCSRA |= (1&lt;&lt;ADSC);</p>
<p>So I&#39;m not sure I can change the the &quot;currentSensorPin&quot; to &quot;A1&quot;.</p>
<p>I&#39;ll try changing the pins round tonight and see what happens. I&#39;ve got a feeling that it will burst into life. Trader9 must have had a good reason to change the pins he used.</p>
<p>Thanks for your help, Keith</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10680"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 27/03/2013 - 13:14.</div>
    <div class="content">
     <p>Robin&#39;s sketches obviously will only work with his circuit diagram, you can&#39;t expect otherwise.</p>
<p class="rteindent1"><em>The Mk2i version of the sketch read the input in a different way.</em></p>
<p class="rteindent1"><em>ADMUX = 0x40 + currentSensorPin;<br />
	ADCSRA |= (1&lt;&lt;ADSC);</em></p>
<p>At the top of the sketch, line 261 or thereabouts, it looks remarkably similar to me:</p>
<p>// analogue input pins:<br />
	const byte voltageSensorPin = 2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // analogue<br />
	const byte currentSensorPin = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // analogue</p>
<p>and that is where you change the input pin designations. The interrupt version is bypassing the time-consuming library routines and allowing the ADC to run freely in the background. You shouldn&#39;t need to touch the core interrupt code part that you quoted.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10688"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1704" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Keith Walker&#039;s picture" title="Keith Walker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1704" title="View user profile.">Keith Walker</a> on Thu, 28/03/2013 - 09:51.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>I&#39;m now using the standard input pins and it&#39;s burst into life.</p>
<p>Thanks for you advice, Keith</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10731"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 30/03/2013 - 13:46.</div>
    <div class="content">
     <p><em>I bought a pre-built and preloaded setup from Trader9. I just used the pins he provided in the instructions that came with the parts.</em></p>
<p>Sorry, I can&#39;t really comment on how anyone else may have re-packaged or modified my design elsewhere.&nbsp; By following the guidance given here on this forum, everything about my Mk2 design should work as intended.&nbsp; If it doesn&#39;t, please let me know.</p>
<p>As I recently posted on another OEM forum thread, &quot;Robin&#39;s code&quot; should work fine on any Atmega-based hardware platform that can measure V and I.&nbsp; The two obvious contenders are:</p>
<p>a)&nbsp; an Arduino Uno, with peripheral components as originally posted (for which Rich&#39;s PCB&#39;s are ideal)</p>
<p>b)&nbsp; a standard emonTx with its associated AC/AC adaptor, plus output circuitry on strip-board or equivalent.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10845"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 02/04/2013 - 18:55.</div>
    <div class="content">
     <p>A friend is keen to have a PV diverter system like mine so I took round my demo box, plugged it in, and it worked straight away.&nbsp; <a href="http://www.youtube.com/edit?video_id=Hqx97Wyt_aY&amp;ns=1">Here it is</a> boiling up a 3kW kettle using only his free surplus power.</p>
<p>The system worked fine in &#39;normal&#39; mode, but occasional pulses were seen at the meter when in A/F mode.&nbsp; This was the first time that I&#39;ve come across a meter which has a sweet zone of less than 1Wh.&nbsp; The meter is an ACE 1000 with green and red LEDs.&nbsp; When I reduced the value of the relevant timing parameter, <strong>postMidPointCrossingDelayForAF_cycles</strong>, from 25 to 10, it then worked fine in AF mode too albeit switching rather more quickly than one might like.&nbsp;</p>
<p>The A/F algorithm in Mk2i Rev5 is different than in all previous builds.&nbsp; It needs no calibration but doesn&#39;t give as much flicker suppression as the conventional twin-threshold one.&nbsp; For a meter that has such a small window where a reciprocating power diverter can operate without penalty, it may be best for the standard A/F algorithm to be used.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10998"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="ljfaragher&#039;s picture" title="ljfaragher&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by ljfaragher (not verified) on Mon, 08/04/2013 - 12:40.</div>
    <div class="content">
     <p>Finally got time to adapt your MK2i_rev5 sketch to my hardware.&nbsp;&nbsp; I take your point about lack of pins.&nbsp; I have an Atmega128 waiting in the wings for my central control and monitoring node.&nbsp;&nbsp; I plan to use ANTI_FLICKER mode so am not using that pin at runtime either.<br />
	I hit a brick wall with my RF24 (2.4ghz) radios so&nbsp; put it on back burner and &nbsp;switched development to another project (Measuring and displaying on LCD the solar&nbsp;charging&nbsp;&nbsp;and discharge of my 900Ah SLA battery bank.)&nbsp;&nbsp;&nbsp; I&#39;m delighted you have tackled local/remote priority at runtime as this was on my list as well as&nbsp; RF12 radio comms.&nbsp; The RF12 jeelib library is excellent work.&nbsp;&nbsp;&nbsp; I chose 433Mhz for several reasons but I have a dual band (144Mhz and 430 mhz) handheld transceiver so I can both monitor and legally generate interference as I am licensed to use this freq as a radio amateur.<br />
	I appreciate all the LED&#39;s at development time but I limited it to two LED outputs.&nbsp; This is combined in a multicolored LED.&nbsp; It flashes green on/off at 1 second intervals this being derived from the line<br />
	if ((cycleCount % 50) == 5)<br />
	This serves two purposes<br />
	1) it confirms the 50hz mains reference is connected and working<br />
	2) and that the unit is running at a glance. (ie not crashed).<br />
	The Red LED is derived from the inverse of surplusPV_LED showing when firing&nbsp;a tria.&nbsp; I&#39;m guessing that this will&nbsp;work&nbsp;for local or remote loads?<br />
	With your&nbsp; preoccupation for not importing when unnecessary, my&nbsp; prototype fires for 3 seconds at startup before settling.&nbsp;&nbsp; Is this intentional.&nbsp; I could investigate but thought I would as Robin first.<br />
	Development of my PCB&nbsp;has been scrapped&nbsp;as the JeeNode is an alternative.&nbsp; I wasn&#39;t aware of it at the time and I was designing something quite similar but&nbsp;there is no point&nbsp; when Jeelab has done such a good job with plenty of modules and the associated library.<br />
	MK2i_rev5 working and powering an oil filled electric radiator keeping me toasty in my lounge.&nbsp; Gas powered central heating not fired up for many hours when sun is shining.</p>
<p>Laurence</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11019"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 08/04/2013 - 15:59.</div>
    <div class="content">
     <p>I like the idea of the oil-filled radiator, Laurence.&nbsp; We could do with one of those for when the DHW stat has tripped.</p>
<p>The startup problem that you mentioned has been fixed in Mk2i_PV_Router_rev5, and also in Mk2_PV_Router_mini_2.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11093"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 10/04/2013 - 18:35.</div>
    <div class="content">
     <p>My first &quot;proper&quot; build was not at my own house (where my original breadboard continues to give good service - 7kWh today) but at a friend&#39;s house.&nbsp; Pics attached.</p>
<p>The hardware is an emonTx, and the sketch is based on Mk2i_rev5.&nbsp; The only change I&#39;ve made is to replace the underflow and overflow LEDs by a pair which show when the local and remote loads are on.&nbsp; No remote load is actually present, but the capability to drive it is clearly working.&nbsp; The integral RF unit has been tested and found to be OK but is currently disabled.&nbsp; If a display unit or RF-controlled secondary dump-load were ever to be required, it would just be a case of adding an aerial.</p>
<p>I&#39;ve added an over-ride switch which forces the local load to come on via the triac.&nbsp; This works using an OR function at the trigger&#39;s input.&nbsp; By driving the opto-isolator from the 5V rail, there is plenty of headroom in which to squeeze a couple of diodes.&nbsp; This prevents the Atmega&#39;s output pin from being held in the low state when the over-ride switch is operated.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11199"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Sat, 13/04/2013 - 12:56.</div>
    <div class="content">
     <p>Hi All</p>
<p>Im&nbsp;on on my mission to deliver as much free energy as i can and so far been trying with Rev2&nbsp;but to no avail, although many on this forum have helped</p>
<p>basic setup using Rich&#39;s PCB and a leonardo board</p>
<p>ive moved on to the Rev 4 after some recommendations to check out what is happening with &quot;tallymode&quot;</p>
<p>So far i have compiled, and uploaded the sketch, however i see nothing when i open the serial monitor - i suspect because of this taken from ardunios&nbsp;site</p>
<p><strong>No reset when you open the serial port.<br />
	Unlike the Arduino Uno, the Leonardo and Micro won&#39;t restart your sketch when you open a serial port on the computer. That means you won&#39;t see serial data that&#39;s already been sent to the computer by the board, including, for example, most data sent in the setup() function.<br />
	This change means that if you&#39;re using any Serial print(), println() or write() statments in your setup, they won&#39;t show up when you open the serial monitor. To work around this, you can check to see if the serial port is open like so:</strong></p>
<p>
	<strong>// while the serial stream is not open, do nothing:<br />
	&nbsp;&nbsp; while (!Serial) ;</strong></p>
<p>I am now thinking i should have just plumped for the UNO but i anyone cal tell me how to get the monitoring working for tallymode using Rev4 i would be most grateful</p>
<p>thanking you all in advance</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11201"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 13/04/2013 - 13:16.</div>
    <div class="content">
     <p>I know nothing about the Leonardo, but if that&#39;s what they say, do it!</p>
<p>If you use the line you quote, the program will lock up there and loop indefinitely until serial comms is established, which probably isn&#39;t what you want. So you&#39;ll probably find it more convenient to invert the logic:</p>
<p>if (Serial) {<br />
	&nbsp;&nbsp; Serial.print( .............);<br />
	&nbsp;&nbsp; ....... any other serial statements etc<br />
	}</p>
<p>Therefore, I think you need to work through the sketch and wrap all the serial output statements like that - except of course setting up the serial comms to begin with still needs to be done: Serial.begin(9600);</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11203"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Sat, 13/04/2013 - 13:43.</div>
    <div class="content">
     <p>Hi Robert</p>
<p>Thank you for the speedy reply, i did &quot;have a go&quot; but expertise is definitely not code !</p>
<p>Can you tell me if the following adaptation looks right</p>
<p>Original Code:</p>
<p><strong>Serial.begin(9600);<br />
	&nbsp; Serial.println();<br />
	&nbsp; Serial.println();<br />
	&nbsp; Serial.println();<br />
	&nbsp; Serial.println(&quot;-------------------------------------&quot;);<br />
	&nbsp; Serial.println(&quot;Sketch ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mk2i_PV_Router_rev4.ino&quot;);</strong></p>
<p>Amended code</p>
<p><strong>Serial.begin(9600);<br />
	if (Serial) {<br />
	&nbsp; Serial.println();<br />
	&nbsp; Serial.println();<br />
	&nbsp; Serial.println();<br />
	&nbsp; Serial.println(&quot;-------------------------------------&quot;);<br />
	&nbsp; Serial.println(&quot;Sketch ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mk2i_PV_Router_rev4.ino&quot;);<br />
	}</strong></p>
<p>many thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11217"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 13/04/2013 - 16:52.</div>
    <div class="content">
     <p>I will be most interested to see how this one develops.&nbsp;</p>
<p>When I was installing an emonTx-based Mk2 Router recently, I had great difficulty in communicating with the board via the Serial interface.&nbsp; I put it down to the <a href="http://shop.openenergymonitor.com/programmers/">&#39;Programmer&#39; board</a> which plugs onto the 6-pin header strip on the emonTx.&nbsp; My laptop runs Windows XP.</p>
<p>Adding a 7 second wait at the very start of setup() seemed to help.&nbsp; I then didn&#39;t miss the all important display info which appears during setup().&nbsp; With a standard Uno, opening the Serial Monitor undoubtedly causes the sketch to restart which is very helpful.&nbsp; With the emonTx plus programming adapter, I had to reload the program every time.&nbsp; (I suppose I could have just unplugged the USB to interrupt its power supply.)</p>
<p>GTEC, With your modified code, the relevant display lines will simply be omitted if Serial is not yet up and working.&nbsp; As this display only happens in one place, rather than in a loop, I don&#39;t think you can avoid waiting until Serial becomes available.&nbsp; The</p>
<p><strong>// while the serial stream is not open, do nothing:<br />
	&nbsp;&nbsp; while (!Serial) ;</strong></p>
<p>construct looks to be a neater way of what I&#39;ve been doing to get by.</p>
<p>Rather than experiment with Mk2i_rev4 in Tallymode mode, why not try a lighter weight sketch such as RawSamplesTool?&nbsp; It has a similar user-interface in that the program pauses at the end of each run until a user input is received.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11223"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 13/04/2013 - 17:14.</div>
    <div class="content">
     <p>What rae says is right - I hadn&#39;t looked at his sketch to check the details. So you do indeed need to sit in that while( ) until the serial is available.</p>
<p>But when you get down to code and print statements in loop( ), then you amended code looks right.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11246"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="ljfaragher&#039;s picture" title="ljfaragher&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by ljfaragher (not verified) on Sun, 14/04/2013 - 01:18.</div>
    <div class="content">
     <p>&gt;The startup problem that you mentioned has been fixed in Mk2i_PV_Router_rev5,<br />
	I am using rev5 but still have a startup load firing for about 3 seconds.&nbsp; I&#39;ve just loaded this sketch as posted and only changed the pin to fire my triac in the code to<br />
	const byte physicalLoad_0_pin = 3;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // for trigger (active low)<br />
	I&nbsp;still get the startup firing.&nbsp;&nbsp;The startup firing only started in MK2i_rev5.&nbsp;&nbsp; previous version was MK2a_rev3.<br />
	I am not using a UNO but a breadboard with an Atmega328p and the rest of the hardware.</p>
<p>As regards GTEC&#39;s serial monitor: Do you get serial data if you press the reset button on the leonardo?<br />
	Briefly looking at the design of the leonardo, they reduced cost by&nbsp;having&nbsp;a single processor&nbsp;run your sketch AND perform serial comms.&nbsp;&nbsp; Looks like you only get a reset when you press&nbsp;the reset button or upload a sketch..&nbsp; I imagine your PC loses serial port when you do this in which case a delay at startup of sketch giving you enough time in the Arduino IDE to select the serial port and then open the serial monitor may be one way to work around the leonardo hardware limitation.&nbsp; Like the following .&nbsp; Substitute 20&nbsp; (seconds) for the time you need.</p>
<p>void setup(void)<br />
	{<br />
	delay (20 * 1000);<br />
	Serial.begin(9600);<br />
	Serial.print(&quot;Did you catch this?&quot;);</p>
<p>Personally I haven&#39;t been &quot;obsessed&quot; with squeezing every last watt out of the system.&nbsp; I&#39;ve run most versions of Robins code and done very little calibration.&nbsp; I looked at Phasecal and calibrated once for my system.&nbsp; I then configured&nbsp;a Watts_Margin in an earlier version to make sure I was not importing.&nbsp; I got to witinn&nbsp;17 watts.&nbsp; Close enough for a 4KW PV instalation.&nbsp;&nbsp;&nbsp; I run a 20M twisted pair from the CT clamp at the moment.&nbsp;&nbsp;&nbsp;&nbsp; I went contrary to many forum contributors thoughts by deriving the voltage reference from a separate winding in the same transformer as deriving the supply for the Atmega and hardware.&nbsp;<br />
	I have plans to get a &quot;sound card oscilloscope&quot; working on my PC to look at the waveforms and phase shift of, and between the CT and AC Voltage sensor.&nbsp;&nbsp; Just one of many projects in the pipeline.</p>
<p>Laurence</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11249"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 14/04/2013 - 07:22.</div>
    <div class="content">
     <p>OK Laurence, I need to look again at what&#39;s happening at startup.&nbsp; It may be that I&#39;ve left something out.&nbsp; Mk2i_Rev5 is more complex than earlier builds on account of it being able to support multiple loads.</p>
<p>I&#39;m pretty sure that the triac no longer comes on at the start of Mk2_PV_Router_mini_2 (which is where I devised the fix) whereas it did for the initial version.&nbsp; Maybe you could check this for me and PM the results. Thanks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11254"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 14/04/2013 - 10:02.</div>
    <div class="content">
     <p>&nbsp;Er - yes, there was a bug with the <strong>Mk2_PV_Router_mini_2</strong> sketch.&nbsp; My improved logic at startup was nearly right, I&#39;d just omitted to force the triac to &quot;off&quot; within setup().&nbsp; Being active low, it was &#39;on&#39; by default during the 2-second start-up period.&nbsp; A similar bug may be present in the latest Mk2i sketch, I&#39;ll check that next.</p>
<p><strong>Mk2_PV_Router_mini_3</strong>, as attached, will hopefully work as intended.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11257"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 14/04/2013 - 10:45.</div>
    <div class="content">
     <p>And - er - yes, there was a similar bug in my Mk2i_rev5 sketch which was having an identical effect.&nbsp; Within my revised startup sequence, although I had set all of the logical and physical loads to &quot;OFF&quot;, I hadn&#39;t actually written that information to the relevant output pin.&nbsp;&nbsp; So, just as with my mini_2 sketch, the output pin for the load was defaulting to &#39;0&#39; which was bringing the active-low trigger into the &#39;on&#39; state.</p>
<p>Duly fixed as <strong>Mk2i_PV_Router_rev5a</strong>, as attached,</p>
<p>Thanks for bringing this to my attention Laurence, hopefully that&#39;s all the gremlins dealt with for now</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11260"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Sun, 14/04/2013 - 11:08.</div>
    <div class="content">
     <p>Hi All</p>
<p>as my forte isn&#39;t code i am going back to basics and collecting an &quot;UNO&quot; tomorrow - that will eliminate some of the confusion that i have caused myself (i hope!)</p>
<p>FYI - I have previously run &quot;RAw Data&quot; and obtained results OK so i have to assume that it is something to do with the way in which&nbsp;the serial statements are used in the&nbsp;Rev4</p>
<p>When i start up serial monitor with the current setup (and using Win 7 Pro) i get no output at all, i can enter &quot;g&quot; and {cr} and i get the 3 different messages - &quot;max Wats&quot;, &quot;min watts&quot; and &quot;wait for X seconds&quot;</p>
<p>Sadly at that stage it inevitably then freezes my laptoop completely - Ctrl-Alt-Del wont work so i have to do a hard shutdown, hence i cant post a screenshot i am afraid!</p>
<p>Laurence - i have done the same as you and used the &quot;other side&quot; of the ac-ac transformer to feed a full wave rectifier to then feed the board</p>
<p>All, i am exceptionally interested in the Rev 5 to control multiple loads as i have a complex heating system that could&nbsp;really&nbsp;benefit from this but im going to concentrate on getting Rev4 up and running first!</p>
<p>As a comment generally for all of these systems you will only get the maximum benefit if you heat the whole cylinder, most immersions (depending on length and cylinder position) will only heat the top third&nbsp;</p>
<p>without having to add additional immersions, or adapt control strategies to heat multiple&nbsp;immersions, the easiest way to achieve this is to fit a &quot;destratification&quot; circulator (pump) to circulate the water from top to bottom</p>
<p>this is reasonably straightfroward and ill post some diagrams as soon as i can, but this would rely on a &quot;constant on&quot; output from one of teh pins to switch on a small relay to allow the pump to function ONLY when the immersion was being fed by the surplus energy</p>
<p>I have to assume (but i don&#39;t know) that this adaptation is a fairly simple addition to the sketch?</p>
<p>cheers</p>
<p>Griff</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11262"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 14/04/2013 - 12:01.</div>
    <div class="content">
     <p><em>I have to assume (but i don&#39;t know) that this adaptation is a fairly simple addition to the sketch?</em></p>
<p>Yes, that logic is already present because the overflow LED comes on whenever the bucket reaches its upper limit.&nbsp; You could just use this pin (active high) to control your relay.&nbsp; When the stat closes and the immersion comes back on, the bucket would cease overflowing and the pump would go off.</p>
<p>If the amount of surplus power was insufficient to drive the pump continuously, then the pump would &#39;flicker&#39; on and off just as the dump-load does.&nbsp; Some additional logic to prevent this may be a good idea.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11263"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 14/04/2013 - 12:24.</div>
    <div class="content">
     <p><em>Laurence - i have done the same as you and used the &quot;other side&quot; of the ac-ac transformer to feed a full wave rectifier to then feed the board.</em></p>
<p>The complaint about doing this is based on the fact that a full wave rectifier followed up by a large smoothing capacitor draws a large current for a few milliseconds at each peak of the mains wave, which (allegedly) causes intolerable distortion and errors in your power measurement.</p>
<p>Three comments from me: the amount of distortion depends on the transformer impedance, so it may be insignificant anyway; it&#39;s the same for import or export, so in the Mk2 (any variant) the effect should be minimal; and finally if you have the voltage to spare, adding a series resistor to limit the inrush current to the smoothing capacitor will trade current for time and will reduce the amount of dip seen by the voltage monitor winding. (It extends the time the peak current flows because it starts lower down the peak of the wave, and may actually stop on the falling edge rather than exactly on the crest. The product of current and time, charge, has to be constant of course.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11264"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 14/04/2013 - 15:51.</div>
    <div class="content">
     <p>When running an emonTx, the statement if (!Serial) never appears to return true.&nbsp; So it seems that this trick won&#39;t help with the problem that I&#39;ve been seeing, although it may with the Leonado.</p>
<p>Attached is an improved version of my MinAndMaxValues sketch which resets its data after a short run.&nbsp; It now takes a break after every fifth sets of results so that the accumulated data can be more easily copied from the Serial window.&nbsp; There is also a 7 second delay at the start of setup().</p>
<p>I&#39;ve found at least 3 ways of getting this sketch to run on an emonTx so that all of the data is captured:</p>
<p>1.&nbsp; Open the Serial window <em>immediately</em> that uploading is complete.&nbsp; To restart the process you need to re-load the sketch :(</p>
<p>2. Disconnect the USB power, close the Serial window, re-instate the power, and then immediately open the Serial window again.&nbsp; This saves re-loading the sketch, but does seem a bit hard on the USB connections :(</p>
<p>3.&nbsp; Pull pin 1 of the Atmega chip low, this being its reset line :)</p>
<p>This latter approach would presumably work on any hardware platform.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11275"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Sun, 14/04/2013 - 20:55.</div>
    <div class="content">
     <p>Whilst waiting to collect my Uno i got bored</p>
<p>so please see attached for a &quot;Iphone&quot; PSU now awaiting a capacitor for repair then it will fit nicely into my enclosure and should eliminate any of the distortion that is being spoken about</p>
<p>Robin, the logic you speak about would need to</p>
<p>1. Set a threshold limit of say 35W (pump dependant)</p>
<p>2. Only after that threshold was exceeded would it then pin out a constant &quot;on&quot; for one of the&nbsp;analogue pins</p>
<p>3. Only then &nbsp;it would activate pin 9 proportional to the gross Wattage available less 35W (pump dependant)&nbsp;</p>
<p>theres lots more that it could do to lessen the &quot;parasitic&quot; losses of the pump but you&#39;d need feedback from the cylinder to achieve that sensibly</p>
<p>roll on tomorrow when i collect &nbsp;my UNO !</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11282"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 15/04/2013 - 06:12.</div>
    <div class="content">
     <p><em>GTEC: Robin, the logic you speak about would need to</em></p>
<p><em>1. Set a threshold limit of say 35W (pump dependant)</em></p>
<p><em>2. Only after that threshold was exceeded would it then pin out a constant &quot;on&quot; for one of the&nbsp;analogue pins</em></p>
<p><em>3. Only then &nbsp;it would activate pin 9 proportional to the gross Wattage available less 35W (pump dependant)&nbsp;</em></p>
<p>Once the bucket hits its overflow point, that usually means that the stat has opened, in which case your de-stratfication pump would need to come on.&nbsp; It may take some minutes before the stat closes during which time surplus power could temporarily (or permanently, for the day) disappear.&nbsp; For a variety of reasons, surplus power is rarely constant.&nbsp; At this stage, what should you do?&nbsp;</p>
<p>You could leave the pump on for a minimum of, say a minute (as &quot;baseload&quot;), but this may not be beneficial if it&#39;s near the end of the period of useful power for the day.&nbsp; Or you could turn it off immediately in which case the pump would flicker.</p>
<p>Accounting for the pump&#39;s rated power consumption within the router&#39;s logic makes little sense to me.&nbsp; If the pump needs to be on, then it simply forms part of the baseload, and surplus power is reduced accordingly.&nbsp;</p>
<p>The sole role of my router has always been to divert surplus power.&nbsp; Getting the router to turn something on when there is insufficient surplus power for that appliance is a step not to be taken lightly.</p>
<p>As I say, the logic itself is straightforward enough.&nbsp; It&#39;s the underlying algorithm which is the tricky part.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11326"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Mon, 15/04/2013 - 22:19.</div>
    <div class="content">
     <p>Ok</p>
<p>Uno programmed and fitted</p>
<p>Success - well sort of</p>
<p>please see the report from tallymode&nbsp;attached, taken whilst i had a 1700W (approx) load connected</p>
<p>i suspect that something needs tweaking in the sketch here to obtain readings - am i right?</p>
<p><strong>0, &lt;- duration (secs)<br />
	0, &lt;- no of values tallied</strong></p>
<p>any ideas?</p>
<p>cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11329"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 16/04/2013 - 06:27.</div>
    <div class="content">
     <p>When the sketch is running correctly, the first question is the &#39;duration of run&#39; one, and you should of course get the chance to enter it.&nbsp; There is also a lengthy preamble to set the context.&nbsp; If this doesn&#39;t happen, something is wrong with your serial comms link.</p>
<p>Tallymode was introduced in the initial post for my <a href="http://openenergymonitor.org/emon/node/1681">Mk2a sketch</a> .&nbsp; At that stage, I also posted a spreadsheet showing how the values could be nicely displayed on a spreadsheet, but I didn&#39;t post the actual results file.&nbsp; The original results file is attached here.&nbsp; The format is slightly different then as I was separating out the energy content into individual half-cycles rather than whole cycles, but the general file structure is essentially the same.</p>
<p>After the sketch has run, albeit for 0 seconds, and then spewed out some results, if you enter &#39;g&#39;, it will hopefully allow you to enter the complete set of instructions.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11337"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 16/04/2013 - 10:38.</div>
    <div class="content">
     <p>We now have a storage heater in place as our secondary dump-load, and it seems to be working nicely.&nbsp; A video of the initial setup will soon be available <span class="watch-page-link">at: <a href="http://youtu.be/TTgZxkW1sB8" target="_blank">http://youtu.be/TTgZxkW1sB8</a></span> (ETA 12:30 pm)</p>
<p>To keep the power rating below 3 kW, I&#39;ve only fitted 3 of the 4 x 850W elements.&nbsp; The attached photo shows this, with 4 of the 16 thermal bricks still be refitted.&nbsp;</p>
<p>The RF side is working just as posted for <strong>Mk2i_rev5</strong>.&nbsp; The remote unit&#39;s sketch is <strong>RF_for_Mk2_rx.ino</strong>, as stated on my <a href="http://openenergymonitor.org/emon/node/1757">Summary Page</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11338"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3410" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3410.jpg" alt="DickieW&#039;s picture" title="DickieW&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3410" title="View user profile.">DickieW</a> on Tue, 16/04/2013 - 11:56.</div>
    <div class="content">
     <p>Hi Robin et all, haven&rsquo;t tried the Mk2i yet as happily flickering on the 1st revision of the Mk2 Sketch which by the way is working tremendous heating my 170 ltr Pressurised Direct hot water tank (Takes around 10 kw to heat it up fully). Yesterday received 15kwh from my 4kw SolarMax System so thanks to you, lovely free hot water. As a reminder to the community my install auto switch&#39;s from combi boiler to hot water storage when a given temperature is obtained from solar Emerson. Will try the anti flicker sketch&#39;s soon. Like the idea of the secondary dump going to storage heater had thoughts on the same line. Personally I would leave the 4 elements connected and take the chance that he mean current would be such that the fuse would not rupture. I have been switching 4kw for long periods and not had problems. That aside as mentioned when I first joined the community I was interested in a sketch that would accommodate say 3 or more Triacs fed direct from the pin outs of the Arduino. Each triac would sit in a pecking order whereby the bucket would switch all available surplus energy to the first Triac. If the bucket was to fill up with the first triac full on then the surplus would switch the second triac. If triacs 1 and 2 were to be full on any surplus at this point would switch the 3rd and so on. This way for example you could have a socket in the kitchen for boiling water/dumb coffee maker as highest priority with the second to an immersion and 3rd to a storage/oil heater may be. I realise this requires running separate T&amp;E to a dedicated socket but I&#39;m building at present so this is an easy one for me. In an effort to keep/use more or the solar energy I think this would be of great use to some of the forum members using their power to supplement the smaller indirect tank. Would really appreciate people&rsquo;s views on this and other ideas, and Robin if you get time to modify a sketch to match. No pressure just a really nice to have sketch I reckon. Finally I&#39;m also assuming this would make the sketch quite versatile as allowing single, dual or triple triac working, adding additional MOC/Triac hardware as required without having to modify the sketch when the hardware is added. BTW excellent video the Board is certainly not receiving feed in units today! Thx Dickie.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11340"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 16/04/2013 - 12:29.</div>
    <div class="content">
     <p>Hi Dickie, and thanks for the prompt feedback.&nbsp; You&#39;ll no doubt be pleased to learn that Mk2i_rev5 already supports multiple loads:&nbsp;</p>
<pre>
const byte noOfDumploads = 2; // The logic expects a minimum of 2 dumploads,
                              // for local &amp; remote loads, but neither has to
                              // be physically present.
</pre><p>In my demo, I&#39;m only using two loads (the &#39;local&#39; one to heat our DHW, and the &quot;remote&quot; one for the storage heater via an RF link), but there is no limit as to how many loads the system can cope with.&nbsp; The <strong>noOfDumploads</strong> variable is used to dimension various arrays which hold the necessary dumpload data.&nbsp; It you&#39;re not using the RF module, there should be several spare pins, each of which can drive its own dedicated trigger &amp; triac.</p>
<p>At this time of year, having multiple loads makes a lot of sense.&nbsp; Our gas-powered CH still comes on at either end of the day so there&#39;s not much thermal capacity in the tank into which to dump surplus power.&nbsp; A storage heater seemed the obvious way to go, and it started up straight away without any difficulty, as did my sketches.</p>
<p>Pity I can&#39;t build a decent power supply :(</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11349"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="terrwilk&#039;s picture" title="terrwilk&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by terrwilk (not verified) on Tue, 16/04/2013 - 17:19.</div>
    <div class="content">
     <p>Hello Robin,</p>
<p>I have built&nbsp; a diverter using the mk2i rev4</p>
<p>I works great in normal mode.</p>
<p>However, after watching your anti-flicker video, you showed that the pulse is longer than the flicker version, however, when I&nbsp; switch mine over to anti-flicker, the pulse is much longer, actually causing import before it switches off.</p>
<p>I have tried to calibrate the device, so I am guessing that is the problem.</p>
<p>Could you explain further who to calibrate the hardware.</p>
<p>Thanks</p>
<p>Terry</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11363"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Tue, 16/04/2013 - 21:37.</div>
    <div class="content">
     <p>Hi Robin et All</p>
<p>Well it seems that i have success, many thanks to everyone that has held my hand throughout the process -</p>
<p>And a word to the beginner, if the spec says a &quot;UNO&quot; then use a UNO (i got caught out by a leonardo)</p>
<p>Picture of the final build attached, not as pretty as my original but note the power supply (Robin :)) that is a repaired Iphone charger in the top left of the enclosure</p>
<p>Final calibration to run and then its lid on!</p>
<p>Next is to drill out the enclosure lid to mount the four LED&#39;s and then look at a &quot;destratification&quot; pump and a secondary load (although i have 500L of store!)</p>
<p>happy days and thank you all again</p>
<p>cheers</p>
<p>Griff</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11365"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2496" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="paulbernardr&#039;s picture" title="paulbernardr&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2496" title="View user profile.">paulbernardr</a> on Tue, 16/04/2013 - 23:47.</div>
    <div class="content">
     <p>Hi All</p>
<p>Firstly thank you all for all the work you guys have put in. My original design 2 years ago was a current switch and a relay so now I&#39;ve finally got a solution platform that works effectively.</p>
<p>My PV however is 2 KW and it has always seemed a bit inappropriate to me to be pulsing 3KW loads when my surplus power is rarely going to be more that 1KW. &nbsp;Plus without the Anti Flicker - I get plenty of it!</p>
<p>My tinking with the code has a halfwave&nbsp;solution working - albeit not perfectly. &nbsp;I am only pulsing 1.5KW and the Flicker is hardly noticeable at all. &nbsp;What I have done is to turn off the Triac after 10 samples have been taken at the end of the loop().</p>
<p>This works well most of the time but misses half cycles sometimes, which I think is because the fire request has gone out to the opto-isolator&nbsp;- but I am sending a Triac Off to it before it has actually come on.</p>
<p>If you guys don&#39;t consider my idea entirely crazy, (for us smaller PV installation people that is), can anyone think how else I should turn off the triac to ensure only a half cycle has occurred?</p>
<p>Paul&nbsp; &nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11367"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 17/04/2013 - 01:13.</div>
    <div class="content">
     <p>I&#39;m afraid you should not be using half cycles. Basically, it&#39;s illegal - not as such, but in doing so you generate even harmonics and the permitted limits for those are minuscule - you are allowed 1.08 A of second harmonic, 0.43 A of 4th and progressively smaller amounts of higher orders. And apart from that, it&#39;s antisocial because it puts a d.c. load on the supply transformers, and probably upsetting your inverter as well.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11372"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Wed, 17/04/2013 - 07:23.</div>
    <div class="content">
     <p>Hi</p>
<p>&nbsp;</p>
<p>Have you checked the configuration of the immersion heater, you may (and i emphasise&nbsp;<u>may</u>) be able to alter its configuration so the load is less, alternatively (if it is that critical) a different immersion could be used that does allow this</p>
<p>Perhaps adding in a small RF controlled relay to bring in, or more importantly out, the elements of the immersion as and when desired so you still retain its full functionality when required?</p>
<p>Hope that this helps</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11379"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 17/04/2013 - 09:03.</div>
    <div class="content">
     <p><em>paulbernardr: My PV however is 2 KW and it has always seemed a bit inappropriate to me to be pulsing 3KW loads when my surplus power is rarely going to be more that 1KW. &nbsp;Plus without the Anti Flicker - I get plenty of it!</em></p>
<p>Paul, if dumping surplus power in whole-cycles bursts does not appeal to you, the easiest solution is surely just to use phase-angle control.&nbsp; There&#39;s already a version of the Mk2 router which works in this way, the relevant entry in my <a href="http://openenergymonitor.org/emon/node/1757">Summary Page</a> being:</p>
<p><strong>Mk2_PV_phaseAngle</strong>.&nbsp; A phase-angle controlled variant.&nbsp; This requires a trigger which acts immediately rather than a zero-crossing one.&nbsp;&nbsp;&nbsp; Originally posted, with full supporting information, on 01/11/12 at <a href="841#comment-6990" title="http://openenergymonitor.org/emon/node/841#comment-6990">http://openenergymonitor.org/emon/node/841#comment-6990</a>, this code is available at<a href="../sites/default/files/Mk2_PV_phaseAngle.ino_.zip" title="http://openenergymonitor.org/emon/sites/default/files/Mk2_PV_phaseAngle.ino_.zip"> http://openenergymonitor.org/emon/sites/default/files/Mk2_PV_phaseAngle....</a></p>
<p>&nbsp;</p>
<p>You just need to fit a different trigger device (i.e.&nbsp; MOC3021 rather than MOC3041) and away you go.&nbsp; Some precautions to limit the amount of generated EMC might be a good idea.&nbsp;</p>
<p>With a more complex algorithm, you could no doubt arrange for surplus power to be distributed using half cycles whilst maintaining a overall DC balance.&nbsp; I did spend some time working on this, but it seemed to involve a lot of complexity for very little benefit.&nbsp; Operating a 3kW immersion in whole-cycles at the optimal AF rate for your meter is no different than repeatedly turning a standard kettle on &amp; off every second or two.&nbsp; Because each transition occurs at a zero-crossing point, there&#39;s minimal EMC and wear on the hardware.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11383"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 17/04/2013 - 10:47.</div>
    <div class="content">
     <p><em>terrywilk: ... after watching your anti-flicker video, you showed that the pulse is longer than the flicker version, however, when I&nbsp; switch mine over to anti-flicker, the pulse is much longer, actually causing import before it switches off. ... I have tried to calibrate the device, so I am guessing that is the problem. ... Could you explain further who to calibrate the hardware.</em></p>
<p>OK, Terry, here goes:</p>
<p>I&#39;ve written a lot about calibration in my various sketches, but it all seems rather dry &amp; artificial.&nbsp; So lets&#39;s go for a practical demo instead.&nbsp; I&#39;ve just put together a basic system that runs on an Arduino Uno and has a voltage sensor and a current sensor.&nbsp; The CT is simply clipped around one core of an extension which supplies mains power to a test load.&nbsp; The rig is just as in Section 8 of my <a href="http://openenergymonitor.org/emon/mk2/build">Diverting Surplus PV Power</a> article.&nbsp; See the diagram entitled &quot;A Suggested Test Rig for the Mk2 PV Router&quot;.&nbsp; For the purpose of calibration, the output stage can be ignored; we&#39;re only interested in the measurement side.</p>
<p>OK, now we need a sketch.&nbsp; Let&#39;s start with Mk2_PV_Router_mini_3.&nbsp; This displays the net change of level of the energy bucket each second (but without the start-up bug that was in the _2 version).&nbsp; We also need to supply an initial value of powerCal.&nbsp; Let&#39;s go for 0.05.&nbsp;</p>
<p>With no current running through the CT, I get values that are close to zero, as expected.&nbsp; With a 40 W bulb, the values are around 27 W.&nbsp; That suggests that my calibration is low by around 30%.&nbsp; With a 2 kW heater, I&#39;m seeing 1350 W, which appears to be similarly low, which is good.&nbsp;</p>
<p>Now, we need to change powerCal by just the right amount to make our measured values of power match what we would expect.&nbsp; To get from 1350W to 2000W, I need to increase powerCal by (2000 / 1350) = 1.48148.&nbsp; So powerCal needs to be increased from 0.05 to 0.74074 or thereabouts.&nbsp; Let&#39;s go for 0.074.&nbsp;</p>
<p>Processing the 40 W bulb reading in a similar way, powerCal needs to be increased by (40 / 27).&nbsp; This comes to exactly the same value, 1.48148.&nbsp; How convenient, and entirely unexpected!</p>
<p>With powerCal = 0.074, we would expect &#39;spot-on&#39; values.&nbsp; In practice, my results with the same sketch were:</p>
<p>We&#39;re off!<br />
	12.63<br />
	0.01 &lt;&lt; no load<br />
	0.24<br />
	-0.15<br />
	0.15<br />
	-0.00<br />
	-0.14<br />
	0.38<br />
	16.61 &lt;&lt; 40W load<br />
	40.47<br />
	40.85<br />
	40.49<br />
	40.72<br />
	40.18<br />
	40.44<br />
	19.38&nbsp; &lt;&lt; no load<br />
	-0.15<br />
	0.05<br />
	-0.00<br />
	-0.04<br />
	0.09<br />
	1337.99&nbsp; &lt;&lt; 2 kW load<br />
	1971.77<br />
	1971.95<br />
	1970.83<br />
	1968.32<br />
	1962.58<br />
	582.35&nbsp; &lt;&lt; no load<br />
	-0.13<br />
	0.07<br />
	-0.05<br />
	-0.20<br />
	-0.24</p>
<p>So that looks pretty good to me.&nbsp; The same powerCal parameter works equally well with all of my Mk2 sketches, so let&#39;s now try it with a more recent build which uses integer maths.&nbsp; Mk2i_rev4 is a good candidate for this.&nbsp; Although the energy bucket now uses different units, the sketch can still operate in a calibrated way.&nbsp; For this, you need to be running in Tallymode.</p>
<p>So, I will now load up the Mk2i_rev4 sketch and set powerCal to 0.074.&nbsp; <strong>PowerCal relates solely to the hardware that&#39;s in use</strong>, and nothing has changed there.&nbsp; The first section of printout confirms that powerCal is set as expected:</p>
<p>Sketch ID:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Mk2i_PV_Router_rev4.ino<br />
	ADC mode:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 125uS fixed timer<br />
	Output mode:&nbsp;&nbsp;&nbsp; anti-flicker<br />
	&nbsp; offsetOfEnergyThresholds&nbsp; = 0.10<br />
	&nbsp; minTimeBetweenActivations = 3.00s<br />
	Auto-select?:&nbsp;&nbsp; yes<br />
	Extra Features: TALLYMODE<br />
	<strong>powerCal =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0.0740</strong><br />
	phaseCal =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.00<br />
	&gt;&gt;free RAM = 593<br />
	&nbsp; capacityOfEnergyBucket_long = 2432432<br />
	&nbsp; lowerEnergyThreshold_long&nbsp;&nbsp; = 972972<br />
	&nbsp; upperEnergyThreshold_long&nbsp;&nbsp; = 1459459<br />
	&nbsp; minCycleCountsBetweenActivations = 150<br />
	&gt;&gt;free RAM = 579<br />
	----</p>
<p>	Tallymode setup:<br />
	Time to run (secs)?&nbsp;</p>
<p>Now for the user responses.&nbsp; Let&#39;s go for run time = 10 seconds;&nbsp; min power = -100W; max power = 100W, and allow the run to complete while my 40W bulb is on.&nbsp; The relevant part of the display is:</p>
<p>9, 0<br />
	47, 0<br />
	45, 1<br />
	43, 2<br />
	41, 134<br />
	39, 333<br />
	37, 28<br />
	35, 1<br />
	33, 0<br />
	31, 0<br />
	29, 0<br />
	2</p>
<p>With Mk2i, the first column is the power in Watts. The results show a definite grouping of data around the 40 Watt point, just as expected.&nbsp;&nbsp; Repeating this operation for the 2KW heater, let&#39;s go for a min power of 1000W and a max power of 3000.&nbsp; With the Uno, there&#39;s no need to re-start the program, just enter &#39;g&#39; and [CR] ...</p>
<p>2060, 0<br />
	2020, 0<br />
	1980, 230<br />
	1940, 270<br />
	1900, 0<br />
	1860, 0</p>
<p>Wow, how&#39;s that for tight grouping of results!&nbsp; Each of the 500 mains cycles has virtually the same amount of energy content.</p>
<p>So, by using a powerCal value of 0.074, my system is now nicely calibrated for calculating &quot;real power&quot;, which is what the meter measures.&nbsp; I can now be confident that a standard 2-level Anti-flicker scheme will work as intended. &nbsp; With my Mk2i_rev4 code, as posted, the AF limits are at the 40% and 60% of the energy bucket.&nbsp; Normally, one would go for, say, 10% and 90%, thereby using 80% of the available range.&nbsp; This would be achieved by setting</p>
<p>float offsetOfEnergyThresholdsInAFmode = <u><strong>0.4</strong></u>; // &lt;-- must not exceeed 0.5</p>
<p>Note that Tallymode could have been used just as effectively to determine the correct value of powerCal for this rig.&nbsp; If I were to set powerCal back to its original value of 0.05, the measured power values using Tallymode would be correspondingly lower.&nbsp; So, with powerCal set to 0.05, here are the values for my 40W bulb and 2kW heater respectively:</p>
<p>30.50, 0<br />
	29.50, 0<br />
	28.50, 5<br />
	27.50, 102<br />
	26.50, 291<br />
	25.50, 96<br />
	24.50, 3<br />
	23.50, 0<br />
	22.50, 1</p>
<p>1390, 0<br />
	1370, 0<br />
	1350, 58<br />
	1330, 436<br />
	1310, 6<br />
	1290, 0</p>
<p>So that&#39;s 27W and 1350W, just as we saw with the other sketch.&nbsp; QED</p>
<p>Hope that all makes sense!<br />
	&nbsp;</p>
<p>&nbsp;</p>
<p>
	&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11384"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Wed, 17/04/2013 - 11:09.</div>
    <div class="content">
     <p>Hi Robin</p>
<p>Just what i needed, thank you</p>
<p>ill be going home early today to set this up</p>
<p>cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11385"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="terrwilk&#039;s picture" title="terrwilk&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by terrwilk (not verified) on Wed, 17/04/2013 - 11:52.</div>
    <div class="content">
     <p>Hi Robin,</p>
<p>Thank you very much for putting yourself out like this, I think this clears it all up.</p>
<p>This is a great forum for info and full of enterprising people like yourself.</p>
<p>One thing I would like clarified, I seem to remember a video of yours where you were using anti-flicker and you were surprised that it caused an LED event for import!</p>
<p>Did you manage to adjust anything on your rig to counter that event?</p>
<p>Until I fully investigate my calibration, I cannot reliably use anti-flicker at the moment, so fully utilising flicker mode with the annoyance of every time I open my fridge I see the flicker, but fully grinning from ear to ear that I am heating up my 220ltr tank for free.</p>
<p>I will be looking to try multiple loads soon but without RF as I have opted for a long control cable to the remote CU inside my house&nbsp;from the arduino output located in the meter cabinet outside my house approx 25mtrs away.</p>
<p>So is it possible to adapt / adjust the rev5 to not have to use&nbsp;RF?</p>
<p>Kind regards</p>
<p>Terry</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11386"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 17/04/2013 - 12:13.</div>
    <div class="content">
     <p><em>Me, yesterday: Pity I can&#39;t build a decent power supply :(</em></p>
<p>The problem was with my choice of smoothing capacitor, as left over from some previous project.&nbsp; 10uF is OK for a small load, but is much too small when trying to power several LEDs at once.&nbsp; With 100uF, it works fine, and a larger value would no doubt be even better for this task.</p>
<p>Here&#39;s my remote dump-load controller today sending surplus power to the storage heater.&nbsp; The little flag is to stop eyes being poked out by the aerial.&nbsp;</p>
<p>Unfortunately, unless there is a lot of surplus power during the daytime, our storage heater seems unlikely to get hot enough to really make much difference on chilly evenings.&nbsp; But, as they say, (although I don&#39;t frequent the place myself), every little helps!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11387"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 17/04/2013 - 12:35.</div>
    <div class="content">
     <p><em>terrwilk:&nbsp; Hi Robin, Thank you very much for putting yourself out like this, I think this clears it all up.</em></p>
<p>No problem, I should probably have done so a lot sooner.&nbsp; Some of my written stuff about calibration does look a bit heavy now.&nbsp; &quot;Watts per ADC unit squared&quot; takes some getting ones brain (and teeth!) around!</p>
<p><em>One thing I would like clarified, I seem to remember a video of yours where you were using anti-flicker and you were surprised that it caused an LED event for import! ... Did you manage to adjust anything on your rig to counter that event?</em></p>
<p>Yes, that did happen on one occasion.&nbsp; I&#39;ll have to think a bit more about why that may have happened.&nbsp; Dog walks are good for sorting these things out in one&#39;s mind ...</p>
<p><em>Until I fully investigate my calibration, I cannot reliably use anti-flicker at the moment, </em></p>
<p>Two suggestions:</p>
<p>1.&nbsp; Reduce the gap between the upper and lower AF thresholds until your meter ceases to respond to each dump-cycle.&nbsp; You&#39;ll then know that you&#39;re working within the &quot;sweet zone&quot; of your meter.&nbsp; The actual calibration of your system then doesn&#39;t matter.&nbsp;</p>
<p>2.&nbsp; Use Mk2i_rev5, which doesn&#39;t require calibration.&nbsp; As long as your dump-load doesn&#39;t exceed 3kW, and your meter is a standard 3600J one, the AF performance should be fine.&nbsp;</p>
<p><em>I will be looking to try multiple loads soon but without RF as I have opted for a long control cable to the remote CU inside my house&nbsp;from the arduino output located in the meter cabinet outside my house approx 25mtrs away. ... So is it possible to adapt / adjust the rev5 to not have to use&nbsp;RF?</em></p>
<p>OK, that feature is already there in Mk2i_rev5, just make sure that &nbsp; <strong>boolean RF_moduleIsAvailable = <em><u>false</u></em>;</strong>&nbsp;&nbsp; You can then freely use the five digital pins that are otherwise tied up by the RF unit (Nos 2 and 10 - 13)</p>
<pre>
// ----------- Pinout assignments  -----------
//
// digital input pins:
// dig pin 0 is for Serial Rx
// dig pin 1 is for Serial Tx
// dig pin 2 is for the RFM12B module (IRQ)
const byte LED_detectorpin = 3; // for meter pulse detection (polling or interrupts)
const byte outputModeSelectorPin = 4;   //  for normal or anti-flicker mode
const byte loadPrioritySelectorPin = 5; //  local or remote load to have priority
const byte underflow_LED = 6;           // non-essential, may have to be axed.      
const byte overflow_LED = 7;      
const byte surplusPV_LED = 8;  
const byte physicalLoad_0_pin = 9;      // for trigger (active low)
// dig pin 10 is for the RFM12B module (SEL)
// dig pin 11 is for the RFM12B module (SDI)
// dig pin 12 is for the RFM12B module (SDO)
// dig pin 13 is for the RFM12B module (CLK)

</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11406"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Wed, 17/04/2013 - 22:10.</div>
    <div class="content">
     <p>Ok</p>
<p><span style="font-size: 12px;">So I </span>didn&#39;t<span style="font-size: 12px;"> get away from work early, but i did mange to liberate (don&#39;t worry its my business) some bits to make a &quot;</span>Calibration<span style="font-size: 12px;"> extension lead&quot;</span></p>
<p>FYI - for those with keen eyesight, the black&nbsp;flex is single core not twin or three core, double insulated 4mm conductor wired in series with the Line conductor feeding the socket outlet.</p>
<p>Roll on tomorrow when i will, no honestly i will, manage to calibrate and switch on...................</p>
<p>Cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11418"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 18/04/2013 - 07:12.</div>
    <div class="content">
     <p>When I first started this lark, I bought a cheapo multimeter from Maplin which featured a current clamp.&nbsp; When compared with what a simple Uno can do along with a handful of standard components, its performance is absolute rubbish.&nbsp;&nbsp; It can just about detect whether a couple of Amps is flowing or not, but that&#39;s all.&nbsp; You could certainly not base any kind of a power router on it.</p>
<p>Hope your meter gives better results than mine!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11420"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="terrwilk&#039;s picture" title="terrwilk&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by terrwilk (not verified) on Thu, 18/04/2013 - 09:23.</div>
    <div class="content">
     <p>Hi Robin,</p>
<p>I seem to be getting weird readings from my CT which is the 013-000 type using your recommendation of 33 ohms burden and I am using a 3KW immersion dump. Although the circuit I have seen has 150ohm burden.</p>
<p>Does playing with the value of the burden help with the calibration?</p>
<p>Terry</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11422"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 18/04/2013 - 10:48.</div>
    <div class="content">
     <p><em>terrwilk: One thing I would like clarified, I seem to remember a video of yours where you were using anti-flicker and you were surprised that it caused an LED event for import! ... Did you manage to adjust anything on your rig to counter that event?</em></p>
<p><em>me: Yes, that did happen on one occasion.&nbsp; I&#39;ll have to think a bit more about why that may have happened.&nbsp; Dog walks are good for sorting these things out in one&#39;s mind ...</em></p>
<p>I&#39;ve now located that event which can be seen at 6:25 on my <a href="http://www.youtube.com/watch?v=-lk6Me3cwuw%C2%A0">IMGP9648.AVI</a> video, posted on 27/5/12.&nbsp;&nbsp; I&#39;m pleased to report that that recording was taken some time before Mk2 came along :D</p>
<p>At that stage, I was using the standard <strong>calcVI() </strong>library routine along with an external AC power controller.&nbsp; The main problem during that period was the slow overall response time.&nbsp; As can be seen in that clip, the controller continued to dump power well after the conditions had changed.&nbsp;&nbsp; When using any variant of my Mk2 Router, with our without AF measures in place, no such occurrences should be seen.&nbsp; Mk2&#39;s response time is around 30 mS so the system can always react quickly to changing conditions, unless prevented from doing so by over-draconian AF measures.</p>
<p>	With a nominally balanced Mk2 system, occasional chargeable events from the meter can never be prevented absolutely, this being an unavoidable consequence of the meter not telling us how its energy-flow readings are going - until its too late.&nbsp;&nbsp; Any slight non-linearity of the router&#39;s measurement system (or the meter&#39;s for that matter) will result in the occasional slip, and a consequent recovery phase during which surplus energy will be lost.&nbsp; This effect will be much more pronounced when an assertive AF regime is in place, i.e. one which attempts to use nearly all of the &#39;sweet zone&#39; that the meter allows.<br />
	&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11423"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 18/04/2013 - 10:57.</div>
    <div class="content">
     <p><em>terrwilk: I seem to be getting weird readings from my CT which is the 013-000 type using your recommendation of 33 ohms burden and I am using a 3KW immersion dump. Although the circuit I have seen has 150ohm burden.</em></p>
<p>I&#39;ve only recommended using a 150R burden, this being suitable for a system which only needs to measure up to +/- 3 kW.&nbsp; A 33R burden will allow a greater overall range but with reduced resolution.&nbsp; This could result in poorer performance at low power levels.</p>
<p>My advice to everyone is to please check the performance of their input sensors using the basic tools that I&#39;ve posted. &nbsp; My&nbsp; <a href="http://openenergymonitor.org/emon/node/1757"><strong>RawSamplesTool_4ss_2</strong></a> sketch allows three complete cycles&#39; worth of V and I samples to be taken and displayed at full resolution via a spreadsheet.&nbsp; This is the ideal playground to fine-tune your system for the job that you want it to do.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11476"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Fri, 19/04/2013 - 19:48.</div>
    <div class="content">
     <p>Aghhh</p>
<p>So got to calibration tonight..........................</p>
<p>Calibration appearedd to by way out (verified 2000W load showing up as 740+/-)</p>
<p>Altered powercal to 0.05 X 2.6 = 0.13</p>
<p>still a little bit out so altered it to 0.12 - my verified 2000W load now shows spot on 2000W - Fantastic</p>
<p>now to the lower scale - expecting good results, sadly disappointed, 40W lamp = 3W - hmmm</p>
<p>decided to check the system using &quot;Raw data&quot; and got the results in the attached</p>
<p>run and run again and no change, very odd</p>
<p>anyone any ideas, especially why the &quot;countdown&quot; appears to double count?</p>
<p>thank you in advance</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11480"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 19/04/2013 - 21:53.</div>
    <div class="content">
     <p>With the countdown appearing like that, I don&#39;t think your voltage sensor is working properly.&nbsp;</p>
<p>Do you get sensible values with my MinAndMaxValues tool?&nbsp; Output values from the voltage sensor should be around 512 when no AC is applied, and then run from maybe 100 to 900 when the 240V is applied, but still be centred around the 512 mark.</p>
<p>Here are a couple of files showing typical results with AC voltage present and absent.&nbsp; The sketch I used in both cases was RawSamplesTool.ino</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11516"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 22/04/2013 - 10:27.</div>
    <div class="content">
     <p>Several people have contacted me recently about particular aspects of the Mk2 design.&nbsp; Things like the ability to control multiple loads with or without an RF-link, the need for calibration, which hardware platform to use, etc.</p>
<p>As far as I can see, my <strong>Mk2i_PV_Router_rev5 </strong>sketch should meet most people&#39;s needs.&nbsp; I&#39;m currently using that version at home.&nbsp; Surplus PV power is reliably diverted to our DHW tank until the stat opens, after which it goes to a storage heater.&nbsp; The&nbsp; control path for the second load is via an RF link, but does not need to be.&nbsp; A pair of front-panel switches allow real-time selection of output mode (normal or AF) and priority selection (local or remote).&nbsp; My build happens to be running on a Uno, but is running equally well on a nearby emonTX - only the control pin number needed to be changed.</p>
<p>Despite wording to the contrary in its preamble section, the above build will work fine without an RF module being present.&nbsp; The relevant flag just needs to be set to false.&nbsp; This incorrect wording, along with a minor start-up bug, has been fixed in version <strong>Mk2i_PV_Router_rev5a</strong></p>
<p>&nbsp;</p>
<p><strong>&nbsp; </strong></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11607"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Thu, 25/04/2013 - 19:21.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Would like to ask a practical question: What happens when the boiler (dump load) maximum temperature is reached and dump load is switched off by boiler thermostat ?</p>
<p>I am really hesitant to connect a dump load without a thermostat and if there is a thermostat what happens then - would not like to&nbsp;push the excess PV generation back to grid as that requires a special agreement.</p>
<p>Rgds, PetriK</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11608"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 25/04/2013 - 19:39.</div>
    <div class="content">
     <p>Petrik,</p>
<p>The PV Router can only divert surplus power while a dump load is available.&nbsp; Once your thermostat opens, If no additional dump load is available, then surplus power will go back into the grid.&nbsp; In the UK, although there is no agreement which prevents this, we would generally rather use our power rather than lose it.</p>
<p>My latest build, <strong>Mk2i_PV_Router_rev5a</strong>, can support several dump loads including one via an RF link.&nbsp; I generally have my immersion heater as the primary dump, and a large storage heater as a secondary load.&nbsp; Even on a very sunny day, I doubt whether our storage heater would ever reach its maximum temperature. &nbsp;</p>
<p>Providing a back-up dump load that will never trip out should be fairly easy I would have thought.&nbsp; Just find a large volume of water somewhere, and heat it!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11609"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Thu, 25/04/2013 - 19:55.</div>
    <div class="content">
     <p>Understood how it works, need a dump load if you dont want to leak excess generation back to grid. Now the puch line: how feasible do you see pushing the dump load to a battery cell that can be utilized during the night time ? The current algorithm allows easily to add resistive loads but store and forward energy &nbsp;would benefit the consumer most. just a thought that what would be needed to change with the buckect systen if one wants to replace a dump load with a battery capacity for night &nbsp;time ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11611"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 25/04/2013 - 21:14.</div>
    <div class="content">
     <p>As long as the battery charger can tolerate being turned on and off at frequent intervals, there should be not problem (i.e. a simple transformer-rectifier lead-acid charger should be OK). But any other, particularly for the more modern battery types, Nickel or Lithium-based, would need to be checked with the manufacturer. Or you could think about designing your own charger where the charge rate was controlled by the bucket level!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11615"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 26/04/2013 - 09:27.</div>
    <div class="content">
     <p><em>RW: Or you could think about designing your own charger where the charge rate was controlled by the bucket level!</em></p>
<p>The phase-angle control version of my PV Router may be helpful for this.&nbsp; With that version, surplus power is diverted proportionally rather than simply being &#39;on&#39; or &#39;off&#39;.&nbsp; All the info about this, and the associated pitfalls with EMC, can be found via the link on my <a href="http://openenergymonitor.org/emon/node/1757">Summary Page</a> (look for <strong>Mk2_PV_phaseAngle</strong>).&nbsp;</p>
<p>Surplus power can, of course, still stop at any time.&nbsp; Your logic would have to decide how best to react in this situation.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11620"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 26/04/2013 - 13:01.</div>
    <div class="content">
     <p>I can&#39;t imagine an intelligent charger taking kindly to being fed a chopped mains wave!</p>
<p>There are two approaches that I&#39;d think about:<br />
	The battery charger could be made to be the primary dump load. The logic would require heavy modification to assure that it was switched as infrequently as possible. This implies that the secondary dump load would actually be used first and only when more than enough power was available to run the charger continuously would the charger be switched on and the secondary load used to trim the total load.<br />
	Alternatively, it should be possible to integrate the charger with the load controller so that it adjusted the charging rate within appropriate limits to suit the surplus power available. This means designing a charger.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11623"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 26/04/2013 - 14:47.</div>
    <div class="content">
     <p><em>RW</em>:<em> The battery charger could be made to be the primary dump load. The logic would require heavy modification to assure that it was switched as infrequently as possible. This implies that the secondary dump load would actually be used first and only when more than enough power was available to run the charger continuously would the charger be switched on and the secondary load used to trim the total load.</em></p>
<p>OK, so the primary load should only come on when there is sufficient power for it to be run continuously.&nbsp; The problem with this arrangement is that the Mk2 Router has never had to deal with &quot;power&quot; before.&nbsp; It doesn&#39;t have&nbsp; &quot;power meter&quot;; it has an &quot;energy bucket&quot;, just like the utility meter.</p>
<p>Because of the fickle nature of surplus power, it can never be guaranteed that the charger can be brought on &quot;now&quot; without needing to draw power from the grid within X seconds.&nbsp; The logic could, however, make the decision to supply full power to the charger for a minimum of X seconds regardless of the amount of surplus power that is actually available.&nbsp; This decision process could be regularly reviewed.&nbsp; By this means, most of the power that&#39;s fed to the charger would be likely to be surplus, but not not all.</p>
<p>The most difficult condition would be when surplus power only just exceeds the rating of the charger, because any small reduction would cause the system to go into deficit.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11624"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Fri, 26/04/2013 - 15:46.</div>
    <div class="content">
     <p>As this is now interrupt based, maybe you dont need to empy the bucket fully, rather control&nbsp;pwm to dump load giving a constant output ? I see some benefit of a battery also during day time to buffer the energy making a secondary energy bucket. Tested this approach on my desktop with 1kwh package earlier this year with some decent efficiency. The switched loads like kettle, microwave etc are only used for minutes but do require more than my small panel setup can generate. I can also see in consumption data a peak of 1kw or so for such devices so secondary load could be reverted also additional capacity from a battery ? Now my setup has two GTI:s so dont know how to put this in practise for a more generic approach.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11631"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 26/04/2013 - 18:08.</div>
    <div class="content">
     <p>Petrik,&nbsp; the purpose of my energy bucket is simply to match what the electricity meter does.&nbsp; The meter keeps track of how much energy is flowing in either direction. but the result of this activity is only known when something is seen at the meter&#39;s LED, by which time it is too late to take any action.</p>
<p>By implementing a similar energy bucket whose level is known at all times, appropriate action can be taken so that a continuous balance is achieved between import and export.&nbsp; By this means, no cost or penalties are registered against the user.</p>
<p>If you want to supply power to a battery charger which doesn&#39;t like being turned on and off, then that appliance is forming part of your base-load.&nbsp; It is not acting a dump load.&nbsp; A dump load needs to consume only power that is surplus.</p>
<p>Think of a reservoir which contains water.&nbsp; When it rains, water flows in and the level rises.&nbsp; When the level reaches its maximum, some water escapes via the overflow.&nbsp; When the rain stops, so does the overflow.&nbsp; If you wanted the overflow to continue running after the rain has stopped, you could no doubt arrange for this to happen by opening a valve at some lower level, but then it wouldn&#39;t be acting as an overflow any more.&nbsp; It would be an output which provides water from the reservoir, which is different.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11632"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1165" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="richmc&#039;s picture" title="richmc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1165" title="View user profile.">richmc</a> on Fri, 26/04/2013 - 18:30.</div>
    <div class="content">
     <p>This is a little like the question I PM&#39;ed you with recently Robin. Having heated the water using the pulsing triac, Switching over to another non resistive load would require a degree of hysteresis i.e. once the load is on it needs to be left on for say 10mins then a check to see if there is still enough solar to drive it, if there is leave the load on, if not&nbsp;turn it off for a set period then recheck. It would cause some unwanted import/export but in a controlled way.</p>
<p>Using a battery and inverter as storage looks elegant but charging the battery is going to be problematic as has been pointed out with anything other than good old solid 240V AC.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11634"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Fri, 26/04/2013 - 19:29.</div>
    <div class="content">
     <p>Ok - let me try to be a bit more specific. First must admit that have not studied mk2i well enough and answer may be found in the code already...</p>
<p>1) is it possible to make the mk2i energy bucket flow to dumb load using pwm rather than energy bursts? In this case the pwm output can be better used for charging either from mains or from directly from PV. Building a charger with pwm is fairly simple. Additional benefit may be reduced flickering and synchronization with mains&nbsp;sine wave. Trying to keep the bucket on suitable level by outputting&nbsp;pwm. .</p>
<p>2) depending a solar system it may be possible to connect battery directly to PV array to act an intermediate storage. My current plan is to ensure there is some capacity in boiler to heat it up. If temperature gets over a certain threshold then i just switch PV off or maybe to charge the battery for remaining capacity to be used during the evening and nights.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 26/04/2013 - 20:46.</div>
    <div class="content">
     <p><em>Petrik: Ok - let me try to be a bit more specific. First must admit that have not studied mk2i well enough and answer may be found in the code already...</em></p>
<p>And I will try to be specific also.&nbsp; All Mk2 version work much the same, as does any other PV router.&nbsp; There&#39;s nothing special about the way that Mk2i works, except that it&#39;s very fast!</p>
<p>An electricity meter only allows a small amount of energy to flow in the reverse direction before something unpleasant happens.&nbsp; In the UK, we start to lose that energy and can&#39;t get it back without paying for it.&nbsp; It other places, users are charged for any energy that they export. &nbsp;</p>
<p>The job of the Router is therefore to ensure that no energy is exported.&nbsp; It does this by diverting power to a dump load so that consumption matches generation.</p>
<p>The Router has three parts:</p>
<p>1.&nbsp; The measurement system, which measures energy flow at the supply point</p>
<p>2.&nbsp; The energy bucket, which accumulates the energy measurements</p>
<p>3.&nbsp; The energy diversion system, which diverts surplus power to a dump load</p>
<p>When all of the above parts are working together, there is no net flow at the supply point.&nbsp;&nbsp;</p>
<p>Parts 1. and 2. are entirely straightforward, they simply do their job.&nbsp; Part 3. is different because there are different ways that surplus power can be diverted to the dump load.&nbsp; In my original version, there was a single threshold, and the load was simply turned &#39;on&#39; of &#39;off&#39; depending on which side of the threshold it was.&nbsp; That method works fine for heating water, but tends to make nearby lights flicker.</p>
<p>Flicker can be avoided by using phase-angle control.&nbsp; That method adjusts the output rate (power) according to where the bucket&#39;s level is within its operating range.&nbsp;</p>
<p>Whichever of the above methods are used, the energy bucket&#39;s level must always remain within the &quot;sweet zone&quot; of the meter.&nbsp; To put it another way, <strong>power has to be consumed by the dump load at the same rate as which surplus power is being generated. </strong></p>
<p>Providing that your dump load can be used in this way, that&#39;s fine.&nbsp; <strong> </strong>Otherwise the Router will not be able to do its job properly.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11638"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 26/04/2013 - 21:07.</div>
    <div class="content">
     <p>Petrik:</p>
<p>Have you read <a href="http://openenergymonitor.org/emon/buildingblocks/meters" title="Energy Meters">Energy Meters</a>?&nbsp; It might help to explain why the Mk2 controller was designed the way it was.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11646"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Sat, 27/04/2013 - 01:39.</div>
    <div class="content">
     <p>Thanx&nbsp;chaps for education - I need to read the code in detail and then possibly revert.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11703"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="ljfaragher&#039;s picture" title="ljfaragher&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by ljfaragher (not verified) on Mon, 29/04/2013 - 16:52.</div>
    <div class="content">
     <p>Robin<br />
	I can confirm that the startup Triac on bug is fixed.<br />
	I designed a PCB with all the circuitry then came across JeeLabs Jeenode and jeelink etc.&nbsp; I scrapped my design [no need to reinvent the wheel] and think I will design a plug in board incorporating the TX and RX end.&nbsp; Only populate which end is needed or both if the local load is wired directly to immersion etc.&nbsp;&nbsp; Think I&#39;ll be going their &quot;HouseMon&quot; RasberryPi web server route as I want to Store and display data such as Charge/Discharge of my 900Ah battery bank etc.&nbsp;&nbsp;<br />
	<em>I read on this forum that someone had added a HW Immersion Tank alongside a Combi Boiler.&nbsp;&nbsp; I want to add a tank in parallel with my combi boiler so perhaps you can PM me if you read this.&nbsp; [I have searched the forum and have been unable to find out who it was]<br />
	Laurence</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11704"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 29/04/2013 - 17:20.</div>
    <div class="content">
     <p><em>Robin<br />
	I can confirm that the startup Triac on bug is fixed.</em></p>
<p>Thanks Laurence.&nbsp; That will be with <strong>Mk2i_PV_Router_rev5a</strong>, as per our postings on the previous page (c. 14th April).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11778"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3677" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="morris8cars&#039;s picture" title="morris8cars&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3677" title="View user profile.">morris8cars</a> on Wed, 01/05/2013 - 15:53.</div>
    <div class="content">
     <p>Robin<br />
	Been following the whole thread a while and awaiting my install of 3.7Kw PV. I have all parts to start building MK2i rev_5 (2 Adunio Uno&#39;s).&nbsp; Whilst I have been into electronics over 40 years I have not done any coding&nbsp;for many years&nbsp;but your write up was good.</p>
<p>My main Uno will be near the consumer unit and I intend to run cat 5 twisted cable to the immersion tank (or you advise otherwise) where my output IC/triac will sit to control within a smaller aluminum box with heatsink . Would my output pin resistor on Uno be best placed in main output box&nbsp;or at main&nbsp;remote.&nbsp;Additionally I intend to install a 2nd output via RFM12B in main Uno and satellite Uno output unit to power a heater or other load.</p>
<p>What Im unsure of is that whilst I will have the neon pulsing/flickering on the Hot water tank and also on the remote heater, to see the output I not sure what will/can be availible on the main unit /remote main/ remote RF (e.g bucket LED&#39;s RF LEDs etc) as I am confused between RF LED&#39;s and Bucket LEDs in the various designs. Can you advise what I can have and where or a revised drawing would be great. Many thanks and really great project</p>
<p>Cheers Dave</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11782"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 01/05/2013 - 21:39.</div>
    <div class="content">
     <p>Hi Dave,</p>
<p>Yes, Mk2i_rev5 should be fine for your needs. that&#39;s what we have running at home.&nbsp; As posted, that sketch has LEDs for underflow and overflow.&nbsp; In practice, I&#39;ve not found them to be of much use, so I&#39;ve generally re-allocated those LEDs to show when the local and remote LEDs are on/off.&nbsp; If you look at the code, you should be able to see how to do this.&nbsp; Whenever the local load is switched on or off, just switch your chosen LED at the same time; and similarly for the remote load.</p>
<p>With two loads and the RF unit in operation, digital pins are quickly used up.&nbsp; If you don&#39;t want to switch between normal / anti-flicker mode, that&#39;s one digital pin you could save.&nbsp; Similarly, if you don&#39;t want to select which load has the higher priority, then that&#39;s another pin that can be used for an LED.</p>
<p>The RF module uses 5 digital pins, and Tx and Rx take two more, so that&#39;s seven which are freely available for you to use.&nbsp; It&#39;s really up to each constructor to decide how best their spare pins can be used.&nbsp;</p>
<p>If you&#39;d like to post a list of what functionality you&#39;d like to see, I&#39;d be more than happy to comment as to whether it can be done.&nbsp; The answer is most likely to be &#39;Yes&quot;.&nbsp; :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11785"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3016" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3016" title="View user profile.">dBC</a> on Wed, 01/05/2013 - 22:04.</div>
    <div class="content">
     <p>And any unused analog pins can be used as digital pins too.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11788"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1704" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Keith Walker&#039;s picture" title="Keith Walker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1704" title="View user profile.">Keith Walker</a> on Wed, 01/05/2013 - 22:37.</div>
    <div class="content">
     <p>Hi All,</p>
<p>I&#39;ve just moved over to Mk2i rev 5a in anti-flicker mode.</p>
<p>I have an Actaris Ace1000 meter which has a smaller sweet spot, so I&#39;ve changed the bucket size to suit :-</p>
<p>#define JOULES_PER_WATT_HOUR 1250</p>
<p>But I&#39;ve noticed another place in the sketch that has 3600j hard coded in.</p>
<p>energyAtLastOffTransition_long = 3600; // reset the &#39;opposite&#39; mechanism.</p>
<p>Should this be changed to match the reduced size of the energy bucket? ie :-</p>
<p>energyAtLastOffTransition_long = JOULES_PER_WATT_HOUR;</p>
<p>Thanks in advance, Keith</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11811"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 02/05/2013 - 18:40.</div>
    <div class="content">
     <p>To avoid any confusion later, I think it may be best to leave JOULES_PER_WATT_HOUR as 3600.</p>
<p>Mk2i_rev5 uses an alternative type of AF algorithm which has only one threshold and requires no calibration.&nbsp; To tighten up its behaviour so that it will work with a meter that has a smaller &#39;sweet zone&#39;, you need to reduce the value of:</p>
<pre>
const int postMidPointCrossingDelayForAF_cycles = <u><strong>25</strong></u>; // in 20 ms counts
</pre><p>If you set this value to 10, that should work fine with your meter.&nbsp; A two-threshold algorithm, as used in Mk2i_rev4, will give a slower switching frequency.&nbsp; If you want the multi-load capability of rev5, but the AF algorithm from rev4, you&#39;ll need to merge the relevant parts of the two sketches.&nbsp; That shouldn&#39;t be too difficult, but it&#39;s not on my &quot;to do&quot; list at the moment.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11831"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1704" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Keith Walker&#039;s picture" title="Keith Walker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1704" title="View user profile.">Keith Walker</a> on Fri, 03/05/2013 - 11:05.</div>
    <div class="content">
     <p>Thanks Robin. I&#39;ll make those changes and see what happens.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11919"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Tue, 07/05/2013 - 15:10.</div>
    <div class="content">
     <p><u><em>GTEC: Robin, the logic you speak about would need to</em></u></p>
<p><u><em>1. Set a threshold limit of say 35W (pump dependant)</em></u></p>
<p><u><em>2. Only after that threshold was exceeded would it then pin out a constant &quot;on&quot; for one of the&nbsp;analogue pins</em></u></p>
<p><u><em>3. Only then &nbsp;it would activate pin 9 proportional to the gross Wattage available less 35W (pump dependant)&nbsp;</em></u></p>
<p><u>Once the bucket hits its overflow point, that usually means that the stat has opened, in which case your de-stratfication pump would need to come on.&nbsp; It may take some minutes before the stat closes during which time surplus power could temporarily (or permanently, for the day) disappear.&nbsp; For a variety of reasons, surplus power is rarely constant.&nbsp; At this stage, what should you do?&nbsp;</u></p>
<p><u>You could leave the pump on for a minimum of, say a minute (as &quot;baseload&quot;), but this may not be beneficial if it&#39;s near the end of the period of useful power for the day.&nbsp; Or you could turn it off immediately in which case the pump would flicker.</u></p>
<p><u>Accounting for the pump&#39;s rated power consumption within the router&#39;s logic makes little sense to me.&nbsp; If the pump needs to be on, then it simply forms part of the baseload, and surplus power is reduced accordingly.&nbsp;</u></p>
<p><u>The sole role of my router has always been to divert surplus power.&nbsp; Getting the router to turn something on when there is insufficient surplus power for that appliance is a step not to be taken lightly.</u></p>
<p><u>As I say, the logic itself is straightforward enough.&nbsp; It&#39;s the underlying algorithm which is the tricky part.</u></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>A bit of feedback on this one.</p>
<p>I&#39;ve just been running some test with a de-stratification pump on my store. The pump is powered from normal mains and switched on only when the router bucket is in overflow. I find that in practice the immersion stat closes within 20-30 seconds after the pump has started which re-starts power dumping and momentarily afterwards, the pump stops.</p>
<p>The logic is that the pump runs when the stat opens and there is still PV power. If the PV falls then the bucket will cease to overflow and the pump stops.</p>
<p>The worst case of the pump running when not needed would be when excess PV is available and the stat open long term which only occurs when the water in the tank both above and below the level of the immersion is up to temperature. At the end of the generation day or when PV is being consumed elsewhere in the house, the bucket will underflow and the pump will stop</p>
<p>No software changes involved, just a transistor driven by the overflow LED drive switching a relay suitable for the pump power.</p>
<p>So whilst the pump is not powered via the router as part of the dump load but it is almost certainly running on PV power. The balance of any PV does escape to the grid whilst the pump is on but we are possibly in the milli pence argument region here !</p>
<p>An even simpler method might be to connect the pump across the stat terminals. Now the router will be driving the pump with rapid on and off changes whenever the stat is open - I would only suggest this is tried with anti flicker enabled and it does still have the drawback that the triac is switching an inductive load albeit a small one and in series with the resistive&nbsp; immersion element.</p>
<p>&nbsp;</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11921"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 07/05/2013 - 15:28.</div>
    <div class="content">
     <p><em>9fingers: The logic is that the pump runs when the stat opens and there is still PV power. <strong>If the PV falls then the bucket will cease to overflow and the pump stops.</strong></em></p>
<p>OK, so your pump only comes on when the primary load cannot consume the surplus power that is available, which cause the bucket to overflow.&nbsp; In that case, is simply acting as a secondary load.</p>
<p>My Mk2i_rev5 sketch already provides that functionality, but in a tidier way.&nbsp; It doesn&#39;t need to rely on overflow which is an unsatisfactory way to do it, IMHO.&nbsp; The measurement system is linear throughout the energy bucket&#39;s range, but ceases to be so at either end.&nbsp;</p>
<p>All functionality should therefore be constrained to take place within the linear zone.&nbsp; Difficulties can occur when switching between different loads, which is essentially what&#39;s happening here.&nbsp; The ower-diversion algorithm that is used in my rev5 code appears to work better in this regard than previous AF algorithms.&nbsp;</p>
<p>In your case, my Rev5 logic would detect when your heater is unable to prevent the bucket&#39;s level from rising (because the stat has opened), and would bring the pump on.&nbsp; This would occur well before the overflow point is reached thereby preventing your system from leaving the linear region.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11927"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Tue, 07/05/2013 - 18:39.</div>
    <div class="content">
     <p>Fair enough Robin. I mainly responded to comment on how quickly my stat reacted to the pump being on - which was the question raised in the earlier post. I then got carried away with describing the rest of my set up which is firmly rev4 based and working well for my needs.</p>
<p>Cheers</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11935"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 08/05/2013 - 10:17.</div>
    <div class="content">
     <p>OK, Bob, thanks for the clarification.&nbsp;</p>
<p>A de-stratification pump makes a lot of sense to me, and it&#39;s good to know how quickly it can do its job.&nbsp; On many occasions, I&#39;ve run off some hot water for a useful purpose but been unsuccessful in bringing the stat back on.&nbsp; Until the whole tank is fully up to temperature, a de-strat pump should always be able to encourage a greater take-up of heat.&nbsp;</p>
<p>If the pump were ever to be on for longer than a certain period, then some refinement to the algorithm could no doubt be devised to turn it off.&nbsp; Otherwise it could remain &#39;on&#39; for hours at a time during sunny weather when the house is unoccupied.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11939"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 08/05/2013 - 10:42.</div>
    <div class="content">
     <p>A &#39;bottom&#39; thermostat perhaps? When the bottom of the tank is hot, there&#39;s no further need for the pump.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11943"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Wed, 08/05/2013 - 11:54.</div>
    <div class="content">
     <p>I&#39;ve been quite surprised how small the temperature gradient is above the heat source.</p>
<p>My store is 2m tall and 500mm diameter and I&#39;m dumping into a horizontal immersion about 300mm up from the bottom (there is one higher up as well which I might play with later).</p>
<p>I&#39;ve had 7 temperature measurement ports fitted as they were so cheap at manufacture. These are fairly evenly distributed vertically up the cylinder and I see little more than a few degrees difference between them. Obviously lots of internal convection going on.</p>
<p>It seems that the only use for the de-strat pump on my tank seems to be to heat the water below the level of the heat source to cram in the very last little bit of energy into the store which is about the 15%.</p>
<p>What this does mean though is that when I have less PV available to dump, I could use the upper immersion to get the upper half of the tank hot first and then decide how to use remaining PV later in the day either to switch over to the lower immersion or to use the de-strat pump.</p>
<p>Plenty of scope for experimentation coming up!</p>
<p>Bob</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11945"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 08/05/2013 - 12:06.</div>
    <div class="content">
     <p>That makes sense to me. Natural convection is doing the stirring for you. A hypothesis: It might be that the area of the heater in the horizontal plane has a lot to do with it. If it&#39;s relatively compact (viz. the element reaches in from the top) there is less stirring from convection than if it reaches in from the side. Maybe this is an experiment to include? - not full size of course, I&#39;m thinking in terms of a small power resistor in a clear plastic bottle fed from 6 V or so!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11953"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 08/05/2013 - 13:51.</div>
    <div class="content">
     <p>If you have more than one immersion, it makes a good sense to dump surplus power into the upper one first.&nbsp; The lower one can then simply act as the secondary load.&nbsp; No need for any pumps, the Mk2i_rev5 code will deal with multiple dump-loads as posted.&nbsp; A de-strat pump could also be fitted as the third load, but maybe that&#39;s going a bit OTT (or UTB!)</p>
<p>(Incidentally, I had occasion to run Mk2i_rev5a today, and the triac does indeed remain off during initialisation - Phew!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11957"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Wed, 08/05/2013 - 15:58.</div>
    <div class="content">
     <p>In the short term, I&#39;m without a boiler connection to the new store. I&#39;m using the lower heater as the dump with the stat set to maximum (80C) and the upper immersion is set to 60C on a timeswitch at 5pm for an hour or so&nbsp; to cover days when there is insufficient solarPV&nbsp; to get the store up to 60C. The recent degradation in the weather compared to the last week or so of 20kWh/day of PV may well mean the upper immersion will come into play.</p>
<p>I&#39;ve ordered the boiler today for fitting over the summer and that will connect to the store. At some stage this year I&#39;ll fit the evacuated tubes on the roof after which both immersion heaters will be available for &#39;playing&#39; with dumping/de-strat schemes with both solar thermal and PV as inputs.</p>
<p>Previous experience with near vertical immersions also seemed to support/promote good convection currents when new however it did seem that after significant scaling, the thermostat would be satisified by a relatively small amount of very hot water at the top (well over the nominal stat setting) and the rest somewhat cooler. As the stat operation is simply a function of the length of the sensor overall, this can be satisfied in a number of combination of layers of different temperature water.</p>
<p>At one stage years ago I had to fit a de-strat pump in order to get a decent amount of water at a sensible temperature. When the element eventually failed due to hard water corrosion, a new clean one went back to behaving properly and the pump was no longer needed.</p>
<p>Apologies for digression from the main topic!</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11961"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 08/05/2013 - 17:29.</div>
    <div class="content">
     <p>No problem.&nbsp; Maybe this topic could be continued on the &nbsp; <a href="http://openenergymonitor.org/emon/node/2006">The PV Energy Dump and How To Use It</a> &nbsp; thread.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12008"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tim_h&#039;s picture" title="Tim_h&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by Tim_h (not verified) on Fri, 10/05/2013 - 16:28.</div>
    <div class="content">
     <p>Having already built one of these units for a friend I am looking to build another, but with the addition of a storage heater.</p>
<p>Is it possible to build a MK2 system with 2 or 3 loads, but without the wireless option?</p>
<p>I can easily hard wire the loads to the control box but was not sure if the code is written for direct control option or wireless only.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12017"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 10/05/2013 - 20:01.</div>
    <div class="content">
     <p>Yes, Mk2_rev5 will work for any number of dump-loads, the only limitation being that you need an output pin to drive each one.&nbsp; If you&#39;re not using the RF module, then several extra pins become available.&nbsp; I gather than the analog pins can be used as digital outputs too.&nbsp;</p>
<p>With Mk2i_rev5 (or preferably the _rev5a version), just set the number of dump-loads to be as you wish.&nbsp; All the arrays for the logical and physical loads with then be re-dimensioned automatically.&nbsp; Apart from assigning a driver pin for each load, there should be very little that you&#39;ll need to change in the code.</p>
<p>Maybe we should hold a competition to see who can construct a PV Router system with the most loads :)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12032"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Sat, 11/05/2013 - 13:45.</div>
    <div class="content">
     <p>HI All</p>
<p>&nbsp;</p>
<p>after a little &quot;Time away&quot; (no not prison) I can proudly report that with the support of Calypso rae i managed to get my Mk2i&nbsp;version up and running - keen to move on now and a &quot;functional&quot; issue that i have seen is how the rest of my family now understand the system (yes i&#39;m being poilte)</p>
<p>Can anyone suggest a piece of code that can be integrated into Calypso&#39;s sketches that would, when a momentary switch is pressed, set pin 9 to high for 60 minutes (thus putting the Triac on permanently) and output to an LED until the 60 minutes has elapsed, in addition if the momentary switch is pressed whilst pin 9 is high then it switches it to low (off)</p>
<p>This way i can mount a very small momentary switch to the side of my enclosure and this will ensure that when the family need hot water boosting they don&#39;t get confused as to how to use (and switch off!) the existing arrangement that s a 20A DP switch that bypasses the input and output terminals of the Triac and switches the power onto the immersion manually</p>
<p><span style="font-size: 12px;">any suggestions welcome</span></p>
<p>cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12034"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 11/05/2013 - 14:52.</div>
    <div class="content">
     <p>Can you find two free digital pins?&nbsp; If so, that feature should be straightforward enough to implement.&nbsp;</p>
<p>Rather than relying on millis(), I would use the fact that one hour is 60 x 60 x 50 = 180,000 mains cycles.&nbsp; There is already &#39;long&#39; variable which counts mains cycles, it being <strong>cycleCount</strong>.&nbsp; So you could record this value when the &#39;on&#39; button is pressed, and then turn the triac off when cycleCount has advanced by another 180,000.&nbsp;</p>
<p>An tidier approach might be to define another &#39;<em>long</em>&#39; variable, such as <strong>overrideTimerCount</strong>, and to increment this variable at the same time as cycleCount.&nbsp; When the &#39;on&#39; button is pressed, a <em>boolean</em> flag such as <strong>overrideOn</strong> could be set to <em>true</em>, and overrideTimerCount reset to 0.&nbsp; At the start of each new mains cycle, overrideTimerCount would be incremented and would be found to be less than its maximum value, which is <strong>overrideTimerMaxCount</strong> = 60 x 60 x 50 = 180,000.&nbsp; Eventually the value of overrideTimerCount would be found to be equal to its max value, whereupon the overrideOn flag would be set to false.&nbsp; If overrideTimerCount is only checked/incremented when overrideOn is true, then there will be no complications with overflow.&nbsp;</p>
<p>If the &#39;off&#39; button is pressed, then overrideOn would just be set to <em>false</em>.&nbsp; Whenever overrideOn is <em>true</em>, <strong>triacState</strong> should be set to <em>true</em>, regardless of the state of the energy bucket.&nbsp; This will force the immersion heater to come on.</p>
<p>To avoid switch bounce, you could replicate the code that&#39;s already in Mk2i_rev5a for the existing two switches.&nbsp; Each of the new switches would go straight to ground, and you would need to activate the internal pullup for each pin within setup().</p>
<p>For the &quot;immersion on&quot; LED, maybe you could re-allocate one of the &quot;underflow&quot; and &quot;overflow&quot; ones which are a bit techie!</p>
<p>If you&#39;re still stuck in a few days time, just let me know which version of the code you&#39;re using, and which pins are free, and I&#39;ll put together some code for you.&nbsp; It sounds to be a useful upgrade.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12035"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Sat, 11/05/2013 - 15:12.</div>
    <div class="content">
     <p>Hi</p>
<p><span style="font-size: 12px;">thank you for that</span></p>
<p><span style="font-size: 12px;">ill have a play with a spare board that i have tomorrow and let you know&nbsp;how i get on, but as you know my knowledge of code is poor at best</span></p>
<p><span style="font-size: 12px;">cheers</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12039"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 11/05/2013 - 16:09.</div>
    <div class="content">
     <p>If I were doing this, I would take a version of the code that I want to use (e.g. Mk21_rev5a) and chop it down to the bare minimum.&nbsp; It just needs to detect and count mains cycles.</p>
<p>Then I would declare the new software components and get the new functionality to work.&nbsp; Once it&#39;s all working nicely, the various new parts can be carefully copied across to your target file.&nbsp; A file-comparison utility may be useful, I use <a href="http://kdiff3.sourceforge.net/">Kdiff3</a></p>
<p>Prior to this, I would probably run simple sketch which just reads the value of each switch, and drives an LED.&nbsp; Then the hardware is known to be working.&nbsp; I posted a sketch of this type recently, I think it&#39;s called IO_checker.ino, so it&#39;s probably at</p>
<p><a href="http://openenergymonitor.org/emon/sites/default/files/IO_checker.ino_.zip">http://openenergymonitor.org/emon/sites/default/files/IO_checker.ino_.zip</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12078"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1165" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="richmc&#039;s picture" title="richmc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1165" title="View user profile.">richmc</a> on Sun, 12/05/2013 - 19:54.</div>
    <div class="content">
     <p>Contrary to my post saying I wouldn&#39;t be able to supply the triac boards on their own I will now be able to supply kits for the O/P board with all components for &pound;15 plus &pound;1 P&amp;P, please PM me if interested.</p>
<p>Rich.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12374"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Sun, 26/05/2013 - 08:20.</div>
    <div class="content">
     <p>Robin, could you please ellaborate how tio handle voltageCal on continental europe where VAC is centered around 230 rather than 240. I dont see this very critical as it looks to be used only as triggering threshold but anyway from documentation point of view maybe a clarification could be used.</p>
<p>VOLTAGECAL = (float)679 / 471; // Units are Volts per ADC-level.<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // This value is used to determine when the voltage level is suitable for<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // arming the external trigger device.&nbsp; To set this value, note the min and max<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // numbers that are seen when measuring 240Vac via the voltage sensor, which<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // is 678.8V p-t-p.&nbsp; The range on my setup is 471 meaning that I&#39;m under-reading<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // voltage by 471/679.&nbsp; VOLTAGECAL therefore need to be the inverse of this, i.e.<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // 679/471 or 1.44</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12376"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 26/05/2013 - 09:25.</div>
    <div class="content">
     <p>VoltageCal is only used to determine a suitable moment on the voltage waveform to arm the trigger.&nbsp; As long as the trigger is armed at some time after the voltage has dropped below 20V, the system will work fine.&nbsp;</p>
<p>An alternative approach is to simply delay arming the trigger until, say, the 3rd consecutive sample when polarityNow is negative. &nbsp; Then there is no need to use voltageCal at all. &nbsp; I&#39;ve tried this scheme and it does work, but I can&#39;t remember whether I&#39;ve ever released that code.</p>
<p>My Mk2 design is only interested in Real Power, so I&#39;ve only provided a powerCal parameter.&nbsp; This seemed a better arrangement than calibrating voltage and current independently. &nbsp;</p>
<p>As I&#39;ve said on many occasions, my Mk2 PV Router does not need to be calibrated.&nbsp; To achieve a balance between import and export, the measurement system just needs to be linear.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12377"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Sun, 26/05/2013 - 09:35.</div>
    <div class="content">
     <p>Just studynig the code at spare time and noticed that only imperial voltage references are used which can be confusing without reading the code more in detail&nbsp;;-)</p>
<p>Maybe next I want to figure out possibilities of implementing to Mk2i this old safety margin... but now capacity is 3600J * 50 * (1/powerCal) and cyclesPerSecond does not exist anymore as its interrupts based.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Reduce the level in the energy bucket by the specified safety margin.<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // This allows the system to be positively biassed towards export or import<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; energyInBucket -= safetyMargin_watts / cyclesPerSecond;</p>
<p>&nbsp;</p>
<p>Hmmm...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12378"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 26/05/2013 - 10:29.</div>
    <div class="content">
     <p>I removed the safety margin from later Mk2 versions because it did not seem to be serving any useful purpose.&nbsp; The balance that can be achieved by a Mk2 PV Router is well within the anti-creep limit of most digital meters.&nbsp; While the meter&#39;s LED remains on, then you are clearly not being charged for any imported power.&nbsp; Users in Spain would presumably not wish to introduce a bias towards export because exported power is chargeable.</p>
<p>Analogue meters don&#39;t seem to behave well when the current starts and stops rapidly.&nbsp; This effect can be seen on various videos that I&#39;ve posted.&nbsp; If you have such a meter, and notice a small amount of forward creep while the system is nominally balanced, then you may wish to re-introduce the safety margin.&nbsp;</p>
<p>With integer maths, the energy bucket is no longer calibrated in Joules.&nbsp; But with a bit of thought, you should be able to work out how much to decrement it by every mains cycle.&nbsp; The numerical capacity of the 1 WattHour bucket is determined and displayed to the Serial Monitor during the setup() routine.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12386"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Sun, 26/05/2013 - 15:43.</div>
    <div class="content">
     <blockquote><p>I removed the safety margin from later Mk2 versions because it did not seem to be serving any useful purpose.&nbsp; The balance that can be achieved by a Mk2 PV Router is well within the anti-creep limit of most digital meters.&nbsp; While the meter&#39;s LED remains on, then you are clearly not being charged for any imported power.&nbsp; Users in Spain would presumably not wish to introduce a bias towards export because exported power is chargeable.</p>
</blockquote>
<p>Yes, think have heard this already - anyhow for testing purposes a constant load that can be seen on a standard plugin electricity meter would be a reason to have this. Normal plugin type electricity meters do not show negative values. (Of course difficult to say what is the bucket size for a plugin meter and if there are other )</p>
<p>About powerCal, I guess its just the PV power (less inverter inefficiency) that counts. With PV systems of couple of hundreds of Watts dont see any reason to have more than 1kw range and then ensure with some clamping zeners that voltage does not get over 3V. This anyhow made me think about emonTX design: If&nbsp;sensitivity is changed with a burden then the clamping must happen just before the AD input pin ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12390"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 26/05/2013 - 16:50.</div>
    <div class="content">
     <p><em>About powerCal, I guess its just the PV power (less inverter inefficiency) that counts.&nbsp; </em></p>
<p>No.&nbsp; The Mk2 PV Router measures the net flow of energy (i.e. surplus power) at the supply point.&nbsp; This is the difference between the power that is being consumed and generated on your premises.&nbsp; The generated value is what comes out of your inverter - the efficiency of the inverter is not relevant to the calculation.</p>
<p>powerCal is the ratio between &quot;real power&quot; and the value that&#39;s calculated by the measurement system.&nbsp; To find the actual amount of surplus real power, you take the calculated value and multiply it by powerCal.&nbsp;</p>
<p>An alternative approach might be to measure your consumption and generation values separately, and then calculate their difference in order to quantify any surplus power.&nbsp; This is how the <a href="http://openenergymonitor.org/emon/applications/solarpv">OEM Solar Monitor system </a>works.&nbsp; But when the sole purpose of the equipment is to divert surplus power, I think it&#39;s best to measure in just one place, next to the meter.&nbsp; That&#39;s why the Mk2 PV Router works in this way.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12393"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Sun, 26/05/2013 - 18:23.</div>
    <div class="content">
     <p>Ahh - I was talking in the context of CT resolution need. If the purpose is to avoid pushing excess energy to the grid then the AD resolution maybe should be calculated based on PV generation to maximize operation? In opposite case the bucket is well empty before ? For testing this low power level accuracy also a reintroduction of safety margin could be beneficial.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12401"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 27/05/2013 - 08:43.</div>
    <div class="content">
     <p>Sorry, Petrik, I&#39;m not sure what point you&#39;re making.&nbsp; The measurement system needs to be scaled so as to record correctly the net flow of energy under all situations while power is being diverted.&nbsp; This means the greater of the PV rating and the dump-load rating.&nbsp;&nbsp; If you have a 2 kW PV system and a 3 kW dump-load, it&#39;s important that the system can measure 3 kW without hitting the limits of the ADC.&nbsp; Otherwise there will be problems when surplus power is at a minimum.</p>
<p>My comments about <strong>voltageCal</strong> yesterday were not correct.&nbsp; Although the triac comes on at the <strong>-ve going</strong> zero-crossing point, the trigger needs to be armed within the <strong>+ve half</strong> of the preceeding cycle.&nbsp; The only requirement is that this must not occur until the voltage is at least 20V beyond the z/c point.</p>
<p>In Mk2i_rev5a, the trigger is armed when:&nbsp;&nbsp;&nbsp; <strong>if(sampleVminusDC_long &gt; triggerThreshold_long)&nbsp;</strong> is true.</p>
<p>This line could safely be replaced by:</p>
<p><strong>if(samplesDuringThisCycle == 3)</strong>&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>The number 3 is not important.&nbsp; Anything between 2 and 20 will be fine.&nbsp; The number 1 would sometimes not work because the voltage would not yet be 20V beyond the z/c point.&nbsp; Having replaced this line as above, voltageCal can be safely removed.</p>
<p>The same measure could be usefully applied to earlier Mk2 builds.&nbsp; In <strong>Mk2_PV_Router_mini_3.ino</strong>, the line</p>
<p><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if((sampleVminusDC * VOLTAGECAL) &gt; 30) // 20V min for Motorola trigger</strong></p>
<p>
	could simply be replaced by</p>
<p><strong>if(samplesDuringThisCycle == 3)</strong><br />
	&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12408"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Mon, 27/05/2013 - 16:43.</div>
    <div class="content">
     <p>Let me try with practical info about burden for scaling AD. My PV is 1kwp, burden load is 1kw, baseline, average loads during daytime vary between 250-750w and maximum ever noticed is 8kw when heating, washing machine and water boiler are on. All this on one phase. Stock emonTx&nbsp;CT burden resistor is scaled for 50A where as the feeling would say that 16A&nbsp;optimized burden resistor for CT ould be plenty with three times more resolution. (just thinking aloud while putting the next test rig together.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12409"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 27/05/2013 - 18:30.</div>
    <div class="content">
     <p>Remember that a current transformer is a current source, and if you increase your burden resistor beyond the VA rating of the c.t., you will overload it with a dramatic increase in phase and amplitude errors. You need to faithfully capture the waveform at the peak current in either direction while your dump load is operating; otherwise you will not measure the power flow accurately and the router will not be able to achieve a perfect balance.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12410"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Mon, 27/05/2013 - 18:48.</div>
    <div class="content">
     <p>The way I understand this isthat after 3600j the bucket is empty when energy is flowing to the grid. To reach the balance in my case a bit over 1kw would do. After that phase and amplitude errors do not really matter as all I need to know that I am exporting to the grid (and bucket is empty). What matters is resolution betweekn -1kw to +1kw.. What am I thinking incorrectly ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12414"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 27/05/2013 - 20:49.</div>
    <div class="content">
     <p>When the bucket is empty, or when the bucket is overflowing, the router is no longer in control and accuracy and linearity are unimportant.&nbsp; In between, when the router is in control, energy flow into and out of the bucket is balanced - energy, the product of power and time, is balanced but the power and hence the current in each direction might be vastly different. It is those currents that must be accurately measured. If your dump load is 1 kW, then a linear range that is a little over 1 kW should be enough - but you must protect your inputs against overvoltage in the event of a fault downstream of the c.t. that could cause a very high transient voltage to appear on the output of the c.t.&nbsp; (That is because when the c.t. is saturating, the flux remains approximately constant for a large part of each half cycle, then changes rapidly as the current switches polarity, and secondary voltage is proportional to the rate of change of flux.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12444"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="sgm&#039;s picture" title="sgm&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by sgm (not verified) on Wed, 29/05/2013 - 10:31.</div>
    <div class="content">
     <p>This may be of use to Leonardo users,</p>
<p>I have just found the issue after a few frustrating hours trying to change from the original Mk2&nbsp;software, and now have the Mk2i&nbsp;fully functioning.</p>
<p>after trawling through the code I found the Analogue pins at low level are mapped differently compared with the UNOs</p>
<p>A1= ADC1 on the Uno and =ADC6 on the Leonardo</p>
<p>A2= ADC2 on the Uno and =ADC5 on the Leonardo</p>
<p>Just altered the pin assignments and hey presto!</p>
<p>perhaps the code comments could refer to the ADC numbering rather than physical pin numbers?</p>
<p>-no issues with print statements although I put a 10 sec start delay if I want to use the serial monitor.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12446"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 29/05/2013 - 10:56.</div>
    <div class="content">
     <p>The build instructions specifically state &quot;Arduino Uno&quot;. If you use a different platform, or divert from the original design in any other way, it is up to you to check that you have modified the design of both hardware and software accordingly.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12447"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Wed, 29/05/2013 - 14:31.</div>
    <div class="content">
     <p>Thanks for clarifying the burden/resolution question. </p>
<p>Just came off from phone with the local electricity provider. He said that our new three phase electricity meter takes a sum of each of the phases so if one is generating and two is consuming then meter sees a sum of these three elements together. This is a good thing but creates some gray hair how to utilize this with mk2i which has been designed as one phase system only ? Any comments ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12451"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 29/05/2013 - 16:30.</div>
    <div class="content">
     <p>Yes, we know that at least some 3-phase meters work that way (see the Energy Meters article in Building Blocks). I believe MartinR is using, and Noah is thinking of using, a 3-phase router, but I have no details other than what you might find elsewhere in these forums.&nbsp; Robin designed the Mk 2 as a single phase system because like almost every other home in the UK, he only has a single phase supply.</p>
<p>In terms of a solution, MartinR&#39;s 3 stacked emonTx&#39;s is clearly a neat solution and allows a fast sample rate on each phase (which could be a problem with trying to read all 3 phases with one ATmega328). The &quot;energy bucket&quot; needs to receive contributions from all 3 phases, it should work with only one dump load - presumably connected to the phase that is most lightly loaded - but it might be possible to have a smaller dump load on each phase and use them together or in any combination.</p>
<p>Robin is away on a training course for 2 weeks, I expect he will comment on his return. When you discover the size of the &quot;Energy Bucket&quot; of your meter, let me know and I will add the details to the Energy Meters page.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12455"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1824" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1824" title="View user profile.">MartinR</a> on Wed, 29/05/2013 - 19:20.</div>
    <div class="content">
     <p>Some details on my 3-phase system...</p>
<p>As Robert said, I have <a href="http://openenergymonitor.org/emon/node/1170">3 stacked emonTXs</a>, connected via I2C interface. They each calculate the energy per cycle for one phase. One emonTX is designated as master and it requests the cycle energy for the other 2 phases at the end of its own cycle. The 3 energy values are added to the energy bucket and from that point on it behaves just like a single phase system.</p>
<p>One complication is that you can&#39;t just add the raw, unscaled data into the energy bucket as you can for&nbsp;a single-phase system since the scale, or calibration, will be different for each phase, you have to equalise them first.</p>
<p>On the output side, it doesn&#39;t matter which phase your dump load(s) is/are on since they all affect the energy bucket in the same way. I heat up my 3 immersion heaters in turn and then pump any excess into my floor heating. For the latter I dump into each phase in turn as this reduces the flicker frequency by a factor of 3.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12473"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Thu, 30/05/2013 - 17:38.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Maybe 3 phase system does not need to be exact. I dont mind if there is some energy consumption from the grid but when the kettle or microwave is on on phase 2 while phase 1 shows excess there is no reason to shoot the energy to the dump load hot water tank. Maybe the easiest solution would be just adding the two other phases as safety margin was there earlier ? This way one emontx with one transformer and three CT:s could work close enough. Adding two more emontx and related ct:s and teansformers is too much, in my cabinet there is already 2 emontx:s + nanoderf stacked ;-) thos just before adding robins mk2i.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12474"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 30/05/2013 - 20:09.</div>
    <div class="content">
     <p><em>&quot;when the kettle or microwave is on on phase 2 while phase 1 shows excess there is no reason to shoot the energy to the dump load hot water tank.&quot;</em></p>
<p>If the three phases all contribute to the &quot;energy bucket&quot;, then that will not happen. The load can be connected to any phase and it will be controlled by the overall energy flow.</p>
<p><em>&quot;one emontx with one transformer and three CT:s&quot;</em></p>
<p>If the voltages on the three phases are always accurately balanced, then again 3 c.t&#39;s (and using one real voltage and delaying it twice for the other two phases) might give results that are &#39;good enough&#39;.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12475"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Thu, 30/05/2013 - 20:34.</div>
    <div class="content">
     <p>;-) of course voltages are not always the same as load is not balanced in a normal household, anyhow what i recall from measuring we are talking about 1-3volt differences which means 1% avg - not really significant.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12478"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1824" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1824" title="View user profile.">MartinR</a> on Fri, 31/05/2013 - 12:06.</div>
    <div class="content">
     <p>If your supply is that good you should get some reasonable results. Here, out in the sticks in the UK, I regularly see more than 10V difference between phases so more error than I&#39;m happy with.</p>
<p>You&#39;d be best off using an emonTx for&nbsp;the solar diversion&nbsp;as it already has the 3 CT inputs and it could probably just be one of the emonTxs you already have so would save some space if that is an issue.</p>
<p>This would be a good application for a phase-locked loop since if you chose the samples per cycle to be a multiple of 3, say 48 (which is just possible with 3 CTs) then you could estimate the voltages of the other phases simply by&nbsp;using the 17th and 33rd samples as the first sample for phases 2 and 3 respectively.<strike> You wouldn&#39;t need to save and replay the waveform as emonTx_CT123_3Phase_Voltage does.</strike></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12481"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 31/05/2013 - 11:41.</div>
    <div class="content">
     <p><em>&quot;You wouldn&#39;t need to save and replay the waveform as emonTx_CT123_3Phase_Voltage does.&quot;</em></p>
<p>In that respect, how is a PLL different to the standard unsynchronised emonlib. Can you explain that?</p>
<p>&nbsp;</p>
<p>(I don&#39;t think Petrik has a particularly solid supply, isn&#39;t it just that he is very lightly loading it with only 1 kW max load? If it&#39;s 3 V dip with 8 kW load, that&#39;s a different matter - but still not all that solid, about 600 kVA fault level. Robin&#39;s Mk 2 can measure the supply fault level, and so can yours, of course.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12482"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1824" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1824" title="View user profile.">MartinR</a> on Fri, 31/05/2013 - 12:05.</div>
    <div class="content">
     <p><em>Can you explain that?</em></p>
<p>No I can&#39;t :) Note to self: don&#39;t make posts on your way out in the morning without thinking them through first!</p>
<p>Obviously you&#39;d still need to know what the voltage had been at the same point in the measured waveform so you would still have to save at least 32 samples. There might be some benefit that you&#39;d more accurately know the phase of each sample but I&#39;m clutching at straws here.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12483"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Fri, 31/05/2013 - 12:22.</div>
    <div class="content">
     <p>Local national gris code says the voltage must be all the time between 195-253V but in reality when living around 3 miles from local powerplant havent seen anything else than between 227-233. Havent really monitored this but recall from apc ups datalogs. Maximum load in this house is around 8kw per phase which i have seen on emonglc totalling up to around 13kw. The big loads are more or less symmetric here like 3phase boiler and central heating, very seldom 1 phase devices exept in remote cottages. Grid has been built bearing in mind the heating needs of a -30C winter day when everyone is cooking turkey in oven.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12485"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 31/05/2013 - 14:11.</div>
    <div class="content">
     <p>MartinR:</p>
<p>[Been there, done that <img alt="sigh" src="http://s.codeproject.com/script/Forums/Images/smiley_sigh.gif " style="width: 16px; height: 16px;" /> ]&nbsp; But as you have correctly identified, the PLL with the number of samples an exact multiple of 3 does have a number of advantages, not the least being that given identical c.t&#39;s, PHASECAL should be the same for all 3 channels (though there will still be a current-dependent phase shift that you can do very little about) and that means that the phase correction can be applied once before the samples are stored, which should help with the processor load.</p>
<p>Petrik:</p>
<p>If your supply is well balanced, then Martin&#39;s suggestion of 1 emonTx with 3 c.t&#39;s; and in the sketch merge the arrays out of <em>emonTx_CT123_3Phase_Voltage</em> into his (or Robin&#39;s) PLL sketch with the energy from all 3 phases feeding into the one energy bucket does seem to be the most economical solution.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12552"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="GTEC&#039;s picture" title="GTEC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by GTEC (not verified) on Mon, 03/06/2013 - 13:59.</div>
    <div class="content">
     <p>Hi All</p>
<p>&nbsp;</p>
<p>I&#39;ve been away again and I&#39;m afraid that i got distracted by wanting to know what was going on in my Hot water store (a&nbsp;500 Litre&nbsp;stratified store) and i got hooked on the actual monitoring side of things - please&nbsp;see this link&nbsp;</p>
<p><a href="https://xively.com/feeds/126629 " title="https://xively.com/feeds/126629 ">https://xively.com/feeds/126629 </a></p>
<p>The sensors (DS18B20) are mounted at the top (Temperature 1), then 350 mm intervals to the bottom of the tank (Temperature 5)</p>
<p>You can readily see what is going on and when the immersion kicks in so it makes for interesting reading&nbsp;</p>
<p>I&#39;ll be refocusing on the Mk2i next weekend and getting some data out of that one as well (if i can)&nbsp;</p>
<p>Thanks to everyone for a fantastic website and loads of help and good ideas that have come from it</p>
<p>Cheers&nbsp;</p>
<p>Griff Thomas</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12554"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1704" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Keith Walker&#039;s picture" title="Keith Walker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1704" title="View user profile.">Keith Walker</a> on Mon, 03/06/2013 - 14:22.</div>
    <div class="content">
     <p>Hi Griff,</p>
<p>Your link doesn&#39;t work for me.&nbsp; It&#39;s&nbsp;starts with&nbsp;https://&nbsp; Is it a logged in user account?</p>
<p>Cheers, Keith</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12560"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 03/06/2013 - 15:18.</div>
    <div class="content">
     <p>The link works for me (now?).</p>
<p>Griff: You might not have seen these threads:&nbsp; <span class="field-content"><a href="http://openenergymonitor.org/emon/node/2422">External immersion heaters</a></span> and <span class="field-content"><a href="http://openenergymonitor.org/emon/node/2430">How about energy storage</a></span>&nbsp; There could be some ideas there for you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12589"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Tue, 04/06/2013 - 09:03.</div>
    <div class="content">
     <p>Hi Griff,</p>
<p>&nbsp;</p>
<p>I&#39;ve something similar on my store. 7 sensors vertically up the tank and one on cold input and another on mixed DHW out.</p>
<p>From that I can calculate an approximate volume of useful DHW at the tap and display that at various locations. Nothing online yet - that is work in progress.</p>
<p>Next job is to dump the date to an SD card and maybe then onto the web.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13077"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 18/06/2013 - 22:45.</div>
    <div class="content">
     <p>When doing a Tallymode run recently using Mk2i_rev5a, the numbers didn&#39;t look right.&nbsp; There was still an offset which was dependent on the size of the tallies.&nbsp; I believe I&#39;ve finally solved this long-running bug, the problem being in the routine, <em>tallymode_updateData()</em>.&nbsp; This code is now simpler and looks right, and the new version appears to pass all the tests I can throw at it.&nbsp; With no current flowing at the CT, the resulting values that I&#39;m seeing are firmly bunched around zero Watts, regardless of the size of each tally or where the zero point lies in the operating range.&nbsp; This new version is attached as <strong>Mk2i_rev5b</strong> (or Mk2i_PV_Router_rev5b, to give it its full name).</p>
<p>Mk2i_rev5 had several changes from the rev4 version, probably too many.&nbsp; There was the introduction of multiple loads, and&nbsp; the capability of controlling one of these loads remotely, via an RF link.&nbsp; I also altered the AF logic to a new scheme which lends itself to a multi-load setting and which doesn&#39;t require calibration.&nbsp; Just before releasing this code, I added a flag so that the code would still run without the RFM12B module being present.&nbsp; Although not actually required when this flag is inactive, remnants of the RF unit&#39;s code are still executed, and the Jeelib header file is still #included.&nbsp; This is not an ideal situation if the RF unit is not actually being used.</p>
<p>Although rev5 does work both with and without the RF unit, it would be difficult now to separate the various features which have been combined together in this build.&nbsp; For example, it&#39;s not currently possible to run the original 2-threshold AF scheme with multiple loads.&nbsp; Having said which, that combination would not be without its difficulties.&nbsp; With twin-thresholds, if one load fails to have the desired effect, there&#39;s very little time to switch a second load.&nbsp; The new AF logic in rev5 overcomes this limitation by switching each load on or off sooner, thereby allowing more time for a subsequent load to be brought into play.</p>
<p>I also intend to fix the Tallymode code in Mk2i_rev4, and will release this as Mk2i_rev4b.&nbsp; This will incorporate the rev5 -&gt; rev5a change which was to prevent the output stage being active during the start-up period.&nbsp; Mk2i_rev4b will have no reference to the RF module and will retain the original 2-level AF logic, but it won&#39;t support multiple loads.</p>
<p>With a bit of thought, it should be possible for constructors to mix and match the various components from these two baselines.&nbsp; For a fast version of the code that doesn&#39;t use interrupts, <strong>Mk2a_PV_Router_rev3</strong> is a good choice (but the Tallymode routine will still have a small error).&nbsp; Or for a simple version that uses analogRead() and floating-point maths, <strong>Mk2_PV_Router_mini_3</strong> is the one to go for.</p>
<p>There are links to all of these builds at <a href="http://openenergymonitor.org/emon/node/1757" title="http://openenergymonitor.org/emon/node/1757">http://openenergymonitor.org/emon/node/1757</a> (when I get around to updating it!)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13085"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Wed, 19/06/2013 - 05:01.</div>
    <div class="content">
     <p>I have been successfully running the PV router for the past couple of months using the mini_3 sketch and on average producing about 10 kW per day. I know need to take this a step further and move the connection to a remote heater with rd modules (rfm12b). My question is what hardware do I need. I am currently using the Arduino&nbsp;Uno and the complete kit from RichMC of this forum. I am guessing that I will need the rf&nbsp;unit at the base station and relocate the triac board into the remote station along with another Arduino Uno and another rf&nbsp;module (rfm12b). Maybe there is an easier and cheaper way of reaching my goal? Also, what sketch will I need to run this setup. Many thanks.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13094"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 19/06/2013 - 16:11.</div>
    <div class="content">
     <p>You need to equip the &quot;controller&quot; (which is the processor and the measurement front end feeding it) with a radio module, then you need to equip the &quot;switch&quot; (which is separate processor with the triac on its output) with another radio module. Plus another power supply - the switch only needs 5 V d.c. You might find it easier to use an emonTx instead of a Uno and RFM12B in the switch - just change the series resistor feeding the opto-isolator for a slightly lower value to account for the 3.3 V drive to it.</p>
<p>For sketches, the Mk2i_rev5 (with priority set to the remote load, though it would automatically use the remote load anyway if there wasn&#39;t a local one) and the RF_for Mk2_rx should do what you want.</p>
<p>The cheaper way would be to run a twisted pair of &quot;telephone&quot; wire between the controller and the switch. In this case the switch is just the opto-isolator, triac and heatsink. All you&#39;re doing is driving a LED - no radio modules, no second processor, no second power supply.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13096"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 19/06/2013 - 16:38.</div>
    <div class="content">
     <p>thewaver:&nbsp; If you want to use a standard Mk2 build with RF capability, then it will have to be a variant of Mk2i_rev5.&nbsp;&nbsp; The version that I released yesterday - <a href="http://openenergymonitor.org/emon/sites/default/files/Mk2i_PV_Router_rev5b.ino_.zip">Mk2i_PV_Router_rev5b.ino</a> - would be fine.</p>
<p>At the base-station end, you would need to add an RFM12B module along with dropper resistors to convert the 5V signals from the Arduino into the 3.3V ones that the RF unit uses.&nbsp; The diagram for this adapter circuit is on the first of the <a href="http://openenergymonitor.org/emon/buildingblocks/rfm12b-wireless">Networking Building Block pages</a>; the completed assembly can just plug straight into the Uno&#39;s connector strip.&nbsp; When testing your RF link, a pair of simple sketches are available; the link is on the same BB page just below the adapter circuit diagram, in &quot;Software&quot;.</p>
<p>For the remote end, you&#39;ll need some kind of AT386-type processor and another RF unit.&nbsp; The cheapest way to achieve this may well be with an emonTx unit that already contains an RFM12B.&nbsp; Rather than buy the complete kit, you may be able to save a few pounds by just getting the bits that you actually need: PCB, processor &amp; crystal, plus the RF unit and a handful of passive components.&nbsp; To program this, you&#39;ll also need a programming adapter and M-&gt;F USB cable - and a certain amount of patience.&nbsp; Another Arduino, with an identical RF adapter, may be an easier solution for you.</p>
<p>As noted at the top of the Mk2i_rev5 code, the associated sketch for the receiving end is:&nbsp;&nbsp; <a href="http://openenergymonitor.org/emon/sites/default/files/RF_for_Mk2_rx.ino_.zip">RF_for_Mk2_rx.ino</a><br />
	&nbsp;</p>
<p>PS.&nbsp; I&#39;ve just seen Robert&#39;s reply which seems to be giving much the same info, but more succinctly!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13100"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 19/06/2013 - 19:53.</div>
    <div class="content">
     <p>The Tallymode fix is now available in the Mk2i_rev4 code as Mk2i_PV_Router_rev4b, as attached.&nbsp; The results now look much better than before.&nbsp; When no current is flowing, there&#39;s no offset; the numbers are closely bunched around 0 Watts.&nbsp;</p>
<p>I always felt that something wasn&#39;t quite right with Tallymode numbers but didn&#39;t get around to fixing it until yesterday.&nbsp; Sorry for any inconvenience caused.&nbsp;</p>
<p>(For completion, I&#39;ve also upgraded the Mk2a line too.&nbsp; This now displays the&nbsp; power values in Watts, rather than in tally numbers, which is much easier to use.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13142"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Sat, 22/06/2013 - 06:08.</div>
    <div class="content">
     <p>Thanks for your reply. I like the idea of having a second Arduino&nbsp;and a second rf unit for the remote end, this seems the easiest and simpler solution. What sketch would be used for the remote end ?, Also, would I not need a triac&nbsp;to drive the heater and a separate 12v supply to drive the remote&nbsp;Arduino. Lastly, it would take a lot of work to run a cable to the remote heater which is why I am having to go down the rf route.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13145"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 22/06/2013 - 13:04.</div>
    <div class="content">
     <p>thewaver: as posted earlier, the sketch for the remote end is&nbsp; <a href="../sites/default/files/RF_for_Mk2_rx.ino_.zip">RF_for_Mk2_rx.ino</a></p>
<p>If you can&#39;t easily run a cable to the remote load, then you will indeed need a power supply for the remote processor which terminates your RF link.&nbsp; You will also need a trigger + triac circuit at the remote end.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13248"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="ljfaragher&#039;s picture" title="ljfaragher&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by ljfaragher (not verified) on Wed, 26/06/2013 - 13:58.</div>
    <div class="content">
     <p>For those wishing to add RF , take a look at <a href="http://jeelabs.net/projects/hardware/wiki/JeeNode">Jeenode</a>.&nbsp;&nbsp; I&#39;m working on a pcb module to add the Voltage ref, CT&nbsp;, AC ref, ZCD triac driver and triac.&nbsp; Just populate whichever end you need (TX or RX) or both if driving a local load hardwired.&nbsp; It&#39;s a way away yet.</p>
<p>For those wanting to add RF to an existing 5v Arduino project, take a look at <a href="http://jeelabs.net/projects/hardware/wiki/RFM12B_Board">RF breakout board </a>that includes the 5v to 3.3v conversion.</p>
<p>This is from the guy who wrote the RF12 library as used in Emon etc. which is included in JeeLib.h.&nbsp; His board have smd layout to solder the RF12 pcb if required.</p>
<p>He has loads of other plug in modules.&nbsp; All open source or you can buy the pcb&#39;s or kits.&nbsp;&nbsp; I&#39;ve currently got 10 jeenodes in development on 433mhz and 866mhz..&nbsp;&nbsp; You can also buy<a href="http://jeelabs.net/projects/hardware/wiki/JeeLink"> jeelink </a>with built in RF to send and receive from your PC.</p>
<p>You just need an FTDI adapter for connect usb to a jeenode.&nbsp; <a href="http://www.ebay.co.uk/itm/320907184616?ssPageName=STRK:MEWNX:IT&amp;_trksid=p3984.m1439.l2649">Right angle </a>or<a href="http://www.ebay.co.uk/itm/281108437391?ssPageName=STRK:MEWNX:IT&amp;_trksid=p3984.m1439.l2649"> straight </a>depending upon your 6 pin connector orientation.&nbsp; You can pay more for the &quot;Arduino usb serial light&quot;&nbsp; or you can buy a<a href="http://jeelabs.net/projects/hardware/wiki/JeeNode_USB"> jeenode usb</a>&nbsp;with the usb connector built in.</p>
<p>I had completed a completed MK2 stand alone PCB design (Atmega chip onboard and no use for an arduino board) when I came across jeelabs and started again from scratch..</p>
<p>Laurence</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13387"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3677" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="morris8cars&#039;s picture" title="morris8cars&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3677" title="View user profile.">morris8cars</a> on Thu, 04/07/2013 - 10:50.</div>
    <div class="content">
     <p>Hi&nbsp;&nbsp; Pleased to report another MK2i rev 5b PV Router fully operational..well done Robin &amp; thank you for assisting in the RF code problem you PM&#39;d me. Although I am using twisted pair to the primary Immersion switch I intend to use RF for secondary. Just waiting for the RFM12B&#39;s to arrive. Anyone found a source for 1/2 wave 433mhz whip stub aerials at reasonable cost or alternative coil aerial that has been used within case.</p>
<p>I am really interested in the proposed useful addition that was mentioned by GTEC and Robin on the 11/5/12 for the override function. Did any code get done or is in the wings?<br />
	Robin, I know you said it should be easy using 2 digital pins but using the RF modules means these are occupied but I believe analogue pins can be used also. I think this would be useful for use at either outputs. Any assistance greatfully received as I&#39;m not good at coding</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13394"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 04/07/2013 - 14:22.</div>
    <div class="content">
     <p>To use your spare analog pins as digital drivers, the all-important thing you need to know is that the numbering for these pins follows straight after the digital ones.&nbsp; So, analog 0 is &quot;pin 14&quot; and analog 5 is &quot;pin 19&quot;.</p>
<p>The attached sketch blinks one digital pin and one analog one :)</p>
<p>PS. If driving an LED, don&#39;t forget the series resistor to limit the current!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13395"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 04/07/2013 - 14:02.</div>
    <div class="content">
     <p>To force the immersion to come on manually, the easiest approach is just to wire a mains switch into the Line (brown) conductor in parallel with the triac.&nbsp; This is how my own system works as featured in several videos.&nbsp; When either of them is on, the immersion heater will receive power.</p>
<p>Providing an over-ride function from within the code is a little more involved.&nbsp; You first need to de-bounce the input as I&#39;ve done for the pair of switches that are used in my Mk2i rev4 and rev5 code.&nbsp; Once the new state of the switch has been reliably detected, it&#39;s then entirely straightforward to force the triac to stay on.&nbsp;</p>
<p>In the rev_4 code, just replace the normal logic by &nbsp; nextStateOfTriac = TRIAC_ON.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13510"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Mon, 08/07/2013 - 15:43.</div>
    <div class="content">
     <p>Hi,</p>
<p>How critical is mk2i for transformer ?</p>
<p>For emonTX/measuring power I understand the need for minimum phase shift etc but for mk2i its measuring bucket so at first thought transformer does not make so big difference ?</p>
<p>Maybe a din rail mount 8VAC EC approved transformer (or maybe 12VAC with diferent R1/R2 ratio) would be much more tidy install.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13511"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 08/07/2013 - 16:13.</div>
    <div class="content">
     <p>Robin has found that phase shift has very little influence on the action of any of the Mk2 controllers - probably because the load when the controller is operating is close to unity power factor anyway where a phase shift makes little difference. Obviously, if there is a very large phase shift, you might find that there is enough error to cause either a charge or export, if it is not corrected with phaseCal.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13648"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Tue, 16/07/2013 - 14:43.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>This may be helpful in case someone else builds mk2i using EmonTX</p>
<p>/*</p>
<p>// Original Pin settings</p>
<p>const byte outputModeSelectorPin = 4;&nbsp;&nbsp; //&nbsp; for normal or anti-flicker mode<br />
	const byte loadPrioritySelectorPin = 5; //&nbsp; local or remote load to have priority<br />
	const byte underflow_LED = 6;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // non-essential, may have to be axed.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	const byte overflow_LED = 7;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	const byte surplusPV_LED = 8;&nbsp;&nbsp;<br />
	const byte physicalLoad_0_pin = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // for trigger (active low)<br />
	*/</p>
<p>// Pin settings for emonTx without switches etc...</p>
<p>// digital input and output pins<br />
	const byte LED_detectorpin = 6; // No meter input in use<br />
	const byte outputModeSelectorPin = 4;&nbsp;&nbsp; //&nbsp; for normal or anti-flicker mode<br />
	const byte loadPrioritySelectorPin = 5; //&nbsp; local or remote load to have priority<br />
	const byte underflow_LED = 7;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	const byte overflow_LED = 8;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	const byte surplusPV_LED = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // onboard led<br />
	const byte physicalLoad_0_pin = 3;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Pulse input plug for trigger</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13652"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 16/07/2013 - 16:19.</div>
    <div class="content">
     <p>There&#39;s a picture of the emonTx with all I/O labelled, under Modules &gt; emonTx</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14371"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Fri, 16/08/2013 - 07:38.</div>
    <div class="content">
     <p>Hi, I am ready to start this project and have ordered the arduino board and was going to order 2 x rfm12b but had a thought, can the rfm12b be set for transmit and recieve&nbsp;?</p>
<p>Is there a time lag of any significance between excess detection and firing the triac with the rfm12b setup.</p>
<p>Is it &nbsp;possible to have a hard wired device for excess soakage and when this is satisfied, it moves over to a secondary soakage device which is rfm12b controlled ?</p>
<p>Thxs Don....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14372"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 16/08/2013 - 07:57.</div>
    <div class="content">
     <p>Don, interesting questions.&nbsp; When surplus power is being diverted, one can never know when the next on/off message will appear.&nbsp; If a second transmitter is within range, there would always be the danger of a collision which could adversely affect the primary operation of the system, which is to divert surplus power reliably.</p>
<p>Is there any time lag? The simple answer is no.&nbsp; There&#39;s already a 10mS delay between an on/off decision being taken and implemented.&nbsp; The RF link delay is generally less than this.&nbsp; It all depends on what else the receiver has to do.&nbsp; If it&#39;s busy doing something else, then it may take a while to get around to processing the RF message.&nbsp; But if it&#39;s just sitting there waiting for the next message to appear, as per the receiver sketch that I&#39;ve posted, the end-to-end RF-link delay will only be a few mS.</p>
<p>The answer to your final question is &quot;yes&quot;.&nbsp; That&#39;s exactly how my rig at home was set up.&nbsp; My primary load has always been the DHW immersion heater which is hard-wired.&nbsp; Any secondary load has been RF controlled, as per <a href="http://www.youtube.com/watch?v=TTgZxkW1sB8">my video of a storage heate</a>r.&nbsp; Several other people have adopted this approach too.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14378"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Fri, 16/08/2013 - 10:48.</div>
    <div class="content">
     <p>Hi,</p>
<p>Thank you for your informative reply. I think that I didn&#39;t explain myself to well in the first question. For the base station, do I use a RFM12B to transmit the data and at the remote slave module, do I use another RFM12B&nbsp;to receive the transmitted data. I am assuming that the RFM12B can be set to either transmit data, or receive data.&nbsp;</p>
<p>Also, it there any circuit diagrams of your Mk5 station with the transmitter and the slave module with the receiver. I can only seem to find bits of circuits, not complete diagrams.</p>
<p>Thxs Don...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 16/08/2013 - 14:12.</div>
    <div class="content">
     <p>Don,</p>
<p>The RFM12B module is &quot;half-duplex&quot; - it can both transmit and receive, but not at the same time. The GLCD does exactly this - receives data from the emonTx (energy) and the base (time) and transmits back the inside temperature.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14384"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Fri, 16/08/2013 - 14:40.</div>
    <div class="content">
     <p>
	Been running mk2i for a month now, flawless as we all know. Sometimes I do think that the mk2i would be even more&nbsp;purrrfect&nbsp;if diverted power could be calculated and value transmitted over using RFM12B (duty cycle % * dump load W) &nbsp;just to know how much power has been diverted.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14386"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 16/08/2013 - 15:03.</div>
    <div class="content">
     <p>Petrik,</p>
<p>In general, if you are using an immersion water heater, that&#39;s not possible without measuring the current. You cannot know when the thermostat has overridden the controller, so it is impossible to calculate the diverted power.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14389"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Fri, 16/08/2013 - 16:36.</div>
    <div class="content">
     <p>I hate to disagree with you Robert but it is possible to use the overflow and underflow leds (or their equivalent in the software) to determine if the stat has opened and also when there is insufficient PV to dump any power at all.</p>
<p>&nbsp;</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14390"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Fri, 16/08/2013 - 18:35.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Maybe its just possible to focus at divert duty cycle (like in martins scritp) to determine export and after that to check the condition for thermostat.</p>
<p>I agree with Bop that there is several ways of figuring out the thermostat state - but it all starts&nbsp;by modifying mk2i script to allow duty cycle % monitoring and report that using rmf12b if you guys feel its part ot this excerisise.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14391"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 16/08/2013 - 19:39.</div>
    <div class="content">
     <p>9fingers:</p>
<p>True - but only if the load exceeds the generation capacity. Otherwise, it can still overflow and still be dumping energy. There&#39;s no general failsafe method that will be applicable in all circumstances, short of actually measuring it.</p>
<p>Martin did it by feeding temperature into the controller, so his thermostat never opened - the diversion didn&#39;t happen when his water was up to temperature, so that&#39;s why his sketch could calculate diverted energy/power.</p>
<p>So you can always know the energy available to be diverted, but that is not guaranteed to match the actual energy diverted.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14392"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Sat, 17/08/2013 - 05:46.</div>
    <div class="content">
     <p>At least in my case it would be fairly easy to detect that when diverter is on the energy bucket is constantly emptied in 100ms (powercal). If diverter is not on then energy bucket is always filled to max. There may be rare co-incidental moments when bucket is emptied because of bormal load being increased but not significant in the quantity of bucket changing from full to empty.</p>
<p>In practise&nbsp;a good enough method to determine load state (knowing that is really on all the time) is just to check that the frequency the bucket is emptied is constant . Anyway I am less worried about load state as its on most of the time anyway.</p>
<p>Of course implementing anything like this is a matter of preference and need. Also I could do it but dont want to start yet another fork to be maintained, therefore presenting this merely an idea to be considered.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14395"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Sat, 17/08/2013 - 09:13.</div>
    <div class="content">
     <p>I stand corrected Robert. My dump load is greater than my PV capacity&nbsp; so has not been a problem for me.</p>
<p>I simply count the number of cycles that the SSR is fired compared to the total number and average it to give near real time readout of power and a daily accumulator of power dumped. I don&#39;t have&nbsp; a RTC in my system and simply used the end of a long period of no activity to indicate the start of a new day. Not perfect and could be fooled but seems to work quite well.</p>
<p>&nbsp;</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14397"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Sat, 17/08/2013 - 10:24.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>When reading the Robins code been wondering about the&nbsp;settling time before mk2i starts to&nbsp;operate. Its not really the filters that needs so long settling time but rather AD conversion to stabilize - or ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14400"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 17/08/2013 - 12:37.</div>
    <div class="content">
     <p>Petrik - very little of the Mk2 code needs time to settle, but it seemed a good idea to disable the output stage for a few seconds after startup.&nbsp;</p>
<p>Don - sorry, there&#39;s no integrated diagram of how everything in Mk2i_rev5 fits together.&nbsp; With all of the main components already available, people need to piece together the bits that they want themselves.&nbsp; If you encounter any problems, there should be plenty of help available.&nbsp; I&#39;m always happy to reply to PMs if constructors of Mk2 systems find themselves stuck.</p>
<p>As for measuring the amount of power that&#39;s been diverted, this would be entirely feasible by including an extra CT into the system.&nbsp; It would just clip around one of the leads to the triac so would be entirely contained in the Mk2 unit.&nbsp;</p>
<p>With a second CT in the loop, the sampling process would be slowed down by around 50%.&nbsp; The basic FP version, e.g. Mk2_PV_Router_mini_3, would then run at only around 30 loops per mains cycle.&nbsp; If using one of the later versions, e.g. Mk2i_rev5 which samples much faster, the sampling rate would still be at a good level, at least 50 per second.</p>
<p>If using an emonTx, the physical board space for the extra components is already there.&nbsp; If not, then the extra few components would need to be mounted on an offcut of stripboard or equivalent.&nbsp; The code upgrade should not be too demanding.&nbsp; There would just need to be a second energy accumulator for the power that has passed through the triac.&nbsp;</p>
<p>If the dump load is at the far end of an RF link, then the processor in the remote unit is probably very lightly loaded.&nbsp; Why not include a standard measurement facility at the remote end?&nbsp; It&#39;s probably easier to start again with the Mk2 version of your choice, and then add in the handful of RFM12B components that are required for the RF receive functions.&nbsp;</p>
<p>The diverted energy can then be determined along the lines of:</p>
<p>#define JOULES_PER_WATT_HOUR 3600</p>
<p>float diverted energy; // as accumulated each mains cycle using the CT and the voltage sensor</p>
<p>unsigned int divertedEnergyInWattHours = divertedEnergy / JOULES_PER_WATT_HOUR;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14422"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 17/08/2013 - 21:36.</div>
    <div class="content">
     <p><em>With a second CT in the loop, the sampling process would be slowed down by around 50%.</em></p>
<p>Sorry, what I <u>meant</u> to say is that it would run at around two-thirds of the rate of the normal version.&nbsp; That&#39;s because there would be three <em>analogRead() </em>calls per loop rather than two.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14433"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Sun, 18/08/2013 - 09:31.</div>
    <div class="content">
     <p>Maybe I am missing something so asking for curiosity: Why would a second CT be&nbsp;preferred method&nbsp;?</p>
<p>It should&nbsp;more simplier to calculate (triac on loop count) / (total loops count) * loadW. This method should not even affect performance.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14441"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2867" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="9fingers&#039;s picture" title="9fingers&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2867" title="View user profile.">9fingers</a> on Sun, 18/08/2013 - 18:08.</div>
    <div class="content">
     <p>You only need a second CT to measure load if the load is smaller than the max power to be dumped for all dump loads</p>
<p>While bucket does not overflow (triac on loop count/total loop count) * Load power of particular dump load</p>
<p>&nbsp;</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14444"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 19/08/2013 - 12:36.</div>
    <div class="content">
     <p>Counting the number of cycles for which the load is &#39;on&#39; is fine as an estimate of the consumed energy, but it&#39;s only an estimate.&nbsp;</p>
<p>What happens if the mains voltage changes by 1%? - the power would change by 2%.&nbsp; What happens when the thermostat trips?&nbsp; - your estimated value of consumption would continue to increase but the actual amount of diverted energy would not.&nbsp; What happens if the rating of the load changes, or is less than the max amount of surplus PV etc. etc.?</p>
<p>By adding a second CT, you can measure the diverted power just as thoroughly as the net flow at the supply point is being measured.&nbsp; For an accurate value of the diverted energy, the system would need to be properly calibrated.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14445"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Mon, 19/08/2013 - 15:08.</div>
    <div class="content">
     <p>Hmm, voltage drop can be counted in as its purely resistive load fairly accurately Vrms/Un * P. Tripping thermostat can be detected from SSR/Triac duty cycle going to 100% constantly (assuming dump load P&nbsp;is higher than maximum excess P) within a small Wh threshold limit.</p>
<p>But yes - this is a matter of application and acceptable tolerance which can be only judged by brilliant brains of the chief designer.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14475"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Wed, 21/08/2013 - 10:00.</div>
    <div class="content">
     <p>Hi, has anyone used the cheaper Chinese Triacs&nbsp;in place of the BTA41. I need to get 4 of them. &nbsp;With a difference of about &pound;2.00 each, thats a nice saving by going for the Chinese alternatives. Just have a reservation of how safe they are ??</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14476"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 21/08/2013 - 11:24.</div>
    <div class="content">
     <p><em>has anyone used the cheaper Chinese Triacs&nbsp;in place of the BTA41.</em></p>
<p>No, but I have successfully used a <a href="http://spiratronics.com/product-40015.html">25 A</a> version, when the <a href="http://spiratronics.com/product-40017.html">40 A</a> one wasn&#39;t available.&nbsp; This is slightly cheaper and appears to work fine for Mk2 Router purposes at 13 Amps.</p>
<p>The problem may come in hot weather when the router is going flat out. The BTA41 can pass 13 Amps at a case temp of 110 degC, which sounds mighty impressive to me.&nbsp; Whether cheaper alternatives could survive such treatment is another question.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14481"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 21/08/2013 - 13:58.</div>
    <div class="content">
     <p>The point about using the higher current device comes down to its I<sup>2</sup>t rating, which directly relates to its ability to blow the fuse/trip the breaker protecting it. The 40 A device stands a reasonable chance of doing that, the 25 A version stands little chance - more likely it would protect the breaker or the fuse.</p>
<p>Either should be satisfactory in normal service.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14488"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1747" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1747" title="View user profile.">Petrik</a> on Wed, 21/08/2013 - 19:14.</div>
    <div class="content">
     <p>Yes for a month Fostec 25A SSR with mk2i and 1kw dump load, according to specs 25A version can take 5-7A without cooling (if my memory serves me right). In normal sunny days it barely reaches 40C with around 800w dumping, this SSR has a din rail mount though. Recall vaguely someone having bought a 25A copy which did not have triac screwed (;-?) to the back plate where as real ones have a screw holding the triac thermally connected to the back plate. This would obviously affect max current.</p>
<p>Do you Robert mean that 25A version should not be used with 10A fuse or do you mean that t is not recommended to have 25A fuse for SSR with the 25A fuse rating ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14505"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 22/08/2013 - 18:29.</div>
    <div class="content">
     <p>I think I spelled it out <a href="http://openenergymonitor.org/emon/buildingblocks/overload-protection-of-mains-electrical-circuits">here</a>. It&#39;s a matter of which one heats up and melts first. The BTA41 should survive if, at the current you have, its curve (the red line) is above and to the right of the fuse /MCB&#39;s. Otherwise in the shaded area it might not, and to left and below it won&#39;t.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14509"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="DEAN R.&#039;s picture" title="DEAN R.&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by DEAN R. (not verified) on Thu, 22/08/2013 - 19:58.</div>
    <div class="content">
     <p>I&nbsp;am new to forum but have been following the evolution of mk2 from jan this year , can you suggest which sketch is suitable for a basic load and program&nbsp;alteration for my meter ace 1000 itron (packet of 1250j).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14517"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 23/08/2013 - 06:47.</div>
    <div class="content">
     <p>Hi Dean, to provide a basic diversion function for surplus plower, the original Mk2 sketch with floating-point maths would do the job fine.&nbsp; Mk2_PV_Router_mini_3 is a trimmed-down version which does not have the bulk of the original.&nbsp; Because it does not have an anti-flicker mode, this sketch will work fine with any type of supply meter.</p>
<p>If you require your system to have an AF mode, then Mk2i (rev_4 or greater) would be the most straightforward way to go.&nbsp; Alternatively, it should not be difficult to add the AF mechanism into a simple base sketch such as Mk2_mini_3.&nbsp; The energy bucket for that sketch is in Joules so it would be a simple matter to re-define its capacity to 1250 (as required for your meter) rather than 3600.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14614"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="DEAN R.&#039;s picture" title="DEAN R.&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by DEAN R. (not verified) on Tue, 27/08/2013 - 07:46.</div>
    <div class="content">
     <p>Hi Robin thanks for the help ,hope to get the&nbsp;system going soon before summer ends. Keep up the good work, videos very helpful thanks again Dean.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14626"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1704" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Keith Walker&#039;s picture" title="Keith Walker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1704" title="View user profile.">Keith Walker</a> on Tue, 27/08/2013 - 15:41.</div>
    <div class="content">
     <p>Hi Dean, I also have an ace 1000 meter. Where did you find the reduced packet value? Has changing the sketch improved the performance? There seems to be two places to change the 3600.</p>
<p>Thanks Keith</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14629"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Tue, 27/08/2013 - 17:27.</div>
    <div class="content">
     <p>Hi,</p>
<p>I did some testing on the ACE 1000 meters as&nbsp;I couldn&#39;t get the AF to work with the packet value at 3600. After this testing&nbsp;I found it to be 1250 for that particular meter.</p>
<p>If you change;</p>
<p>#define JOULES_PER_WATT_HOUR 3600 // 0.001 kWh = 3600 Joules</p>
<p>to</p>
<p>#define JOULES_PER_WATT_HOUR 1250 // 0.001 kWh = 3600 Joules</p>
<p>it should work ok in AF mode.</p>
<p>In the MK5i&nbsp;I think you also have to change, (I don&#39;t use this version).</p>
<p>energyAtLastOffTransition_long = 3600; // reset the &#39;opposite&#39; mechanism</p>
<p>to</p>
<p>energyAtLastOffTransition_long = 1250; // reset the &#39;opposite&#39; mechanism</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14630"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 27/08/2013 - 17:40.</div>
    <div class="content">
     <p>Keith, I don&#39;t know for certain that the &#39;sweet-zone&#39; of the Ace meter is 1250 Joules, but several people have mentioned this value so I&#39;m happy to regard it as being correct.</p>
<p>Depending on what the modified code is required to do, it may be OK for the value of 3600 to remain, this being the number of Joules in a WattHour; it&#39;s only the size of the &#39;energy bucket&#39; that should be changed to match the sweet-zone for the meter that is being used.&nbsp; In well-structured code, this change should only need to be made in one place.&nbsp;</p>
<p>I trust that my various published sketches meet this criterion.&nbsp; If any of them don&#39;t, please let me know!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14820"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1164" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1164.jpg" alt="Simon&#039;s picture" title="Simon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1164" title="View user profile.">Simon</a> on Tue, 03/09/2013 - 17:32.</div>
    <div class="content">
     <p>Hi Robin et al.</p>
<p>Is it better to sink current, or source current from the arduino board to drive the LEDs.</p>
<p>But firstly, It seems de rigueur for this forum that at some time one comes out of the closet (or airing cupboard in my case) and admits to having been a lurker, well here I am, a repentant lurker!</p>
<p>I found this forum after I&rsquo;d built my own temporary diverter.&nbsp; I used a step down transformer to make sure that the power required for the immersion heater could be contained within the envelope of power produced by my PV without recourse to any phase or burst control.&nbsp; It has worked fine and served me well, I certainly wouldn&rsquo;t recommend it and it has major disadvantages but I&rsquo;ve used it whilst I embarked on a better solution and understanding of the problem.</p>
<p>I&rsquo;ve really enjoyed being re-educated in what was my subject having studied Electronic and Electrical Engineering at university, I started work in the Mullard Research and Application labs I slowly lost the &ldquo;hands on engineering&rdquo; and moved into management. Hey ho &ndash; that&rsquo;s life, and money!!!</p>
<p>My own system had four outputs, prioritised and cascaded down using small relays to drive zero cross SCR blocks, I had them in the bottom drawer so Heath Robinson eat your heart out :-).</p>
<p>When Robin&rsquo;s MK2i &ndash; 5B, came out I thought I&rsquo;d better make the most of the sun and optimise the solution, so I modified my &lsquo;birds nest&rsquo; to accept an Arduino Board, downloaded the software and modified it for 4 physical loads, and fired up the &ldquo;Quattro&rdquo; again. Without hesitation the supply meter LED went RED, the primary load started heating and through the day, all loads were switched on at various times&hellip;brilliant, but the LEDs didn&rsquo;t seem to reflect my understanding of their function.&nbsp;</p>
<p>In the end I realised I&rsquo;d connected the LEDs to 5V, and the current version of Robin&rsquo;s code expects them to be connected to ground, I&rsquo;m sure I&rsquo;d seen an earlier version with a circuit the other way round, anyway it was easier to change the code (It&rsquo;s only the glue which holds it together!!!), so 0=1, 1=0 in the LED code and bang the old Quattro was firing on all four cylinders and the lights were working, correctly.</p>
<p>It begs the question is it better to sink or source the current from an Arduino board?&nbsp; On face value the chip can sink or source 40mA, I&rsquo;m under driving the LEDs through 1K ohm, so comfortably within spec at circa 5 mA?&nbsp;</p>
<p>Looking forward to any comments if you get past the detritus of the opening :-)</p>
<p>Perfect, thank you Robin, Robert , and all the other active members for a very interesting and enjoyable re-discovery of electronics and how to solve the problem of diverting energy efficiently and effectively, and now I&rsquo;m starting to learn C++ which was starting to be used by the time I was leaving the bench environment.</p>
<p>Just starting a new project to store the suns energy in the house and at the same time bring a little sunshine to our north facing rooms with a Heliostat, now that&rsquo;s surely counts as lateral thinking.&nbsp;</p>
<p>Anybody done anything like this yet, or is it too far off the wall??</p>
<p>All the best and regards, Simon<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14825"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 03/09/2013 - 18:37.</div>
    <div class="content">
     <p>I prefer to have the LEDs connected to V<sub>CC</sub> (active low) with a 3.3 V supply and that&#39;s because the low output voltage is lower than the high output voltage is high. If that isn&#39;t very clear, the data sheet tells all (Electrical characteristics, section 28.2). Doing it that way round makes the dropper resistor a little larger, and less susceptible to component and supply tolerances. This can be important when you are driving, for example, the triac driver. With a 5 V supply,&nbsp; it is the other way round (there is a greater voltage available to the load when the load is connected to GND and the output is active high) and it&#39;s usually not so critical anyway.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14838"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 04/09/2013 - 09:40.</div>
    <div class="content">
     <p>When I was rushing around to publish my first Mk2 package, Robert kindly worked out that an active-low drive for the output stage would be best, and that 180R would be a suitable value for the series resistor.&nbsp; That was for when an MOC3041 opto-coupler is being driven from an Arduino.&nbsp; If using an emonTx which runs at 3.3V rather than 5V, a smaller value of series resistor is appropriate - I use 120R.&nbsp;</p>
<p>I&#39;ve always driven LEDs in active-high mode, simply because it feels more logical.&nbsp; If you&#39;re short of pins, an LED can be satisfactorily driven in parallel with the trigger (active-low), but it would need its own series resistor.&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15235"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Wed, 18/09/2013 - 09:45.</div>
    <div class="content">
     <p>With the RFM12B, what is the difference between antenna lengths. Which is the best length to install, 1/4, 1/2 or full. Obviously, I want the one that gives the best reception. Also, does both the transmit and recieve have to be the same lengths?</p>
<p>I am mounting my RFM12B on the same vero board as the master components (Mk2i_PV_Router_rev5b) and the only space left is next the the 9v ref transformer, will this interfere with the transmission signal?</p>
<p>Lastly, on the slave box, is there anyway I can connect a LED to the gate connection of the Triac so that when testing I can see that it is sending the signal to the triac. This will save me having to connect it to the mains electric for proving that everything is functioning OK up to the triac connection.</p>
<p>TIA Don....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15238"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 18/09/2013 - 11:00.</div>
    <div class="content">
     <p>When I started playing around with the RFM12B, I seemed to be getting poor reception with just the standard 82mm lengths of wire that were supplied as aerials for my 868 MHz modules.&nbsp; When I doubled the length of each wire, the performance seemed to improve.</p>
<p>Having tidied up my act somewhat, I no longer seem to be finding any transmission difficulties.&nbsp; I&#39;m now using 1/4 Wave aerials from <a href="http://stores.ebay.co.uk/chinarf">chinaRF</a> without any problems.&nbsp; I can&#39;t find the exact item now but they look something like <a href="http://www.ebay.co.uk/itm/GSM-GPRS-315MHz-wireless-antenna-remote-control-SMA-male-right-angle-/290803283144?pt=UK_Computing_Boosters_Extenders_Antennas&amp;hash=item43b539f4c8">this</a> - I bought 10 x 868 MHz ones for around &pound;25. &nbsp; For&nbsp; distances of just a few meters, there&#39;s no need to actually fit the aerials; there appears to be sufficient radiation/reception just from the RFM12B modules and the short lengths of coax to my bulkhead connectors.</p>
<p>To see when the triac is on, you could use a <a href="http://spiratronics.com/panel-neon-indicator-red.html">neon</a>.&nbsp; My own Mk2 Router no longer has any LED&#39;s.&nbsp; The neon indicator within the adjacent over-ride switch does the same job regardless of how power is being applied (diverted power via the triac, or constant via the metallic path).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Thu, 19/09/2013 - 06:07.</div>
    <div class="content">
     <p>How did you manage to fix the aerials from ChineRF to the rfm12b&nbsp;boards. Every picture or video I have seen shows them working with a piece of wire soldered directly to the RFM12B&nbsp;module.</p>
<p>The neon is good method to confirm the triac is working but this still means having to connect majns&nbsp;to the board, which I &nbsp;am trying to avoid. My preferred solution is still the LED. Is this possible and how could I do it, it there a circuit drawing depicting this?</p>
<p>TIA...Don</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15262"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 19/09/2013 - 08:33.</div>
    <div class="content">
     <p>Don, your triac already has mains connected to it.&nbsp; All you need to do is connect the neon between the switched-live pin of the triac (A1 on my Mk2 schematic diagram) and Neutral.&nbsp; The benefit of this system is that it will always indicate when power is available to the load.</p>
<p>A LED can be driven from any of the i/o pins on the processor, either active-high or active-low.&nbsp; To save using an extra pin, it can also be driven direct from the pin that controls the trigger.&nbsp; I&#39;ve described how to do this <a href="http://openenergymonitor.org/emon/node/2702">here</a>.&nbsp; A LED that&#39;s controlled by the processor will not come on if there is a high-current bypass switch as an over-ride facility.&nbsp; But it would come on if the over-ride ( or &quot;boost&quot;) mechanism is controlled by the processor.&nbsp;&nbsp;</p>
<p>To connect my aerial to the side of the box I&#39;ve used a compatible bulkhead connector, also from chinaRF.&nbsp; To fix the bulkhead connector in place, I used some <a href="http://www.ebay.co.uk/itm/M2-M2-5-A2-COUNTERSUNK-CSK-SOCKET-CAP-ALLEN-BOLT-SCREWS-STAINLESS-STEEL-FWS-/221125728257?pt=UK_DIY_Material_Nails_Fixing_MJ&amp;var=&amp;hash=item7918ff257c">2.5mm screws &amp; locknuts</a> as per photo. &nbsp; An easier approach, but possibly less rigid, would be to use the type of bulkhead connector that is retained by a screw-on ring.&nbsp; This topic was aired on the forum a couple of months ago with all the relevant details/links.</p>
<p>Soldering the coax&#39;s braid to the connector&#39;s mounting flange, as I have done thus far, is not ideal.&nbsp; It would probably be easier/better to solder the braid to a small eyelet and then capture this under the mounting screw.&nbsp; A similar arrangement could no doubt be devised for the lock-ring type of bulkhead connector.&nbsp; Providing some form of strain-relief at the RFM12B end of the coax is another challenge.&nbsp; I&#39;d be interested to see how others have gone about solving this one.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15268"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 19/09/2013 - 10:19.</div>
    <div class="content">
     <p>Robin, you&#39;re missing the point about the neon/LED. Don wants a low voltage device he can test safely with.</p>
<p>The short answer is no, you can&#39;t easily do anything with the high voltage side of the opto-isolator/trigger IC, but you can replace it on the low voltage side with an LED. That will show when it is being asked to fire (but it won&#39;t prove that the HV circuit is correct).</p>
<p>The only way I can think to test the HV side in relative safety is to feed it via a 1:1 isolating transformer. You&#39;d need about 50 - 100 VA rating in order to use even a lamp as the test load, and you&#39;d still have 240 V there, but it would be floating with respect to earth so there would be a much reduced risk of a shock from accidental contact with one wire (but NOT of course from two).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15280"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 19/09/2013 - 14:18.</div>
    <div class="content">
     <p><em>Robin, you&#39;re missing the point about the neon/LED. Don wants a low voltage device he can test safely with.</em></p>
<p>Maybe I am, but you can&#39;t test a live triac with an LED!&nbsp; The trigger/triac at the remote end are being fed from an Atmel 368 processor in just the same way as if there was no RF link present.&nbsp; Doing LV and HV tests at the remote end is therefore no different than when using an all-in-one design.&nbsp;</p>
<p>The input (LV) side of the trigger is electrically no different than a standard LED; indeed, an extra LED + series resistor can be connected in parallel with it.&nbsp;&nbsp; It&#39;s only the output side of the trigger device which is HV.</p>
<p><em>Lastly, on the slave box, is there anyway I can connect a LED to the gate connection of the Triac so that when testing I can see that it is sending the signal to the triac.&nbsp; </em></p>
<p>Hope I&#39;ve answered the above (I think you mean the trigger rather than the triac).&nbsp; It&#39;s best to think of the &quot;trigger + triac&quot; as a combined item.&nbsp; If you connect them up correctly, they should work as intended.&nbsp; Beware - if you get the A1 and A2 wires crossed over between these two components, the triac will stay on permanently.&nbsp; Not sure why, but it does!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15303"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Fri, 20/09/2013 - 07:05.</div>
    <div class="content">
     <p>what I am looking for is a LED connected in parallel with the circuit that fires the triac (although there will be no triac or Mains voltage present). So when I am testing the project, as soon the the LED lights up, I know that the circuit (RF&nbsp;master and slave) is working up to the triac&nbsp;gate connection.</p>
<p>I would be grateful if someone could detail the exact circuit for adding the LED (and resister?) to the triac&nbsp;circuit.</p>
<p>TIA.....Don</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15306"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 20/09/2013 - 12:50.</div>
    <div class="content">
     <p>Don, I&#39;m confused by what you mean when you write &quot;triac circuit&quot;.&nbsp; Apart from the handful of resistors and maybe a snubber capacitor, there are two main components in the output: the triac and the opto-isolated trigger.&nbsp; Triacs will work down to low voltages, the resistors (and probably the line voltage sensing part of the trigger) are designed for mains (110 V upwards). And as the power for that isolated part of the circuit comes from the mains, it&#39;s going to be very hard to test sensibly without applying mains voltage.&nbsp; What you can do, on the low voltage side as both Robin and I said, is: For testing, you can substitute an ordinary visible LED instead of the infra-red LED that forms the receiving end of the trigger i.c.</p>
<p>Looking at the data sheet, the emitter (LED) forward voltage is typically 1.25 V @ 30 mA, which is pretty much the same if not lower than a standard red LED, so it&#39;s unlikely that a standard LED in parallel with the opto-emitter will do anything. You could put your LED in series, but the additional voltage drop means that the series resistor must be reduced to provide enough current to guarantee firing the triac, and when you do all the sums it&#39;s not possible to find a resistor value that is guaranteed to work in all the worst-case conditions (i.e. at both maximum and minimum voltages etc for all the components and tolerances involved. So anything you do must be removed after initial testing to assure that the circuit will work correctly.</p>
<p>If, as Robin suggests, you put a visible-light LED and a separate dropper resistor in parallel with the opto-emitter and its dropper resistor, you need to run the new LED at fairly low current in order not to exceed the output rating of the processor I/O pin.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15316"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 20/09/2013 - 15:58.</div>
    <div class="content">
     <p>Hi Don, I&#39;ve nothing to add to Robert&#39;s comprehensive reply.&nbsp; If you&#39;re still struggling to see how to connect up your LED, maybe you could post a sketch of your circuit.&nbsp; Then we would know what advice to give.&nbsp;</p>
<p>In my original schematic diagram, the input side of the trigger sits between the 5V rail and digital pin 9.&nbsp; If, also from pin 9, you were to connect an LED plus series resistor to the 5V rail, that LED should illuminate whenever the trigger is instructed to come on (regardless of whether HV is present at the triac).&nbsp; The internal and external LEDs will be acting in parallel.&nbsp; If, instead, you were to connect your extra LED to GND instead of the 5V rail, the two would act in anti-phase.&nbsp; The visible LED would then be &#39;on&#39; whenever the internal one is &#39;off&#39;, and vici-versa.</p>
<p>With a Uno, a suitable series resistor for the trigger is shown as 180R.&nbsp; If using an emonTx at 3.3V, this value should be reduced to around 120R.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15362"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1164" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1164.jpg" alt="Simon&#039;s picture" title="Simon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1164" title="View user profile.">Simon</a> on Mon, 23/09/2013 - 08:29.</div>
    <div class="content">
     <p>The lights, those lights, those blinking lights :-)</p>
<p>I seem to remember seeing a comment about the need for a health warning on the LEDs, it certainly does consume time, especially when you&#39;re on the cusp of balancing the PV and demand, as is the case at this moment.</p>
<p>.................... wait, wait, bear with,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,, bear with,,,,,,,,,,,,,,, wait, OK &nbsp;I&#39;m back.......</p>
<p>Anyway, just linking into the previous conversations, I have neons in the remote load switches, so I can see when they are firing and I&#39;m away from the central unit.</p>
<p>I have LEDs&nbsp;on the control panel to see when the outputs of the UNO are active for each remote load ( I have four), this is in the hall and is where I can change priority, select anti-flicker etc, and where the Underrun, Overflow, and Surplus lights are visible, and I have one more........</p>
<p>I know, I&#39;m a glutton for punishment, but I thought I&#39;d share this with you. &nbsp;I have a single transistor buffer, switching an LED, which is controlled by an LDR sitting over the LED on the supply meter. &nbsp;I know you have done this before and passed it through the processor, but this is totally independent of the processor, and just mimics the state of the supply meter LED, showing it either flashing, off or constantly on. &nbsp;For me, it is a constant proof that the control loop is behaving properly, easy to view, and in the end it is this LED, this blinking LED for which I pay.</p>
<p>So I like the idea of having a &#39;belt and braces&#39; approach, and an independent path of proof, constantly visible, just in case I do something silly, my meter is outside, and it has helped my wife to see what&#39;s happening!!, she made ME turn some lights off := RESULT!!</p>
<p>I can tell you now the meter is in anti-creep mode, immersion hot, and second load already heating, I have had it where all four loads have been active but not today. :-(</p>
<p>Regards Simon</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15363"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 23/09/2013 - 12:10.</div>
    <div class="content">
     <p>I like it.&nbsp; As you mentioned, the Mk2 code is already able to monitor the meter&#39;s LED and analyse its activity.&nbsp; Relaying the state of this LED to a remote one is straightforward enough via an unused i/o pin.&nbsp; But if a transistor will do the same job, that sounds an excellent way to go.&nbsp;</p>
<p>It would be a neat improvement if the state of the meter&#39;s LED could be incorporated into the dump-load control logic.&nbsp; At present, the energy bucket always fills to a certain level before the load is turned on.&nbsp;&nbsp; During this process, some energy may be lost to the grid; it all depends on the relationship between the two measurement systems.&nbsp; If the Router&#39;s logic were to know exactly where the present energy state is (within the meter&#39;s own energy window during periods of consumption), that initial&nbsp; loss of useable energy could be neatly avoided.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15365"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1164" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1164.jpg" alt="Simon&#039;s picture" title="Simon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1164" title="View user profile.">Simon</a> on Tue, 24/09/2013 - 06:32.</div>
    <div class="content">
     <p>I agree that one might possibly use this approach to stop losing some energy to grid but I was more concerned initially not to pay extra, so I was also thinking of using the parallel path as some kind of watchdog for the processor, (it&#39;s what I&#39;m doing visually) &nbsp;it does feel as if some logic could be employed to identify that if an output is triggered and the meter LED is not on (after a settling time, which might lose energy to the grid!!), that we might have got out of sync, or worse, processors do go AWOL.</p>
<p>So even if some logic does get added into the code, or on a shield as a watchdog, or as a gate function to the active low outputs to stop them firing unless meter LED is on, I will probably still keep a parallel functionally&nbsp;separate&nbsp;path to see the logic appears to be on target. &nbsp;In my safety critical applications in the past we often had more than one processor running different code, checking each other.</p>
<p>In terms of display, I&#39;m also thinking of using a PWM output to drive a small meter, maybe showing how full the bucket is, or using it centre positioned to show a very visual direction of power flow, especially good for seeing how close to the line, that you are</p>
<p>I have to say again, thanks to this forum and to your original work, it&#39;s made significant improvements to my original&nbsp;concept which was very inefficient, but I have to say worked. Your MK2i 5b &nbsp;does work very well, today I am just PV positive, weather very grey, and it is working well, lights, those blinking lights &nbsp;:-)))</p>
<p>Simon</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15443"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Fri, 27/09/2013 - 11:19.</div>
    <div class="content">
     <p>Tried to install the MK2i 5b sketch for the Uno and got the following errors, can anyone help and tell me where I am going wrong ?</p>
<p>&nbsp;</p>
<p>Mk2i_PV_Router_rev5b.ino: In function &#39;void setup()&#39;:</p>
<p>Mk2i_PV_Router_rev5b:443: error: &#39;RF12_868MHZ&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:443: error: &#39;rf12_initialize&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:444: error: &#39;RF12_SLEEP&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:444: error: &#39;rf12_sleep&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:512: error: &#39;Timer1&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b.ino: In function &#39;void send_rf_data()&#39;:<br />
	Mk2i_PV_Router_rev5b:1242: error: &#39;RF12_WAKEUP&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:1242: error: &#39;rf12_sleep&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:1245: error: &#39;rf12_canSend&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:1247: error: &#39;rf12_recvDone&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:1250: error: &#39;rf12_sendStart&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:1251: error: &#39;rf12_sendWait&#39; was not declared in this scope<br />
	Mk2i_PV_Router_rev5b:1252: error: &#39;RF12_SLEEP&#39; was not declared in this s</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15446"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 27/09/2013 - 11:55.</div>
    <div class="content">
     <p>Yes, you don&#39;t have the library for the RFM12B (JeeLib). Follow the instructions at <a href="http://openenergymonitor.org/emon/buildingblocks/setting-up-the-arduino-environment">http://openenergymonitor.org/emon/buildingblocks/setting-up-the-arduino-environment</a>&nbsp; for setting up your libraries.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15456"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Sat, 28/09/2013 - 06:58.</div>
    <div class="content">
     <p>Hi Robin, clicked on your link and it says page cannot be found?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15459"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sat, 28/09/2013 - 08:24.</div>
    <div class="content">
     <p>OK Don, which link is not working?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15461"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 28/09/2013 - 11:22.</div>
    <div class="content">
     <p>It was the automatic parser that got it wrong when creating the link from plain text.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15485"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Mon, 30/09/2013 - 06:59.</div>
    <div class="content">
     <p>it was the last link you entered in this forum, how to setup keeping&nbsp;with arduino uno. I managed to find this link but cannot locate the jeelibs zip file. Why is it not straight forward. ???</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15489"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 30/09/2013 - 09:23.</div>
    <div class="content">
     <p>Don, it wasn&#39;t me who posted that link, but I&#39;m glad that it&#39;s now working for you.&nbsp;</p>
<p>I hope that someone else will be able to help you to get your Jeelib library files set up correctly.&nbsp; That&#39;s not my area, I have to struggle as much as anyone else with such things!</p>
<p>Robin</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15491"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 30/09/2013 - 15:23.</div>
    <div class="content">
     <p>We don&#39;t control what Jean-Claude does in JeeLib. If you can&#39;t see a zip file, you need to look harder. I can see it.&nbsp; You still have a choice to download the files one by one or install GIT.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15506"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 30/09/2013 - 23:03.</div>
    <div class="content">
     <p>&nbsp;</p>
<p><span lang="EN-US">I could see a likely looking Jeelib .zip file when I checked earlier today.&nbsp; I followed OEM links as far as <a>https://github.com/jcw/jeelib</a> and then clicked where it says: &quot;You can download all the project source files in <a>ZIP</a> or <a>TAR</a> format: &quot;&nbsp; The file is called jcw-jeelib-17a45b2.zip&nbsp; </span></p>
<p><span lang="EN-US">Another way to install library files is to copy the complete directory structure from someone else.&nbsp; I think that&#39;s the route I took, some months ago.&nbsp; My Libraries directory which includes the Jeelib folder is attached.&nbsp; No promises, but it may help.</span></p>
<p>&nbsp;</p>
<p>
	<span style="display: none;">Version:1.0 StartHTML:0000000105 EndHTML:0000002490 StartFragment:0000002325 EndFragment:0000002454 </span></p>
<p class="MsoNormal"><span style="display: none;"><span lang="EN-US">(Sorry the system is not letting me add this attachment, will keep trying ...)</span></span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15785"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Fri, 18/10/2013 - 16:19.</div>
    <div class="content">
     <p>Hi Robin,</p>
<p>I am now getting close to turning on my RF &quot;router&quot;. I have built it to the drawings that I have manged to find on the forum but I have a query with the gnd connections on the RFM12B module. On your video, you show your drawing with the ground (pin 14) connected but on the emon building blocks section, the drawing there does not show pin 14 as being connected. It shows pin 3 as the only ground connection.</p>
<p>If pin 14 has to be connected to ground, which ground does it need to be connected to, is it the same as pin 3 or ??</p>
<p>Thanks Don....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15786"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 18/10/2013 - 17:56.</div>
    <div class="content">
     <p>Don, it doesn&#39;t matter which of the three GND pins on your Uno is used for an RF adapter.&nbsp; Any of them will do.</p>
<p>As one of these GND pins is adjacent to pins D10 - D13 which are required by the RF module, it&#39;s convenient to use a DIL strip to make all five connections in one go.&nbsp; That only leaves 2 flying leads for D2 and the 3.3V rail.&nbsp;</p>
<p>I built another of these units a few days ago as shown <a href="http://openenergymonitor.org/emon/sites/default/files/IMGP0569.JPG">here</a> on <a href="http://openenergymonitor.org/emon/node/2917">another thread</a>.&nbsp; Because of the additional front-end board for that project, the 3.3V supply takes an indirect route to get to the RF adapter.&nbsp; But in electrical terms, that lead just plugs into the relevant socket on the opposite side of the Uno.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15788"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Fri, 18/10/2013 - 18:11.</div>
    <div class="content">
     <p>Thanks for your reply. Does the gnd connection pin on the RFM12B module (pin 14, top right hand pin looking from the top) need to be connected to gnd ?</p>
<p>Thanks Don....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15790"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 18/10/2013 - 19:49.</div>
    <div class="content">
     <p>No.&nbsp; If you look of the back of the RFM12B, you can see that pins 3 and 14 are both connected to its groundplane.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15808"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Sun, 20/10/2013 - 11:37.</div>
    <div class="content">
     <p>I have built the router as per Robin&#39;s design. I need to know what is the output of Digi pin 9 of the Arduino when running the mini_3 sketch. This is the pin that drives the opto-isolator which in turn drives the triac. I need to test my board as it is not working and am trying to break it down into small modules. I am hoping that I can connect a LED to digi pin 9 to monitor the output to see if I am getting anything out of digi pin 9. Thxs don...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15809"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 20/10/2013 - 12:28.</div>
    <div class="content">
     <p>All of my Mk2 Router sketches drive the output pin low when the trigger (and hence the triac) is to be activated.&nbsp; If everything is working correctly, and you connect an LED plus series resistor in parallel with the trigger and its attendant resistor, then both of them should operate in parallel.&nbsp;&nbsp;</p>
<p>If you only have the LED connected, but no trigger/triac, then there will be no feedback because the current is not changing direction.&nbsp; Any surplus power will cause the LED to come on, and stay on.</p>
<p>If you can explain which part of your rig you wish to investigate next, then a simple check for this can probably be suggested.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15812"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 20/10/2013 - 13:35.</div>
    <div class="content">
     <p>Robin: Would a simple test sketch to drive the triac at (say) 20% power (2 s on, 8 s off) be any use to Don?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15814"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Sun, 20/10/2013 - 15:07.</div>
    <div class="content">
     <p>Thanks for your reply but I am lost. In simple terms can I put a LED between dig 9 and ground with a resistor (180 ohms) between the LED negative and ground. So LED + to dig 9 and LED - to 180 ohm resistor which is connected to ground. So when I connect the ct and it detects surplus, the LED comes on and when there is no longer any surlpus, the LED goes off. (or off/on rather than on/off)</p>
<p>There is no MOC 3041, triac&nbsp;or any other components connected that are related to the Triac&nbsp;circuitry. I just want to monitor dig 9 to see if everything is working OK up to that point.</p>
<p>Please, answers in very simple terms. Thank you for your patience and time.</p>
<p>Don....</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15815"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 20/10/2013 - 16:17.</div>
    <div class="content">
     <p><em>&quot;Thanks for your reply but I am lost. In simple terms can I put a LED between dig 9 and ground with a resistor (180 ohms) between the LED negative and ground. So LED + to dig 9 and LED - to 180 ohm resistor which is connected to ground. So when I connect the ct and it detects surplus, the LED comes on&quot;</em></p>
<p>OK let&#39;s stop there. This is a closed loop control system. Until you have the whole system in place it won&#39;t work. It depends on the c.t. sensing the energy flowing backwards and forwards, see-sawing between the grid, your PV and the immersion heater. With the immersion not being controlled, that won&#39;t happen. So you must simulate it by hand.</p>
<p>Wire up your LED as you suggest. It should come on straight away because Robin&#39;s circuit expects it to be wired from the <strong>supply to the output,</strong> not output to ground. Use a low-power load - say a 100 W lamp just connected to the mains as you would. That will consume 100 J/s, so it will completely fill the &quot;Energy Bucket&quot; - 3600 J - in 36 s.&nbsp; [The low power gives us time to see what&#39;s going on.]</p>
<p>Put your c.t. on one of the lamp wires. If the LED goes off inside 36 s, you&#39;re generating and so far so good. Unclip the c.t. and turn it round on the cable. After about 30 seconds (depending on where your thresholds are set) the LED should come on. If that happens, it&#39;s all working.</p>
<p>If the LED doesn&#39;t go out after 36 seconds (or maybe a bit longer if the calibration is awry), turn the c.t. around anyway. If the LED goes out after another 36 seconds, the c.t. thought the first time you were drawing power from the grid and you were emptying the already-empty bucket. By turning the c.t. around, it then thinks you are filling the bucket.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15820"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 20/10/2013 - 18:30.</div>
    <div class="content">
     <p>Yes, I&#39;ll go along with all of that.&nbsp; My sketch <strong>Mk2_PV_Routrer_mini_3.ino </strong>displays the amount of energy that is being seen at the CT3 (An 1) each second.&nbsp; With a 100W bulb connected, you should see +100 (Watts) when the CT is connected one way around, and -100 W when it is reversed.&nbsp; When the energy bucket reaches 1800 Joules, your LED should go on.&nbsp; Then, when you reverse the CT, the energy level will drop and the LED should go off.&nbsp;</p>
<p>If this is not happening, try running my RawSamplesTool_4ss_2 sketch.&nbsp; This will show you what your sensors are seeing.&nbsp; If the results don&#39;t look right, then you can post them here and someone will no doubt steer you in the right direction.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15841"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Mon, 21/10/2013 - 16:44.</div>
    <div class="content">
     <p>Hi, I have tried what you suggested with no conclusive answers. I think that maybe my circuit is not performing as it should. Can I clarify that the 9 volt transfer is working as I thinks it should:</p>
<p>On the primary side (viewed from the top), there are 4 conections, only 2 are labelled on the top, the outside connections labelled 0v (left) and 230v (right). I have connected the mains to these 2 connections and not done anything with the 2 centre connections.</p>
<p>The secondary side has 4 connections labelled 0 - 9v &nbsp; 0 - 9v from left to right. I have just used furthest right pair and ignored the left had pair. My problem is that my meter only reads 1.11v (on the AC setting) on each of the pairs, should this not be reading 9 volts AC?. My meter is an old meter and the AC setting says 200/1000AC, so maybe my meter does not read anything below 200v AC accurately!!</p>
<p>I am using a blue YHDC CT: 100A:50mA, &nbsp;SCT013. Do you know if this contains a burden resistor, or should I add one. Currently, I have no burden resistor installed on my board.</p>
<p>I ran the program that Robin suggested in his last comments and attached the results to this post. Lasty, thank you for your time and help</p>
<p>Don...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15847"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 21/10/2013 - 20:55.</div>
    <div class="content">
     <p>If you seriously want to construct projects like this, you need to get a reliable multimeter. You don&#39;t have to spend much. For less than the price of an emonTx, you can get a reasonable one like this: <a href="http://spiratronics.com/professional-s8-multimeter-en.html " title="http://spiratronics.com/professional-s8-multimeter-en.html ">http://spiratronics.com/professional-s8-multimeter-en.html </a> (I don&#39;t own one, it&#39;s not super-accurate but it looks very good value for the money and will be an invaluable aid.)</p>
<p>The transformer primary: It&#39;s possible that there are two windings of 115 V each. If that&#39;s so, you need to link the two centre pins to connect the two windings in series. If you can check the resistance between the various pins, that will give you a clue. Is it an open-type transformer, can you see the windings coming to the connections? If you can see a connection to each of the centre pins, that&#39;s another indication that there are two primary coils and they need to be connected in series. If you put your meter across the two centre pins and read about 240 V, that&#39;s yet another indication of a split primary winding and you need to link those two pins.</p>
<p>The secondary side: It&#39;s OK to use just one winding, no problem there.</p>
<p>We know the 100 A SCT-013-000 does NOT contain a burden resistor, and you&#39;ll be overloading it without one.</p>
<p>The recordings are certainly not right. You need to sort out your 9 V and the burden, then try again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15849"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 21/10/2013 - 21:14.</div>
    <div class="content">
     <p>Thanks for posting those results, Don.&nbsp; It&#39;s always easier to diagnose problems with something you recognise.</p>
<p>With only 150W flowing through your CT, I would expect to see a very small signal on the &#39;c&#39; trace.&nbsp; A large waveform should only appear on that display when several kW is flowing.&nbsp; This suggests to me that you&#39;ve not got a burden in your circuit.&nbsp; I would try adding a 150R burden.&nbsp; If you leave the leads of the resistor nice and long, it will be easier to change it later for a different one.</p>
<p>At the start of each run, the count should read 4 3 2 1&nbsp; not 4 4 4 4 3 3 3 3 2 2 2 2 etc.&nbsp; This tells me that your voltage sensor is not behaving properly.&nbsp; A related symptom is that you&#39;re not collecting 3 waveforms&#39; worth of data as the results file claims to be doing. The logic expects the voltage waveform to be sinusoidal, which yours unfortunately isn&#39;t.&nbsp;</p>
<p>It sounds as if you&#39;re generating your AC voltage using a transformer.&nbsp; With everything disconnected, you should be able to work out which pins are which using a resistance meter.&nbsp; With a 3VA dual 9V transformer, I can measure the resistance of the primary coil to be 800 Ohms, and each of the secondaries is approx. 5 Ohms.</p>
<p>If you were to run my MinMaxAndRangeChecker sketch, you should see a constant value of around 500 for each analog input that has a sensor connected to it (probably A2 for the voltage sensor and A1 for the current sensor) and just ingore the other columns.&nbsp; That&#39;s when no AC is present.&nbsp; Then, when you switch on the AC voltage, you should see the &quot;range&quot; column for the voltage sensor&#39;s input increasing from around zero to several hundred.&nbsp; The current sensor should remain fairly close to 500 until you pass a large current through the CT.</p>
<p>By running these basic tests, and posting the results, I feel sure that your system will soon spring into life ...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15858"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Tue, 22/10/2013 - 04:05.</div>
    <div class="content">
     <p>many thanks for your replies, I will check these out today. Just a quick question Robin, you mention the dual 3va transformer, which I have and bought from Spiratronics. Did you have to solder the 2 centre pins together on the primary side as Robert Wall hinted at ?.</p>
<p>thanks Don...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15864"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 22/10/2013 - 09:57.</div>
    <div class="content">
     <p>The transformer that I tested yesterday was not from Spiratronics, it was from <a href="http://www.jprelec.co.uk/store.asp/c=1203/Chassis-Transformers-6VA-Output">JPR Electrical.</a></p>
<p>Here&#39;s one that came from Spiratronix.&nbsp; On this model, there are only two pins on the primary side rather that four.</p>
<p>If you&#39;re using one of their PCB mounting transformers, you should be able to identify the correct connections on the primary side by looking at the <a href="http://openenergymonitor.org/emon/sites/default/files/input.jpg">PCB layout </a>that Rich has kindly provided on his <a href="http://openenergymonitor.org/emon/node/2044">Mk2 Route parts For Sale</a> thread.</p>
<p>Hope this helps.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15865"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Tue, 22/10/2013 - 10:16.</div>
    <div class="content">
     <p>I am now getting 11.1 volts AC out of the transformer, so progress there. I have conneted the burden resistor (150ohms) and run the test&nbsp;RawSamplesTool_4ss_2 sketch. The results are not promising, I am now getting more 4,3,2 and 1&#39;s. I have attached the readings in the same format as before. Thanks Don....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15872"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 22/10/2013 - 12:25.</div>
    <div class="content">
     <p>That voltage wave is still nowhere near right. There are several options for the input circuitry - which circuit diagram are you following (I&#39;ve looked back up this thread and I can&#39;t spot where you say anything about it)? Can you provide a link, failing that a scanned drawing?&nbsp; I think there is something fundamentally wrong with your hardware and you need to look hard at the input circuitry of the voltage input (and quite possibly the current input as well) and carefully check it.</p>
<p>With no inputs (neither voltage nor current), the inputs should sit very close to 2.5 V and Robin&#39;s test sketch should draw a line of &#39;c&#39;s (but quite possibly only one or two!) right down the middle. This is what I got:</p>
<p>No of cycles recorded = 3<br />
	cycleCount 2404,&nbsp; samplesRecorded 17<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |<br />
	minVoltage 505,&nbsp; maxVoltage 506,&nbsp; minCurrent 507,&nbsp; maxCurrent 508</p>
<p>That (505/506 &amp; 507/508) is close enough to 512, which is where it should sit.</p>
<p>(Robin&#39;s sketch won&#39;t work properly without a voltage input, but it still gives useful information about where the input is sitting.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15879"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Tue, 22/10/2013 - 15:49.</div>
    <div class="content">
     <p>Firstly, thank you for your time in helping me trying ti get this to work. The circuit I am using is on vero board and the circuit is taken from this <a href="http://openenergymonitor.org/emon/sites/default/files/cct.jpg" title="http://openenergymonitor.org/emon/sites/default/files/cct.jpg">http://openenergymonitor.org/emon/sites/default/files/cct.jpg</a>. As I explained previously, I am not employing the triac part of the circuit, I just have Digi 9 connected to a LED and the LED is connected through a series resistor to the negative on the Arduino board.</p>
<p>I have tried what you said earlier with monitoring the LED going out and then reversing the CT so it should come back on again, but no luck. I can get the LED to go off whichever way round the CT is, but cannot get it to come back on again, unless I reset the Arduino. BTW, I am running the mini_3 sketch for this test. The readings from this sketch are CT one way, about 55 to 70 and with the CT reversed, about 90 to 110.</p>
<p>I am wondering if having the USB serial cable and the 9volt supply connected at the same time to the Arduino board is causing mis-readings. All tests and readings mentioned here have been completed with only the USB serial cable connected, NO 9 volt supply as well.</p>
<p>I have a spare CT which measures 40 ohms from tip to sheild and was informed that this did not need a burden resistor and have tried this and attached the results which are taken when using Robins test sketch.</p>
<p>Don...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15883"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 22/10/2013 - 19:31.</div>
    <div class="content">
     <p>Don, while your input circuits are not behaving as expected, there&#39;s no point with moving on to other parts of your setup.&nbsp;&nbsp; I have never found any problem with having an external DC supply present as well as the USB.&nbsp; For test purposes, USB power on its own should be fine.</p>
<p>I don&#39;t have any PCB transformers from Spirotronics (VTX), but I&#39;ve just bought a similar one from JPR.&nbsp; This has four pins on the 240V side, only the outer two of which are connected.&nbsp; There&#39;s a very fine wrapped around each of these pins, but not around the inner two.&nbsp;</p>
<p>To check the voltage waveform, I connected one of its 6v AC outputs to an emonTx.&nbsp; Although I&#39;ve not used the normal socket, the signal plugs into the board in the normal place (analog input No 2).&nbsp; To make the display more interesting, I fitted a CT to CT1 (A3) and clipped it around the Neutral feed of an extension cable which supplies power to a 2 kW room heater.</p>
<p>The sketch I used was RawSamplesTool_4ss_2.ino, exactly as posted, except that I changed the value of noOfCyclesToBeRecorded from 3 to 1.&nbsp; The results file is attached.&nbsp; I did two runs, the first with the load off and the second with it on.&nbsp; These waveforms all look fine to me.</p>
<p>When you can get waveforms like this, then everything else will probably spring into life too :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15885"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 22/10/2013 - 19:54.</div>
    <div class="content">
     <p>I second what Robin says about getting the input waveforms right. There&#39;s no point in trying to run before you can walk. Did you try with no mains voltage to the transformer on the voltage input and no c.t?&nbsp;&nbsp; You see, my fear is the op.amp is unstable and is generating a high frequency wave that is adding to the mains wave, and it&#39;s that which is putting the &#39;v&#39;s all over the place. Have you measured the voltage at the op-amp output, and is it 2.5 V? Is the op-amp getting warm? Are you absolutely sure that you have copied the circuit onto veroboard exactly? Even if it all looks OK to you, can you do a clear sharp photo of both sides of the board for us to check?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15888"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 23/10/2013 - 07:15.</div>
    <div class="content">
     <p>Don, if your op-amp is in a socket, you could very easily convert your reference circuit to the standard (passive) arrangement.&nbsp; Having removed the op-amp chip, you would just need to connect pin 3 (+ve i/p)&nbsp; to pin 1 ( the o/p), and add a suitable capacitor (at least 10 uF) between this point and ground (pin 4 of the socket).&nbsp; You would then have a 1-channel version of the standard reference circuit that&#39;s found on an emonTx.</p>
<p><img alt="" src="http://openenergymonitor.org/emon/sites/default/files/passive_Vref_on_emonTx.jpg" /></p>
<p>With only one reference circuit, there will be a small amount of crosstalk (leakage) between your voltage and current sensors, but it should easily be possible to see what&#39;s going on.&nbsp; If you start seeing sensible waveforms, that&#39;s great; there must have been some kind of problem with your amplifier.&nbsp; If good waveforms do not appear, then it will be much easier to diagnose what&#39;s going wrong without the op-amp being in the circuit.</p>
<p>If the amp is not in a socket, and you want to cause minimal disturbance to your existing wiring, maybe you could build a new (passive) reference circuit as above somewhere else.&nbsp; You can then connect this into your existing circuit in place of the existing reference from the op amp.&nbsp;&nbsp; A pair of 10 K resistors will be fine for this reference circuit, there&#39;s no need to use 470 K.&nbsp; They just need to be equal.</p>
<p>When some kind of isolation is needed on a strip-board circuit, it&#39;s often possible to simply break one track which can then be soldered across later.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15908"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Wed, 23/10/2013 - 16:01.</div>
    <div class="content">
     <p>Hi Thanks Robin for your reply. I live in Spain and getting electronic components is near impossible, I would have to order from the UK and this takes time. I have a spare op amp and will replace it to see if it is the op amp that is faulty. Did you check my readings3.txt sketch readings. I though that the last 3 were pretty good and looked quite true, these are the readings that had my 9 volt DC supply to&nbsp;Arduino board disconnected and just had the USB serial cable in place and used the other CT with no burden resistor.</p>
<p>I have checked and rechecked the vero board layout and everything is in place correctly, although I did find that i had the CT socket wired wrong until readings3 txt. I did not have the tip connected but the middle connected, which of course meant that the CT had only 1 connection which is why the readings could have been all over the place. I have a working version of your router on my own solar setup and I checked the resistance of the CT and this was 40 ohms, which is the same as that one that I am using now (for readings3.txt). Perhaps I should build the triac&nbsp;circuit and test with this is place?</p>
<p>Thanks Don....</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15909"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 23/10/2013 - 17:53.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>(sorry, Don, I&#39;d not checked all of your file when I first posted this reply ...)</p>
<p>Yes, the lower runs in Results3.txt do indeed look much better:</p>
<p>Run 1 starting at character 1 - not good, nothing useful there</p>
<p>Run 2 starting at character 202 - not good either</p>
<p>Run 3 starting at character 352 - this one looks a bit better, but is still not right.&nbsp; It should have recorded 3 cycles</p>
<p>Run 4 starting at character 807 - Hooray, both waveforms are looking fine!&nbsp; This is without your external supply</p>
<p>Run 5 starting at character 1545 - Yes, both waveforms are looking fine again. &nbsp;</p>
<p>Run 6 starting at character 2283 - The current waveform should be a straight line, and it clearly isn&#39;t.&nbsp; This tells me that your biassing circuit is somehow relying on your CT, which shouldn&#39;t happen.&nbsp;</p>
<p>So there seem to be two problems:</p>
<p>1. Your external supply is upsetting the Arduino (which is fine when just the USB supply is in use).&nbsp; RichMc has mentioned this kind of problem, but I&#39;ve never seen it myself.</p>
<p>2.&nbsp; Your current sensor does not work when the CT is removed.&nbsp; Are you sure that there really is a burden resistor on your board?</p>
<p>I&#39;ll be offline for the next couple of days.&nbsp; Hope you continue to make good progress.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15913"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 23/10/2013 - 23:49.</div>
    <div class="content">
     <p>About Robin&#39;s point (1) - Two possibilities spring to mind: either the 9 V supply is not man enough for the job and the Arduino is pulling the voltage down below 9 V, or it is possible that it is misbehaving, like these USB power supplies tested two years ago by Trystan: <a href="http://openenergymonitor.blogspot.com/2011/08/not-all-usb-power-supplies-are-created.html">Not all USB power adapters are created equal.</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15937"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Fri, 25/10/2013 - 09:37.</div>
    <div class="content">
     <p>It seems that all my problems have steamed form the 9 volt power supplies that I bought from China, they are just not good enough. Can I run the Arduino from good quality 5 volt power supplies which I have enough of ??</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15938"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 25/10/2013 - 11:36.</div>
    <div class="content">
     <p>Someone with detailed Arduino knowledge will no doubt correct me, but as far as I know at least some of the Arduinos have an on-board 5 V regulator, so that an unregulated supply can be used. If that is the case with yours, and you are not using the higher voltage for anything, it should be relatively simple to remove the regulator and feed in your regulated 5 V at the appropriate place. If you&#39;ve got a circuit diagram of your particular board, you should be able to tell from that what needs doing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16062"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Thu, 31/10/2013 - 12:59.</div>
    <div class="content">
     <p>I have now bought 2 new 9 volt power supplies that actually work. For proof of working, my first test was to get the main box working as a standalone router (no wireless) running the&nbsp;Mk2_PV_Router_mini_3 sketech. My test setup is a 60 watt light bulb with the CT around one of the cores and a 40 watt light bulb connect to the output stage (Triac). When I turn the 60 watt lightbulb on, after about 20 seconds, the 40 watt light bulb comes on. I then reverse the CT and after about another 20 seconds (very roughly), the 40 watt light bulb goes out. I can keep doing this and the 40 watt light keeps coming on and off with evert CT reverse. Now, I think that this is working OK (I hope).</p>
<p>Now my next stage was to introduce the wireless circuitry and excactly the same is happening. I have the remote station with the 40 watt lightbulb connected and the primary station with the CT around the 60 watt lightbulb lead. If I reverse the CT, the light goes off and reverse it back, and the light comes back on.</p>
<p>I am doing this for a friend as I already have a non wireless router working on my own solar setup. My concern is that on my own setup, the more excess electric I produce which is used for my soak ( a heater) causes the LED (pin 13) to flicker. The more excess that I produce and use, the quicker the LED flickers. If I am producing no excess electric, the LED stays off. On my friends wireless remote station, the on LED (PIN 13, same as Arduino Uno on board red LED), does not come on no matter whether the 40 watt light bulb comes on or off (due to the CT being reversed).</p>
<p>Am I doing everything correct and is this working as it should be before I connect it up to my friends solar system.</p>
<p>TIA Don....</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16068"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 31/10/2013 - 15:09.</div>
    <div class="content">
     <p>OK, from the first two paragraphs everything seems to be working properly - excellent. [Note for next time: cheap power supplies can turn out to be very expensive in terms of everyone&#39;s time and effort!]&nbsp; As for the last paragraph, have you checked the remote sketch to see if Pin 13 is actually being driven by the logic? Does the LED work if you write a simple 2-3 line &quot;flasher&quot; sketch to test it? If you&#39;re using Robin&#39;s RF_for_Mk2_rx.ino, then Pin 13 is not the pin to use - see the comments and the pin allocation near the top of the sketch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16070"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 31/10/2013 - 16:37.</div>
    <div class="content">
     <p><em>My test setup is a 60 watt light bulb with the CT around one of the cores and a 40 watt light bulb connect to the output stage (Triac). When I turn the 60 watt lightbulb on, after about 20 seconds, the 40 watt light bulb comes on.</em></p>
<p>After 20 seconds, your 60W bulb will have consumed 1200 Joules.&nbsp; With all published versions of my Mk2 Router, the level in the energy bucket should reach 1800 Joules before the output stage can be activated.&nbsp; This suggests to me that your calibration is around 33% low.&nbsp; Mini_3 displays how much power is flowing through the CT.&nbsp; In your case, it&#39;s probably showing around 90 Watts for your 60W test bulb.&nbsp; Easily remedied by changing phaseCal.</p>
<p>Unless you arrange for some feedback to occur, you will not be able to see the system working so as to balance consumption with (simulated) generation.&nbsp; To do this, you need to feed these two circuits through your CT in opposite directions.&nbsp; You will also need to have a load which is greater that your source. otherwise the load once activated will remain on constantly.</p>
<p>A suitable test rig is shown near the end of Section 8 in the online article: <img alt="" src="http://openenergymonitor.org/emon/sites/default/files/mk2testrig.png" style="width: 714px; height: 438px;" /></p>
<p>&nbsp;</p>
<p>Hope this helps.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16072"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 31/10/2013 - 22:11.</div>
    <div class="content">
     <p><em>Robin: &quot;Easily remedied by changing phaseCal.&quot; </em>I don&#39;t think you mean that!&nbsp; POWERCAL surely?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16073"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1704" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Keith Walker&#039;s picture" title="Keith Walker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1704" title="View user profile.">Keith Walker</a> on Fri, 01/11/2013 - 00:05.</div>
    <div class="content">
     <p>Have you tried anti-flicker mode if your LED is flickering very fast?</p>
<p>Or maybe that version of the sketch doesn&#39;t have the anti-flicker mode.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16084"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 01/11/2013 - 16:02.</div>
    <div class="content">
     <p><em>Robin: &quot;Easily remedied by changing phaseCal.&quot; </em>I don&#39;t think you mean that!&nbsp; POWERCAL surely?</p>
<p>Yup, indeed I do :)</p>
<p><em>Have you tried anti-flicker mode if your LED is flickering very fast? Or maybe that version of the sketch doesn&#39;t have the anti-flicker mode.</em></p>
<p>The Anti-flicker option is only present in the Mk2a and Mk2i lines.&nbsp; When running in normal mode, the LED does flick pretty fast, but the rate of flicker is not a particularly good measure of the power that&#39;s being diverted.&nbsp; The easiest way to estimate the amount of diverted power is to count the number of cycles for which the triac has been &#39;on&#39;.&nbsp;</p>
<p>There are 50 x 60 x 60 = 180,000 mains cycles per hour.&nbsp; So every 60,000 &#39;on&#39; cycles with a 3 kW load represents 1 kWh of diverted energy.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16214"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Thu, 07/11/2013 - 07:25.</div>
    <div class="content">
     <p>in my own set up, which is a router running the mini_3 sketch, I find the LED which is the Arduino pin 13 very useful for a visual indication of when my panels are producing excess electric. When it is not flickering, I then know that I am not producing any excess.</p>
<p>with my friends wireless router(as detailed above in this forum) that I am building, is there a similar pin on the arduino&nbsp;that I can connect an LED to, which acts the same as the mini_3 sketch. I would like to have this LED for both the base and remote station&#39;s. These are both running the latest sketches by Robin. (mk2i rev 5b and rf for mk2&nbsp;rd) ??</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16220"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 07/11/2013 - 10:30.</div>
    <div class="content">
     <p>Don, in my mini_3 sketch, the on-board LED is simply used to show the state of the triac:</p>
<p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (energyInBucket &gt; (capacityOfEnergyBucket / 2))&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nextStateOfTriac = ON;&nbsp; // the external trigger device is active low<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(outputPinForLed, 1);&nbsp; // active high<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nextStateOfTriac = OFF;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(outputPinForLed, 0);&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // then set the Arduino&#39;s output pin accordingly,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(outputPinForTrigger, nextStateOfTriac);&nbsp;&nbsp; </em><br />
	&nbsp;</p>
<p>Because this build has no anti-flicker mechanism, the energy bucket&#39;s level is always close to the half-way point when surplus power is availble.&nbsp; Every time that another 60 Joules appears, the triac in turned on for at least one cycle, and a &quot;flick&quot; is seen at the on-board LED.</p>
<p>My Mk2i sketches can run in this way (i.e. &quot;normal&quot; mode), but they can also run in an anti-flicker mode.&nbsp; In AF mode, the interval between successive firings of the triac is much longer.&nbsp; The on board LED will correctly not show &quot;flicking&quot; if the triac is being constrained not to flick!</p>
<p>Whilst in AF mode, it can be helpful to know whether any surplus power is available. &nbsp; That&#39;s what the &quot;surplus power&quot; LED in Mk2i_rev5 is for:</p>
<p><em>const byte outputModeSelectorPin = 4;&nbsp;&nbsp; //&nbsp; for normal or anti-flicker mode<br />
	const byte loadPrioritySelectorPin = 5; //&nbsp; local or remote load to have priority<br />
	const byte underflow_LED = 6;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // non-essential, may have to be axed.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	const byte overflow_LED = 7;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	<strong>const byte surplusPV_LED = 8;&nbsp;&nbsp; </strong><br />
	const byte physicalLoad_0_pin = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // for trigger (active low)</em><br />
	...</p>
<p><strong><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (realEnergy_long &gt; 0) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Update the LED which shows whether there is<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(surplusPV_LED, 1); }&nbsp;&nbsp;&nbsp; // any surplus power.&nbsp; This is particularly useful<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // in anti-flicker mode when &#39;on&#39; periods<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(surplusPV_LED, 0); }&nbsp;&nbsp;&nbsp; // of the triac can be quite infrequent</em></strong><br />
	&nbsp;</p>
<p>For a per-mains-cycle indication of <u>surplus power</u>, just connect your LED (with a series resistor) between digital pin 8 and ground.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18166"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 04/02/2014 - 21:00.</div>
    <div class="content">
     <p>The most recent version of my Mk2i code, rev5b, will be used as the basis for various sketches to accompany my <a href="http://openenergymonitor.org/emon/node/3238">new hardware</a>.&nbsp; While refining this code, I&#39;ve found that it has not been well constructed for operating at any mains frequency other than 50 Hz.&nbsp;</p>
<p>Although my original Mk2 sketch had a <em>cyclesPerSecond</em> variable which was properly used, the hard-coded value &quot;50&quot; has crept into the interrupt-based version of this code in a number of places.&nbsp; Although this oversight is unlikely to affect the basic operation of the router, it did need to be sorted out.</p>
<p>By way of apology to anyone who may have been affected by this, here is an updated version (rev5c) in which there is a&nbsp; #define CYCLES_PER_SECOND 50&nbsp; statement which does &quot;just what it says on the tin&quot;.&nbsp; To run this code run in the USA where the mains frequency is 60 Hz, this value simply needs to be changed to &quot;60&quot;, that&#39;s all.&nbsp;</p>
<p>Mk2 PV Router code has always been calibrated in the same way, by means of the single variable, <em>powerCal</em>.&nbsp; This value is used to calibrate the hardware when measuring real power, which does not depend on frequency.&nbsp; The Mk2i code includes a calibration mode in which power is measured and displayed.&nbsp; If you were to run the rev5c code in Tallymode, and record the power drawn by a 40W light bulb, the result would be 40W regardless of the CYCLES_PER_SECOND setting.</p>
<p>So why does my PV Router code need to know the frequency of the mains?&nbsp; The answer is that that it works by measuring the amount of <u><strong>energy</strong></u> (not power) that is flowing in either direction, and all of its timing comes from counting mains cycles.&nbsp; If it were instead to repeatedly consult millis(), then a knowledge of the mains frequency would not be required by the code.</p>
<p>The measurement side of a Mk2 Router monitors the flow of energy at the supply point just as does the electricity meter.&nbsp; Every known type of meter has a &#39;sweet-zone&#39; within which energy can flow to and fro without charge or loss to the user.&nbsp; The Mk2 Router can only do its job properly if it is measuring energy <u>on the same scale as the meter does</u>. &nbsp; Hence it needs to know at what frequency the mains is running.</p>
<p>On a related theme, some meters in the UK (and no doubt elsewhere) have a sweet-zone that is less than 1 WattHour (i.e. 3600 Joules).&nbsp; Thus far, there has not been a tidy way to enter this value into my Mk2 Router code, but now there is.&nbsp; In the rev5c version, this value can be entered at the line:</p>
<p>#define SWEETZONE_IN_JOULES 3600&nbsp;&nbsp;&nbsp; ...&nbsp; and the size of the energy bucket will be set to match this value.&nbsp;</p>
<p>A few general improvements to the code have also been included in the rev5c version, as attached.&nbsp; As always, if you find any problems with this code, do please let me know.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18230"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="close20&#039;s picture" title="close20&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by close20 (not verified) on Thu, 06/02/2014 - 21:47.</div>
    <div class="content">
     <p>Hi Robin,</p>
<p>I&#39;m a total newbie, but with past computing experience (which I guess is a dangerous combination).&nbsp; I&#39;ve been trying to do some homework on your PV Router to convince myself that I can make it a core element of an energy strategy for a new build rural home. I&#39;m hoping to install a 9.75 kWp PV array on a nearby barn roof (I&#39;m guessing a maximum output of around 7.5kW) and I want to divert much of the output as possible to a thermal store to reduce the need to fire up a backup log fired boiler.&nbsp; Yesterday&#39;s homework suggests a thermal store with two 3kW immersions at the bottom, and one 3kW immersion near the top (first priority for quick warmup).&nbsp; I&#39;m thinking I&#39;d need the multiple loads to avoid flicker. This in turn lead me to <a href="http://openenergymonitor.org/emon/sites/default/files/Mk2i_PV_Router_rev5c.ino_.zip">Mk2i_PV_Router_rev5c.ino_.zip</a>&nbsp; which I&#39;ve been reading through.</p>
<p>I&#39;m trying to spot where my second and third immersion would actually be powered (digitalWrite) to no avail.&nbsp; Am I missing something (likely given my struggling understanding) or should I expect to convert physicalLoad_0_pin into a 3 element array (for my intended three immersions) and reference the pins in a loop?</p>
<p>Apologies if this is typical newbie stuff.</p>
<p>Robert</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18232"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5443" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="billt&#039;s picture" title="billt&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5443" title="View user profile.">billt</a> on Thu, 06/02/2014 - 22:26.</div>
    <div class="content">
     <p>It&#39;s fairly simple. You have to add physical load outputs for your extra load. So there are about 4 things you have to modify.</p>
<p>In Pinout assignments the original has only 1</p>
<p>const byte physicalLoad_0_pin = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // for trigger (active low)</p>
<p>add some more</p>
<p>const byte physicalLoad_1_pin = x;<br />
	const byte physicalLoad_2_pin = y;</p>
<p>You have to map these to the Arduino pins that you want to use</p>
<p>in void setup() add the 2 extra pins</p>
<p>pinMode(physicalLoad_1_pin, OUTPUT);<br />
	pinMode(physicalLoad_2_pin, OUTPUT);</p>
<p>below that (under the loop) add the lines to make the new outputs low at startup</p>
<p>digitalWrite(physicalLoad_1_pin, physicalLoadState[0]);<br />
	digitalWrite(physicalLoad_2_pin, physicalLoadState[0]);</p>
<p>then about line 980 add them to this section</p>
<p>// update all other physical loads<br />
	digitalWrite(physicalLoad_0_pin, physicalLoadState[0]);<br />
	digitalWrite(physicalLoad_1_pin, physicalLoadState[1]);<br />
	digitalWrite(physicalLoad_2_pin, physicalLoadState[2]);</p>
<p>&nbsp;</p>
<p>I&#39;ve used this scheme to drive 2 physical outputs and it works fine. This is a mod to drive 3, but I haven&#39;t got round to testing it yet.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18233"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 06/02/2014 - 22:39.</div>
    <div class="content">
     <p>Hi Robert, your multi-load arrangement sounds entirely reasonable to me.</p>
<p>The Mk2i rev5c sketch can control as many physical loads as you can find pins on the processor for.&nbsp; You wil just need to re-allocate a few pins that you can manage without, such as for LEDs.&nbsp; My rig at home doesn&#39;t use any LEDs, nor will my new hardware; I just have a neon to show when the load is on.&nbsp; Unlike an LED, the neon works when the over-ride switch is operated (and it doesn&#39;t consume any processor pins).</p>
<p>With multiple loads, each of 3 kW, you have an excellent setup.&nbsp; The rev5 logic will activate as many loads as are required to consume the available surplus power.&nbsp; If you have 7.5kW of SP, the first two loads will remain fully on and the third one will have a 50% duty-cycle.&nbsp;</p>
<p>The first physical load is controlled at line 978:</p>
<p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // update all other physical loads<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(physicalLoad_0_pin, physicalLoadState[0]);&nbsp;&nbsp;&nbsp;&nbsp;</em></p>
<p>Similar statements for your additional loads would just follow on here.&nbsp; The supporting logic is already in place, for as many loads as are defined at line 191:</p>
<p><em>const byte noOfDumploads = 2; // The logic expects a minimum of 2 dumploads,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // for local &amp; remote loads, but neither has to<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // be physically present. </em></p>
<p>I&#39;ve posted a multi-channel simulator which you might find of interest.&nbsp; I regularly use this to check out any new hardware; it&#39;s a bit more demanding than blink.ino.&nbsp; The section for this sketch on my <a href="http://openenergymonitor.org/emon/node/1757">Summary Page</a> reads:</p>
<p><strong>FlickerDemo_multiLoad_2</strong>.&nbsp;&nbsp; A max rate of change of surplus power has been added for realism.&nbsp; Overflow and underflow of the 3600J energy bucket are now properly detected and displayed.&nbsp; An ideal vehicle for playing around with different anti-flicker schemes.&nbsp; Posted on 27/1/13 at <a href="1637" title="http://openenergymonitor.org/emon/node/1637">http://openenergymonitor.org/emon/node/1637</a>, this tool is available at<br />
	<a href="../sites/default/files/FlickerDemo_multiLoad_2.ino_.zip" title="http://openenergymonitor.org/emon/sites/default/files/FlickerDemo_multiLoad_2.ino_.zip">http://openenergymonitor.org/emon/sites/default/files/FlickerDemo_multiL...</a></p>
<p>&nbsp;</p>
<p>Feel free to send me a PM if you get stuck.<br />
	&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18238"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="close20&#039;s picture" title="close20&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by close20 (not verified) on Fri, 07/02/2014 - 07:57.</div>
    <div class="content">
     <p>Excellent, many thanks to both responders; that resolves my concerns.&nbsp; I hope to develop some application specific algorithms to manage load priorities dependent on temperatures within the thermal store, hence my interest in clarifying how to modify the load drivers.&nbsp; However, I suspect I need to read more of your web site before bothering you in future.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18358"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="euclapi&#039;s picture" title="euclapi&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by euclapi (not verified) on Wed, 12/02/2014 - 12:01.</div>
    <div class="content">
     <p>hello,</p>
<p>First of all i have to thank everyone in this mk2 proyect and specially Robin Emley.</p>
<p>i tried to read everything to do not ask things already asked, im trying to use the mk2 with several outputs, there is a old coment that says that robin edit a sketch managing 5 outputs, while the first 4 were in anti-flicker mode and the 5th when it turned on changed to normal mode. Im sorry but i cannot find that sketch anywhere. Even i tried to add those lines written up of my comment and i cannot control them with diferent energy divert. If someone could edit a sketch to be able to use the pin 9 as a normal mode and while the energy is growing start diferent pins 11, 12 with a relay 5vdc from arduino to start diferent watts machines and write a minimum of time to be working to avoid starts and stops.</p>
<p>In this forum i read that sometimes it exports a little, in my case every 5 minutes flash once, and as in spain they are going to look for the pv systems i would like change that correction to be consumed instead of exported.</p>
<p>Sorry that i cannot apport a lot but i will give it in the attacked photo is my version:</p>
<p>I am not a good programer so i couldnt calibrate the powercal, phasecal and other calibrations so i added potentiometer instead of resistors and with the sketch minandamch, range etc... i tune them to the maximum of the wave span and the ct to be in 512 exactly.</p>
<p>as you see in the right side is a supposed ACS712ELC-30A current sensor bought in ebay so its real a ACS712ELC-05B of only 5 amps, could i use it instead of the ct clamp? i know that the problem would be that all the current of the house pass thought that little cable but if manage to use relays i could use it only when the pv system is working during the day only and wont be importing more than 1kw.</p>
<p>Thanks in advice for any help.</p>
<p><img alt="" src="http://openenergymonitor.org/emon/sites/default/files/IMG_20140212_124732.jpg" style="width: 576px; height: 768px;" /></p>
<p><em>Post edited by mod - Paul</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18359"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 12/02/2014 - 13:58.</div>
    <div class="content">
     <p>hola euclapi,</p>
<p>It is always good to see a photo of some tidy hardware, especially if is running code that I have written!</p>
<p>My Mk2i rev5 code can control as many dump-loads as you wish.&nbsp; All of these loads will operate in the same mode, either normal or anti-flicker.&nbsp; If there is enough surplus power for several loads, then most of them will remain on continuously; only one load will cycle &#39;on&#39; and &#39;off&#39; to maintain the balance.&nbsp;</p>
<p>The operation of this logic can be easily seen using a <a href="http://openenergymonitor.org/emon/sites/default/files/FlickerDemo_multiLoad_2.ino_.zip">simulator sketch</a>, which I posted on 27/1/13 on <a href="http://openenergymonitor.org/emon/node/1637">this thread</a>.</p>
<p>In order to divert surplus power, the CT for your Mk2 PV Router must be clipped around one of the supply lines next to the meter.&nbsp; It&#39;s not a problem if there is a large amount of imported power at certain times of the 24-hour period.&nbsp; The processor will just ignore it.&nbsp; When the sunshine returns, and the house starts to export again, your Router will spring back into life.&nbsp;</p>
<p>There should be no need to ever switch the system off.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18373"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/2888" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/2888" title="View user profile.">Tinbum</a> on Wed, 12/02/2014 - 20:02.</div>
    <div class="content">
     <p>Hi euclopi, you are possibly referring to a sketch that Robin did for me some time ago that&nbsp;I then modified for my own use. I run battery chargers in antiflicker mode as my first loads and then further loads in a nearly &#39;normal&#39; mode&nbsp;This sketch has now got&nbsp;somewhat more&nbsp;complicated with some 10 loads and with some&nbsp;loads timed with on delays and off delays. It is also&nbsp;more complicated with&nbsp;a sequence where my first 3 loads come on in sequence then they go off and 4 comes on. 1,2,3 then come on again in sequence and then 5 comes on and 1,2,3 go off and then back on again in sequence etc etc.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19279"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5699" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Paul&#039;s picture" title="Paul&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5699" title="View user profile.">Paul</a> on Sat, 15/03/2014 - 14:10.</div>
    <div class="content">
     <p><!--[if gte mso 9]><xml>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--></p>
<p><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-GB</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
  </w:Compatibility>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-GB</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
  </w:Compatibility>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-fareast-language:EN-US;}
</style>
<![endif]--><!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-fareast-language:EN-US;}
</style>
<![endif]--></p>
<p class="MsoNormal">Hi Robin,</p>
<p class="MsoNormal">First my congratulations on such a worthy enterprise,</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">I have created the mk2i using a breadboard atmega328 (uno bootloader) using the mk2i-rev5c sketch the problem I have encountered is that with no wires going through the Current sensor it is briefly firing the triac every few seconds; if I put a 60w bulb through the current sensor it stops or gets faster depending on the direction of the wire so it believes there is current flow when there isn&rsquo;t.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">If I use the mk2 mini rev 3 sketch with no wires through the sensor it displays a positive value fluctuating between 40 and 60.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">I have created a circuit board with new components (except for the SCT013-000 <span style="mso-spacerun:yes">&nbsp;</span>and the transformer a spiratronics 230-9v-9v) <span style="mso-spacerun:yes">&nbsp;</span>with exactly the same results and have even used a arduino uno in place of my breadboard atmega328 with the same results.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">I have obviously gone wrong somewhere and have checked every connection and component but can&rsquo;t see where the problem is so the questions is where have I gone wrong and where should I start looking for this problem?</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">Saying thanks in advance</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19340"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 17/03/2014 - 07:49.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Any measurement system of the type we use is likely to contain some residual error, or drift.&nbsp; In my experience, it&#39;s never been more than around 1 Watt.&nbsp; It all depends where the quiescent point for the current sensor lies within the ADC&#39;s input.&nbsp; Over time, a small positive drift can disappear or become negative, but its magnitude should never be more than a Watt in either direction.</p>
<p>With an installed system, this level of background drift is not a problem, but on a test rig it can feel as though something is wrong.&nbsp; If the dump-load in your test rig is only small, each firing of the triac will have very little effect, so the triac is likely to fire quite frequently.&nbsp; If your load is a 3kW heater, then each firing of the triac is 60 Joules.&nbsp; The Mk2i code prevents the triac from changing state on consecutive mains cycles, so each &#39;on&#39; burst would be at least 100 Joules (with a 2kW load or greater).</p>
<p>If you run RawSamplesTool_4ss_2, the raw sample values from your sensors will be displayed.&nbsp; With no current flowing, the samples for &#39;current&#39; should show very variation.&nbsp; If that sample stream is not stable, that would suggest your input circuit is not working correctly.&nbsp; Are you using a buffered reference or the standard passive circuit?&nbsp; These two circuits stabilise the signal in different ways&nbsp; but they should both give very similar results, and minimal drift.</p>
<p>Hope this helps.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19341"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 17/03/2014 - 08:42.</div>
    <div class="content">
     <p>Re-reading your post, Paul, it seems that you&#39;re using a 3kW load already.&nbsp; And the 40W offset using the &quot;mini_3&quot; sketch definitely doesn&#39;t look right.&nbsp; Have you checked that your voltage and current sensors are using most of the available input range at the ADC?&nbsp; My <a href="http://openenergymonitor.org/emon/node/1757">MinMaxAndRangeChecker</a> tool can do this for you.&nbsp; If your system is configured for 100A max, then it will not be able to measure the current that&#39;s taken by your 60W bulb with any accuracy - which could result in a high level of background drift.</p>
<p>On the Downloads Page of my new <a href="http://www.mk2pvrouter.co.uk/">website</a>, there is a calibration program which you could try running.&nbsp; You&#39;ll need to reinstate the relevant pin numbers for your voltage and current sensor.&nbsp; That cal program will display (via the Serial Monitor) the power that&#39;s flowing through the sensor each second.&nbsp; I wouldn&#39;t expect it to give any different result than &quot;mini_3&quot;, but various loose ends have been tidied up in this latest code.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19347"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 17/03/2014 - 13:47.</div>
    <div class="content">
     <p>It&#39;s also worth noting that the emonTx V3 design has paid close attention to screening, grounding and filtering to separate the digital and analogue parts of the circuit, and it performs significantly better than the V2 at low currents. If you have your own breadboard layout, it may help to look carefully at this aspect. There are useful application notes on the Atmel website.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Kasumi_29&#039;s picture" title="Kasumi_29&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by Kasumi_29 (not verified) on Mon, 17/03/2014 - 18:24.</div>
    <div class="content">
     <p>I have recently fitted one of calypso_rae Mk2 Router systems and have to say I am very pleased with the system. I have a 170 litre hot water tank with immersion, though I do benefit from having mains gas too.</p>
<p>Throughout the enquiry and ordering process communication has been swift and very helpful. I purchased a completed system and it arrived within two days. The system looked quite impressive straight out the box, with all switches and lamps professionally labeled.</p>
<p>Install took a matter of an hour or so and then the system was up an running.</p>
<p>So in summary, can thoroughly recommend this system&nbsp;to all those thinking about &nbsp;diverting energy to heat an&nbsp;immersion tank.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19387"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5699" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Paul&#039;s picture" title="Paul&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5699" title="View user profile.">Paul</a> on Tue, 18/03/2014 - 16:55.</div>
    <div class="content">
     <p><!--[if gte mso 9]><xml>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--></p>
<p><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-GB</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
  </w:Compatibility>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-GB</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
  </w:Compatibility>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-fareast-language:EN-US;}
</style>
<![endif]--><!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-fareast-language:EN-US;}
</style>
<![endif]--></p>
<p class="MsoNormal"><a name="_MailAutoSig">Hi Robin,</a></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">&nbsp;</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">Thanks for responding, I decided to go ahead and complete the installation and check the supply meter in conjunction with my eco-eye energy monitor; the red anti creep led <span style="mso-spacerun:yes">&nbsp;</span>on the supply meter remained lit even when the eco-eye monitor was showing an import of energy (from the bucket) so based on this <span style="mso-spacerun:yes">&nbsp;</span>I would say it was working as you have designed, I just can not explain what I was seeing with my test rig, I will <span style="mso-spacerun:yes">&nbsp;</span>order up another CT and check it out again when I finish integrating my modifications.</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">&nbsp;</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">The stats from my eco-eye monitor will be incorrect as they will show transfers from the bucket as imported energy but a small price to pay for the extra hot water.</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">&nbsp;</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">As an FYI my configuration is 12 SunPower SPR327 &ndash; 3.92kWp (9 SE facing 3 SW) Solar Edge SE4000-16 with P500 optimizers on each panel) <span style="mso-spacerun:yes">&nbsp;</span>I also have installed 2 Solar Thermal panels which heat a 250 litre Hot water tank, the immersion heater heats the top third of the tank. </span><a href="http://www.kirkstone.me.uk/RMsolar/RMsolar-index.html"><span style="mso-bookmark:_MailAutoSig">http://www.kirkstone.me.uk/RMsolar/RMsolar-index.html</span></a><span style="mso-bookmark:_MailAutoSig"> </span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">&nbsp;</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">I was thinking of modifying your code to add a real time clock which would boost the top of the tank during the winter months first thing in the morning (I am on an economy 7 <span style="mso-spacerun:yes">&nbsp;</span>Tariff); <span style="mso-spacerun:yes">&nbsp;</span>The Solastat controller (Solar Thermal) will call for a secondary boost if the temperature in the tank drops below a preset value, up to now I have used a clock timer and a big relay <span style="mso-spacerun:yes">&nbsp;</span>to do this however <span style="mso-spacerun:yes">&nbsp;</span>I would like <span style="mso-spacerun:yes">&nbsp;</span>use the RTC to set a window to monitor secondary boost and if its active to trigger the triac, any pointers in how to do this or where would be the best place in your code to insert the new code would be appreciated. I am not sure the atmega328 will have the resources, but no harm trying, either way I have left enough space in the box to add another piece of circuitry as a plan B.</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">&nbsp;</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">Photo shows today&rsquo;s hot water boost to 75 Deg C</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">&nbsp;</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">Regards</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">&nbsp;</span></p>
<p class="MsoNormal"><span style="mso-bookmark:_MailAutoSig">Paul</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19394"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 18/03/2014 - 19:21.</div>
    <div class="content">
     <p>Paul,</p>
<p>When the Mk2 system is operating, the supply meter&#39;s LED is usually on, but not always.&nbsp; If you turn on a high load such as a kettle to consume all surplus power, and then turn it off just before the next charge pulse is due, you&#39;ll most likely find that your Mk2 system springs into action while the LED remains off.&nbsp;</p>
<p>During normal use, the LED is more likely to be &#39;on&#39; if an AF regime is being used.&nbsp; That&#39;s because the energy bucket needs to fill more than half-way before the output stage is activated.&nbsp; If the router were to record each pulse at the meter during periods of consumption, it would then know precisely when the output could be safely turned on.&nbsp; In that case, no loss of energy should ever occur and LED would never be continuously on.</p>
<p>The Eco Eye assumes that the mains voltage is a constant value, so that&#39;s once source of inaccuracy.&nbsp; Also, I doubt if it measures energy flow continuously, so it is likely to be upset by bursts of power being diverted by a Router system.</p>
<p>I have no doubt that the Atmega will be able to do anything you ask of it.&nbsp; With the interrupt-based code that you&#39;re using, the processor spends much of its time in the idle state.&nbsp;</p>
<p>How best to operate a Router system alongside Economy 7 is very weather dependent.&nbsp; On a good day, the router will provide ample hot water so its best not to pre-heat it with E7.&nbsp; But on a poor day, the solar heating may not be sufficient in which case you&#39;d end up needing to give the tank an end-of-day boost by some means that&#39;s more expensive than the E7 would have been.&nbsp; My mum has exactly this dilemma with her thermal-solar panels, an oil-fired boiler, and E7.</p>
<p>In my latest Mk2 sketch (Downloads page on the <a href="http://www.mk2pvrouter.co.uk/">website</a>), I&#39;ve provided a simple RTC function based on the periods when surplus power is available.&nbsp; My &quot;day&quot; starts when the first burst of power is diverted, and ends 10 hours after the final contributon of the day.&nbsp; That way, there&#39;s no setting up to do.&nbsp; Whether the displayed total clears down at midnight or 4am is not of importance to most users.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19401"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5699" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Paul&#039;s picture" title="Paul&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5699" title="View user profile.">Paul</a> on Tue, 18/03/2014 - 21:30.</div>
    <div class="content">
     <p>Hi Robin,</p>
<p><!--[if gte mso 9]><xml>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--></p>
<p><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-GB</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
  </w:Compatibility>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:View>Normal</w:View>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves/>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-GB</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:EnableOpenTypeKerning/>
   <w:DontFlipMirrorIndents/>
   <w:OverrideTableStyleHps/>
  </w:Compatibility>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]--><!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-fareast-language:EN-US;}
</style>
<![endif]--><!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-ascii-theme-font:minor-latin;
	mso-hansi-font-family:Calibri;
	mso-hansi-theme-font:minor-latin;
	mso-fareast-language:EN-US;}
</style>
<![endif]--></p>
<p class="MsoNormal">I have the same problem as your mother which is why I topped up the tank with E7 an hour before the E7 period finished and if no solar during the day I kicked off the oil boiler early evening so I had one timer for the E7 and another timer for the oil boiler.</p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal">In your new code where you use a lcd display, <span style="mso-spacerun:yes">&nbsp;</span>is <span style="mso-spacerun:yes">&nbsp;</span>there some reason why you didn&rsquo;t use a I2C LCD, <span style="mso-spacerun:yes">&nbsp;</span>this only uses 2 wires SCL(A5) and SDA(A4) not only that you can have a multitude of devices on the same pair; for example <span style="mso-spacerun:yes">&nbsp;</span>I run a 2 line LCD Dsplay and a DS1307RTC for a differential Solar Controller, using I2C freed up all my digital pins.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19403"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 18/03/2014 - 21:52.</div>
    <div class="content">
     <p>I&#39;d never used any kind of display before so went for a simple persistence-based one.&nbsp; Yes, it requires a lot of pins, but it does the job and takes up a minimum of processor time.&nbsp;</p>
<p>With an interrupt-based sampling regime, and RF, I&#39;d be rather wary about dropping additional workloads on the processor.&nbsp; But maybe all these aspects have been taken care of and it would be fine.&nbsp; With a PCB and ribbon cable, it&#39;s just as easy to wire up 12 pins as 2.</p>
<p>On my new board, if the RF facility is not required, all five of its driver pins are available at a SIL connector. These could then be used for other purposes.&nbsp; Digital 3, the other interrupt line. is also wired to a connector point alongside a ground pin.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20619"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5699" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Paul&#039;s picture" title="Paul&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5699" title="View user profile.">Paul</a> on Tue, 08/04/2014 - 21:29.</div>
    <div class="content">
     <p>Hello all,</p>
<p>Just wanted to share with you my ATmega328 PV Dump configuration.</p>
<p>My requirement was a Mk2i PV Router to heat up the top of my hot water tank with any surplus going to an oil filled electric radiator in my office using the rf modules (RFM12B), I did not want to use an Arduino Uno in the units as it&rsquo;s a bit overkill hardware wise as adding just a few extra components to an ATMega328p with an uno bootloader you effectively get an Arduino Uno. I purchased a CH340 USB to Serial adapter from ebay so I could program the atmega328 using the Arduino IDE.</p>
<p>The next hurdle was to find a circuit diagram; as previously mentioned in the forum there is no single circuit diagram to aid with this configuration; the information exists in various places on this forum and needs to be cobbled together. As my memory is not at its best I thought I would produce a set of circuit diagrams against future problems (Disclaimer: I believe I have incorporated the information from various sources correctly into my circuit diagrams, use them at your own risk) if you find an error please let me know and I will update them.</p>
<p>The only problem I had was that the RFM12B module in the Mk2i_PV_Router&nbsp; was defective and there was no error message indicating a malfunction, very hard to debug as all the sketches rely on having two working units.</p>
<p>The Code I used was Mk2i_PV_Router_rev5c and RF_for_Mk2_rx&nbsp;</p>
<p>Credit Goes to Robin Emley for this amazing project and Griff Thomas for his iphone psu idea which I used in the receiver, cheaper than buying the parts to make one (My circuit diagrams show a traditional ac-dc supply)</p>
<p>&nbsp;</p>
<p>Regards</p>
<p>&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20627"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 09/04/2014 - 08:08.</div>
    <div class="content">
     <p><em>Paul: The only problem I had was that the RFM12B module in the Mk2i_PV_Router&nbsp; was defective and there was no error message indicating a malfunction, very hard to debug as all the sketches rely on having two working units.</em></p>
<p>By this, I take it that the particular RFM12B module which you were using was found to be defective.&nbsp; I&#39;m not aware of any such defect in the design of my Mk2i_PV_Router!</p>
<p>To start with, when you have just two RF units, it is indeed difficult to trace problems when nothing seems to be happening.&nbsp; I now have a dedicated receiver unit for both 433 and 868 MHz so can easily check any new boards that I build.&nbsp; In due course, if I start to supply pre-built receiver units too, a similar approach will no doubt be employed.</p>
<p>On my latest version of the <a href="http://www.mk2pvrouter.co.uk/media/9f90a11b4c266db5ffff8064d4355564.pdf">processor board</a>, I&#39;ve gone for 3.3V throughout rather than 5V.&nbsp; There is therefore no need for a dropper stage for the RF module.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20639"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5699" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Paul&#039;s picture" title="Paul&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5699" title="View user profile.">Paul</a> on Wed, 09/04/2014 - 18:13.</div>
    <div class="content">
     <p>Robin,</p>
<p>&nbsp;</p>
<p>Correct, it was a hardware problem with the RFM12B.</p>
<p>I know the Mk2 can handle multiple loads that are physically attached to it, the question is, can the code handle more than one RFM12B loads? if yes what changes would I have to make?</p>
<p>I went the extra mile using 5V for the ATmega328 rather than overclock (a good write up here :- <a href="http://electronics.stackexchange.com/questions/58818/programming-3-3v-atmega328-running-at-16mhz">programming-3-3v-atmega328-running-at-16mhz</a> ); yes I know everyone does it but with my luck if I did I would be the exception.</p>
<p>&nbsp;</p>
<p>Regards</p>
<p>&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20652"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 09/04/2014 - 19:48.</div>
    <div class="content">
     <p><em>I know the Mk2 can handle multiple loads that are physically attached to it, the question is, can the code handle more than one RFM12B loads? if yes what changes would I have to make?</em></p>
<p>Although I&#39;ve never tried it, the answer is most certainly &quot;yes&quot;.&nbsp; You would just need to add an extra field into the message payload to convey the state of each extra load.&nbsp; A byte for each new &#39;channel&#39;, or even just a bit, would be fine for this purpose.&nbsp;</p>
<p>All of the multi-channel logic is already in place.&nbsp; At the remote end, the receiver would just need to listen for its own instructions, and then turn its load on &amp; off as instructed.</p>
<p><em>I went the extra mile using 5V for the ATmega328 rather than overclock</em></p>
<p>Until it was mentioned here recently, I&#39;d not realised that using a 16MHz clock at 3.3V is outside the guidelines of the processor.&nbsp; I&#39;ve just bought a few 12MHz crystals and intend to have a play with these soon. &nbsp;&nbsp; For most purposes, the slower clock speed should not be a problem.</p>
<p>In the case of my Mk2i code, the fixed timer would need to be extended in order to accommodate the increased duration that each ADC conversion would take.&nbsp; That would result in fewer sets of samples per mains cycle, but there should be no noticeable difference in the system&#39;s behaviour. &nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20698"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5699" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Paul&#039;s picture" title="Paul&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5699" title="View user profile.">Paul</a> on Fri, 11/04/2014 - 16:16.</div>
    <div class="content">
     <p>Thanks Robin,</p>
<p>&nbsp;</p>
<p>Looks like I will have to order some more parts :)</p>
<p>&nbsp;</p>
<p>Regards</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20965"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 22/04/2014 - 17:33.</div>
    <div class="content">
     <p>Here is Revision 6 of the Mk2i code.&nbsp; The two main upgrades from previous versions are:</p>
<p>1) the use of a second current sensor so that diverted power can be accurately measured;</p>
<p>2) the routine transmission of an all-integer payload via RF for use by emonCMS.&nbsp;&nbsp;</p>
<p>In many ways, this version is more similar to rev4 than rev5.&nbsp; Like rev4, it supports only one dump load, and has two energy thresholds for its anti-flicker algorithm rather than one.</p>
<p>Some items that were in previous builds are no longer supported.&nbsp; These include the LEDs, the free-running mode of operation, Tallymode and phaseCal.&nbsp;&nbsp; As the overall structure of the code has not changed, any of these features could be easily re-introduced if required.</p>
<p>A datalog file, with annotations, is also attached.&nbsp; This data was captured yesterday using an emonTx-based rig while &#39;live&#39; surplus power was being diverted.&nbsp; The second column demonstrates how the average flow of energy at the supply point is zero.&nbsp; Some photos of the rig are attached.</p>
<p>Similar code is available from my <a href="http://mk2pvrouter.co.uk/">website </a>as Mk2_RFdatalog_1.ino&nbsp; That version also supports a 4-digit display for which two extra logic chips are required.&nbsp; Together, the display and RFM12B use up all of the available IO pins which is why LEDs are no longer supported.&nbsp; IMHO, a neon does a better job anyway, as shown in my recommended <a href="http://mk2pvrouter.co.uk/media/f38a139f4c26bb68ffff813fd4355564.pdf">wiring diagram</a> for Mk2 systems.</p>
<p><em>PS. If anyone would like to purchase this rig, it is available for &pound;60 (or &pound;45 without the two CTs).&nbsp; With everything screwed down to the board, it is a fully working emonTx-based Mk2 Router with datalogging which will divert surplus power straight-out-of-the-box. &nbsp; I would include a better heatsink and would replace the emonTx by a tidier one which has not been repaired.&nbsp; Postage would be &pound;5.&nbsp; If interested, please send me a PM.</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21897"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 09/06/2014 - 13:45.</div>
    <div class="content">
     <p>I recently started a <a href="http://openenergymonitor.org/emon/node/5244">new thread</a> about how continuous sampling can become disrupted if the RFM12B module is used in a certain way.&nbsp; In that thread, I reported that delaying the sleep command by a few milliseconds was a viable workaround. The library routine, <em>rf12_sendWait()</em> is a blocking function so is not suitable for code which needs to monitor continuously.</p>
<p>Since then, I have re-visited both the Rev5 and rev6 versions of my Mk2i PV Router code, each of which use the RF facility and require monitoring of the voltage and current sensor(s) to be continuous.&nbsp; With the sleep command delayed, the outcome was better, but not perfect; RF transmissions do still appear to affect the underlying data to some extent.&nbsp; The effect is somewhat variable, and I have not been able to pin down the precise cause.</p>
<p>Updated versions of each these code lines are attached:&nbsp; rev5c has become rev5d (for controlling a remote dump load via an RF-link), and rev6 has become rev_6a (for datalogging via RF)</p>
<p>In each case, the RFM12 is now kept in an active state rather than being routinely sent to sleep.&nbsp; I have also used the Jeelib routine <em>rf12_sendNow() </em>rather than <em>rf12_sendStart() </em>because it appeared to cause less disturbance to background powr readings.</p>
<p>For the Mk2-with-datalogging sketch, rev6a, I have inverted the sense of the transmitted data in order to align with the OEM standard.&nbsp; Import at the supply point is now reported as +ve rather than -ve.&nbsp; Diverted energy is still reported as being positive.&nbsp; This change in convention can be seen in the attached results file.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22139"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Tue, 24/06/2014 - 06:48.</div>
    <div class="content">
     <p>I am currently running a mk2 mini_3 router and need to upgrade to a multi load router with a primary load and secondary load. Has anyone managed to amend Robins mk2i rev5x sketch to allow multiple loads. Robin says that this can be done easily by modifying the sketch and removing the RF code but I am no programmer. If anyone does have this modified code, I would be eternally grateful if I could have a copy.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22153"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 24/06/2014 - 10:50.</div>
    <div class="content">
     <p>I don&#39;t quite understand what you want to do. Is it: Remove the code for sending the commands to the second load by radio, and substitute driving an output pin in exactly the same way as the first load is driven (but of course using the second load logic)?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22158"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 24/06/2014 - 11:51.</div>
    <div class="content">
     <p>Yes, Robert, I think that&#39;s the general idea.&nbsp; To drive a secondary load by wire (rather than by RF) just requires another IO pin to be allocated and set up for this purpose, in exactly the same way as the first one.&nbsp; Then, at the point where Load 0 is instructed whether to be on or off, Load 1 will be instructed likewise.&nbsp; In my latest version of the Mk2i Rev5 code, which is rev5d, this is at line 991</p>
<pre>
// update all other physical loads
          digitalWrite(physicalLoad_0_pin, physicalLoadState[0]);</pre><p>Although the Mk2i rev5 code has the logic for multiple loads, it also includes the capability for using RF.&nbsp; If RF is not required, a tidier approach may be to use the equivalent code from my website, at <a href="http://www.mk2pvrouter.co.uk">www.mk2pvrouter.co.uk</a>&nbsp;&nbsp;</p>
<p>The sketch, <strong>Mk2_multiLoad_CAT5_2.ino&nbsp;</strong> on my Downloads page supports several outputs for&nbsp; wired loads but does not include any RF overhead.&nbsp; This sketch is primarily intended to run on my own PCB, but can be run on any other Atmega 328 platform by just changing the IO pin allocations as necessary.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22161"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 24/06/2014 - 12:15.</div>
    <div class="content">
     <p>I was thinking of doing the change for &#39;thewaver&#39;, but as he&#39;s admitted he doesn&#39;t program, &quot;full and final details to enable us to proceed&quot; are in order!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22169"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 24/06/2014 - 15:34.</div>
    <div class="content">
     <p>I think everyone in this place should be prepared to have a go at modifying sketches for themselves.&nbsp; It&#39;s the best way to learn.&nbsp; If they run into difficulties, plenty of help is available.&nbsp;</p>
<p>Ready-to-go Mk2 PV Router systems of various types are available via my <a href="http://mk2pvrouter.co.uk/13779.html">online Shop</a>.&nbsp; These will be supplied with whatever software modifications (within reason!) that the customer would like :-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22170"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 24/06/2014 - 15:49.</div>
    <div class="content">
     <p><em>&quot;I think everyone in this place should be prepared to have a go at modifying sketches for themselves.&quot;</em> Agreed, and recognising that this is for the most part a constructors&#39; site, I have a reading list (which should be found with a search for &quot;learning C++&quot; - I&#39;ve posted it many times) that will help. But unfortunately some seem to be daunted by the concept or haven&#39;t the time to commit to learning.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22178"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Wed, 25/06/2014 - 03:23.</div>
    <div class="content">
     <p>Hi Robert, you are spot on, I really don't want to learn to program at the age of 60 just so I can add a secondary load to an already working sketch. From what I have read in these forums, the coding is already in place but needs tweaking to get it to work for my scenario. I am using the arduino running on a pcb kit which I bought from this forum and using the mini_3 sketch. I have been told that the mk2i rev5b sketch could be easily tweaked to fit my request and all I asked was has someone already done this and would they be willing to help me with the programming. I am quite willing to pay for a pint or two for someone's efforts.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22182"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 25/06/2014 - 09:25.</div>
    <div class="content">
     <p>Don, as I mentioned yesterday, the sketch that you&#39;re looking for can be downloaded from my website.&nbsp; Then you just need to change the IO pins to whatever you want.&nbsp;</p>
<pre>
// allocation of digital pins when pin-saving hardware is in use
// *************************************************************
// D0 &amp; D1 are reserved for the Serial i/f
const byte physicalLoad_2_pin = 2;  // &lt;-- to control an additional load 
const byte loadPrioritySelectorPin = 3; // &lt;-- this is the &quot;mode&quot; port 
<strong>const byte physicalLoad_0_pin = 4;  // &lt;-- this is the &quot;trigger&quot; port 
</strong>// D5 is the enable line for the 7-segment display driver, IC3
// D6 is a data input line for the 7-segment display driver, IC3
// D7 is a data input line for the 7-segment display driver, IC3
// D8 is a data input line for the 7-segment display driver, IC3
// D9 is a data input line for the 7-segment display driver, IC3
<strong>const byte physicalLoad_3_pin = 10;  // &lt;-- to control an additional load 
const byte physicalLoad_5_pin = 11;  // &lt;-- to control an additional load 
const byte physicalLoad_1_pin = 12;  // &lt;-- to control an additional load 
const byte physicalLoad_4_pin = 13;  // &lt;-- to control an additional load 
</strong>
// allocation of analogue pins
// ***************************
// A0 (D14) is the decimal point driver line for the 4-digit display
// A1 (D15) is a digit selection line for the 4-digit display, via IC4
// A2 (D16) is a digit selection line for the 4-digit display, via IC4
const byte voltageSensor = 3;          // A3 is for the voltage sensor
const byte currentSensor_diverted = 4; // A4 is for CT2 which measures diverted current
const byte currentSensor_grid = 5;     // A5 is for CT1 which measures grid current</pre><p>At the age of 59, I can&#39;t be doing everything for everyone!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22184"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Wed, 25/06/2014 - 13:26.</div>
    <div class="content">
     <p>Hi Robin,</p>
<p>I have been studying your sketch, especially the section you have detailed above and I am not sure that I would only have to reallocate the digi I/O pins. My rig is wired as your diagram: <a href="http://openenergymonitor.org/emon/sites/default/files/Mk2_CircuitSchematic.pdf" title="http://openenergymonitor.org/emon/sites/default/files/Mk2_CircuitSchematic.pdf">http://openenergymonitor.org/emon/sites/default/files/Mk2_CircuitSchemat...</a> and there seem to be differences in the AN pins between the mini_3 sketch and your new Mk2_multiLoad_CAT5_2 sketch.</p>
<p>It seems like you have pins AN1 and AN2 doing something different to the mini_3 sketch....or am I reading this completely wrong</p>
<p>I originally thought that I could replace my mini_3 sketch ith your Mk2_multiLoad_CAT5_2 sketch and change my current primary load from digi pin 9 (physical connection) to digi pin 12</p>
<p>&#39;const byte physicalLoad_1_pin = 12;&nbsp; // &lt;-- to control an additional load&#39;,</p>
<p>and then add my secondary load to digi pin 2</p>
<p>&#39;const byte physicalLoad_2_pin = 2;&nbsp; // &lt;-- to control an additional load&#39;</p>
<p>If I do it this way, then I am assuming that I won&#39;t have to alter any of the code, or do I ??</p>
<p>It would be extremely helpful if you could show how the finished modified code would look to run my rig.</p>
<p>At 60 years of age, I dont think that I would be able to start learning how to program as my powers of retention are disappearing. I am guessing that you started to program many years ago and I do agree that you cant be doing everything for everyone. You have been really helpful in the past and guided me through the stages involved with enabling my PV system to operate perfectly with your mini_3 sketch, to which I owe you. Thank you very much for all your help and time.</p>
<p>Thanks Don</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22188"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 25/06/2014 - 20:31.</div>
    <div class="content">
     <p><strong><em>I</em></strong> think you&#39;re both spring chickens. I started programming with Fortran IV in the early 1980s, and I&#39;m now getting to grips with Linux as an OS. I readily admit that it&#39;s easier to take on board a new one when you have met a few before, be they languages or OS&#39;s.</p>
<p>Robin&#39;s view is it would be safer for you to use the CAT5_2 sketch, and I&#39;d support that, even though I understand that you have a working sketch and that you think you will feel safer extending that.&nbsp;</p>
<p>The important things are the input pins and the output pins. Robin has changed the input pins around to suit his new pcb layout, so those will need changing back. That leaves the output pins. If you tell us which output pin you want to use for the second load, it&#39;s easy to tell you which lines of code to change.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22192"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Thu, 26/06/2014 - 08:51.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Well, I certainly don&#39;t feel like a spring chicken, more like an old rooster!!</p>
<p>Thank you for your very kind offer:</p>
<p>My current rig running the mini_3 sketch is wired as the following diagram:</p>
<p><a href="http://openenergymonitor.org/emon/sites/default/files/Mk2_CircuitSchematic.pdf" title="http://openenergymonitor.org/emon/sites/default/files/Mk2_CircuitSchematic.pdf">http://openenergymonitor.org/emon/sites/default/files/Mk2_CircuitSchemat...</a></p>
<p>You will see that my current load (will become primary) is connected to Digi&nbsp;pin 9. If there is no reason why it is not&nbsp;possible, could my secondary load be connected to digi pin 10.</p>
<p>I have already made the second triac circuit ready to operate the secondary load.</p>
<p>One question, when the primary load is satisfied and it &#39;flicks&#39; over to the secondary load, will it revert back to the primary load if it demands &#39;topping up&#39;?</p>
<p>Many thanks, Don...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22193"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 26/06/2014 - 09:05.</div>
    <div class="content">
     <p>When laying out my PCB, I found that it was better for me to use the higher numbered analog IO pins for the voltage and current sensors, as shown in the above fragment of code.&nbsp;</p>
<p>My Mk2 code on the forum has always been configured to match the emonTx V2 which uses these analogue ports in a different way.&nbsp; The voltage sensor, for example, has always used A2 rather than A3.&nbsp; To get the Mk2_multiLoad_CAT5_2.ino&nbsp; sketch from my website to work in this way, you would need to change &#39;3&#39; to &#39;2&#39; (twice) in the line:</p>
<p>const byte voltageSensor = 3;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // A3 is for the voltage sensor</p>
<p>Can you remind us what hardware you are running your sketches on.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22194"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3602" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="thewaver&#039;s picture" title="thewaver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mk2i PV Router, interrupt-based</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3602" title="View user profile.">thewaver</a> on Thu, 26/06/2014 - 11:15.</div>
    <div class="content">
     <p>I am using the Arduino Uno with the complete kit and PCBs from RichMC, which I bought from this forum.</p>
<p>Thank you for your programmer tip. Would A5 need to be changed from A5 to A1 to match the mini_3 sketch ??</p>
<p>It details this on your schematic:&nbsp;http://openenergymonitor.org/emon/sites/default/files/Mk2_CircuitSchematic.pdf</p>
<p>const byte currentSensor_grid = 5;&nbsp;&nbsp;&nbsp;&nbsp; // A5 is for CT1 which measures grid current</p>
<p>Many Thanks Don....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<div class="item-list"><ul class="pager"><li class="pager-current first">1</li>
<li class="pager-item"><a href="/emon/node/1912?page=1" title="Go to page 2" class="active">2</a></li>
<li class="pager-next"><a href="/emon/node/1912?page=1" title="Go to next page" class="active">next ›</a></li>
<li class="pager-last last"><a href="/emon/node/1912?page=1" title="Go to last page" class="active">last »</a></li>
</ul></div><form action="/emon/node/1912"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Kyclg8NCUMR7djuEzuHu_2fYXbGGmN121poSTc3oz30" value="form-Kyclg8NCUMR7djuEzuHu_2fYXbGGmN121poSTc3oz30"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
