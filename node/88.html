<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/88 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:22:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emoncms | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
          <span class="submitted"></span>
      <div class="taxonomy"></div>
      <div class="content"><h2>Web Logging and Graphing</h2>
<p><em>First draft created: 27th September 2010</em></p>
<p><em>by Trystan Lea</em></p>
<h3>Note: new version of emoncms (v2) can be found here:&nbsp;<a href="../emoncms.html">http://openenergymonitor.org/emon/emoncms</a></h3>
<p>This is a mini guide on how to create a web connected energy monitor and starts from where the guide for building the non-invasive mains AC v3 energy monitor leaves off.</p>
<p>...</p>
<p><strong>JSON and automatic website setup</strong></p>
<p>One of the main features of this implementation is the use of JSON to send data from the arduino to the website. Sending data in a JSON is really nice, I wont go into it in detail here but it makes it possible for the website to automatically setup variables. A simple JSON string looks like this:</p>
<p>{&quot;Voltage&quot;:&quot;240.0&quot;}</p>
<p>The website recieves this and if it doesn't already have a Voltage table, will create one and enter the value into the table. This means you can almost configure the website from the arduino, if you want to graph more variables just send them from the arduino and the website should take care of it self.</p>
<p>...</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
<h3>Arduino side</h3>
<p><strong>1)</strong> Download:</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8">           </meta>
</p>
<p>Arduino Sketch (Nuelectronics shield): <a href="../sites/default/files/emonEthernet.tar.gz">emonEthernet.tar.gz</a></p>
<p><em>Browse software in repository&nbsp;:&nbsp;</em><em><a href="../software.html">software repository</a></em></p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
<p><strong>2) </strong>Open the sketch</p>
<p>- enter energy monitor calibration values as in mains AC v3 guide</p>
<p>- enter arduino ip, gateway ip and server ip</p>
<p><strong>3)</strong> Upload the sketch to the arduino</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>Server side</h3>
<p>At the moment this is more of a tech demo than a fully fledged graphing and logging website, Were working on a larger site, more information to come. But for those of you who are learning to program php, ajax, jquery (like me) this might be useful, its also super easy to setup if your not an avid programmer:</p>
<p><strong>1)</strong> download: <a href="../sites/default/files/emoncms01.zip">emoncms01.zip</a></p>
<p><em>Browse software in repository&nbsp;:&nbsp;</em><em><a href="../software.html">software repository</a></em></p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
<p><strong>2)</strong> unzip into your server directory&nbsp;(can be web based or local computer, search for LAMP server installation guides)</p>
<p><strong>3) </strong>Create a database (I use phpmyadmin)&nbsp;</p>
<p><strong>4) </strong>Enter the <strong>database name</strong>, <strong>username</strong>, <strong>password</strong> and <strong>host</strong> into <em>database.config</em> in the emoncms directory</p>
<p><strong>5) </strong>Load emoncms in your browser, if you see the following then congratulations! your ready to log and graph! :)</p>
<p><img width="600" alt="" src="../sites/default/files/start.png" /></p>
<p>You can at this point try the example data posting link, to see how sending a json string automatically sets up variables on the website.&nbsp;</p>
<p>Or if your energy monitoring arduino is all ready to go and pointing at the website, fire it up and you should see the following variables appear automatically updated in real-time :)</p>
<p><img width="600" alt="" src="../sites/default/files/variables.png" /></p>
<p>To see a graph of the variable click on Graph:view:</p>
<p><img width="600" alt="" src="../sites/default/files/graph-3.png" /></p>
<p>The graphs also update in real-time, using ajax and jquery.</p>
<p><strong>There we are for now, more to come soon!</strong></p>
<p>May be useful to understand how the above works:</p>
<p>&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8"> </meta>
</p>
<p><a href="107.html">Using JQuery AJAX and php to fetch data from a mysql database</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
</div>
    
    
      </div>
<div id="comments">
  <a id="comment-2325"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="basswe&#039;s picture" title="basswe&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by basswe (not verified) on Sun, 13/11/2011 - 17:57.</div>
    <div class="content">
     <p>Placed in forum - software</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<a id="comment-2176"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/317.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-317.jpg" alt="Sergegsx&#039;s picture" title="Sergegsx&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/317.html" title="View user profile.">Sergegsx</a> on Fri, 07/10/2011 - 07:35.</div>
    <div class="content">
     <p>Hello Trystan, in addition to my previous post question (which i really hope you can help me with)</p>
<p>Ive noticed that once the database is created, the script takes care of creating the tables however I have opened the tables with &quot;navicat&quot; and gives me errors on primary key not set, length of primary key etc</p>
<p>&nbsp;&nbsp;&nbsp; $result = mysql_query(&quot;CREATE TABLE variables ( name TEXT,accum INT(1))&quot;); <br />
&nbsp;&nbsp;&nbsp; $result = mysql_query(&quot;CREATE TABLE dump ( text TEXT )&quot;); </p>
<p>&nbsp;</p>
<p>I believe those lines should include primary key declaration?</p>
<p>is it enough with 2 tables and 3 columns to store all data? or i have something missing?</p>
<p>Thanks for your help, I really hope you can help me out.</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<a id="comment-2172"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/317.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-317.jpg" alt="Sergegsx&#039;s picture" title="Sergegsx&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/317.html" title="View user profile.">Sergegsx</a> on Thu, 06/10/2011 - 08:20.</div>
    <div class="content">
     <p>hi, im trying to setup this easy example to test my new ethernet 28j60. but something is going wrong when setting up the database or website.</p>
<p>instead of your message in the yellow box i am only getting:</p>
<p>&quot;</p>
<div id="topd">
<div id="title">Input variables</div>
</div>
<div class="data">&nbsp;</div>
<p class="inc" style="font-size:11px;">Refreshed: 2</p>
<p>&quot;</p>
<p>Ive checked the code and in getIndex.php you say</p>
<p>&nbsp; include 'DB.php';</p>
<p>but there is no such file in the dowloaded rar file. might this be the problem?</p>
<p>ive tried to debug by adding a few &quot;echo&quot; of user name password etc and mysqlerror but they dont print anything. </p>
<p>&nbsp; include 'DB.php';<br />
&nbsp; $con = mysql_connect($host,$user,$pass);<br />
&nbsp; $dbs = mysql_select_db($name, $con);<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo &quot;&lt;br&quot;.$host;<br />
&nbsp;&nbsp;&nbsp; echo &quot;&lt;br&quot;.$user;<br />
&nbsp;&nbsp;&nbsp; echo &quot;&lt;br&quot;.$pass;<br />
&nbsp;&nbsp;&nbsp; echo &quot;&lt;br&quot;.$name;<br />
&nbsp;&nbsp;&nbsp; echo mysql_error($con);</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2179"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/10/2011 - 20:24.</div>
    <div class="content">
     <p>Its been a while since I ran this emoncms version.</p>
<p>But just tested again here and it seems to work. The line</p>
<p>&nbsp;include 'DB.php';</p>
<p>refers to I think an external mysql library, I remember needing it on one computer I was using at the time. I just tried removing the line and it works fine without it.</p>
<p>When you ran the lines:</p>
<p>&nbsp; include 'DB.php';<br />
&nbsp; $con = mysql_connect($host,$user,$pass);<br />
&nbsp; $dbs = mysql_select_db($name, $con);</p>
<div>&nbsp;</div>
<div>Did you also run these above them?</div>
</p>
<pre>
  $lines = file('database.config');

  $lines = str_replace(&quot; &quot;, &quot;&quot;, $lines);

  $ex_line = explode(':',$lines[0]); $host = $ex_line[1];

  $ex_line = explode(':',$lines[1]); $user = $ex_line[1];

  $ex_line = explode(':',$lines[2]); $pass = $ex_line[1];
<br /></pre><p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2180"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/317.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-317.jpg" alt="Sergegsx&#039;s picture" title="Sergegsx&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/317.html" title="View user profile.">Sergegsx</a> on Fri, 07/10/2011 - 20:29.</div>
    <div class="content">
     <p>if it worked without the db.php in your directory then ok.</p>
<p>I run this code but i dont get the yellow box as you do.</p>
<p>also, the tables are created but as I said only 2columns in one and 1 column in the other. with no primary key or anything</p>
<p>&nbsp;</p>
<p>maybe you know how to add some debug ECHO&nbsp;lines to know whats happening? cause my ECHO&nbsp;shown here dont work.</p>
<p>i know database connection is correct cause tables were created.</p>
<p>
&nbsp; $lines = file('database.config');</p>
<p>&nbsp; $lines = str_replace(&quot; &quot;, &quot;&quot;, $lines);<br />
&nbsp; <br />
&nbsp; $ex_line = explode(':',$lines[0]); $host = $ex_line[1];<br />
&nbsp; $ex_line = explode(':',$lines[1]); $user = $ex_line[1];<br />
&nbsp; $ex_line = explode(':',$lines[2]); $pass = $ex_line[1];<br />
&nbsp; $ex_line = explode(':',$lines[3]); $name = $ex_line[1];</p>
<p>&nbsp; include 'DB.php';<br />
&nbsp; $con = mysql_connect($host,$user,$pass);<br />
&nbsp; $dbs = mysql_select_db($name, $con);<br />
&nbsp; <br />
&nbsp;&nbsp;&nbsp; echo &quot;&lt;br&quot;.$host;<br />
&nbsp;&nbsp;&nbsp; echo &quot;&lt;br&quot;.$user;<br />
&nbsp;&nbsp;&nbsp; echo &quot;&lt;br&quot;.$pass;<br />
&nbsp;&nbsp;&nbsp; echo &quot;&lt;br&quot;.$name;<br />
&nbsp;&nbsp;&nbsp; echo mysql_error($con);</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>thanks trystan</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2185"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 08/10/2011 - 11:37.</div>
    <div class="content">
     <p>&nbsp;That should work, the only thing I can see amiss is that your break tags dont have the closing characters /&gt;</p>
<p>but I dont think that should affect it.&nbsp;</p>
<p>Is there any reason why your not using the new emoncms version 2?</p>
<p><a href="../emoncms.html">http://openenergymonitor.org/emon/emoncms</a></p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2188"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/317.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-317.jpg" alt="Sergegsx&#039;s picture" title="Sergegsx&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/317.html" title="View user profile.">Sergegsx</a> on Sun, 09/10/2011 - 11:22.</div>
    <div class="content">
     <p>Oh i hadnt seen that one !! thanks a lot. It looks like version 2 is working fine when calling an url from my computer browser...GREAT!</p>
<p>btw, when calling the url from the arduino I dont get the feed updated, ive tried both of this methods and they dont work.</p>
<p>ive reduced the apikey for security here in posting. but asume its correct.</p>
<p>&nbsp;</p>
<p>method 1</p>
<p>client.print(&quot;GET http://mywebsite.com/powermonitor/emoncms2/api/post?apikey=e097a70779b8&amp;json={apparentpower:&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.print(emon.apparentPower);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.print(&quot;}&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.println();</p>
<p>&nbsp;</p>
<p>method 2</p>
<p>in the following method the serial.print(c) does not print out the &quot;OK&quot;, i dont know why.</p>
<p>
if (client.connect()) {&nbsp; <br />
Serial.println(&quot;Connected2:&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp; char* urll[] = {&quot;GET http://mywebsite.com/powermonitor/emoncms2/api/post?apikey=e097a7779b8&amp;json={apparentpower:&quot;, buffer, &quot;}&quot;};<br />
&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; 3; i++){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(urll[i]);&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp; Serial.println();<br />
&nbsp;&nbsp;&nbsp;&nbsp; for (int i = 0; i &lt; 3; i++){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; client.print(urll[i]);&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp; client.println();<br />
}<br />
&nbsp; while (client.available()) {<br />
&nbsp;&nbsp;&nbsp; char c = client.read();<br />
&nbsp;&nbsp;&nbsp; Serial.print(c);<br />
&nbsp;&nbsp;&nbsp; client.flush();<br />
&nbsp; }<br />
&nbsp;&nbsp;&nbsp;&nbsp; client.stop();</p>
<p>&nbsp;</p>
<p>thanks a lot Trytan</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div></div></div></div><a id="comment-1840"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bjalodia&#039;s picture" title="bjalodia&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by bjalodia (not verified) on Sat, 11/06/2011 - 15:25.</div>
    <div class="content">
     <p>&nbsp;can you help me with this.</p>
<p>every thing is working, but it sends same data every time.</p>
<p>its only sends ones updated data when i reset the arduino and again start sending duplicate data its not updating the new changed values from anologe port.</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<a id="comment-1450"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Lars Jacobsen&#039;s picture" title="Lars Jacobsen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by <a href="http://www.strammelse.dk/" rel="nofollow">Lars Jacobsen</a> (not verified) on Wed, 10/11/2010 - 21:33.</div>
    <div class="content">
     <p>Hay JSON code seems just what im looking for :-)</p>
<p>Planing something similar like the openenergymonitor consept. See:<br />
<a href="http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1289334133" title="http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1289334133">http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1289334133</a></p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-1658"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="arena&#039;s picture" title="arena&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms</h3>

    <div class="submitted">Submitted by arena (not verified) on Wed, 13/04/2011 - 18:54.</div>
    <div class="content">
     <p>the program dont work with original etherShield.h and ethernetShield.ccp, is posible get the library version that has yorr scketch?<br />
Thanks</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div><div class="item-list"><ul class="pager"><li class="pager-current first">1</li>
<li class="pager-item"><a href="882679.html?page=1" title="Go to page 2" class="active">2</a></li>
<li class="pager-next"><a href="882679.html?page=1" title="Go to next page" class="active">next ›</a></li>
<li class="pager-last last"><a href="882679.html?page=1" title="Go to last page" class="active">last »</a></li>
</ul></div></div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
