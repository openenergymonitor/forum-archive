<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3991 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:43:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>[SOLVED] Bug in python receive script for Jeelink? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">[SOLVED] Bug in python receive script for Jeelink?</h3>
        <span class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Mon, 03/03/2014 - 11:15</span>
        <div class="content"><p>Hi, I get negative power values from my EmonTx because I have a PV system connected to phase L1. In order to make that work with the python script for the Jeelink receiver from <a href="https://github.com/emoncms/development/blob/master/Tutorials/Python/PyLink/pylink.py">https://github.com/emoncms/development/blob/master/Tutorials/Python/PyLink/pylink.py</a></p>
<p>I had to change the line:</p>
<pre>
...
value = int(values[i]) + int(values[i+1])*256
<strong>if value&gt;32768: value -= -65536</strong>
datacsv.append(str(value))
...</pre><p>to:</p>
<pre>
<strong>if value&gt;32768: value -= 65536</strong></pre><p>&nbsp;</p>
<p>BR, J&ouml;rg.</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2502.html" class="topic-previous" title="Go to previous forum topic">‹ SOLVED - Issue logging in to new emoncms</a>
              <a href="2025.html" class="topic-next" title="Go to next forum topic">public share URL ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-18934"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [SOLVED] Bug in python receive script for Jeelink?</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 03/03/2014 - 22:05.</div>
    <div class="content">
     <p>Thanks, it;s been fixed&nbsp;https://github.com/emoncms/development/commit/e17dbab6a3d87bb8b68a62522616e52bf6e3e7e8</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18941"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [SOLVED] Bug in python receive script for Jeelink?</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 04/03/2014 - 08:32.</div>
    <div class="content">
     <p>As I don&#39;t know anything about Python at all, I have a question regarding this script (might be slightly off-topic).&nbsp;</p>
<p>I saw that the script stopped this night with an error message. How can the script be made to recover automatically from such a fault (restart)?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18992"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [SOLVED] Bug in python receive script for Jeelink?</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Wed, 05/03/2014 - 11:32.</div>
    <div class="content">
     <p>Depends on the error message.</p>
<p>Best would be to identify what causes it and add an exception to generate a warning and go on processing.</p>
<p>Not difficult to achieve in python, the difficulty may lie in the rootcausing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19872"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [SOLVED] Bug in python receive script for Jeelink?</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 27/03/2014 - 09:10.</div>
    <div class="content">
     <p>Jerome,</p>
<p>hope you can give me a hint. The error message created is always due to Emoncms not responding to a GET request:</p>
<pre>
Traceback (most recent call last):
  File &quot;C:\Python27\Jeelink&quot;, line 56, in &lt;module&gt;
    conn.request(&quot;GET&quot;, &quot;/&quot;+emoncmspath+&quot;/input/post.json?apikey=&quot;+apikey+&quot;&amp;&quot;+req)
  File &quot;C:\Python27\lib\httplib.py&quot;, line 973, in request
    self._send_request(method, url, body, headers)
  File &quot;C:\Python27\lib\httplib.py&quot;, line 1007, in _send_request
    self.endheaders(body)
  File &quot;C:\Python27\lib\httplib.py&quot;, line 969, in endheaders
    self._send_output(message_body)
  File &quot;C:\Python27\lib\httplib.py&quot;, line 829, in _send_output
    self.send(msg)
  File &quot;C:\Python27\lib\httplib.py&quot;, line 791, in send
    self.connect()
  File &quot;C:\Python27\lib\httplib.py&quot;, line 772, in connect
    self.timeout, self.source_address)
  File &quot;C:\Python27\lib\socket.py&quot;, line 571, in create_connection
    raise err
error: [Errno 10061] Es konnte keine Verbindung hergestellt werden, da der Zielcomputer die Verbindung verweigerte</pre><p>&nbsp;</p>
<p>I have no experience with Python, but have now done the following:</p>
<pre>
try:
        conn.request(&quot;GET&quot;, &quot;/&quot;+emoncmspath+&quot;/input/post.json?apikey=&quot;+apikey+&quot;&amp;&quot;+req)
        #response = conn.getresponse()
        #print response.read()
except:
        print &quot;Emoncms server not available!&quot;</pre><p>It seems to work (script not stopping with the above error any more), but I would like to know how this could be improved. Or is it ok to do it like this?</p>
<p>BR, J&ouml;rg.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20387"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [SOLVED] Bug in python receive script for Jeelink?</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 04/04/2014 - 07:57.</div>
    <div class="content">
     <p>What you&#39;re doing seems fine.</p>
<p>I&#39;d to it like this:</p>
<pre>
try:
        conn.request(&quot;GET&quot;, &quot;/&quot;+emoncmspath+&quot;/input/post.json?apikey=&quot;+apikey+&quot;&amp;&quot;+req)
        response = conn.getresponse()
except:
        print &quot;Emoncms server not available!&quot;
else:
        print response.read()</pre><p>Perhaps could you consider using the python OEM Gateway if you want to do this kind of things. It is supposed to be more featured. And it can resend data when server is unreachable.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20389"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [SOLVED] Bug in python receive script for Jeelink?</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Fri, 04/04/2014 - 08:51.</div>
    <div class="content">
     <p>J&eacute;r&ocirc;me,</p>
<p>Thank you very much for your comment. Since using my modified script, it works flawlessly. But I will change it to your proposal and have a look into the OEM Gateway next.</p>
<p>BR, J&ouml;rg.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: [SOLVED] Bug in python receive script for Jeelink?</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Fri, 04/04/2014 - 09:51.</div>
    <div class="content">
     <p>You don&#39;t have to change it, the only difference is that you commented the lines providing the feedback from Emoncms. But since this feedback is printed into nothing, commenting that is fine.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3991"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-4oKiVZUjdF8XTNYesNAanzlptMj8TQO3xwis2yluLh8" value="form-4oKiVZUjdF8XTNYesNAanzlptMj8TQO3xwis2yluLh8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
