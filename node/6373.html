<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6373 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:03:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Configure Emoncms input processes for gas meter pulse count input | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Configure Emoncms input processes for gas meter pulse count input</h3>
        <span class="submitted">Submitted by <a href="../user/7387.html" title="View user profile.">ddcarter</a> on Sun, 28/12/2014 - 14:29</span>
        <div class="content"><p>I am using rltamr to decode the usage transmissions from my smart gas meter. I&#39;m using node-red to tail the rtlamr log file, and it is forwarding messages in this format to emoncms:</p>
<p>{gas:265672}</p>
<p>The number is the lifetime gas usage in cubic feet.&nbsp;</p>
<p>I&#39;ve searched the site &amp; have an understanding of the general steps that are needed to process this input, but I seem to be setting something up incorrectly. Here is a screenshot of my current configuration:</p>
<p><a href="../../../www.dropbox.com/s/77enborv07r1g8g/Screenshot%202014-12-28%2009.06.45ec75.html?dl=0" title="https://www.dropbox.com/s/77enborv07r1g8g/Screenshot%202014-12-28%2009.06.45.png?dl=0">https://www.dropbox.com/s/77enborv07r1g8g/Screenshot%202014-12-28%2009.0...</a></p>
<p>Can someone spot my error or errors in this configuration?&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6393.html" class="topic-previous" title="Go to previous forum topic">‹ can I connect 4 DS18B20  modules to 1 emonTX V2?</a>
              <a href="6413.html" class="topic-next" title="Go to next forum topic">mk2-pv-router ino file ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26311"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1844.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1844.jpg" alt="jonrescca&#039;s picture" title="jonrescca&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Configure Emoncms input processes for gas meter pulse count input</h3>

    <div class="submitted">Submitted by <a href="../user/1844.html" title="View user profile.">jonrescca</a> on Thu, 01/01/2015 - 11:47.</div>
    <div class="content">
     <p>Hi&nbsp;ddcarter,</p>
<p>​I saw in a more recent post of yours, that you managed to get your data now right, can you explain how you did this &nbsp;with an screendump of the input processing?</p>
<p>(oops, I see the screendump already in the new post here:&nbsp;http://openenergymonitor.org/emon/node/6373)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26315"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7387.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ddcarter&#039;s picture" title="ddcarter&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Configure Emoncms input processes for gas meter pulse count input</h3>

    <div class="submitted">Submitted by <a href="../user/7387.html" title="View user profile.">ddcarter</a> on Thu, 01/01/2015 - 15:14.</div>
    <div class="content">
     <p>I *think* I have the processing set up correctly, but I haven&#39;t done anything yet with adding those feeds to visualizations, etc. Let me know if you find a better way of doing any of this.&nbsp;</p>
<p>It seems that what is missing is a clear set of documentation on each of the processing transformations - expected inputs, outputs, etc. I&#39;ve seen advice to place a log to feed after the first step, verify output, move the log down in the list, verify output, etc., essentially the equivalent of adding debug statements. I think this would be unnecessary in a lot of cases if we only had clear documentation. This lack of documentation plus the inability (or lack of clearly documented ability) to delete all the data in an input while retaining the processing configuration are two huge barriers to getting started with emoncms. It ends up being a lot of trial, error, and frustration.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26407"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6175.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6175.jpg" alt="chandlerbing&#039;s picture" title="chandlerbing&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Configure Emoncms input processes for gas meter pulse count input</h3>

    <div class="submitted">Submitted by <a href="../user/6175.html" title="View user profile.">chandlerbing</a> on Sat, 03/01/2015 - 17:56.</div>
    <div class="content">
     <p>Hi ddcarter,</p>
<p>I have a setup with rtlamr that is receiving the consumption messages from my gas meter as well, how did you set yours up? I am also interested in forwarding the consumption messages to emoncms. Currently I am saving the rtlamr information in to a log file in JSON format. What I haven&#39;t been able to do is to &quot;connect the dots&quot; on how to get the log entries parsed and sent to emoncms. Would you be able to share how you did this?</p>
<p>Cheers,</p>
<p>Chandler&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26424"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7387.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ddcarter&#039;s picture" title="ddcarter&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Configure Emoncms input processes for gas meter pulse count input</h3>

    <div class="submitted">Submitted by <a href="../user/7387.html" title="View user profile.">ddcarter</a> on Sun, 04/01/2015 - 02:27.</div>
    <div class="content">
     <p>Chandler,</p>
<p>I have rtlamr&nbsp;sending output to a log file in JSON format. It is started with -filterid=xx -quiet=true -logfile=xx -format=json</p>
<p>I then have a node-red flow set up to tail that log file. (This approach will not work on Windows -- tail is Mac or Linux only.) Nodes are tail-&gt;change-&gt;parse_json-&gt;template-&gt;emoncms.&nbsp;</p>
<p>Tail &amp; parse json are straightforward, no parameters.</p>
<p>The change node is configured to &quot;Set the value of the message property called msg.time to msg.payload.Time&quot;. This is extracting the Time from the rtlamr log record &amp; using it to override the message time in the message that gets passed on the remaining steps. (I&#39;m not sure that this is having the desired effect. According to the documentation for the emoncms node, this should cause a &quot;&amp;time=xx&quot; value to be placed in the emoncms&nbsp;url, but I don&#39;t think this is happening right now. Maybe an issue with the way the datetime is formatted in the rtlamr log.&nbsp;Not a problem&nbsp;if you are processing messages more or less in real-time, but would be an issue if you are working with store-and-forward-later log records.)</p>
<p>The template node extracts the Message.Consumption value from the rtlamr log&#39;s json format &amp; creates a new json&nbsp;message like this: (replace &quot;gas&quot; with whatever you want your input to be called on emoncms)</p>
<p>{gas:{{payload.Message.Consumption}}}</p>
<p>The emoncms node is configured with the base URL of <a href="http://emoncms.org/" title="http://emoncms.org/">http://emoncms.org/</a> and with my write api key. You could do this with the standard http request node as well, but it&#39;s fairly easy to install the emoncms&nbsp;node from the node-red node repository.&nbsp;</p>
<p>I will probably get around to adding some additional logic to handle any error messages in the rtlamr log, or perhaps to restart the rtl_tcp &amp; rtlamr processes if needed. A higher-priority enhancement would be finding a way to throttle the rate at which updates are passed on to emoncms, perhaps only updating every minute, 5 minutes, etc. Updates from my meter can be as frequent as every 15 seconds.&nbsp;</p>
<p>Hope this helps. Let me know if you come up with any enhancements.&nbsp;</p>
<p>Regards,</p>
<p>David</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6373"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-p7r4wz2Vo-iobptx1jDFPHcBTKTCLvcAYUzJM3Rm5Ps" value="form-p7r4wz2Vo-iobptx1jDFPHcBTKTCLvcAYUzJM3Rm5Ps"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
