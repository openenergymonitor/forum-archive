<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3228 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:01:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Solved: DS18B20 sometimes no measurements? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Solved: DS18B20 sometimes no measurements?</h3>
        <span class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Tue, 26/11/2013 - 10:12</span>
        <div class="content"><p>Hello!</p>
<p>I&#39;m using some DS18B20 sensors to monitor the temperature of my boiler and some other temperatures.</p>
<p>Sometimes the measurement drops to 0 (I&#39;ve changed the programming of the EmonTX, otherwise it would drop to -127 but that kills all the nice diagrams).</p>
<p>Some of the sensors are connected to the EmonTX via a 10m ethernet cable, using orange/green and blue/brown as supply and data line and the rest (white cables) for ground. Could this be a problem ? I&#39;ve red about problems because of the high slew rate of this sensors but why they are ok most of the time and only have problems sometimes?</p>
<p>Any ideas? You can have a look at it here: <a href="http://emoncms.org/jb79/Boiler" title="http://emoncms.org/jb79/Boiler">http://emoncms.org/jb79/Boiler</a>, for example: errors starting today 9:40 in the morning.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3378.html" class="topic-previous" title="Go to previous forum topic">‹ 9v AC-AC with single CT sensor PCB</a>
              <a href="3366.html" class="topic-next" title="Go to next forum topic">EmonTx setup problems ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-16449"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solved: DS18B20 sometimes no measurements?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 26/11/2013 - 11:58.</div>
    <div class="content">
     <p>I can&#39;t quite understand your wiring, but I suspect that a problem could well be there. CAT5 Ethernet cable is made up of twisted pairs, the twists are designed in such a way as to reduce crosstalk between pairs. Therefore by using more than one pair you may in fact be adding to the problems rather than reducing them. I don&#39;t see the need for the reduced voltage drop that paralleled conductors might give you. I suggest you put the supply on one pair only (say Orange + White/Orange) and the data on one pair (say Blue + White/Blue) and leave the remaining two pairs unconnected.</p>
<p>A second suggestion is to check the value of the pull-up resistor. The Maxim data sheet specifies 4.7 k&Omega;.</p>
<p>Thirdly, you don&#39;t say how many sensors are on a single input and whether they are connected in star or daisy-chained. The cable acts as a transmission line and if the configuration is &#39;star&#39;, reflections in the other cables could be distorting the wanted signal. &quot;Daisy-chain&quot; is the preferred configuration for long cable runs, but of course it all depends on the requirements of your installation.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16468"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2128.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jb79&#039;s picture" title="jb79&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solved: DS18B20 sometimes no measurements?</h3>

    <div class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Wed, 27/11/2013 - 16:33.</div>
    <div class="content">
     <p>Ok, i&#39;ve drawn a litte picture to illustrate how I connected the sensors. At total there are 6 sensors connected to the EmonTX at the moment. One of them directly with 1m cable on the EmonTX, the next 4 via about 10m ethernet cable and then with their own 1m cables and a last one with another 5m ethernet cable and with it#s own 1m cable.</p>
<p>So it&#39;s a combination of daisy chain and star, but there is no other possibility</p>
<p>At the top of the picture you can see the connections of the two parts with the ethernet cable.</p>
<p>The pull-up resistor is 4,7k.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16472"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solved: DS18B20 sometimes no measurements?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 27/11/2013 - 22:52.</div>
    <div class="content">
     <p>Which sensor is close to the emonTx and which is the one 15 m distant?&nbsp; As you say there&#39;s no possibility in practice of wiring the sensors any other way, it seems you are stuck with what you have. It may be a silly question, is it possible that the cause is interference from some equipment nearby?</p>
<p>I see the software polls the sensors in turn every 20 s approximately, but when I look carefully, I think I see patterns. T5 fails frequently on the measurement after T6 fails, and T3 often fails at the same time as T6 or T4.</p>
<p>It is rare that you have two bad readings in sequence. Instead of converting the -127 value to zero, would it be better (= less bad) for the emonTx to send the last reading again? I know the data would be false, but it would give a better graph.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16477"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2128.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jb79&#039;s picture" title="jb79&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solved: DS18B20 sometimes no measurements?</h3>

    <div class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Thu, 28/11/2013 - 12:38.</div>
    <div class="content">
     <p>Hello Robert!</p>
<p>I&#39;ll try to correct the software next week, I&#39;ve also thought about sending the old values again if a sensor fails. To be informed about a sensor outage even if old values are transmitted I think I&#39;ll use another feed. If sensor 1 fails, I&#39;ll add 1 to the feed value, sensor 2 adds 2, sensor 3 adds 4 and so on. So I can check the data consistency of up to 16 sensors (integer has 16bit) by only one additional feed.</p>
<p>T_Technikraum is the sensor nearest to the EmonTX.</p>
<p>Then there is the 10m cable and T3-T6 mounted on the boiler.</p>
<p>From there about 5m to T-Solar, mounted on the copper pipe coming down from the thermal solar system that heats up the boiler when the sun is shining.</p>
<p>All sensors are in a room with a heat pump, the 800l boiler, the ventilation system, the decalcifying plant and the power distributor. But I couldn&#39;t find a relation during the periodes when the sensors fail and one of this systems start or stop working. For example: The up/down of T4 is caused by the heat pump switching on and off (at the moment about once an hour). The ventilation system is running all the time, directly next to the EmonTX.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16896"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2128.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jb79&#039;s picture" title="jb79&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solved: DS18B20 sometimes no measurements?</h3>

    <div class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Thu, 19/12/2013 - 19:11.</div>
    <div class="content">
     <p>Hello again!</p>
<p>It took a little bit more time to correct the software. Now I store the latest valid temperature for each sensor. Here is my code example for one of the sensors.</p>
<p><em><em>emontx.T2 = sensors.getTempC(address_T2) * 100;</em></em><br />
	<em><em>if (emontx.T2 &lt; -5000) emontx.T2=emontx_old.T2;</em></em><br />
	<em><em>else emontx_old.T2=emontx.T2;</em></em></p>
<p><em>I repeat this for all 6 sensors and it is working fine, I tested it by disconnecting the room temperature sensor for some seconds, hold the sensor in my hand, so that it got about 27&deg;C (normal room temperature is about 19&deg;C) and connected it again. In the measurement the value didn&#39;t change until it was reconnected, then the value jumped to the new measurement.</em></p>
<p>&nbsp;</p>
<p>Does anybody know how my code could be written in an easier way for multiple sensors?</p>
<p>In my definitions I used T2-T7 (I bought 10 sensors, red out the addresses and labled them, T2-T7 are for this emonTx). I&#39;d like to use a if loop, like this with a small function that only needs the sensor number and automatically does the same as the short code in the beginning but I don&#39;t know how to do it (I&#39;m not the best in programming C)</p>
<p>for (i=2; i&lt;=7; i++) sensors_check (i);</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16897"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solved: DS18B20 sometimes no measurements?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 19/12/2013 - 20:14.</div>
    <div class="content">
     <p>Probably the best way around the software problem is to make an object called &quot;sensor&quot; and then create 6 instances of it. &quot;sensor_check&quot; then becomes a method of that class that does the calculation. If that&#39;s all very strange to you, take a look again at emonLib, because that&#39;s exactly what EnergyMonitor is, and calcVI is a method that does the calculation. So you&#39;d copy the parts you need of the overall structure of EnergyMonitor but almost none of the detail. For example, you&#39;d have a method to initialise it with the sensor address in the same way that currentTX or voltageTX plug in the calibration coefficients. You could take a look at <a href="http://www.relisoft.com/book/index.htm" title="http://www.relisoft.com/book/index.htm">http://www.relisoft.com/book/index.htm</a> which is a C++ tutorial, and if you understand the basics it should be helpful.</p>
<p>If you want to stay with plain C (not C++), then you probably need several arrays to hold the address, present temperature. old temperature, etc and use the parameter into sensors_check (i) as an index into those arrays.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3228"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-WrrAntufzGvrIK7sLYEpqa4___eTNUIyg4WFDIMgR4c" value="form-WrrAntufzGvrIK7sLYEpqa4___eTNUIyg4WFDIMgR4c"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
