<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10937 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:57:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>oem_gateway stops sending | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">oem_gateway stops sending</h3>
        <span class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Sat, 04/07/2015 - 08:27</span>
        <div class="content"><p>Hello,</p>
<p>The subject says it all. My Raspberry PI uses oem_gateway to send data to emoncms. This had been working fine, but for the last 2 consecutive nights, it stopped sending data. All my inputs show as inactive, but a reboot starts the sending process again.</p>
<p>It&#39;s been a while since I&#39;ve looked around these forums, as everything had been working flawlessly for well over a year. I now see that there is something called emonhub (<a href="5986.html" title="http://openenergymonitor.org/emon/node/5986">http://openenergymonitor.org/emon/node/5986</a>). Should I be upgrading to this way of sending data?</p>
<p>Thanks,</p>
<p>Allen</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10923.html" class="topic-previous" title="Go to previous forum topic">‹ EmonTx with i2c lcdBarGraph</a>
              <a href="10775.html" class="topic-next" title="Go to next forum topic">monitoring PV string voltage ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31899"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 04/07/2015 - 09:19.</div>
    <div class="content">
     <p>Hi Allen</p>
<p>The OEM gateway is emonHub&#39;s predecessor&nbsp;and there are several&nbsp;benefits to upgrading, but OEMG&nbsp;was a solid performer and therefore I couldn&#39;t say it was&nbsp;essential, however the IPE-R1&nbsp;image that most OEMG installs were on does cause issues and is not supported, that was one of the primary reasons emonHub came about.</p>
<p>So if using IPE-R1 read-only I would strongly recommend the jump.</p>
<p>Sorry there is no emonhub&nbsp;installer with a built in&nbsp;OEMG uninstaller&nbsp;as there were some&nbsp;variations and most users had IPE, so the additional work to accommodate the possible variants for a very few non-IPE users wasn&#39;t valid.</p>
<p>I can help you uninstall&nbsp;if you wish or there are some pre-configured OEM&nbsp;SDcard images with emonHub on, tell&nbsp;us about your set up etc for a recommendation.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31903"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Sat, 04/07/2015 - 13:39.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Thank for getting back so quickly. I&#39;m pretty sure my setup on the Raspberry PI is standard. I downloaded the image and updated the config&nbsp;file with my API key. But other than that it&#39;s a normal read-only OEMG installation.</p>
<p>I&#39;m not sure what IPE is, or how I can tell if I have it or not. Would it be easier just to load the SD card with a new image?</p>
<p>I have attached a hard disk to my PI with at some point I want to start using for a local emoncms, but I&#39;ve not got round to that yet, but if I can set that up at the same time as the move to emonHub, that would be useful.</p>
<p>Thanks for you help.</p>
<p>Allen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31933"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 05/07/2015 - 10:14.</div>
    <div class="content">
     <p>Hi Allen</p>
<p>Sorry I didn&#39;t reply yesterday I was pondering over what to recommend and didn&#39;t really reach an answer so here are my thoughts.</p>
<p>&quot;normal read-only OEMG installation&quot; sounds very much like it will be IPE-R1&nbsp;based.</p>
<p>The direct replacement for what you have now would be original&nbsp;emonhub as a forwarder only on a read-only Raspbian OS image. current SDcard images are read-only&nbsp;Raspbian and do have emonhub&nbsp;set up by default.</p>
<p>However where as earlier versions of the&nbsp;&quot;previous&quot;&nbsp;pre-emonPi&nbsp;SDcard&nbsp;image had low-write&nbsp;emoncms&nbsp;disabled by default, I believe this image and onwards has low-write&nbsp; emoncms enabled by default. so emoncms would need to be disabled to &quot;match&quot; what you have now</p>
<p>Neither the &quot;current&quot; post&nbsp;emonPi&nbsp;or &quot;previous&quot;&nbsp;pre-emonPi&nbsp;SDcard&nbsp;images provide a direct route to a full OS and&nbsp;emoncms&nbsp;HDD solution, so do not help with setting up the HDD at the same time.</p>
<p>The emoncms&nbsp;install guide for linux would mostly work for the Pi but it&#39;s noy an easy route and the Raspbian OS needs to be installed and booting&nbsp;to the HDD first.</p>
<p>There is an old guide I wrote many moons ago in a thread that could be followed to use an&nbsp;HDD on a Pi first,</p>
<p>I do also have a emoncms install script but it may not work first time if it&#39;s not&nbsp;up&nbsp;to date, I never know until I try it as it isn&#39;t linked to any&nbsp;emoncms changes.</p>
<p>None of this is particularly difficult it&#39;s just not as easy as &quot;download this&quot; or &quot;follow that&quot; and I&#39;m starting to think it maybe easier to guide you through an install rather than try and guide you through the guides, at least that way other users may find it of use too.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31969"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Mon, 06/07/2015 - 05:46.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>I&#39;m happy to go through an install. My only worry is that I don&#39;t have a spare Pi, so really I need to get this done in one go, so as not to lose monitoring data. But it hung again last night, so the sooner the better.</p>
<p>Thanks for your help.</p>
<p>Allen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31972"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 06/07/2015 - 08:32.</div>
    <div class="content">
     <p>Setting up the hdd and installing emonHub is the easiest parts so if we do that first then you are back up and running while we install and set up&nbsp;emoncms.</p>
<p>Firstly&nbsp;<a href="http://downloads.raspberrypi.org/raspbian_latest">Download the latest version of Raspbian OS</a>&nbsp;and install to the HDD and a (spare?) SDcard and</p>
<p>follow&nbsp;<a href="5092.html">Creating a local EmonCMS installation on a Raspberry Pi</a>&nbsp;up&nbsp;to the reboot only, then install emonHub</p>
<p><strong>git clone <a href="https://github.com/emonhub/dev-emonhub.git" title="https://github.com/emonhub/dev-emonhub.git">https://github.com/emonhub/dev-emonhub.git</a> ~/dev-emonhub &amp;&amp; ~/dev-emonhub/install</strong></p>
<p>and then add&nbsp;<a href="10178.html">emonHub command line options</a>,</p>
<p>Run <strong>emonhub -c&nbsp;</strong>to open emonhub.conf&nbsp;to add your apikey and add the&nbsp;hash&nbsp;to &quot;&nbsp;<strong>#</strong>url = http://localhost/emoncms&nbsp;&quot;&nbsp;(commenting out the localhost reference will use the emoncms.org default). If neeeded&nbsp;edit the rfm2pi details while&nbsp;you are in there (this should look quite familiar to you as a OEMG user).</p>
<p>You can also set &quot;loglevel = DEBUG&quot; if you want verbose logs to check everything is ok using&nbsp;<strong>emonhub&nbsp;-dl</strong>.</p>
<p>That should be all you need to get you running emonhub from&nbsp;the HDD.&nbsp;</p>
<p>Read-only isn&#39;t a mandatory requirement and is used predominantly on sdcards, possibly because users with HDDs are doing other stuff on there perhaps? RO can still be installed as a safety measure&nbsp;if you prefer,&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32023"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Tue, 07/07/2015 - 20:44.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Everything was going fine. Ihave the Pi booting from HDD and I have installed emonhub. I editted the emonhub.conf to include my apikey. But when I start with emonhub -dl I get this output:</p>
<p>2015-07-07 20:21:07,500 INFO EmonHub Pre-Release Development Version (rc1.2)<br />
2015-07-07 20:21:07,503 INFO Opening hub...<br />
2015-07-07 20:21:07,511 WARNING Setting emonCMS apikey: obscured<br />
2015-07-07 20:21:11,526 WARNING Device communication error - check settings<br />
2015-07-07 20:32:40,525 INFO Logging level set to DEBUG<br />
2015-07-07 20:32:40,529 INFO Setting emonCMS url: <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
2015-07-07 20:32:40,532 INFO Setting emonCMS apikey: null<br />
2015-07-07 20:32:40,535 INFO Setting RFM2Pi frequency: 868 (8b)<br />
2015-07-07 20:32:41,539 INFO Setting RFM2Pi baseid: 10 (10i)<br />
2015-07-07 20:39:30,405 INFO Setting emonCMS apikey: set</p>
<p>My config is like this:</p>
<p>[reporters]</p>
<p># This reporter sends data to emonCMS<br />
[[emonCMS]]<br />
&nbsp; &nbsp; Type = EmonHubEmoncmsReporter<br />
&nbsp; &nbsp; [[[init_settings]]]<br />
&nbsp; &nbsp; [[[runtimesettings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; #url = <a href="http://localhost/emoncms" title="http://localhost/emoncms">http://localhost/emoncms</a><br />
&nbsp; &nbsp; &nbsp; &nbsp; apikey = &lt;apikey obscured&gt;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32025"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Tue, 07/07/2015 - 20:52.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Panic over! I hadn&#39;t realised that emonhub -dl just output the log. Just running it normally and tailing the log shows that it is receiving and outputting data. My emoncms is being updated.</p>
<p>One question. Will emonhub start automatically if I reboot the Pi, or does it need to be started manually ?</p>
<p>Thanks,</p>
<p>Allen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32026"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 07/07/2015 - 20:57.</div>
    <div class="content">
     <p>Hi Allen&nbsp;</p>
<p>What baud does your rfm2pi&nbsp;operate at ? I assume 9600 if from the OEMG era.</p>
<p>Is that defined in the RFM2Pi settings in emonhub.conf?</p>
<p>[[RFM2Pi]]<br />
&nbsp; &nbsp;&nbsp;[[[init_settings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;com_baud = 9600<br />
&nbsp; &nbsp; [[[runtimesettings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<em>etc etc</em></p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32027"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 07/07/2015 - 21:11.</div>
    <div class="content">
     <p>It will auto start at boot if you used the install script, however it is always best to test these things just to confirm rather than finding out at a later date.</p>
<p>emonhub&nbsp;-dl does tail the log, it looks like something upset&nbsp;the serial port baud detection on your first attempt, defining the baud explicitly will disable the auto detection and ensure a good connection&nbsp;everey&nbsp;time.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32070"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Wed, 08/07/2015 - 23:52.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Everything seems to be working fine with the emonhub, so the next step is to start looking at setting up emoncms. However, before I do that I&#39;d like to take full advantage of my complete USB external drive. At the moment I have this setup:</p>
<p>(parted) print list free<br />
Model: &nbsp;Mass Storage Device (scsi)<br />
Disk /dev/sda: 80.0GB<br />
Sector size (logical/physical): 512B/512B<br />
Partition Table: msdos</p>
<p>Number &nbsp;Start &nbsp; End &nbsp; &nbsp; Size &nbsp; &nbsp;Type &nbsp; &nbsp; File system &nbsp;Flags<br />
&nbsp; &nbsp; &nbsp; &nbsp; 32.3kB &nbsp;4194kB &nbsp;4162kB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Free Space<br />
&nbsp;1 &nbsp; &nbsp; &nbsp;4194kB &nbsp;62.9MB &nbsp;58.7MB &nbsp;primary &nbsp;fat16 &nbsp; &nbsp; &nbsp; &nbsp;lba<br />
&nbsp;2 &nbsp; &nbsp; &nbsp;62.9MB &nbsp;3277MB &nbsp;3214MB &nbsp;primary &nbsp;ext4<br />
&nbsp; &nbsp; &nbsp; &nbsp; 3277MB &nbsp;80.0GB &nbsp;76.7GB &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Free Space</p>
<p>So you can see there is a large amount of free space. Would it be best to create another partition to use this space and install emoncms on that, or would it be best to extend the existing ext4 partition to use this space (in which case what is the best way to do that) ?</p>
<p>Thanks,</p>
<p>Allen</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32085"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 09/07/2015 - 21:48.</div>
    <div class="content">
     <p>The best way to configure the hdd space is to separate&nbsp;the filesystem and data files. I usually install emoncms&nbsp;to the same partition as the OS but move the mySQL and data folders to a &quot;data&quot; partition like the waty it&#39;s done on the pre-configured images. This can (should?) be done regardless of whether you go for read-only OS or not.</p>
<p>It&#39;s entirely up&nbsp;to you if you use ALL the space in one go or not, It can make things a little easier to manage to keep the partitions smaller and increase the size as needed but it&#39;s a minor&nbsp;preference. If it were me, I would just create another small(ish) partition leaving plenty of room to expand the existing one eg a 5GB partition starting 20GB&nbsp;into the hdd ending at 25GB.</p>
<p>​fdisk is probably the easier tool to use, gparted will also do it but I&#39;m less familiar with it.</p>
<p>In fact most of this is covered in the SDcard&nbsp;&quot;built it yourself&quot; guides, using fdisk will be the same (different size and position)&nbsp;but you won&#39;t need to format ext2&nbsp;since it&#39;s not on a SDcard.</p>
<p>​I&#39;ve been meaning to retest my installer on a spare Pi&nbsp;for you, it makes installing emoncms a one line command, I will try and do it over the weekend.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32165"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Sun, 12/07/2015 - 22:58.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>I have now followed the remainder of the instructions on this page&nbsp;<a href="5092.html">http://openenergymonitor.org/emon/node/5092</a>. I now have emoncms running on my Pi and a new data partition. How can I move the mySQL database to my data partition ?</p>
<p>Thanks,</p>
<p>Allen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32172"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 13/07/2015 - 10:10.</div>
    <div class="content">
     <p>Hi Allen</p>
<p>I have answered your other&nbsp;<a href="10981.html#comment-32171">Newbie issues with emoncms</a><span style="line-height: 20.7999992370605px;">&nbsp;</span><span style="line-height: 20.7999992370605px;">thread about the emoncms versions etc.&nbsp;</span></p>
<p><span style="line-height: 20.7999992370605px;">If it were me I would start again, setting up the hdd and reinstalling emonhub&nbsp;(you could&nbsp;keep your existing emonhub.conf file) will be less painful than chopping things around and provide a known state to build the correct emoncms version on.</span></p>
<p><span style="line-height: 20.7999992370605px;">As mentioned above <em>&quot;The <a href="https://github.com/emoncms/emoncms/blob/v8.5/docs/LinuxInstall.md">emoncms</a>&nbsp;install guide for linux would mostly work for the Pi &quot;&nbsp;</em>if you wish to install step by step but there is a change in the server root folder and it doesn&#39;t automatically&nbsp;install to 2 partitions.</span></p>
<p><span style="line-height: 20.7999992370605px;">I have had a look at my <a href="https://github.com/pb66/dev-emoncms">installer script</a> and although I would like to make a couple of adjustments&nbsp;</span><span style="line-height: 20.7999992370605px;">I believe</span><span style="line-height: 20.7999992370605px;">&nbsp;it will work as is ( I&#39;ve not tested recently</span><span style="line-height: 20.7999992370605px;">) &nbsp;to test it I need to free up an sd card to test it as&nbsp;they all currently have partial projects on them. </span></p>
<p><span style="line-height: 20.7999992370605px;">The&nbsp;script will automatically move the SQL and other data files to &quot;~/emonData&quot; your&nbsp;data&nbsp;partition should be mounted to that point before running the installer. (this is the default and can be altered)</span></p>
<p><span style="line-height: 20.7999992370605px;">Paul</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32190"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Mon, 13/07/2015 - 23:08.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Your script seemed to be working okay, until it tried to create the database:</p>
<p>Cloning into &#39;/var/www/emoncms&#39;...<br />
remote: Counting objects: 8958, done.<br />
remote: Total 8958 (delta 0), reused 0 (delta 0), pack-reused 8957<br />
Receiving objects: 100% (8958/8958), 4.59 MiB | 916 KiB/s, done.<br />
Resolving deltas: 100% (5283/5283), done.<br />
<strong>ERROR 1006 (HY000) at line 1: Can&#39;t create database &#39;emoncms&#39; (errno: 2)</strong></p>
<p>The password used by emoncms to access database is 6335f188ead949c7b380dfc715ab297f</p>
<p>PHP Warning: &nbsp;Module &#39;dio&#39; already loaded in Unknown on line 0<br />
Channel &quot;pear.apache.org/log4php&quot; is already initialized<br />
PHP Warning: &nbsp;Module &#39;dio&#39; already loaded in Unknown on line 0<br />
log4php/Apache_log4php is already installed and is the same as the released version 2.3.0<br />
<strong>install failed</strong></p>
<p>&nbsp;</p>
<p>Do you know what might be causing this?</p>
<p>Thanks,</p>
<p>Allen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32192"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Mon, 13/07/2015 - 23:41.</div>
    <div class="content">
     <p>I found a page that suggested a restart of mySQL. When I tried, this is what I got:</p>
<pre>
pi@raspberrypi:~$ sudo service mysql stop
Stopping MySQL database server: mysqld.
pi@raspberrypi:~$ sudo service mysql start
df: `/var/lib/mysql/.&#39;: Too many levels of symbolic links
df: no file systems processed
/etc/init.d/mysql: ERROR: The partition with /var/lib/mysql is too full! ... failed!</pre><pre>
So I tried this:

pi@raspberrypi:~$ df -hk
Filesystem     1K-blocks    Used Available Use% Mounted on
rootfs           6172412 2693876   3177516  46% /
/dev/root        6172412 2693876   3177516  46% /
devtmpfs          218636       0    218636   0% /dev
tmpfs              44584     264     44320   1% /run
tmpfs               5120       0      5120   0% /run/lock
tmpfs              89160       0     89160   0% /run/shm
/dev/mmcblk0p1     57288   19448     37840  34% /boot
/dev/sda5        9948012   22632   9413380   1% /data

And this:

pi@raspberrypi:~$ df -hk /var
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/root        6172412 2693876   3177516  46% /</pre><p>When I just try this:</p>
<pre>
pi@raspberrypi:~$ df -hk /var/lib/mysql
df: `/var/lib/mysql&#39;: Too many levels of symbolic links
df: no file systems processed</pre><p>I get a similar message to the one when starting the mySQL. The symbolic link is like this:</p>
<pre>
pi@raspberrypi:~$ ls -l /var/lib/mysql
lrwxrwxrwx 1 root root 11 Jul 13 23:01 /var/lib/mysql -&gt; /data/mysql</pre><p>When /data is my new data partition on the hdd.</p>
<p>The symbolic link on /data is:</p>
<pre>
pi@raspberrypi:~$ ls -l /data/mysql
lrwxrwxrwx 1 root root 11 Jul 13 23:34 /data/mysql -&gt; /data/mysql</pre><p>​Something looks wrong!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32193"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 14/07/2015 - 00:01.</div>
    <div class="content">
     <p>Hi Allen,</p>
<p>Something certaily isn&#39;t right there. somehow you have a symlink pointing to itself &nbsp;&quot;/data/mysql -&gt; /data/mysql&quot;, and since you also have a symlink&nbsp;&quot;/var/lib/mysql -&gt; /data/mysql&quot; that raises the question where is the mysql folder?</p>
<p>Going by the number of messages containing &quot;already&quot; in that latter part of your post before last, I would hazzard a guess and say either you have run this script more than once or there were reminants of the last install still hanging around.</p>
<p>Did you start a fresh or uninstall the apt-get installed&nbsp;emoncms?</p>
<p>Was the data partition mounted when you first run the script?</p>
<p>If you add the data partition to the fstab it will be mounted automatically on boot, is&nbsp;/dev/sda5&nbsp;correct? you have 5+ hdd paritions or does a new id being allocated to the same partition?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32194"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Tue, 14/07/2015 - 00:01.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>I&#39;ve solved it. I was because I ran your script a second time and didn&#39;t move the mysql directory back from my /data partition.</p>
<p>Allen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32195"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 14/07/2015 - 00:07.</div>
    <div class="content">
     <p>excellent!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32198"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Tue, 14/07/2015 - 07:28.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>I have downloaded the data from emoncms.org using the backup.php script. However, when I try to visualize one of the feeds I get this error:</p>
<pre>
Warning: fopen(/var/log/emoncms.log): failed to open stream:
Permission denied in /usr/share/php/log4php/appenders/LoggerAppenderFile.php on line 99</pre><p>I think this is because in your script it has:</p>
<pre>
sudo touch /var/www/emoncms/emoncms.log
sudo chmod 660  /var/www/emoncms/emoncms.log</pre><p>But this location for the emoncms.log file does not match the error message I got. I also had to chmod 666 to allow access to the log file.</p>
<p>The error I am getting is this:</p>
<pre>
PHPFina:get_meta meta file does not exist id=26295</pre><p>When I looked back at the output from backup.php I can see these lines:</p>
<pre>
Create feed 26295
PHPFINA: 26295
Cannot open local metadata file</pre><p>The metadata files are on my /data partition (although I&#39;m not sure it&#39;s using them). The look like this:</p>
<pre>
drwxr-xr-x 2 www-data root   4096 Jul 13 23:59 phpfina
drwxr-xr-x 2 www-data root   4096 Jul 13 23:59 phpfiwa
drwxr-xr-x 2 www-data root   4096 Jul 13 23:59 phptimeseries</pre><p>​Although I have noticed I have the same directories in /var/lib. My emoncms settings.php is definitely pointing to the /data directories and in the backup.php script I set:</p>
<pre>
$link_to_local_emoncms = true;</pre><p>&nbsp;</p>
<p><em>Edit - wrapped long lines - BT</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32199"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Tue, 14/07/2015 - 07:42.</div>
    <div class="content">
     <p>I had to do what was suggested in this post&nbsp;http://openenergymonitor.org/emon/node/5495 and chmod to 777. It&#39;s a shame that old post doesn&#39;t mention if they fixed the problem.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32208"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 14/07/2015 - 10:26.</div>
    <div class="content">
     <p>Hi Allen</p>
<p>The <a href="https://github.com/emoncms/emoncms/commit/4f6c7fe8b934969bb4ce2a1debee146eac05216b">logging was changed recently in v8.5</a> so that&#39;s&nbsp;why the address is different(to the script), although /var/log&#39;s default permissions will probably&nbsp;hamper&nbsp;any direct logging, the normal practice is to use a app specific folder with appropriately set permissions. This has probably been done to suit the read-only configuration for the low-write version.&nbsp;This will need a better solution long term, both in the source and then any installer.</p>
<p>The meta file permission issue is more likely to be that the user &quot;pi&quot; isn&#39;t able to access&nbsp;the meta-files when the php script is run, Have you tried using &quot;sudo&quot;&nbsp;? setting 777 just opens all the permissions to everyone.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32213"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: oem_gateway stops sending</h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Tue, 14/07/2015 - 12:14.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Using sudo&nbsp;fixed the permissions problem (with the directories set back to their previous permissions).</p>
<p>Thanks,</p>
<p>Allen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10937"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Rd472gedII3fQ3ioQbB0pnYswGMtFj6Z0JS3EEuhPMM" value="form-Rd472gedII3fQ3ioQbB0pnYswGMtFj6Z0JS3EEuhPMM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
