<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10742 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:23:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>What to change in the emonlib library to port to esp-8266 | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">What to change in the emonlib library to port to esp-8266</h3>
        <span class="submitted">Submitted by <a href="../user/6999.html" title="View user profile.">gambituk</a> on Fri, 22/05/2015 - 12:37</span>
        <div class="content"><p>Hi, i&#39;ve seen a similar post on this, but it seems to get a little lost, so i would like to ask more directly for some guidance.</p>
<p>&nbsp;</p>
<p>I would like to try to run this emons&nbsp;software on an esp-8266, it can be programmed in the same way as an arduino with the newly created arduino ide board manager. It has more &nbsp;capacity than an arduino, with the added bonus of wifi on the same board.&nbsp;</p>
<p>there are a few snags:</p>
<p>1/. The esp runs only on 3.3v dc</p>
<p>2/. It has a 10-bit adc input, but only reads from 0-1v&nbsp;</p>
<p>3/. I&#39;m no great programmer!</p>
<p>&nbsp;</p>
<p>I was wondering if anyone had been involved much in working with the library could suggest which sections would need to be modified. A lot of libraries work without modification, but i can see that this library would need to be modified to work.&nbsp;</p>
<p>&nbsp;</p>
<p>Any pointers would be greatfully received.</p>
<p>Regards</p>
<p>Gambituk</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10752.html" class="topic-previous" title="Go to previous forum topic">‹ Multigraph problem on the Extended version</a>
              <a href="10747.html" class="topic-next" title="Go to next forum topic">Setting baud rate for /dev/ttyUSB0 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-30576"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: What to change in the emonlib library to port to esp-8266</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 22/05/2015 - 13:39.</div>
    <div class="content">
     <p><a href="10717.html" title="http://openenergymonitor.org/emon/node/10717">http://openenergymonitor.org/emon/node/10717</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30578"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6999.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gambituk&#039;s picture" title="gambituk&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: What to change in the emonlib library to port to esp-8266</h3>

    <div class="submitted">Submitted by <a href="../user/6999.html" title="View user profile.">gambituk</a> on Fri, 22/05/2015 - 17:01.</div>
    <div class="content">
     <p>Hi, thanks for the reply, this is indeed the post that i was referencing, i was just looking for more info or confirmation that this is indeed all that needs to be modified or are there other functions. The poster here has suggested some changes, but nobody has really commented on whether this is correct or if there is more or less than this that needs to be changed.</p>
<p>&nbsp;</p>
<p>Thanks for any further answers</p>
<p>Gambituk</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30622"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6999.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gambituk&#039;s picture" title="gambituk&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: What to change in the emonlib library to port to esp-8266</h3>

    <div class="submitted">Submitted by <a href="../user/6999.html" title="View user profile.">gambituk</a> on Sun, 24/05/2015 - 18:46.</div>
    <div class="content">
     <p>Hi, should i judge by the lack of specific answers that i&#39;m in the wrong forum? or does nobody really remember what was needed at the time this library was put together :/ I guess either scenario is totally understandable.</p>
<p>&nbsp;</p>
<p>I was really just looking for a clear authorative&nbsp;yay or nay to get me going in the right direction.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30625"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: What to change in the emonlib library to port to esp-8266</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sun, 24/05/2015 - 22:15.</div>
    <div class="content">
     <p>I suspect you need somebody who is very familiar with the library and very familiar with your chosen platform, and that&#39;s probably a very small group of people, possibly just you and Juan from Spain. &nbsp;The best way to find out what needs changing is to port&nbsp;it, and then report back.</p>
<p>Apart from porting&nbsp;all the places where it bangs on AVR hardware, or Arduino interfaces to AVR hardware, you probably need to make sure your environment is real-time enough. &nbsp; If you want to calculate real power in software, you need to make sure your Voltage and Current readings are taken at exactly the same time before you multiply them together, and you need to take a lot of them quickly.&nbsp; &nbsp;On the AVR, that&#39;s not exactly possibly, but you can measure them 104usecs apart which is close enough for most purposes, and because that offset is deterministic and&nbsp;constant, you can compensate for it in s/w. &nbsp;It appears as just another source of phase-error&nbsp;that adds or subtracts to all the other sources (CT phase error, VT phase error).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30626"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: What to change in the emonlib library to port to esp-8266</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 24/05/2015 - 23:44.</div>
    <div class="content">
     <p>Everything that emonLib does is, I think, explained somewhere in Building Blocks. I'm reasonably familiar with emonLib, but I haven't got the first clue about the esp-8266. So adding to dBC's comment, if you understand how emonLib works to process the raw data into meaningful values, then with a good understanding of the esp-8266, you can rewrite the library.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30627"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7167.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7167.jpg" alt="pb&#039;s picture" title="pb&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: What to change in the emonlib library to port to esp-8266</h3>

    <div class="submitted">Submitted by <a href="../user/7167.html" title="View user profile.">pb</a> on Mon, 25/05/2015 - 01:39.</div>
    <div class="content">
     <p>One issue I can see is the single channel of ADC. &nbsp;If you want to do accurate power measuring you need to sample both current and voltage quickly&nbsp;as dBC mentions. &nbsp;To do this with an ESP module you would need to use some form of external analog switch, or perhaps an external ADC. &nbsp;I have been using an ESP module for temperature (1wire) monitoring but that has significantly less real-time restrictions on operation. &nbsp;The processor seems to be quite fast, but not sure how well it will keep up with real-time power monitoring since almost all the onboard features (WiFi etc) are software driven so take up a significant chunk of processing time.</p>
<p>What is your overall reason for using an ESP module? &nbsp;If it is primarily to get WiFi access what about using it in conjunction with a standard Arduino board as a simple WiFi bridge?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30628"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6999.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gambituk&#039;s picture" title="gambituk&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: What to change in the emonlib library to port to esp-8266</h3>

    <div class="submitted">Submitted by <a href="../user/6999.html" title="View user profile.">gambituk</a> on Mon, 25/05/2015 - 06:37.</div>
    <div class="content">
     <p>Hi, Thanks for the answers. What appealed about the esp is having it as a small but powerful device. But looking again at the restrictions and considering the points that you have made perhaps i will look at continuing to use an arduino and then using the esp just as a wifi module. It was somehow attractive to just have it running on the esp as a full S.O.C. with just power&nbsp;and ct in.</p>
<p>&nbsp;</p>
<p>Food for thought....</p>
<p>&nbsp;</p>
<p>Thanks guys.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10742"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-olh83OnMfNwzfUUrxegKMC0XK_N3PVK0397HUXAeuSY" value="form-olh83OnMfNwzfUUrxegKMC0XK_N3PVK0397HUXAeuSY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
