<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11016 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:58:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>How can I make 2 EmonPis communicate over Ethernet? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">How can I make 2 EmonPis communicate over Ethernet?</h3>
        <span class="submitted">Submitted by <a href="../user/3947.html" title="View user profile.">bdhughes</a> on Tue, 21/07/2015 - 13:48</span>
        <div class="content"><p>I have an EmonPi in some outbuildings which is logging my Solar PV and Electric Car charging. I have another one in the house for grid Import/Export &amp; Hot water diversion monitoring. So 4 feeds in all. Both systems are&nbsp;logging to emoncms.org and all is well.</p>
<p>However from my previous&nbsp;system I have 2 EmonGLD displays which I had customised&nbsp;exactly how I wanted. They even told me my profit (or loss) for the day so far. I&#39;d like to use these again and I have no problem sending packets over 868MHz from&nbsp;the unit in the house,&nbsp;however the one in the outbuildings is just too far away with too many intervening stone walls. They are both on the same Ethernet network however.</p>
<p>I would like to be able to get the figures from the outbuildings unit to the house one. I&#39;m not sure if I can do this with the emoncms on the EmonPis. (One is set to node 5 and the other is node 6). It didn&#39;t&nbsp;show up as an input when I tried to configure one to send to the other. So I thought I&#39;d just write a program to send the data over directly to a shared file or a socket.</p>
<p>I can ssh to both of them (using Putty) and I&#39;ve installed Samba server &amp; client on each of them however they can&#39;t see each other and I can&#39;t see either of them from a windows PC. I can ping each one from the other.</p>
<p>So they are both definitely on the network at the addresses I expect and both sending data to emoncms.org but I can&#39;t see either on the network. I tried using NFS too but that doesn&#39;t work either.</p>
<p>I have another Raspberry Pi and I can see it just fine. I&#39;m a software developer (albeit in windows) and not usually stumped by things like this.</p>
<p>Is there something special about the setup of Raspbian on the EmonPi? I know about using rpi-rw to allow changes to be written to the SD card but is there anything else I should know?</p>
<p>Or indeed am I going about this the wrong way and there&#39;s an easier way to get the logged values from one EmonPi to the other over an Ethernet network?</p>
<p>Thanks for any assistance.</p>
<p>Brian</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11018.html" class="topic-previous" title="Go to previous forum topic">‹ Sending data to remote MySQL</a>
              <a href="1360.html" class="topic-next" title="Go to next forum topic">Running Emoncms straight from an Arduino? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-32439"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How can I make 2 EmonPis communicate over Ethernet?</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Tue, 21/07/2015 - 14:35.</div>
    <div class="content">
     <p>Hi</p>
<p>You could use the mqtt&nbsp;inputs and outputs. A little tricky to set up but I have done it and it works. My mqtt broker (mosquitto) is on a different Pi but I think you could install it on&nbsp;one of the Pi&#39;s along side emoncms.</p>
<p>Discussion of setting it up here:&nbsp; <a href="10746.html">http://openenergymonitor.org/emon/node/10746</a></p>
<p>Regards</p>
<p>Ian</p>
<p>&nbsp;</p>
<p><em>Edit - fixed link - BT</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32440"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How can I make 2 EmonPis communicate over Ethernet?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 21/07/2015 - 14:51.</div>
    <div class="content">
     <p>Hi Brian, a couple of possibilities from what you&#39;ve told us, firstly if you have 2 emonPi&#39;s on your network they will both be claiming to be &quot;//emonpi&quot;, try renaming one, you can use &quot;sudo raspi-config&quot; to change host hostname in one go.</p>
<p>The default emon-pi image has emoncms enabled by default but it isn&#39;t mandatory to either and certainly isn&#39;t ideal to keep both as that gives you fragmented data which isn&#39;t available outside your LAN.</p>
<p>If you are not running another local emoncms instance Ideally you could&nbsp;the garage emonPi to forward only, to both your emoncms.org account and your local house based emoncms, however I&#39;m not entirly sure the input api is fully functional on the emon-pi&#39;s low-write emoncms so try sending some data before making any drastic moves. with only one local emoncms server you can then forward port 80 (8080) to the house emonPi at your router for access outside&nbsp;the LAN.</p>
<p>If you have data from both emonPi&#39;s arriving at emoncms.org you could just write a little script to fetch the feed data you need for your glcds&nbsp;from emoncms.org and route it to the glcds locally. option 1 write a little script to &quot;fetch&quot; and publish to mqtt on the house emonpi and configure it to broadcast the subscribed data or option 2 is to edit emonhub to &quot;fetch&quot; the data from emoncms.og and broadcast along with the glcd time updates.</p>
<p>Further to Ian&#39;s points, both of your emonPi&#39;s will be running thier&nbsp;own MQTT brokers already so that could also create some confusion if you publish to one and subscrib to the other wonder where your packets are going.</p>
<p>Paul&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32446"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3947.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bdhughes&#039;s picture" title="bdhughes&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How can I make 2 EmonPis communicate over Ethernet?</h3>

    <div class="submitted">Submitted by <a href="../user/3947.html" title="View user profile.">bdhughes</a> on Tue, 21/07/2015 - 20:03.</div>
    <div class="content">
     <p>Hi Ian and Paul</p>
<p>Thanks for your replies. A good point on the hostnames being identical Paul. I changed those and rebooted but no change on the networking. I&#39;ll have to investigate the mqtt but it does look complicated, Ian.</p>
<p>I thought I&#39;d try setting up a socket connection instead. I wrote some code for a server &amp; client in Python. This works fine between 2 windows PCs but not at all between the 2 EmonPis. If I run&nbsp;the client on the Pi and the server on a&nbsp;windows PC it also works. However it won&#39;t work the other way around.&nbsp;The Pis just won&#39;t accept a connection.</p>
<p>I then thought I&#39;d install tightvnc&nbsp;on the Pis to see if I could connect that way. I&#39;ve done this on my other Raspberry pi but I can&#39;t connect to the EmonPis. I&nbsp;used apt-get to install tightvncserver and tried running it from ssh and by running it from init.d. Neither method is working.</p>
<p>Has anyone else been able to use vnc to an EmonPi. I&#39;m beginning to think there&#39;s something missing from Raspian on these units. I have done&nbsp;sudo apt-get update and&nbsp;sudo apt-get upgrade but still no joy.</p>
<p>So my conclusion&nbsp;so far is that I can make connections outwards from the EmonPi but the only connections I&#39;ve been able to make inwards are&nbsp;via ssh and http.</p>
<p>&nbsp;Brian</p>
<p>
&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32447"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How can I make 2 EmonPis communicate over Ethernet?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 21/07/2015 - 20:26.</div>
    <div class="content">
     <p>If you are using a windows machine to access the network you may well need to run &quot;&nbsp;IPConfig /flushDNS &quot; (as an administrator) to for allow the hostname a chance to take effect.</p>
<p>The emonPi&#39;s&nbsp;run UFW (Uncomplicated FireWall) so any inward connections to the mqtt&nbsp;brokers, vnc etc will require the relative ports added to the allowed list.</p>
<p>I use xrdp&nbsp;on the Pi&#39;s which is a remote desktop&nbsp;without any problems so vnc should be ok.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32450"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3947.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bdhughes&#039;s picture" title="bdhughes&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: How can I make 2 EmonPis communicate over Ethernet?</h3>

    <div class="submitted">Submitted by <a href="../user/3947.html" title="View user profile.">bdhughes</a> on Tue, 21/07/2015 - 21:43.</div>
    <div class="content">
     <p>Hi Paul</p>
<p>It was the ufw firewall stopping my sockets experiment so I&#39;m able to write code to communicate between the EmonPis now. Also vnc is working. I still can&#39;t connect via windows networking but that is not important to me now and it&#39;s probably due to some part of the configuration I&#39;ve got wrong.</p>
<p>So thanks for that insight. I hadn&#39;t heard of ufw before.</p>
<p>Brian</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11016"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-1o91qdaPZsDPPvGGVcWQwkzTJ6q3QJlNciAg1CwZTAc" value="form-1o91qdaPZsDPPvGGVcWQwkzTJ6q3QJlNciAg1CwZTAc"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
