<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12514 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:19:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Need help - Getting lost in all the information - want to get things working... | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Need help - Getting lost in all the information - want to get things working...</h3>
        <span class="submitted">Submitted by <a href="../user/8280.html" title="View user profile.">ChristianZ</a> on Sat, 16/04/2016 - 17:29</span>
        <div class="content"><p>Need help - Getting lost in all the information - want to get things working...</p>
<p>Dear all,</p>
<p>I&#39;m working on the following setup:</p>
<p>3x emonTxV3.4 connected to a Raspi V1b via serial cable (2x with USB UART). &nbsp;<br />
This Raspi (called emonhub-pi) forwards the packets via Ethernat cable to a central Raspi V2 (emonCMS-pi), running on SSD with a local emonHub / emonCMS installation.</p>
<p>The emonCMS-pi already does the job with wireless packets from emonTH devices.</p>
<p>As I found the time now to setup the emonhub-pi as a forwarder (first installation did the job well - but SD crashed) I updated to the newest preconfigured SD image &quot;emonSD-17Jun2015.img&quot; from emon website.</p>
<p>Here I did some basic setting (static IP, root Passwd, ...). &nbsp;<br />
I successfully ping-ed the emonCMS-pi and connected via ssh - network connection seems to fit.</p>
<p>I looked at the serial console to see what the emonTxV3 NR1 is posting (USB serials not yet connected)<br />
&quot;10 513,25 510,44 -509,99 509,74 230,83&quot; each 2s (Serial direct sketch)</p>
<p>&nbsp;</p>
<p>My emonHub config file lists the following (that worked within the image before</p>
<pre>
[hub]
loglevel = WARNING

[reporters]

[[emonCMS]]
  Type = EmonHubEmoncmsReporter
  [[[init_settings]]]
  [[[runtimesettings]]]
    url = <a href="http://192.168.1.28/emoncms" title="http://192.168.1.28/emoncms">http://192.168.1.28/emoncms</a>
    apikey = ###############################

[interfacers]

  [[SerialDirect]]
    Type = EmonHubSerialInterfacer

    [[[init_settings]]]
      com_port = /dev/ttyAMA0
      com_baud = 9600
    [[[runtimesettings]]]
      group = 210
      frequency = 433
      baseid = 15

[nodes]</pre><p>&nbsp;</p>
<p>Now the emonhub.log constantly gives me this warning:<br />
2016-04-16 19:05:08,867 WARNING MainThread SerialDirect thread is dead</p>
<p>Rebooting the the pi does not help</p>
<p>I&#39;m running out of ideas. As I don&#39;t have a emonPi (only a Pi with emonhub running) I guess I could use an other image. But which to use ?</p>
<p>The central emonCMS is version 9.4</p>
<p>&nbsp;</p>
<p>Thanks for any help in advance.</p>
<p>
&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12488.html" class="topic-previous" title="Go to previous forum topic">‹ Posting to emoncms.org via HTTPS?</a>
              <a href="12577.html" class="topic-next" title="Go to next forum topic">Updating a datapoint in a feed. What are the time parameters that a function in process_processlist.php would use? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-41218"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Mon, 18/04/2016 - 07:42.</div>
    <div class="content">
     <p>I&#39;m not an expert - hopefully one will be along soon...</p>
<p>But I think you might need to install using the raspberry pi installation guide rather than using the SD image. Certainly worth a try.&nbsp;</p>
<p><a href="https://github.com/emoncms/emoncms/blob/master/docs/RaspberryPi/readme.md" title="https://github.com/emoncms/emoncms/blob/master/docs/RaspberryPi/readme.md">https://github.com/emoncms/emoncms/blob/master/docs/RaspberryPi/readme.md</a></p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41220"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 18/04/2016 - 08:21.</div>
    <div class="content">
     <p>Was the direct serial connection working before you re-imaged? Its been a while since I last did a build using a direct serial connection between the emontx and emonpi - things have moved on quite a bit since then in terms of emoncms and emonhub version. Can you catch the point in the logs where the SerialDirect thread dies? There may be some more clues there.</p>
<p>Can I rename your thread to reflect the topic perhaps: &quot;Need help, emonhub with emontx to pi direct serial connection&quot;?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41227"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 18/04/2016 - 10:59.</div>
    <div class="content">
     <p>1st step would be to set emonhub&#39;s&nbsp;&quot;loglevel&nbsp;= DEBUG&quot; in emonhub.conf rather than WARNING which will give you more info.</p>
<p>The &quot;WARNING MainThread SerialDirect thread is dead&quot; error message can only be found in the emon-pi variant of emonhub&nbsp;and yet the emonhub.conf you have is for the original version of emonhub. There are no reporters in the emon-pi variant, the &quot;EmonHubEmoncmsReporter&quot; was replaced with a &quot;EmonHubEmoncmsHTTPInterfacer&quot;.</p>
<p>There is also an absence of the routing settings&nbsp;<span style="line-height: 20.8px;">(the&nbsp;</span><span style="line-height: 20.8px;">to</span><span style="line-height: 20.8px;">&nbsp;and&nbsp;</span><span style="line-height: 20.8px;">from</span><span style="line-height: 20.8px;">)&nbsp;</span><span style="line-height: 1.6;">required for the interfacers in that variant.</span></p>
<p><span style="line-height: 1.6;">While you are in the conf you can get rid of the group, frequency and baseid settings as they are not used for serial direct, only needed for RFM networks, this won&#39;t be effecting the issues you have though.</span></p>
<p><span style="line-height: 1.6;">Your example packet&nbsp;<em>&quot;10 513,25 510,44 -509,99 509,74 230,83&quot; </em>shows some comma&#39;s, is this a typo or a regional thing? emonhub will expect (depending on version) a frame in one of 2 forms, a nodeid&nbsp;followed by space separated&nbsp;decimal values eg &quot;10 513.25 510.44 -509.99 509.74 230.83&quot; or (less likely) a node id followed by space seperated&nbsp;&quot;byte values&quot; ie values between 0 and 255 to be reconstructed into full values using datacodes, either way the comma&#39;s could&nbsp;cause the packets to be discarded unless there is a &quot;regional&quot; adjustment made at the recieving end (emonhub) too.</span></p>
<p><span style="line-height: 1.6;">The emonhub log should&nbsp;show you exactly whats&nbsp;happening there if you change the loglevel.</span></p>
<p><span style="line-height: 1.6;">Also be aware that emoncms.org will probally block your address/device if you are posting at 2s intervals, the recommended rate is 10s, but you should be ok with a local install.</span></p>
<p><span style="line-height: 1.6;">Paul</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41393"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8417.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="baldockery&#039;s picture" title="baldockery&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/8417.html" title="View user profile.">baldockery</a> on Tue, 26/04/2016 - 03:23.</div>
    <div class="content">
     <p>I am also having trouble with the &quot;SerialDirect&nbsp;thread is dead&quot; message when trying to connect via serial to the emon-pi emonHub variant 1.1.</p>
<p>The Arduino I am using works when connected via serial to my older emonHub, running the&nbsp;emonSD-13-03-15.img image&nbsp;that provided me with &quot;emonHub Pre-Release Development Version (rc1.2)&quot;.</p>
<p>With the identical hardware setup, but running the&nbsp;emonSD-29Mar16 release candidate 2 image, I get the errors below.&nbsp;</p>
<p>First, my interfacer config:</p>
<pre style="font-size: 100%">
### This interfacer manages the USB port where the Moteino base is communicating serial data
[[SerialDirect]]
     Type = EmonHubSerialInterfacer
      [[[init_settings]]]
           com_port = /dev/ttyUSB0 
           com_baud = 115200
      [[[runtimesettings]]]
           pubchannels = ToEmonCMS,
           subchannels = ToRFM12,</pre><p>And here is the result:</p>
<pre style="font-size: 100%">
2016-04-25 22:22:07,573 INFO     MainThread EmonHub emonHub &#39;emon-pi&#39; variant v1.1

2016-04-25 22:22:07,573 INFO     MainThread Opening hub...

2016-04-25 22:22:07,574 INFO     MainThread Logging level set to DEBUG

2016-04-25 22:22:07,575 INFO     MainThread Creating EmonHubSerialInterfacer &#39;SerialDirect&#39; 

2016-04-25 22:22:07,579 DEBUG    MainThread Opening serial port: /dev/ttyUSB0 @ 115200 bits/s

2016-04-25 22:22:07,579 DEBUG    MainThread Setting SerialDirect subchannels: [&#39;ToRFM12&#39;]

2016-04-25 22:22:07,580 DEBUG    MainThread Interfacer: Subscribed to channel&#39; : ToRFM12

2016-04-25 22:22:07,581 DEBUG    MainThread Setting SerialDirect pubchannels: [&#39;ToEmonCMS&#39;]

2016-04-25 22:22:07,582 DEBUG    MainThread Interfacer: Subscribed to channel&#39; : ToRFM12

2016-04-25 22:22:07,583 INFO     MainThread Creating EmonHubMqttInterfacer &#39;MQTT&#39; 

2016-04-25 22:22:07,585 INFO     MainThread MQTT Init mqtt_host=127.0.0.1 mqtt_port=1883 mqtt_user=emonpi

2016-04-25 22:22:07,590 DEBUG    MainThread MQTT Subscribed to channel&#39; : ToEmonCMS

2016-04-25 22:22:07,592 INFO     MainThread Creating EmonHubEmoncmsHTTPInterfacer &#39;emoncmsorg&#39; 

2016-04-25 22:22:07,594 DEBUG    MainThread emoncmsorg Subscribed to channel&#39; : ToEmonCMS

2016-04-25 22:22:07,692 INFO     MQTT       Connecting to MQTT Server

2016-04-25 22:22:07,695 INFO     MQTT       connection status: Connection successful

2016-04-25 22:22:07,697 DEBUG    MQTT       CONACK =&gt; Return code: 0

2016-04-25 22:22:07,798 INFO     MQTT       on_subscribe

2016-04-25 22:22:09,484 WARNING  MainThread SerialDirect thread is dead

2016-04-25 22:22:09,694 WARNING  MainThread SerialDirect thread is dead

2016-04-25 22:22:09,903 WARNING  MainThread SerialDirect thread is dead

2016-04-25 22:22:10,112 WARNING  MainThread SerialDirect thread is dead</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41408"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 26/04/2016 - 10:22.</div>
    <div class="content">
     <p>Can you provide more info on the sketch and/or serial data ?&nbsp;</p>
<p>The &quot;SerialDirect&nbsp;thread is dead&quot; is a simple check written into the main core of emonhub&nbsp;to avoid a situation where an interfacer thread crashes out without any notice and it&#39;s then unknown if the interfacer is &quot;dead&quot;&nbsp;or just quiet.</p>
<p>Basically the&nbsp;thread is crashing and there is no clues as to why since the&nbsp;<span style="line-height: 20.8px;">error handling</span><span style="line-height: 20.8px;">&nbsp;</span><span style="line-height: 20.8px;">and</span><span style="line-height: 20.8px;">&nbsp;</span><span style="line-height: 1.6;">logging is</span><span style="line-height: 1.6;">&nbsp;&quot;</span><span style="line-height: 1.6;">a little</span><span style="line-height: 1.6;"> thin&quot; in this version.</span></p>
<p><span style="line-height: 1.6;">As in the example above it could well be the incoming data just isn&#39;t perfect and it&#39;s not being handled the same way it would be in the original version.&nbsp;</span></p>
<p><span style="line-height: 1.6;">Paul</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41414"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8417.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="baldockery&#039;s picture" title="baldockery&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/8417.html" title="View user profile.">baldockery</a> on Tue, 26/04/2016 - 11:58.</div>
    <div class="content">
     <p>Here is the serial data:</p>
<pre style="font-size: 100%">
OPTIONS: I18n 

Compiled on Apr 28 2012, 19:24:31.

Port /dev/ttyUSB0


Press CTRL-A Z for help on special keys


11 0

11 0

11 0</pre><p>The sketch is my modification of Felix Rusu&#39;s&nbsp;Moteino&nbsp;sketch:</p>
<pre style="font-size: 100%">
// BB: Modified this sketch 4/13/2016
// Use: Plug a MoteinoUSB running this sketch into the USB port of the emonHub Raspberry Pi
//     It will listen to the Moteino radios and repeat into the serial on the Pi through USB.
//     In emonhub.conf there will be a serial interfacer listening to the serial port.
// Original comments from Felix:
// Sample RFM69 receiver/gateway sketch, with ACK and optional encryption, and Automatic Transmission Control
// Passes through any wireless received messages to the serial port &amp; responds to ACKs
// It also looks for an onboard FLASH chip, if present
// RFM69 library and sample code by Felix Rusu - <a href="http://lowpowerlab.com/contact" title="http://LowPowerLab.com/contact">http://LowPowerLab.com/contact</a>
// Copyright Felix Rusu (2015)

#include &lt;RFM69.h&gt;    //get it here: <a href="https://www.github.com/lowpowerlab/rfm69" title="https://www.github.com/lowpowerlab/rfm69">https://www.github.com/lowpowerlab/rfm69</a>
#include &lt;RFM69_ATC.h&gt;//get it here: <a href="https://www.github.com/lowpowerlab/rfm69" title="https://www.github.com/lowpowerlab/rfm69">https://www.github.com/lowpowerlab/rfm69</a>
#include &lt;SPI.h&gt;      //comes with Arduino IDE (<a href="http://www.arduino.cc/" title="www.arduino.cc">www.arduino.cc</a>)
#include &lt;SPIFlash.h&gt; //get it here: <a href="https://www.github.com/lowpowerlab/spiflash" title="https://www.github.com/lowpowerlab/spiflash">https://www.github.com/lowpowerlab/spiflash</a>

//*********************************************************************************************
//************ IMPORTANT SETTINGS - YOU MUST CHANGE/CONFIGURE TO FIT YOUR HARDWARE *************
//*********************************************************************************************
#define NODEID        1    //unique for each node on same network
#define NETWORKID     100  //the same on all nodes that talk to each other
//Match frequency to the hardware version of the radio on your Moteino (uncomment one):
#define FREQUENCY     RF69_433MHZ
//#define FREQUENCY     RF69_868MHZ
//#define FREQUENCY     RF69_915MHZ
//#define ENCRYPTKEY    &quot;sampleEncryptKey&quot; //exactly the same 16 characters/bytes on all nodes!
//#define IS_RFM69HW    //uncomment only for RFM69HW! Leave out if you have RFM69W!
#define ENABLE_ATC    //comment out this line to disable AUTO TRANSMISSION CONTROL
//*********************************************************************************************

#define SERIAL_BAUD   115200

#ifdef __AVR_ATmega1284P__
  #define LED           15 // Moteino MEGAs have LEDs on D15
  #define FLASH_SS      23 // and FLASH SS on D23
#else
  #define LED           9 // Moteinos have LEDs on D9
  #define FLASH_SS      8 // and FLASH SS on D8
#endif

#ifdef ENABLE_ATC
  RFM69_ATC radio;
#else
  RFM69 radio;
#endif

SPIFlash flash(FLASH_SS, 0xEF30); //EF30 for 4mbit  Windbond chip (W25X40CL)
bool promiscuousMode = false; //set to &#39;true&#39; to sniff all packets on the same network

int TRANSMITPERIOD = 5000;

typedef struct {
  int           nodeId; //store this nodeId
  unsigned long uptime; //uptime in ms
  float         temp;   //temperature maybe?
} Payload;
Payload theData;

void setup() {
  Serial.begin(SERIAL_BAUD);
  delay(10);
  radio.initialize(FREQUENCY,NODEID,NETWORKID);
#ifdef IS_RFM69HW
  radio.setHighPower(); //only for RFM69HW!
#endif
//  radio.encrypt(ENCRYPTKEY);
  radio.promiscuous(promiscuousMode);
  //radio.setFrequency(919000000); //set frequency to some custom frequency
  char buff[50];
  sprintf(buff, &quot;\nListening at %d Mhz...&quot;, FREQUENCY==RF69_433MHZ ? 433 : FREQUENCY==RF69_868MHZ ? 868 : 915);
  Serial.println(buff);
  if (flash.initialize())
  {
    Serial.print(&quot;SPI Flash Init OK. Unique MAC = [&quot;);
    flash.readUniqueId();
    for (byte i=0;i&lt;8;i++)
    {
      Serial.print(flash.UNIQUEID[i], HEX);
      if (i!=8) Serial.print(&#39;:&#39;);
    }
    Serial.println(&#39;]&#39;);
    
  }
  else
    Serial.println(&quot;SPI Flash MEM not found.&quot;);
    
#ifdef ENABLE_ATC
  Serial.println(&quot;RFM69_ATC Enabled (Auto Transmission Control)&quot;);
#endif
}

byte ackCount=0;
uint32_t packetCount = 0;
long lastPeriod = -1;

void loop() {
  //process any serial input
  if (Serial.available() &gt; 0)
  {
    char input = Serial.read();
    if (input == &#39;r&#39;) //d=dump all register values
      radio.readAllRegs();
      
    if (input == &#39;p&#39;)
    {
      promiscuousMode = !promiscuousMode;
      radio.promiscuous(promiscuousMode);
      Serial.print(&quot;Promiscuous mode &quot;);Serial.println(promiscuousMode ? &quot;on&quot; : &quot;off&quot;);
    }
    
    if (input == &#39;d&#39;) //d=dump flash area
    {
      Serial.println(&quot;Flash content:&quot;);
      int counter = 0;

      while(counter&lt;=256){
        Serial.print(flash.readByte(counter++), HEX);
        Serial.print(&#39;.&#39;);
      }
      while(flash.busy());
      Serial.println();
    }
    if (input == &#39;D&#39;)
    {
      Serial.print(&quot;Deleting Flash chip ... &quot;);
      flash.chipErase();
      while(flash.busy());
      Serial.println(&quot;DONE&quot;);
    }
    if (input == &#39;i&#39;)
    {
      Serial.print(&quot;DeviceID: &quot;);
      word jedecid = flash.readDeviceId();
      Serial.println(jedecid, HEX);
    }
    if (input == &#39;t&#39;)
    {
      byte temperature =  radio.readTemperature(-1); // -1 = user cal factor, adjust for correct ambient
      byte fTemp = 1.8 * temperature + 32; // 9/5=1.8
      Serial.print( &quot;Radio Temp is &quot;);
      Serial.print(temperature);
      Serial.print(&quot;C, &quot;);
      Serial.print(fTemp); //converting to F loses some resolution, obvious when C is on edge between 2 values (ie 26C=78F, 27C=80F)
      Serial.println(&#39;F&#39;);
    }
  }

  
  if (radio.receiveDone())
  {

      for (byte i = 0; i &lt; radio.DATALEN; i++)
      Serial.print((char)radio.DATA[i]);
   
    
    if (radio.ACKRequested())
    {
      byte theNodeID = radio.SENDERID;
      radio.sendACK();

      if (ackCount++%3==0)
      {
        delay(3); //need this when sending right after reception .. ?
        radio.sendWithRetry(theNodeID, &quot;ACK TEST&quot;, 8, 0);  // 0 = only 1 attempt, no retries
      }
    }
    Serial.println();
    Blink(LED,3);
  }
}

void Blink(byte PIN, int DELAY_MS)
{
  pinMode(PIN, OUTPUT);
  digitalWrite(PIN,HIGH);
  delay(DELAY_MS);
  digitalWrite(PIN,LOW);
}</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41415"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 26/04/2016 - 12:45.</div>
    <div class="content">
     <p>My best guess is the text from the setup() isn&#39;t being caught and removed so when the interfacer tries to extract the node id it fails as there is no int present. The original emonhub&#39;s serial interfacer had basic input sanitation where as the raw data is passed without any checks in this variant.</p>
<p>Any attempts to edit the emonhub code could cause issues with the emonpi update script so your best course of action is a quick edit to the sketch to remove any printing of non-numeric data. Primarily in the setup() but since the loop() &quot;if (Serial.available() &gt; 0)&quot;&nbsp;code block is not useful without proper integration within emonhub, perhaps a custom Monteino&nbsp;interfacer. I would probably cut that away too, replacing it with some&nbsp;hardcoded&nbsp;&quot;options&quot; if required.</p>
<p>if you want to implement something a little grander I will help with some pointers but if you plan to keep updating&nbsp;via the emonpi&nbsp;update&nbsp;script this is the easiest option unless the changes are made upstream.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41425"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8417.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="baldockery&#039;s picture" title="baldockery&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/8417.html" title="View user profile.">baldockery</a> on Wed, 27/04/2016 - 01:29.</div>
    <div class="content">
     <p>Thanks, Paul! That was it. I hadn&#39;t bothered to clean up the mess I had made of that sketch because it was working on my old emonHub. I cleaned it up and removed all the extraneous serial printing. Now it works perfectly.</p>
<p>I did notice that emonhub is adding an RSSI&nbsp;value to that input, which I am not sending it. It sets it to zero and displays it in the inputs view. Is there some assumption in this version of emonhub that there is always an RSSI value?</p>
<p>Regarding implementing something a little grander, here is what I am envisioning: using my emonHub+Moteino as an internet-of-things base station. I.e&nbsp;uing the OpenHAB app to set a switch, which triggers an MQTT message, which Node-RED catches. Node-RED then sends a command over serial (USB) to the Moteino base station, which radios a remote Moteino to do something. I&#39;d be interested in any pointers you might have. Like, is that even a good way to approach it? And, does Node-RED have an easy way to write serial data to the USB port of the Pi?</p>
<p>Thanks again!</p>
<p>Brandon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41426"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8417.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="baldockery&#039;s picture" title="baldockery&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/8417.html" title="View user profile.">baldockery</a> on Wed, 27/04/2016 - 03:19.</div>
    <div class="content">
     <p>The other thing that appears to cause the &quot;MainThread SerialDirect thread is dead&quot; warning is simply connecting or disconnecting the device plugged into the USB port. And once that warning starts up, it repeats at least once every second. It would be nice, if I could suggest it, if the input sanitation from the older emonHub&nbsp;was brought forward to this one.</p>
<p>I found that simply restarting emonHub&nbsp;with &quot;sudo&nbsp;service emonhub restart&quot; was not enough to resolve &quot;thread is dead&quot; warning. I had to reboot the Pi on which it is running.</p>
<p>I would second the earlier motion to rename this thread: &quot;WARNING MainThread SerialDirect thread is dead&quot; and in my opinion we could add [SOLVED]. For now, the trick is to be very careful that you reboot your Pi running emonHub when you plug in a USB serial input, and you must make sure there is nothing printing to that serial port other than nice, clean input messages in the expected format.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41439"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 27/04/2016 - 10:58.</div>
    <div class="content">
     <p>Hi Brandon</p>
<p>emonhub&nbsp;should be robust enough not to fail due to incorrect serial data, ideally the sketch should identify itself so that down the line you know what sketch and version you are running. The removal of all the&nbsp;serial prints is not an acceptable fix IMO it is a quick and dirty workaround but if it gets you up and running that&#39;s&nbsp;good to know.</p>
<p>Yes the emon-pi variant assumes everything has an rssi, the original emonhub&nbsp;only passes the rssi if a&nbsp;valid rssi is attached to an incoming RFM packet, but this variant is very different in many ways.</p>
<p>If restarting emonhub doesn&#39;t resolve the &quot;WARNING MainThread SerialDirect thread is dead&quot; issue then there is something else in the mix causing an issue.&nbsp;</p>
<p>Any serial port (gpio or usb) can only have 2 devices using those lines, for that reason you should not have node-red connecting to the same port/device as emonhub. This maybe the reason you need to reboot the Pi if there is anything else accessing the same serial port, restarting emonhub will not free the serial port fo emonhubs&nbsp;exclusive use.</p>
<p>Ideally you should be able to configure emonhub to listen for the openhab mqtt&nbsp;and act &quot;directly&quot; with the monteino. I am not saying you cannot use node-red, many do but, you cannot have multiple softwares&nbsp;connected to the one device and therefore openhab&nbsp;should connect directly with emonhub or of you go to node-red then node-red should go to emonhub which <u>may</u> be pointless.</p>
<p>I am not opposed to the thread name being changed at all, perhaps&nbsp;&quot;WARNING&nbsp;MainThread&nbsp;SerialDirect&nbsp;thread is dead&quot; would be more appropriate but since the issue is far from solved I would be opposed to the [solved] tag especially as there are many, many reasons that could cause that catch all error, it is not the sort of error that will ever be solved for everyone.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41498"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8280.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ChristianZ&#039;s picture" title="ChristianZ&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help - Getting lost in all the information - want to get things working...</h3>

    <div class="submitted">Submitted by <a href="../user/8280.html" title="View user profile.">ChristianZ</a> on Fri, 29/04/2016 - 17:57.</div>
    <div class="content">
     <p>Hi all,</p>
<p>thanks for all the good tips.<br />
I will give them a try now - didn&#39;t found the time to go on with it until now.</p>
<p>First of all I will change the setting for log level and check the arduino script for the period/commata issue. It might be have been me, who copied the period things to Notepad++ and change all periods for commas (excel import required in germany)</p>
<p>In the end, it seems I have to update my emonCMS / emonHub Setup on the central Pi to support the new method.<br />
I really don&#39;t like to make a &quot;from the scratch&quot; setup, since everything for ssd and settings is working fine.</p>
<p>I&#39;ll get back with more info soon.</p>
<p>If you&#39;d like to rename the thread - feel free. Serial direct / serial thread dead / emonHub update issue might be good chunks for a header.</p>
<p>Cheers<br />
Christian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12514"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ywailTL0F3HbgJ0IEc1QM5N3cRDbBG57qg51_RJRHag" value="form-ywailTL0F3HbgJ0IEc1QM5N3cRDbBG57qg51_RJRHag"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/12514 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:19:00 GMT -->
</html>
