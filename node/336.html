<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Solar PV Monitoring (II) | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
          <span class="submitted"></span>
      <div class="taxonomy"></div>
      <div class="content"><h1 class="rteleft">PV System Monitoring.</h1>
<p>Following the installation of a 2.94 KWp PV system we needed to take advantage of the free power it supplies, currently the only way of knowing what the PV Inveter (SMA HF3000) is doing is to boot up the PC&nbsp;and Bluetooth into the inverter which is not very practical if we only need to see if we can switch the dishwasher on.</p>
<p><img height="525" width="700" alt="" src="	 http://openenergymonitor.org/emon/sites/default/files/DSCF7379.JPG" /></p>
<p>12 x Sharp 245w panels</p>
<p><img width="700" alt="" src="	 http://openenergymonitor.org/emon/sites/default/files/08102011535.jpg" /></p>
<p>SMA Sunnyboy HF3000 inveter installed in the roofspace, Inverter has some great features including data logging and bluetooth access for download of data via the Sunny Explorer application.</p>
<p>House consumption currently being monitored by a EnergySmart from British gas but it does not sense the PV generation.</p>
<h2>Back to the Build</h2>
<p>Most things have followed my origonal plan, EMONTX board from  Glyn, JeeLabs Nanode V6, Graphics board and a second Atmel CPU &amp;  RFM12 module for the EMONTX along with a jiffy bag of passives from  Farnell have slowly being arriving over Christmas.</p>
<p>Dusted down the trusty soldering Iron and got both the EMONTX and  JeeNode assembled, then began the baptism of fire with Ardunio ! First  attempts a compiling anything failed. So I loaded a basic blink sketch  which complied OK&nbsp;but would not download to the target. After a lot of  messing about I found I had the USB programming (CP1202 module) plugged  in upside down, not easy to notice when you don't have a green or black  wire - Doh. Anyway with the programming header hooked up I&nbsp;managed to  get the EMONTX board LED to blink at me.</p>
<p>Back to the EMONTX sketch problem which in the end where caused by  trying to compile older sketches with Arduino 1.0, after downloading  0023 and quite a bit of net rummaging for the various libraries ( I  notice that you have now added links into the new style INO files !!).</p>
<p>To start with I loaded the 2_CT_voltage sketch to the EMON&nbsp;TX and  used the JeeNode RF12 demo to pick up the transmitted signal, it picked  something up next I assembled the Graphic display.</p>
<p>This was where the learning curve got a bit steep as it's years since I did C programming !</p>
<p>I moved the Dallas code from the GLCD to the EMONTX as I&nbsp;want  external temp rather than internal, this all seemed to work well as the  serial port was now transmitting the correct temp, however I could not  persuade the GLCD to display the correct values.</p>
<p>After a lot of head scratching I found the the Payload being  transmitted had differing feild sizes that being recived so a few more  adjustments solved that, I've not got the CT or AC parts in yet so  I&nbsp;have put some fixed values into the EMNONTX code for testing.</p>
<p><img height="393" width="700<br />
" src="http://openenergymonitor.org/emon/sites/default/files/03012012639.jpg" alt="" /></p>
<p>Display &amp; EMONTX boards working with test values, no connectors  fitted to EMONTX as they will be fitted to the case it's going in along  with the AC transformer (dual secondary !) and a small 9v to 5v  switching PSU.</p>
<h4>13 January 2012</h4>
<p>Started work on the PSU and case for the EMONTX, I'm using a dual secondary 9v PCB style transformer rated at 1VA per secondary which is possibly a bit OTT but the transformer and 5v voltage regulator are both rated at 100mA.</p>
<p><img width="700" alt="" src="http://openenergymonitor.org/emon/sites/default/files/13012012651.jpg" /></p>
<p>All of the unwanted strips have been removed from the strip board around the AC part (Before I get numerous panic posts)</p>
<p>Both boards fit well in the Multicomp box (Farnell Part No 152-6736), Left hand side panel will hold two connectors for the two CT's and I'm going to move the Green &quot;TX&quot; LED to the end panel as well. Pic of the box with one of the CT's for scale.</p>
<p><img width="700" alt="" src="http://openenergymonitor.org/emon/sites/default/files/13012012653.jpg" /></p>
<p>&nbsp;I've also been doing a bit on the GLCD and included the code from the later version that switches off the LCD backlight at night to conserve power. I'm going at add a JeeLabs RTC plug so that the unit does not loose the time when powered off. EMONBASE not be implemented until later in the year hence fitting the RTC at the Display end.</p>
<h3>21st January</h3>
<p>Pretty much completed the EMONTX build, Both PSU board and EMONTX boards mounted in the above box, I did have an issue with the 9v transformer. As the secondary has very little load on it the output is around 15v rather than the expected 9v, the 5v supply regulator is happy with the higher input due to the power consumption being so low there is very little dissipation in the regulator. And after changing the calibration parameters in the TC sketch I have everything working.</p>
<p><img width="700" alt="" src="http://openenergymonitor.org/emon/sites/default/files/21012012681.jpg" /></p>
<p>Calibrated using Fluke 179 series DVM as my rapid special gives a very erratic AV voltage reading while the fluke is a true RMS device. I also used the fluke to check the current sensor calibration values by connecting it in series with a 4 way extension lead (after an in line RCD just to be on safe side)</p>
<p>I did suffer an odd problem with the serial output of the EMONTX, as soon as I connected the AC input I started getting about 16 bytes of garbage and the rest was OK. unplugging the AC input cleared the issue but that stopped me getting an accurate calibration. My first thought was that it was RF being picked up by the FTDi cable, so I commented out the TX function but this made no difference. Odd thing is that the data being transmitted to the GLCD was always OK</p>
<p>In the end I first increased the baud rate which reduced the number of scrambled bytes and then I added a delay into this part of the sketch :</p>
<pre>
&nbsp;&nbsp;&nbsp;&nbsp;

&nbsp;&nbsp;<span style="color: #CC6600;">digitalWrite</span>(LEDpin, <span style="color: #006699;">HIGH</span>);    <span style="color: #7E7E7E;">//flash LED - very quickly </span>
&nbsp;&nbsp;<span style="color: #CC6600;">delay</span>(2);
&nbsp;&nbsp;<span style="color: #CC6600;">if</span> (SERIAL) { serial_output();}
&nbsp;&nbsp;<span style="color: #CC6600;">delay</span>(10);    <span style="color: #7E7E7E;">// added delay as something screwing up local RS232 ?</span>
&nbsp;&nbsp;<span style="color: #CC6600;">digitalWrite</span>(LEDpin, <span style="color: #006699;">LOW</span>); 
&nbsp;&nbsp;rfwrite()&nbsp;;

</pre><p>&nbsp;So the order of sending the RS232 data and starting the RF transmit function have been altered and it has resolved the problem, I don't fully understand why this happened all I know is that the above mod fixed it !</p>
<p>My calibration values are :</p>
<pre>
&nbsp;&nbsp;emon1.calibration(184.85,125.0,1.7);		<span style="color: #7E7E7E;">//voltage calibration , current calibration, power factor calibration</span>

</pre><h3>&nbsp;04 February</h3>
<p>Fitted a 13A outlet fitted into the meter box using a an RCBO installed in the spare way left in the PV distrbution box to power the EMONTX which has been stuck to the housing using sticky back velco. At some point I need to shorten the CT sensor cables to tidy everything up but it's around freezing and their is snow on the way so today was not the day to be messing around outside for long.</p>
<p><img width="400" height="712" align="middle" alt="" src="http://openenergymonitor.org/emon/sites/default/files/04022012689sm.jpg" /></p>
<p>I've also made some progress on the Display. I've now got everything to complie on Ardunio 1.0 and added some code to drive a set of traffic lights based on the Grid power, the HE LED's I'm testing it with a bit too bright at the moment, so I'll probably change to 3mm types intead .&nbsp;I've also ordered a box for the LCD from RS. Once I've got the LCD fitted I'll post more pictures.</p>
<p><img width="700" height="393" alt="" src="http://openenergymonitor.org/emon/sites/default/files/04022012691sm.jpg" /></p>
<p>Traffic lights on red as I'm using the tumble drier as it's now snowing....</p>
<h3>07 February</h3>
<p>After a considerable ammount of carefull dremmeling and a lot of filing I've now got the JeeNode / Graphics board into the RS box. I had a slight problem when the the rear of the JeeNode fouled on the base of case &nbsp;and I only noticed after I'd cut the hole and glued the LCD in place (too late in other words. By bending the ports connecting the JeeNode to the display and by filing a bit off the JeeNode and the box it all fits - Just. I have used a 500mA swithmode 5v supply from RS and glued a Mini USB connector into the base of the box.</p>
<p><img width="700" height="393" alt="" src="http://openenergymonitor.org/emon/sites/default/files/08022012699sm.jpg" /></p>
<p>Just needs another OpenEnergyMonitor logo and it's done.</p>
<p>HE 5mm LED's replaced with some standard 3mm ones I recycled from an old control board I found at work, much better at least you can now see the LCD without getting blinded.</p>
<p>Had some discussion over the function of the Traffic Lights with the lady of the house. Currently LED's working off the Grid consumption, if the grid is under 1Kw it's green, 1Ww to 3 Kw it's Yellow and over 3Kw it's RED. Makes sense to me as this takes Solar PV production into account so during the day (when sunny) you can apply more load before you get the yellow / Red stage. Apparently thats too confusing !</p>
<p><em>To Do - Nanode RF and EMONCMS</em> however that will have to wait until later in the year my initial goal of being able to make sensible choices about how we consume energy during the day has been met.</p>
<p>I could not get anything onto GitHub despite following the idiots guide, I'm not that great with bash and the GUI is a nightmare so rather than waste time&nbsp;code is uploaded as a zip here :</p>
<p><a href="http://openenergymonitor.org/emon/sites/default/files/SB_Solar_PV_EMONTX&amp;GLCD.zip">openenergymonitor.org/emon/sites/default/files/SB_Solar_PV_EMONTX&amp;GLCD.zip</a></p>
<p>Changes are reasonably well comented if a bit crude in places !!&nbsp;</p>
<p>Simon Bateman</p>
<p>East Yorkshire</p>
</div>
    
    
      </div>
<div id="comments">
  <a id="comment-3082"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/10" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar PV Monitoring (II)</h3>

    <div class="submitted">Submitted by <a href="/emon/user/10" title="View user profile.">glyn.hudson</a> on Thu, 09/02/2012 - 15:10.</div>
    <div class="content">
     <p>Great job! Looks like a tidy setup. I notice the screen shows some horizontal lines. The display can be improved by adjusting the&nbsp;contrast of the display edit GLCD_ST7565.cpp. Change line 134 to be st7565_Set_Brightness(0x18); instead of 0x15.</p>
<p>&nbsp;</p>
<p>If you use the lasest GLCD lib from JCW's git hub and Arduno 1.0 this can be done in code with the line&nbsp;<em>glcd.begin(0x18)</em></p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-3085"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/500" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-500.jpg" alt="S Bateman&#039;s picture" title="S Bateman&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar PV Monitoring (II)</h3>

    <div class="submitted">Submitted by <a href="/emon/user/500" title="View user profile.">S Bateman</a> on Thu, 09/02/2012 - 19:18.</div>
    <div class="content">
     <p>Thanks,</p>
<p>Display looks worse on the picture that it is but&nbsp;&nbsp;I'll add that line to the sketch when the other half decides how she wants the traffic lights to work&nbsp;<img alt="" src="http://openenergymonitor.org/emon/sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/wink_smile.gif" /></p>
<p>Overall I'm pleased with the result though Display box came out better than expected and does not look too out of place stuck to the kitchen wall. The Energysmart has now gone to a new home in exchange for a 4 pack of Stella !</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div><a id="comment-3059"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/450" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar PV Monitoring (II)</h3>

    <div class="submitted">Submitted by <a href="/emon/user/450" title="View user profile.">stuart</a> on Wed, 08/02/2012 - 22:44.</div>
    <div class="content">
     <p>You've done a really good job there, if you'd be interested in trying out my SMA&nbsp;inverter bluetooth code (I also have a 3000HF model) that would be great!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<a id="comment-2725"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/10" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar PV Monitoring (II)</h3>

    <div class="submitted">Submitted by <a href="/emon/user/10" title="View user profile.">glyn.hudson</a> on Sat, 14/01/2012 - 00:03.</div>
    <div class="content">
     <p>Couple of things:</p>
<p>We usually use a simple plug in 5v USB power supply to supply power for the emonTx such as:<a href="http://uk.rs-online.com/web/p/products/736-1658/">&nbsp;http://uk.rs-online.com/web/p/products/736-1658/</a>. If making your own power supply make sure the 5V input is put through the 3.3v reg by connecting it to pwr. Battery input does not go through regulator.&nbsp;</p>
<p>No need to use a hardware RTC. The latest version of emonGLCD and emonBase code gets the current time back from the interent and posts up the temperature reading from the emonGLCD's internal temperature sensor to emoncms.</p>
<p>See:&nbsp;<a href="https://github.com/openenergymonitor/EmonGLCD/tree/master/emonGLCD_solarPV_AutoTime_TempLog">https://github.com/openenergymonitor/EmonGLCD/tree/master/emonGLCD_solarPV_AutoTime_TempLog</a></p>
<p>and&nbsp;<a href="https://github.com/openenergymonitor/NanodeRF/tree/master/NanodeRF_singleCT_RTCrelay_GLCDtemp">https://github.com/openenergymonitor/NanodeRF/tree/master/NanodeRF_singleCT_RTCrelay_GLCDtemp</a></p>
<p>We haven't really documented it well yet, expect a blog post soon. It works really well, been using it for several installations.</p>
<p>Keep up the good work.</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2736"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/500" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-500.jpg" alt="S Bateman&#039;s picture" title="S Bateman&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar PV Monitoring (II)</h3>

    <div class="submitted">Submitted by <a href="/emon/user/500" title="View user profile.">S Bateman</a> on Sun, 15/01/2012 - 10:14.</div>
    <div class="content">
     <p>Hi Glynn,</p>
<p>Thanks for the feedback, My meter box on the outside of the house in now very busy (just added Picture above) and I didn't have space for a double socket so I decided to make the PSU part of the TX unit. &nbsp; I actually found the PWR / VCC out by mistake, luckily the batteries I was powering the EMONTX from are pound shop specials and only gave about 4v so I did'nt damage the RF module.</p>
<p>Looks like a took up the project build at an interesting time, I started with Arduino 1.0 and could not get anything to compile, switched over to the older 0023 bulid, found all of the libraries and made the changes I&nbsp;wanted and at the same time you have made a good job of sorting out the same sketches for 1.0 !&nbsp; For now I have something that works so I can get the hardware side sorted out and then I'll switch over the the 1.0 sketches.</p>
<p>Thanks for the heads up on the RTC feature, I don't think I'll get the Nanode RF until later in the year but we should be able to cope with the Soft RTC in the mean time.</p>
<p>I'll keep the updates coming - Keep up the good work !</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-3057"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/500" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-500.jpg" alt="S Bateman&#039;s picture" title="S Bateman&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar PV Monitoring (II)</h3>

    <div class="submitted">Submitted by <a href="/emon/user/500" title="View user profile.">S Bateman</a> on Wed, 08/02/2012 - 17:43.</div>
    <div class="content">
     <p>&nbsp;Well that's my build updated, I'll be working on the Internet side of things later in the year.</p>
<p>I hope it's OK that I zipped my sketches, I gave up with GITHUB, after 2 hours I still could not even get my readme to upload&nbsp;<img alt="" src="http://openenergymonitor.org/emon/sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/sad_smile.gif" /></p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-3110"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/500" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-500.jpg" alt="S Bateman&#039;s picture" title="S Bateman&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar PV Monitoring (II)</h3>

    <div class="submitted">Submitted by <a href="/emon/user/500" title="View user profile.">S Bateman</a> on Sat, 11/02/2012 - 19:02.</div>
    <div class="content">
     <p>&nbsp;Today was reasonably bright and sunny, and the GLCD showed 10.3 KWH generated which to be honest &nbsp;I didn't belive...</p>
<p><img width="650" height="381" alt="" src="/emon/sites/default/files/Comparison.jpg" /></p>
<p>However on checking with the SMA &quot;Sunny Explorer&quot; software it's only out by 270wh which is around 2% which I think I can live with !!</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div></div></div></div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
