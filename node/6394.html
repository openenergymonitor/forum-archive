<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6394 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:01:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>controlling a device with button-widget possible? --&gt; packet-generator? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">controlling a device with button-widget possible? --&gt; packet-generator?</h3>
        <span class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Wed, 31/12/2014 - 10:31</span>
        <div class="content"><p>Hi,</p>
<p>I have seen, there is a button widget in emoncms.<br />
But til now no useful help to this item found.</p>
<p>Is it possible to make any outgoing reaction (TCP-telegram or similiar) when the button is pressed?<br />
I tried to use the button widget within a dashboard, but with no success.<br />
Configuring the button, he asks on a feed??? How to create such a feed? Always thought feeds are incoming datas.</p>
<p>Thx, in advance, for your replies.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="9983.html" class="topic-previous" title="Go to previous forum topic">‹ Getting started</a>
              <a href="9977.html" class="topic-next" title="Go to next forum topic">CT clamp precision using EmonTx v3 with batteries ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26313"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Thu, 01/01/2015 - 16:48.</div>
    <div class="content">
     <p>Hi,</p>
<p>wish you all a happy new year :-)</p>
<p>In the meantime, I have found, that outgoing reactions will only work with the RFM12 packet generator.</p>
<p>Looks, as if this is of no use for me, because i have an own arduino with wlan-interface, who is sending temperature-datas over ethernet to emoncms, using bulk.json comands.</p>
<p>If there would be a possibility, to send out a tcp-telegram like &quot;method=get&quot; or something else from emoncms to the arduino, I could decode them and control binary outputs over this.</p>
<p>Does somebody have any experience in this??</p>
<p>EDIT:<br />
I would like to test for myself, but I nowhere found any hint how to install/integrate the packetgen-modul into emoncms 8.4.0.<br />
There is only some tips or a ready to use image for a rasp-pi, but my emoncms is running on a windows7-server :-(</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26319"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 01/01/2015 - 17:24.</div>
    <div class="content">
     <p>Hi, All the &quot;emoncms modules&quot; follow a similar installation method, you need to clone that&nbsp;modules repo&nbsp;from git into the emoncms/Modules folder and then open emoncms&nbsp;in your browser =&gt;&nbsp;Admin =&gt; Update&nbsp;&amp; check.</p>
<p>You should also take a look at the events module as that can react to a feed (switched state) and send a request, email, publish to&nbsp;mqtt or just update another feed etc.</p>
<p>I have been playing with the button-widgets too and now have feeds set up for several buttons and can poll those feeds by feedid to establish their&nbsp;state, 1 or 0 at a regular&nbsp;interval individually&nbsp;using a &quot;value&quot; feed api url or several at once using the recently added &quot;fetch&quot; api.</p>
<p>I&#39;ve made a couple of changes to the button-widget code to get it working and will submit a pull req once tested.</p>
<p>I&#39;m currently having issues getting the events module to play ball.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26323"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Thu, 01/01/2015 - 22:14.</div>
    <div class="content">
     <p>Hi,</p>
<p>got it installed. Now i have a new pulldown with Extras-&gt;RFM12b Packet Generator.</p>
<p>&gt;&gt; I have been playing with the button-widgets too and now have feeds set up for several buttons and can poll those feeds by feedid to establish their&nbsp;state, 1 or 0 at a regular&nbsp;interval individually&nbsp;using a &quot;value&quot; feed api url or several at once using the recently added &quot;fetch&quot; api.</p>
<p>A little bit hard to understand for me :-(&nbsp; (totaly new stuff and different language)<br />
You talk about &quot;poll&quot;. Does this mean, I have to send a feed-telegram to emoncms to get back the state of an item?<br />
I think it would be easier to understand, if i would have an example, that i could examine. Is there anywhere such an example?</p>
<p><u>EDIT:</u><br />
OK got event-module installed too. Think, this is could be a way for me.<br />
I already was able to send some information to my arduino, using the &quot;call url&quot; methode. (the arduino is listening as server)</p>
<p>What I did:</p>
<p>- Create a new input, create a feed from this input (log-feed)<br />
- Make a button with this feed.<br />
- Control this button with commands:<br />
--&gt; switch off: http://192.168.1.80/emoncms/input/bulk.json?data=[[0,3,0]]&amp;apikey=...<br />
--&gt; switch on: http://192.168.1.80/emoncms/input/bulk.json?data=[[0,3,1]]&amp;apikey=...<br />
- as a result the button is changing between red and green.<br />
- Set up an event: if &quot;feed&quot; &gt; 0 call url......<br />
--&gt; On changing from 0-&gt;1 i get an outgoing telegram to my arduino-server</p>
<p>Thats very good so far :-)))</p>
<p>&nbsp;</p>
<p><strong>BUT: I completely do not realize, how to make any changes on a variable or feed from a dashboard.</strong></p>
<p><strong>When i integrate a button, then I can assign a feed and a starting value. But after storing the dashboard, i can not see any reaction on pressing the button... :-(</strong></p>
<p><u>EDIT 2nd:</u></p>
<p>One step further:<br />
Creating the button without writing a startvalue makes more success.<br />
I can switch the button by clicking on it from red to green (0-&gt;1).<br />
<strong>But after a few seconds it is switching back to &quot;0&quot;, and the event is not reacting too. It does not see the change from 0 -&gt; 1</strong></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26357"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 02/01/2015 - 17:21.</div>
    <div class="content">
     <p>I&#39;m currently struggling a&nbsp;bit with this too,</p>
<p>I think we may want the same result but going about it different ways. my &quot;poll&quot; reference was basically I can currently use&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; http://CMS.IP.OR.URL/emoncms/feed/<strong>value</strong>.json?<strong>id</strong>=<em><strong>123</strong></em>&amp;apikey=1a2b3c4etc</p>
<p>to get the current value (status) of a feed or&nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; http://CMS.IP.OR.URL/emoncms/feed/<strong>fetch</strong>.json?<strong>ids</strong>=<strong>123,124,125,126</strong>&amp;apikey=1a2b3c4etc&nbsp;</p>
<p>to return a batch of values (statuses).</p>
<p>This is similar&nbsp;to how&nbsp;packetgen&nbsp;works, in that the &quot;packetgen hack&quot; for emonhub&nbsp;&quot;polls&quot; the packetgen module every 5 seconds and returns the values set in the packetgen gui, except this works on the feed data directly.</p>
<p>The button widgets are &quot;quirky&quot; and I have made progress with improving their function, I have then switching the feed value from 1 to 0 or 0 to 1 no problem, I also have the button colour changing with the feed value rather than displaying the last &quot;status set by that button&quot; which is handy as I am also able to set/change the feed values remotely using the feeds api and the button colours change on the dashboard. I have also incorperated an &quot;interim colour&quot; eg if the button is green and it is clicked the button instantly turns pink to acknowledge the click and then when the page is refreshed/re-rendered it will change colour&nbsp;again,to&nbsp;red&nbsp;confirming the feed has actually changed, the same happens using yellow before green in the opposite direction.</p>
<p>The events module however is a different matter, I can use the &quot;test&quot; function but as soon as I set any events I can no longer update the feed being monitored, I just get an error and thats where I&#39;m currently at.</p>
<p>I cannot be sure if the events module isn&#39;t working because of something I&#39;ve changed or not, so until I fix that I&#39;m unsure if the button stuff is any good. Progress is painfully slow at the moment as I&#39;m not good with the php, js or sql, let alone the 3 combined.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26398"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Sat, 03/01/2015 - 22:01.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>ok.</p>
<p>Do you want to share your actual button code with me?<br />
I am not good with php too, but perhaps it is helpful to view the stuff from a different pair of eyes?</p>
<p>&nbsp;</p>
<p>EDIT:<br />
I tested your &quot;polling-methode&quot;. Thats pretty easy, and I think this is the better way for me too, because I do not need to setup a tcp-server on my arduino. I can use the existing tcp-client to poll values in the same way as I send data to emoncms. --&gt; No need for me any more to use the event module ;-)<br />
Now I have only the problem, that my buttons do not hold the actual state. They are always switching back to the last input value, when I change them from the dashboard.<br />
Looks like you do not have the same problem? Is this because of your code-changes, or do i use the widget in a wrong way?</p>
<p>EDIT2:<br />
Can it be, that on clicking the button in a dashboard, only the color of the button is changed and the feed-value stays at the old value? And then after a few seconds the dashboard is refreshed and takes the value from the feed?</p>
<p>EDIT3:<br />
I think, that this <strong>feed.set(feedid,{&#39;time&#39;:parseInt((new Date()).getTime()/1000),&#39;value&#39;:outval});</strong> is somehow not working proper?<br />
To figure this out, I tried a few things with the API-commands (feed/set.json and feed/update.json), but had until now no success to get a new value into the feed or to change a feedvalue.</p>
<p>--&gt; myIP/emoncms/feed/set.json?id=37&amp;fields={&#39;value&#39;:&#39;123&#39;}<br />
returns a: <u>{&quot;success&quot;:false,&quot;message&quot;:&quot;Field could not be updated&quot;}</u></p>
<p>--&gt; myIP/emoncms/feed/update.json?id=37&amp;time=UNIXTIME&amp;value=100.0<br />
returns a: <u>null</u> and I see a new timestamp in the feeds-table of the database. But the value is set to &quot;0&quot;</p>
<p>- Adding the &amp;apikey=6565346546.... does not help :-(<br />
- Is the syntax wrong?<br />
- Or should the button-widget use an input-api instead of a feed-api to change a value?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26412"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 03/01/2015 - 22:49.</div>
    <div class="content">
     <p>I don&#39;t mind sharing at all I&#39;m just not overly sure of what I&#39;m at so things are being chopped about quite frequently.</p>
<p>This is what I have right now.</p>
<p>Firstly I noticed the set.json didn&#39;t have a &quot;value&quot; field for <a href="../../../github.com/emoncms/emoncms/blob/master/Modules/dashboard/Views/js/widgets/button/button_render.html#L41">feed.set(feedid,{&#39;time&#39;:parseInt((new Date()).getTime()/1000),&#39;value&#39;:outval});</a> to use and so in&nbsp;emoncms/Modules/feed/feed_model.php&nbsp;I added&nbsp;</p>
<p><strong>if (isset($fields-&gt;value)) $array[] = &quot;`value` = &#39;&quot;.preg_replace(&#39;/[^\w\s-:]/&#39;,&#39;&#39;,$fields-&gt;value).&quot;&#39;&quot;;</strong></p>
<p>immediately after&nbsp;<a href="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.php#L376">if (isset($fields-&gt;public)) $array[] = &quot;`public` = &#39;&quot;.intval($fields-&gt;public).&quot;&#39;&quot;;</a>&nbsp;and also added&nbsp;</p>
<p><strong>if ($this-&gt;redis &amp;&amp; isset($fields-&gt;value)) {$this-&gt;redis-&gt;hset(&quot;feed:$id&quot;,&#39;value&#39;,$fields-&gt;value);</strong></p>
<p>immediately&nbsp;after&nbsp;<a href="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.php#L385">if ($this-&gt;redis &amp;&amp; isset($fields-&gt;public)) $this-&gt;redis-&gt;hset(&quot;feed:$id&quot;,&#39;public&#39;,$fields-&gt;public);</a></p>
<p>This allowed the button to update the feed, although this worked I have since discovered this wasn&#39;t the best way to do this and I&#39;m looking at another method.&nbsp;But the button behavior was really quirky so.....</p>
<p>&nbsp;</p>
<p>In&nbsp;emoncms/Modules/dashboard/Views/js/widgets/button/button_render.js I have changed&nbsp;<a href="../../../github.com/emoncms/emoncms/blob/master/Modules/dashboard/Views/js/widgets/button/button_render.html#L37">var invalue = $(this).attr(&quot;value&quot;);</a>&nbsp;to&nbsp;&nbsp;<strong>var invalue = assoc[feedname];&nbsp;</strong>so that the &quot;before click&quot; status is taken from the feed value rather than a retained &quot;status after&nbsp;last button click&quot;.</p>
<p>For that to work correctly I had to also change how the&nbsp;&quot;value when rendered&quot;&nbsp;is handled by adding</p>
<blockquote><p><strong>if (assoc[feed] !== assoc[feed]) {<br />
&nbsp;&nbsp; &nbsp;if ($(this).attr(&quot;value&quot;) !== $(this).attr(&quot;value&quot;)) $(this).attr(&quot;value&quot;,0);&nbsp;<br />
&nbsp;&nbsp; &nbsp;assoc[feed] = $(this).attr(&quot;value&quot;);<br />
&nbsp; &nbsp; }&nbsp;&nbsp;</strong></p>
</blockquote>
<p>immediately before&nbsp;<a href="../../../github.com/emoncms/emoncms/blob/master/Modules/dashboard/Views/js/widgets/button/button_render.html#L60">var val = assoc[feed];</a>&nbsp;This will fetch the feed value and <span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">change null and undefined values to a zero and load&nbsp;&nbsp;&quot;assoc[feedname]&quot; in preparation for the first click even if a &quot;starting value&quot; was not set in the widget settings.</span></p>
<p>I also changed&nbsp;<a href="../../../github.com/emoncms/emoncms/blob/master/Modules/dashboard/Views/js/widgets/button/button_render.html#L45">draw_button(widgetcanvas[id], outval);</a>&nbsp;to&nbsp;<strong>draw_button(widgetcanvas[id], outval + 4);&nbsp;</strong>as this line immediately changes the button colour, by adding the +4 a different colour is selected for the duration between clicking the button and the button re-rendering to display the correct colour based on reading the current feed value.&nbsp;</p>
<p>This improved the button action 10 fold but the way the feed was being updated was wrong as that method was intended for settings and names etc not data. I worked this out the hard way as the events module kept failing.</p>
<p>Now I am playing with different ways of implementing an update function for the button to use, I have currently changed the feed.<a href="../../../github.com/emoncms/emoncms/blob/master/Modules/dashboard/Views/js/widgets/button/button_render.html#L41">set(feedid,{&#39;time&#39;:parseInt((new Date()).getTime()/1000),&#39;value&#39;:outval});</a> line to <strong>feed.update(feedid,parseInt((new Date()).getTime()/1000),outval);</strong> and in&nbsp;emoncms/Modules/feed/feed.js I&#39;ve added&nbsp;</p>
<p>&nbsp;<strong> &#39;update&#39;:function(id, time, value)<br />
&nbsp; {<br />
&nbsp; &nbsp; var result = {};<br />
&nbsp; &nbsp; $.ajax({ url: path+&quot;feed/update.json&quot;, data: &quot;id=&quot;+id+&quot;&amp;time=&quot;+time+&quot;&amp;value=&quot;+value, async: false, success: function(data){} });<br />
&nbsp; &nbsp; return result;<br />
&nbsp; },</strong></p>
<p>at<a href="../../../github.com/emoncms/emoncms/blob/8a4bbfa9210a221eabb8ef967e73ce37b17e523d/Modules/feed/feed.html#L75"> line 75</a>&nbsp;(that function&nbsp;is just 3 lines starting &quot;var&quot;,&nbsp;&quot;$.ajax&quot;&nbsp;and &quot;return&quot; - no line wrap)</p>
<p>I have since changed&nbsp;<a href="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_controller.php#L87">if ($route-&gt;action == &quot;update&quot;) $result = $feed-&gt;update_data($feedid,time(),get(&quot;time&quot;),get(&#39;value&#39;));</a> in emoncms/Modules/feed/feed_controller.php&nbsp;to</p>
<p><strong>if ($route-&gt;action == &quot;update&quot;) $result = $feed-&gt;update_data($feedid,time(),get(&quot;time&quot;),null,get(&#39;value&#39;)); </strong>(all one line)</p>
<p>as it appears to pass&nbsp;one time value not the 2 as required by the ;<a href="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.php#L429">public function update_data($feedid,$updatetime,$feedtime,$value)</a>. This seems to work correctly but will probably effect something else so probally isn&#39;t the best idea, plus I still can&#39;t get the events module to work.</p>
<p>I hope this makes some sense, maybe you can make some use of it too.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26414"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 03/01/2015 - 23:21.</div>
    <div class="content">
     <p>No I take that last bit back, it doesn&#39;t appear to be working. so I think we are at the same place. Trying to get&nbsp;</p>
<p><a href="../../../github.com/emoncms/emoncms/blob/master/Modules/dashboard/Views/js/widgets/button/button_render.html#L41">feed.set(feedid,{&#39;time&#39;:parseInt((new Date()).getTime()/1000),&#39;value&#39;:outval});</a></p>
<p>to work with either feed/insert or feed/update (which I can&#39;t tell apart)&nbsp;</p>
<p>Paul</p>
<p>edit - so to recap I can get the buttons to work smoothly and correctly both from the dashboard widget and from a url. I can establish the status of those feeds using a request, but the feed engines are not being used as the wrong api is being used, which also means the event module isn&#39;t informed when the feed is updated.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26415"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Sat, 03/01/2015 - 23:39.</div>
    <div class="content">
     <p>Hi,</p>
<p>thx for your detailed explanation. Some things are logical for me.</p>
<p>But I think that there is something basicly wrong. Perhaps only on my emoncms-installation.</p>
<p>In my opinion, my first step should be to change/update values from the browser line via feed/api-comands.<br />
As long as this is not working, all the other stuff is senseless. Do you agree?</p>
<p>Did you try this api-comands. Do you have a correct syntax for me. I only could use the Feed Api Help. And this is not working as expected. (See my last post)</p>
<p>I hope we do not talk past each other, but for me its a little bit hard to understand your explanations, because english is not my native language.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26416"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 03/01/2015 - 23:52.</div>
    <div class="content">
     <p>I have now removed that last edit as it was that &quot;null&quot; i added that broke the &quot;update&quot; for me, so</p>
<p>&nbsp;I&#39;m currently able to update from the browser address bar using&nbsp;urls</p>
<p><a href="http://cms.ip.or.url/emoncms/feed/update.json?id=10&amp;time=1420328088&amp;value=1&amp;apikey=123abc" title="http://CMS.IP.OR.URL/emoncms/feed/update.json?id=10&amp;time=1420328088&amp;value=1&amp;apikey=123abc">http://CMS.IP.OR.URL/emoncms/feed/update.json?id=10&amp;time=1420328088&amp;valu...</a></p>
<p>or</p>
<p>​http://CMS.IP.OR.URL/emoncms/feed/insert.json?id=10&amp;time=1420328088&amp;value=1&amp;apikey=123abc</p>
<p>​Both work and the above changes from feed.set to feed.update are working again, I think !!</p>
<p>Your English is good, I think it&#39;s the topic not the language that makes it tricky.</p>
<p>Paul&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26419"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Sun, 04/01/2015 - 00:38.</div>
    <div class="content">
     <p>Hi,</p>
<p>Change values from the browser:</p>
<p>update.json is not working @all<br />
insert.json is working.</p>
<p>Based on this and your tips I only made 2 changes now:</p>
<p>1.)<br />
Add this in feed.js:</p>
<p><strong>&nbsp;&nbsp;&nbsp; &#39;insert&#39;:function(id, time, value)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; var result = {};<br />
&nbsp;&nbsp;&nbsp; $.ajax({ url: path+&quot;feed/insert.json&quot;, data: &quot;id=&quot;+id+&quot;&amp;time=&quot;+time+&quot;&amp;value=&quot;+value, async: false, success: function(data){} });<br />
&nbsp;&nbsp;&nbsp; return result;<br />
&nbsp; },</strong></p>
<p>2.)<br />
Change the feed.set line in the button_render.js to this:</p>
<p><strong>&nbsp;//&nbsp;&nbsp; feed.set(feedid,{&#39;time&#39;:parseInt((new Date()).getTime()/1000),&#39;value&#39;:outval});<br />
&nbsp;&nbsp; &nbsp;feed.insert(feedid,parseInt((new Date()).getTime()/1000),outval);</strong></p>
<p>Now, I am able to change the button as needed. A klick toggles the state from 0-&gt;1 or the other way round.</p>
<p>And with<br />
<a href="http://192.168.1.80/emoncms/feed/value.json?id=37&amp;apikey=123abc" title="http://192.168.1.80/emoncms/feed/value.json?id=37&amp;apikey=123abc">http://192.168.1.80/emoncms/feed/value.json?id=37&amp;apikey=123abc</a><br />
I get back the actual value ( &quot;0&quot; or &quot;1&quot;)</p>
<p>Thats what I need to control a relay on the arduino from emoncms :-)</p>
<p>
But you are right. Changing the feed-values do not have any affect on the event module. This is only reacting, if I make a value change on the input-value.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26420"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 04/01/2015 - 00:32.</div>
    <div class="content">
     <p>I think update is fussy about the timestamp, I think it will only work if the timestamp is greater than the last timestamp. try with the current unix timestamp and then add a couple of seconds and change the value =&gt; SEND then add couple more seconds and change the value =&gt; SEND again, see if that works for you.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26421"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Sun, 04/01/2015 - 00:58.</div>
    <div class="content">
     <p>I don&#39;t think it is a problem with the timestamp.</p>
<p><strong>http://192.168.1.80/emoncms/feed/update.json?id=37&amp;value=6&amp;apikey=123abc</strong> --&gt; :-(<br />
<strong>http://192.168.1.80/emoncms/feed/insert.json?id=37&amp;value=6&amp;apikey=123abc</strong> --&gt; :-)</p>
<p>Using the update.json without time-option, it makes an update in the mysql database with the actual timestamp, but changing the value to &quot;0&quot;</p>
<p>With insert.json its working great.</p>
<p><u><strong>BUT</strong></u>: As soon, as I declare an event on this feed, I can not use the insert.json, or update.json api-calls at all.<br />
I get back a Fatal error- (Look at the assigned screenshot).<br />
Even there is an error, the feed value is updated on using the insert comand.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26422"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 04/01/2015 - 01:01.</div>
    <div class="content">
     <p>I experienced the <a href="6410.html">same fatal error </a>when trying to use the my first solution &quot;set.json fields=value&quot; which I suspected to be due to lack of timestamps. The events module is driven by the &quot;last update&quot; timestamp which is supplied by the &quot;updated at time stamp&quot; not the datapoint&nbsp;timestamp.</p>
<p>I have just tried switching browser to see if &nbsp;get different results and the buttons are just black and not working in chrome. I think I&#39;m spending far too much time on this now, see how I feel tomorrow :-(</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26423"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Sun, 04/01/2015 - 01:11.</div>
    <div class="content">
     <p>Coming back to my &quot;idea&quot; a few posts before.</p>
<p>What, if we do not update the feed value. If we update the input value?<br />
Is there a chance to do this within the button_render.js?</p>
<p>Or can this cause different problems?</p>
<p>But i will go to sleep right now. Its 2:00 in the morning.....<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26436"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 04/01/2015 - 16:58.</div>
    <div class="content">
     <p>Had another stab at this and made a&nbsp;little&nbsp;more progress. I have made a created a &quot;set_feed&quot; function in feed.js</p>
<p><strong>&#39;set_feed&#39;:function(feedid,time,value)<br />
&nbsp; {<br />
&nbsp; &nbsp; var result = {};<br />
&nbsp; &nbsp; var apikeystr = &quot;&quot;; if (feed.apikey!=&quot;&quot;) apikeystr = &quot;&amp;apikey=&quot;+feed.apikey;<br />
&nbsp; &nbsp; $.ajax({ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; url: path+&#39;feed/update.json?&#39;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />
&nbsp; &nbsp; &nbsp; data: &quot;id=&quot;+feedid+&quot;&amp;time=&quot;+time+&quot;&amp;value=&quot;+value+apikeystr,<br />
&nbsp; &nbsp; &nbsp; async: false, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; &nbsp; &nbsp; success: function(data) {}&nbsp;<br />
&nbsp; &nbsp; });<br />
&nbsp; &nbsp; return result;<br />
&nbsp; },</strong></p>
<p>This is called from&nbsp;button_render.js by changing the<a href="../../../github.com/emoncms/emoncms/blob/master/Modules/dashboard/Views/js/widgets/button/button_render.html#L41"> feed.set line</a>&nbsp;to</p>
<p><strong>feed.set_feed(feedid,parseInt((new Date()).getTime()/1000),outval);</strong></p>
<p>This seems to work ok! however I did get caught out when I took a break and came back to it as the open &quot;dashboard&quot; webpage doesn&#39;t refresh on timeout, so although I was effectively logged out (timed out) the webpage and the buttons continued to function but not update the feed due to lack of apikey. Once refreshed and logged in again the feed updates with the button clicks, I have been watching the feed in a realtime&nbsp;vis.</p>
<p>But still no joy from the events module and none of this seems to work in chrome so still a long way to go!</p>
<p>Paul</p>
<p>PS I haven&#39;t tried using the input api yet as that feels like extra steps to the same point. We would need to create an input, with a node id&nbsp;and a process list to &quot;log to feed&quot; and that process will just call the same &quot;update_feed&quot; function. The button is still attached to the feed rather than the input unless the code is dramatically changed. The inputs are not as robust as the feeds either so I will persevere for now, but haven&#39;t&nbsp;ruled out trying to use an input as a work around if all else fails.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26448"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Sun, 04/01/2015 - 23:38.</div>
    <div class="content">
     <p><strong>&gt;&gt; We would need to create an input, with a node id&nbsp;and a process list to &quot;log to feed&quot; and that process will just call the same &quot;update_feed&quot; function.</strong></p>
<p>[OffTopic]<br />
Hmmm. I am missing the quote-function in this board :-(<br />
[/OffTopic]</p>
<p>How do you make a button-feed without an input?<br />
I only know the way to make an input-node and put a &quot;log to feed&quot; on it. And that was the base for all my coding the last days.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26468"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 05/01/2015 - 14:10.</div>
    <div class="content">
     <p>A feed can be created using a new input or even just created on the end of an existing inputs processlist and then immediately removed from the list, as this doesn&#39;t delete the actual feed, Likewise you could now delete the input along with its processing and the feed will remain.</p>
<p>Alternatively the feed api can be used, I created my &quot;toggle_button&quot; feeds using this url</p>
<p>http://CMS.IP.OR.URL/emoncms/feed/create.json?name=<em>MyNewFeed</em>&amp;datatype=1&amp;engine=2&amp;apikey=123abc</p>
<p>​The engine type can be established by either examining&nbsp;the emoncms code or can be &quot;copied&quot; from existing feeds either via phpmyadmin&nbsp;or by listing your existing feeds with the api</p>
<p><a href="http://cms.ip.or.url/emoncms/feed/list.json&amp;apikey=123abc" title="http://CMS.IP.OR.URL/emoncms/feed/list.json&amp;apikey=123abc">http://CMS.IP.OR.URL/emoncms/feed/list.json&amp;apikey=123abc</a>.</p>
<p>​Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26475"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Mon, 05/01/2015 - 17:58.</div>
    <div class="content">
     <p>Hi,</p>
<p><strong>&gt;&gt;Likewise you could now delete the input along with its processing and the feed will remain.</strong></p>
<p>No, I need the input, because I want to control the heater of my warmwaterboiler. Now I can make a request on this from emoncms (all over the world), my arduino takes this request and clears it via input-api. And the boiler is then running for a certain time (controlled by arduino). State of the boiler will be shown by a LED-widget.</p>
<p>BTW: Do you see a possibility to handover a time-setvalue to my arduino? Sending a number is not different as sending the control 0/1 (because its the same type of var). But how can I give in a dashboard the variable a defined value?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26476"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 05/01/2015 - 19:28.</div>
    <div class="content">
     <blockquote><p><em>No, I need the input,</em></p>
</blockquote>
<p>I wasn&#39;t saying you should, just answering your question how :-)</p>
<p>Although a feed can also be set or queried from all over the world without ann input, but if you want to display the status of the boiler rather than display the desired status an input would be required and that would be better driving&nbsp;an led-widget independent of the button or feed.</p>
<p>I&#39;m not entirely&nbsp;sure what you mean by &quot;time-setvalue&quot; but if you want to send a value other than 1 or 0, you could write something custom or use feeds and input processing. eg if you want heater to run for 3 hours you could multiply the &quot;1&quot; by 3 for hours or 180 for mins etc and use the resulting feed value, you could even control that time value via an input or feed api. FeedA&nbsp;is controlled by button(0or1) x FeedB&nbsp;set via api to &quot;TimePeriod&quot; = 0 if button is off or whatever the &quot;TimePeriod&quot; is if on.&nbsp;</p>
<p>If you are looking to use the&nbsp;actual time of day as a scheduler you would be far better off using cron to change the feeds status between 0 or 1 and use the button as a manual override. I have an artificial node set up using cron&nbsp;to provide values at predefined times via a web socket to emonhub. I call it <a href="https://github.com/pb66/cronnode">CronNode</a>&nbsp;and use it to switch energy tarrifs&nbsp;but it will soon be used to switch &quot;control&quot; feeds in exactly the same way.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26477"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 05/01/2015 - 19:35.</div>
    <div class="content">
     <p>And if you want to get the time the heater is switched on you can run&nbsp;</p>
<p>http://CMS.IP.OR.URL/emoncms/feed/get.json?id=<em>123</em>&amp;field=&quot;time&quot;</p>
<p>after the&nbsp;change in state is detected.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26478"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 05/01/2015 - 19:58.</div>
    <div class="content">
     <p>And just to keep this up&nbsp;to date, the changes discussed that I previously reported as working from IE but not chrome, do actually work from chrome as long as I&#39;m logged in.</p>
<p>Supplying the apikey&nbsp;in the api url does&nbsp;not work &quot;fully&quot; I have not figured it out yet but using the apikey in the url gives me a partial log-in, as in I can see the page but the buttons are all black and do not respond to clicks. I think this is now a different&nbsp;manifestation of&nbsp;the page appearing&nbsp;to function but not effecting the feeds in IE, seen when&nbsp;the session times out but the page doesn&#39;t refresh.</p>
<p>And the events module is still not working.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26479"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Mon, 05/01/2015 - 21:08.</div>
    <div class="content">
     <p><strong>&gt;&gt;I&#39;m not entirely&nbsp;sure what you mean by &quot;time-setvalue&quot; </strong><br />
I want to give my arduino from the dashboard an integer (= minutes) how long the heater should run, when it is started from emoncms.</p>
<p>The sequence of events should be:<br />
dashboard: define a timeperiod in minutes, send this and a &quot;heater-on-request&quot; to my arduino.<br />
arduino: receive the timeperiod and the request.<br />
arduino: start the heater for the predefined time, and clear the request.<br />
arduino: send status-information (heater on/off; remaining time) to emoncms-dashboard.</p>
<p>At now only missing an inputfield in emoncms for a number-value. e.g.120 (for 2hours)<br />
Perhaps i will define several requests for different timeperiods.....</p>
<p><strong>&gt;&gt;And the events module is still not working.</strong><br />
Yesterday I thought, I do not need this, because I can poll the values from emoncms. But this means, that there is always a time delay (in worst case the time between two polling events) between the action on the dashboard and the reaction on the arduino.<br />
But the only option to this is to setup a server on my arduino and a working event-module......</p>
<p><strong>&gt;&gt;If you are looking to use the&nbsp;actual time of day as a schedule</strong>...<br />
No, and if, cron is not usable for me. I am using emoncms on a windows7-computer ;-)</p>
<p>&nbsp;</p>
<p>Do you think, it is possible to make a copy of the button-widget, and rewrite the code, that the button2_events() does not make an api-call like feed.insert.....&nbsp; but makes a &quot;call url&quot;<br />
Something like this: <a href="http://192.168.1.80:8080/?sendstring" title="http://192.168.1.80:8080/?sendstring">http://192.168.1.80:8080/?sendstring</a></p>
<p>Likely the same as the event module makes on curl, but initiated directly from the button.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26482"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Tue, 06/01/2015 - 01:03.</div>
    <div class="content">
     <p>OK</p>
<p>to my last thought (send a call url from buttonklick)<br />
I have never done something with js or ajax or similiar before emoncms. Therefore this will be somehow crazy.<br />
But I have searched a lot in the web today, and have a &quot;beginning&quot; of a solution for me:</p>
<p>Knowing no better place, I have extended the feed.js with this function:<br />
<strong>&nbsp;&nbsp;&nbsp; &#39;curltest&#39;:function()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; var result = {};<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$.ajax({<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;url: &#39;http://192.168.1.80:8080&#39;,<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;data: {&#39;request&#39;:1},<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;dataType: &#39;xml&#39;,<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;complete : function(){<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;alert(this.url)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;},<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;success: function(xml){<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;});<br />
&nbsp;&nbsp;&nbsp; return result;<br />
&nbsp; },</strong></p>
<p>And then changed the feed-call in the button render.js with this:<br />
<strong>&nbsp;&nbsp;&nbsp; feed.curltest();</strong></p>
<p>Whats the result? Every time I press the button, I get this on my server: (actually tested with SocketTest and Port 8080 on the same computer)</p>
<p><strong>&gt; New Client: 192.168.1.80<br />
GET /?request=1 HTTP/1.1<br />
Host: 192.168.1.80:8080<br />
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0<br />
Accept: application/xml, text/xml, */*; q=0.01<br />
Accept-Language: de,en-US;q=0.7,en;q=0.3<br />
Accept-Encoding: gzip, deflate<br />
Referer: <a href="http://192.168.1.80/emoncms/dashboard/view" title="http://192.168.1.80/emoncms/dashboard/view">http://192.168.1.80/emoncms/dashboard/view</a><br />
Origin: <a href="http://192.168.1.80/" title="http://192.168.1.80">http://192.168.1.80</a><br />
Connection: keep-alive</strong></p>
<p>Using the event-testfunction it looks like this:<br />
<strong>&gt; New Client: 192.168.1.80<br />
GET /?request=1 HTTP/1.1<br />
Host: 192.168.1.80:8080<br />
Accept: */*</strong></p>
<p><strong>&gt; Client closed conection.</strong></p>
<p>There is still some difference (above all the keep alive connection), but basicly I get a telegram to my tcp-server.</p>
<p>If somebody knows how to make this better, don&#39;t hesitate to tell.</p>
<p>My aim will be, to make a sort of button-widget which sends out a telegram on klicking, with a option for the url and the payload.<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26483"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Tue, 06/01/2015 - 01:16.</div>
    <div class="content">
     <p>A little further: Why using a function for this.</p>
<p>I only take this codeline into the button_render.js:</p>
<p><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $.ajax({type:&#39;GET&#39;, url:&#39;http://192.168.1.80:8080&#39;, data: &quot;request=1&quot;, timeout: 1000 });</strong><br />
&nbsp;</p>
<p>with the timeout I get a connection close after one second.</p>
<p>
Tomorrow I will create a new widget, with options (hopefully)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26495"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Tue, 06/01/2015 - 15:05.</div>
    <div class="content">
     <p>Here again:</p>
<p>made a new widget for me: &quot;curl_render.js&quot;.<br />
Its a copy of the button_render.js with 4 parameters:</p>
<ul>
<li>IP-adress</li>
<li>port</li>
<li>SendString</li>
<li>colour</li>
</ul>
<p>Function: There will be drawn a circle of the defined colour. On klicking on the button, there is send a GET-Telegram to the defined IP/port.</p>
<p>If you want, you can test it and give me a feedback..</p>
<p>What is still making me angry, is that there is much more information sent, as using the curl from the event-module. (Look two posts above)<br />
I studied the code of the event-test, but I do not see where is the difference.<br />
Can somebody help here?<br />
----------------------------------------------------------------------------------------------------------------------------<br />
telegram caused by my $.ajax:<br />
<strong>&nbsp;&nbsp;&nbsp;&nbsp; $.ajax({type:&#39;GET&#39;, url:&#39;http://&#39;+$(this).attr(&quot;IP&quot;)+&#39;:&#39;+$(this).attr(&quot;port&quot;), data: $(this).attr(&quot;payload&quot;), timeout: 500 });&nbsp;&nbsp;&nbsp; </strong><br />
-------&gt;<br />
<strong>&gt; New Client: 192.168.1.80<br />
GET /?Heizung_EIN HTTP/1.1<br />
Host: 192.168.1.80:8080<br />
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0<br />
Accept: */*<br />
Accept-Language: de,en-US;q=0.7,en;q=0.3<br />
Accept-Encoding: gzip, deflate<br />
Referer: <a href="http://192.168.1.80/emoncms/dashboard/view?id=2" title="http://192.168.1.80/emoncms/dashboard/view?id=2">http://192.168.1.80/emoncms/dashboard/view?id=2</a><br />
Origin: <a href="http://192.168.1.80/" title="http://192.168.1.80">http://192.168.1.80</a><br />
Connection: keep-alive</strong></p>
<p><strong>&gt; Client closed conection.</strong><br />
----------------------------------------------------------------------------------------------------------------------------<br />
telegram made by the testbutton of the curl eventmodule:</p>
<p><strong>&gt; New Client: 192.168.1.80<br />
GET /?Heizung_EIN HTTP/1.1<br />
Host: 192.168.1.80:8080<br />
Accept: */*</strong></p>
<p><strong>&gt; Client closed conection.</strong><br />
----------------------------------------------------------------------------------------------------------------------------</p>
<p>I have figured out, that this function is initiated by the test-button (part of event_list.php):<br />
<strong>&nbsp; $(&quot;.testevent&quot;).click(function() {<br />
&nbsp;&nbsp;&nbsp; var eventid = $(this).attr(&quot;eventid&quot;);<br />
&nbsp;&nbsp;&nbsp; var feedid = $(this).attr(&quot;feedid&quot;);<br />
&nbsp;&nbsp;&nbsp; $.ajax({type:&#39;GET&#39;,url:path+&#39;event/test.json&#39;,data:&#39;id=&#39;+eventid+&#39;&amp;feedid=&#39;+feedid,dataType:&#39;json&#39;,success:function(){location.reload();}});<br />
&nbsp;&nbsp;&nbsp; return false;<br />
&nbsp; });</strong></p>
<p>But I do not see something in here, that could be responsible for the difference (I tried the option &quot;dataType&quot; and &quot;success&quot;-&gt; negative)</p>
<p><u>What do I have to change in my $.ajax-line to get the same?</u></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26496"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 06/01/2015 - 15:15.</div>
    <div class="content">
     <p>Good to see you are getting&nbsp;closer to a solution, I&#39;m afraid I can&#39;t help you much&nbsp;with ajax&nbsp;or curl.</p>
<p>I suspect you have already examined the <a href="https://github.com/emoncms/event/blob/master/event_model.php#L322-L341">events module &quot;curl code&quot;</a>&nbsp;Is it the header option and shorter timeout?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26499"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Tue, 06/01/2015 - 16:23.</div>
    <div class="content">
     <p>I thought it is the code in the event_list.php. Because i insertet an alert() into the&nbsp; &quot;$(&quot;.testevent&quot;).click(function()&quot; (line 254 in event_list.php) , and saw it popping up on klicking the test-button.</p>
<p>Maybe its the header option, but i do not know how to change this php-code into js-code....</p>
<p>Its definitely not the timeout, because the value in php is in seconds and my value is in ms. -&gt; Its the same</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26551"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Thu, 08/01/2015 - 08:11.</div>
    <div class="content">
     <p>Hi pb66,</p>
<p>no wasting more time to the difference in the curl-telegrams. I am only parsing them for my string. And this is working with both.</p>
<p>Now I finished my work so far. I can bidirect communicate with my arduino. Sending data via input-api and receive data (webserver on the arduino) via GET-telegrams from the curl-widget.</p>
<p>I have made some changes on my curl-widget. Its no more a round button, but a rect-button with different colours. In the appendix you can see how to setup the widget.<br />
As I described, I get back from my arduino the infos whats the rest time the heater will stay on, and the state of the heater (LED)<br />
I added another picture that shows the complete dashboard. Here you can see my modified cylinder-widget with 6 temperatures.</p>
<p>Hope you will get a solution for your problems soon ;-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26556"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 08/01/2015 - 11:56.</div>
    <div class="content">
     <p>The dashboard looks very clear and functional, glad you got it working. I have enough functionality for what I need right now.</p>
<p>It would definitely be better if it was clear if&nbsp;the dashboards were fully logged in or not, but this is an existing dash&nbsp;characteristic. It has since dawned on me that any dash will remain active after a login has timed out. Normally with a display-only page there are no &quot;clickable&quot; widgets so you only notice the session has timed out when you try to navigate to anther emoncms&nbsp;page by the topmenu bar, nothing has changed but adding the toggle_buttons has highlighted the the need for an additional &quot;if not-logged in go to login&nbsp;page&quot; in the on-click perhaps. I will return to this another time probably.</p>
<p>The problems with the events module will save for another day too. I don&#39;t actually need it right now, I just wanted to see if I could get it to respond to a button for more options. But as I can&#39;t get it to function on non-button feeds either it isn&#39;t likely to be related so can wait.</p>
<p>It would be interesting to see your final changes, although I don&#39;t have a specific use right now I think your &quot;curl-button&quot; widget could be&nbsp;useful for other things since it&#39;s easily configured for different payloads and ports.</p>
<p>For example when a&nbsp;&quot;socket to rfm network&quot; interfacer gets implemented in emonhub, a &quot;curl-button&quot; could be configured to send a pre-prepared RFM packet to emonhub to be broadcasted out to nodes on the RFM network.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26559"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Thu, 08/01/2015 - 12:08.</div>
    <div class="content">
     <p>OK,</p>
<p>here it is. Feel free to copy or modify it. If you see something mismatch pls tell me.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26562"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 08/01/2015 - 13:15.</div>
    <div class="content">
     <p>Thanks, So are all the changes contained in one widget file and picked up by the existing &quot;dash&quot; code? or did you&nbsp;make any other changes?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26563"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6717.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="brutzler&#039;s picture" title="brutzler&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: controlling a device with button-widget possible? --> packet-generator?</h3>

    <div class="submitted">Submitted by <a href="../user/6717.html" title="View user profile.">brutzler</a> on Thu, 08/01/2015 - 13:21.</div>
    <div class="content">
     <p>You only need the widget-file. Copy it into the widget-folder, and you can use it at once with the existing dashboard.&nbsp; I changed all instances to &quot;curl&quot;, so there should be no interference to the other widgets.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6394"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-rXplaKaA-18xQ0i-O3icUn48zacxepxmvfe1_g7cDag" value="form-rXplaKaA-18xQ0i-O3icUn48zacxepxmvfe1_g7cDag"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
