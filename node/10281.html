<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10281 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:04:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>8 sensors per board | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">8 sensors per board</h3>
        <span class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Sat, 07/03/2015 - 22:51</span>
        <div class="content"><p>Hello all,</p>
<p>I&#39;m in the process of looking into wiring up all my lines to OpenEnergyMonitor. I noticed that the board on Git has 4 inputs (+the voltage input), as I have 30 lines I&#39;m looking into hooking up more sensors per atmega. The Atmega328P has 8 ADC&#39;s, wouldn&#39;t it be possible to hookup 8 sensors?</p>
<p>Thanks!</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10399.html" class="topic-previous" title="Go to previous forum topic">‹ DC-DC stepUp</a>
              <a href="2582.html" class="topic-next" title="Go to next forum topic">AC-AC Adapter for Brazil (127V) ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-28457"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 07/03/2015 - 23:50.</div>
    <div class="content">
     <p>It would. Are you looking to manufacture your own PCB?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28458"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7800.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yesman85&#039;s picture" title="yesman85&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Sun, 08/03/2015 - 01:20.</div>
    <div class="content">
     <p>Yeah, probably I&#39;ll use the one from here as a reference and post the results. I&#39;m doubting how I should handle the transfer of data, it will be all wired so maybe I2C or SPI directly to a Rpi.</p>
<p>If I can connect 8 per atmega I&#39;ll have a max of 32 sensors, I counted again and saw I have 27 lines now, but I&#39;ll add 2-3 soon for the basement.. Then 30 sensors + 1 voltage reference would be perfect.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28459"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sun, 08/03/2015 - 01:20.</div>
    <div class="content">
     <p><em>The Atmega328P has 8 ADC&#39;s</em></p>
<p>If only that were true! &nbsp;Alas, it has an 8-pin wide MUX on front of its single ADC. &nbsp;So while it&#39;s true you can sample 8 different signals, you can only do so at 1/8th of the sample rate at which you could sample a single signal. &nbsp;Whether or not that matters depends on the signals you&#39;re sampling, and how accurate you want to be.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28460"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7800.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yesman85&#039;s picture" title="yesman85&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Sun, 08/03/2015 - 01:30.</div>
    <div class="content">
     <p>Well, it has to be fast enough for OpenEnergyMonitor :P I studied the source yet, so I&#39;m not sure what the minimum sample rate should be (for 60Hz lines).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28464"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 08/03/2015 - 12:54.</div>
    <div class="content">
     <p>Your minimum sample rate will be dictated by Nyquist and the highest harmonic that you consider significant, e.g. if you consider the 5th harmonic to be the limit beyond which the energy contribution is not significant, then you need a minimum of 10 samples per cycle. You <i>might just</i> be able to measure one voltage and 7 currents per cycle at that rate. </p>
<p>That is on the basis that the default sketch as pre-loaded in the emonTx V3 records a little over 50 sample pairs (voltage &amp; current) per cycle, which will equate to around 42 at your faster mains frequency. That includes the conversion time and the per-sample processing, it does not include the final maths to calculate the averages nor sending the data. The PLL sketches go somewhat faster.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28467"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7800.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yesman85&#039;s picture" title="yesman85&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Sun, 08/03/2015 - 16:41.</div>
    <div class="content">
     <p>I see, might be a challenge. I&#39;ll be easier off just buying a few more 328&#39;s to create the default setup.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28479"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 09/03/2015 - 04:33.</div>
    <div class="content">
     <p>And you usually want to sample a whole lot faster than that to leave head&nbsp;room for the anti-aliasing filter. &nbsp;All ADCs require that you filter out anything higher than half your sampling frequency in order to avoid aliasing. &nbsp;Even if you can legislate away higher frequencies in the primary current signal, by the time the signal arrives at your ADC it&#39;s likely to have picked up some high frequency noise, that will cause aliasing if left unchecked.</p>
<p>If you want to use a simple first order filter, then half your sampling rate needs to be way higher than your highest frequency of interest, otherwise the filter will also be attenuating the stuff you do want to measure. &nbsp;The only way you can get away with sampling at just twice the rate of the highest frequency of interest is to come up with a brick-wall filter, that filters everything just above your frequency of interest and nothing at or below it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28500"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Mon, 09/03/2015 - 13:02.</div>
    <div class="content">
     <pre>
&gt; You might just be able to measure one voltage and 7 currents per cycle at that rate.</pre><p>Am I missing something, or (unless you&nbsp;need&nbsp;to measure all currents simultaneously for some reason) couldn&#39;t you just sample a subset of the current inputs at one time, and then do another subset next time around?</p>
<p>Also - yesman - if you&#39;re looking at possibly producing your own board, then did you consider the&nbsp;ATmega32U4? &nbsp;12 Analogue inputs, and a better ADC too (plus simpler analogue&nbsp;circuitry as per&nbsp;http://openenergymonitor.org/emon/node/2542 ) ?</p>
<p>Cheers,</p>
<p>Tim.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28505"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6891.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="octagon&#039;s picture" title="octagon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/6891.html" title="View user profile.">octagon</a> on Mon, 09/03/2015 - 15:34.</div>
    <div class="content">
     <p>yesman85</p>
<p>does this site help you?</p>
<p><a href="http://boredomprojects.net/index.php/projects/home-energy-monitor" title="http://boredomprojects.net/index.php/projects/home-energy-monitor">http://boredomprojects.net/index.php/projects/home-energy-monitor</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28508"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7800.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yesman85&#039;s picture" title="yesman85&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Mon, 09/03/2015 - 16:26.</div>
    <div class="content">
     <p>I did see that one yeah, I was thinking about using a mega, but cost wise hooking up 30 lines I would be better off with a few cheaper atmega&#39;s instead of ARM&#39;s.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28512"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 09/03/2015 - 16:59.</div>
    <div class="content">
     <p>Tim:</p>
<p><i>"Am I missing something,..."</i> No, but I thought that was too obvious to need to be mentioned, but maybe not.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28519"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7800.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yesman85&#039;s picture" title="yesman85&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Mon, 09/03/2015 - 18:13.</div>
    <div class="content">
     <blockquote><p>Also - yesman - if you&#39;re looking at possibly producing your own board, then did you consider the&nbsp;ATmega32U4? &nbsp;12 Analogue inputs, and a better ADC too (plus simpler analogue&nbsp;circuitry as per&nbsp;http://openenergymonitor.org/emon/node/2542 ) ?</p>
</blockquote>
<p>I haven&#39;t gone very deep in it yet, was contemplating of using a 16bit ADC but they are pricy and almost non existent on easy to prototype chips.</p>
<p>I&#39;m not very much into the analog circuits but why would the 32U4 have a better ADC than a simple 328?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28525"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Mon, 09/03/2015 - 20:51.</div>
    <div class="content">
     <p>&gt;&nbsp;why would the 32U4 have a better ADC than a simple 328</p>
<p>Err, because Atmel decided they wanted it to?</p>
<p><a href="2542.html">http://openenergymonitor.org/emon/node/2542</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28526"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 09/03/2015 - 21:39.</div>
    <div class="content">
     <p><em>I&#39;m not very much into the analog circuits but why would the 32U4 have a better ADC than a simple 328?</em></p>
<p>The actual ADC is identical in all the AVR based devices... 10 bits, same clocking options/constraints, so it&#39;s a bit misleading to say it&#39;s a better ADC. &nbsp;Where they do differ is in all the stuff they stick around them. &nbsp;The only differences I know of&nbsp;are:</p>
<ul>
<li>width of the input MUX (so number of pins)</li>
<li>bandgap voltage options for AREF&nbsp;(1.1V, 2.56V)</li>
<li>differential op-amp with programmable gain</li>
</ul>
<p>Then you just need to check the &quot;features&quot; list on the front page of datasheet to see which of those options any particular device has.</p>
<p>If you really want a better ADC, then move to the SAM (ARM rather than AVR CPU architecture)&nbsp;based devices. &nbsp; They&#39;re 12-bit resolution&nbsp;and 2 orders of magnitude faster... roughly 1usec conversions Vs 100usec conversion. &nbsp;Plus most of them have two ADCs,&nbsp;each with their own input MUX, so you can genuinely have two conversions taking place at once. &nbsp;If you&#39;re building your own board, I think the SAM based devices are actually cheaper than the AVR devices these days.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28528"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Mon, 09/03/2015 - 21:46.</div>
    <div class="content">
     <p>&gt;&nbsp;it&#39;s a bit misleading to say it&#39;s a better ADC</p>
<p>Yep, fair enough, strike my last comment then (which is being held for moderation cos it has a link in it).</p>
<p>So hopefully it would be correct to say that vs the 328, the&nbsp;32U4&nbsp;offers more inputs, and more helpful onboard analogue circuitry which should result in better performance (e.g. sensitivity) whilst retaining a simple PCB layout, and also losing one of the calibration steps.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28529"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 09/03/2015 - 23:52.</div>
    <div class="content">
     <p><em>&nbsp;the 32U4 offers more inputs</em></p>
<p>Yep.</p>
<p><em>more helpful onboard analogue circuitry which should result in better performance (e.g. sensitivity)</em></p>
<p>Are you referring to the programmable gain op-amp, or the extra bandgap voltage (2.56V). &nbsp;Presumably anything you can do with the 2.56V you can do with the 1.1V. &nbsp; When you&#39;re using either of those, if you hang anything other than a cap off AREF, you&#39;ll get lousy results. &nbsp; The programmable gain op-amp opens up a world of auto-ranging&nbsp;possibilities, as well as a mine field of calibration issues.</p>
<p><em>losing one of the calibration steps</em></p>
<p>Not sure what you&#39;re referring to there? &nbsp;Which step?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28530"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7800.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yesman85&#039;s picture" title="yesman85&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Mon, 09/03/2015 - 22:06.</div>
    <div class="content">
     <p>But increasing the amount of inputs would only result in a slower reading per channel right, the 32U4 is still only 16Mhz so processing would be at the same rate.<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28531"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 09/03/2015 - 22:44.</div>
    <div class="content">
     <p>You need to compare the clock Vs Vcc graph&nbsp;in the datasheets, but a quick look suggests:</p>
<p><span style="line-height: 1.6;">At 5V, the&nbsp;</span>32U4<span style="line-height: 1.6;"> can run at </span>16MHz<span style="line-height: 1.6;"> while the 328 can run at </span>20MHz<span style="line-height: 1.6;">.</span></p>
<p><span style="line-height: 1.6;">At 3.3V the 32U4 can run at 10.66MHz and the 328 can run at 13.33MHz</span></p>
<p><span style="line-height: 1.6;">so the 32U4 is actually slower. &nbsp; All that is CPU speed, not ADC speed. &nbsp;</span></p>
<p><span style="line-height: 1.6;">The ADC likes a clock anywhere between 50KHz and 200KHz, and you can even exceed that if you&#39;re feeling adventurous. &nbsp;There&#39;s a divider that lets you divide the system clock by a power of 2 to generate the ADC clock. So a typical 16MHz Arduino uses a divider of 128, which gives the ADC a 125K clock. &nbsp; Because I run my ATMega2560&nbsp;at 3.3V, I can only clock it at 8MHz, so I use an ADC divider of 64. &nbsp;So my CPU instructions run at half the speed of a 16MHz&nbsp;Arduino, but my ADC conversions run at the same rate. &nbsp; With the most common config, an ADC conversion takes 13 clocks, which at 125K is 104usecs.</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28534"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7800.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yesman85&#039;s picture" title="yesman85&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Mon, 09/03/2015 - 23:21.</div>
    <div class="content">
     <p>So actually the 32U4 won&#39;t be a good choice because there won&#39;t be enough time for emon to process all inputs in a fashionable time right?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28535"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 09/03/2015 - 23:46.</div>
    <div class="content">
     <p>You can trade off sampling rate with accuracy. &nbsp;As TimSmall said above &quot;<em>couldn&#39;t you just sample a subset of the current inputs at one time, and then do another subset next time around</em>&quot;. &nbsp;With that approach there&#39;s pretty much no upper limit to how many circuits you can monitor, but the more of that you do, the less accurate each will be.</p>
<p>&quot;Good, fast, cheap... pick any two&quot; &nbsp;as they say.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28537"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Tue, 10/03/2015 - 08:53.</div>
    <div class="content">
     <p>&gt;&nbsp;You can trade off sampling rate with accuracy. [...]&nbsp;there&#39;s pretty<br />
&gt; much no upper limit to how many circuits you can monitor, but<br />
&gt; the more of that you do, the less accurate each will be</p>
<p>Sorry, I&#39;m having some trouble getting my head around this -&nbsp;&nbsp;could you expand on that a bit? &nbsp;Currently the OEM Atmel code&nbsp;seems to do this in a loop:</p>
<p>1. Sample inputs</p>
<p>2. Calc and output</p>
<p>3. Go to sleep</p>
<p>Where the duration of step 3. is circa 10 times the duration of step 1. and step 2.</p>
<p>If you changed that to:</p>
<p>1. Sample current transformers&nbsp;group A</p>
<p>2. Calc and output&nbsp;current transformers&nbsp;group A</p>
<p>3.&nbsp;Sample current transformers&nbsp;group B</p>
<p>4.&nbsp;Calc&nbsp;and output&nbsp;current transformers&nbsp;group B</p>
<p>5. Go to sleep</p>
<p>... then why would you lose accuracy by doing the measurements sequentially?</p>
<p>I can see that if you&#39;re doing something like 3 phase power, you want to sample all 3 phases at the same time, but other than that?</p>
<p>Cheers,</p>
<p>Tim.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28538"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 10/03/2015 - 09:21.</div>
    <div class="content">
     <p>Yes, fair point, I guess I was talking more generally.&nbsp; Unless you&#39;re trying to conserve batteries, I&#39;m of the belief that you should always be sampling continuously, and in that case&nbsp;the more inputs you&#39;re trying to sample, the less frequently you&#39;ll be sampling them.&nbsp;&nbsp;</p>
<p>If you&#39;re already sleeping rather than sampling, then you&#39;ve got nothing to lose (except maybe battery power?).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28541"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 10/03/2015 - 09:51.</div>
    <div class="content">
     <blockquote><p>... then why would you lose accuracy by doing the measurements sequentially?</p>
</blockquote>
<p>This has already been discussed a few times. If you consider loads with a high enough switching frequency (oven plates, flatting irons, ON/OFF or PWM regulated heaters in general) your measuring results can get awfully wrong. &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28567"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Tue, 10/03/2015 - 23:36.</div>
    <div class="content">
     <p>Can multiple&nbsp;<a href="https://learn.adafruit.com/adafruit-4-channel-adc-breakouts/overview">ADS1015</a>&#39;s&nbsp;be added via i2c so that more sampling could be done? &nbsp;The 1015 has a pretty high sample rate.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28569"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7800.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yesman85&#039;s picture" title="yesman85&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7800.html" title="View user profile.">yesman85</a> on Wed, 11/03/2015 - 01:02.</div>
    <div class="content">
     <p>The 1015 is quite expensive and only has 4 inputs, I&#39;m experimenting now with an external MCP3208, 12 bits and 100k samples.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28573"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Wed, 11/03/2015 - 09:06.</div>
    <div class="content">
     <blockquote><p>I&#39;m experimenting now with an external MCP3208 ..........</p>
</blockquote>
<p>I have ben using that as a piggy-back on an EmonTx since more than a year. Works very nicely, sampling time is ~8us per channel. But you will still have the problem of lacking processing power with more than ~10 inputs at a reasonable sampling rate.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28576"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Wed, 11/03/2015 - 09:18.</div>
    <div class="content">
     <p>I can see that instantaneous readings will be inaccurate, if the power&nbsp;isn&#39;t continuous sampled.</p>
<p>Over a 24 hour period has anyone done any experiments to see what the&nbsp;accuracy loss is&nbsp;(e.g. for a house)&nbsp;if sampling every 10 seconds vs continuously?</p>
<p>If I had to hazard a&nbsp;guess, I&#39;d have thought&nbsp;it&#39;s not likely to be out by more than a couple of % for my house.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28597"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 12/03/2015 - 00:11.</div>
    <div class="content">
     <p>Does it take much of the CPU load off if you measure current only? &nbsp;</p>
<p>(Thinking to myself about sampling RMS voltage once a min, or maybe only once an hour? Enough systems use a fixed 240/120 that it can&#39;t be that bad.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28599"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 12/03/2015 - 01:09.</div>
    <div class="content">
     <p>If you use rms voltage, you'll only have apparent power (VA), not real power (which is what you get charged for), and you will have errors if the system voltage fluctuates. Long-term, the errors will even out and can be taken care of with careful calibration against your supplier's meter. In the short term, they might get significant depending of course on your loads and the supply.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29097"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7916.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="piperpilot&#039;s picture" title="piperpilot&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 8 sensors per board</h3>

    <div class="submitted">Submitted by <a href="../user/7916.html" title="View user profile.">piperpilot</a> on Sat, 28/03/2015 - 03:37.</div>
    <div class="content">
     <p>Yesman, I am interested in this same project. &nbsp;I have a standard US&nbsp;200A&nbsp;service and would like to monitor all of my branch circuits to figure out where my power usage is coming from. &nbsp;I have done a lot of research and the&nbsp;MCP3208&nbsp;seems like a great option. &nbsp;If you have anything to share, it would be great!</p>
<p>I have found this board:</p>
<p><a href="https://shop.smartenergygroups.com/store/show/segmeter_v25" title="https://shop.smartenergygroups.com/store/show/segmeter_v25">https://shop.smartenergygroups.com/store/show/segmeter_v25</a></p>
<p>It seems like a well thought out design, but does not take voltage into consideration...it uses a fixed constant for voltage. &nbsp;I&#39;m considering using that design and using one of the 8 channels for voltage readings...that would give 7 CTs and 1 voltage per board...I&#39;ll probably need 3 or 4 of them to measure all of my circuits, but I&#39;m OK with that.</p>
<p>Anyways...interested to hear of any progress you have made.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10281"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-zL9J0MSX6jk3TkZTF3nZ0oJAg9_4Mah2W1es27MA4nA" value="form-zL9J0MSX6jk3TkZTF3nZ0oJAg9_4Mah2W1es27MA4nA"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
