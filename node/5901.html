<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5901 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:11:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Questions about the radio link between EmonTH and RFM12Pi. | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Questions about the radio link between EmonTH and RFM12Pi.</h3>
        <span class="submitted">Submitted by <a href="../user/7021.html" title="View user profile.">gluino</a> on Wed, 08/10/2014 - 02:24</span>
        <div class="content"><p>I suppose that if there are many sensor nodes, there is a significant chance of collisions. &nbsp;Are these detected and will the emonTH retry the transmission?</p>
<p>Suppose you want to cover a 6-storey building with emonTH, say 2 sensor nodes per storey, so a total of 12 sensor nodes. And suppose that we find that 2 base stations are required to receive transmissions from all the 12 sensors. The layout might be like this:</p>
<pre>
L6 - 2 x emonTH: n27 &amp; n28

L5 - 2 x emonTH: n25 &amp; n26 , and a RPi with baseid=16

L4 - 2 x emonTH: n23 &amp; n24

L3 - 2 x emonTH: n21 &amp; n22

L2 - 2 x emonTH: n19 &amp; n20 , and a RPi with baseid=15

L1 - 2 x emonTH: n17 &amp; n18</pre><p>Does this look OK?</p>
<p>Can both RPi send readings to the same emoncms.org account?</p>
<p>What happens if both RPi&#39;s&nbsp;&quot;hear&quot; the same transmission from n21 for example? I suppose both basestations&nbsp;might send the same data to emoncms.org there should be no bad effects right?</p>
<p>Or should I split them into 2 different network groups? Say group 210 for the lower 3 floors, and 211 for the upper 3 floors?</p>
<p>Also, do I understand correctly that there is no feature for privacy and excluding unwanted neighbors&#39; transmissions? &nbsp;We simply have to choose different group id&#39;s if we ever encounter unwanted readings from neighbors?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5851.html" class="topic-previous" title="Go to previous forum topic">‹ Meter Readings</a>
              <a href="5900.html" class="topic-next" title="Go to next forum topic">EmonTH - trying to set less frequent reads and radio transmissions. need help. ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-24370"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about the radio link between EmonTH and RFM12Pi.</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 08/10/2014 - 09:25.</div>
    <div class="content">
     <p>You can send from multiple base stations to one emoncms.org account no problem, the default max number of nodes is 32, which can only be overridden if you have your own emoncms&nbsp;server.</p>
<p>The 2 Pi approach should work ok to get the network spread you need although that will depend a lot on positioning and obstacles (walls and floors).</p>
<p>Depending on where you are in the world you may be able to consider 2 different frequencies for the 2 networks to avoid cross network collisions altogether,</p>
<p>It is difficult to know whether 2 distinct networks or 1 network with 2 base stations would give better coverage. 2 networks on the same frequency could reduce workload for each receiver but wouldn&#39;t reduce collisions, where as the single network may give better coverage to the overlapping area since the same packet can be received by either Pi.</p>
<p>To avoid collisions the best practice would be to use the time transmission facility used for setting the glcd&#39;s time to trigger the very first transmission from each node and also include a small delay to stagger the transmissions across the repeated interval. Doing this could be more complex with just one network as 2 time signals will be confusing and one time signal is unlikely to reach all nodes.</p>
<p>If legislation allows, the 2 frequency approach is probably easiest to implement with minimal fuss, but personally I would probably opt for a single frequency for flexibility, add the&nbsp;synchronization&nbsp;&nbsp;code and then experiment with 1 verses 2 groups and positioning.</p>
<p>The network transmissions are very simple, the 200+ group ids and fairly short range is usually adequate to get an exclusive network.&nbsp;</p>
<p>The transmissions from the nodes are not acknowledged or retransmitted so synchronizing the transmissions is highly recommended if there is a lot&nbsp;of traffic.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24401"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7021.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gluino&#039;s picture" title="gluino&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about the radio link between EmonTH and RFM12Pi.</h3>

    <div class="submitted">Submitted by <a href="../user/7021.html" title="View user profile.">gluino</a> on Thu, 09/10/2014 - 03:50.</div>
    <div class="content">
     <p>May I know approx how many microseconds or milliseconds does the transmission of an emonTH&nbsp;last? If it is short enough, I probably can live with the tiny percentage of collisions.</p>
<p>What is the &quot;time transmission facility&quot; that you mention? Which box can transmit time?</p>
<p>Speaking of time, I do not remember setting up the real time clocks or NTP in the emonTH&#39;s or the RaspberryPi&#39;s, am I right that they data times I see on emoncms.org must be stamped by emoncms.org? &nbsp;The emonTH&#39;s transmissions do not include time stamp, and the basestations also don&#39;t include timestamps when inputting to emoncms.org right?</p>
<p>Thank you pb66 for the info.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24420"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about the radio link between EmonTH and RFM12Pi.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 09/10/2014 - 12:38.</div>
    <div class="content">
     <p><em>&quot;May I know approx how many microseconds or milliseconds does the transmission of an emonTH last&quot;</em></p>
<p>I think knowledge of the size of the payload and this page gives you that: <a href="http://jeelabs.org/2011/06/09/rf12-packet-format-and-design/" title="http://jeelabs.org/2011/06/09/rf12-packet-format-and-design/">http://jeelabs.org/2011/06/09/rf12-packet-format-and-design/</a></p>
<p>Time is normally broadcast by the Base node following interrogation of the server, which can be the RPi, emoncms.org or another server running emonCMS.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24424"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about the radio link between EmonTH and RFM12Pi.</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 09/10/2014 - 13:34.</div>
    <div class="content">
     <blockquote><p><em>What is the &quot;time transmission facility&quot; that you mention? Which box can transmit time?</em></p>
</blockquote>
<p>I was referring to the time packet transmitted&nbsp;via the rfm2pi by emonHub, it is intended to keep the emonGLCD&#39;s time updated but could easily be used as a trigger for synchronizing&nbsp;the transmissions from the nodes.</p>
<p>The nodes are not time aware as they do not have an rtc or an internet connection for ntp&nbsp;so emonHub allocates a timestamp upon receipt of each packet. The Pi uses NTP by default if running Raspbian.</p>
<p>As Robert points out the duration&nbsp;of the payload will dependent on the size, the thing to bear in mind is although the collisions maybe reduced if the payloads are shorter, as the intervals are intended to be regular any collisions could be repeated in a cycle and/or if not controlled&nbsp;the pattern could shift slightly resulting in more (or less) lost packets.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24431"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7021.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gluino&#039;s picture" title="gluino&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about the radio link between EmonTH and RFM12Pi.</h3>

    <div class="submitted">Submitted by <a href="../user/7021.html" title="View user profile.">gluino</a> on Wed, 22/10/2014 - 08:03.</div>
    <div class="content">
     <p>Thanks, according to the jeelabs&nbsp;packet description page, he said the no-payload minimal packet is 9 bytes = 72 bits ~ 1.5ms at 50 kbits&nbsp;/ s.</p>
<p>I believe the payload of the emonTH is 4 ints = 8 bytes = 64 bits. So the packet is 64 + 72 = 136. So that takes about 2.72 ms to send. &nbsp;</p>
<p>I understand what pd66 means about the regular intervals though. Would be nice to add a random fudge of say 1% of the interval, to prevent long runs of bad packets.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24443"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about the radio link between EmonTH and RFM12Pi.</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 09/10/2014 - 22:16.</div>
    <div class="content">
     <p>When we were having big problems with collisions and the emonGLCD, which turned out to be a problem in the library, one suggestion was that the conflicting transmitting nodes should transmit at intervals that were all prime multiples of the time unit, so that the possibility of a slowly creeping overlap (which I imagine your 1% dither is intended to alleviate) would be largely avoided. That and Paul&#39;s are two completely opposite approaches to the same problem, Paul is suggesting synchronising and the other relies on probability.&nbsp;</p>
<p>Bu there&#39;s a problem with Paul&#39;s suggestion: if the emonTH (or any node) is battery powered, it can&#39;t continuously listen for a time transmission in order to synchronise, on account of battery life. The best it can do, which will still be expensive in terms of power consumption, would be to turn on the receiver just before it expects a time packet; and when it sees it, send its packet immediately, or sleep until its slot comes round or whatever; and then sleep. If it doesn&#39;t hear it after a suitable interval, it must give up and wait for the next - and there obviously needs to be a strategy there to allow it to synchronise after a reasonable period if the transmissions are there. If the node is mains powered, listening continuously isn&#39;t a problem, so if there&#39;s only one battery-powered sensor node in the system, it makes sense for that to be the master clock and it will then never need to listen - the rest of the system will synchronise to that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24455"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about the radio link between EmonTH and RFM12Pi.</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 10/10/2014 - 10:11.</div>
    <div class="content">
     <p>oops! yeah sorry I overlooked the fact they were all battery powered emonTH&#39;s, I had a similar discussion some time ago about 30 emonTx&#39;s and just continued that thought process.</p>
<p>I think I would still favor&nbsp;synchronization over chance, but agree it&#39;s not such an easy task when considering sleep functions and power consumption.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5901"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Qbft4d21sO6L4HnUQsTVO-8552r_9GCZhej1xLC_7i8" value="form-Qbft4d21sO6L4HnUQsTVO-8552r_9GCZhej1xLC_7i8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/5901 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:11:07 GMT -->
</html>
