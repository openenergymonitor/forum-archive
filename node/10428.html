<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10428 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:14:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonCore - All in one project based on the Particle (fomerly Spark) Core  | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>
        <span class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 02/04/2015 - 18:17</span>
        <div class="content"><p>Well I got a couple&nbsp;CT&#39;s last night so I was finally able to get something running. Only have sct-013&#39;s so I can not monitor main panel current yet. &nbsp;For&nbsp;now it is setup on my heatpump.&nbsp; I have protoboards, headers, and headphone jacks on the way so&nbsp;soon I can put together a cleaner setup and be able to return my daughters Lego&nbsp;bin lid. &nbsp; System is North&nbsp;American&nbsp;120/60hz. &nbsp;Goal is an as small as possible&nbsp;single collector/transmitter&nbsp;connected to web.</p>
<!--
Large in-line picture replaced by a link. Moderator (RW).

<p>​<img alt="" src="http://i.imgur.com/ruCW7rM.jpg" style="width: 240px; height: 320px;" /></p>
--><!--
Large in-line picture replaced by a link. Moderator (RW).

<p>​<img alt="" src="http://i.imgur.com/ruCW7rM.jpg" style="width: 240px; height: 320px;" /></p>
--><p><a href="../../../i.imgur.com/ruCW7rM.jpg">[picture]</a></p>
<p>Code is&nbsp;here: <a href="https://github.com/officeboy/EmonCore" title="https://github.com/officeboy/EmonCore">https://github.com/officeboy/EmonCore</a></p>
<p><iframe frameborder="0" marginheight="0" marginwidth="0" scrolling="no" src="http://emoncms.org/vis/realtime?feedid=74456&amp;embed=1" style="width:580px; height:400px;"></iframe></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11291.html" class="topic-previous" title="Go to previous forum topic">‹ pv immersion,  data logging, tank temperature and room temp needed. </a>
              <a href="3937.html" class="topic-next" title="Go to next forum topic">emonPi Development Ideas ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-29341"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Thu, 02/04/2015 - 19:53.</div>
    <div class="content">
     <p>Hey, nice work!</p>
<p>I&#39;m definitely interested in this. I especially&nbsp;like the super small size and built-in wifi. I know they&#39;re not available till next month, but have you thought about using the Photon?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29342"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 02/04/2015 - 20:02.</div>
    <div class="content">
     <p>The photon is what got me thinking about going this route, I already had some jeenodes, but one has a bad radio and I wasn&#39;t sure if the range was going to work out. The Photon for&nbsp;$19 and that small form&nbsp;factor is&nbsp;++good. &nbsp;</p>
<p>I&nbsp;ordered the Photon Prototype kit. &nbsp;Comes with a Core now, and a Photon when available.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29516"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 09/04/2015 - 18:31.</div>
    <div class="content">
     <p>Quick update;&nbsp;shipping on parts is slow, but I did get my little 1.3&quot;&nbsp;OLED&nbsp;screen. &nbsp;Turns out to be something there isn&#39;t really a library for, so I am modifying an arduino&nbsp;one to work on the spark, it gave some output last night, but was putting my unit into panic/reboot mode. &nbsp;</p>
<p>In the meantime I need to start putting together a schematic, &nbsp;I think I am going to go with (what I assume to be) Robert&nbsp;Walls, <a href="https://learn.openenergymonitor.org/?redirect=acac-buffered-voltage-bias">Buffered Voltage Bias</a> circuit. &nbsp;Hopeful it will scale up well. &nbsp;</p>
<p>I got <a href="http://emoncms.org/vis/auto?feedid=74456">good data</a> for a few days and it matched up very nicely with what I was seeing in power usage (I get daily usage reports from my power company). &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29526"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 09/04/2015 - 20:31.</div>
    <div class="content">
     <p>Nope, it was originally Robin's. What do you mean by "scale up"? - as the input current is barely more than that needed to charge the Sample &amp; Hold capacitor, you ought to be able to hang any (sensible) number of input devices off the op. amp. output.<br />
If you have a lot of inputs, note that when using that, you need only one software low pass filter to extract the dc, because that dc 'sit' is common to all the inputs. It speeds up the input processing but you'll need to customise emonLib to get any benefit.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29528"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 09/04/2015 - 21:15.</div>
    <div class="content">
     <p>Scale up means I expect to have 16 inputs,and I hope to avoid having 16 voltage dividers with the use of a single&nbsp;<a href="http://tangentsoft.net/elec/vgrounds.html">buffered virtual ground</a>. &nbsp; I have 8 inputs on my arm chip and will add 8 more with a stackable &quot;shield&quot;&nbsp;using&nbsp;probably a&nbsp;<a href="http://www.mouser.com/ProductDetail/Maxim-Integrated/MAX11615EEE+/?qs=1THa7WoU59EX0VwRCtKB%252bg%3D%3D">MAX11615EEE</a>, but I haven&#39;t decided on that yet. &nbsp;I&#39;ll get all 8 inputs working first.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29530"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 09/04/2015 - 21:43.</div>
    <div class="content">
     <p>Whether you get any interaction will depend on the input characteristics of your ADC, but if the input impedance is high, and the capacitance (S&amp;H + stray) is low, then I don't see a problem with 16 inputs using the same buffer op. amp. The demands are not all that onerous: all that's needed for the Atmel 328 is for the output impedance with the feedback in place to be such that the input stays within one ADC step when the multiplexer switches. If you also have a multiplexer in front of a single ADC, it's an identical situation; if you have separate ADCs for each channel, then it's slightly different but the requirement is identical even though the perturbation comes from the combined effect of all the other channels 'pulling' the bias source, rather than just the one channel switching.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29604"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Tue, 14/04/2015 - 20:26.</div>
    <div class="content">
     <p>Anyone have comments on my first stab at making a PCB (that isn&#39;t a point to point proto).</p>
<p>&nbsp;</p>
<p><a href="https://github.com/officeboy/EmonCore/tree/master/hardware" title="https://github.com/officeboy/EmonCore/tree/master/hardware">https://github.com/officeboy/EmonCore/tree/master/hardware</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29605"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 14/04/2015 - 22:10.</div>
    <div class="content">
     <p>Don't leave the unused inputs of the spare op.amp floating. You might as well make it a unity gain follower and tie the + input to VGround. (Now there's a confusing name! Vmid(point) or Vbias? I realise it was called that in the link you referenced earlier, but that isn't its function here, here it is an offset bias, biasing the quiescent input to the midpoint of the ADC input range.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29698"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Fri, 17/04/2015 - 15:58.</div>
    <div class="content">
     <p>Thanks, Robert. &nbsp;I had planed on using a single channel opamp, but the software I started using didn&#39;t have one in it&#39;s library. &nbsp;I switched to eagle so that I could use the actual footprint of the 3.5mm jacks I have.</p>
<p>Anyway quick story. &nbsp;I used to do a lot of audio stuff back about&nbsp;10-12 years ago. &nbsp;I was semi active in the DIYaudio&nbsp;forum and made a few chipamps, an aleph-x etc. &nbsp;So opamps are no big deal... right? &nbsp;I have dip-8 sockets. &nbsp; Well I got my digikey order yesterday with my max11516&nbsp;16-tsop and the lvm321&nbsp;tc-70. &nbsp;Holy cow. &nbsp;What am I&nbsp;supposed to do with these things? &nbsp;I think I did a decent job considering, but I may need to get some breakout boards for prototyping. &nbsp;</p>
<p><img alt="" src="../../../i.imgur.com/CKTdwlb.jpg" style="width: 507px; height: 363px;" /></p>
<p>That 16 pin ADC is going to be impossible, without a proper pad.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29707"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 17/04/2015 - 18:14.</div>
    <div class="content">
     <p><i>"So opamps are no big deal... right?"</i><br />
I had no idea what your previous experience was, surely it's better to point out what might have been an oversight before you had pcb's made, rather than explaining what an unconnected oscillating op. amp was doing to its other half?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29709"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Fri, 17/04/2015 - 18:24.</div>
    <div class="content">
     <p>I only meant no big deal in terms of soldering to a proto board. &nbsp;Selection and implementation are a whole different issue. &nbsp;And I do/did appreciate the feedback, in audio work generally the extra amps&nbsp;would be used as an input preamp/follower, or differentials&nbsp;from crossover circuits or phase adjusters.&nbsp; I changed that fritzing&nbsp;schematic, but then scrapped the whole thing and went to eagle. &nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29896"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 23/04/2015 - 05:52.</div>
    <div class="content">
     <p>Had a chance to put some things together&nbsp;while I was sick today. &nbsp;</p>
<p><a href="http://imgur.com/a/7ZgRc" title="http://imgur.com/a/7ZgRc">http://imgur.com/a/7ZgRc</a></p>
<p><img alt="" src="../../../i.imgur.com/TUbevah.jpg" style="width: 384px; height: 512px;" />&nbsp;<br><img alt="" src="../../../i.imgur.com/Bpm6fs1.jpg" style="width: 384px; height: 512px;" />&nbsp;<br><img alt="" src="../../../i.imgur.com/sGYeXHu.jpg" style="width: 384px; height: 512px;" />&nbsp;&nbsp;(with flash)</p>
<p>Main leg CTs&nbsp;are working, but something isn&#39;t&nbsp;right with the two sub circuits. &nbsp;I&#39;ll need to review if it is a code issue or a wiring thing. &nbsp;They worked ok testing on a 60W light, but I should have spent more time on them.</p>
<p>I have 50 ohm burdens on the sct-013,and 32ohm on the sct-019&#39;s.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29925"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Sat, 25/04/2015 - 05:06.</div>
    <div class="content">
     <p>Turns out that the 3.5mm jacks are not making good contact with the stereo plugs that come on the sct-013's.  Does anyone know of a specific jack that works OK and is less than a buck a piece? </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29930"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sat, 25/04/2015 - 14:50.</div>
    <div class="content">
     <p>Dustin,</p>
<p>Here&#39;s a 3.5mm Nickel panel mount stereo jack for $0.43</p>
<p><a href="http://www.bgmicro.com/AUDCA017.aspx">www.bgmicro.com/AUDCA017.aspx</a></p>
<p>&nbsp;</p>
<p>Regards,</p>
<p>Bill</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29931"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8051.jpg" alt="Gzero&#039;s picture" title="Gzero&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8051.html" title="View user profile.">Gzero</a> on Sat, 25/04/2015 - 18:04.</div>
    <div class="content">
     <p>Sorry if this question is not adequate im new here trying to get into the project, but&nbsp;how are you using the graphing in real time? where did you get the code or how did you made it, &nbsp;to post it in the forum, are you using the emon&nbsp;cms? i would really love to have a graph like that in real time for my home&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29932"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Sat, 25/04/2015 - 18:48.</div>
    <div class="content">
     <p>It is just the vis part of emoncms.org. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29933"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8051.jpg" alt="Gzero&#039;s picture" title="Gzero&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8051.html" title="View user profile.">Gzero</a> on Sat, 25/04/2015 - 18:49.</div>
    <div class="content">
     <p>thanks i will check it out,</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30346"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 14/05/2015 - 13:19.</div>
    <div class="content">
     <p>Nice project! Photon looks like a cool board. How easy was it to develop for? Have you heard any more info on RFM12B / RFM69CW support on&nbsp;the Photon?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30354"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 14/05/2015 - 15:25.</div>
    <div class="content">
     <p>It has been pretty easy to build, and the IDE is pretty close to arduino so there isn&#39;t much of a learning curve. &nbsp;I have been pulled away to a few other projects, and haven&#39;t touched this in&nbsp;a bit. &nbsp;The only issue I have is dropping signal. &nbsp;The photon&#39;s external antenna will be a nice feature for cases like mine where the AP is 50+ feet away.&nbsp;</p>
<p>&nbsp;</p>
<p>I know there is a <a href="https://github.com/hallard/RFM69">RFM69 library</a>, but that is all I know about it. &nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30361"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Thu, 14/05/2015 - 18:12.</div>
    <div class="content">
     <p>I have a photon on order and will be attempting this when I get it. I had originally ordered it to build a garage door opener, but this seems like a better use of it.</p>
<p>The biggest attraction is the fact that you can remotely load sketches to it and its already connected to the internet.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30362"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 14/05/2015 - 18:30.</div>
    <div class="content">
     <p>If your power panel is in your garage I don&#39;t know why you can&#39;t do both. &nbsp;In&nbsp;fact&nbsp;I should do that.&nbsp;&nbsp;I am not really using any digital outputs, tie one to a relay and wire that in with the button. &nbsp;Nice idea! &nbsp;Could open by timer, ITTT, or webaddress&nbsp;(homepage link from phone).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30366"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Thu, 14/05/2015 - 20:11.</div>
    <div class="content">
     <p>I am already doing temperature, voltage and 3 CTs monitoring and solar diverting. Does the photon have enough of power to do more?</p>
<p>How does the ADC on the photon / core compare to the Arduino Uno?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30369"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 14/05/2015 - 21:12.</div>
    <div class="content">
     <p>The photon is a 120Mhz&nbsp;32-bit ARM cpu (the core is 72Mhz). &nbsp;I have no idea how that translates over to amount of work possible, but I am open to finding out, if anyone could help with that... &nbsp;I suppose I could see how many samples are possible in a second? &nbsp;Wish&nbsp;I could just run TOP, or open Taskmanager...</p>
<p>&nbsp;</p>
<p>On&nbsp;the ADC, the core and photon both have 12-bit ADC, with 8 inputs on the core and 9 on the photon. &nbsp;significantly better than the Uno. &nbsp;The measurement range is reduced from 5V to 3.3, but there is still 6x the resolution, and some extra inputs. &nbsp;</p>
<p>The datasheet for the micro used in the Spark Core (<a href="https://github.com/spark/core/blob/master/Datasheets/ST_STM32F103CB.pdf" title="https://github.com/spark/core/blob/master/Datasheets/ST_STM32F103CB.pdf">https://github.com/spark/core/blob/master/Datasheets/ST_STM32F103CB.pdf</a> (page 75) ) says the total conversion time of the A/D converter is min of 1&nbsp;&micro;s&nbsp;and max of 18&nbsp;&micro;s. &nbsp;And sample rate is from 0.05-1Mhz</p>
<p>&nbsp;</p>
<p>The one for the photon (<a href="https://github.com/spark/photon/blob/master/datasheets/STM32F205RGY6.pdf" title="https://github.com/spark/photon/blob/master/datasheets/STM32F205RGY6.pdf">https://github.com/spark/photon/blob/master/datasheets/STM32F205RGY6.pdf</a> &nbsp;(page 121)&nbsp;) says up to 6MSPS. &nbsp;(conversion time 0.5min to 16.4max&nbsp;&micro;s /sample rate is 0.6-30Mhz)</p>
<p>From what I can tell the uno is&nbsp;125khz, so faster but possibly&nbsp;slower?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30370"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 14/05/2015 - 21:33.</div>
    <div class="content">
     <p><em>From what I can tell the uno is 125khz, so faster but possibly slower?</em></p>
<p>That&#39;s a typical clock rate going into the ADC, but each conversion takes 13 clocks, so the actual conversion rate is 125/13 kHZ &nbsp;or 9.6 kHZ, or 104 usecs per conversion. &nbsp; So the ARM based chips do&nbsp;conversions way way faster. &nbsp;Many of them have 2 or 3 ADCs (Vs that AVR&#39;s single ADC), so simultaneous conversions are truly possible, subject to whether or not your board gives you access to the multiple ADCs.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31159"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Wed, 10/06/2015 - 14:09.</div>
    <div class="content">
     <p>Am still waiting for my photon to arrive.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31203"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Thu, 11/06/2015 - 15:37.</div>
    <div class="content">
     <p>Looks like they had a bad batch of power regulators, hopefully shipping near end of the month. &nbsp; &nbsp;I ordered a core and photon in march and still don&#39;t have a photon either. &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32109"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Fri, 10/07/2015 - 17:43.</div>
    <div class="content">
     <p>It&#39;s looking like end Aug before I receive the photon. That&#39;s when I get back into this project.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33864"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4851.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Petehec&#039;s picture" title="Petehec&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/4851.html" title="View user profile.">Petehec</a> on Sat, 05/09/2015 - 15:54.</div>
    <div class="content">
     <p>It works a treat with the Photon. I had things working on a Spark (Particle Core) and was able to do a straight swap for a Photon except for connecting D0 to D3 and 3v3* to Vbatt.</p>
<p>If you are using interrupts to monitor meter flashes or gas meter reed switches then you need to avoid using Photon pin D0 which does not support interrupts.</p>
<p>The phase compensation will not work (at least for the amount of phase shift I have) even at the slowest standard Photon sampling speed so you need to put in a 500 microsecond or so delay in the ADC sampling loop to slow things down a bit.</p>
<p>Finally, both the Spark(Core) and Photon have enough performance spare that you can log the current and voltage waveforms along with the power information. That is quite an eye opener.</p>
<p><img alt="Waveform from Spark/Core/Photon" src="../../../community.spark.io/uploads/default/3482/91d34e1182acac6d.png" style="width: 700px;" /></p>
<p>The Core and Photon are both capable of uploading data direct to emoncms without other hardware (OK you need a wireless router).</p>
<p><a href="https://community.particle.io/t/open-energy-monitor-port/3166" title="https://community.particle.io/t/open-energy-monitor-port/3166">https://community.particle.io/t/open-energy-monitor-port/3166</a></p>
<p>Gives the history of this project.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33868"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Fri, 04/09/2015 - 23:09.</div>
    <div class="content">
     <p><em>The phase compensation will not work (at least for the amount of phase shift I have)</em></p>
<p>Somebody here: &nbsp;<a href="11021.html">http://openenergymonitor.org/emon/node/11021</a>&nbsp;reckons they got it to work on a fast sampling ARM by using a much bigger PHASECAL number (7.5 Vs 1.7). &nbsp; I&#39;m not sure how their sampling speeds compare with yours, and I&#39;m not familiar enough with PHASECAL to compare their approach with your delay() approach, but hopefully others here might have a view. &nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33886"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4851.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Petehec&#039;s picture" title="Petehec&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/4851.html" title="View user profile.">Petehec</a> on Sat, 05/09/2015 - 16:48.</div>
    <div class="content">
     <p>Thanks dBC It is a relief to know that I&#39;m not alone.</p>
<p>The phase correction code is:</p>
<blockquote><p>phaseShiftedV = lastFilteredV + PHASECAL * (filteredV - lastFilteredV);</p>
</blockquote>
<p>so it is interpolatng between the most recent two voltage measurements. Ideally the two voltage measurements should be sampled on either side of the current (I) measurement in which case&nbsp;PHASECAL should be between 0 and 1. A modest extrapolation is safe but a large one changes the amplitude of the waveform.</p>
<p>Putting a delay between samples avoids the need for a large extrapolation. Without the delay the Photon can make a few hundred measurements per cycle and would need a large extrapolation similar to the one you mention. This would increase the measured V amplitude by about 10%. Not huge and it can be fixed with the calibration but I prefer to add the delay.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33902"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7605.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="craigfryer&#039;s picture" title="craigfryer&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7605.html" title="View user profile.">craigfryer</a> on Sun, 06/09/2015 - 00:13.</div>
    <div class="content">
     <p>Might be worth modifying the title of this thread to include the term Particle as well as Spark Core.</p>
<p>This looks to be a really great solution and if I understand correctly it would allow up to 7 CT clips plus a voltage measurement&nbsp;for what should be much less than emonTX for 4 CT clips or the emonPi&nbsp;for only 2 CT clips.</p>
<p>The one thing that does really concern me with using the Particle as the basis for a replacement for the existing two solutions is stability or lack of history of the company producing the Particle boards.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33910"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sun, 06/09/2015 - 07:45.</div>
    <div class="content">
     <p><em>Might be worth modifying the title of this thread to include the term Particle as well as Spark Core.</em></p>
<p>Done.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33914"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 06/09/2015 - 12:25.</div>
    <div class="content">
     <p><i>"a large [extrapolation] changes the amplitude of the waveform"</i></p>
<p>Not only that, if you have 'flat-topping' (where both positive and negative crests of the sine wave are flattened, as is common where I live), extrapolation significantly changes the shape of the waveform too.<br />
So a much better way (possibly even better than the delay) would be to save voltage samples and pick out the best two to interpolate between.</p>
<p>If you can, it would be worth dropping 1 cycle's worth of values into a spreadsheet, doing the extrapolation and plotting the resulting wave shape. As you don't have a true sinusoid there, you might not like the result!</p>
<p>Be aware that PHASECAL corrects for three things, phase errors in both the vt and ct, and the time error between readings. Changing the order of readings could help (I before V) but also bear in mind that all 3 variables change - the first two with voltage and current respectively, the third with supply frequency (in electrical degrees, not in time!).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33966"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4851.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Petehec&#039;s picture" title="Petehec&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/4851.html" title="View user profile.">Petehec</a> on Tue, 08/09/2015 - 22:31.</div>
    <div class="content">
     <p>Yes Robert Wall, you are quite right and most perceptive. It would be better to pick the most appropriate pair of V measurements to use for the interpolation and you are also right that the lag between measurements changes due to several variables, mostly unwanted ones and also due to the change in inductive loads that we want to detect so a fixed PHASECAL will never correct perfectly.</p>
<p>I looked at the waveform error with&nbsp; large extrapolation. I&#39;m near enough sinusoidal that it wouldn&#39;t significantly change the calculated power factor - I guess because near zero V vs T is close to linear. I still don&#39;t like the large extrapolation idea though.</p>
<p>I thought about adapting to variation in the unwanted effects on the fly (since the ARM based processors would have no problem with processing power) but I don&#39;t know how much of my load is inductive at any particular time and much of the time my current has such an awful waveform I wouldn&#39;t have a clue where to put my origin.</p>
<p>Consequently I have to make do with a fixed adjustment for lag. If I sample at several hundred measurements per cycle I could use&nbsp;</p>
<blockquote><p>phaseShiftedV = filteredV[t-ph] + PHASECAL * (filteredV[t] - filteredV[t-ph]);</p>
</blockquote>
<p>where ph is the whole number part of the phase correction and PHASECAL is the fractional part. It would just need a small buffer to store a few measurements. But is this overkill? At that high a sample rate the fractional part is not very important so phaseShiftedV = filteredV[t-ph]; would be good enough.</p>
<p>The alternative is to space the measurements out. It may be a bit less accurate - i.e. only as good as an Arduino ; ) &nbsp; but I don&#39;t think the error is significant compared with the demonstrable variation in V and I lag with power. That is why I settled for the minimal re-coding version with quite a large delay added. You still benefit from I and V being measured close to each other (especially if as you suggest you do it in the right order for your system).</p>
<p>I guess the really sophisticated solution would adjust the sample time to have a constant number of samples per cycle but life is too short and mains frequency stable enough.&nbsp;</p>
<p>Incidentally, the measurement that is most important to me is the exported power as that determines when I can turn on the immersion heater. The current clamp system gives me the import/export sign and I get a completely accurate power figure by meter flash counting. My calibrated current clamp is accurate to a few percent at large loads (imported or exported) but unimpressive at low powers though I use it when the meter flashes are too few and far between. Before I got a curent clamp I used to just use meter flashes and infer import/export by correlating the power changes from the generation and general meters and it was surprisingly reliable, but the current clamp responds more quickly.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34187"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Wed, 16/09/2015 - 10:42.</div>
    <div class="content">
     <p>Maybe we should design a&nbsp;shield for this chip. It certainly seems like quite a nice device.&nbsp;</p>
<p>There is a company that produces an Arduino like shield for the Particle&nbsp;Photon,&nbsp;</p>
<p><a href="https://www.sparkfun.com/products/13321" title="https://www.sparkfun.com/products/13321">https://www.sparkfun.com/products/13321</a></p>
<p>So maybe that with the emontx shield is a good starting point. But I notice that the hardware on the shield itself has not be updated with the latest emontx changes. So maybe that is step 1.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34206"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Wed, 16/09/2015 - 16:31.</div>
    <div class="content">
     <p>I had a spark shield I was working on, but have been sidelined with a major home reno project.&nbsp;</p>
<p><a href="https://github.com/officeboy/EmonCore/tree/master/hardware" title="https://github.com/officeboy/EmonCore/tree/master/hardware">https://github.com/officeboy/EmonCore/tree/master/hardware</a></p>
<p>Someone could take that and make the few changes for a photon, and get em made up. (don&#39;t use the 3.5mm jacks I did, they are terrible!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Sat, 19/09/2015 - 13:11.</div>
    <div class="content">
     <p>Trying to create a design based on all the improvement suggestions I have spotted.&nbsp;</p>
<p>How is this as a concept for the Photon?</p>
<p>I&#39;ve used the following bits.&nbsp;</p>
<p>1. Allow the photon to be powered by the same 9V ac adaptor. May have to put this into VBat&nbsp;rather than Vin.&nbsp;Design taken from V3.4</p>
<p>2. Buffer the input voltage bias and use the same for the CTs as well, Design taken from Robin.&nbsp;</p>
<p>3. Protect the inputs. Design taken from dBC.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34269"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 19/09/2015 - 18:57.</div>
    <div class="content">
     <p><i>"I spotted an error in it"</i></p>
<p>So have I - in the 9 V transformer dept!  But you <u>must</u> do a careful simulation of that half-wave supply, because the component values are critical to ensure correct operation at the current your require at the lowest supply voltage you are likely to encounter, and to verify that the voltage monitor input is not adversely affected by the voltage dip caused by the transformer regulation.</p>
<p>And it will be a lot harder if you want a 5 V d.c. supply - you might have to go to a 12 V transformer to have enough voltage to play with. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34271"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Sat, 19/09/2015 - 21:50.</div>
    <div class="content">
     <p>Might be best to ditch trying to use the 9V AC for both purposes and switch to using a dual 9V AC transformer and use one part for the AC wave detection and the other part for the 5V regulator via a Bridge rectifier.&nbsp;</p>
<p>Or use the face that the Photon already has the mini USB with a 3.3V regulator. And stick with using the single 9V AC for the volt detection only.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34274"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 19/09/2015 - 23:17.</div>
    <div class="content">
     <p>It says the Photon needs 80 mA - that's well outside the capacity of the half-wave rectifier with the component values you have. I suggest you use a transformer with two 9 V windings, using one with a full-wave rectifier for power, and the second for voltage monitoring. You will still get some interaction in the form of a dip in the voltage wave before and around the peak as the current pulse charges the smoothing capacitor, but in the full wave rectifier it is half the size of the half-wave pulse - but it happens twice as often.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34283"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Sun, 20/09/2015 - 10:43.</div>
    <div class="content">
     <p>Might as well use the Photons usb connection and regulator. It will keep the component count down of the additional stuff required.<br />
It does however mean that two power sockets get used to get this running. I.e. one for the usb power adapter and one for the 9v ac adapter. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34290"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Sun, 20/09/2015 - 16:13.</div>
    <div class="content">
     <p>Anyone know why the voltage divider was changed on the AC sense circuit from 10K+100K in the emontx v2 to the 10K+120K in the emontx v3?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34291"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 20/09/2015 - 16:35.</div>
    <div class="content">
     <p>Presumably to give a little more headroom given worst-case tolerances for all the relevant components.</p>
<p>Not that it makes a great deal of difference - the place where you need all the resolution you can get is in the current department. The usual range of the voltage input is the nominal voltage &plusmn; 10%. People expect the current to be measured accurately over at least 2 orders of magnitude, and often a lot more (but they are usually disappointed!).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34292"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Sun, 20/09/2015 - 17:35.</div>
    <div class="content">
     <p>Trying to put together a circuit which has the best suggestions/improvements. So maybe a 10K+120K is the way to go.&nbsp;</p>
<p>Any other suggestions to get the hardware side as flexible and sorted as possible. The plan was to tie the analogue&nbsp;inputs down to CTs and voltage reading. And expose all the Digital IOs into a terminal block. That way it&#39;s the most flexible.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34293"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Sun, 20/09/2015 - 18:35.</div>
    <div class="content">
     <p>How is the attached&nbsp;as a starting point?</p>
<p>There is one bit I don&#39;t quite understand.</p>
<p>In Buffered Voltage Bias&nbsp;circuit the middle of the 10K+100K junction is fed to the chip as the voltage sense. And the &#39;mid-point&#39; on the op amp is used for the CT sensors which is also connected to the 10K.&nbsp;</p>
<p>But in his own MK2 router he uses the&nbsp;the middle of the 10K+100K&nbsp;junction and the &#39;mid-point&#39; on the op amp for the CT sensors. And the 10K is used into the chip for the voltage sense.&nbsp;</p>
<p>Why the difference? and which way is better?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34300"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 20/09/2015 - 21:07.</div>
    <div class="content">
     <p><i>"How is the attached as a starting point?"</i></p>
<p>Something's gone wrong with the current input - you've got the ADC input connected to the bias source and the burden voltage does nothing.<br />
You're missing a few dots where crossing/meeting lines ought to join. </p>
<p><i>"Why the difference? and which way is better?"</i></p>
<p>Both present a divided-down voltage to the analogue input. The difference is probably down to either personal preference, the way the ac adapter plug is connected (because the difference is when changing from one to the other, the voltage signal is inverted), or the ease of laying out the pcb. </p>
<p>If you're concerned with the phase of the voltage signal (which could come from compatibility issues), one is right and one is wrong. Otherwise, neither is intrinsically 'better'.</p>
<p>Does the Photon have separate analogue and digital V<sub>CC</sub>? If it does, you should pay careful attention to that and include some filtering because of potential noise problems. And you must be careful with earthing/grounding too (i.e. keep the analogue grounds separate from the digital as far as possible, and joint them at one place only).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34301"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Sun, 20/09/2015 - 22:00.</div>
    <div class="content">
     <p>How&#39;s this revision? I&#39;m trying to keep the hardware design as close to the V3.4 as possible, so will stick to using the middle of the 10K+120K as the input into the ADC.&nbsp;</p>
<p>The Photon doesn&#39;t appear to have separate&nbsp;Vcc. Just a single 3.3V output. There are two Grounds but again they are connected on the same Ground plane within the chip. For ease, I will utilise the Left hand for the analogue&nbsp;inputs and the Right hand ground can be reserved for the Digital ones.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34308"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 21/09/2015 - 05:21.</div>
    <div class="content">
     <p>The STM32 processor itself has a separate Vdda&nbsp;pin&nbsp;and the datasheet specifies how to decouple it from Vdd, but that all has to be done right at the pin, so hopefully the Photon designers followed those instructions. &nbsp;It wouldn&#39;t make sense to expose that pin all the way out to Photon pins and expect you to do it. &nbsp;Unfortunately, the schematic here: &nbsp;<a href="https://docs.particle.io/datasheets/photon-datasheet/#schematic">https://docs.particle.io/datasheets/photon-datasheet/#schematic</a>&nbsp;doesn&#39;t show you how things are wired inside the P0 module, but either of pins 46 or&nbsp;47 look like a possible candidate&nbsp;with decoupling on each.</p>
<p>It seems that processor has 3 ADCs&nbsp;each of which can access any of 16 input pins (although only 8 are exposed by your module). &nbsp;If you&#39;re prepared to put the coding effort in, you could potentially get some great results with simultaneous conversions on 3 pins at a time. &nbsp;Given that, I wonder if it would be worth devoting one of the 8 ADC input pins&nbsp;to measuring the mid-rail (at the cost of being able to measure one less CT). &nbsp;I&#39;m not sure if anyone has experimented with measuring the DC offset Vs the current method of filtering it away in software. &nbsp;On the AVR based designs that would be very expensive in terms&nbsp;of precious ADC conversions,&nbsp;but you appear to have the horsepower to at least consider it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34309"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Mon, 21/09/2015 - 06:40.</div>
    <div class="content">
     <p>We can always have one analogue input devoted to measuring the mid-rail. My thoughts were 3 full range CTs and 3 high sensitivity CTs, 1 used for the AC measurement, so we still have one spare.</p>
<p>How will I need to wire up the input to don the measurement you are talking about.<br />
Once we get the hardware nailed down we can decide how best to use the available design features within the software.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34311"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 21/09/2015 - 07:20.</div>
    <div class="content">
     <p>I think it would be as simple as taking the output of the op-amp and wiring it to A1 (say), and change your CT input section to say &quot;A2-7&quot; instead of &quot;A1-7&quot;. &nbsp; You shouldn&#39;t need any protection on that input because there are no external forces to take it beyond the rails.</p>
<p>But I&#39;m having trouble reconciling your footprint&nbsp;with the LMV321 datasheet I found here: &nbsp;<a href="http://www.ti.com/lit/ds/symlink/lmv321-n.pdf">http://www.ti.com/lit/ds/symlink/lmv321-n.pdf</a>. &nbsp;Is yours 6-pin as shown in your schematic?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34312"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Mon, 21/09/2015 - 08:05.</div>
    <div class="content">
     <p>I have taken the LMV321 pinout from the page in the Building blocks section. Haven't checked it with the datasheet, just assumed that it was correct. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34323"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Mon, 21/09/2015 - 10:56.</div>
    <div class="content">
     <p>I see the issue. I used a 6 pin package in my diagram whereas the LVM321 is a 5 pin part. Will change that.<br />
But my pin numbers are correct, just the package representation is wrong. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34327"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Mon, 21/09/2015 - 12:17.</div>
    <div class="content">
     <p>I haven&#39;t found the part needed that gives me a 5 pin op amp symbol yet, so ignore that.&nbsp;</p>
<p>But I&#39;ve made the changes to feed the output of the op amp into the ADC A1. Are we sure we don&#39;t want to protect this input like we are doing the others.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34328"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 21/09/2015 - 13:54.</div>
    <div class="content">
     <p><i>"Are we sure we don't want to protect this input like we are doing the others."</i></p>
<p>Q. What are you protecting against?<br />
A. The input voltage going beyond the power rails, i.e. less than 0 V or greater than 3.3 V. </p>
<p>Q. (To you) How can it do that when it is the midpoint of those two rails?</p>
<p>dBC: In Robin's Mk2 diverter, he uses the op.amp buffer and the low pass filter on one input only to extract the offset, then subtracts the same offset from that and the remaining 2 inputs, the objective being to economise on processor cycles. If Bruce wants, he can do the same (and keep all 8 ADC inputs available) or he can take your suggestion and simply subtract that channel from each of the others to remove the offset. But a caveat: if different ADCs are used for different channels, a small offset may remain due to errors within the ADCs. The Atmel processor has only one ADC, so any differences between channels is down to the multiplexer only.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34330"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Mon, 21/09/2015 - 15:29.</div>
    <div class="content">
     <p>I officeboy, i invite you to take a look at this lib : <a href="2406.html" title="http://openenergymonitor.org/emon/node/2406">http://openenergymonitor.org/emon/node/2406</a></p>
<p>In particular read this app note for general energy metering information: <a href="http://www.atmel.com/Images/Atmel-2566-Single-Phase-Power-Energy-Meter-with-Tamper-Detection_Ap-Notes_AVR465.pdf" title="http://www.atmel.com/Images/Atmel-2566-Single-Phase-Power-Energy-Meter-with-Tamper-Detection_Ap-Notes_AVR465.pdf">http://www.atmel.com/Images/Atmel-2566-Single-Phase-Power-Energy-Meter-w...</a></p>
<p>A reliable solution is lacking for 3 phase metering. With this hardware capabilities i thing you should focus on it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34331"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Mon, 21/09/2015 - 15:42.</div>
    <div class="content">
     <p>I'm trying to nail down the hardware side as much as possible using all the best suggestions. Once that is done and I have a sample batch of boards ready, I can distribute those, at cost, to anyone who wants one. Then collectively we can work on using the capability of a web connected microprocessor.<br />
So if there is anything in the hardware design that is lacking for 3 phase metering then shout and I'll add it in.<br />
My thoughts behind the 3 high range inputs and 3 high sensitivity inputs was to cater for a 3 phase implementation too. But always open to suggestions.  </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34334"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 21/09/2015 - 16:07.</div>
    <div class="content">
     <p>If you want to do accurate 3-phase metering, then 3 voltage inputs are essential. One voltage input can only be accurate for that phase, everything else is an assumption based on the phases being balanced.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34335"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Mon, 21/09/2015 - 16:10.</div>
    <div class="content">
     <p>So maybe 3 phase accuracy is a dream. Because no one is going to have 3 ac adapters plugged into this. Having a 5v usb and a 9v ac block is seen as excessive enough. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34342"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Mon, 21/09/2015 - 20:10.</div>
    <div class="content">
     <p>So any other suggestions? To improve on the hardware and utilise what we have on offer within the Photon. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34343"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7815.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7815.jpg" alt="officeboy&#039;s picture" title="officeboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/7815.html" title="View user profile.">officeboy</a> on Mon, 21/09/2015 - 20:14.</div>
    <div class="content">
     <p>How many milliamps will that 9V input/regulator be able to provide before the AC wave is too distorted?&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34347"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 21/09/2015 - 23:21.</div>
    <div class="content">
     <p><em>If you want to do accurate 3-phase metering, then 3 voltage inputs are essential.</em></p>
<p>I&#39;ll second that. &nbsp;In some spot checks I&#39;ve done&nbsp;in Aus and NZ, it&#39;s common to see more than 10V difference between the phases, and which phase is hottest varies throughout the day so you can&#39;t calibrate it away.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 22/09/2015 - 00:16.</div>
    <div class="content">
     <p><i>"How many milliamps will that 9V input/regulator be able to provide before the AC wave is too distorted? "</i></p>
<p>I have no idea. It depends on what you mean by "too distorted" and of course on the parameters of the adapter/transformer that you're using. If I remember correctly, I decided that about &frac12;% reduction in the rms voltage due to the dip was the limit of acceptability. You might think that's excessively cautious, but I based it on claims by some users that with care, they had calibrated their emonTx to read within 1% of their supplier's tariff meter. Probably the only realistic way to determine what you can get away with is to measure the transformer, then build an accurate Spice model of the transformer, rectifier, smoothing and regulator, and then apply varying loads and keep checking the distortion.</p>
<p>There's a picture of what happens in this thread: <a href="10715.html#comment-30427" title="http://openenergymonitor.org/emon/node/10715#comment-30427">http://openenergymonitor.org/emon/node/10715#comment-30427</a></p>
<p>I actually designed the circuit from the other direction: The required current was defined, so I chose the components (for the emonTx V3.2) to give the minimum dip whilst still able to just operate at minimum supply voltage.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34350"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Tue, 22/09/2015 - 07:12.</div>
    <div class="content">
     <p>Are we still trying to get this powered and voltage measured using the 9V supply. I thought we felt the power required by the Photon and all the other associated components was pushing that too far. Hence sticking with using the 5V usb and a 9v ac separate. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34351"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8012.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bruce_miranda&#039;s picture" title="bruce_miranda&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCore - All in one project based on the Particle (fomerly Spark) Core </h3>

    <div class="submitted">Submitted by <a href="../user/8012.html" title="View user profile.">bruce_miranda</a> on Tue, 22/09/2015 - 07:27.</div>
    <div class="content">
     <p>I think I'll start a new thread to let people comment on the design, not least because it's using the Photon instead of the Core.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10428"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-JmOLYoBqqlH76drUApr5ne9kH_2v9Idg65BdFolSZ5k" value="form-JmOLYoBqqlH76drUApr5ne9kH_2v9Idg65BdFolSZ5k"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
