<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10175 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:01:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Estimate daily energy costs taking into account given conditions | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Estimate daily energy costs taking into account given conditions</h3>
        <span class="submitted">Submitted by <a href="../user/7699.html" title="View user profile.">mik.open</a> on Sun, 15/02/2015 - 19:22</span>
        <div class="content"><p>Hi,</p>
<p>first of all: thanks to the creators of this wonderful project and to the great community around it.</p>
<p>I&#39;m running a couple of EmonTx v3 with the 3 Phase sketch (emonTxV3_3Phase_Voltage.ino). As a base station I use the Raspberry Pi (low write image) and additionally I&#39;m sending the data to emoncms.org.</p>
<p>My question is: how could I estimate daily energy costs taking into account some conditions:</p>
<p>- energy costs depend on things like day/night time, weekday (and so on)</p>
<p>My approach would be:</p>
<p>- create a dedicated Wh Accumulator feed (containing the actual/approx. power usage sum of all 3 phases)</p>
<p>- on a daily base get the accumulator feed value (through the API) for example at 10pm and subtract the feed value at 8am.</p>
<p>This should give me the amount of consumed energy during that time frame (8am - 10pm). Am I right?</p>
<p>What would your solution look like?</p>
<p>Thank you in advance</p>
<p>Mik</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10222.html" class="topic-previous" title="Go to previous forum topic">‹ DC Monitoring with Hall effect sensor</a>
              <a href="10423.html" class="topic-next" title="Go to next forum topic">3 Phase Monitoring using 3 EmonTX V3&#039;s - some questions ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-27743"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Estimate daily energy costs taking into account given conditions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 15/02/2015 - 19:56.</div>
    <div class="content">
     <p>Wh accumulator is specifically for use with wh counting on board a emonTx and requires a ever increasing total to function.</p>
<p>If you are only transmitting power and totalling&nbsp;within emoncms a normal power to kwh will do the trick.</p>
<p>I am tracking costs across a multi rate tarriff&nbsp;(Economy 7) using cron&nbsp;to switch tariffs at the respective times.</p>
<p>ie when peak kicks in the &quot;current rate =&nbsp;&pound;hi&quot; and &quot;peak = 1&quot; offpeak=0&quot;</p>
<p>and when off peak kicks in &quot;current rate = &pound;lo&quot; and &quot;peak =0&quot; offpeak&nbsp;= 1&quot;</p>
<p>processing for &quot;peak tarriff&quot; is Kwh&#39;s&nbsp;x peak (1 or 0) for peak kwhs&nbsp;and x currentrate for cost</p>
<p>similarly&nbsp;for &quot;offpeak&nbsp;tarriff&quot; Kwh&#39;s&nbsp;x offpeak&nbsp;(1 or 0) for off peak kwhs and x currentrate&nbsp;for cost</p>
<p>I have found this very accurate except for the fact I have a PV diverter and if that is working well then the to and fro&#39;ing within the &quot;sweet&nbsp;zone&quot; or &quot;energy bucket&quot; adds to the recorded&nbsp;energy&nbsp;totals in both directions but that has nothing to do with the tarriff split as they always match the total when summed.</p>
<p>The script I use with cron&nbsp;and emonhub is <a href="https://github.com/pb66/cronnode">available on github&nbsp;and&nbsp;called cronnode</a></p>
<p>There is also a <a href="10019.html">&quot;EmonCMS multi rate scheduler&quot;</a> in development which looks more powerful but won&#39;t be able to be used with emoncms.org as it&#39;s a separate module.&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27744"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7699.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mik.open&#039;s picture" title="mik.open&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Estimate daily energy costs taking into account given conditions</h3>

    <div class="submitted">Submitted by <a href="../user/7699.html" title="View user profile.">mik.open</a> on Sun, 15/02/2015 - 20:26.</div>
    <div class="content">
     <p>Thank you Paul for sharing your approach.</p>
<p>I sure got that accumulator thing totally wrong :) If would have been really nice if that was the case (accumulate the kWh and query the value for a given time). I&#39;m wondering how I could achieve that. It would be great to get only the data (kWh) for the various time frames I&#39;m interested in and do the math outside of emoncms.</p>
<p>I would need that, because on my bill I have different prices for the first X kWh per month, a price for the next Y and after surpassing a defined threshold I will pay another price.</p>
<p>Mik</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27745"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Estimate daily energy costs taking into account given conditions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 15/02/2015 - 20:58.</div>
    <div class="content">
     <p>Its totally possible to track the usage in a way that&#39;s more suited to your needs for starters if you new the month to date kwh&#39;s&nbsp;the rest would be easy to do maually outside emoncms and could be the basis of automating the process.</p>
<p>If you start with the normal tracking and to that add a second power to kwh feed called something like &quot;month2date&quot; this would just follow the normal every increasing tally of energy used. But if you then add an input using the <a href="http://emoncms.org/input/api">input api</a>&nbsp;for example&nbsp;http://emoncms.org/input/post.json?node=1&amp;apikey=xxxxx<span style="line-height:20.7999992370605px">&amp;json{mtd=0}&nbsp;</span><span style="line-height:1.6">and you add one process &quot;log to feed&quot; and select the &quot;</span>month2date<span style="line-height:1.6">&quot; feed previousl</span><span style="line-height:1.6">y&nbsp;</span><span style="line-height:1.6">created.</span><span style="line-height:1.6">&nbsp;W</span><span style="line-height:1.6">hen ever that api url is used it will reset the month to date to 0.</span></p>
<p>Then set up a cron to run that url request at midnight the 1st of each month (or whenever your billing cycle starts) this will give you a actual amount used this month throughout the month. to simplify your calcs.</p>
<p>You could include a second value to that api url with your 1st band price per unit so that you can also calculate a rolling cost for both the month and the total kwhs.eg&nbsp;http://emoncms.org/input/post.json?node=1&amp;apikey=xxxxx&amp;json{mtd=0,ppu=25}&nbsp; (as in 25 PencePerUnit)</p>
<p>To that you add&nbsp;a simple script that polls the month to date&nbsp;feed and if that value is greater than your 1st break point it sends&nbsp;&nbsp;http://emoncms.org/input/post.json?node=1&amp;apikey=xxxxx&amp;json{ppu=15}&nbsp;&nbsp;(2nd band price) and when the returned value reaches the next break point&nbsp;http://emoncms.org/input/post.json?node=1&amp;apikey=xxxxx&amp;json{ppu=5}&nbsp;&nbsp;(3rd band price)&nbsp;</p>
<p>At which point your dash board can display not only the accurate&nbsp;month to date units used but accurate cost for the month too.</p>
<p>It sounds complex but that&#39;s probally just the long winded explanation.</p>
<p>Basically a cron&nbsp;and a send if greater than script and your there.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27746"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7699.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mik.open&#039;s picture" title="mik.open&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Estimate daily energy costs taking into account given conditions</h3>

    <div class="submitted">Submitted by <a href="../user/7699.html" title="View user profile.">mik.open</a> on Sun, 15/02/2015 - 21:13.</div>
    <div class="content">
     <p>Thanks Paul, but as mentioned in the previous post there is an additional variable (the time of the day and the week day). I can&#39;t see how I can handle that in your last suggestion.</p>
<p>Mik</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27748"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Estimate daily energy costs taking into account given conditions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 15/02/2015 - 21:40.</div>
    <div class="content">
     <p>I&#39;m not sure I understand your tariff but the bottom line is once you know the equation it should be achievable as cron can cope with any schedule and you can fetch the &quot;total since&nbsp;whenever&quot; from emoncms into a simple script to act on &quot;unit counts since&quot; the combination of the 2 can set a &quot;tariff&nbsp;node&quot; of control data prices etc that you can&nbsp;manipulate to effect the collected data,&nbsp;so the units get added to the right tarrif&nbsp;feeds and those feeds multiplied by price per unit give you cost to date or month to date.</p>
<p>If you layout the full terms of your tariff (the exact prices/times and quantities etc can be altered for privacy) I&#39;ll give it a whirl for you</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27794"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7699.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mik.open&#039;s picture" title="mik.open&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Estimate daily energy costs taking into account given conditions</h3>

    <div class="submitted">Submitted by <a href="../user/7699.html" title="View user profile.">mik.open</a> on Mon, 16/02/2015 - 22:02.</div>
    <div class="content">
     <p>Hi Paul, I&#39;ve looked at my bill and I&#39;ve noticed that taking into account only the time/day variable should work out just fine.</p>
<p>Now I will try to wrap up the information you gave me. I still have a couple of questions:</p>
<p>- do I have to create a &quot;Power to kWh&quot;-feed?</p>
<p>- with which URL/method should I query the value for the start and end of a tariff timeframe?</p>
<p>Thanks</p>
<p>Mik</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28061"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7699.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mik.open&#039;s picture" title="mik.open&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Estimate daily energy costs taking into account given conditions</h3>

    <div class="submitted">Submitted by <a href="../user/7699.html" title="View user profile.">mik.open</a> on Sun, 22/02/2015 - 17:12.</div>
    <div class="content">
     <p>Hi,</p>
<p>I&#39;ve decided to do all the math outside of Emoncms. Now I&#39;ve the relevant data in multiple feeds.</p>
<p>Is there an API call to get the feed value on a given unixtimestamp?</p>
<p>I&#39;ve seen the data.json call, but I wasn&#39;t able to get proper data from it.</p>
<p>&nbsp;</p>
<p>Thanks</p>
<p>Mik</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29371"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7699.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mik.open&#039;s picture" title="mik.open&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Estimate daily energy costs taking into account given conditions</h3>

    <div class="submitted">Submitted by <a href="../user/7699.html" title="View user profile.">mik.open</a> on Fri, 03/04/2015 - 21:39.</div>
    <div class="content">
     <pre>
I&#39;ve solved this issue doing something like this (quick and dirty):

        endTS = startTS + 10000
        requestUrl = &quot;http://emoncms.org/feed/data.json?&quot; +
 &quot;id=%s&amp;start=%s&amp;end=%s&amp;apikey=%s&amp;dp=1&quot; % (feedid, startTS, endTS, apikey)

        import urllib2
        response   = urllib2.urlopen(requestUrl)
        responseJs = json.loads(response.read())
        # get first value
        feedTS    = responseJs[0][0]
        feedValue = responseJs[0][1]</pre><p>&nbsp;</p>
<p><em>Edit - wrapped long line - BT</em></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10175"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-hiBgXGM-RGrT1Zh6qqnlFzqsuyzdPAMR262Ed2laXbg" value="form-hiBgXGM-RGrT1Zh6qqnlFzqsuyzdPAMR262Ed2laXbg"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
