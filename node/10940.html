<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title> 8 lines + water and gas | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/3">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style=""> 8 lines + water and gas</h3>
        <span class="submitted">Submitted by <a href="/emon/user/8207" title="View user profile.">clements</a> on Sat, 04/07/2015 - 21:46</span>
        <div class="content"><p>Hi,</p>
<p>I have been reading on these forums for some while but havent posted much.&nbsp;But now i want to start building something for myself.</p>
<p>I am planning on building setup using a arduino due. I want to monitor 8 lines and also the water and gas usage. The max current per line is 16A (i live in the Netherlands). For the current transformers i have found some through hole <a href="http://eu.mouser.com/ProductDetail/Pulse/PE-51688NL/?qs=%2fha2pyFadugsCRluKsn%2fLC2bkSowEBDZpvbsszr7Nro%3d">20A, 200 turns sensors</a>. The plan is to place 8 of these&nbsp;on 1 circuit board, and wire it to the arduino.&nbsp;</p>
<p>By using these &nbsp;sensors i should have the same circuits as discribed in the blog on <a href="http://boredomprojects.net/index.php/projects/home-energy-monitor">boredomprojects</a>.&nbsp;</p>
<p>Im not quite sure i made the correct choice, any help on choosing the right sensors would be welcome. :)</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/10967" class="topic-previous" title="Go to previous forum topic">‹ Calibration and 3-phase calculations in emoncms?</a>
              <a href="/emon/node/10960" class="topic-next" title="Go to next forum topic">Feature request: report summary of data range ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31918"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 04/07/2015 - 21:59.</div>
    <div class="content">
     <p>This is a give-away, from the top of the data sheet:</p>
<p>&quot;Designed for switching power supply applications<br />
&nbsp;Frequency range from 20kHz to 200kHz&quot;</p>
<p>Your mains frequency of&nbsp;50 Hz &nbsp;is quite a long way outside the specified range.</p>
<p>I believe Robin Emley uses either the 20 A version here: <a href="http://www.yhdc.com/en/product/425/" title="http://www.yhdc.com/en/product/425/">http://www.yhdc.com/en/product/425/</a> or this 20A:10mA one <a href="http://eppep.com/?action-viewnews-itemid-140364" title="http://eppep.com/?action-viewnews-itemid-140364">http://eppep.com/?action-viewnews-itemid-140364</a> from <a href="http://www.ebay.co.uk/itm/281436762683?_trksid=p2059210.m2749.l2649&amp;ssPageName=STRK%3AMEBIDX%3AIT" title="http://www.ebay.co.uk/itm/281436762683?_trksid=p2059210.m2749.l2649&amp;ssPageName=STRK%3AMEBIDX%3AIT">http://www.ebay.co.uk/itm/281436762683?_trksid=p2059210.m2749.l2649&amp;ssPa...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31952"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8207" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="clements&#039;s picture" title="clements&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8207" title="View user profile.">clements</a> on Sun, 05/07/2015 - 20:38.</div>
    <div class="content">
     <p>Tnaks for the links, I will have to choose between a TA17 CT sensor and one from <a href="http://nl.mouser.com/ProductDetail/Triad-Magnetics/CST-1020/?qs=sGAEpiMZZMsx8IbIvybzbCEMhEibz%252bNbEIaAF3qXCnQ%3d">Triad</a>&nbsp;&nbsp;both have aprox the same specs.&nbsp;</p>
<p>For the gas and water meter I want to use optical sensors. Just order some stuff and its playtime ;)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31956"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 05/07/2015 - 21:55.</div>
    <div class="content">
     <p>The Triad CST-1020 does appear to have an adequate VA rating for a 5 V Arduino.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31986"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8207" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="clements&#039;s picture" title="clements&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8207" title="View user profile.">clements</a> on Mon, 06/07/2015 - 21:27.</div>
    <div class="content">
     <p>I have been doing some calculations, with the 2nd link provided by Robert. Its a 1:2000 20A-10mA&nbsp;CT.</p>
<p>At 16A mains -&gt; Isec = 8 mA. &nbsp;8 * sqrt(2) = 11.3 -&gt; 22.6 mA peak to peak.&nbsp;</p>
<p>For the Arduino Due input is 3.3 V -&gt; 3.3 / 22.6mA = 146 ohm burden resistor. &nbsp;This can be done by using a 130 + 16 ohm resistors in series. &nbsp;Using 2* 47 Kohm&nbsp;as a voltage divider will give a current draw per measuring line of 0.035 mA.&nbsp;</p>
<p>According to <a href="http://openenergymonitor.org/emon/buildingblocks/ct-sensors-interface">this page</a>&nbsp;a capacitor should be used. I cant really figure out the function of it, but I suppose its useful so I will place them also :)</p>
<p>The hardware is being ordered. Next is digging into the code en figure out how it calculates the currents etc.&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31996"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 07/07/2015 - 00:33.</div>
    <div class="content">
     <p>The capacitor is there to provide a low impedance path to GND so that the full burden alternating voltage appears at the ADC input. Otherwise, you have 23.5 k&Omega;, the Thevenin equivalent of the bias resistors, in series with the burden and the input impedance of the ADC, and some of alternating component of the voltage that you want to appear at the ADC input will instead appear at the junction of the resistors.</p>
<p>You don't in fact want 3.3 V peak-peak across your burden resistor, but about 5% less. Remember component tolerances, you must assume they will always add up the worst possible way and that has the effect of reducing the input range available. I aim for 1.1 V rms across the burden. There's a piece in Building Blocks "Sources of error in the emonTx voltage and current inputs." about their effect, and while it doesn't explicitly state how they affect your choice of burden, it should give you a general idea of what to consider. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32006"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8207" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="clements&#039;s picture" title="clements&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8207" title="View user profile.">clements</a> on Tue, 07/07/2015 - 11:43.</div>
    <div class="content">
     <p>Ok thanks, that clears it up (a bit)</p>
<p>A whole other subject. Now the plan is to use the arduino as the collector of the inputs. It sends its data to a raspberry pi. The pi can present the data via a webinterface.</p>
<p>Is it a feasible route to cut out the arduino and use a Pi as a collector for the inputs. I don&#39;t need any wireless communication and i have found breakout boards&nbsp;available for the pi. Connecting 8 analog inputs and 2 puls counters to the Pi could be possible?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32008"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 07/07/2015 - 14:58.</div>
    <div class="content">
     <p>I can't answer that directly. I'd say probably, but you need to take into account what processing power you have in the Pi and whether it is possible to prioritise the tasks, because you need to sample the analogue inputs regularly in order to be able to calculate the averages. When you write "breakout boards", you actually need analogue to digital converters because my understanding is the Pi natively does not have any analogue input capability.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32022"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8207" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="clements&#039;s picture" title="clements&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8207" title="View user profile.">clements</a> on Tue, 07/07/2015 - 20:31.</div>
    <div class="content">
     <p>The arduino due:</p>
<div>A 32-bit core, that allows operations on 4 bytes wide data within a single CPU clock.&nbsp;</div>
<div>CPU Clock at 84Mhz.<br />
96&nbsp;KBytes&nbsp;of SRAM.</div>
<div>&nbsp;</div>
<div>RPi 2 B :</div>
<div>
<p>A 900MHz quad-core ARM Cortex-A7 CPU</p>
<p>40pin extended GPIO</p>
<p>&nbsp;</p>
<p>It seems to me the Pi has a lot more power to do calculations. I don&#39;t need wireless communication because I plan to hook it up via ethernet, so in my opinion I can use all in-outputs for the sensors.</p>
<p>I haven&#39;t seen much on this topic, to have 1 Pi do the data acquisition and act as a base station. I have tried to search the website and forum but a lot of hits are generated on de emonPi.</p>
</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32034"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 07/07/2015 - 22:23.</div>
    <div class="content">
     <p>As far as I can remember, nobody has written about adding a analogue input card/shield/whatever to a Pi. The emonPi is actually a slimmed-down emonTx and a Pi in the same box, communicating serially, so not working the way that you want to. So I think that if you do add an analogue input to a Pi, you're pioneering the development of a new device.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32037"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3016" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3016" title="View user profile.">dBC</a> on Tue, 07/07/2015 - 22:55.</div>
    <div class="content">
     <p>This project: &nbsp;<a href="http://openenergymonitor.org/emon/node/10561">http://openenergymonitor.org/emon/node/10561</a>&nbsp;went one step further and added an energy IC and analog MUX to an RPi. &nbsp; That offloads the time critical stuff to the IC and just leaves the RPi to orchestrate everything.</p>
<p>But if you do want to do all the energy maths yourself in C, then as you say it&#39;s hard to imagine your RPi won&#39;t be better at it then an Arduino (even a SAM based DUE). &nbsp;One advantage the Arduino approach has is the code you write is the code that runs on the CPU so it&#39;s entirely deterministic how long each instruction will take.&nbsp;Whereas if you write it as a &nbsp;Linux process, it will be competing for resources along with dozens of other processes. &nbsp;</p>
<p>With that much grunt, it&#39;s hard to believe it could be a problem and&nbsp;If nice-ing your energy process wasn&#39;t sufficient to fix it, there are other options as well. &nbsp;You can restrict the kernel scheduler to just 3 cores, and run your energy process on the 4th core. &nbsp;Check out&nbsp;isolcpus and taskset if you want to go that route. &nbsp;Or you could even push your time critical energy stuff down into the kernel.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32065"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8207" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="clements&#039;s picture" title="clements&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re:  8 lines + water and gas</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8207" title="View user profile.">clements</a> on Wed, 08/07/2015 - 18:50.</div>
    <div class="content">
     <p>mmm, that makes me think. My programming skills are close to zero, so starting a project like this and straight away start writing all custom code etc doesn&#39;t seem the wisest thing to do. :)</p>
<p>According to <a href="http://openenergymonitor.org/emon/node/3884">this page</a> it is possible to hard wire a emontx to a RPi. I will start my project by using a Arduino Due and a RPI 2B &nbsp;in combination with through hole CT sensors.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/10940"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-KKkBNRMGVEhlWAvDcuj6js8ohPj656uf_DYZBea6wLg" value="form-KKkBNRMGVEhlWAvDcuj6js8ohPj656uf_DYZBea6wLg"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
