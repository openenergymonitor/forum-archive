<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2643 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:27:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonTX not sending all the time creating wrong values in EmonCMS | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonTX not sending all the time creating wrong values in EmonCMS</h3>
        <span class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Fri, 02/08/2013 - 05:13</span>
        <div class="content"><p>Hello!</p>
<p>I&#39;ve found a problem in my newest setup:</p>
<p>EmonTX compatible self-built, monitoring a solar panel (and also powered by this panel, so no power supply in the night). I monitor the DC values of a single 250W module, the voltage is measured by a voltage divider, the current via a ACS712 current sensor with 20A range.</p>
<p>Data relayed by Atmega328 with RFM12B module and groupRelay script from jeelabs.</p>
<p>RaspberryPi receiving the data.</p>
<p>&nbsp;</p>
<p>When the power goes down or up the measurement shows high values, so Emoncms connects this data points, and also adds this to the generated Energy, so the values of generated energy are wrong (about 0,2kWh every night).</p>
<p>You can have a look at this problem there (time between 8 pm and 6 am): <a href="http://emoncms.org/jb79/Solar2">http://emoncms.org/jb79/Solar2</a></p>
<p>What can be done to solve this problem, a possible solution would be to add a small battery that is charged by the solar panel, or is there a possibility to do this in the EmonTX?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2751.html" class="topic-previous" title="Go to previous forum topic">‹ emontx firmware question</a>
              <a href="2803.html" class="topic-next" title="Go to next forum topic">JSON format for TIMESTORE posts? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-14004"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3657.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3657.jpg" alt="Mattia Rossi&#039;s picture" title="Mattia Rossi&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/3657.html" title="View user profile.">Mattia Rossi</a> on Fri, 02/08/2013 - 07:08.</div>
    <div class="content">
     <p>The easiest solution would be to modify the sketch in a way such it doesn&#39;t transmit the high or low values .. just set a minimum and maximum value the measurement must have, and if the current measurement doesn&#39;t fall into the interval just discard it instead of sending it ....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14009"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3367.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3367.jpg" alt="Dan Woodie&#039;s picture" title="Dan Woodie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/3367.html" title="View user profile.">Dan Woodie</a> on Fri, 02/08/2013 - 13:11.</div>
    <div class="content">
     <p>It would appear that your readings read accurately until the generated power goes below about 2 W, and then they get spuriously high until it cuts off. The same when it first starts up. So I don&#39;t think thresholding the values will work, since it thinks it is measuring about 70 W just before it powers off. For the start up, you could have the sketch just wait a certain amount of time before transmitting any data, say 1 - 5 minutes after it powers up, so you know it will have enough power to give accurate measurements. The evening drop off is a bit harder to manage. You could have a thresholding function that says if the measured power is below a certain amount, say 3 or 4 W, to output a zero, and after a certain number of zeros, stop all output and wait for the long sleep of night. In the morning, as soon as it wakes up , the first output it does is zero, so the two connected points (last point the day before to the first point in the morning) will not integrate to any energy for the night. Then it waits the proper amount of time before putting out the first real power measurement.</p>
<p>Someone else who knows the Atmega328 might be able to suggest some method to measure the Vcc and be able to tell it to output zero if that is below some value. That would be another way to do it that might be more accurate.</p>
<p>Dan</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14010"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 02/08/2013 - 13:17.</div>
    <div class="content">
     <p>A suggestion: use the d.c. voltage you&#39;re already measuring and only send data when it is above an acceptable threshold - enough to run the regulator that&#39;s feeding your emonTx. For good measure add some delay on a rising voltage but shut down immediately on a falling voltage. You might need to allow a margin so that there&#39;s enough voltage left to measure accurately and do an orderly shut-down before it falls over.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14012"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Fri, 02/08/2013 - 13:25.</div>
    <div class="content">
     <p>i used succesfully dc voltage threshold just below inverter threshold. this works most of the time with PV. there is a problem anyhow if the last transmissions does not go through as you can not quarantee that the last transmission does not collide in 868mhz network.</p>
<p>anyhow one of the recent (this spring) releases of emoncms&nbsp;introduced a problem you described that emoncms does show a line between two more or less arbitrary&nbsp;points on some screens (e.g. weekly view) and then when zoomed in it shows accurate values.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14025"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2128.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jb79&#039;s picture" title="jb79&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Sat, 03/08/2013 - 06:59.</div>
    <div class="content">
     <p>I think I&#39;ll try Robert&#39;s solution and insert an if statement that switches off data transmission when the solar voltage is &lt;12V.</p>
<p>It looks like the problem appears when the input voltage is lower than 8,5V, then the power supply of the circuit stops working correct.The 3,3V supply is not the problem but the 5V supply for the current monitoring is it. It consisting of a 7812 and a 7805 connected in series plus a 1N4001 diode, so it is able to handle up to 40V input from the solar cell but needs at minimum 8,5V input to give correct 5V output.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14233"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2128.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jb79&#039;s picture" title="jb79&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Sat, 10/08/2013 - 02:31.</div>
    <div class="content">
     <p>After installing a modified script that only sends data when the solar voltage is greater than 12V it looks better. The only problem is that the actual power for AC and DC side are frozen, so they will count for the kwhd values.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14238"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 10/08/2013 - 09:48.</div>
    <div class="content">
     <p>That is a &quot;feature&quot; of emoncms. It joins the dots. To get around that, you need to send a manufactured final value of zero in the process of shutting down, and a manufactured first value of zero as you start up before sending true readings again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14483"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2128.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jb79&#039;s picture" title="jb79&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Thu, 12/09/2013 - 13:26.</div>
    <div class="content">
     <p>Ok when I dismount it next time, I&#39;ll try to insert something like this to ensure that I always get a clear 0 value in the time the voltage is below 12V from evening to morning and don&#39;t have to transmit and store 0&#39;s all the night:</p>
<p>if (actual_voltage &gt;12V) send_values ();</p>
<p>else</p>
<p>{ if (old_voltage!=0)</p>
<p>&nbsp; { old_voltage=0;</p>
<p>&nbsp; &nbsp; actual_voltage=0;&nbsp; // also set all other values to 0 before transmitting them, voltage is only the example.</p>
<p>&nbsp;&nbsp;&nbsp; send_values ();</p>
<p>&nbsp; }</p>
<p>&nbsp;&nbsp; else old_voltage=0;</p>
<p>}</p>
<p>&nbsp;</p>
<p>I know that the syntax isn&#39;t correct, this is only for a better understanding of the script!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15110"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX not sending all the time creating wrong values in EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 12/09/2013 - 13:39.</div>
    <div class="content">
     <p>And you need to make sure you send a zero first when waking up - I don&#39;t think what you have above will necessarily do that. The easiest place for that will be in setup( ) of course.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2643"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-8l4zJQHXaIJh5jmWX_SrGhVD0cO7wQdqF_b6JWBNz_g" value="form-8l4zJQHXaIJh5jmWX_SrGhVD0cO7wQdqF_b6JWBNz_g"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
