<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10570 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:31:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonTX V3.4 which continuous sketch for Grid, PV &amp; HW diversion? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonTX V3.4 which continuous sketch for Grid, PV &amp; HW diversion?</h3>
        <span class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Tue, 05/05/2015 - 18:38</span>
        <div class="content"><p>i need a continuous sketch to monitor Grid power, Solar Generation, 2 divert loads and keep track of 3 temperatures. It also needs different phasecal&nbsp;values per CT. The power&nbsp;diversion is already covered by a different system.</p>
<p>So far I&#39;ve tried the continuous monitoring with totals sketch&nbsp;from GIT but it seems to stop working when the programmer is unplugged, and it doesn&#39;t include voltage reporting which makes calibration with a single meter difficult.</p>
<p>I&#39;ve also&nbsp;tried the MK2PV diverter sketch which is under reporting the standby house power by about 1/2&nbsp;and I think lacks the code for 3 temperature sensors.</p>
<p>can anyone suggest a sketch to use as a basis for this system?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10574.html" class="topic-previous" title="Go to previous forum topic">‹ Custom hardware</a>
              <a href="10553.html" class="topic-next" title="Go to next forum topic">EmonTX shortest sleep time ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-30125"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 05/05/2015 - 22:09.</div>
    <div class="content">
     <p>I don't believe there is a ready-made sketch that suits your needs. As Robin suggested in another thread, you will probably have to develop it yourself, following the method he outlined.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30126"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Tue, 05/05/2015 - 22:16.</div>
    <div class="content">
     <p>That is very true, I just would like suggestions with which one to start.</p>
<p>Right now I&#39;m playing with phasecal, and a resistance heater&nbsp;trying to work out the optimum value to use&nbsp;with not much convincing success so far. My next step is to switch off all the house breakers and just leave the test rig on in case it gives me better results. With the default value of 1.0 my power overnight was about half of what I expect to be metered despite calibrating power and voltage with the heater&nbsp;previously&nbsp;so something isn&#39;t working right</p>
<p>As power diversion rather than power measurement was the focus of this sketch I&#39;m wondering whether it is the best starting block.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30127"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 05/05/2015 - 23:09.</div>
    <div class="content">
     <p>If you need a voltage measurement, and temperatures, you just might be better looking at MartinR's PLL sketch and its derivatives. Like Robin's 'continuous' sketch, this too was originally intended for energy diversion, and the original caters for only two CTs and one temperature. It will be easy enough to remove the power diversion, but rather harder to add 2 more CTs and a two temperatures, and (presumably) kWh totals.</p>
<p>Do bear in mind that at small currents, the phase error of the YHDC CT varies markedly, and if you find you need to have accurate current measurement over a very wide range, you might find you must upgrade to a better CT.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30129"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Wed, 06/05/2015 - 02:29.</div>
    <div class="content">
     <p>Not sure if these are any good, you might find them helpful in modifying your own sketch, but I have a couple of sketches based on Robins continuous/PV diverter sketches which I have modified to read 4 CTs and a single V sensor;</p>
<p><a href="https://github.com/sumnerboy12/hardwicke">https://github.com/sumnerboy12/hardwicke</a></p>
<p>​These also report sensor readings by MQTT which may be of interest?</p>
<p>No temperature sensors sorry, I would be wary of trying to do too much with a single Arduino tho. Can you chuck another Arduino next to your HWC for measuring temps? That is what I have done (see the mqtt_heating3 sketch).</p>
<p>Cheers (from a fellow kiwi ;))</p>
<p>Ben</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30130"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Wed, 06/05/2015 - 02:32.</div>
    <div class="content">
     <p>Hi Ben,</p>
<p>good to see I&#39;m not the only one down here that is playing with these things. I&#39;ve finished my sketch work for today so I&#39;ll take a look tomorrow. Thanks for posting!</p>
<p>Cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30131"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Wed, 06/05/2015 - 02:36.</div>
    <div class="content">
     <p>Robert,</p>
<p>it may well be phase errors at low readings that will screw me up here. Whilst I have a 60Amp main feed the background consumption according to my bill is in the 200-300 watt range and this is proving very different to measure accurately. I may try making a load in this range from conventional light bulbs and then seeing if after calibration of power factor if I can play with the other values to make the readings sensible. I was advised by Glyn to stick with the standard sensor however this may prove difficult to get the results I need. I did look what else was available down here thats sensibly priced&nbsp;and drew a blank</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30132"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Wed, 06/05/2015 - 03:53.</div>
    <div class="content">
     <p>Robert, sheppy,</p>
<p>Adding more temperature sensors to Martin&#39;s PLL sketch is really quite easy - even a rusty programmer like me managed it.</p>
<p>Sheppy, if you are interested I can dig out the sketch I made although not until next week, we are away at the moment. One thing I did do was to ignore the id&#39;s of the sensors in the arduino and work out which one was which in emoncms. This is easy to do by dipping them one by one into cold water and identifying their input number in emoncms. I can&#39;t remember now who suggested this on the forum but from a coding and setup perspective it&#39;s very easy. Anyway, let me know if you need my version of Martin&#39;s sketch which has 5 temperatures and could take more just by increasing an array size.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30133"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Wed, 06/05/2015 - 04:19.</div>
    <div class="content">
     <p>Yes please, if only for information. A week ago I&#39;d never touched this stuff so the learning curve has been vertical.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30134"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX V3.4 which continuous sketch for Grid, PV & HW diversion?</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Wed, 06/05/2015 - 04:40.</div>
    <div class="content">
     <p>Robin,</p>
<p>sadly I think its the phase errors at low current that are screwing me up. My house power overnight according to the utility company&nbsp;is 0.3KWh yet the sketch reports around 180W. I&#39;ve tried calibrating at 750W which is the lowest setting of my fire and despite it reporting within a couple of watts&nbsp;it hasn&#39;t really helped. I guess I&#39;ll have to try using several old school light bulbs to see if I can get it anywhere near with lower currents. Currently if I get a glass of water from the fridge it apparently consumes over&nbsp;50watts&nbsp;just to operate the solenoid and turn on 3 LED&#39;s!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10570"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-KFGQzmM84ZBny4jBhZ471jQG2TQtVrTyyaSjfH9xY8g" value="form-KFGQzmM84ZBny4jBhZ471jQG2TQtVrTyyaSjfH9xY8g"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
