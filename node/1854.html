<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/1854 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:05:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Adding RFM12B to my GTI | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Adding RFM12B to my GTI</h3>
        <span class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Tue, 08/01/2013 - 17:45</span>
        <div class="content"><p>Have started to play with an idea that it may be possible to add RFM12B to my GTI to provide on line information to emoncms.</p>
<p>As brought to my attention by Jorg our german friends have written an open source code for standard GTI design which&nbsp;seems to be&nbsp;very well commented and easy to adapt to any standard GTI (like powerjack, greenpower etc...). The GTI is based on ATMEGA 8 variant and therefore very easy to program with tools we are familiar with from this board.</p>
<p>As the programming happens using almost standard SPI interface this same interface is almost there for jeelabs RFM12B board - only Chip Select (SEL) signal is needed additionally. Current&nbsp;firmware for GTI uses PortD 2 for led 3 - normally indicating power on which could be &quot;stolen&quot; for RF12 CS and hence also showing Chip Select activity.</p>
<p>So hardware wise the wiring could be the following using almost standard plug in connection.<br />
	<img alt="" src="../../../www.macmadigan.com/ilp/rfm12togti.jpg" style="width: 289px; height: 214px;" /></p>
<p>// PortD&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 = EIN, 0 = AUS<br />
	#define RELAIS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1 // Eingangsrelais<br />
	#define LED3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2 // gr&uuml;n, Power<br />
	#define LED2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3 // gr&uuml;n, MPPTracker +<br />
	#define LED4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4 // gr&uuml;n, MPPTracker -<br />
	#define LED1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5 // rot, Fehler</p>
<p><strong>Next challenge would be to find out how to implement &quot;send only&quot; code for RFM12B without jeelibs. Any suggestions to which direction to look for this kind of code ?</strong></p>
  <div class="forum-topic-navigation clear-block">
          <a href="1968.html" class="topic-previous" title="Go to previous forum topic">‹ How to Calibrate?</a>
              <a href="1628.html" class="topic-next" title="Go to next forum topic">Reading Blog posts on iPad ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-8990"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Adding RFM12B to my GTI</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Tue, 08/01/2013 - 19:22.</div>
    <div class="content">
     <p>There&#39;s transmit only RFM12B code that doesn&#39;t use JeeLib (or IRQ) buried in my sketch here..</p>
<p><a href="1535.html">http://openenergymonitor.org/emon/node/1535</a></p>
<p>it should be fairly easy to pull out the functions you need</p>
<p>-martin</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8992"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Adding RFM12B to my GTI</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Tue, 08/01/2013 - 19:56.</div>
    <div class="content">
     <p>Excellent - will have a look at your source when with a bit more time...</p>
<p>To me this would be a giant leap to be able to have virtually any standard&nbsp;GTI&nbsp;to deliver monitoring info feed In to emoncms.org.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8994"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Adding RFM12B to my GTI</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 08/01/2013 - 20:17.</div>
    <div class="content">
     <p>Another idea would be to use a standard Jeenode (or something similar) and connect this via SPI (or bit-banged I&sup2;C or Uart) to the GTI as an RF gateway. At the moment I have an LCD connected to the ISP adapter, but as Petri says, a direct &#39;link&#39; to emoncms would be perfect!!!</p>
<p>BR, J&ouml;rg.</p>
<p>PS: If someone else here is interested in &#39;open source&#39; firmware for a number of chinese GTIs, just contact me (or Petri) or take a look here <a href="http://www.daswindrad.de/forum/viewtopic.php?f=19&amp;t=860&amp;start=90">http://www.daswindrad.de/forum/viewtopic.php?f=19&amp;t=860&amp;start=90</a> (sorry, only in german).</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9406"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Adding RFM12B to my GTI</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Sat, 26/01/2013 - 15:52.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Finally had time to look the code from MartinR - simplified it to a RFM12B sending module only. Then realized that it needs SPI library implementation. Anyway the packet sender routine is the key information to implement standalone. Copy it here in case anyone else needs to understand how emontx sends the data to emoncms.</p>
<p>rfm_write(0x8228); // OPEN PA<br />
	&nbsp; rfm_write(0x8238);</p>
<p>&nbsp; digitalWrite(RFMSELPIN,LOW);<br />
	&nbsp; SPI.transfer(0xb8); // tx register write command<br />
	&nbsp;<br />
	&nbsp; while(txstate&lt;13)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; while(digitalRead(SDOPIN)==0); // wait for SDO to go high<br />
	&nbsp;&nbsp;&nbsp; switch(txstate)<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 0:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 1:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 2: next=0xaa; txstate++; break;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 3: next=0x2d; txstate++; break;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 4: next=800; txstate++; break; // Group ID<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 5: next=30; txstate++; break;&nbsp; // node ID<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 6: next=size; txstate++; break;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 7: next=data[i++]; if(i==size) txstate++; break;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 8: next=(byte)crc; txstate++; break;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 9: next=(byte)(crc&gt;&gt;8); txstate++; break;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 10:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 11:<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; case 12: next=0xaa; txstate++; break; // dummy bytes (if &lt;3 CRC gets corrupted sometimes)<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; if((txstate&gt;4)&amp;&amp;(txstate&lt;9)) crc = _crc16_update(crc, next);<br />
	&nbsp;&nbsp;&nbsp; SPI.transfer(next);<br />
	&nbsp; }<br />
	&nbsp; digitalWrite(RFMSELPIN,HIGH);<br />
	&nbsp; rfm_write( 0x8208 ); // CLOSE PA</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9421"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Adding RFM12B to my GTI</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Sat, 26/01/2013 - 20:42.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Maybe this could work as basis for sending without SPI ...&nbsp;</p>
<p><a href="https://www.argentdata.com/files/RF12B_code.pdf">https://www.argentdata.com/files/RF12B_code.pdf</a></p>
<p><a href="http://loee.jottit.com/rfm12b_and_avr_-_quick_start">http://loee.jottit.com/rfm12b_and_avr_-_quick_start</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/1854"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-CvnKlHVtpfVFACw-GKkT6fwiGSQrG1CnDmw5KU1gofI" value="form-CvnKlHVtpfVFACw-GKkT6fwiGSQrG1CnDmw5KU1gofI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
