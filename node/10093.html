<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emonhub Write to local sqlite database rather than post to web-target | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/5">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emonhub Write to local sqlite database rather than post to web-target</h3>
        <span class="submitted">Submitted by <a href="/emon/user/7613" title="View user profile.">marks</a> on Wed, 28/01/2015 - 03:26</span>
        <div class="content"><p>Hi All,<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;I&#39;d like if possible to write from emonhub to a local sqlite database rather than posting to a &quot;web&quot; database, I guess in a similar way to the SMA Inverter SBFspot&nbsp;application.</p>
<p>I&#39;ve read through alot of threads such as this one:<br />
<a href="http://openenergymonitor.org/emon/node/10090" title="http://openenergymonitor.org/emon/node/10090">http://openenergymonitor.org/emon/node/10090</a></p>
<p>And the various github codebases (there are so many)...<br />
<a href="https://github.com/emoncms/development/tree/master/experimental/emon-py" title="https://github.com/emoncms/development/tree/master/experimental/emon-py">https://github.com/emoncms/development/tree/master/experimental/emon-py</a></p>
<p>My ideal scenario I guess is for there to be a &quot;new&quot; reporter which writes to a local sqllite db, I could then grab the data out and do my own mashups.</p>
<p>Can anyone help writing this? &nbsp;I am happy to come up with a DB schema, I just can&#39;t for the life of my wrap my head around python. &nbsp;I have a feeling it would be 20-30 minutes for someone with the know-how, but after many hours I am still a bit lost.</p>
<p>All I am after is the reporter script to be written to write additionally to a local sqllite db. &nbsp;I figure timestamp, ID, val1, val2, val3, val4, val5, val6&nbsp;is all that is needed to be dumped via the reporter into the db.</p>
<p>My long-term goal is to try to come up with some smart &quot;big-data&quot; like algorithms which will go through the data, and assess patterns of load-sequences and then come up with reports such as &quot;Wednesday, 7am&nbsp;did you enjoy your toast?&quot;</p>
<p>Any thoughts are welcome</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/10157" class="topic-previous" title="Go to previous forum topic">‹ Send date from Emonhub to EmonGLCD</a>
              <a href="/emon/node/5289" class="topic-next" title="Go to next forum topic">emonHub development - increase in scope of values over rfm network  ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-27192"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub Write to local sqlite database rather than post to web-target</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Wed, 28/01/2015 - 14:46.</div>
    <div class="content">
     <p>Interesting project,</p>
<p>Originally emonHub&nbsp;was planned to have a persistent&nbsp;&quot;buffer&quot; option&nbsp;using mySQL, but was &quot;shelved&quot; to keep emonHub&nbsp;&quot;SD friendly&quot; as a hdd would be required due to increased disk writes, It&#39;s return hasn&#39;t been entirely ruled out&nbsp;yet but once the step to installing a database and hdd is made, a full local&nbsp;emoncms&nbsp;install&nbsp;is not far off which&nbsp;negates&nbsp;the need for persistent storage. here is a link to the removed code it may be of use&nbsp;<a href="https://github.com/emonhub/emonhub/commit/3666d45acc5eedaa1ba66efd10c5190ef6c35df6">https://github.com/emonhub/emonhub/commit/3666d45acc5eedaa1ba66efd10c5190ef6c35df6</a>&nbsp;although technically just a buffer if the data is never sent on, then it will just accumulate.</p>
<p>Visualising the data would be easier with emoncms&nbsp;and I can&#39;t help but wonder if the gains over a full local&nbsp;emoncms install justify&nbsp;<span style="line-height:20.7999992370605px">a bespoke solution even though it&nbsp;may not meet your requirements exactly.</span></p>
<p><span style="line-height:20.7999992370605px">There is also an <a href="http://openenergymonitor.org/emon/node/5736">emoncms&nbsp;profile module</a> by Eric_AMANN&nbsp;that compares periods of use for patterns etc aimed at recognising energy saving opportunities but the concept could fit your purpose too, it adds the ability to mask abnormal readings which could help.</span></p>
<p><span style="line-height:20.7999992370605px">What you propose is do&#39;able&nbsp;but may not be the only route, to aid with some debugging sometime ago I put together a &quot;csv&quot;&nbsp;reporter which was quite easy and the resulting file could be opened directly in excel which may be better for pattern recognition by number crunching. This too was write intensive so not a permanent solution&nbsp;either.</span></p>
<p>My programming skills are&nbsp;&quot;minimal&quot; but&nbsp;if I can help navigate the emonHub&nbsp;architecture I will.&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27219"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/7613" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="marks&#039;s picture" title="marks&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub Write to local sqlite database rather than post to web-target</h3>

    <div class="submitted">Submitted by <a href="/emon/user/7613" title="View user profile.">marks</a> on Thu, 29/01/2015 - 00:09.</div>
    <div class="content">
     <p>Hi Paul and thanks for replying!</p>
<p>Eric&#39;s profile module looks very interesting and admittedly is not that dissimilar to where my mind was wandering! &nbsp;In my head, my raw data visualisation tool was Excel with powerpivot and powerview, with analytics to come later.</p>
<p>I have read with interest the attempts to reduce the writing to SD cards and do understand why the components are built the way they are built.</p>
<p>I have a HDD connected to my pi and am less worried about writes (it&#39;s actually an old 20GB ssd). &nbsp;I documented my complete process of getting the pi and emonhub to work reliably with an external hard drive and it is very straightforward. &nbsp;Do you think this is of value to anyone? if so, any suggestions as to where I should post it?</p>
<p>I think I understand *just* enough about your referenced python code with the mysql in-memory buffer to hack it into place for my intent, so I&#39;ll look into that tonight. &nbsp;Ideally structure wise and for re-usability by others I was mentally approaching it as a reporter module. &nbsp;</p>
<p>Do you think I should attempt to go with changes to the buffer module with your previous&nbsp;or do you think making it a reporter is the best approach?</p>
<p>I&#39;d also like to see your csv &quot;reporter&quot; that you wrote if that&#39;s ok, is it on github?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27222"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub Write to local sqlite database rather than post to web-target</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Thu, 29/01/2015 - 01:30.</div>
    <div class="content">
     <p><em>I have a HDD connected to my pi and am less worried about writes (it&#39;s actually an old 20GB ssd).&nbsp;</em></p>
<p>I was led to believe ssd&#39;s can suffer too to a lesser degree as do usb sticks, I thought it was just the spinning disks that escaped the &quot;finite number of writes&quot; issues.</p>
<p>The reporter maybe the best way to go, I was just throwing&nbsp;ideas out there and mentioned the &quot;buffer option&quot; as a source of some code for ideas and to explain emonHub&#39;s current take on persistent storage.</p>
<p>I don&#39;t think the &quot;csv reporter&quot; made it to git,(heres a discussion but no code I&#39;m afraid&nbsp;<a href="https://github.com/emonhub/emonhub/issues/41" style="line-height: 20.7999992370605px;">https://github.com/emonhub/emonhub/issues/41</a>)<span style="line-height:1.6">&nbsp;it was in the very early days,of emonHub but I will have a look to see if I still have</span><span style="line-height:1.6">&nbsp;a local copy tomorrow. The concept wa</span><span style="line-height:1.6">s very simple so should be easy to replicate if not.</span></p>
<p><span style="line-height:1.6">Paul</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27556"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/7613" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="marks&#039;s picture" title="marks&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub Write to local sqlite database rather than post to web-target</h3>

    <div class="submitted">Submitted by <a href="/emon/user/7613" title="View user profile.">marks</a> on Tue, 10/02/2015 - 02:58.</div>
    <div class="content">
     <p>Hi Paul!</p>
<p>Thanks for your comment on the SSD, I *assumed* that linux would &quot;sort out* the trim, I found some references to a aapt-get&nbsp;hrparam and have now configured trim for the SSD!!!</p>
<p>How did you go with the CSV reporter code? &nbsp;Did you manage to find it?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27559"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonhub Write to local sqlite database rather than post to web-target</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Tue, 10/02/2015 - 11:25.</div>
    <div class="content">
     <p>Actually I couldn&#39;t find very much at all, one of the pit falls of using git is not all versions of all files are readily available for searching etc. I did find a text file with a basic implementation, it&#39;s a bit messy and probally not of use but I&#39;ve attached it anyway.&nbsp;maybe you can pick the bones and find something useful.</p>
<p>The basic theme is to &quot;write to file&quot; rather than &quot;send url request&quot; the biggest difference is probably that the data frames retrieved &nbsp;from the buffer must each be formatted&nbsp;into its own line&nbsp;rather than grouped into one &quot;bulk&quot; string.</p>
<p>I&#39;ve attached a couple of links about ssd as they are not cheap and can be ruined quite easily unless extremely careful, For me the risk &amp;&nbsp;price doesn&#39;t justify the minimal&nbsp;gain (for our application), spinning discs are so cheap and once since they are spinning 24/7&nbsp;the number of writes is almost&nbsp;irrelevant and the life doesn&#39;t deteriorate so much as most wear is done at spin up/down.</p>
<p><a href="http://haydenjames.io/increase-performance-lifespan-ssds-sd-cards/">Increase Performance and lifespan of SSDs &amp; SD Cards&nbsp;</a></p>
<p><a href="http://93.93.128.176/forums/viewtopic.php?t=97378&amp;p=676283">Two questions: boot from SSD, run program on startup.</a></p>
<p>I am&nbsp;actually&nbsp;very much in favor of ssd&#39;s&nbsp;generally, I have them&nbsp;on all my pc&#39;s and laptop, but stick with spinning disk on the Pi&#39;s because it is better suited to the constant stream of&nbsp;frequent&nbsp;writes, if it was being used as a workstation or a public server with heavy random read activity I would definitely&nbsp;reconsider.&nbsp;&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/10093"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-R7DdAF4-hwTEpHkU3qRhUif5mn8l3AoXH-8TStMjKmg" value="form-R7DdAF4-hwTEpHkU3qRhUif5mn8l3AoXH-8TStMjKmg"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>

</html>
