<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/479 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:18:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Monitoring multiple emonTx units | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Monitoring multiple emonTx units</h3>
        <span class="submitted">Submitted by <a href="../user/835.html" title="View user profile.">geoffs</a> on Fri, 09/03/2012 - 13:01</span>
        <div class="content"><p>Are there plans to allow for multiple emonTx to be monitoried through a single emonBase unit?</p>
<p>I currently want to monitor 3 or 4&nbsp; power points but they are located some distance from each other.</p>
<p>&nbsp;</p>
<p>I&#39;ve seen (overpriced) commercial units that will allow 3 separate monitor points via a single controller.E</p>
<p>EDIT: OK a bit more reading has answered my question :-)</p>
  <div class="forum-topic-navigation clear-block">
          <a href="696.html" class="topic-previous" title="Go to previous forum topic">‹ fundamental but important question re switching controllers and utility meters</a>
              <a href="674.html" class="topic-next" title="Go to next forum topic">Arduino-Energy-Monitor ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-3348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitoring multiple emonTx units</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 09/03/2012 - 13:57.</div>
    <div class="content">
     <p>Yes, it&#39;s possible. Just set the emonTx&#39;s to all be on the same frequency, network with individual node ID&#39;s. Then tell the emonBase to separate out the wireless data from the separate emonTx&#39;s</p>
<p>We have an emonBase example using the EtherShield library, this library in no longer supported. We have moved to using the EtherCard (see latest <a href="https://github.com/openenergymonitor/NanodeRF">NanodeRF github examples</a>), it shouldn&#39;t be too difficult to move the example to use the EtherCard library.&nbsp;<a href="https://github.com/openenergymonitor/NanodeRF_ethershield/tree/master/nanodeRF_recieve_multiple_emontx">https://github.com/openenergymonitor/NanodeRF_ethershield/tree/master/nanodeRF_recieve_multiple_emontx</a></p>
<p>The code example is just a quick demo and could be improved. It would be great to get a page on the website detailing how more than emonTx can be used with a single emonBase. We would be very graceful if in the future maybe you could write such a page.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3350"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andygodber&#039;s picture" title="Andygodber&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitoring multiple emonTx units</h3>

    <div class="submitted">Submitted by Andygodber (not verified) on Fri, 09/03/2012 - 14:57.</div>
    <div class="content">
     <p>Im&nbsp;using one Base to read from 3 TX&#39;s.</p>
<p>First is for Elect PV generated, second is for Import/Export, third is for water/gas.</p>
<p>Im using the multi Pachube/EmonCMS sketch provided by by Francois which solved my Pachube posting issues, documented in thread:&nbsp;<a href="376.html">http://www.openenergymonitor.org/emon/node/376</a></p>
<p>The bits I changed to cope with with multiple TX&#39;s are basically to make sure each TX has a different node ID.</p>
<p>Then in the Base code, ensure you have code to extract the node ID from the RF:</p>
<p>byte emontx_nodeID=rf12_hdr &amp; 0x1F; &nbsp;&nbsp;</p>
<p>Finally, in your main processing code, use logic to do what you want based on the nodeID being sent:</p>
<p>&nbsp;</p>
<div>
	&nbsp;if (emontx_nodeID ==10)&nbsp;</div>
<div>
	&nbsp; &nbsp;{</div>
<div>
	&nbsp; &nbsp;grid=emontx.power;&nbsp;</div>
<div>
	&nbsp; &nbsp;batt=emontx.battery;</div>
<div>
	&nbsp; &nbsp;}</div>
<div>
	&nbsp; &nbsp; &nbsp;if (emontx_nodeID ==11) water=emontx.irms;&nbsp;</div>
<div>
	&nbsp; &nbsp; if (emontx_nodeID ==12) generated=emontx.power; &nbsp;generated=abs(generated); &nbsp;if abs(generated&lt;10) generated=0;<span class="Apple-tab-span" style="white-space:pre"> </span>//remove noise</div>
<div>
	&nbsp;</div>
<div>
	My code is really dirty (look at how many abs functions Ive got !), but you get the gist of it.</div>
<div>
	&nbsp;</div>
<div>
	Things to be aware of:</div>
<div>
	1. The more devices you have transmitting, the more risk of &#39;losing&#39; data (there is a post somewhere about how &#39;crowded&#39; 433Mhz and 868Mhz bandwidths are, with RF12B&#39;s getting swamped).</div>
<div>
	2. The RF is all asynchronous, so there is a risk that you could get two nodes transmitting at exactly the same time and you miss one of them in your code (I see this happen, even with only 3 TX&#39;s).</div>
<div>
	3. Increasing/keeping the transmission intervals different can help reduce 2. Im mostly using realtime transmissions, so thats&nbsp;why I suffer from loss, but its not important.</div>
<div>
	&nbsp;</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4323"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitoring multiple emonTx units</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Wed, 09/05/2012 - 14:57.</div>
    <div class="content">
     <p class="western" style="margin-bottom: 0cm">Hi, I&nbsp; would also like to build monitor with multi emontx towards on single emonbase. I currently have two emontx and one NanodeRF but no luck adapting the standard <em>NanodeRF_Power_RTCrelay_GLCDtemp yet</em>. The code will work with either emonTx <u><strong>node id</strong></u> 10 or 11 individually defined in // 1 on receive .&nbsp;&nbsp; I think my problem is blue colored code:&nbsp; Thanks in advance</p>
<p class="western" style="margin-bottom: 0cm;">&nbsp;</p>
<p class="western" style="margin-bottom: 0cm;">All suggestions welcome:</p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">if (rf12_recvDone()){ </font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">if (rf12_crc == 0 &amp;&amp; (rf12_hdr &amp; RF12_HDR_CTL) == 0)</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">{</font></p>
<p class="western" style="margin-bottom: 0cm;"><font size="1" style="font-size: 8pt;">int node_id = (rf12_hdr &amp; 0x1F);</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">if (node_id == 10) // EMONTX</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">{</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">emontx = *(PayloadTX*) rf12_data; // get emontx data</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">Serial.println(); // print emontx data to serial</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">Serial.print(&quot;1 emontx packet rx&quot;);</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">last_rf = millis(); // reset lastRF timer</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">delay(50); // make sure serial printing finished</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">// JSON creation: JSON sent are of the format: {key1:value1,key2:value2} and so on</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">str.reset(); // Reset json string </font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">str.print(&quot;{rf_fail:0&quot;); // RF recieved so no failure</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">str.print(&quot;,power1:&quot;); str.print(emontx.power1); // Add power reading</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">str.print(&quot;,power2:&quot;); str.print(emontx.power2); // Add power reading</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">str.print(&quot;,power3:&quot;); str.print(emontx.power3); // Add power reading </font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">str.print(&quot;,voltage:&quot;); str.print(emontx.voltage); // Add emontx battery voltage reading</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">data_ready = 1; // data is ready</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">rf_error = 0;</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">}</font></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">if (node_id == 11) // second EMONTX</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">{</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">emontx2 = *(PayloadTX2*) rf12_data; // get second emontx2 data</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">Serial.println(); // print second emontx2 data to serial</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">Serial.print(&quot;2 emontx2 packet rx&quot;);</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">last_rf = millis(); // reset lastRF timer</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">delay(50); // make sure serial printing finished </font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">// JSON creation: JSON sent are of the format: {key1:value1,key2:value2} and so on</font></span></p>
<p class="western" style="margin-bottom: 0cm">&nbsp;</p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">str.reset(); // Reset json string </font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">str.print(&quot;{rf_fail:0&quot;); // RF recieved so no failure</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">str.print(&quot;,power11:&quot;); str.print(emontx2.power11); // Add power reading</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">str.print(&quot;,power12:&quot;); str.print(emontx2.power12); // Add power reading</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">str.print(&quot;,power13:&quot;); str.print(emontx2.power13); // Add power reading </font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">str.print(&quot;,powerFactor:&quot;); str.print(emontx2.powerFactor); // Add emontx powerFactor reading</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">str.print(&quot;,MainsVoltage:&quot;); str.print(emontx2.Vrms); // Add emontx mainvoltage reading</font></span></p>
<p class="western" style="margin-bottom: 0cm">&nbsp;</p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">data2_ready = 1; // data2 is ready</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">rf_error = 0;</font></span></p>
<p class="western" style="margin-bottom: 0cm"><span style="color:#0000ff;"><font size="1" style="font-size: 8pt">}</font></span></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">if (node_id == 20) // EMONGLCD </font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">{</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">emonglcd = *(PayloadGLCD*) rf12_data; // get emonglcd data</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">Serial.print(&quot;5 emonglcd: &quot;); // print output</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">Serial.println(emonglcd.temperature); </font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">emonglcd_rx = 1; </font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">}</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">}</font></p>
<p class="western" style="margin-bottom: 0cm"><font size="1" style="font-size: 8pt">}</font></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitoring multiple emonTx units</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 10/05/2012 - 10:18.</div>
    <div class="content">
     <p>Hi Peter,</p>
<p>What you have posted looks like it should work, please post up the whole sketch, it would be good to check what you have at the beginning and in setup.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4360"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PeterN&#039;s picture" title="PeterN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitoring multiple emonTx units</h3>

    <div class="submitted">Submitted by PeterN (not verified) on Sat, 12/05/2012 - 08:00.</div>
    <div class="content">
     <p>It&#39;s works in part for two emontxs nodes when certain code was omitted&nbsp; e.g. // code is inserted&nbsp; to remove the one line of code for emontx2 nodeid 11 see attached file in&nbsp; the section title &quot;// 1) On RF receive&quot; . Search &quot;change peter&quot; to see my changes elsewhere in the basic template.</p>
<p>Once I activated&nbsp; &quot; //str.print(&quot;,MainsV:&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(emontx2.Vrms); &quot;&nbsp; line of code for emontx2 by removing the // the result in&nbsp; emoncms was inputs rf_fail =1 and com port output was blank. I tried block another line of code in str.print for emontx2 and open this one (no luck) just to prove it wasn&#39;t due to the number of lines of str.print,&nbsp; it seems to be this one line of code mentioned above causing issue.</p>
<p>Another problem I observed seems to be the delay in getting feeds or updates when second emontx2 was added, seems to my untrained eye that there may be some congestion or overlap. I will monitor the number of rf_fails and other data towards cms.</p>
<p>My emoncms is quiet a mess now with many unused inputs etc. is there an easy way to reset all data or should I just change to new database.</p>
<p>Code attached for emontx and emonbase.</p>
<p>Thanks for support.&nbsp;</p>
<p>Cheers</p>
<p>Peter</p>
<p>P.S. Hope I&#39;m clear above</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/479"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-iRHvkY3T2c3RV80x_59j2eJdZhoWB67hLJB3tCbbEDM" value="form-iRHvkY3T2c3RV80x_59j2eJdZhoWB67hLJB3tCbbEDM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
