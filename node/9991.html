<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/9991 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:38:51 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Can emonTx arduino software handle 3 AC and 3 CT inputs? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>
        <span class="submitted">Submitted by <a href="../user/7515.html" title="View user profile.">KWells</a> on Sun, 11/01/2015 - 00:32</span>
        <div class="content"><p>I am looking to build an emonTX with RFM12B or similar wireless link that can monitor the following scenarios and I am not sure if the&nbsp;EmonLib can handle the processing load:</p>
<p>1) 3 CT inputs and 3 AC inputs, to monitor one 3 phase 208VAC load.</p>
<p>2) 4 CT inputs and 2 AC inputs, to monitor two different 240VAC split phase circuits like PV generation and utility power.</p>
<p>I am interested in real and apparent power in both cases, hence the need for AC voltage monitoring on each phase. Any feedback is greatly appreciated. I found the examples in the EmonLib software but I can&#39;t find a description of the limitations.</p>
<p>Sincerely,</p>
<p>Kevin</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10002.html" class="topic-previous" title="Go to previous forum topic">‹ emonHub RX frame node id outside scope</a>
              <a href="9985.html" class="topic-next" title="Go to next forum topic">Has emonTH died? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26658"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 11/01/2015 - 01:46.</div>
    <div class="content">
     <p>You'll need to read emonLib.cpp<br />
CalcVI( ) uses voltage and current pins defined by inPinV and inPinI and those are set up by current( ) and voltage( ).<br />
So provided you give those the right pin numbers, it should do the right calculation. Of course, you must have a separate instance of EnergyMonitor for each leg/phase.</p>
<p>A good starting point for the 3-phase unit might be an emonTx V2, which has all the analogue I/O pins available on headers.</p>
<p>But do you actually need to monitor both legs? Most of your fellow users report that the voltage balance between the two legs is very good and feel they don't need to monitor both. It would be very useful to me to know what you measure in terms of the balance, and its variation.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26659"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7515.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7515.jpg" alt="KWells&#039;s picture" title="KWells&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>

    <div class="submitted">Submitted by <a href="../user/7515.html" title="View user profile.">KWells</a> on Sun, 11/01/2015 - 05:44.</div>
    <div class="content">
     <p>Thank you for your reply. I will give it a try. I looked at the EmonLib.ccp code and examples. That library is pretty awesome. I have no experience actually running any example code on an emonTX. I need to get my hands on an emonTV V3.4 smt board and run some tests to determine how much processing time will be consumed by the three instances. I am hoping there are enough cycles left to interface with a pair of MCP23S17 i/o expanders to the SPI bus to handle a 3 digit seven segment display and some push-buttons.</p>
<p>I currently use a variety of off-the-shelf solutions to measure power and energy for PV and demand management systems. All of our projects are installed in Costa Rica. The simplest application used a single CT with a 4-to-20mA output tied to an analog PLC doing demand management. It was a 3 phase 208V PV branch circuit and a single CT with no AC voltage sensing provided good enough accuracy for the application. Our more complex projects have used web connected revenue grade meters that monitor &gt;100kW of PV on 2000A service panels. We also use micro-inverters that have web based monitoring options. The sweet spot is monitoring residential and commercial PV between 1 and 20kW, with options for load diversion. It would be nice to have a single platform solution that could be easily scaled for monitoring a variety of circuit topologies.</p>
<p>Phase voltage imbalance is not a huge problem with our PV arrays, or the loads we encounter. The grid in Central America runs a little wilder than we see in the States. I believe a simple residential installation can use one AC voltage sense input and two or four CTs without sacrificing much accuracy.</p>
<p>Larger properties with multiple units are typically fed with three phase 208V and they tap off two legs for what should be 240V split phase. That causes some issues if the loads are not equal, odd stuff like&nbsp;240V on-demand water heaters wired onto the 208V are common. As I wrote this post I took a peek at a web connected meter on a 3P 208V property and it is running 5% out of balance; a 10% imbalance is not unusual when the occupants start flipping on 5kW instant on water heaters. I am concerned that the accuracy would suffer if we only used one AC voltage sense input on the 3P 208V properties.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26662"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 11/01/2015 - 12:16.</div>
    <div class="content">
     <p>If you're looking to handle displays etc, emonLib is not the way to go. Look instead at Robin's diverter code (in fact, look at Robin's diverter if you are thinking about diversion), links on the home page <a href="../guide.html">here</a>, which runs the ADC continuously and uses interrupts to handle the conversion result. The units he sells through his website can have displays as an option. (He might even build custom units for you <img src="../../../dj9okeyxktdvd.cloudfront.net/script/Forums/Images/smiley_wink.gif"> ).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26681"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7515.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7515.jpg" alt="KWells&#039;s picture" title="KWells&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>

    <div class="submitted">Submitted by <a href="../user/7515.html" title="View user profile.">KWells</a> on Mon, 12/01/2015 - 04:19.</div>
    <div class="content">
     <p>Thank you for your reply. I need to read through Robin&#39;s load diversion project. My hope is that I can use the emonLib and the MCP23S17 arduino library without running out of processor time on a 3CT and 3AC voltage input monitor. The &#39;S17 library makes bit-banging the 16 i/o pins easy as the arduino digitalWrite and read functions. I am going to buy an emonTX this week and see if I can add some i/o routines and measure how much processor time is left. One goal is to have a unit that can act as a stand-alone power meter with an integral display to show Watts, kWhrs, Volts, and amps selected with buttons, and have the ability to connect to an optional emonLCD or emonBASE over the RF link. This would allow me to cover anything from a simple 1kW PV array to a large 208V 3P web connected application.</p>
<p>We believe load diversion or any projects with unique control requirements could be handled with an emonBASE or custom board that intercepts the RF link data from the emonTX. For instance, a simple board with a 24V relay controlled over the RFM12B link would be great for disabling air-conditioning units or kicking on an electric water heater when a PV array is producing a certain wattage.</p>
<p>I am currently working on a circuit board and enclosure design based on Glyn Hudson&#39;s&nbsp;emonTX V3.4 circuit board assembly. If I can ensure that the OEM software will work properly I will pull the trigger on the layout and have a breadboard built in parallel. The schematic is attached to this post. The design will need to meet agency approvals for the location it is applied. I am not even certain if I should post this design as it requires appropriate isolation. To your knowledge has anyone gone through the CE or UL certification process with any variation of the OEM? I am aware of the CE approval on the emonTX V3, great work. I searched and found nothing OEM related to voltage isolation safety approval. You help is much appreciated.</p>
<p>Sincerely,</p>
<p>Kevin</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26683"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 12/01/2015 - 10:00.</div>
    <div class="content">
     <p>Hi Kevin,</p>
<p>Robert is very familiar with the various forms of my Mk2 Router system for &quot;continuously&quot; monitoring the flow of &#39;real&#39; energy, and diverting any &#39;real&#39; power that is surplus.&nbsp; Since posting the initial release on this forum in July 2012, I have since set up my own business to supply suitable hardware to customers.&nbsp; Although the software is very similar, my new PCB-based version makes it easier to construct a complete 1-phase diverter system.&nbsp; I can also supply pre-built diverter systems to order.</p>
<p>Last year, I commissioned a <a href="http://mk2pvrouter.co.uk/61101.html">3-phase version</a> which runs on a new PCB.&nbsp; This uses the 6 analogue inputs of the Atmel 328P processor to monitor voltage and current on each of the three phases at the supply point.&nbsp; Although the ADC sub-processor is running as fas as it can, the occupancy of the main processor is only around 70%.&nbsp; While maintaining the regular sampling sequence, there is plenty of spare time to transmit power and voltage data via RF, and also for some Serial output.</p>
<p>Because the prime purpose of my router systems is to divert any real power that is surplus, they do not generally calculate apparent power.&nbsp; However, this feature could no doubt be included if there was a need for it.&nbsp;</p>
<p>If my 3-phase development is of interest to you, please drop me a PM, or there is an email address for general enquiries on the <a href="http://mk2pvrouter.co.uk/13779.html">Shop</a> page of my website.</p>
<p>Regards to all, Robin</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26698"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 12/01/2015 - 14:56.</div>
    <div class="content">
     <p><i>"I searched and found nothing OEM related to voltage isolation safety approval."</i><br />
My understanding is that's because the original OEM offerings were kits and there could be absolutely no control over the standard of construction, therefore any kind of approval would be impossible to obtain in practical terms. Hence the use of approved low voltage power supplies and adapters, and current transformers. </p>
<p>And having seen what some contributors have proposed, Glyn &amp; Trystan's caution is well-founded.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26714"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7515.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7515.jpg" alt="KWells&#039;s picture" title="KWells&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>

    <div class="submitted">Submitted by <a href="../user/7515.html" title="View user profile.">KWells</a> on Mon, 12/01/2015 - 18:33.</div>
    <div class="content">
     <p>Robert,</p>
<p>&nbsp; Easy to understand why all the OEM project circuit boards use AC wall adapters. I have seen a few scary designs proposed on this forum. That said, those AC wall transformers need to go to be practical for my applications. Adding phase separated wall outlets is a big expense.</p>
<p>&nbsp; Thank you for the helpful feedback. I am going to proceed with caution. My goal is a CE marked device that passes the relevant IEC safety specifications. I have someone looking into the scope of the required agency approvals. Plan is to use local independent labs for testing and prepare an in-house declaration of conformity. All this expensive testing aside, I think the most dangerous aspect of any energy monitor is instillation by DIY&#39;ers.&nbsp; &nbsp;</p>
<p>Sincerely,</p>
<p>Kevin</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26716"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7515.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7515.jpg" alt="KWells&#039;s picture" title="KWells&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can emonTx arduino software handle 3 AC and 3 CT inputs?</h3>

    <div class="submitted">Submitted by <a href="../user/7515.html" title="View user profile.">KWells</a> on Mon, 12/01/2015 - 18:39.</div>
    <div class="content">
     <p>Robin,</p>
<p>&nbsp; The MK2 looks very interesting. I need to read through all the information and get my head around the unit. I am not certain that our applications require a fast response time. I will send you an email this evening, usa time, explaining exactly what we are trying to accomplish.</p>
<p>Sincerely,</p>
<p>Kevin</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/9991"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-HKX5JpkL7LmqylPN5_OkAwajp7rgVfGh-VsbFhdqlqI" value="form-HKX5JpkL7LmqylPN5_OkAwajp7rgVfGh-VsbFhdqlqI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
