<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12120 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:10:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Pulse counter for energy meter  | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Pulse counter for energy meter </h3>
        <span class="submitted">Submitted by <a href="../user/9417.html" title="View user profile.">Ranjit</a> on Tue, 02/02/2016 - 10:42</span>
        <div class="content"><p>I am trying to make a circuit that will read pulses from energy meter, I have seen emonTH and it uses interrupt service to capture pulses. I am trying to detect pulses using an LDR for now, but LDR is giving multiple interrupt for Falling edge when ever it detects a pulse from a led source. You guys have an optical sensor, I could not get the circuit diagram of your optical sensor on your website. Which sensor is preferred to detect optical pulses? Thanks</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12030.html" class="topic-previous" title="Go to previous forum topic">‹ EmonPi schematic/board diffs, additional CTs and alternative firmware changes</a>
              <a href="3631.html" class="topic-next" title="Go to next forum topic">AC - AC adapter for Australia ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-39023"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pulse counter for energy meter </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 02/02/2016 - 11:55.</div>
    <div class="content">
     <p><a href="http://shop.openenergymonitor.com/optical-utility-meter-led-pulse-sensor/">This one</a>&nbsp;is known to work.</p>
<p>If you are using a LDR and you are seeing multiple edges, is it possible that another light source is contributing to the LDR&#39;s&nbsp;response?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39027"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9417.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ranjit&#039;s picture" title="Ranjit&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pulse counter for energy meter </h3>

    <div class="submitted">Submitted by <a href="../user/9417.html" title="View user profile.">Ranjit</a> on Tue, 02/02/2016 - 13:56.</div>
    <div class="content">
     <p>Thanks Robert, I checked your link and I have also ordered it, to check how accurately it can detect pulses on my energy meter. Can you please share its circuit diagram and components list and which transistor you guys have used. LDR that I am using might have got some interference from ambient light as it is not covered. I will try to reduce other light sources affecting LDR, and I have also bought photo transistors ST-1k3lb and 2N5777 and I am trying to figure out how to use them. Circuit diagram of this optical sensor will be helpful.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39039"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pulse counter for energy meter </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 02/02/2016 - 20:46.</div>
    <div class="content">
     <p>All the information we have is published on this website, or the linked Wiki or&nbsp;Github.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39938"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9447.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hueydriver&#039;s picture" title="hueydriver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pulse counter for energy meter </h3>

    <div class="submitted">Submitted by <a href="../user/9447.html" title="View user profile.">hueydriver</a> on Sun, 28/02/2016 - 19:56.</div>
    <div class="content">
     <p>When I&nbsp;tried to do some pulse recognition, I had some of these same issues. &nbsp;</p>
<p>Especially if you want to use logic levels, I found an LDR with a Darlington Pair transistor to work pretty well at smoothing out edges. &nbsp;This mostly worked for me if there was a visible light pulse I was detecting.</p>
<p>When I tried the IR pulse on my meter, I had to switch to an IR Photo Transistor and sacked the Darlington Pair. &nbsp;I used an arduino to read the pulses from the IR-PT, but still had trouble detecting the edges of the pulse. &nbsp;I tried several ideas and was able to improve it a little using a median filter in software. &nbsp;I started a github for it, but guess I never finished. &nbsp;It really was just a mishmash of other things I found from people.</p>
<p>Basically, as the light I was detecting changed state, because of whatever reasons (noise on the line, actual detected fluctuations), it was hard to tell when the LED had completely changed state. &nbsp;If the On was 5v and Off was 0v, there was fluctuations that happened throughout that might cause voltage to rise and fall through a threshold many times in one sample.</p>
<p>I&#39;m no expert, but if you are dealing with an analog value and trying to detect the pulse edge, what I really wanted to look in to was a software Schmitt Trigger. &nbsp;It just seemed that it answered the bill. &nbsp;Something that set two thresholds, say at 20% and 80% that were far enough apart that &#39;noise&#39; wouldnt cause a false reading of crossing the threshold.</p>
<p>If you are having trouble getting a steady wave off your sensor, there&#39;s some things to think about....</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39946"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pulse counter for energy meter </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 29/02/2016 - 00:59.</div>
    <div class="content">
     <p>What seems to work for a reed switch is polling: read the input state at regular intervals and when you&nbsp; see a suitable sequence of 0s &amp; 1s, declare an edge detected. This depends on the transitions lasting less than the polling interval, and the pulse frequency &amp; M/S ratio being suitably long in comparison to allow you to detect a stable 0 and 1 state either side of the edge.</p>
<p>What I&#39;d question if you&#39;re seeing fluctuations, is whether you had too much gain in the system?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40187"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9447.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hueydriver&#039;s picture" title="hueydriver&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pulse counter for energy meter </h3>

    <div class="submitted">Submitted by <a href="../user/9447.html" title="View user profile.">hueydriver</a> on Wed, 09/03/2016 - 00:46.</div>
    <div class="content">
     <p>I agree, there could be a problem with my system. &nbsp;</p>
<p>But just for conversations sake, what I was trying to do was separate low from high (of course). &nbsp;If I used ONE threshold, say 50%, I would assume a high value once the wave went above that. &nbsp;However, I would occasionally (or actually, quite often each period) get a blip or two below 50% as the wave climbed above that threshold. &nbsp;Nothing I tried (median filter) would take those out. &nbsp;I had a 10ms&nbsp;pulse length, I knew that, but at max current on the meter I was reading, I knew I was getting to the point where I had very little window between pulses, so I was trying to avoid timers.</p>
<p>I knew what I wanted, I just didnt know what it was called. &nbsp;As I said, the Darlington Pair cleaned everything up pretty nice, but making my photo-transistor one of them seemed a little more difficult than just putting it in software, since thats where my abilities lie.</p>
<p>Here was my thinking, assuming a 5v system and a 20% and 80% band on a Schmitt Trigger.</p>
<p>Once I came off 0 volts and climbed above 1v, I was in transition. &nbsp;I would wait until I climbed above 4v (80%) before assuming &#39;HIGH&#39;. &nbsp;Even though it was a simple system, discrete values on the sample varied quite a bit. &nbsp;I&#39;d do the same on the transition from high to low. &nbsp;I just never got around to writing the code. &nbsp;It works &#39;well enough&#39; for now....</p>
<p>I know now tho that my problem was a bunch of things. &nbsp;An op amp probably would have solved everything, including making full use of the 10-bit ADC (my max value was less than 400). &nbsp;I am not using a pull-up (or down) resistor, which I dont even know if it would help. &nbsp;A capacitor would likely help as well. &nbsp;My problem is I obviously didnt pay enough attention in school or I&#39;d know these things, so I am enjoying learning these new things 30 years later. &nbsp;</p>
<p>The same goes for my learning on the emon&nbsp;arduino shield. &nbsp;Its about getting a bare bones idea working, and then tweaking to make it better and learn as I go along. &nbsp;This month its resistors. &nbsp;Maybe in a few months I&#39;ll wade in to capacitors. :-) &nbsp;The problem is, a lot of the time &quot;good enough&quot; is settled for and its more fun to move on to the next project. &nbsp;Which is why my github&nbsp;projects are in an undecipherable state of disrepair....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12120"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-cKsoWIyOYtadZ4SwdxM7sK9AvtxrJyBpStIxRgaFQdE" value="form-cKsoWIyOYtadZ4SwdxM7sK9AvtxrJyBpStIxRgaFQdE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/12120 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:10:42 GMT -->
</html>
