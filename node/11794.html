<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11794 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:55:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>New emonpi setup with Edimax wifi dongle keeps disconnecting | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>
        <span class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Sat, 12/12/2015 - 16:44</span>
        <div class="content"><p>Hi, sorry of this is covered elsewhere; I did have a quick look but couldn&#39;t see anything matching my issue&nbsp;- if it is already covered I&#39;d appreciate&nbsp;a nudge in the right direction.</p>
<p>So... I am running an emonpi&nbsp;(rPi 2) with the latest SW image (downloaded from OEM) and an Edimax wifi dongle.</p>
<p>For some reason the wifi&nbsp;gets disconnected after a day or two which is annoying since the unit is mounted in a position whereby the only course of action seems to be to restart using a pin in the side of the unit.</p>
<p>I did alter the <strong>/etc/network/interfaces</strong> file to add the line &quot;<strong>wireless-power off</strong>&quot; but this doesn&#39;t appear to have worked.</p>
<p>I&#39;m using a BT Home Hub 5 with this. I have another Pi (doing another job) fitted&nbsp;an Edimax dongle that doesn&#39;t suffer from this problem, so I&#39;m somewhat puzzled. The wifi signal is strong and there doesn&#39;t appear to be a good reason to drop. I had assumed there was some power management at play hence my config change, but perhaps it&#39;s something different.</p>
<p>Any advice appreciated.</p>
<p>Josh</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11977.html" class="topic-previous" title="Go to previous forum topic">‹ emonTx locks up after a week or two, needs to be repowered</a>
              <a href="11997.html" class="topic-next" title="Go to next forum topic">power consumption for my house ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-36944"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 12/12/2015 - 17:26.</div>
    <div class="content">
     <p>Could it be the DHCP lease expiring? In your router, have you given it a fixed IP address?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36945"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9115.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9115.jpg" alt="jmoloney&#039;s picture" title="jmoloney&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Sat, 12/12/2015 - 17:31.</div>
    <div class="content">
     <p>Thanks for the reply. I had considered something like that but I don&#39;t think it is that - I checked the router settings and they&#39;re the standard DHCP settings.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36951"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 13/12/2015 - 09:38.</div>
    <div class="content">
     <p>See this for another way to disable power saving on the edimax&nbsp;wifi dongle.</p>
<p><a href="http://raspberrypi.stackexchange.com/questions/36714/wifi-edimax-ew-7811un-down-after-router-reboot" title="http://raspberrypi.stackexchange.com/questions/36714/wifi-edimax-ew-7811un-down-after-router-reboot">http://raspberrypi.stackexchange.com/questions/36714/wifi-edimax-ew-7811...</a></p>
<p>If you look down the page you&#39;ll find the following setting which I&#39;m hoping has fixed my issues with this. Haven&#39;t had a failure for a week or more since doing this which is no proof it&#39;s fixed it of course.</p>
<p>
sudo nano /etc/modprobe.d/8192cu.conf</p>
<p>then add the following.</p>
<p># Disable power management<br />
options 8192cu rtw_power_mgnt=0 rtw_enusbss=0 rtw_ips_mode=1<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36981"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9115.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9115.jpg" alt="jmoloney&#039;s picture" title="jmoloney&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Mon, 14/12/2015 - 11:17.</div>
    <div class="content">
     <p>Excellent @Bramco, thank you very much!&nbsp;Now you mention this, it rings a bell and I believe I made this change on my other Pi which hopefully explains why that&#39;s working ok.</p>
<p>I&#39;ve made the change and have everything (well, almost everything) crossed that it fixes the issue. I&#39;m pretty confident that it will do.</p>
<p>Thanks again, Josh</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36986"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 14/12/2015 - 13:10.</div>
    <div class="content">
     <p>Great to hear you have solved the issue. However it&#39;s strange you have had this issue, other users have reported good wifi stability using&nbsp;edimax and the emonPi our pre-built image. The emonPi has got a <a href="https://github.com/openenergymonitor/emonpi/blob/master/wifi-check">wifi -check script </a>which should run as a con&nbsp;job&nbsp;ever 5min.&nbsp;</p>
<p>Cold you check the log file: $&nbsp;tail /tmp/wificheck.log. You should see:</p>
<p>Starting WiFi check for wlan0<br />
Mon 14 Dec 13:00:01 GMT 2015</p>
<p>Performing Network check for wlan0<br />
Network is Okay</p>
<p>Current Setting:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.0.53 &nbsp;Bcast:192.168.0.255 &nbsp;Mask:255.255.255.0</p>
<p>It has been brought to my attention that this script may need to be ran as root. In the n<a href="11799.html">ew pre-built image</a>&nbsp;(beta release)&nbsp;based on the new&nbsp;Raspbian Jessie the wifi-check script is in the root conjob. I have just tested by unplugging my router here and then switching back on and the emonPi&nbsp;with the new image connected just fine.</p>
<p>If you have a chance could you test? If it&#39;s not working and the log shows&nbsp;a permission error you can move the cron entry in $ crontab -e to $ sudo&nbsp;crontab -e this will execute the wifi-check script as root.&nbsp;</p>
<p>I&#39;ve just checked the new image and the file&nbsp;/etc/modprobe.d/8192cu.conf does not exist. I&#39;m wondering if I should include the power management fix in the new image as a precaution. However it might well be ready built in to the distribution? As Wifi re-connection is working fine I think I&#39;ll leave it out for the moment.&nbsp;</p>
<p>Our of interest what % signal strength does the emonPi LCD show?&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36989"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9115.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9115.jpg" alt="jmoloney&#039;s picture" title="jmoloney&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Mon, 14/12/2015 - 13:27.</div>
    <div class="content">
     <p>Hi</p>
<p>The wifi log contains the text you pasted above (apart from the timestamp &amp; IP@ being different, of course!). The timestamp is (very) recent so the script is running.</p>
<p>It also contains these errors:</p>
<p><em>rm: cannot remove `/var/run/wifi-check.pid&#39;: No such file or directory</em></p>
<p><em>/usr/local/bin/wifi-check: line 63: /var/run/wifi-check.pid: Permission denied<br />
Performing Network check for&nbsp;wlan0</em></p>
<p>&nbsp;</p>
<p>I looked in /var/run and indeed there is no pid file so that might be a permission issue somewhere.</p>
<p>The signal strength currently&nbsp;shows&nbsp;68% which is pretty typical from what I&#39;ve seen.</p>
<p>&nbsp;</p>
<p>If my wifi problem doesn&#39;t disappear following the <em>8192cu </em>change,&nbsp;I&#39;m thinking that it might be a good idea to temporarily modify the crontab file so that each wifi check output is appended to the log to avoid potentially useful data loss (default is to overwrite).</p>
<p>&nbsp;</p>
<p>Thanks, Josh</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36991"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 14/12/2015 - 14:12.</div>
    <div class="content">
     <p>Yes, I agree it would be a good idea to append rather than overwrite the log. However I&#39;m worried what will happen over a long period of time when /tmp fills up. I think we will need to implmenet&nbsp;a log deleting / roatation&nbsp;scheme if I change to appending&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36997"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Mon, 14/12/2015 - 16:00.</div>
    <div class="content">
     <p>Glyn,</p>
<p>I&#39;m assuming this isn&#39;t part of the pi install guide that Paul wrote recently?</p>
<p>If not then it would be good to get this included.</p>
<p>Re adding the&nbsp;/etc/modprobe.d/8192cu.conf fix as wel. I can&#39;t see it hurting. If you check with google for fixes for this issue there are quite a lot of references to the fix. Maybe overkill but losing wifi can be a real pain, especially if it happens when you can&#39;t get access to the system as happened to me recently.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37106"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4292.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andyevison&#039;s picture" title="Andyevison&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/4292.html" title="View user profile.">Andyevison</a> on Wed, 16/12/2015 - 17:34.</div>
    <div class="content">
     <p>Hi</p>
<p>Can&#39;t add anything technical here but may add a small additional point.&nbsp;&nbsp;I found that my wifi dongle stopped responding to when I navigated to the IP address, usually every day.&nbsp; It required operation of the reset button.&nbsp; The odd thing was that although I could not access it, it was still sending the data to emonCMS.&nbsp; I solved my issue by crawling around and feeding an ethernet cable. I now have an IP address for&nbsp;wifi and ethernet - &nbsp; I do not know&nbsp; whether the ethernet is keeping the dongle fully alive but I have been able to access the dongle every time since.&nbsp; That is about two weeks ago.&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37221"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9115.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9115.jpg" alt="jmoloney&#039;s picture" title="jmoloney&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Sat, 19/12/2015 - 09:40.</div>
    <div class="content">
     <p>Sad to say but I lost connectivity again yesterday. Admittedly I rebooted the router a few times to resolve some other issues but would have expected the Pi to reconnect as usual.</p>
<p>Under these circumstance I usually do a reboot, but I understand that this leads to a loss of cached data that might otherwise get sent to emoncms.</p>
<p>Is a better solution to pull and re-insert the dongle?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37239"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 19/12/2015 - 15:57.</div>
    <div class="content">
     <p><em>&quot;but I understand that this leads to a loss of cached data that might otherwise get sent to emoncms.&quot;</em></p>
<p>Unfortunately the emon-pi variant of emonhub (as included in&nbsp;the standard emonPi&nbsp;image) no longer buffers data, the data is only buffered between 30sec sends and if the network is not available when it attempts to send the data is not retained.</p>
<p>Try changing the &quot;ifdown&nbsp;wlan0&quot; line to &quot;ifdown --force wlan0&quot; in the wifi-check script. the ifdown script will only bring down wlan0&nbsp;IF it believes it is configured (up) and could be wrong, --force just does it regardless.</p>
<p>To get the bottom of the problem you may need to use an Ethernet cable to ssh in while the wifi is down, neither rebooting or removing/installing the dongle is ideal.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37240"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2292.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jpm32526&#039;s picture" title="jpm32526&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/2292.html" title="View user profile.">jpm32526</a> on Sat, 19/12/2015 - 16:00.</div>
    <div class="content">
     <p>Hi Josh, I had the same problem with my wifi, dropping the connection after 18 to 24 hours. Mine uses the r8188eu driver which may be similar to yours. My fix was to use...</p>
<p>sudo nano /sys/module/r8188eu/parameters/rtw_power_mgnt</p>
<p>...to change the 0 to 1, and no drops for a couple of weeks. There is only that one character in the file. See if you have such a file, maybe r8192cu or similar.&nbsp; Worth a try anyway.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37274"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9115.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9115.jpg" alt="jmoloney&#039;s picture" title="jmoloney&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Sun, 20/12/2015 - 10:29.</div>
    <div class="content">
     <p>Thanks for the info &amp; tips, I&#39;ll see if it was a one off by monitoring it over the next few days/week and if not I&#39;ll fiddle with the script and driver settings.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37376"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9115.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9115.jpg" alt="jmoloney&#039;s picture" title="jmoloney&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Tue, 22/12/2015 - 17:25.</div>
    <div class="content">
     <p>So I had another drop this&nbsp;afternoon after a spontaneous router reboot (BT are wonderful&nbsp;like that).</p>
<p>This time I connected an ethernet cable before the reboot to see what I could find (this isn&#39;t something I could leave in place, the cable is about 10m long and runs over the floor like a trip hazard).&nbsp;The log file /tmp/wificheck.log reads:</p>
<p><em>Starting WiFi check for wlan0<br />
Tue Dec 22 17:15:01 UTC 2015</em></p>
<p><em>/usr/local/bin/wifi-check: line 63: /var/run/wifi-check.pid: Permission denied<br />
Performing Network check for wlan0<br />
ifdown: failed to open statefile /run/network/ifstate: Permission denied<br />
ifup: failed to open statefile /run/network/ifstate: Permission denied</em></p>
<p><em>Current Setting:</em></p>
<p><em>rm: cannot remove `/var/run/wifi-check.pid&#39;: No such file or directory</em></p>
<p>This leaves me wondering if running the script as toor&nbsp;might help as suggested?</p>
<p>From what I understand, this would involve editing user &quot;pi&quot;&#39;s crontab file to remove the associated entry, and then adding the entry in root&#39;s crontab&nbsp;file using the sudo command. I&#39;ll try that to see if it helps...</p>
<p>Josh</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37380"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9115.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9115.jpg" alt="jmoloney&#039;s picture" title="jmoloney&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Tue, 22/12/2015 - 17:50.</div>
    <div class="content">
     <p>Ok, so I made the cron job&nbsp;changes and ran a test to see what was what by rebooting the hub while the pi was connected via wifi. There were some odd messages in the log file:</p>
<p><em>Starting WiFi check for wlan0<br />
Tue Dec 22 17:45:01 UTC 2015</em></p>
<p><em>Performing Network check for wlan0<br />
ifdown: interface wlan0 not configured<br />
<strong>ioctl[SIOCSIWAP]: Operation not permitted<br />
ioctl[SIOCSIWENCODEEXT]: Invalid argument<br />
ioctl[SIOCSIWENCODEEXT]: Invalid argument</strong></em></p>
<p>&nbsp;</p>
<p>But regardless of them&nbsp;I&#39;m happy to say that wifi connectivity was re-established, so it appears that my problem might be solved.&nbsp;Just in time for Christmas - hurray!</p>
<p>Note: I had to remove the entry I initially added&nbsp;to <strong>/etc/network/interfaces</strong> since that also resulted in an error message appearing in the log file.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37520"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9115.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9115.jpg" alt="jmoloney&#039;s picture" title="jmoloney&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/9115.html" title="View user profile.">jmoloney</a> on Sat, 26/12/2015 - 18:30.</div>
    <div class="content">
     <p>*Sigh*</p>
<p>I checked my device today only to find it had been offline for over a day because it had connected&nbsp;to a FON SSID instead of my own wireless network.</p>
<p>Not sure why this happened, but in any case I went into /etc/wpa_supplicant/wpa_supplicant.conf and deleted all SSID&nbsp;entries other than my own network.Hopefully this might stop it connecting to other networks in future..?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37877"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6165.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Dvbit&#039;s picture" title="Dvbit&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/6165.html" title="View user profile.">Dvbit</a> on Mon, 04/01/2016 - 23:36.</div>
    <div class="content">
     <p>I am also having this problem.</p>
<p>I tried the wifi script also after modifying the location of the pid file as it was wrting in a read only area.</p>
<p>adding also a ping to the router to check connectivity and reestablish it in case.</p>
<p>But again today the emonpi&nbsp;was disconnected!</p>
<p>EmonPi&nbsp;and router are in line of sight (6/6 meters) and when connected the emonpi gives 60% signal stregth (emonpi is in a electrical cabinet recessed) and router beyond a shelf with heavy cabling . but there&#39;s 60%.</p>
<p>Note that at the same distance there is a wifi thermostat connected to the same wlan that has no problem since ever.</p>
<p>So why are we having this trouble?&nbsp;</p>
<p>How many other people have it?</p>
<p>I purchased the EmonPi on kickstarter back in may 2015.</p>
<p>I am going to open an issue on github as I could not fin any open.</p>
<p>Any help from the support team is highly appreciated</p>
<p>KR</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37878"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6165.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Dvbit&#039;s picture" title="Dvbit&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/6165.html" title="View user profile.">Dvbit</a> on Mon, 04/01/2016 - 23:42.</div>
    <div class="content">
     <p>Permission denied message is due to the fact that the script tries to write in /var/run and this, when partitions are RO, is a no write area.</p>
<p>change the path in the script to temp.</p>
<p>&nbsp;</p>
<p>Did not solve for me however.</p>
<p>Anybody&nbsp;with another dongle and working?</p>
<p>&nbsp;</p>
<p>TX</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6518.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="JD&#039;s picture" title="JD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/6518.html" title="View user profile.">JD</a> on Tue, 05/01/2016 - 16:41.</div>
    <div class="content">
     <p>I have been using a different dongle: &nbsp;the LB LInk&nbsp;BL-LW05-AR5. &nbsp;It has a big antenna and good range.</p>
<p>However, I suffered from the same disconections (not on emonPi, on emonBase with older version). &nbsp;</p>
<p>The fix for me was to change the way&nbsp;WiIfCheck&nbsp;operates. &nbsp;WiFiCheck works by checking to see if the Pi has an IP address:</p>
<pre>
# We can perform check
echo &quot;Performing Network check for $wlan&quot;
if ifconfig $wlan | grep -q &quot;inet addr:&quot; ; then
    echo &quot;Network is Okay&quot;
</pre><p>I found that my router would hand out DHCP addresses, but somehow would close the connections after a random period of time, while still reserving the IP address. &nbsp;This caused WiFiCheck to report a false positive.</p>
<p>The fix for me was to change WiFiCheck to ping either my router (192.168.1.1) or better, Google (8.8.8.8) instead of checking for &quot;inet addr:&quot;. &nbsp;This has been 100% reliable on at least 10 different Pi&#39;s.</p>
<p>Disclaimer: &nbsp;I do not have an emonPi or know what is installed on one by default. &nbsp;</p>
<p>&nbsp;</p>
<p>Here is the code, from &quot;#Settings&quot; downwards:</p>
<pre>
##################################################################
# Settings
# Where and what you want to call the Lockfile
lockfile=&#39;/var/run/WiFi_Check.pid&#39;
# Which Interface do you want to check/fix
wlan=&#39;wlan0&#39;
# Which address do you want to ping to see if you can connect
pingip=&#39;192.168.1.1&#39;
##################################################################
echo
echo &quot;Starting WiFi check for $wlan&quot;
date
echo 

# Check to see if there is a lock file
if [ -e $lockfile ]; then
    # A lockfile exists... Lets check to see if it is still valid
    pid=`cat $lockfile`
    if kill -0 &amp;&gt;1 &gt; /dev/null $pid; then
        # Still Valid... lets let it be...
        #echo &quot;Process still running, Lockfile valid&quot;
        exit 1
    else
        # Old Lockfile, Remove it
        #echo &quot;Old lockfile, Removing Lockfile&quot;
        rm $lockfile
    fi
fi
# If we get here, set a lock file using our current PID#
#echo &quot;Setting Lockfile&quot;
echo $$ &gt; $lockfile

# We can perform check
echo &quot;Performing Network check for $wlan&quot;
/bin/ping -c 2 -I $wlan $pingip &gt; /dev/null 2&gt; /dev/null
if [ $? -ge 1 ] ; then
    echo &quot;Network connection down! Attempting reconnection.&quot;
    /sbin/ifdown $wlan
    sleep 5
    /sbin/ifup --force $wlan
else
    echo &quot;Network is Okay&quot;   
fi

# Check is complete, Remove Lock file and exit
#echo &quot;process is complete, removing lockfile&quot;
rm $lockfile
exit 0

##################################################################
# End of Script




</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38109"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6165.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Dvbit&#039;s picture" title="Dvbit&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/6165.html" title="View user profile.">Dvbit</a> on Sun, 10/01/2016 - 21:21.</div>
    <div class="content">
     <p>After changing che script as per previous script i keep having the problem . max 2 days and &nbsp;it is out of network.</p>
<p>&nbsp;</p>
<p>How many other users are having the problemi?</p>
<p><span style="line-height: 1.6;">Please help. This way the device is simply unusable!!!!</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38139"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6165.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Dvbit&#039;s picture" title="Dvbit&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/6165.html" title="View user profile.">Dvbit</a> on Mon, 11/01/2016 - 13:55.</div>
    <div class="content">
     <p>Disconnected again! Please advise. Is there a version without this problem?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38143"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6518.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="JD&#039;s picture" title="JD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/6518.html" title="View user profile.">JD</a> on Mon, 11/01/2016 - 14:54.</div>
    <div class="content">
     <p>I don&#39;t know if I&#39;m helping or making things more complicated for you... but two other things I&#39;ve tried in the past with some success (this was before implementing the ping-based wifi_check detailed above):</p>
<p>1. &nbsp;Use a CRON job to restart the pi every 12 hours</p>
<p>2. &nbsp;Add multiple access point credentials in wpa_supplicant.conf&nbsp;(if you have more than one WiFi network available) using the priority feature. &nbsp;This gives the wifi system some options in case the preferred&nbsp;network is not available. &nbsp;</p>
<p>My wpa_supplicant.conf file looks like this (passwords have been replaced with xxxxxx):</p>
<pre>
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
update_config=1
network={
    ssid=&quot;Office&quot;
    psk=&quot;xxxxxxxxxxx&quot;
    priority=10
}
network={
    ssid=&quot;Barn&quot;
    psk=&quot;xxxxxxxxxxx&quot;
    priority=9
}
network={
    ssid=&quot;Bridge&quot;
    psk=&quot;xxxxxxxxxxxx&quot;
    priority=8
}
network={
    ssid=&quot;8Z8QD&quot;
    psk=&quot;xxxxxxxxxxxxxxx&quot;
    priority=7
}
network={
    key_mgmt=NONE
    priority=0
} 

</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38658"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sun, 24/01/2016 - 10:14.</div>
    <div class="content">
     <p>Here is my version of the problem.</p>
<p>Today I rebooted the wirelessAP&nbsp;connected to my home lan. My Pi then did not reconnect when the AP came back up (although other items reconnected fine). Rebooted Pi still no connection. Hot plugged net cable into Pi and everything instantly came to life wireless and cable.</p>
<p>In this instance I cannot see that inserting an auto reboot into the code will help????</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38662"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 24/01/2016 - 13:49.</div>
    <div class="content">
     <p>Hi guys,&nbsp;</p>
<p>I feel your pain, I have been doing my best to try and get to the bottom of this issue. Unfortunately&nbsp;I have not been able to replicate.&nbsp;Every&nbsp;emonPi&nbsp;and&nbsp;emonBase&nbsp;that we have running at home or in the lab have never disconnected from&nbsp;Wifi. I am using the standard&nbsp;Edimax&nbsp;Wifi&nbsp;dongle with a Sky router with a&nbsp;WPA2-PSK&nbsp;Wifi&nbsp;network.&nbsp;Over 1.5K&nbsp;emonPi&#39;s&nbsp;have been shipped and to my knowledge this thread is the only reports of&nbsp;WiFi&nbsp;issues.&nbsp;I think we need to try and collate some better info as to what could be the common cause:</p>
<p>I have started an open google&nbsp;doc spreadsheet, I would be most grateful if you could fill out your details:</p>
<p><a href="https://docs.google.com/spreadsheets/d/1B7n57g2iOf-2OJGQMFfXknhfroisKn1AtAnDEzWmS98/edit?usp=sharing">https://docs.google.com/spreadsheets/d/1B7n57g2iOf-2OJGQMFfXknhfroisKn1AtAnDEzWmS98/edit?usp=sharing</a></p>
<p>One thing that all my emonPi install locations have in common is relative quite WiFi&nbsp;spectrum, there are only a couple of other WiFi networks present in the vicinity. I don&#39;t know if this could make a difference. I think this is a Linux / Raspberry Pi issue rather than a specific emonPi issue.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38690"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sun, 24/01/2016 - 23:25.</div>
    <div class="content">
     <p>Trying to work out exactly what physical actions cause it.</p>
<p>So far have run from Lan all day no probs. Just hot plugged wifi dongle into Pi. Sure enough after approx 5 mins&nbsp;it came up. Disconnected lan cable and now running on dongle. lets see? The 5 min delay time(written into script somewhere I believe) is a bit of a pain. If I had not known about it I would have assumed that no connection was going to be made and started rebooting etc! Will let it run overnight and then try reboot of AP.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38696"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New emonpi setup with Edimax wifi dongle keeps disconnecting</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Tue, 26/01/2016 - 08:43.</div>
    <div class="content">
     <p>See post above.</p>
<p>This am all was still working perfectly. I then rebooted the wifi&nbsp;access point that the Pi is connected to.</p>
<p>15 mins later the Pi has not reconnected. All other wifi connections were reinstated immediately. Wifi dongle has no blue light. Hot&nbsp;connected lan plug which worked (via lan) immediately. WIfi&nbsp;dongle&nbsp;then reconnected to wifi AP&nbsp;after approx&nbsp;7 mins&nbsp;(definately more than 5). Disconnected lan cable and all ok again.</p>
<p>What that means as far as the script goes I have no idea. The long time delays are irritating unless you know about them and I would imagine are unnecessary in a mains powered device? I imagine that the Pi still thinks that it has a lan connection (as it did at boot) and therefore does not restart the dongle?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11794"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-UPEkKsT8btKyV47RwYWg8CCBD4_auwn_khwcjnSOeiw" value="form-UPEkKsT8btKyV47RwYWg8CCBD4_auwn_khwcjnSOeiw"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
