<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10881 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:59:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Getting started with emon 3.4 programming (uC and RF module) | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Getting started with emon 3.4 programming (uC and RF module)</h3>
        <span class="submitted">Submitted by <a href="../user/8051.html" title="View user profile.">Gzero</a> on Mon, 22/06/2015 - 04:19</span>
        <div class="content"><p>Im used to the&nbsp;arduino&nbsp;board programming&nbsp;scheme, I started&nbsp;making the&nbsp;emon&nbsp;3.4 in order to&nbsp;evolve&nbsp;a&nbsp;little&nbsp;bit,&nbsp;&nbsp;im trying for the first time to program&nbsp;&nbsp;microcontrollers&nbsp;on pcb boards via programming pins ISP,&nbsp;For&nbsp;starters im trying to upload the&nbsp;bootloader, i know the&nbsp;ftdi&nbsp;driver is&nbsp;installed&nbsp;in my machine, the cable has been verified to work</p>
<p>However I have no idea of how to actually write the program and upload it to the microcontroller, I have been messing with the&nbsp;arduino&nbsp;IDE all day my&nbsp;FTDI&nbsp;cable its at&nbsp;COM10, however no programmer&nbsp;available&nbsp;at the&nbsp;arduino&nbsp;IDE seems to work with this cable, i have been looking and trying all day with no luck,&nbsp;</p>
<p>How can i write the&nbsp;code in c and upload it to the&nbsp;microcontroller using the&nbsp;FTDI&nbsp;cable? do i need a specific software to do this? Any special configuration or hack? what am I missing? , also, i understand that the&nbsp;UART&nbsp;pins are for the&nbsp;328p&nbsp;while the ISP are for the RF module is this right? if yes what software can i use to&nbsp;successfully&nbsp;program both?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10909.html" class="topic-previous" title="Go to previous forum topic">‹ Basic Graphing Range Newbie Question</a>
              <a href="10879.html" class="topic-next" title="Go to next forum topic">Copy feeds data from earlier emoncms installation to new one ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31580"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 22/06/2015 - 06:10.</div>
    <div class="content">
     <p><em>For starters im trying to upload the bootloader,&nbsp;</em></p>
<p>Did you build this thing from parts yourself, or buy it pre-built from the shop? &nbsp;If from the shop,&nbsp;I&#39;m pretty sure it would have been shipped with an appropriate bootloader, so you shouldn&#39;t need to do that. &nbsp;But if you do, you need to use the ICSP header for that, which means you need an ISP programmer. &nbsp; The AVRISP MkII is quite affordable, or alternatively you can build your own ISP programmer out of a spare Arduino.</p>
<p><em>How can i write the code in c and upload it to the microcontroller using the FTDI cable?</em></p>
<p>Assuming the bootloader is installed, and you&#39;re now trying to upload a system image (aka &quot;sketch&quot;)&nbsp;you should just be able to point your Arduino IDE at COM10 and click on &#39;Upload&#39;... at least that&#39;s how I assume it works on Windows.. I use unix myself.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31605"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8051.jpg" alt="Gzero&#039;s picture" title="Gzero&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/8051.html" title="View user profile.">Gzero</a> on Mon, 22/06/2015 - 15:29.</div>
    <div class="content">
     <p>i see. i built it on my own using the bom posted in git, so my atmega is in blank, and so is my RF module, the only question i have left now is how cna i program the RF module and the onboard atmega from the same ISP header is it even possible?</p>
<p>&nbsp;</p>
<p>or do i have to desolder one in order to program the other?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31607"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 22/06/2015 - 15:50.</div>
    <div class="content">
     <p>The SPI bus (mosi,miso and sclk) are used during normal running to communicate between the rfm module and avr, the rfm module is not used to &quot;program&quot; the rfm module per se as it is configured using commands from the AVR&#39;s sketch. The same bus is used to initially program the AVR via<span style="line-height: 20.7999992370605px;">&nbsp;the&nbsp;</span>6pin<span style="line-height: 20.7999992370605px;">&nbsp;(</span><span style="line-height: 20.7999992370605px;">2x3) ISP header. Once the optiboot bootloader is installed (via the ISP) then future sketch uploads can be done via the serial port pins of the AVR using the 6pin (1x6) FTDI&nbsp;header.</span></p>
<p><span style="line-height: 20.7999992370605px;">The slave select pin is used by the AVR to select the RFM module in normal running and when installing the bootloader or any AVR&nbsp;programming&nbsp;via the ISP the attached programmer will use the AVR&#39;s reset pin.</span></p>
<p><span style="line-height: 20.7999992370605px;">The 6 conns at the ISP header should be vcc, gnd, mosi, miso, sclk and reset.</span></p>
<p><span style="line-height: 20.7999992370605px;">To program the AVR you must have those 6 connections, have you used a SMT or a DIL AVR? can it be removed and programmed off the board? </span></p>
<p><span style="line-height: 20.7999992370605px;">Paul</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31619"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 22/06/2015 - 20:40.</div>
    <div class="content">
     <p>I&#39;m guessing you don&#39;t need to flash the RF module with anything. &nbsp;I suspect it comes from the manufacturer good to go. &nbsp;But I&#39;ve never seen one, so if anyone else knows better please chime in.</p>
<p>There should be no problem flashing a bootloader into your AVR via the ICSP header with an ISP while the RF module is physically on the bus, provided you have an&nbsp;<strong>external</strong>&nbsp;pull-up resistor on the RF module&#39;s /CS signal. &nbsp;See also&nbsp;<a href="5345.html">http://openenergymonitor.org/emon/node/5345</a>.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31628"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8051.jpg" alt="Gzero&#039;s picture" title="Gzero&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/8051.html" title="View user profile.">Gzero</a> on Tue, 23/06/2015 - 05:25.</div>
    <div class="content">
     <p>Im starting to read the references posted, but my impression is that the RF has to be programmed unless im mistaken and Im supposed to program the atmega with the node ID and frequency of the Tx module&nbsp;in order fot the module to be read by the Reciever&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31629"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 23/06/2015 - 07:49.</div>
    <div class="content">
     <p>Check pb66&#39;s reply above. &nbsp;The RF module is&nbsp;<strong>configured </strong>at runtime&nbsp;by the sketch running on the AVR. &nbsp;That&#39;s done by commands over the SPI bus (like most SPI devices). &nbsp;If there is any firmware running on the RF module it&#39;s burnt in by the manufacturer, so it&#39;s ready to receive runtime SPI bus configuration&nbsp;commands from the AVR.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31630"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 23/06/2015 - 08:18.</div>
    <div class="content">
     <p>The node ID and frequency are amongst the many variables&nbsp;in the AVR&#39;s sketch that you upload as a whole, you do not &quot;program&quot; the node id and frequency nor do you flash the rfm module.</p>
<p>&nbsp;</p>
<p>R24 (120R) is the pullup&nbsp;that dBC refers to, this must be fitted to program&nbsp;the AVR in place with a rfm69 fitted, if the rfm module hasn&#39;t been fitted yet or it&#39;s a rfm12 you could get away without it.</p>
<p>The focus to get your device working has to be to program the&nbsp;AVR, if you&nbsp;get&nbsp;a bootloader&nbsp;onto the AVR you can then&nbsp;upload future sketches via the&nbsp;ftdi&nbsp;header, the sketches content will configure the rfm module in normal running.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31631"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 23/06/2015 - 09:15.</div>
    <div class="content">
     <p><em>R24 (120R) is the pullup that dBC refers to</em></p>
<p>Man, that&#39;s strong for a pull-up. &nbsp;Do the lights dim when you talk to that thing?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31632"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 23/06/2015 - 09:50.</div>
    <div class="content">
     <p>Doh!!! R24 is not 120R&nbsp;but&nbsp;<strong>120K&nbsp;</strong></p>
<p>Well spotted I wasn&#39;t thinking much about the value, just (incorrectly) copied it over from the schematic to refer to it&#39;s component&nbsp;number, cheers dBC.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31684"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8051.jpg" alt="Gzero&#039;s picture" title="Gzero&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/8051.html" title="View user profile.">Gzero</a> on Thu, 25/06/2015 - 06:14.</div>
    <div class="content">
     <p>I see, thanks a lot for the answers, i currently own an USBASP&nbsp;2.0 i Programmer&nbsp;I&nbsp;want to believe thats more than enough to get started programing the atmega328, i will get to it in the weekend, however I am still missing what software can help me get the bootloader on the chip? i have yet to find one as easy to use as the arduino IDE, im usually running windows, however i can get a Virtual machine running windows <strong>could anyone point me to a software to get the bootloader&nbsp;in to the microcontroler</strong>&nbsp;(windows preferred&nbsp;)?</p>
<p>New questions arise, <strong>why have both ISP and FTDI pins and not only the ISP</strong>? im guessing that if you can upload the bootloader using the ISP, then you can&nbsp;still keep using the ISP pins to upload sketches, so &nbsp;then why add the FTDI pins?&nbsp;</p>
<p>I bought from the open energy monitor store&nbsp;the RFM69Pi 433Mhz Raspberry Pi Base Station Receiver Board, on my own from ebay i bought&nbsp;4 of the RF 433 Mhz&nbsp;modules myself, so i have a total of 5 modulesall at&nbsp;433Mhz, according to what i just read here i can&nbsp;use one of the 4 i bought in ebay in the emon 3.4&nbsp;along the Raspberri pi RF base station&nbsp;and start transmitting (Im guessing the Tx acts like a wire), as long as i have the emon 3.4 microcontroller programmed and running,<strong> im also&nbsp;assuming that the the emon base adapter that has a microcontroller along a RF module its already programmed to interact with the Pi is this right?&nbsp;</strong></p>
<p>Im not quite sure in understood all the pull up resistor chitchat, my current R24 its 120k&nbsp;i went to the other thread that dBc posted, and looks like it had a problem with the reset times.&nbsp;before for the resistor being to low , but im guessing it should work in the current board&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31685"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 25/06/2015 - 08:33.</div>
    <div class="content">
     <p>Can you confirm if you&#39;re building an exact emnTx v3.4 or something based on that design, it is really difficult to provide answers specific to your build without details.</p>
<p>The Arduino IDE is able to burn bootloaders, check the tools menu. Why isp and ftdi is a theory question best answered elsewhere but given both are available the ISP is the only way to install software UNTIL a bootloader is loaded, then the ftdi&nbsp;can be used which is generally easier to hook up to, provides serial communication&nbsp;and is also safer as you cannot get to the fuses (bootloader settings)</p>
<p>I have no experience of the &quot;USBASP&nbsp;2.0 i Programmer&quot; but a very quick search seems to show it has a 5v supply voltage and 10pins, this will need&nbsp;an adapter to 6pin&nbsp;icsp&nbsp;to connect to the emonTx and unless it can power the emontx at 3.3v NOT 5V it will damage the RFM module if fitted, You can however program a&nbsp;bootloader&nbsp;with 5v prior to fitting the&nbsp;rfm module. (another good reason for us to use the ftdi once the rfm is fitted)</p>
<p>The rfm69pi&#39;s do normally come with firmware pre-installed, you should&nbsp;satisfy yourself this is the case before fitting the rfm module (for the same 3v/5v reason above) the rfm69pi doesn&#39;t have a ftdi&nbsp;header since it is connected to the Pi directly the programing and serial port comms etc&nbsp;are available via the Pi&#39;s&nbsp;gpio</p>
<p>​The rfm69 and 12 modules can be interchanged with software edits (so the rfm69pi will be pre-loaded with rfm69 options) if you are in anyway&nbsp;unsure of how permanent&nbsp;fitment&nbsp;of any of the rfm modules is, then maybe look at options to lift the boards away from the main board using short legs or similar, you will have a hard time removing any well fitted rfm module.</p>
<p>If you are going to fit the rfm69 to any particular device the rfm69pi is probably favorite as it&#39;s usually the base station you want to be most sensitive.</p>
<p>Be&nbsp;careful about orientaion when fitting the rfm modules as the rfm69&nbsp;&quot;appears&quot; upside down compared to the rfm12.</p>
<p>​As long as you have the&nbsp;R24 (120K) pull-up that,s fine, ignore the chitchat.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31688"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 25/06/2015 - 09:13.</div>
    <div class="content">
     <p>Another option for burning the bootloader is &#39;avrdude&#39; which runs on just about every platform known to mankind. &nbsp;Actually, the Arduino IDE uses avrdude to program the device (at least on &nbsp;Linux, but I assume on other platforms too), so you can use either really.</p>
<p>Many AVR based designs will have the ftdi USB&lt;-&gt;serial IC right on them, with a corresponding&nbsp;USB port. &nbsp;If you do that, then the answer to the &quot;why have ISP and ftdi&quot; becomes more obvious. &nbsp; The ISP gets used at production time to burn the fuses and bootloader (and possibly the initial system image) then you send your product out to thousands of customers. &nbsp; Should you want to do an in-field update of the system image all you need to do is send people a hex file and some instructions on how to run avrdudue. &nbsp;Just about everyone has access to a laptop and a USB cable. &nbsp;Assuming you&#39;ve exposed your USB port&nbsp;there&#39;s no need for them to pull anything apart to get at any header pins.</p>
<p>When the ftdi&nbsp;IC and USB port are&nbsp;removed from the design (typically for cost or space saving) then in-field f/w updates are harder. &nbsp;They need to get at the serial pins (aka FTDI header) or the ICSP&nbsp;pins and have more specialised hardware (an FTDI cable, or an ISP), so the relative advantage of an FTDI header Vs an ICSP header is smaller.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31693"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 25/06/2015 - 11:05.</div>
    <div class="content">
     <p>Thanks for the theory master class&nbsp;dBC :-) insightful as usual.</p>
<p>My &quot;<em>Why isp and ftdi is a theory question best answered elsewhere&quot;&nbsp;</em>comment was actually an&nbsp;attempt to sidestep adding any confusion surrounding the USB to this thread, since the emonTx&#39;s have usb for power only. And to focus on the main reasons why Gzero&nbsp;should use an FTDI&nbsp;and aside from being easier to access (on a emontx)&nbsp;most ICSP&#39;s&nbsp;use 5v and the RFM&#39;s are not 5v tolerant&nbsp;so unwittingly connecting a 5v&nbsp;ICSP&nbsp;after the RFM is fitted could be fatal&nbsp;(for the module not the user that is!!), plus the using the&nbsp;FTDI&nbsp;also prevents accidental fuse arrangements being set by uploading the wrong hex file and gives serial output which are all more&nbsp;relevant to&nbsp;Gzero&nbsp;but not necessarily any of the founding reasons behind the manufacturers&nbsp;design.</p>
<p>The arduino&nbsp;IDE does indeed use avrdude on the windows platform, but the <em>&quot;i have yet to find one as easy to use as the arduino IDE,&quot;&nbsp;</em>comment seemed to&nbsp;infer&nbsp;a preference for simple and familiar.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31701"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8051.jpg" alt="Gzero&#039;s picture" title="Gzero&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/8051.html" title="View user profile.">Gzero</a> on Thu, 25/06/2015 - 15:34.</div>
    <div class="content">
     <p>yes sure this is the pcb layout i sent to the fabhouse&nbsp;I downloaded the files from the&nbsp;OpenEnergy&nbsp;Monitor&nbsp;GitHub&nbsp;&nbsp;https://github.com/openenergymonitor/Hardware/tree/master/emonTxV3/emonTx_V3.4</p>
<p><img alt="" style="width: 700px" src="../sites/default/files/board_0.jpg" /></p>
<p>I&nbsp;made my own adapter for this 10 pin programmer (4 of them are just&nbsp;GNDs)&nbsp;right before i started this thread, (i glued the pins) in order for it to become a 6 pin adapter for this board,&nbsp;</p>
<p><img alt="" style="width: 700px" src="../sites/default/files/123_0.jpg" /></p>
<p>So in short&nbsp;I&nbsp;need to make sure that&nbsp;in order to not kill the RF module I would need to program the microcontroller and THEN solder the RF module, this way it wont get in the way and will be feed by the 3.3v regulator after the system is complete,</p>
<p>Im looking at the schematic right now and it seems that no matter if i use a 5v source, it will get regulated down by the 1702 Voltage regulator (down to 3.3v) unless im reading it wrong&nbsp;, &nbsp;&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31703"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 25/06/2015 - 18:23.</div>
    <div class="content">
     <p>Good, I was assuming a close copy of the emontx v3.4 but just wanted confirmation to be sure we were on the same page.</p>
<p>Yes in normal operation the 5v from the USB power supply, FTDI, 9VAC or batteries all get regulated at 3.3v BUT the &quot;5v&quot; pin of the ICSP&nbsp;is connected to the 3.3v rail directly so MUST be powered with 3.3v if the RFM is fitted, so yes program before fitting rfm OR supply 3.3v to the ICSP&nbsp;header not 5v (either from your programmer if it can do 3.3v) or via a voltage divider or even by not connecting the 5v to the ICSP but to the FTDI&nbsp;to utilize the on-board regulator. Before the rfm is fitted it doesn&#39;t matter because the AVR can handle either voltage.</p>
<p><img alt="" src="../sites/default/files/emontx_v3_4_spi.png" style="width: 700px; height: 343px;" /></p>
<p>This is an excerpt from the emontx&nbsp;v3.4 schematic</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31706"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 25/06/2015 - 20:44.</div>
    <div class="content">
     <p>I think there may be some confusion about the purpose of pin 2 on the ICSP header. &nbsp;It&#39;s there to allow the programmer to determine what system voltage your target is running at so that it can use that same voltage when driving the SPI pins. &nbsp;You should power your target via its normal power supply when programming.</p>
<p><em>because the AVR can handle either voltage.</em></p>
<p>But it can&#39;t handle a Vcc of 3.3V and SPI voltages at 5V, which is why the programmer needs to determine what voltage your system is running at before it does anything else.</p>
<p>My description here applies to the official Atmel&nbsp;AVRISP MarkII: &nbsp;<a href="http://www.atmel.com/webdoc/avrispmkii/avrispmkii.intro_connecting.html">http://www.atmel.com/webdoc/avrispmkii/avrispmkii.intro_connecting.html</a></p>
<p>I&#39;ve no knowledge of what other programmers do, but if they jam 5V down pin2 that sounds very dangerous (for all the reasons pb66 has highlighted above). &nbsp;Generally you want to program these things after the board has come back from manufacturing and by then&nbsp;the programmer should be making no assumptions about what voltages are safe and what other devices are sitting on those rails and busses.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31707"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 25/06/2015 - 21:58.</div>
    <div class="content">
     <p>I wasn&#39;t aware ISCP programmers <u>didn&#39;t</u> provide power, An accumulation of facts such as the &quot;+5&quot; label on pin2 of the ISCP that is shown as tied to 3.3v, the <a href="http://wiki.openenergymonitor.org/index.php/RFM12Pi_V2">&quot;Note: the </a><a href="http://wiki.openenergymonitor.org/index.php/RFM12Pi_V2">RFM12Pi</a> is a 3.3V only therefore it should not be powered by a 5V ISP programmer.&quot; comment in the wiki&nbsp;&nbsp;led me to believe the ICSP&nbsp;did (or at least could) power the board especially as I understood the bootloader is installed&nbsp;during manufacture.</p>
<p>Since I have only ever used <a href="https://www.arduino.cc/en/Tutorial/ArduinoISP">Arduino&nbsp;as AVR ISP</a>&nbsp;or the RPi GPIO&nbsp;for this purpose I&#39;ve always provided the correct voltages via the ICSP header including power.</p>
<p>@Gzero - in light of the above it&#39;s either safer to stick with programing before fitting the rfm or you will need to check your own programmer, a short search reveals some programmers <u>only</u> work at 5v,&nbsp;some provide power and some require power!</p>
<p>@dBC - &nbsp;this seems like another very good reason to stick to using the FTDI and leaving the ICSP well alone!</p>
<p>To coin a phrase of Robert&#39;s &quot;that&#39;s the nice thing about standards, there are so many to choose from!&quot;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31710"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Getting started with emon 3.4 programming (uC and RF module)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 25/06/2015 - 22:23.</div>
    <div class="content">
     <p>AVR910&nbsp; (<a href="http://www.atmel.com/images/doc0943.pdf">http://www.atmel.com/images/doc0943.pdf</a>)&nbsp; &nbsp;permits both, but Atmel&#39;s own programmer takes the safe option of insisting the target be self-powered, and then sensing that voltage to drive the SPI pins at the correct voltage.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10881"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-e99d0baStqu0pUbZGCAbok8EC9BcZkW12XKBXT_oIG8" value="form-e99d0baStqu0pUbZGCAbok8EC9BcZkW12XKBXT_oIG8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/10881 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:59:30 GMT -->
</html>
