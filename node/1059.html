<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/1059 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:18:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Solar Power Divert with no voltage readings | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Solar Power Divert with no voltage readings</h3>
        <span class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Mon, 17/09/2012 - 21:07</span>
        <div class="content"><p>In discussion with pmcalli on the forum about using a synthetic sine wave for voltage readings combined with a zero crossing detector circuit, for the purpose of solar power divert (aka robins mk2 PV controller) - if this works, then you wouldn&#39;t need a relatively expensive transformer - almost anything will do that reflected zero crossing points accurately.</p>
<p>The link below to code:</p>
<p><a href="https://github.com/stuartpittaway/SolarPowerControllerNoVoltage" title="https://github.com/stuartpittaway/SolarPowerControllerNoVoltage">https://github.com/stuartpittaway/SolarPowerControllerNoVoltage</a></p>
<p>Purely for experimental purposes!</p>
<p>Feel free to discuss.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="789.html" class="topic-previous" title="Go to previous forum topic">‹ Is 2.5V correct for Vref?</a>
              <a href="1050.html" class="topic-next" title="Go to next forum topic">Individual circuit/appliance monitoring ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-6215"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 18/09/2012 - 13:27.</div>
    <div class="content">
     <p>Interesting.</p>
<p>If you don&#39;t have a physical transformer, you won&#39;t know what voltage the mains is running at.&nbsp; Variations of mains voltage will obviously affect the power that is drawn by the dump load.&nbsp; A 3kW load will only draw 60J per cycle if the mains voltage is precisely 240V AC, which it seldom is.</p>
<p>Having said which, for the specific purpose of diverting surplus PV power using the Mk2 algorithm, this variation may not matter.&nbsp; The sole aim of the algorithm is to maintain the net flow through the meter at zero.&nbsp; This is essentially done by balancing packets of current which flow first one way and then the other.&nbsp; Any errors that are introduced by using the <em>nominal</em> voltage to calculate power rather than the measured voltage may well cancel out as energy is imported and exported.</p>
<p>Has the op amp stage for detecting zero-crossing points been posted anywhere?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6217"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 18/09/2012 - 13:37.</div>
    <div class="content">
     <p>Interesting II.</p>
<p>From what I&#39;ve seen, most transformers (which you will need unless you have a direct mains connection with all the safety implications that accompany that) show a shift of the zero crossing point as the first sign of voltage waveform distortion. So using just the zero crossing might not help very much, if at all - except of course it makes it easy to trigger an interrupt routine.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6220"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 18/09/2012 - 17:14.</div>
    <div class="content">
     <p>A couple of correspondents have mentioned using an <a href="http://www.eco-eye.com/ecoeye-microgeneration.html#full">Eco Eye Smart PV</a> monitor.&nbsp; This has a voltage sensor which is wrapped around any cable that is permanently live.&nbsp;</p>
<p>Voltage is &quot;adjusted&quot; by changing the nominal value of 240V either up or down.&nbsp; It may be that this sensor is being used to establish the zero-crossing points, as is being discussed on this thread.</p>
<p>Instruction manual attached.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6226"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1165.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="richmc&#039;s picture" title="richmc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/1165.html" title="View user profile.">richmc</a> on Tue, 18/09/2012 - 21:30.</div>
    <div class="content">
     <p>Would it be more likely to be for phase reference so the device knows if you are importing or exporting?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6228"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 18/09/2012 - 22:13.</div>
    <div class="content">
     <p>Yes, I think you&#39;re right.&nbsp; Maybe this idea would be worth looking at as an alternative form of voltage sensor.&nbsp; It would be ac-coupled, and would no doubt have some phase-shift, but that could easily be accommodated in the software.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6229"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 18/09/2012 - 22:39.</div>
    <div class="content">
     <p>It sounds as if it&#39;s a capacitive potential transformer - yes, I know that appears to be a contradiction in terms, but that&#39;s what they&#39;re called. They are common on high voltage systems. It is simply a voltage divider made up of capacitors. The &#39;top&#39; one is very often a bushing or something like that. I briefly looked at how practical a home-made one would be - a few inches of aluminium foil or an insulated wire wrapped around a meter tail would be the &#39;top&#39; capacitor, and the bottom one would be an ordinary component. The input impedance of the Arduino is sufficient, but the problem is getting a high enough impedance bias to set the input in the middle of the range. And then the combined bias and input impedance make a nice phase shift as you say, so you&#39;re no better off. If you include op-amps, you may be able to get round that problem with a bit of boot-strapping, but I purposely excluded that approach as I was thinking pure emonTx.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6233"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Wed, 19/09/2012 - 08:36.</div>
    <div class="content">
     <p>Although I wrote the software, pmcalli has been testing it out and building a circuit around it.</p>
<p>So far, hes reported that its working very well.&nbsp; Just waiting for some log files to be sent over.</p>
<p>For the zero crossing detector, I simply used a OpAmp comparator against the voltage readings to trigger near 2.5v, although there are plenty of other methods for doing this on the web - perhaps going back to using live mains and a opto-coupler would be a better move - obviously with care for safety.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6234"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 19/09/2012 - 10:06.</div>
    <div class="content">
     <p>interesting idea the capacitive probe. will detect peak voltage not zero cross though and with all these computers flat topping the mains it might have a slow zero cross at peak mains. will get the kitchen foil out and try it.</p>
<p>stuarts code with the synthetic voltage seems to work fine I now have a full tank of hot water.&nbsp; it needs phase correction adding ( just a delay starting the measurement cycle in this case )&nbsp; and testing under power factor loads when corrected.</p>
<p>&nbsp;</p>
<p>plot attached</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6235"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 19/09/2012 - 10:09.</div>
    <div class="content">
     <p>try again</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6236"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 19/09/2012 - 10:15.</div>
    <div class="content">
     <p>zoomed in trace when no excess loads switching but solar increased by 1kW</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6238"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 19/09/2012 - 12:52.</div>
    <div class="content">
     <p>Paul, in your zoomed-in trace, between 1:10 and 1:18, there appears to be around 40W of export taking place.&nbsp; I think this may be a consequence of using synthesized voltage data.&nbsp;</p>
<p>Whenever your dump load is on, it will reduce the mains voltage to some extent.&nbsp; In my house, it&#39;s around 1% for a 3kW load.&nbsp; Unless the instantaneous voltage is actually measured, power contributions at such times will be correspondingly over-estimated.&nbsp; A tendency to leak power to the grid is the predictable consequence, this effect being undetectable with a digital supply meter because the LED will be on anyway in &#39;anti-creep&#39; mode.</p>
<p>As conditions change, so will the rate of firing, and also the rate of leakage.&nbsp; This can&#39;t be offset by a single safety-margin factor.&nbsp; The unknown but finite impedance of the mains can only be accommodated by actually measuring the mains voltage.&nbsp; That&#39;s what the supply meter does, and its the flexibility of the supply meter that we&#39;re trying to work with.</p>
<p>Monitoring the meter&#39;s pulses has to be a useful thing to do.&nbsp; My cut-down Mk2 sketch can do this, the sensor being just three components.&nbsp; The fun bit is how to incorporate knowledge about meter activity into the algorithm.&nbsp; If a pulse is ever seen while&nbsp; power is being diverted to the immersion, that means that the measurement system has clearly drifted w.r.t. the meter, and some remedial tweak could usefully be done at that point.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6240"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 19/09/2012 - 15:16.</div>
    <div class="content">
     <p>Robin&nbsp; firstly the trace was taken with a fluke 345. for some reason it does not like burst fire despite claiming to average in complete cycles. the system was not corrected for phase and I measured this with my analog power meter which shows 20W of export corresponding to the phase error between voltage and current&nbsp; . the rest of the export shown is due to the misreporting of burst fire by the fluke. In phase control measurements the two agree. the same effect is seen with your mk2 sketch. as proof the anlog power meter is reading correctly I have tweaked the phase of the voltage pick off to cause a small import and the analog power meter records the same import as the meter.</p>
<p>I accept your argument that the power measurement (when the triac is on) is 1% higher due to the voltage drop. The system is trying to balance the power so integrated power is zero therefore I would postulate that the biggest effect is at the lowest power to the immersion ie the biggest difference measured between on and off. if we say 3 seconds is the lowest power able to fool the digital meter ( its longer for a disc meter ) then the biggest ratio is 150:1. this means that the error would be 150/149*error ( 1% of 3kW) which is pretty close to 30W. at half power +1.5kW is measured when the triac is on and -1.5kW when its off so error now 15W and gets smaller as the power rises. I have assumed of course that the voltage has not changed during the 3 seconds other than the triac going on or off. As the effect is to export more if your mains impedance is poor and the numbers are so small I suggest its not worth worrying about.&nbsp; the errors due to poor current voltage phase alignment are ten times bigger and could produce import at least in a disk meter with no anti creep to exploit. please feel free to throw rocks at my analysis.</p>
<p>&nbsp;</p>
<p>on the capacitive voltage pick off I built a zero crossing detector fed from a piece of tin foil wrapped around a power line and it produces as expected a transition at the peaks of the voltage 90 out of phase with the zero crossing. this wouldn&#39;t be a problem to use as an interrupt to stuarts code as only the table of voltages would need to be changed. however now the bad news my mains is flat topped due to too many computers with rectifiers&nbsp; in the area or a saturated transformer I suppose and this means it shifts the transition back in time on one half cycle and forward on the second half cycle. for the eco eye I don&#39;t suppose that this is a problem as its probably not speced for poor power factors. but for us it would mean the timing would vary in accordance to how flat topped the mains was. Best solution I think is to use a zero detector on the mains with an opto isolator as they only cost pennies and could be incorporated in the triac firing circuit.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6241"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 19/09/2012 - 16:25.</div>
    <div class="content">
     <p><a href="../user/1149.html" title="View user profile.">pmcalli</a></p>
<p>&quot;the capacitive probe will detect peak voltage&quot; WHAT? ? HOW?&nbsp; Justify!</p>
<p>&quot;on the capacitive voltage pick off I built a zero crossing detector fed from a piece of tin foil wrapped around a power line and it produces as expected a transition at the peaks of the voltage 90 out of phase with the zero crossing.&quot;</p>
<p>It shouldn&#39;t do that - it sounds as if you&#39;ve left out half of the divider chain! A circuit diagram of what you actually have is required.&nbsp;&nbsp; I&#39;ve just quickly thrown together a simulation with a bootstrapped op-amp and it follows the input waveform exactly with about &frac12;&deg; phase shift.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6242"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 19/09/2012 - 17:01.</div>
    <div class="content">
     <p>robert</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; didn&#39;t think about it much so its almost certainly wrong. I just wrapped a piece of foil around a live wire and fed it into a non inverting input of opamp with 100k to deck on biploar supplies so it looks like its really measuring leakage I suppose but that doesn&#39;t sound right either. what circuit have you proposed two contact arrangement?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6244"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 19/09/2012 - 17:14.</div>
    <div class="content">
     <p><em>pmcalli: the errors due to poor current voltage phase alignment are ten times bigger and could produce import at least in a disk meter with no anti creep to exploit. please feel free to throw rocks at my analysis.</em></p>
<p>The purpose of the PHASECAL calculation is to correct for any misalignment of voltage and current.&nbsp; Once setup correctly, there should be minimal error from this source.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6245"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 19/09/2012 - 17:49.</div>
    <div class="content">
     <p>The purpose of the PHASECAL calculation is to correct for any misalignment of voltage and current.&nbsp; Once setup correctly, there should be minimal error from this source</p>
<p>there you have it &quot; once set up &quot; I agree you can remove the time error between current sample and voltage sample&nbsp; and characterize the advance from the CT but the voltage samples coming from the transformer will move with everything you can think of unless you buy a specialized transformer ( expensive) . If you are operating in a power factor of 1 environment you wont have a problem but its becoming common place to fit things like heat pumps combined with solar and my experience ( very limited ) so far is they have very bad power factors hopefully this will change as the market matures or domestic installations are more regulated.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6246"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ericw&#039;s picture" title="ericw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by ericw (not verified) on Wed, 19/09/2012 - 18:39.</div>
    <div class="content">
     <p>Using a capacitive pickup gives a voltage about 90 degrees out of phase with the mains. It also exaggerates any high frequency spikes on the mains waveform.</p>
<p>However if you are just using it for phase/zero crossing detection with suitable delay it doesn&#39;t need a mid rail bias circuit but can be taken through a small current limiting resistor to an input. A pair of diodes to the supply rails to limit the voltage swing is advisable rather than relying on the internal ESD protection diodes.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6248"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 19/09/2012 - 19:05.</div>
    <div class="content">
     <p>robert ericw</p>
<p>&nbsp;</p>
<p>now I have had a chance to think about Roberts comment and read his earlier post more carefully. I think I see that what I should have done was capacitively divide ie foil wrapped around conductor with a small cap connected to it and ground and then feed into high impedance op amp. the cap will have to be small and the op amp i/p impedance very high but it will be in phase. can you confirm robert and do you have any suggestions for parts.</p>
<p>you also stated that arduino inputs are high impedance don&#39;t be fooled by the spec of 100M ohms its misleading because of the adc sample and hold so source impedance of no more than 10k is recommended</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6251"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 19/09/2012 - 20:11.</div>
    <div class="content">
     <p><a href="../user/1149.html" title="View user profile.">pmcalli</a></p>
<p>What you had was the classic RC first order filter. OF COURSE it will show a 90&deg; phase shift. Think of a standard resistive potential divider and replace the resistors with capacitors, bearing mind capacitive impedance is proportional to 1/C, so the biggest value is at the bottom.</p>
<p>You end up with something like this (attached).<br />
	NOTE: this was quickly thrown together. It needs properly checking. It&#39;s set up for 1 V p-p swing into a 1 V input. The op-amp is bootstrapped and should happily drive the input. Bootstrapping of course means that the choice of op-amp is less critical.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6252"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Wed, 19/09/2012 - 20:12.</div>
    <div class="content">
     <p>Just for my benefit + understanding.</p>
<p>The &quot;capacitive potential transformer&quot; is using the copper in mains cable as one &quot;plate&quot; of the capacitor, the insulation on the cable as the insulator and then the alu foil the other plate.&nbsp; Which is then connected to a &quot;real&quot; (low value) capacitor and ground/earth.</p>
<p>This then generates a voltage which is proportional to the AC wave voltage?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6254"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Wed, 19/09/2012 - 20:59.</div>
    <div class="content">
     <p>Robert, I&#39;ve copied your circuit into CircuitLab, link below if anyone wants to try it out online...</p>
<p><a href="https://www.circuitlab.com/circuit/9g7fj8/capacitive-p_t-bootstrapped/" title="https://www.circuitlab.com/circuit/9g7fj8/capacitive-p_t-bootstrapped/">https://www.circuitlab.com/circuit/9g7fj8/capacitive-p_t-bootstrapped/</a></p>
<p>Just press F5 to re-run the simulation when you are in the editor.</p>
<p><img alt="" src="https://www.circuitlab.com/circuit/9g7fj8/screenshot/220x165/" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6255"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 19/09/2012 - 21:02.</div>
    <div class="content">
     <p>Sorry, Robert, could you remind me what &quot;bootstrapping&quot; means in this context please?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6257"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Wed, 19/09/2012 - 21:53.</div>
    <div class="content">
     <p>stuart</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; its the other way up on a capacitive divider the highest voltage is developed across the lowest capacitance. so to divide the voltage of 240 V to a few volts cap in the bottom needs to be many times the cap of the foil which is only a few pf. should have known this stuff from designing high voltage power supplies where if you get an air bubble in the potting compound it looks like a small cap develops all the voltage across it and sets up a plasma which burns its way through the potting. its worth a bit more experimentation thanks for the circuit robert</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 19/09/2012 - 21:56.</div>
    <div class="content">
     <p><a href="../user/450.html" title="View user profile.">stuart</a></p>
<p>Exactly. The 15 pF capacitor is the one that uses the cable as one plate, the insulation &amp; sheath as the dielectric and the foil as the second plate (add or remove foil to trim the value, but don&#39;t cut into the cable!). But the &quot;real&quot; (bottom) capacitor isn&#39;t low value, it is high value (low impedance). If it was a resistive divider, the ratio would be 100 k (top) and 1.2 k (bottom) (say), using capacitors it&#39;s 15 pF (top - high impedance, about 212 MOhms) and&nbsp; 12 nF (bottom - low impedance, about 265 kOhms).</p>
<p>N.B. there&#39;s no way you will get a dangerous current through a 15 pF capacitor. I got that value as being roughly a few cm of cylindrical capacitor with the same dimensions as a meter tail. If you get more capacitance than that with your foil, increase the 12 nF to reduce the output voltage and compensate. If you use screened cable, reduce the 12 nF to compensate. All values will need tweaking to get useful results!</p>
<p>If you need to generate an interrupt, you feed the op-amp into a normal level detector or whatever. If you want to use it as the voltage reference, then it&#39;s usable as-is.</p>
<p><a href="../user/956.html" title="View user profile.">calypso_rae</a></p>
<p>It is raising the effective impedance of the 330 kOhm resistor artificially by feeding the opposite end from the signal with the signal voltage (nearly) taken from after the amplifier (via the 10 uF), so that with the same signal at both ends, no current flows and the impedance is close to infinite. So the signal, rather than being pulled down by that resistance, is pulling itself up by its own bootlaces through the action of the amplifier. Note it is crucial that the amplifier has a gain of less than unity, which is the case with the follower configuration (and no, the gain <strong>isn&#39;t</strong> exactly 1, though a lot of texts say that - it is fractionally less, and that allows the configuration to work and not be unstable).</p>
<p><a href="../user/1653.html" title="View user profile.">ericw</a></p>
<p>Sorry, but you&#39;re barking up the wrong tree.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6295"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pmcalli&#039;s picture" title="pmcalli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by pmcalli (not verified) on Sat, 22/09/2012 - 13:08.</div>
    <div class="content">
     <p>progress update</p>
<p>Stuart and I have updated the sketch to extend the voltage table to correct for phase difference between voltage and current this is now simply done by offsetting the index of the table by up to +/- 1 cycle with a resolution of 100uS (1.8 degrees ) you can have any resolution you like by extending the table. one of the digital outputs is now set at start and stop of measurement so that you can see what&#39;s going on with a scope which has revealed an anomaly between the measurement interrupt and the zero cross which in debug mode shows as extra noise in the power reading. adding a small delay at zero cross removes the noise but i am confident Stuart will find the real reason shortly. noise with the delay is under 1W and readings can be taken at 200 samples per cycle even in debug. any amount of code can be added outside the interrupt handlers without affecting measurements very nice well done Stuart.</p>
<p>I have been delving in the past for a suitable simple zero cross trigger. it doesn&#39;t have to be exactly at zero just before is good as long as its constant. I found a sync circuit we used in 1976 for syncing the mains via an interrupt to a 4040 ( no jokes or abusive remarks please ). I also found a similar circuit on dextrel but for all zero crossing rather than just positive or negative. bit of a mash between the two and he presto here&nbsp; is a super zero synch which can be used on mains ( 110 or 240) or transformer ( value change ). it produces an opto isolated pulse with an edge about 1ms in advance of zero cross. it is almost immune to temp and voltage value. it needs a few hundred ms on start up to synch but there after its rock solid. I think I will be using this circuit as the cost is very small low voltage components for all but the input resistors and opto plus completely safe once built. circuit attached.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6344"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ericw&#039;s picture" title="ericw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by ericw (not verified) on Tue, 25/09/2012 - 14:26.</div>
    <div class="content">
     <p>Robert</p>
<p>What happens during the negative half cycles in your circuit.?</p>
<p>Presumably as the output of the op-amp cannot go below the negative rail, it comes out of bootstrap mode and&nbsp;C2 will be slowly charged through R5 until the opamp input no longer goes negative. This however will give you an output which will be dependent on the magnitude of the mains voltage with&nbsp;it&#39;s negative peak &#39;clamped&#39; to ground rather than having&nbsp;the zero crossings at a fixed voltage.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6345"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 25/09/2012 - 15:19.</div>
    <div class="content">
     <p><span style="display: none;">What happens during the negative half cycles in your circuit.?</span><em>&quot;What happens during the negative half cycles in your circuit.?</em>&quot;</p>
<p>Much the same as during the positive half cycles, but 10 ms later and the other way up! ! ! ! ! ! !</p>
<p>If the op-amp output gets too close to either rail, feedback action fails and that&#39;s another story. The general idea is to not overdrive the input. Are you forgetting that the values are intended for use with a 1.1 V reference and therefore the input peak-peak swing should not exceed this?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ericw&#039;s picture" title="ericw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by ericw (not verified) on Tue, 25/09/2012 - 16:44.</div>
    <div class="content">
     <p>In the absence of leakage in the capacitors would you not expect the voltage at the tap to be swinging symetrically about ground. ? This would be regardless of the magnitude of the signal. Until some DC bias has been generated on C2 the opamp will not be able to track&nbsp;negative half cycles.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6351"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Divert with no voltage readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 25/09/2012 - 18:44.</div>
    <div class="content">
     <p><em>&quot;In the absence of leakage in the capacitors would you not expect the voltage at the tap to be swinging symetrically about ground?&quot;</em></p>
<p>Yes I would,<em> <strong>in the absence of a connection to the 0.55 V bias supply via R3</strong></em><strong>. </strong></p>
<p><em>&quot;Until some DC bias has been generated on C2 the opamp will not be able to track&nbsp;negative half cycles.&quot;</em></p>
<p>And how long do you think that takes from switch-on? (To within 0.7% of the final settled value is good enough).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/1059"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Q-vTso7fbFg2F15gqaQrP29yaEe1-wne3ZXztKJMsow" value="form-Q-vTso7fbFg2F15gqaQrP29yaEe1-wne3ZXztKJMsow"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
