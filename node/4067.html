<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/4067 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:50:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emoncms 8.0 (debian packaged) | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emoncms 8.0 (debian packaged)</h3>
        <span class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sat, 15/03/2014 - 11:48</span>
        <div class="content"><p>This topic is an attempt to finalize <a href="3919.html">debian-packaging&nbsp;emoncms</a>&nbsp;now <a href="4065.html">8.0 has hit master</a>.</p>
<p>Because there&#39;s a directory restructure involved, it is not ideal for people to fork one version of emoncms&nbsp;(debian versioned or &quot;direct&quot;) if they later wish to merge changes into the other.</p>
<p>Because I hope we&#39;ll ultimately have a simple debian-packaged approach for everyone, I&#39;d like to move quickly to get a workable set of changes &nbsp;so that I can issue a pull request on this stuff.</p>
<p>PB66 has been kindly helping me try it out as a clean install (I&#39;ve been focusing on the upgrade path for my existing install). It would be particularly useful if there were any other volunteers who don&#39;t mind helping out, so we can flush out as many issues as possible.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="4392.html" class="topic-previous" title="Go to previous forum topic">‹ Emoncms updating very slowly/irregularly</a>
              <a href="4233.html" class="topic-next" title="Go to next forum topic">Logging accumulating inputs ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-19269"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 15/03/2014 - 12:28.</div>
    <div class="content">
     <p>Great Schism, Happy to help out, I agree it would be best to upgrade using the debian package once its ready rather spend time doing this twice.</p>
<p>Would be great to get redis in there as default, It looks like php5-redis is maintained by the same poeple as the pecl redis package, there are quite a few different redis clients around for php the c based one being a fair bit faster. Is it possible though to add pecl based installation as its needed for serial dio package?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19270"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 15/03/2014 - 12:34.</div>
    <div class="content">
     <p>Whats the difference between the debian versioned or direct? apart from location of install?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19272"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sat, 15/03/2014 - 12:39.</div>
    <div class="content">
     <p>(re: redis etc) - these things are separate to the debian packaging of emoncms itself- the way we install emoncms should be transparent to redis and vice-versa. &nbsp;i.e. we could potentially package up the serial PHP code too, but it would be separate and you could either choose PECL or apt to set it up.</p>
<p>I&#39;m having a little trouble just now getting the SMTP configuration added to the emoncms&nbsp;debian install process. Once that works, I&#39;ll update my apt-repo and make a post with an initial install guide. If you can correct it, that will help me understand the interaction of the different systems.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19273"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sat, 15/03/2014 - 12:45.</div>
    <div class="content">
     <p>There&#39;s no code difference between the two versions, it&#39;s just that in the debian-packaged version I&#39;ve put together, the directory structure isn&#39;t the same. I have&nbsp;debian/ www/ config/ etc. and only &nbsp;www/ is copied out to be served by apache (while config/ contains things like the sites-available definition for serving emoncms, potentially db configuration, and so on).</p>
<p>When I merged in v8 to my working branch, all the files I&#39;d moved updated without conflicts, but the new files (node module, for example) appeared under ./Modules/node rather than ./www/Modules/node/</p>
<p>It&#39;s not something that would take more than a few minutes to resolve, but just something to be aware of.</p>
<p>Rather than getting people to clone a git repo into /var/www, I suggest that the install steps for non-apt based emoncms would be something like &quot;clone the repository. Copy the www/ directory to /usr/share/emoncms/, copy the config/emoncms file to /etc/apache2/sites-available/&quot; and so on. Nesting the git repositories as we currently do is not great because some git commands on emoncms/ can mangle the module repos in subdirectories, so that&#39;s a straight benefit regardless of the debian packaging approach.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19275"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5417.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5417.jpg" alt="Hertog&#039;s picture" title="Hertog&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5417.html" title="View user profile.">Hertog</a> on Sat, 15/03/2014 - 13:25.</div>
    <div class="content">
     <p>If the data-providers (be it PHP, Python or whatnot) are separated from the &#39;main&#39; CMS, wouldn&#39;t it be possible to create a virtual package that provides the functionality?</p>
<p>&nbsp;</p>
<p>So, if you don&#39;t need the pecl DIO module (because you use the python script for example) EmonCMS&nbsp;would depend on the virual&nbsp;redis package, which in turn provides one of the various packages (be it the C or the pecl version). If however you use the PHP script, you would get a hard dependency on the pecl verion of redis, and a blocking on the C version (with all kind of hints how to solve that if the C version is already installed).</p>
<p>It would be great if it where possible to make the&nbsp;EmonCMS&nbsp;package modular in that way.</p>
<p>Keep in mind, my Debian knowledge is rusty, as I&#39;m more of a FreeBSD and Gentoo&nbsp;guy. I&#39;ll pop in a blank SD card in a spare pi to try out the packages sounds great!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19277"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sat, 15/03/2014 - 13:52.</div>
    <div class="content">
     <p>I&#39;m not really familiar with the engines within emoncms&nbsp;or how they integrate. Abstractly, the ideal would be if there was just one default that is always supported (mysql?) and additional engines that could be added or not as the admin pleases.</p>
<p>If this was the case, at least from a debian packaging point of view, we could make emoncms&nbsp;depend on a virtual package called &#39;emoncms-engine&#39; and then package up things like &#39;emoncms-engine-redis&#39; which are marked as providing &quot;emoncms-engine&quot;. That way you could have as many or as few engines as you liked (and the respective debian package installations would set those engines up, freeing this worry from emoncms itself).</p>
<p>It would be cool just to get it to install the way it is however :P</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19282"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sun, 16/03/2014 - 07:59.</div>
    <div class="content">
     <h3>
	<b>emoncms v8 upgrade procedure (verified against Jan 2014 HDD image)</b></h3>
<p><b>I&#39;ve based this on the <a href="https://github.com/emoncms/emoncms">readme&nbsp;on github</a>, but adapted things for an installation using debian-packaged&nbsp;modules which I&#39;ve forked - see my own <a href="https://github.com/Dave-McCraw">github</a>&nbsp;for the source.</b></p>
<p><u>1. Backup</u></p>
<p>Back up your existing installation. I recommend <a href="http://emoncms.org/site/docs/backup">approach 2</a>.</p>
<p>Relocate your current&nbsp;emoncms&nbsp;filesystem to prevent any possible confusion with the debian installation:</p>
<pre>
<strong>sudo mv /var/www/emoncms /var/www/old-emoncms</strong></pre><p><u>2. Pre-requisites</u></p>
<p>The emoncms debian package ensures all dependencies (that are <a href="https://github.com/emoncms/emoncms/blob/master/readme.md">listed here</a>) are installed automatically.&nbsp;</p>
<p>However, it can&#39;t do anything about PECL. I&#39;ve reproduced the configuration steps from the readme&nbsp;here for completeness:</p>
<p><em>Install pecl dependencies (serial, redis and swift mailer)</em></p>
<pre>
<strong>sudo pear channel-discover pear.swiftmailer.org
sudo pecl install channel://pecl.php.net/dio-0.0.6 redis swift/swift</strong></pre><p><em>Add pecl modules to php5 config</em></p>
<pre>
<strong>sudo sh -c &#39;echo &quot;extension=dio.so&quot; &gt; /etc/php5/apache2/conf.d/20-dio.ini&#39;
sudo sh -c &#39;echo &quot;extension=dio.so&quot; &gt; /etc/php5/cli/conf.d/20-dio.ini&#39;
sudo sh -c &#39;echo &quot;extension=redis.so&quot; &gt; /etc/php5/apache2/conf.d/20-redis.ini&#39;
sudo sh -c &#39;echo &quot;extension=redis.so&quot; &gt; /etc/php5/cli/conf.d/20-redis.ini&#39;</strong></pre><p><u>3. Install emoncms</u></p>
<p>Add a line to your /etc/apt/sources.list so that the Pi can access the new Openenergymonitor&nbsp;packages:</p>
<pre>
<strong>sudo echo &quot;deb <a href="http://emon-repo.s3.amazonaws.com/" title="http://emon-repo.s3.amazonaws.com">http://emon-repo.s3.amazonaws.com</a> wheezy unstable&quot; &gt;&gt; /etc/apt/sources.list</strong></pre><p>Now update apt:</p>
<pre>
<strong>sudo apt-get update</strong></pre><p>You should be able to see the core&nbsp;emoncms, raspberrypi and event modules coming in (these are the only components of emoncms which are currently supported using this install method).&nbsp;</p>
<p>Install:</p>
<pre>
<strong>sudo apt-get install emoncms</strong></pre><p>The installer should pop up a bunch of questions about your emoncms&nbsp;DB settings, as well as SMTP options. You must supply the first four pieces of information: DB username and password, DB host, and database name (which will be created if it doesn&#39;t already exist).</p>
<p>Consult your existing settings.php file for a reminder - it&#39;s at /var/www/old-emoncms/settings.php</p>
<p>The debian installer will create a valid settings.php file at the end of the installation, and put it in the right place. If you don&#39;t get asked these questions, or if you need to change one of the answers, run this command:</p>
<pre>
<strong>sudo dpkg-reconfigure emoncms --force</strong></pre><p>This is the preferred way of updating the settings.php file because when the time comes to update to emoncms v9 <em>you just need to confirm the answers again</em> - even if the format of the v9 settings.php file is completely different. On the other hand, if you edit settings.php by hand, when v9 comes along your original answers to the questions would be used, rather than anything you edited in by hand.</p>
<p><u>4. Apache configuration</u></p>
<p>We need to tell apache to switch on emoncms:</p>
<pre>
<strong>sudo a2ensite emoncms</strong>

<strong>sudo /etc/init.d/apache2 reload</strong></pre><p>Now you should be able to load emoncms in your browser at <a href="http://your-pi-address/emoncms and" title="http://your-pi-address/emoncms and">http://your-pi-address/emoncms and</a> see it working.</p>
<p><u>5. Install raspberrypi module</u></p>
<p>To add the raspberrypi module, run</p>
<pre>
<strong>sudo apt-get install emoncms-module-rfm12pi</strong>

<strong>sudo service rfm12piphp restart log</strong></pre><p>(I recommend running with logging until you&#39;re sure the system is stable - especially on an HDD!)</p>
<p><u>6.Install event module</u></p>
<p>Even simpler:</p>
<pre>
<strong>sudo apt-get install emoncms-module-event</strong></pre><p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19283"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sat, 15/03/2014 - 16:44.</div>
    <div class="content">
     <h3>
	Emoncms v8 (debian packaging) work items</h3>
<p>Here&#39;s a list of things which should be addressed before we pull the &quot;debianized&quot; changes into master:</p>
<ol>
<li>
		PECL prerequisites</li>
<li>
		Support all existing modules</li>
<li>
		Agree on a git policy</li>
<li>
		Upgrade plan for non-debian or shared hosting users</li>
<li>
		&quot;help!&quot; guide for people who git pull the debian source tree into a legacy installation</li>
<li>
		???</li>
</ol>
<p>In order:</p>
<p><u>1. PECL prerequisites</u></p>
<p>It would be great if we could eliminate the manual config&nbsp;above (redis, swiftmailer and serial).</p>
<p>Based on a quick google, we have <a href="https://packages.debian.org/wheezy/libphp-swiftmailer">libphp-swiftmailer </a>right now, <a href="https://packages.debian.org/sid/php5-redis">php5-redis</a> (looks to be the same as the PECL module, but not available in wheezy) and no sign of dio&nbsp;at all. Could/should we debian package it (and host the php5-redis package on our own apt repo for the time being?</p>
<p>This is definitely a &#39;nice to have&#39; rather than a prerequisite.</p>
<p><u>2. Support all existing modules</u></p>
<p>You can add one of the non-debian modules to the debian-installed version of emoncms&nbsp;just by checking out its git repo as usual (but into /usr/share/emoncms/www/Modules/ instead of /var/www/...) however, it would be better just to add debian support to these.</p>
<p>At least one (packetgen) depends on some weirdness that looks like it needs a refactor before it could be packaged (has to modify raspberrypi module file). Others unclear.</p>
<p><u>3. Agree on a git&nbsp;/ debian policy</u></p>
<p>Not essential as committing things to master on git won&#39;t do anything to the apt repository, so in that sense we will already gain (extra) control over releases. However, we should agree on a tagging system to be used to mark where different versions in apt were taken from, and also create some more controlled git branches for contributors (rather than just having one &#39;rework&#39; branch).</p>
<p>If we don&#39;t do this it will be hard to know what&#39;s in apt at any given time, since the git metadata is not part of debian packaging.</p>
<p>We should also start thinking about how we&#39;ll offer incremental upgrades. Just for an example: if something doesn&#39;t require any installation steps, could it be released as v8.1 next week (with a major version increment reserved for releasing something that needs manual intervention)?</p>
<p><u>4. Upgrade plan for non-debian or shared hosting users</u></p>
<p>Needless to say, if you aren&#39;t a debian admin then this packaging step isn&#39;t very exciting - in fact it makes installation of emoncms a little bit more challenging.</p>
<p>Instead of just cloning emoncms into /var/www, you&#39;ll now need to clone it into /usr/share/emoncms/ and symlink it into place.</p>
<p>It&#39;s not rocket science, but a solid guide to non-debian installation of the debian version is really a prerequisite to updating master.</p>
<p><u>5. &quot;Help!&quot; guide for legacy installations which are updated</u></p>
<p>If someone pulls the debianized master of emoncms&nbsp;into a /var/www/emoncms/ git repo then their installation will stop working. This will be an ongoing problem until everyone with an old install who is prone to upgrading it out of the blue has done so - a clear guide to give them would be preferable...</p>
<p>Anything else?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19285"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5417.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5417.jpg" alt="Hertog&#039;s picture" title="Hertog&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5417.html" title="View user profile.">Hertog</a> on Sat, 15/03/2014 - 17:05.</div>
    <div class="content">
     <p>I&#39;ll have a look at dh-make-php, to see if that can help creating a .deb for the dio&nbsp;module.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19289"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5417.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5417.jpg" alt="Hertog&#039;s picture" title="Hertog&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5417.html" title="View user profile.">Hertog</a> on Sat, 15/03/2014 - 18:24.</div>
    <div class="content">
     <p>This .deb of DIO seems to work for me: (dropbox&nbsp;link)&nbsp;https://db.tt/3lG3u811 (note: for Debian on Arm -&gt; Raspberry Pi)</p>
<p>Created it with the dh-make-php, &#39;twas real easy too :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19302"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sun, 16/03/2014 - 07:57.</div>
    <div class="content">
     <p>I&#39;ve pushed a new version to the apt repo: version 8.0-1 &nbsp;(that version number means: v8.0 of emoncms, debian packaging increment 1)</p>
<p>This is intended to help out with the <a href="4070.html">can&#39;t create feed</a> problem by making sure the feed directory structure/permissions are OK as part of the debian install.</p>
<p>Probably worth pointing out that I&#39;ve added a news file as well as a debian changelog to emoncms&nbsp;as part of this effort, and direct your attention to apt-listchanges.</p>
<pre>
<strong>sudo apt-get install apt-listchanges</strong>

<strong>sudo dpkg-reconfigure apt-listchanges</strong></pre><p>I choose the following: &#39;text&#39;, &#39;yes&#39; (remember seen changes), no email notification (empty), news, &#39;yes&#39; (confirmation)</p>
<p>Now (assuming you&#39;re running yesterday&#39;s&nbsp;emoncms&nbsp;version 8.0):</p>
<pre>
<strong>sudo apt-get update</strong>

<strong>sudo apt-get install emoncms</strong></pre><p>You&#39;ll see this output:</p>
<pre>
Reading package lists... Done
Building dependency tree      
Reading state information... Done
The following packages will be upgraded:
  emoncms
1 upgraded, 0 newly installed, 0 to remove and 24 not upgraded.
Need to get 759 kB of archives.
After this operation, 1,024 B of additional disk space will be used.
WARNING: The following packages cannot be authenticated!
  emoncms
Install these packages without verification [y/N]? y
Get:1 <a href="http://emon-repo.s3.amazonaws.com/" title="http://emon-repo.s3.amazonaws.com/">http://emon-repo.s3.amazonaws.com/</a> wheezy/unstable emoncms armhf 8.0-1 [759 kB]
Fetched 759 kB in 1s (745 kB/s) 
Reading changelogs...
emoncms (8.0-1) unstable; urgency=low

  This version contains incremental updates to the installation procedure:
  in this case, ensuring the filesystem for the various types of feed exists
  and has the correct ownership.

-- Dave McCraw &lt;dave@mccraw.co.uk&gt;  Sun, 16 Mar 2014 07:09:08 +0000

apt-listchanges: Do you want to continue? [Y/n]</pre><p>I think this should be pretty useful when it comes to helping people upgrade without breaking their installations / making clear the scope of each change. It just requires whoever updates the apt repository to run dch --news and give a new entry for each version :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19328"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sun, 16/03/2014 - 18:52.</div>
    <div class="content">
     <p>Dave: Looks great!</p>
<p>Thinking about your point 3: Agree on a git / debian policy</p>
<p>Lets say there are 3 main types of update: Bug fixes, Refactoring, New features.</p>
<p>If in the future most people are testing via the debian package then we need to get bug fixes from git into the debian package quickly, refactoring and new features don&#39;t need such a high priority.</p>
<p>Am I right that every change to the debian package needs to be a sub version increment? or that it would be good for it to be?</p>
<p>I guess it makes sense if the git master branch is a mirror of the debian package state as its probably easier to check the git commit log to see what the exact code changes are than open the deb package. We could then potentially have some kind of automatic debianization from the master branch, a script checking if the master branch has changed once a minute and rebuilding on change.. would this work?</p>
<p>The current emoncms git workflow is similar to this: https://www.atlassian.com/git/workflows#!workflow-gitflow although not always strictly adhered too. What do you think of if we where to have a continuous develop branch with feature branches and every merge into the master branch could be tagged with a version number with if possible the master automatically linked to the apt package?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19336"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Mon, 17/03/2014 - 06:58.</div>
    <div class="content">
     <p>I&#39;ve taken a look at that atlassian workflow and it looks good to me. But note that develop hangs around across multiple releases - you should try never to delete branches (not everyone can handle a complex rebase, especially after a long time has passed).</p>
<p>I wouldn&#39;t try to overthink the debian packaging. You wouldn&#39;t normally look at the deb for anything (always referring to git), and anyone&nbsp;can build and install their own .deb by checking out a fix branch (or the develop branch) from git and running a simple command.</p>
<p>When the master branch advances, incrementing the debian changelog and news files allows us to build a new .deb and get it onto the apt repo, where everyone else can upgrade to it.</p>
<p>I suggest that we simply move up 0.1 of a version every time master advances with new features, and 0.0.1 for bug fixes. This means that addressing the issues with visualisations last night puts us on emoncms 8.0.1 - in this way it&#39;s really obvious what people are running when we ask them, and they will have an expectation of what they&#39;re upgrading to based on consistent versioning?</p>
<p>You can number the develop branch differently: ideally it would keep up with master and you&#39;d number it something like 8.0.1-develop so that it&#39;s obvious when someone is running unreleased code too.</p>
<p>We could have some script that monitored git and pushed new stuff to apt, but I&#39;d be worried it might go off-piste for some reason. I&#39;d think we probably just want to manually build and push .debs for new master increments for now, since the super keen can build themselves from source.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19361"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 18/03/2014 - 02:18.</div>
    <div class="content">
     <p>A little bit of progress here, although I had a titanic distraction due to feeds not updating simply because I hadn&#39;t restarted rfm12bpiphp...</p>
<p>As part of troubleshooting I&#39;ve broken out the &#39;myelectric&#39; module into its own debian package - emoncms-module-myelectric (it looked like it might have killed apache, I&#39;m not sure, but figured it wouldn&#39;t hurt if it was installable separately?)</p>
<p>The notify module seems to be a subset of event in terms of functionality, so I&#39;m thinking that we could take this opportunity to consolidate by only migrating event to a&nbsp;debian packaged version?</p>
<p>I&#39;ve migrated openbem (emoncms-module-openbem) and sync (emoncms-module-sync , suffers from <a href="4074.html">this issue</a>) and pushed them up to the apt repo.</p>
<p>packetgen is the obvious outstanding one - I&#39;m not sure what the difference is between the rfm12pi version of the file and the one contained in packetgen though, so I&#39;m not sure I want to proceed (I don&#39;t think &quot;copyto_raspberrpi_module&quot; is a strategy that&#39;s going to work in a debian-based&nbsp;install).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19362"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 18/03/2014 - 02:17.</div>
    <div class="content">
     <p>I gave a little bit of thought to the two documentation scenarios described above too.</p>
<p>1. People pull the latest code from git without realising that it&#39;s now the source for a packaged application, not something for cloning into /var/www:</p>
<p>- we provide a tag on master called something like &quot;last pre-debian version&quot; and advise people who do this that they either need to switch to a debian-based install or run git&nbsp;reset --hard onto that tag.</p>
<p>2. People want to carry on upgrading their install but can&#39;t use (or prefer not to use) the debian packages.</p>
<p>The simple solution to this is to clone the repositories outside of /var/www and then symlink them in.</p>
<p>That is, you could check out emoncms (debian version) into /usr/share/emoncms and then replace the old /var/www/emoncms directory with a symlink to /usr/share/emoncms/www/ - modules would be much the same (you just symlink www/ to /var/www/emoncms/Modules/foomodule).</p>
<p>In theory I don&#39;t see any major obstacles to pulling these debian changes into master, so long as we&#39;re happy to potentially have a few support topics where people are like &quot;wtf... I git pulled and it&#39;s not doing what I expected&quot;.</p>
<p>Worth the price for a nice consistant install IMO (but then I would say that!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19366"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 18/03/2014 - 10:02.</div>
    <div class="content">
     <p>Bold suggestion: should we make the debian-packaged version of emoncms / modules available as completely new git repositories? We could do this by forking them internally within the emoncms github account and renaming, I think.</p>
<p>Pros:</p>
<ul>
<li>
		people who update by pulling the git repo into /var/www/ won&#39;t have their installs broken or need to take any special actions</li>
<li>
		we can formalize the repo names to match the package names (i.e. you&#39;ll be able to tell by the repo name that something is an emoncms module, a gateway, or whatever)</li>
<li>
		we can run side-by-side for a while and tease out any issues while maintaining the existing v8.0 repo for people who don&#39;t want to be guinea pigs</li>
<li>
		If we don&#39;t support a particular module yet, it doesn&#39;t matter - people can stick to the old non-debianized version or do a manual install until someone submits a pull request that fixes it.</li>
<li>
		In the worst case scenario, suppose we decide we hate the debian&nbsp;versioned procedure, we could just make sure all changes are in the original repos and then drop support.</li>
<li>
		On the other hand, when we decide to stop officially supporting the &#39;clone into /var/www/&#39; method, there won&#39;t be anything stopping other people from maintaining it themselves, if they like. They&#39;ll easily be able to track upstream changes from the new repos if they reconfigure git.</li>
</ul>
<p>Cons:</p>
<ul>
<li>
		Even though github should support this as a fork and rename, because the file structure of the two repos would be different, pull requests might need a bit of manual merging to bring them across from one to the other.</li>
<li>
		It might discourage contributions by confusing people as to WTF is going on?</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19374"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1741.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1741.jpg" alt="ukmoose&#039;s picture" title="ukmoose&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/1741.html" title="View user profile.">ukmoose</a> on Tue, 18/03/2014 - 12:29.</div>
    <div class="content">
     <p>Anything that simplifies the install process is to be encouraged, as it&#39;s clear from the forum posts that it is something that trips up quite a few people. However the people that get tripped up tend to be the less technical minded, these aren&#39;t necessarily the ones using Raspberry Pi&#39;s.</p>
<p>My concerns are:</p>
<ul>
<li>
		Currently Emocnms works on Operating systems that aren&#39;t going to support debian package, so changing underlying modules isn&#39;t a trivial task.<br />
		&nbsp;</li>
<li>
		Need to check that all supported OS&#39;s have some form of easy&nbsp;symlinking&nbsp;if the underlying&nbsp;directory structure is going to change. &nbsp;Should we be making the install on non&nbsp;debian more complicated to make debian easier? &nbsp;&nbsp;<br />
		&nbsp;</li>
<li>
		Need way of determining how you installed Emoncms ( the average person isn&#39;t going to remember) so need numbering system displayed in Emoncms that incorporates install method (e.g. v8.0.2DP)&nbsp;<br />
		&nbsp;</li>
<li>
		Need version control parity between installation methods. &nbsp;Currently we have V8.0.1 on debian&nbsp;package and&nbsp;v8.0 pre release on github master, (with Github emoncms&nbsp;releases showing latest release to be v7.0)</li>
</ul>
<ul>
<li>
		Need clarity on what is the master. &nbsp;Trystan&#39;s comment earlier in the thread &quot;git master branch is a mirror of the debian package&quot; scares me. &nbsp;Surely a method of install for specific OS should be a mirror of a non-OS specific master?</li>
</ul>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19375"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Tue, 18/03/2014 - 12:30.</div>
    <div class="content">
     <p>Hi</p>
<p>I have been following this by installing on a spare Pi. As far as I can tell every thing has worked each time I have run a new update. I can log in without trouble. ( I have no inputs as yet so I can go no further at this stage).</p>
<p>I did a &nbsp;rfm12piphp restart as suggested and got the following message. May not be significant to you but I thought I would let you know.</p>
<p>PHP Notice:&nbsp; Undefined variable: timestore_adminkey in /usr/share/emoncms/www/Modules/raspberrypi/raspberrypi_run.php on line 36</p>
<p>Is this because I have to locate and enter the adminkey in raspberrypi_run.php?</p>
<p>Regards&nbsp;</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19377"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 18/03/2014 - 12:48.</div>
    <div class="content">
     <p>I saw that, Ian, and I&#39;m not sure why it wouldn&#39;t use the timestore key from settings.php since it already shares some of the PHP classes. Something to look into.</p>
<p><span style="font-size: 12px;">I could potentially add a separate </span>config<span style="font-size: 12px;"> file for the </span>rfm12piphp<span style="font-size: 12px;"> module and get the </span>debian<span style="font-size: 12px;"> installer to configure the key value as it does for main emoncms.</span></p>
<p>Thanks for trying this :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19378"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 18/03/2014 - 13:10.</div>
    <div class="content">
     <blockquote><p><em><span style="font-size: 12px;">Currently </span>Emocnms<span style="font-size: 12px;"> works on Operating systems that aren&#39;t going to support </span>debian<span style="font-size: 12px;"> package, so changing underlying modules isn&#39;t a trivial task.</span></em></p>
</blockquote>
<p>Just to be clear, it&#39;s not so much that the modules have been made debian-specific, as I&#39;ve restructured it to a more &quot;normal&quot; repo layout / install path *at the same time* as implementing debian packaging.</p>
<p>This made packaging much easier and more robust, but we could do it separately to Debian packaging if we liked (and if we want to add support for packaging in redhat, for instance, there would be no need to have another repo later).</p>
<blockquote><p><em><span style="font-size: 12px;">Need to check that all supported OS&#39;s have some form of easy </span>symlinking<span style="font-size: 12px;"> if the underlying directory structure is going to change.&nbsp; Should we be making the install on non </span>debian<span style="font-size: 12px;"> more complicated to make </span>debian<span style="font-size: 12px;"> easier? &nbsp;</span></em></p>
</blockquote>
<p><span style="font-size: 12px;">The existing install is no good IMO because it nests git repositories on the filesystem. Try running git reset --hard in /var/www/emoncms and all modules will be deleted... (don&#39;t actually do this ;-)</span></p>
<p>Maybe what we need is to have a non-debian install script bundled into each repo to take care of creating symlinks. That way there are two install paths: clone the repo and run the install script (generic linux) or use apt.</p>
<blockquote><p><em>Need way of determining how you installed Emoncms ( the average person isn&#39;t going to remember) so need numbering system displayed in Emoncms that incorporates install method (e.g. v8.0.2DP)</em></p>
</blockquote>
<p>Of course, this is a great argument against running two git repos (one for debian and one for normal).</p>
<p>If we avoid that, we don&#39;t need to differentiate between debian and non-debian because we&#39;ll know what version 8.2.1 corresponds to in git (a tag &quot;debian/8.2.1&quot; for instance).</p>
<blockquote><p><em>Need version control parity between installation methods.&nbsp; Currently we have V8.0.1 on debian package and v8.0 pre release on github master, (with Github emoncms releases showing latest release to be v7.0)<br />
		Need clarity on what is the master.&nbsp; Trystan&#39;s comment earlier in the thread &quot;git master branch is a mirror of the debian package&quot; scares me.&nbsp; Surely a method of install for specific OS should be a mirror of a non-OS specific master?</em></p>
</blockquote>
<p>Correct, and this is what the forked repos I&#39;ve put together are - generic masters which also have debian packaging information that can otherwise be ignored (notwithstanding the lack of some kind of alternative install script for generic linux).</p>
<p>You can only put things from git into the apt repository, so don&#39;t worry that it might be the other way around.</p>
<p>We should simply tag the git master with the debian changelog&nbsp;version at the point when we generate that deb, then it will always be easy to see what&#39;s in apt, and what people have installed. This is how we manage a large (200+ system) apt repository under git&nbsp;control in the office.</p>
<p>Ideally there would be two tags in master on github&nbsp;right now: &quot;8.0.1&quot; and &quot;debian/8.0.1&quot; - if we had to tweak the debian installation script only, master would advance without adding &quot;8.0.2&quot; tag (because no functionality has been changed except the installation stuff for one distro) but we would add &quot;debian/8.0.1-1&quot; to denote the debian version built and deployed to apt.</p>
<p>The fact that github still says 8.0 (or even prerelease) is a good illustration of why debian packaging adds some needed discipline (IMO) because you have to increment to update through apt. You don&#39;t get the situation where there&#39;s doubt over which version of a particular version number people are running...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3367.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3367.jpg" alt="Dan Woodie&#039;s picture" title="Dan Woodie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3367.html" title="View user profile.">Dan Woodie</a> on Tue, 18/03/2014 - 14:16.</div>
    <div class="content">
     <p>Excuse me for jumping into this thread, but I have a few questions that I am unsure of the answers to. I had<a href="2272.html" onclick="window.open(this.href, '', 'resizable=no,status=no,location=no,toolbar=no,menubar=no,fullscreen=no,scrollbars=no,dependent=no'); return false;"> installed EmonCMS on my NAS4Free / FreeBSD</a> server last summer but recently had a hardware failure and lost all of my data :-(</p>
<p>I purchased new hardware and got <a href="http://nas4free.org/" onclick="window.open(this.href, '', 'resizable=no,status=no,location=no,toolbar=no,menubar=no,fullscreen=no,scrollbars=no,dependent=no'); return false;">NAS4Free</a> running again, and followed my previous instructions to install EmonCMS. It appeared to work fine and the version I have running appears to be still MySQL based. I pursued this path as my initial search seemed to indicate that the Timestore variant was not fully setup for home installs yet. But reading through this thread seemed to indicate that it may be ready for that. Can someone bring me up to speed on whether Timestore and this branch is ready for a FreeBSD install attempt? The only mention of the two seems to be in a thread from last fall with no clear answers.</p>
<p>A quick search on the Timestore site doesn&#39;t seem to add much info as well, so any guidance would be appreciated. Thanks.</p>
<p>Dan</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19382"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 18/03/2014 - 14:20.</div>
    <div class="content">
     <p><span style="font-size: 12px;">Actually, why don&#39;t I submit a pull request just to restructure the </span>filesystem?</p>
<p><span style="font-size: 12px;">Forget all the </span>debian<span style="font-size: 12px;"> packaging for just a moment. This would be like a bridging step, demonstrating that we can all still run emoncms with a more robust installation procedure, whatever the platform.</span></p>
<p><span style="font-size: 12px;">In practice, adding debian packaging to this just means adding a debian/ directory in the root folder, but perhaps by separating it into two logical steps, it will make it easier. We&#39;d be separating upgrade concerns based on debian packaging and concerns based on not pointing apache directly at git (directory restructure)?</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19481"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 19/03/2014 - 19:43.</div>
    <div class="content">
     <p>Dave: Thanks for all your work on this,</p>
<p>Im looking at:</p>
<p><a href="https://github.com/Dave-McCraw/emoncms/tree/debian-packaging" title="https://github.com/Dave-McCraw/emoncms/tree/debian-packaging">https://github.com/Dave-McCraw/emoncms/tree/debian-packaging</a></p>
<p>and</p>
<p><a href="https://github.com/Dave-McCraw/emoncms/tree/restructure" title="https://github.com/Dave-McCraw/emoncms/tree/restructure">https://github.com/Dave-McCraw/emoncms/tree/restructure</a></p>
<p>Would it be possible to have a debian &quot;scaffold&quot; repo which has&nbsp; the folders: conf, debian, an empty www with a COPYHERE.txt readme, and the other copyright and install.sh files.</p>
<p>and then have the process of building the debian folder consist of copying over emoncms from the current repo into the debain scaffold repo?</p>
<p>Would that work?</p>
<p>it would be a separation of concerns in a way, what do you think?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19482"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 19/03/2014 - 19:52.</div>
    <div class="content">
     <p>Just to check that I understand the solution to the problem of nesting git repo&#39;s, are you saying that it is essentially the use of apt instead of git to install modules that solves the situation of what can happen if git reset is called? as in this instance git is no longer used and so git reset cant be called.</p>
<p>But under the apt install calling: sudo apt-get install event</p>
<p>still puts the event module in emoncms/www/Modules?</p>
<p>Someone could still install the module via git in the Modules folder if they really wanted to?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19485"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Wed, 19/03/2014 - 21:18.</div>
    <div class="content">
     <p>Here&#39;s the problem as I see it: we&#39;re not really &#39;installing&#39; emoncms.</p>
<p>By that I mean that there&#39;s no separation between what we have running on servers and completely separate concerns like what version control system we use, what file and directory structure we want to organise our stuff, and how we choose to handle bug fixes and feature releases.</p>
<p>It&#39;s fantastic that emoncms already has a modular architecture, but all the teething issues with engines, visualisation etc. that people have been experiencing with v8 has me thinking that it might be even more awesome if we could split up the core of emoncms into smaller &#39;chunks&#39;. That way we could roll out new engines without messing with visualisations, or add new visualisations without releasing a whole new major version of emoncms, and so on.</p>
<p>Literally having our git repos served by Apache poses major obstacles to this idea because you will get conflicts between repos when you restructure like this. What if a version of one repo which controlled certain files is mixed with a newer repo that claims that part of emoncms?</p>
<p>Another issue is that we can&#39;t include stuff like apache config files or schema definitions in the emoncms repository, otherwise they&#39;ll be public-facing and potentially exploitable because everything is under the apache&nbsp;docroot.</p>
<p>The alternative approach is to have the git repos (or alternative installers, like debian packaging) not be cloned under /var/www/ at all, but somewhere else, and then run an installer script that sets up apache config, any other configuration, moves files into a serveable structure (if necessary merging the files and directories, as with the contents of the Modules/ directory, and so on.</p>
<p>Although it may be slightly painful in the short term for existing installs, it will give us massively more flexibility going forward, as well as making it easier to upgrade and maintain emoncms&nbsp;for less experienced admins.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19486"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Thu, 20/03/2014 - 08:49.</div>
    <div class="content">
     <p>Specifically regarding the debian&nbsp;packaging: it works as you suspect (physically installing the files into an apache-served file structure) so it is possible to freely mix the git method with the debian method if the sysadmin&nbsp;prefers, apache can&#39;t tell if something was installed via git clone or apt.</p>
<p>The advantage of debian&nbsp;packaging is that we tie in with sophisticated versioning, installation and related toolsets, and it eliminates any requirement to use git&nbsp;as a prerequisite for an emoncms install. Everyone can use apt (who is running a Pi, anyway)... and unlike Git, it&#39;s possible to freely mix files in an arbitrary directory structure (some in /etc/emoncms, some in /usr/share/emoncms, some in /usr/docs/emoncs, whatever) and apt will keep track of which package owns which files automatically.</p>
<p><span style="font-size: 12px;">[edit] Just to add another point: although not everyone is installing emoncms on a Pi or other debian-derived system, the big advantage of setting up a debian installer is that we won&#39;t need to worry so much about manually documenting the install procedure for everyone else. All we really need to do is publish a short guide to help people understand any slightly cryptic aspects of the debian installation script, then say to people &quot;if you&#39;re not installing on debian, open the debian install file and follow the steps in it manually&quot;. That way, there&#39;s less chance of forgetting a dependency, some configuration option etc. because we can confirm the functioning of the emoncms debian&nbsp;build programatically.</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19508"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 20/03/2014 - 09:07.</div>
    <div class="content">
     <p class="rteindent1"><em>By that I mean that there&#39;s no separation between what we have running on servers and completely separate concerns like what version control system we use, what file and directory structure we want to organise our stuff, and how we choose to handle bug fixes and feature releases.</em></p>
<p>Just to be sure that Im following, your saying there is no separation with the current git approach while the debian aproach provides seperation. Or are you saying that there cannot be separation in general?</p>
<p class="rteindent1"><em>It&#39;s fantastic that emoncms already has a modular architecture, but all the teething issues with engines, visualisation etc. that people have been experiencing with v8 has me thinking that it might be even more awesome if we could split up the core of emoncms into smaller &#39;chunks&#39;. That way we could roll out new engines without messing with visualisations, or add new visualisations without releasing a whole new major version of emoncms, and so on.</em></p>
<p>I think the teething issues are more a problem of not testing thoroughly enough on multiple platforms, the visualisation issue was because I had not tested those particular visualisations, which admittedly was a fair oversight. Maybe if we had a defined testing period where it was stated that the current state is likely to be buggy and that were looking for help to iron out most of the issues before the full release.</p>
<p class="rteindent1"><em>Literally having our git repos served by Apache poses major obstacles to this idea because you will get conflicts between repos when you restructure like this. What if a version of one repo which controlled certain files is mixed with a newer repo that claims that part of emoncms?</em></p>
<p>I get the use of debian apt vs git with the nesting git reset problem. but not sure if Im fully following you here.</p>
<p class="rteindent1"><em>Another issue is that we can&#39;t include stuff like apache config files or schema definitions in the emoncms repository, otherwise they&#39;ll be public-facing and potentially exploitable because everything is under the apache docroot.</em></p>
<p>Sure.</p>
<p class="rteindent1"><em>The alternative approach is to have the git repos (or alternative installers, like debian packaging) not be cloned under /var/www/ at all, but somewhere else, and then run an installer script that sets up apache config, any other configuration, moves files into a serveable structure (if necessary merging the files and directories, as with the contents of the Modules/ directory, and so on.</em></p>
<p>Yup got this too, and this is adhering to debian standards too as you mentioned. But then windows installs and shared server installs just need emoncms placed in public_html or www so we need both options I think.</p>
<p>Because debian is a specific installation case it seems to me that it would be simplest to keep the current emoncms git repo as it is (without the introduction of the emoncms app files within the www folder in the git repo) and have this additional repo with the debian specific stuff to which we copy emoncms when updating the debian package.</p>
<p>This allows us to seperate the emoncms app from the debian install while still having a debian package and all its benefits?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19515"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Thu, 20/03/2014 - 10:42.</div>
    <div class="content">
     <blockquote><p><em>Just to be sure that Im following, your saying there is no separation with the current git approach while the debian aproach provides seperation. Or are you saying that there cannot be separation in general?</em></p>
</blockquote>
<p>There should be separation which we can&#39;t get with git alone. We do get it through debian packaging (but that&#39;s just a special case of the general principal of &quot;don&#39;t put the whole git repo under the docroot&quot;).</p>
<p>Indeed, although it&#39;s a positive thing that we are having this discussion, the reason we have to have it al all is only because we&#39;ve welded together our source control and our deployment. Normally you would have all aspects of an application in source control and then install files into varied locations as required, so you can do whatever you like without any impact on people&#39;s installations.</p>
<p>We&#39;re now talking about having multiple git repositories to contain one source, to work around the fact that legacy installs involve cloning into the docroot...&nbsp;</p>
<p class="rteindent1"><em>Maybe if we had a defined testing period where it was stated that the current state is likely to be buggy and that were looking for help to iron out most of the issues before the full release.</em></p>
<p>There are lots of possible improvements, the benefit of experience and hindsight :)</p>
<p>My point was more that the current git structure precludes us from doing any significant reorganisation - as this discussion underlines. I think we should grasp the nettle and break the link between git&nbsp;and the installation now, or we might have to do it later to support some kind of must-have feature, and it will be vastly more painful.</p>
<p class="rteindent1"><em>Yup got this too, and this is adhering to debian standards too as you mentioned. But then windows installs and shared server installs just need emoncms placed in public_html or www so we need both options I think.</em></p>
<p class="rteindent1"><em>Because debian is a specific installation case it seems to me that it would be simplest to keep the current emoncms git repo as it is (without the introduction of the emoncms app files within the www folder in the git repo) and have this additional repo with the debian specific stuff to which we copy emoncms when updating the debian package.</em></p>
<p class="rteindent1"><em>This allows us to seperate the emoncms app from the debian install while still having a debian package and all its benefits?</em></p>
<p>I get what you&#39;re saying and we could do that, technically. I&#39;m sort of on the fence about it because I think we&#39;re storing up serious future pain by encouraging people to clone the repo directly and serve it.</p>
<p>I&#39;d be interested to know what proportion of installs are onto a Pi / linux box and how many onto shared hosting, and where we want to position ourselves philosophically. After all, we introduced a&nbsp;Redis&nbsp;dependency in v7 which meant a large proportion of people couldn&#39;t even run v7 on shared hosting...</p>
<p>What I was attempting to do with my pull request on&nbsp;https://github.com/Dave-McCraw/emoncms/tree/restructure was to introduce a separate (shared hosting / non-debian) install script that would allow us to proceed by saying &quot;either you install from apt, or you can install using this script, but in neither case do we support cloning emoncms under the Apache docroot&nbsp;any more&quot; - the idea being that on a shared host you could just change the path in the install script to your shared hosting directory and it would still work.</p>
<p>I&#39;m not actually sure that would work with the current pull, I guess it would preferably take an argument and use that as the directory for installation - but is this not a possible way forward?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19521"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 20/03/2014 - 11:32.</div>
    <div class="content">
     <p>I think we should be aiming to support, in order of platforms that generate the most forums posts/interest?</p>
<p>1) debian based systems: primarily ubuntu and rasbian on the raspberrypi but others should also work.</p>
<p>2) windows</p>
<p>3) linux shared servers</p>
<p>4) mac&#39;s</p>
<p>I originally though redis and timestore would be easy to get running on windows when v7 was released but after realising that it wasnt going to be the case I put a fair bit of work into making v8 compatible with windows which also luckily makes it compatible with linux shared servers where neither timestore nor redis could be installed either, but there was more call to support windows than shared servers hence the driver of these changes being the windows requirement rather than to get shared server compatibility.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19525"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 20/03/2014 - 12:01.</div>
    <div class="content">
     <p>Another question is what is best for developers? using git directly reduces the number of steps between developing, testing and uploading changes. We may still want to document the git install approach for developers as well as providing the debian package for easy installation? what do you think?</p>
<p>Emoncms documentation navigation could look like this</p>
<ul>
<li>
		Install on Debian Linux</li>
<li>
		Install on Shared servers</li>
<li>
		Install on Windows</li>
<li>
		Install via git for development</li>
</ul>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19526"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 20/03/2014 - 12:21.</div>
    <div class="content">
     <p>On shared server&#39;s it may not be a possible to run the install script as you dont always have ssh access. A possibility is that the www folder in the new restructure is just copied to public_html...</p>
<p>We could start with two separate repo&#39;s, as the debianisation step only really concerns ourselves&nbsp; and a minority who will want to build the debian package from scratch?</p>
<p>We then compile the debian package, serve it, update all the documentation to use it as the default install method, keep the current install procedure up there in parallel as another option for the time being. We could then re assess in a month or so, establish if its stopping us from doing anything?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19528"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Thu, 20/03/2014 - 12:38.</div>
    <div class="content">
     <p>Normally when developing I would symlink the relevant parts of the git repo into the deployed directory. But there are a lot of ways to do it, and it&#39;s true that building and installing a debian package every time you save your PHP isn&#39;t a quick way to develop.</p>
<p>However, there is a blindingly obvious middle way which only occurred to me just now. I was too focused on how to roll out the &quot;proper&quot; change and not thinking enough about the &quot;minimum necessary&quot; change.</p>
<p>We could just add the debian directory and config files to the existing git repo but not move anything into the www/ directory for web-served content. This might complicate the debian installer somewhat, but it could be worked around.</p>
<p>This way it would still be possible for people to clone the repo into /var/www/ or wherever else they liked, because we wouldn&#39;t be moving any files *at all* - only adding new stuff. And also cater for people to develop in-situ and then push their changes separately.</p>
<p>It&#39;s a bit ugly but from a functional point of view it would work just fine.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19529"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 20/03/2014 - 12:55.</div>
    <div class="content">
     <p>Good idea, the idea of keeping the current file locations the same for now is appealing, lets try it.</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19552"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Thu, 20/03/2014 - 21:09.</div>
    <div class="content">
     <p>OK - I&#39;ve created a new push request with backwards-compatible debian packaging added in.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19553"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 20/03/2014 - 21:34.</div>
    <div class="content">
     <p>merged, thanks for all the work on the readme too, awesome!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19554"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Thu, 20/03/2014 - 21:58.</div>
    <div class="content">
     <p>No worries. I&#39;m guessing there might be quite a bit of feedback with teething issues, but we&#39;ll soon be there... if I can get those PECL modules as debian dependencies it will really crush the install down to a couple of commands :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19561"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Fri, 21/03/2014 - 01:24.</div>
    <div class="content">
     <p>@Hertog - thanks for the pointer on DIO... I&#39;ve now submitted a pull request to get that as a proper dependency instead of via PEAR, and got raspberry pi module relying on it.</p>
<p>Nice :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19802"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Tue, 25/03/2014 - 15:31.</div>
    <div class="content">
     <p>Hi</p>
<p>Tried an update.</p>
<p>Unpacking replacement emoncms ...<br />
	Setting up emoncms (8.0.3-1) ...<br />
	Replacing existing emoncms config as follows:<br />
	- MySQL configuration&nbsp;&nbsp; : root connecting to emoncms db on localhost<br />
	- SMTP configuration&nbsp;&nbsp;&nbsp; :&nbsp; connecting to&nbsp; to send as emoncms (noreply) (emoncms-noreply@localhost)<br />
	- Allow password resets :<br />
	Verifying feed directories exist and have the correct ownership...<br />
	- /var/lib/phpfiwa<br />
	- /var/lib/phpfina<br />
	- /var/lib/phptimeseries<br />
	- /var/lib/timestore<br />
	Attempting to create &#39;emoncms&#39; mysql database (with the &#39;root&#39; user)...<br />
	ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES)<br />
	- Failed (check username and password are correct, using dpkg-reconfigure. Check grants allow table creation, etc...)<br />
	dpkg: error processing emoncms (--configure):<br />
	subprocess installed post-installation script returned error exit status 1<br />
	Errors were encountered while processing:<br />
	emoncms<br />
	E: Sub-process /usr/bin/dpkg returned an error code (1)</p>
<p>So I ran&nbsp;sudo dpkg-reconfigure emoncms --force</p>
<p>Replacing existing emoncms config as follows:<br />
	- MySQL configuration&nbsp;&nbsp; : root connecting to emoncms db on localhost<br />
	- SMTP configuration&nbsp;&nbsp;&nbsp; :&nbsp; connecting to&nbsp; to send as emoncms (noreply) (emoncms-noreply@localhost)<br />
	- Allow password resets :<br />
	mv: cannot stat `/usr/share/emoncms/www/default.settings.php&#39;: No such file or directory<br />
	Verifying feed directories exist and have the correct ownership...<br />
	- /var/lib/phpfiwa<br />
	- /var/lib/phpfina<br />
	- /var/lib/phptimeseries<br />
	- /var/lib/timestore<br />
	Attempting to create &#39;emoncms&#39; mysql database (with the &#39;root&#39; user)...<br />
	ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES)<br />
	- Failed (check username and password are correct, using dpkg-reconfigure. Check grants allow table creation, etc...)</p>
<p>I guess the mv&nbsp;command is part of the problem. I was using raspberry as mysql password, should it be something else?</p>
<p>This is a test PI so I could start from scratch if needed but thought you might like to see the problem reported.</p>
<p>Regards</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19805"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 25/03/2014 - 17:06.</div>
    <div class="content">
     <p>Thanks for flagging that up Ian. That&#39;s come about because I updated the debian packaging of emoncms to be tracked by a standalone git repo last night - I&#39;ll need to pop a quick update to apt to cater for it.</p>
<p>Please feel free to post any issues you encounter, it&#39;s a great help. You can do that here or you can create an issue on the <a href="https://github.com/Dave-McCraw/pkg-emoncms">pkg-emoncms</a>&nbsp;repo :)</p>
<p>I ordered a second Pi so I could run a dev&nbsp;environment in front of my live Pi, but I haven&#39;t received it yet, so it&#39;s a little tricky to debug myself...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19812"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 25/03/2014 - 19:17.</div>
    <div class="content">
     <p>Ian - I&#39;ve created an issue to track your bug:&nbsp;<a href="https://github.com/Dave-McCraw/pkg-emoncms/issues/1">https://github.com/Dave-McCraw/pkg-emoncms/issues/1</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19834"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Wed, 26/03/2014 - 09:33.</div>
    <div class="content">
     <p>Ok</p>
<p>I have updated with the latest &nbsp;version:-</p>
<p>After this operation, 0 B of additional disk space will be used.<br />
	Do you want to continue [Y/n]? y<br />
	Setting up emoncms (8.0.3-3) ...<br />
	Replacing existing emoncms config as follows:<br />
	- MySQL configuration&nbsp;&nbsp; : root connecting to emoncms db on localhost<br />
	- SMTP configuration&nbsp;&nbsp;&nbsp; :&nbsp; connecting to&nbsp; to send as emoncms (noreply) (emoncms-noreply@localhost)<br />
	- Allow password resets :<br />
	Verifying feed directories exist and have the correct ownership...<br />
	- /var/lib/phpfiwa<br />
	- /var/lib/phpfina<br />
	- /var/lib/phptimeseries<br />
	- /var/lib/timestore<br />
	Attempting to create &#39;emoncms&#39; mysql database (with the &#39;root&#39; user)...<br />
	ERROR 1045 (28000): Access denied for user &#39;root&#39;@&#39;localhost&#39; (using password: YES)<br />
	- Failed (check username and password are correct, using dpkg-reconfigure. Check grants allow table creation, etc...)<br />
	dpkg: error processing emoncms (--configure):<br />
	subprocess installed post-installation script returned error exit status 1<br />
	Errors were encountered while processing:<br />
	emoncms<br />
	E: Sub-process /usr/bin/dpkg returned an error code (1)</p>
<p>I have looked at settings.php in &nbsp;/usr/share/emoncms/www</p>
<p>Password is raspberry as I expected from previously using:-&nbsp;</p>
<p>sudo dpkg-reconfigure emoncms --force</p>
<p>I am now sure I must have at some time messed up the password in the mysql database. Is there a way to check what the password is? All access is via SSH as I am running the PI headless.</p>
<p>Regards</p>
<p>Ian</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19835"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Wed, 26/03/2014 - 10:56.</div>
    <div class="content">
     <p>You should be able to log into mysql by running the following command:</p>
<p><strong>mysql -uroot -p</strong></p>
<p>(then type password when prompted).</p>
<p>If it doesn&#39;t work, I have no idea how you&#39;d recover the mysql root password, sorry!</p>
<p>In an ideal world there would be an emoncms user set up with appropriate grants, and you&#39;d be able to fall back on the root user from that. Future stuff....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19836"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Wed, 26/03/2014 - 10:58.</div>
    <div class="content">
     <p>PS. you can see the actual command being run <a href="https://github.com/Dave-McCraw/pkg-emoncms/blob/master/debian/postinst#L96">here</a>. You could just try copying that line into your terminal directly, changing the two variables for root and raspberry . If you can make that work, you&#39;ll know what the settings need to be.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19838"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Wed, 26/03/2014 - 11:44.</div>
    <div class="content">
     <p><strong>Partially solved!!</strong></p>
<p>I tried&nbsp;mysql -uroot -p with every password I thought it might be. In the end I gave up and hit return. I was straight in to mysql!</p>
<p>Somehow I had no root password set. I set it to raspberry, ran&nbsp;sudo dpkg-reconfigure emoncms --force, used raspberry as a password and update completed.</p>
<p>sudo dpkg-reconfigure emoncms --force<br />
	Replacing existing emoncms config as follows:<br />
	- MySQL configuration&nbsp;&nbsp; : root connecting to emoncms db on localhost<br />
	- SMTP configuration&nbsp;&nbsp;&nbsp; :&nbsp; connecting to&nbsp; to send as emoncms (noreply) (emoncms-noreply@localhost)<br />
	- Allow password resets :<br />
	Verifying feed directories exist and have the correct ownership...<br />
	- /var/lib/phpfiwa<br />
	- /var/lib/phpfina<br />
	- /var/lib/phptimeseries<br />
	- /var/lib/timestore<br />
	Attempting to create &#39;emoncms&#39; mysql database (with the &#39;root&#39; user)...<br />
	- &#39;emoncms&#39; either exists already or was created successfully.<br />
	To update emoncms configuration, run &#39;dpkg-reconfigure emoncms&#39;</p>
<p>Is there a case for a default root password in the debian packaged install to avoid this possibility?</p>
<p>I can now reach the PI with a browser from a different computer but I get:-</p>
<p>It works!</p>
<p>This is the default web page for this server.</p>
<p>The web server software is running but no content has been added, yet.</p>
<p>Regards</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19839"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Wed, 26/03/2014 - 12:20.</div>
    <div class="content">
     <p>Hi Ian,</p>
<p>Setting a root password on mysql&nbsp;is something you&#39;d attend to as part of setting up mysql. There&#39;s lots of stuff like that I guess - not something that falls within the remit of the emoncms package installer.</p>
<p><span style="font-size: 12px;">(However, that *is* taken care of in the Pi images we distribute, so perhaps it needs to be explicit in the debian&nbsp;install guide? Something like &quot;common issues you might encounter while setting up emoncms&quot;?)</span></p>
<p><span style="font-size: 12px;">FYI, I&#39;ve updated the readme&nbsp;on&nbsp;</span><span style="font-size: 12px;"><a href="https://github.com/Dave-McCraw/pkg-emoncms">https://github.com/Dave-McCraw/pkg-emoncms</a>&nbsp;with the intention that it will be the single point of contact on the debian install procedure (I&#39;ll soon submit a pull request to remove this from the main readme). Any suggestions for this are very welcome.</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19841"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Wed, 26/03/2014 - 12:44.</div>
    <div class="content">
     <p>Hi</p>
<p>During install you fill in the database information and the email information. The email and database defaults can just be skipped over but clearly a mysql password<strong> MUST</strong> be filled in. A note at the appropriate point in the readme that this must be filled in may save someone some grief (and that the password must be noted/remembered for future database maintenance).</p>
<p>This part of the readme&nbsp;could possibly mislead,</p>
<p><em>Note that your previous answers are pre-populated for convenience; this includes the passwords (just hit enter on the empty field to use the previous password).</em></p>
<p>I am guessing some PI users maybe unfamiliar with Linux and mysql if they come from a Windows background.</p>
<p>I certainly was a few months ago!</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19843"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emoncms 8.0 (debian packaged)</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Wed, 26/03/2014 - 13:59.</div>
    <div class="content">
     <p>Ah yes. Because we call mysql with the -p flag it won&#39;t work if someone sets up passwordless DB access, but more fundamentally, you can&#39;t enter nothing to the debconf prompts, as that means &quot;use previous&quot;.</p>
<p>I&#39;ll certainly update the readme to include a note on this, along with help on debugging.</p>
<p>[Edit: I&#39;ve updated the readme and added&nbsp;<a href="https://github.com/Dave-McCraw/pkg-emoncms/issues/4">https://github.com/Dave-McCraw/pkg-emoncms/issues/4</a> to refer people to in future.]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/4067"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-bEVCk3i6bX5ZLyzwOM5NU29tYxzfZeHwiM8hdbfveuE" value="form-bEVCk3i6bX5ZLyzwOM5NU29tYxzfZeHwiM8hdbfveuE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/4067 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:50:22 GMT -->
</html>
