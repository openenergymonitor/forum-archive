<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10144 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:11:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Power reading change to negative values | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Power reading change to negative values</h3>
        <span class="submitted">Submitted by <a href="../user/7670.html" title="View user profile.">pdcleyn</a> on Sun, 08/02/2015 - 20:21</span>
        <div class="content"><p>I just set up&nbsp;a TXShield on a 3Phase&nbsp;installation which connects serially to a Pi and then ships its data to emoncms.org. I initially started out with the first phase only and only added the other two today. I&#39;m using the Shield_CT1234_3Phase_Voltage sketch and first had some trouble getting the power factor calibration ok, but finally got it all up and running. (I&nbsp;thought ... ;-) )</p>
<p>The readings for the third&nbsp;clamp jump between positive and negative values. There is however no power generating device connected. Can anyone explain me what might go wrong?</p>
<p>I already searched this forum and I know that the direction of the clamp can cause wrong values, but the changes on the graphs included pop up without intervention, so nothing is changed hardware or software wise when a &#39;polarity&#39; jump occurs.</p>
<p>I also tried to connect the clamps on different inputs, more exactly, switched CT2 and CT3. Initially, both again report positive values, but the values on the 3rd input (now with the clamp originally connected to input 2) gradually decrease (measuring every 5 &quot;) and eventually turn negative again after 30&quot; or so.&nbsp;So it seems not be related to the measurements but to the input or software handling it.</p>
<p>Any pointers are highly appreciated. I don&#39;t have any in&nbsp;depth&nbsp;knowledge on power monitoring, but am eager to learn and understand!</p>
<p>BTW, the values I used for calibrations are as follows, PHASE2 and PHASE3&nbsp;were adapted to get a PF of 1:</p>
<pre>
#define PHASE2 10                                 //  Number of samples delay for L2
#define PHASE3 16                                //  Number  of samples delay for L3, also size of array
//Calibration coefficients
//These need to be set in order to obtain accurate results
double Vcal = 246.5;//234.26;                            // Calibration constant for voltage input
double Ical1 = 60.39595;                            // Calibration constant for current transformer 1
double Ical2 = 59.2;                            // Calibration constant for current transformer 2
double Ical3 = 58.55;                            // Calibration constant for current transformer 3
double Ical4 = 60.60;                            // Calibration constant for current transformer 4

double Phasecal1 = 1.00;                         // Calibration constant for phase shift L1
double Phasecal2 = 0.01;                         // Calibration constant for phase shift L2
double Phasecal3 = 1.7;                         // Calibration constant for phase shift L3
double Phasecal4 = 1.00;                         // Calibration constant for phase shift CT 4</pre><p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10146.html" class="topic-previous" title="Go to previous forum topic">‹ RFM12B capacitors blown on emontx3.4</a>
              <a href="10145.html" class="topic-next" title="Go to next forum topic">GLCD - missing guide videos ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-27530"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Power reading change to negative values</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 09/02/2015 - 00:13.</div>
    <div class="content">
     <p>I don&#39;t have a Shield (or Arduino to put it on!), so I can&#39;t check that sketch.&nbsp;</p>
<p>But this sounds horribly like another recent bug<span style="line-height:18.9090900421143px">, one that I&#39;m still chasing,</span><span style="line-height:1.6">&nbsp;that showed up on a 3-phase sketch as I converted it to use the LP filter (as in </span>emonLib<span style="line-height:1.6">)</span><span style="line-height:1.6">. This one is a value in memory is being corrupted somehow, and appears as silly real power readings, hence silly power factors (30 - 40 ! ! !). I have yet to discover what, where and how; but just about any change to the sketch alters the </span>behaviour<span style="line-height:1.6">, even if totally unrelated to the power calcul</span><span style="line-height:1.6">ations. I&#39;ve </span><span style="line-height:1.6">convinc</span><span style="line-height:1.6">ed</span><span style="line-height:1.6"> myself it&#39;s a pointer somewhere in a library that&#39;s picked up a wrong value - or itself been corrupted.</span><span style="line-height:1.6">&nbsp;Whether I&#39;m right or not remains to be seen. This one went away (temporarily?) when I changed &#39;cycles&#39; to an unsigned int in:</span><br />
&nbsp; &nbsp;<em>void calcVI3Ph(int cycles, int timeout);</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27569"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Power reading change to negative values</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 10/02/2015 - 17:41.</div>
    <div class="content">
     <p>See my post here: <a href="10089.html#comment-27568" title="http://openenergymonitor.org/emon/node/10089#comment-27568">http://openenergymonitor.org/emon/node/10089#comment-27568</a><br />
It could well be that you have exactly the same problem.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27570"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7670.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pdcleyn&#039;s picture" title="pdcleyn&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Power reading change to negative values</h3>

    <div class="submitted">Submitted by <a href="../user/7670.html" title="View user profile.">pdcleyn</a> on Tue, 10/02/2015 - 18:46.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Thanks a lot for your pointers. Didn&#39;t have time yet to look into it (will do so now), I only tried the&nbsp;<em>unsigned int cycles</em>&nbsp;but that resulted in all zero values on all readings. Probably, some other implicit conversions happen allong the way.</p>
<p>I&#39;ll keep you posted on my progress!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27571"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Lykke&#039;s picture" title="Lykke&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Power reading change to negative values</h3>

    <div class="submitted">Submitted by <a href="../user/7638.html" title="View user profile.">Lykke</a> on Tue, 10/02/2015 - 19:47.</div>
    <div class="content">
     <p>Had a similar&nbsp;problem until I updated the setup for other reasons; at night at low load one&nbsp;phase would suddenly drop from e.g. 50 watt to -50 watt. Seemed to disappear&nbsp;when a high load was applied, e.g. putting the kettle on in the morning, after which the base load would go back to +50 watt. Maybe a small piece of info to your puzzle, good luck.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27574"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7670.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pdcleyn&#039;s picture" title="pdcleyn&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Power reading change to negative values</h3>

    <div class="submitted">Submitted by <a href="../user/7670.html" title="View user profile.">pdcleyn</a> on Tue, 10/02/2015 - 21:25.</div>
    <div class="content">
     <p>Not so much progress today. I compiled with the gcc tools and removed all Warnings on type mismatches. All readings on CT3 are now positive, but they already were even before I started, but on CT2 I now have fluctuating values. I already removed the static strings from the output before I started this thread, so the F() function would not help, but thinking of it now, I might just introduce it again and maybe some side effect occurs ... ???</p>
<p>I don&#39;t have big consumers on the 2nd phase, so I&#39;ll put a kettle on it tomorrow to see if I have the same effect as you had Lykke. What did you change to your setup which also changed your measurement output? Did you change your wiring your electric system or did you change your monitoring setup?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27575"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7670.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="pdcleyn&#039;s picture" title="pdcleyn&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Power reading change to negative values</h3>

    <div class="submitted">Submitted by <a href="../user/7670.html" title="View user profile.">pdcleyn</a> on Tue, 10/02/2015 - 21:30.</div>
    <div class="content">
     <p>Did a quick test with the F() and no result. Both CT2 and CT3 now return negative values, but this is unrelated to the introduction of F().</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27579"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Power reading change to negative values</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 10/02/2015 - 23:17.</div>
    <div class="content">
     <p>Are you using a recent JeeLib? I have not checked what effect adding support for the RFM69CW has had on the size of JeeLib. Changes to a 3rd party library that increased its size have caused problems for us in the past.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10144"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-6jBdlPqJDm9z6466S8BgjmSk619Oty0pZzGjw2N1VLU" value="form-6jBdlPqJDm9z6466S8BgjmSk619Oty0pZzGjw2N1VLU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/10144 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:11:01 GMT -->
</html>
