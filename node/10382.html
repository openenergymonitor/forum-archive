<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10382 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:49:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>why does the output from the current signal have a modulated sinewave  | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">why does the output from the current signal have a modulated sinewave </h3>
        <span class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Thu, 26/03/2015 - 01:59</span>
        <div class="content"><p>why is the output from the current sensor (Yhdc Current Transformer:&nbsp;SCT-013-000) &nbsp;modulated sine wave ?<br />
as bellow : this is just <strong>pure analog readings</strong> from the arduino after implementing the 2.5V offset&nbsp;<img alt="" src="../sites/default/files/modulated%20signal.png" /></p>
<p>and here is the zoomed version:</p>
<p>&nbsp;</p>
<p><img alt="" src="../sites/default/files/zoomed%20in%20modulated%20signal.png" /></p>
<p>&nbsp;</p>
<p>isn&#39;t it supposed to be a pure sine&nbsp;wave as ?&nbsp;</p>
<p>&nbsp;</p>
<p><img alt="" src="../../../www.maxmcarter.com/sinewave/sinewave_as_generated.png" style="width: 721px; height: 332px;" /></p>
<p>I want to implement another project using the same methodology so I want to make sure that what I am doing is correct.thanks&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10446.html" class="topic-previous" title="Go to previous forum topic">‹ Shared Linux Hosting</a>
              <a href="10401.html" class="topic-next" title="Go to next forum topic">UUID over all parts of emon* to get a federated datawarehouse ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-29005"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 26/03/2015 - 07:17.</div>
    <div class="content">
     <p>What are the units on the timebase? &nbsp;It looks like you&#39;ve got two sine waves there, one about 25x the frequency of the other. &nbsp;If I assume the one with the big swings is at 50Hz, then you&#39;ve got some ~2Hz signal superimposed on that, with a peak-to-peak of about 20 units.&nbsp; What does your multimeter&nbsp;read when set to AC, while measuring the 2.5V offset rail? &nbsp;What component values have you used to build your 2.5V offset rail?</p>
<p>There&#39;s a thread on noise that might be helpful here: &nbsp;<a href="10111.html">http://openenergymonitor.org/emon/node/10111</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29007"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Thu, 26/03/2015 - 09:00.</div>
    <div class="content">
     <p>my sampling frequency was 5000 samples per second&nbsp;</p>
<p>actually here is the FFT&nbsp;<img alt="" src="../sites/default/files/frequency%20domain.png" /></p>
<p>the fundemental frequency is 50 Hz and then there is some other frequency components at 100 Hz and 150 Hz&nbsp;<br />
(the x axis is the frequency in Hz)<br />
does that explain ?</p>
<p>I am using 470 Khz and 10 uF&nbsp;<br />
it reads 0 volt</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29009"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 26/03/2015 - 09:31.</div>
    <div class="content">
     <p>You can get this sort of &#39;beat&#39; effect if your sampling frequency is not an exact multiple of the measured frequency. The Arduino free running ADC sampling interval is 104us. This means that the sampling point will slowly move on the sampled 50Hz sine wave.</p>
<p>But the effect (+/- 10 digits) is quite big and I do not think this is the real reason....</p>
<p>Can you tell us more about your code? Are you using the ADC in free running mode?</p>
<p>BR, J&ouml;rg.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29010"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 26/03/2015 - 09:33.</div>
    <div class="content">
     <p>Actually, given the very low frequency of the secondary wave (2 Hz), you might be better setting the voltmeter to DC and see if stays steady. &nbsp;Do you have access to a scope? &nbsp;Like in that thread referenced above, if you can&#39;t seen any sign of the noise in the signal, try looking for it on&nbsp;Vcc or AREF.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29011"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 26/03/2015 - 10:37.</div>
    <div class="content">
     <p><em>You can get this sort of &#39;beat&#39; effect if your sampling frequency is not an exact multiple of the measured frequency.</em></p>
<p>It&#39;s a nice theory though... and goes a long way to explaining the incredibly low frequency of the &quot;noise&quot;. &nbsp;Pursuing how the code is using the ADC sounds like a good plan to me;&nbsp;&nbsp;far more likely to find a 2Hz component in there&nbsp;then you would on a scope.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29012"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Thu, 26/03/2015 - 11:12.</div>
    <div class="content">
     <p>hey @JBecker</p>
<p>guys, what 2 Hz frequency are you talking about ? I can&#39;t see 2 Hz component in the frequency analysis? there is only 100 Hz (2nd harmonic) and 150 Hz (3rd harmonic )</p>
<p>check the FFT picture in my comment above&nbsp;</p>
<p>my code is using free running mode ADC and a timer that allows you to take samples in pre specified intervals(you can choose the sampling frequency) and my sampling rate was 5000 which is a multiple of 50 , I don&#39;t think this is the problem&nbsp;</p>
<p>I use sdFat library, it has a good example on this, refer to:<br />
<a href="https://github.com/greiman/SdFat" title="https://github.com/greiman/SdFat">https://github.com/greiman/SdFat</a></p>
<p>hey friend @dBC</p>
<p>voltmeter DC stays steady, .&nbsp;and I got back from office now and I don&#39;t have an access to scope but when I tested the signal, it was okay and it didn&#39;t have any significant&nbsp;noise</p>
<p>I believe that, the waveform looks so because it has this 100 Hz and 150 Hz components which are called the second the the third harmonics:<br />
<a href="http://www.electronics-tutorials.ws/accircuits/harmonics.html" title="http://www.electronics-tutorials.ws/accircuits/harmonics.html">http://www.electronics-tutorials.ws/accircuits/harmonics.html</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29031"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 26/03/2015 - 12:43.</div>
    <div class="content">
     <blockquote><p>Sabirmgd private message:</p>
<p>sorry the internet is shitty and I couldn&#39;t post my reply or I don&#39;t know where is the problem anyway :</p>
<p>&quot;guys what 2 hz&nbsp;freq&nbsp;are u talking about , there is only 100&nbsp;and 150 hz components and i think that is why the waveform looks so.. check my fft analysis in one of the comments above.. and that is called the 2nd and 3rd harmonics :</p>
<p><a href="http://www.electronics-tutorials.ws/accircuits/harmonics.html" title="http://www.electronics-tutorials.ws/accircuits/harmonics.html">http://www.electronics-tutorials.ws/accircuits/harmonics.html</a></p>
<p>the code is using adc running mode and a timer to set intervals for the samples&nbsp;<br />
i am using&nbsp;sdFat&nbsp;lib, it has a good example :<br />
<a href="https://github.com/greiman/SdFat"" title="https://github.com/greiman/SdFat&quot;">https://github.com/greiman/SdFat&quot;</a><br />
​<br />
this is my reply, thanks : )</p>
</blockquote>
<p>Higher harmonics cannot be responsible for a low frequency component, no way. Harmonics will change the shape of the basic frequency sine wave (so that it is no pure sine wave any more) but they will not &#39;produce&#39; lower harmonics. Low harmonics can be a result of frequency &#39;mixing&#39;, in this case mixing of the measured signal and the sampling frequency.</p>
<p>&nbsp;</p>
<blockquote><p>It&#39;s a nice theory though...</p>
</blockquote>
<p>.....and it is not only a theory:-) I have been doing this stuff since 20 years and this is what you always get if your sampling frequency does not &#39;fit&#39; to the sampled signal (and this has nothing to do with the Nyquist frequency). I think this has already discussed in a thread about the necessity for (or advantages of) a PLL which will adjust the sampling frequency to the measured signal.&nbsp;</p>
<p>BR, J&ouml;rg.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29032"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Thu, 26/03/2015 - 12:45.</div>
    <div class="content">
     <p>could you explain to me how did you know that there is lower harmonics ? this 2 Hz as you say.&nbsp;<br />
Sorry I am not super good at signal processing : )</p>
<p>and it would be interesting if you could provide me with a link for&nbsp;PLL&nbsp;</p>
<p>thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29033"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 26/03/2015 - 13:10.</div>
    <div class="content">
     <blockquote><p>could you explain to me how did you know that there is lower harmonics ? this 2 Hz as you say.&nbsp;</p>
</blockquote>
<p>Good question as i did not do an FFT and your FFT does not show the 2Hz component. But I (or better dBC!) can actually &#39;see&#39; this component in your pictures. If you &#39;add&#39; a 2Hz sine (with ~20 units peak-to-peak) to a 50Hz sine (with ~140 units peak-to-peak) the picture will just look more or less like what you showed us.</p>
<p>PLL: please use PLL for searching in this forum and you will get a number of results.</p>
<p>Martin&#39;s sketch with PLL is discussed here: <a id="http://openenergymonitor.org/emon/node/1535" name="http://openenergymonitor.org/emon/node/1535">http://openenergymonitor.org/emon/node/1535</a></p>
<p>BR, J&ouml;rg.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29037"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 26/03/2015 - 13:31.</div>
    <div class="content">
     <p>Sabirmgd,</p>
<p>I have deleted 14 copies of a message that you posted in this thread. You waste everyone's time doing that, and it was only because you did not look at your browser window to see that your message had been held for moderation. It is not the Internet that is sh****.  Please be patient in the future.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29040"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Thu, 26/03/2015 - 13:52.</div>
    <div class="content">
     <p>I am sorry for wasting your time, Robert.<br />
I just had to write my LONG answer over and over again every time I find it not&nbsp;posted yet.&nbsp;I didn&#39;t notice that my&nbsp;message had been held for moderation.<br />
yet my internet is&nbsp;sh****</p>
<p>my apologies.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29057"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Fri, 27/03/2015 - 00:02.</div>
    <div class="content">
     <p><em>and my sampling rate was 5000 which is a multiple of 50&nbsp;</em></p>
<p>Is your 50Hz coming from a signal generator, or from the grid? &nbsp;If from the grid, then remember you&#39;re chasing a moving target there... hence the PLL suggestion. &nbsp; Here&#39;s what my grid frequency looks like over the last week:</p>
<p><img alt="" src="../sites/default/files/freq.jpg" style="width: 600px; height: 216px;" /></p>
<p>And here&#39;s a zoom-in on that dip on the morning of March 21st:</p>
<p><img alt="" src="../sites/default/files/freq_zoom.jpg" style="width: 600px; height: 218px;" /></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29098"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sat, 28/03/2015 - 03:45.</div>
    <div class="content">
     <p>Sabirmgd, can you explain what you mean by &quot;voltage readings from Arduino&quot;.&nbsp; Are these sampled values from the ADC (within the range 0 to 1023), or are you measuring an analogue signal with some other system?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29112"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 28/03/2015 - 15:06.</div>
    <div class="content">
     <p>Just looking at those numbers: <i>&quot;my sampling rate was 5000&quot;</i></p>
<p>Are you printing to serial output to get the values out of the Arduino? If you are, and you are not storing them in an array first, then your sample rate is not 5000 per second. And that is for two reasons: first, the serial output is slow; second, it doesn&#39;t tie up with what you are seeing.</p>
<p>What you are seeing is a sampling artefact. Your sample rate is not an exact sub-multiple of the mains frequency, therefore the samples do not happen at exactly the same point on the wave each time. This is what I get when, using a spreadsheet, I plot y=sin(sampleNo / 5.04 &times; 2 &times; &pi;)</p>
<p><img alt="" src="../sites/default/files/Selection_065.png" /></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29113"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sat, 28/03/2015 - 15:13.</div>
    <div class="content">
     <blockquote><p>What you are seeing is a sampling artefact.</p>
</blockquote>
<p>Fully agreed, Robert! This is more or less what I said above. But as long as we are not given the complete code, it is not clear if this is the real reason.</p>
<p>J&ouml;rg.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29115"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Sat, 28/03/2015 - 15:19.</div>
    <div class="content">
     <p>&nbsp;@dBC, its not from a function generator its from an air conditioner which is a moving target. Most Probably I should consider PLL</p>
<p>&nbsp;hey @calypso_rae, &quot;voltage readings from Arduino&quot; means the sampled values from the ADC (within the range 0 to 1023). sorry the term was not accurate.&nbsp;</p>
<p>hey, @Robert Wall. our beloved admin : )<br />
I totally got your point. its true the serial port is very slow I struggled&nbsp;because of its speed when I was trying to make a program in C#.net to plot the real time data.</p>
<p>but NO, I am storing them in a memory card first using this library which allows you to exactly set your sampling rate<br />
<a href="https://github.com/greiman/SdFat" title="https://github.com/greiman/SdFat">https://github.com/greiman/SdFat</a><br />
​No serial port involved in the experiment&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29116"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 28/03/2015 - 15:25.</div>
    <div class="content">
     <p>Look at my equation then compare my graph with Sabirmgd's. The relative frequencies are similar, the modulation amplitude is similar. Does that not tell us that the real sample rate is about 5 samples per cycle, not 100?</p>
<p>We need the real timing of the main loop to get any further, the complete sketch would be fine.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29117"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 28/03/2015 - 15:29.</div>
    <div class="content">
     <p>The same argument applies: writing a serial card is slow. I suggest you read the millisecond clock, run the loop (say) 10000 times and read the clock again, then you will know the real sample rate. I don't believe it is 100 samples per cycle simply because the maths of the "modulated" output does not fit the graph you published in your first post above.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29118"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Sat, 28/03/2015 - 16:15.</div>
    <div class="content">
     <p>here is the sketch</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29120"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 28/03/2015 - 16:24.</div>
    <div class="content">
     <p>I don't have an Arduino, so I cannot run your code to test it. Does the code give any errors?</p>
<p>What sort of power supply are you using for your Arduino? Have you checked that the 5 V is clean &amp; stable, with no ripple of any sort on it?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29121"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Sat, 28/03/2015 - 16:29.</div>
    <div class="content">
     <p>a q: what are you using?</p>
<p>for this test I used just the USB for the power&nbsp;. the code&nbsp;doesn&#39;t give any error&nbsp;<br />
the 5 volt&nbsp;is stable ( when I measure it &nbsp;using digital millimeter) , it doesn&#39;t change. or that doesn&#39;t indicate ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29125"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 28/03/2015 - 19:31.</div>
    <div class="content">
     <p>It was worth asking. </p>
<p>What do you see when you change the sample rate to a value that is not exactly (or supposedly so) a multiple of line frequency? Say 4985 samples/sec?</p>
<p>It would also be useful to expand the trace time-wise so that you can see individual samples. Do this where the "modulating" wave is at a positive peak and at a negative peak.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29150"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 29/03/2015 - 16:16.</div>
    <div class="content">
     <p>The graphically-displayed sample values in the initial post only appear to only change approx 15 times per mains cycle, so that would be a sample rate of around 750 samples/second.&nbsp; Maybe this is just an effect of display resolution, but I thought it worth pointing out.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29154"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 29/03/2015 - 16:57.</div>
    <div class="content">
     <p>Did you see my spreadsheet graph? You can't get the output that's in the top post unless you drop the sample rate to about 5 per cycle.</p>
<p>It's a matter of getting two samples to straddle the peak, they must be far enough apart for each to be at about 80% of the amplitude of the wave to get the "depth of modulation" we see.</p>
<p>cos<sup>-1</sup>(0.8) = 37&deg;, that means they are 74&deg; apart, or 4.86 samples per cycle.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29159"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 29/03/2015 - 19:30.</div>
    <div class="content">
     <p>Yes, I entirely agree with your deductions Robert.&nbsp; I was just pointing out that the displayed waveform appears to show distinct steps that could be attributed to a much slower sampling rate than the claimed rate of 5000 per second (or 100 samples per mains cycle at 50 Hz).</p>
<p>The bottom graph in the initial post is presented as for a &quot;pure sine wave&quot;.&nbsp; However, the measurements in question are being taken via the ADC which generates a stream of samples, not a &quot;pure&quot; waveform. &nbsp;&nbsp; &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29171"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Mon, 30/03/2015 - 06:11.</div>
    <div class="content">
     <p>&nbsp;before running another experiment with a sampling rate that is&nbsp;4985 samples/sec , I want to confirm with you that the sampling rate is 5000 Hz, or 100 samples for each mean cycle.<br />
we can see that obvious from the graph, for 500 samples, we get 5 complete cycles which is&nbsp;100 samples for each main cycle.</p>
<p><img alt="" src="../sites/default/files/500%20samples.png" /></p>
<p>I also attached the sampling file which is taking the reading from arduino.<br />
​<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29177"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Mon, 30/03/2015 - 07:54.</div>
    <div class="content">
     <blockquote><p>@dBC, its not from a function generator its from an air conditioner .....</p>
</blockquote>
<p>Could it be that the waveform is &#39;real&#39; for that sort of load? The waveform is not a pure sine, so it is not a purely resistive load (an air conditioner is for sure not purely resistive). And the wobbling might be due to some sort of speed or power regulation?</p>
<p>BR, J&ouml;rg.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29178"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Mon, 30/03/2015 - 08:19.</div>
    <div class="content">
     <p><em>Could it be that the waveform is &#39;real&#39; for that sort of load?</em></p>
<p>this is the first think I should thought of ! that is true. here is the signal using the scope:</p>
<p>
<img alt="" src="../sites/default/files/from%20scope.png" /></p>
<p>anyway thank you guys I really got a lot from the discussion.</p>
<p><i>&nbsp;</i></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29180"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 30/03/2015 - 13:37.</div>
    <div class="content">
     <p>Here are some results as collected using an emonTx V2.&nbsp; The AC voltage source is a standard chassis-type mains transformer.&nbsp; The sketch is a cut-down version of my RawSamplesTool.&nbsp; This version, <em>voltageSamples.ino</em>, simply collects and stores a specified number of voltage samples, then writes them to Serial.</p>
<p>When running at its maximum rate, there are approx 180 samples / mains cycle, so each sample takes 111 us. This sketch uses <em>analogRead() </em>which appears to be approx 7 us slower than when the ADC is controlled by low-level commands.&nbsp; Using most of the available RAM, just over 4 waveforms can be stored (750 samples&#39; worth).&nbsp; When displayed on a spreadsheet, this max rate data looks like <strong>voltageSamples_maxRate.jpg</strong></p>
<p><img alt="" src="../sites/default/files/voltageSamples_maxRate.jpg" /></p>
<p>By adding a delay after each sample is taken, the sampling rate can be reduced.&nbsp; When the sampling rate is reduced to approx 1000 samples per second&nbsp; (only 20 samples per mains cycle), some fluctuations can be seen as in <strong>voltageSamples_1000perSec.jpg</strong></p>
<p><img alt="" src="../sites/default/files/voltageSamples_1000perSec.jpg" /></p>
<p>By adding 4004 us of delay per sample, there are only 4.85 samples per mains cycle.&nbsp; This appears to show the kind of modulation as Robert has calculated.&nbsp; In <strong>voltageSamples_4pt85perMainsCycle.jpg</strong>, I&#39;ve reduced the number of samples to 100</p>
<p><img alt="" src="../sites/default/files/voltageSamples_4pt85perMainsCycle.jpg" style="width: 530px; height: 384px;" /></p>
<p>The modulation that is seen in these graphs is presumably just an artifact of the way that these sample values are displayed.&nbsp; If they were correctly interpreted as being samples of a 50 Hz waveform, then a true unmodulated 50Hz waveform would appear.&nbsp; Unfortunately, a standard graphical package does not include this filtering facility.</p>
<p>&nbsp;</p>
<p>
&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29182"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Mon, 30/03/2015 - 13:10.</div>
    <div class="content">
     <p>Calypso,</p>
<p>Oh that is great! </p>
<p>I think my problem (or actually its not a problem ) was the air conditioner that I was monitoring. It produces this kind of sinewaves ( the modulated one as in the first post) </p>
<p>With your post confirming that, I should be getting a pure sine wave if my signal source is really producing a sinewave.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29183"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 30/03/2015 - 13:33.</div>
    <div class="content">
     <p>My post was to show that a clean sine wave, when sampled slowly, can appear to be modulated when displayed using simple graphical means, just as Robert has calculated.&nbsp;</p>
<p>Have you tried monitoring and displaying your mains voltage, as I have done, rather than the current drawn by your air conditioner?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29184"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Mon, 30/03/2015 - 13:39.</div>
    <div class="content">
     <p>I got your point.<br />
In fact no, my aim basically is to monitor the current from washing machines in a laundry shop. I was using the air conditioner just because its in the lab.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29201"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 30/03/2015 - 16:50.</div>
    <div class="content">
     <p>Try monitoring an electric convector heater, or a kettle. The current waveform's shape will be almost identical to the voltage waveform, which in turn should be close to sine wave. But as you can see from Robin's trace, in the UK we get "flat topping" where the peaks are flattened. That's NOT a problem with sampling or recording, my analogue oscilloscope shows exactly the same shape.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29206"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 30/03/2015 - 20:49.</div>
    <div class="content">
     <p><em>analogRead()&nbsp;which appears to be approx 7 us slower than when the ADC is controlled by low-level commands.</em></p>
<p>I suspect that&#39;s how long it takes to decide which pin to sample. &nbsp;It needs to map from Arduino-land pin numbering scheme to AVR-land&nbsp;port/pin numbering scheme.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29207"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7663.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7663.jpg" alt="Sabirmgd&#039;s picture" title="Sabirmgd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/7663.html" title="View user profile.">Sabirmgd</a> on Mon, 30/03/2015 - 21:19.</div>
    <div class="content">
     <p>Try monitoring an electric convector heater, or a kettle. </p>
<p>I will be monitoring a kettle to review next experiment.</p>
<p>I think the main advantage of using low level commands or interrupts is that, it provides you with "continues data logging" as in free running mode the flag will be (lets say true) to get a new analog reading whenever the previous reading is captured and stored ADCH and ADCL</p>
<p>Just mentioning the sampling and sampling frequency, what is the maximum sampling rate I can get using an arduino and a wifi or eithernet module? Or lets say emonTxV2 and RPi and emoncms( with wifi ) ? Does anyone have an experience?<br />
I am thinking to move from this memory card to cloud base monitoring.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29213"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: why does the output from the current signal have a modulated sinewave </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 31/03/2015 - 07:29.</div>
    <div class="content">
     <p>The fastest way to obtain samples from the ADC is to have it in free-running mode.&nbsp; The ADC is then running at its maximum rate and produces a sample every 104 us.&nbsp; The program needs to direct the ADC to the appropriate channel in advance so that the ADC sub-processor will know what to do next when the in-progress conversion has finished.</p>
<p>A slightly less fast approach is to initiate the next conversion from with an ISR which springs into life whenever a conversion has finished.</p>
<p>The easiest approach is for the main program to wait until the conversion has been completed.&nbsp; The program then does something with the resulting value and in due course initiates the next conversion.&nbsp; This is how <em>analogRead()</em> works.</p>
<p>With either of the first two schemes, the main program in<em> loop()</em> can continue to do things while each ADC conversion is in progress.&nbsp; These interrupt-based schemes therefore have the capability of being significantly faster than the<em> analogRead()</em> approach.</p>
<p>Having said which, <em>analogRead() </em>does a perfectly good job for most applications.&nbsp; For continuous monitoring of several ADC channels, it makes sense to use an interrupt-based sampling scheme so that the sampling rate can be higher.&nbsp; When the ADC is in free running mode, it can service all six analog ports 32 times within each 50 Hz mains cycle.&nbsp;</p>
<p>The rate at which datalogging via RF takes place is not related to the ADC sampling rate.&nbsp; It can be as fast as you wish.&nbsp; Most monitoring programs transmit datalog data every few seconds, typically every 5 or 10 seconds.&nbsp; If the program goes to sleep between transmissions, or attends to each channel in turn so there are breaks in service, it is termed &quot;discrete&quot; monitoring.&nbsp; If all channels are monitored at all times, it is termed &quot;continuous monitoring&quot;.</p>
<p>Sorry if this is off topic.<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10382"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-tX-uOg9QW4gWQx1UUaOi9IQQaM1CYV0C1byP-7d0kcI" value="form-tX-uOg9QW4gWQx1UUaOi9IQQaM1CYV0C1byP-7d0kcI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/10382 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:49:09 GMT -->
</html>
