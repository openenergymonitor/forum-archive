<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10373 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:57:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Fix for accumulator based bargraph data gaps | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Fix for accumulator based bargraph data gaps</h3>
        <span class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 24/03/2015 - 08:38</span>
        <div class="content"><p>There has been a bug for a while that resulted in gaps in the bar graph generated by the data from wh accumulator, accumulator and power to kwh accumulator processes. A day would show as missing if it was only the midnight datapoint that was missing (recorded as a null value in the phpfina data file) even if there was a datapoint at 10s past midnight and the rest of the day complete.</p>
<p>The new default data viewer available in the &#39;newgetdatamethod&#39; branch of emoncms: <a href="https://github.com/emoncms/emoncms/tree/newgetdatamethod" title="https://github.com/emoncms/emoncms/tree/newgetdatamethod">https://github.com/emoncms/emoncms/tree/newgetdatamethod</a> and on emoncms.org has an option to skip or show missing datapoints in a feed. The result can be quite interesting when the skipmissing tick box is unticked and points to a packet loss issue. The two example graphs below show a kwh accumulator feed with its missing data points.</p>
<p><img alt="" src="../sites/default/files/missing2.png" style="width: 400px; height: 198px;" /></p>
<p><img alt="" src="../sites/default/files/missing1.png" style="width: 400px; height: 198px;" /></p>
<p>If the bargraph tries to select a midnight value in any one of those gaps it will miss the entire day. If you zoom in around a missing midnight datapoint there is usually enough data points within a few 10s of seconds either side to provide an accurate midnight reading.</p>
<p>Rather than store a null value if a particular datapoint is missing its possible to get around this issue by joining the last known value with the next known value, filling the missing datapoints in between with a linear interpolation.</p>
<p>I&#39;ve added this feature as a &#39;padding_mode&#39; option to the phpfina engine which is now in the <a href="https://github.com/emoncms/emoncms/tree/whaccumulator_padding_mode" title="https://github.com/emoncms/emoncms/tree/whaccumulator_padding_mode">https://github.com/emoncms/emoncms/tree/whaccumulator_padding_mode</a> emoncms branch and live on emoncms.org.</p>
<p>All feeds already created with the wh_accumulator, accumulator or power_to_kwh input processors on emoncms.org will now fill those missing values joining the last and the current value with a straight line resulting in much more reliable bargraphs created with this method. Im also working on fixing existing data in this way too, with about 100 of ~1000 feeds already fixed on emoncms.org.</p>
<p><img alt="" src="../sites/default/files/afterprocess.png" style="width: 400px; height: 198px;" /></p>
<p>This is a before and after screenshot of a bargraph (including a period where the monitor was actually off for an extended period in the start of feb) Its not the best example but many of the days that where missing are now visible.</p>
<p><img alt="" src="../sites/default/files/kwhd.png" style="width: 400px; height: 248px;" /></p>
<p><img alt="" src="../sites/default/files/after.png" style="width: 400px; height: 236px;" /></p>
<p>There is documentation on how to use accumulating data in this way for daily bargraphs here:<br />
<a href="https://github.com/openenergymonitor/documentation/blob/master/Applications/HomeEnergyMonitor/HomeEnergyMonitor.md" title="https://github.com/openenergymonitor/documentation/blob/master/Applications/HomeEnergyMonitor/HomeEnergyMonitor.md">https://github.com/openenergymonitor/documentation/blob/master/Applicati...</a></p>
<p><a href="http://openenergymonitor.blogspot.co.uk/2014/08/monitoring-solarpv-heatpump-and-house.html" title="http://openenergymonitor.blogspot.co.uk/2014/08/monitoring-solarpv-heatpump-and-house.html">http://openenergymonitor.blogspot.co.uk/2014/08/monitoring-solarpv-heatp...</a></p>
<p>and a little more background info here:<br />
<a href="3995.html" title="http://openenergymonitor.org/emon/node/3995">http://openenergymonitor.org/emon/node/3995</a></p>
<p>We&#39;ve been discussing timezone support in the thread here <a href="10363.html" title="http://openenergymonitor.org/emon/node/10363">http://openenergymonitor.org/emon/node/10363</a>. One of the big advantages of the accumulator approach is that recording the data is timezone independent as its only at the graphing stage that the daily totals are calculated, its also possible to pull out any other interval totals such as hourly or monthly.</p>
<p>We&#39;re still working towards continuous sampling and watt hour accumulation as default on the emontx/+soon emonpi which also fits into this reducing the reliance on the basestation/emoncms/internet connection/webserver for accurate energy totals.</p>
<p>Im also intending to create a post processor module that will generate accumulating watt hour feeds from existing power feed data so that the above graphing tools can be used.</p>
<p>I also intend to merge both the &#39;newgetdatamethod&#39; and &#39;whaccumulator_padding_mode&#39; branches into the master branch and the low write sd card branch of emoncms soon and will document how to fill existing missing data as above.</p>
<p>Thanks</p>
<p>Trystan</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6378.html" class="topic-previous" title="Go to previous forum topic">‹ Post long values</a>
              <a href="10926.html" class="topic-next" title="Go to next forum topic">emonhub service in java code? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-28963"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Tue, 24/03/2015 - 08:54.</div>
    <div class="content">
     <p>Great news !</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28969"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 24/03/2015 - 13:36.</div>
    <div class="content">
     <p>Thanks Eric!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28989"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 25/03/2015 - 09:14.</div>
    <div class="content">
     <p>Hi trystan,</p>
<p>Did you have a look on the bug you described <a href="5789.html#comment-24385">here</a> ?</p>
<p>I&#39;m not talking about the time offset which is different for each of my PHPTimestore.</p>
<p>Here, I&#39;m talking about the PHPFIWA/FINA feeds that are not displayed the good day.</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28992"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 25/03/2015 - 10:06.</div>
    <div class="content">
     <p>Ah yes I fixed that on Monday too, if we&#39;re talking about the kwh values being shifted one day ahead? <a href="https://github.com/emoncms/emoncms/commit/db3751524a5ff29254f40d8a799b8f7768d8d718" title="https://github.com/emoncms/emoncms/commit/db3751524a5ff29254f40d8a799b8f7768d8d718">https://github.com/emoncms/emoncms/commit/db3751524a5ff29254f40d8a799b8f...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28994"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 25/03/2015 - 11:35.</div>
    <div class="content">
     <p>Yes, I was talking about this one. Good news !</p>
<p>Using your fixed version, does the bar for the current day appear in the graph ?</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28995"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 25/03/2015 - 11:48.</div>
    <div class="content">
     <p>No not yet, just the previous day, but yes would be good to bring the current day in there. To do that requires another seperate request in order to fetch the last value, so its a bit more complicated but possible to do.<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31268"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8057.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8057.jpg" alt="Ian Davies&#039;s picture" title="Ian Davies&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/8057.html" title="View user profile.">Ian Davies</a> on Sat, 13/06/2015 - 15:20.</div>
    <div class="content">
     <p>Hi Trystan,</p>
<p>I am still seeing the bug where bargraph shows value from yesterday but with todays date. Is this because I am using emoncms.org which is still at v8.3.5? (I ask because when I follow the Github link to the fix that you posted it shows 8.5 which I *assume* means it&#39;s only fixed in v8.5?).</p>
<p>I&#39;ve searched and couldn&#39;t find any other reference to any other solution for this problem.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31338"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Tue, 16/06/2015 - 09:31.</div>
    <div class="content">
     <p>I&#39;m not sure if my data (or lack of it!) fits in here with this discussion or not but I&#39;m experiencing large amounts of null points in my &#39;grid&#39; (import power) see attached which doesn&#39;t lend itself to accurate interpolation.</p>
<p>Any comments would be appreciated</p>
<p>Chris</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31372"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8057.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8057.jpg" alt="Ian Davies&#039;s picture" title="Ian Davies&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/8057.html" title="View user profile.">Ian Davies</a> on Tue, 16/06/2015 - 21:16.</div>
    <div class="content">
     <p>Hi Chris,</p>
<p>Funnily enough, I also have a similar problem, and was thinking about starting a separate thread. In my case, I have identified that I am losing data due to problems with the RF transmission from my emontx3.4 to my Rpi. I believe I proved this at the weekend by changing quiet mode in emonhub, and could then see lots of spurious packets arriving at the Rpi, and I think some of them are impacting some of my real packets, as I could see some packets with the correct nodeid, but being marked as malformed and discarded.</p>
<p>I tried moving my Rpi to improve the signal strength, hoping this would reduce the volume of lost packets, and although I think it&#39;s helped, it&#39;s not solved the problem, so I still need to do more research on RF transmission problems</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31406"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3208.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dominator99&#039;s picture" title="dominator99&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/3208.html" title="View user profile.">dominator99</a> on Wed, 17/06/2015 - 10:03.</div>
    <div class="content">
     <p>Hi Ian</p>
<p>I don&#39;t think my problem is RF related.</p>
<p>The first graphs are from 6th June 2012 when I first ran my original shop kit EmonTX, Emonbase, EmonGLCD setup for the first time.&nbsp; In spite of these &#39;null&#39; points my EmonTX data is within 1% of my solar meter read data.</p>
<p>Later graphs compare the same day in 2015 &amp; there is little difference in the number of &#39;null&#39; points; however, over the following week (6th to 13th June 2015) there has been a marked increase in the number of &#39;null&#39; points but still the solar PV error between EmonTX &amp; PV meter has remained low.</p>
<p>The error appears to be in the &#39;grid&#39; data (null points increased dramatically over the week 6th to 13th June 2015) which I&#39;m at a loss to explain as no changes/adjustments have been made to software or hardware</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31810"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Fix for accumulator based bargraph data gaps</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Thu, 02/07/2015 - 20:44.</div>
    <div class="content">
     <p>On XT 8.5.2 version i&#39;ve refactored the padding mode usage as a new engine post function optional argument.</p>
<p>It can be implemented genericaly on any engine.</p>
<p>The old feed-&gt;insert_data_padding_mode function was removed and you just need to pass the optional parameter (in 5th position) from process_model.php like this :</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $padding_mode = &quot;join&quot;;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $this-&gt;feed-&gt;insert_data($feedid, $time_now, $time_now, $new_kwh, $padding_mode);</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10373"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-sSFqhnYmIbE3HYMLZqFC8xvvjdAeJud6FPwxM-BCJmY" value="form-sSFqhnYmIbE3HYMLZqFC8xvvjdAeJud6FPwxM-BCJmY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
