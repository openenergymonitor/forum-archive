<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Need help with making a shield for the Arduino Mega | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/3">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Need help with making a shield for the Arduino Mega</h3>
        <span class="submitted">Submitted by <a href="/emon/user/3149" title="View user profile.">boelle</a> on Thu, 21/02/2013 - 08:38</span>
        <div class="content"><p>I have made a few threads and thought I would &quot;clean up&quot; a little</p>
<p>First I think I have made a code for the mega that should do:</p>
<p>1. Full 3 phase monitoring (3*CT and 3*AC)</p>
<p>2. Pulse input for water meters etc.</p>
<p>3. 2-Way IR com&#39;s for heatmeters (some do require a request before they send data).</p>
<p>But I&#39;m not sure if it would work and would like a help correcting mistakes if there are any</p>
<p>Next I have (in eagle) made a shield for the Mega and tried to connect the sensor inputs to the right pins, but here I&#39;m worried that I have connected wrong. Here I would like input if things have been done right and if I need to remap something ?</p>
<p>When I tried to match the pins for the sensor inputs i used the schematic from solderpad (<a href="http://solderpad.com/openenergymon/emontx/" title="http://solderpad.com/openenergymon/emontx/">http://solderpad.com/openenergymon/emontx/</a>) and the attached PDF</p>
<p>If I should put things in a certain order, I would like help with the board first, so that I can order some prototypes.</p>
<p>When I got it working my plan is to release everything in the opensource spirit. Maybe it could even be an &quot;official&quot; openenergy board?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/2088" class="topic-previous" title="Go to previous forum topic">‹ Emoncms: PHP install failure</a>
              <a href="/emon/node/2091" class="topic-next" title="Go to next forum topic">AC-AC Adapter ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-10046"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3149" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3149" title="View user profile.">boelle</a> on Fri, 22/02/2013 - 08:19.</div>
    <div class="content">
     <p>A small Q.... would the hardware be more usefull for others, if it included CT inputs for solar cells etc?</p>
<p>I have excluded temp sensors as I can&#39;t make much use of them. The heat meter do report temp in and out and flow etc and also how much energy used, the energy is what i&#39;m billed. And my hotwater cylinder only has one analog meter to read temp at the top (would have to remove that one to messure).</p>
<p>But I&#39;m open to idea&#39;s.. So far I have used through hole components to be able to hand solder them, SMD could be done to save place, but gain could always make 2 shields if things became to crowded</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10053"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3149" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3149" title="View user profile.">boelle</a> on Sat, 23/02/2013 - 16:55.</div>
    <div class="content">
     <p>attached jpg&#39;s of the board so far</p>
<p><img alt="" height="326" src="http://openenergymonitor.org/emon/sites/default/files/Skærmbillede 2013-02-22 kl. 20.54.50.png" width="647" /></p>
<p><img alt="" height="324" src="http://openenergymonitor.org/emon/sites/default/files/Skærmbillede 2013-02-22 kl. 20.48.24.png" width="607" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10073"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3149" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3149" title="View user profile.">boelle</a> on Sat, 23/02/2013 - 16:54.</div>
    <div class="content">
     <p>Did I post the wrong place? or am I just not patient enough?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10085"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3" title="View user profile.">TrystanLea</a> on Sun, 24/02/2013 - 14:21.</div>
    <div class="content">
     <p>Hello Bo Herrmannsen</p>
<p>Looks good! nice work! I cant see anything wrong that jumps out at me, looks like you have the circuit as in the emontx schematic and the arduino sketch uses emonlib in the expected way. I cant really comment on the heat meter (as in the question in your email) can you test the heat meter code in isolation? With an arduino&nbsp;+ breadboard circuit just to make sure its all working before you commit to manufacturing a board?</p>
<p>Thanks for posting this on the forum</p>
<p>Trystan</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10087"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3149" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3149" title="View user profile.">boelle</a> on Sun, 24/02/2013 - 15:37.</div>
    <div class="content">
     <p>Hi</p>
<p>I got the code for the heatmeter from a danish guy that made on the Uno. So i&#39;m sure that part is working. only need to pick what data to send to emon base. (i plan to send total energy or the difference in total energy between each reading)</p>
<p>What i&#39;m not so sure on is how to match up the pins the mega to what the library expects... and yes i did copy the emontx schematics,</p>
<p>BUT i added 2 extra AC input&#39;s... and that lead&#39;s me to the next thing i&#39;m not sure on.. how do i mod the sketch to calculate all 3 phases in the same sketch and not like the full fat 3 phases thread where 3 emon tx are in use</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10210"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3149" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3149" title="View user profile.">boelle</a> on Fri, 01/03/2013 - 20:50.</div>
    <div class="content">
     <p>would someone be able to help me the last bit?</p>
<p>what pins on the mega would the library expect the 3 ct sensors to be connected at?</p>
<p>what pin for the single AC input?</p>
<p>and what pin for the pulse input?</p>
<p>-------</p>
<p>what mods are needed to add 2 other AC inputs?</p>
<p>what mods are needed to make a full 3 phase monitoring (ct and ac for each phase)?</p>
<p>------</p>
<p>at what pins will the RFM library expect the module connected at?</p>
<p>&nbsp;</p>
<p>I have almost done PCB layout for the GIVmon by rob and would like to order a prototype of both.... but not before i have everything in place</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10217"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/905" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/905" title="View user profile.">robw</a> on Fri, 01/03/2013 - 21:44.</div>
    <div class="content">
     <p>Cant help with the others but the the RFM12B&nbsp;on a mega uses</p>
<p>52&nbsp; sck rf&nbsp;<br />
	50&nbsp; sdq<br />
	51&nbsp; sdi<br />
	53&nbsp; sel<br />
	2&nbsp;&nbsp;&nbsp; irq</p>
<p>But you will need to run the RFM12B at 3.3V not 5V like the mega.. &nbsp;Something like&nbsp;http://jeelabs.net/projects/hardware/wiki/RFM12B_Board&nbsp;for ideas...</p>
<p>Works for me with the above board and a mega.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10220"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3149" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3149" title="View user profile.">boelle</a> on Fri, 01/03/2013 - 22:33.</div>
    <div class="content">
     <p>np.... just need to change a wire then... there are 3.3 on the mega for the shields that need it</p>
<p>&nbsp;</p>
<p>Edit: schematic corrected... will upload a new copy once i get the rest sorted</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10370"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3149" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Need help with making a shield for the Arduino Mega</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3149" title="View user profile.">boelle</a> on Thu, 07/03/2013 - 19:09.</div>
    <div class="content">
     <p>any chance that anybody is willing helping me with getting the last bits sorted?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/2039"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-u6xqmVwEHKAhD7VQID4QgvjOySUdnpf8GCWHngHTyYU" value="form-u6xqmVwEHKAhD7VQID4QgvjOySUdnpf8GCWHngHTyYU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
