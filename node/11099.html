<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11099 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:46:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Calibrating EmonTX | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Calibrating EmonTX</h3>
        <span class="submitted">Submitted by <a href="../user/8530.html" title="View user profile.">davekramkowski</a> on Tue, 11/08/2015 - 02:28</span>
        <div class="content"><p>I got the EmonTX &amp; EmonBase today and started playing with it. Initially, I hooked both CTs (SCT-013-000) up to the EmonTX in the CT3 &amp; CT4 positions (CT1 &amp; CT2 will get the WC1&#39;s when they get here to monitor the main feeds) and clipped them on the hot feed to a 65W light bulb. One CT was reading 4-5W lower than the other. From further reading, it seems that 65W bulb wasn&#39;t enough of a draw to get an accurate reading, although assuming a 65W incandescent bulb actually draws 65W, the readings were real close (around 67W &amp; 62W).</p>
<p>I dug out a radiant heater that is supposedly rated at 1000W according to the label. I also picked up a &#39;Kill-A-Watt&#39; meter and some plugs to make up a better test rig to clip CTs to. Maybe I can add a hair dryer as well to increase the draw and use the Kill-A-Watt as a reference.</p>
<p>The problem is I&#39;m having a hard time wrapping my head around exactly what I&#39;ll need to change in the sketches, and I&#39;m not even really sure which sketch I&#39;d need to use. According to the &#39;Node information&#39; page, the Tx us running &#39;V1_6_emonTxV3_4_DiscreteSampling&#39;. I ASSUME that the &#39;emonTxV3_4_DiscreteSampling.ino&#39; sketch that was part of the zip I downloaded from GIT is the same as what&#39;s already loaded.&nbsp;</p>
<p>From reading, it seems &#39;const float Ical&#39; lines are the calibration values for the CTs. How does changing these values affect the reading? Does increasing the value increase the reading value or decrease it? The next thing I see that looks like it needs to change is the &#39;float Vcal&#39; as it seems to be set up for the UK in the sketch. But then there is &#39;const float Vcal_USA=&#39; and &#39;boolean USA=FALSE&#39;. Do I just need to change the last one to &#39;boolean USA=TRUE&#39;, rather than the &#39;float Vcal&#39;? Also, I note that &#39;TIME_BETWEEN_READINGS&#39; is 10 (I assume seconds). Is there any problem with dropping that down to 5 (I&#39;d like closer data points)?</p>
<p>Is there anything I&#39;m missing? I know I&#39;m going to have to calibrate it for the WC1s, even if I don&#39;t for the SCTs... I don&#39;t want to screw up the functioning TX...</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11129.html" class="topic-previous" title="Go to previous forum topic">‹ Question regarding stepping down voltage</a>
              <a href="11111.html" class="topic-next" title="Go to next forum topic">North America 400A 96KW drop from utility broken into two 200A 48KW load centers, 200A current clamps? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-33227"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibrating EmonTX</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 11/08/2015 - 09:49.</div>
    <div class="content">
     <p>The default sketch is indeed that one - it says so in the Wiki. Read the pages about calibration in Building Blocks for everything you need to know about calibration.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33255"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8530.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="davekramkowski&#039;s picture" title="davekramkowski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibrating EmonTX</h3>

    <div class="submitted">Submitted by <a href="../user/8530.html" title="View user profile.">davekramkowski</a> on Tue, 11/08/2015 - 16:22.</div>
    <div class="content">
     <p>Well, it seems the voltage is off by a bit - plugged into my online UPS that is putting an almost steady 120v out (The UPS is reporting the output as fluctuating between 119 &amp; 120v; my servers are reporting a solid 120v on one PS and 114v on the other), the TX is reporting between 116.8 &amp; 117.9, with 117.3 being the average - If I understand the formula correctly, then I would do 130 * (119.5 / 117.3) = 1.018755328218244, so &#39;1.018755328218244 * 130.0 = 132.4381926683717, or round to 132.4. So place that in the &#39;const float Vcal_USA=&#39; line?</p>
<p>One thing that I didn&#39;t see anywhere: What voltage should the USB-Serial adapter be outputting to the TX? Mine has a 3.3v&lt;&gt;5v switch on it - too low and it probably won&#39;t program right, too high and I have a paperweight. Since it can use a 5v USB and the A/C adapter is 9v, I would ASSUME, that 5v would be ok, but you know what they say about assumption...</p>
<p>As far as the CTs, it seems both CTs are probably reading the same - I swapped their positions on the TX and the readings stayed pretty much the same - the same inputs were still high and low, they didn&#39;t follow the CTs, so that would point to variation in the TX causing the different readings. There are the formulas as to put in the &#39;const float Ical&#39; values based on the transformer and such, but what I haven&#39;t seen is how the readings change if you adjust those numbers for fine tuning - is there a formula to calculate how much and which way to change the value based on how many Watts you want to adjust it? Or is it just a WAG - change the value a bit and see what happens?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33266"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibrating EmonTX</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 11/08/2015 - 22:36.</div>
    <div class="content">
     <p>Voltage calibration - yes, that's what you change.</p>
<p>USB programmer - I've never actually measured the signal amplitude, but as the AtMega 328P runs at 3.3 V, and there is no voltage divider in the RX line, I'd say use 3.3 V.<br />
5 V is the power supply only - there's no USB I/O, there's an on-board regulator to provide 3.3 V to (almost) everything. The circuit diagram is in the Wiki I think.</p>
<p>CT calibration: The calibration takes account of tolerances in the CT (&plusmn; 3% from memory) and in the burden resistor (1%). So it would seem your two CTs are the same (but how far off is another question!). If you've got a means of measuring rms current and you can view the rms current output with the serial monitor, then that's the easiest way to calibrate (and the same procedure as the voltage will get you there). Otherwise you can do the current via power in much the same way as the voltage but it's abstracted by one layer.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33300"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8530.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="davekramkowski&#039;s picture" title="davekramkowski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibrating EmonTX</h3>

    <div class="submitted">Submitted by <a href="../user/8530.html" title="View user profile.">davekramkowski</a> on Thu, 13/08/2015 - 01:43.</div>
    <div class="content">
     <p>Dumb question: Is the &#39;Watts&#39; reading a function of the current read by the CT along with the voltage? I know figuring Watts is usually volts * amps = Watts, but I don&#39;t really know if the CTs are reading the amps or the watts (I can&#39;t imagine the electric companies meters are intelligent enough {at least not the one on my house} to know what the actual voltages are of the legs, and they keep track of Watts/Watt hours/Kilowatt hours, not amps).</p>
<p>I tested programming and was able to without issue, so I did some experimenting. I&#39;m reasonably good with electronics, and am quite familiar with working with mains voltage and inside live panels, but you lost me with the RMS talk :). I ended up experimenting with the &#39;const float Ical&#39; values and in the end, got them REALLY close to each other after three dozen plus flashes, and although I&#39;m not sure I trust the &#39;Kill-A-Watt&#39; meter (It was reading like 3v low), based on a test with that 60W bulb both with a single pass through the CT and two passes through (for a 120W reading), I&#39;d say they&#39;re REALLY close. Much closer than they were to begin with, and they were reading darn close to each other. Don&#39;t think I could get them much closer.</p>
<p>With the CT4 input, is the &#39;high precision&#39; rating and 120ohm (vs 22ohm) resistor a &#39;requirement&#39; due to the input used on the Atmega, or could the 120ohm resistor be replaced with a 22ohm resistor to make it identical to the other three?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33303"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibrating EmonTX</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 13/08/2015 - 09:57.</div>
    <div class="content">
     <p><i>"Is the 'Watts' reading a function of the current read by the CT along with the voltage?"</i></p>
<p>Yes - it's a true average power calculation. You can see the maths in emonLib if you open up EmonLib.cpp.</p>
<p><i>"I can't imagine the electric companies meters are intelligent enough..."</i></p>
<p>Oh yes they are. Read up about energy meters in Building Blocks.</p>
<p><i>"could the 120ohm resistor be replaced with a 22ohm resistor to make it identical to the other three?"</i></p>
<p>Indeed it can be. There are holes, so all you need to do is add the appropriate value (27 &Omega;) in parallel with the 120 &Omega; SMT resistor. (That comes to 22.04 &Omega; and should be close enough!)</p>
<p>What's so hard about rms values? It's the <b>R</b>oot of the <b>M</b>ean <b>S</b>quare. It's the value of current that gives the same heating effect as a direct current of the same value. So it's the value that everyone uses for measurements of alternating voltage and current. A good multimeter will calculate it and display it, a cheap one will measure the rectified average and display a number that will be the rms value <b>if</b> (and only if) the wave is a true sine wave.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33352"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8530.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="davekramkowski&#039;s picture" title="davekramkowski&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibrating EmonTX</h3>

    <div class="submitted">Submitted by <a href="../user/8530.html" title="View user profile.">davekramkowski</a> on Sat, 15/08/2015 - 02:19.</div>
    <div class="content">
     <p>Well, I think my multimeter is flaky. I was checking the resistors I got for the Wattcore CTs and was getting readings much higher than I should have (17+ Ohms for a 15Ohm Resistor) and different readings on the same resitor :/. One day I should probably buck up and buy a decent one like a Fluke.</p>
<p>At any rate, I think I got the Wattcore CTs pretty much dialed in. Using the same 1000W heater I used with the YHDC CTs, along with the YHDC CTs, and got all four CTs reading within 1-3W of each other. With the 60W bulb again, readings were also real close to 60W, and the wire run through the CTs twice, was pretty much spot on around 120W. I doubt I could get them any closer. It&#39;s interesting how on the same wire, with the same load and such, the readings from the CTs fluctuate differently.</p>
<p>Is there some kind of foam or other filler that would be safe to wrap around the wires under the YHDC CTs to keep them well centered over the wire? The Wattcores over the main feeds are pretty much a perfect fit, but the YHDCs on my sub-panel feeds have a lot of &#39;wiggle room&#39;.</p>
<p>Now that I have the whole hose monitored, on to play with EmonCMS :).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33353"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibrating EmonTX</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sat, 15/08/2015 - 02:40.</div>
    <div class="content">
     <p><em>Is there some kind of foam or other filler that would be safe to wrap around the wires under the YHDC CTs to keep them well centered over the wire? The Wattcores over the main feeds are pretty much a perfect fit, but the YHDCs on my sub-panel feeds have a lot of &#39;wiggle room&#39;.</em></p>
<p>Here&#39;s a thread that answers that question: <a href="3360.html">http://openenergymonitor.org/emon/node/3360</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33362"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibrating EmonTX</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 15/08/2015 - 12:49.</div>
    <div class="content">
     <p><i>"One day I should probably buck up and buy a decent one like a Fluke."</i></p>
<p>There's a Building Blocks article about multimeters that you should read before spending your money.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11099"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-dMPWLh-SbR5xRfdY7jKEdxMhts0PG8_bUiiYpbJiQAA" value="form-dMPWLh-SbR5xRfdY7jKEdxMhts0PG8_bUiiYpbJiQAA"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
