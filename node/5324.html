<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5324 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:38:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Code to upload first? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Code to upload first?</h3>
        <span class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Fri, 20/06/2014 - 18:55</span>
        <div class="content"><p>I recently purchased fully assembled&nbsp;emonTx&nbsp;V3. I downloaded USB to UART&nbsp;Drivers and then installed libraries as given in the instructions on this website. I also downloaded the emonTxFirmware. According to the instructions, i now need to upload&nbsp;<strong>emonTx_CT123_Voltage</strong>​. However inside the sketchbook, this code is contained within emonTx V2 folder, whereas i purchased emonTx V3.&nbsp;</p>
<p>Is this the first code that i need to upload? I can&#39;t find&nbsp;<strong>emonTx_CT123_Voltage&nbsp;</strong>inside the folder for emonTx&nbsp;V3.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6143.html" class="topic-previous" title="Go to previous forum topic">‹ Using TinyTX and LDR to measure Watt on my power meter</a>
              <a href="10002.html" class="topic-next" title="Go to next forum topic">emonHub RX frame node id outside scope ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-22082"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Fri, 20/06/2014 - 19:58.</div>
    <div class="content">
     <p>Hi,</p>
<p>For EmonTxV3, follow the instructions <a href="../modules/emonTxV3.html">here</a>.</p>
<p>The main sketck for EmonTX V3 is <a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling">emonTxV3_RFM12B_DiscreteSampling</a>.</p>
<p>(I assume you have purchased a V3 with RF)</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22086"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Fri, 20/06/2014 - 22:17.</div>
    <div class="content">
     <p>Yes i purchased fully assembled&nbsp;V3 with 433 Mhz. However at the moment i want to keep it simple and DO NOT want to include any RF. I have purchased:</p>
<p>1) USB to UART cable</p>
<p>2) 2 CTs</p>
<p>3) AC-AC power supply adapter</p>
<p>4) emonTx V3</p>
<p>5) Mini-USB cable</p>
<p>All i want at the moment is to get the Apparent Power and Real Power values at the serial monitor of the Arduino IDE. According to the instructions page that you mentioned above, it says that i do not need to upload any firmware since it is already uploaded.&nbsp;</p>
<p>If this is the case and keeping in view that i do not want to use RF, how should i proceed?</p>
<p>Appreciate your help.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22087"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 20/06/2014 - 22:46.</div>
    <div class="content">
     <p>Unfortunately, the default sketch only gives you real power at the serial monitor, it does not provide you with apparent power. Therefore you will need to add a few lines of code to your sketch and re-load it.</p>
<p>If you look at the sketch, you&#39;ll see that, in the main loop you have a section for each CT (inside an &quot;if&quot; block selected by &quot;if (CT1)&quot;. I&#39;ll only tell you about CT1, you can do the same to all 4. The method &quot;calcVI&quot; actually gets and processes all the data that you require, you just need to extract the values. These are:</p>
<p class="rteindent1">double realPower,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; apparentPower,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; powerFactor,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vrms,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Irms;</p>
<p>(Look at emonlib.h to find them.)</p>
<p>Therefore all you have to do is add, inside &quot;if (debug==1) {Serial.print(emontx.power1); Serial.print(&quot; &quot;);}&quot; another Serial.print to give you <em>ct1.apparentPower</em>.&nbsp; <em>emontx.power1</em> is actually<em> ct1.realPower </em>if an AC adapter is present, otherwise it is apparent power using an assumed value for the voltage.</p>
<p>Having made that change, upload the sketch to your emonTx V3 and monitor the serial output. You will need the AC adapter and a CT connected, and a serial (programmer) connection, to get the sketch to go through the correct branches to print the values.</p>
<p>If you wish to not transmit the data, you can comment out the line &quot;send_rf_data();&quot;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22088"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 20/06/2014 - 22:58.</div>
    <div class="content">
     <p>If you just power up the board with the AC adapter, what does it show at the Serial monitor?&nbsp; If nothing seems to be happening, you could try pressing the reset button while&nbsp; the Serial Monitor is open.&nbsp; The standard V3 sketch should identify itself as part of its start-up sequence.&nbsp; The Baud rate in the Serial Monitor will need to be set to 9600 to match the line:</p>
<pre>
Serial.begin(9600);</pre><p>&nbsp;With the default sketch, RF messages are routinely transmitted, but they&#39;re not doing any harm.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22094"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Sat, 21/06/2014 - 11:18.</div>
    <div class="content">
     <p>Since i am using serial monitor so my only way of powering the emonTx&nbsp;V3 is through the programmer (USB to UART cable). Before making any modifications for calculating apparent power as suggested by Robert Wall, i thought i should check real power at the serial monitor. When i try to upload the sketch&nbsp;<strong>&#39;</strong><strong>emonTxV3_RFM12B_Discrete Sampling&#39;</strong>, i keep getting the same error which says&nbsp;<strong>&#39;sleepy&#39; has not been declared&#39;.&nbsp;</strong></p>
<p>I don&#39;t know what to do with it. Any suggestions?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22097"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 21/06/2014 - 12:37.</div>
    <div class="content">
     <p>does this help at all&nbsp;<a href="512.html">http://openenergymonitor.org/emon/node/512</a></p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22099"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Sat, 21/06/2014 - 13:28.</div>
    <div class="content">
     <p>Thanks pb66.</p>
<p>I resolved the problem since i had made the same mistake of not renaming the files.&nbsp;</p>
<p>Regards</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22260"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Wed, 02/07/2014 - 17:01.</div>
    <div class="content">
     <p>void loop()<br />
	{<br />
	&nbsp;<br />
	&nbsp; if (CT1) {<br />
	&nbsp; double irms = ct1.calcIrms(no_of_samples);<br />
	&nbsp; Serial.print(irms); Serial.print(&quot;&nbsp; &quot;);<br />
	&nbsp; emontx.power1 = irms*Vrms;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calculate Apparent Power 1&nbsp; 1480 is&nbsp; number of samples<br />
	&nbsp; if (debug==1) Serial.println(emontx.power1);<br />
	&nbsp; delay(5000);<br />
	&nbsp; }<br />
	}</p>
<p>&nbsp;</p>
<p>I am using the above simple code to calculate the apparent power value. The Vrms is set to default 240 V. Could someone please explain the significance of&nbsp;<strong>no_of_samples?</strong> Why is it set to 1480 and what happens if i change its value?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22261"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 02/07/2014 - 18:28.</div>
    <div class="content">
     <p>It is the number of samples over which the average is calculated. That should be very obvious from the code, if you look into the workings of emonLib. What might not be so obvious is that you should have an integer number of cycles over which you calculate the average. Unfortunately, as you are not measuring voltage, you have no means of knowing when a cycle starts and ends, so you have to make a guess at how long a cycle is in terms of the number of samples. Then you need a reasonably long sampling period so that &#39;end effects&#39;, if you include part of a cycle because your guess was wrong, are minimised. But the sampling period should be short enough to keep the power drain to an acceptable level if you are running on batteries. Knowing the approximate sampling rate and bearing in mind that the sketch must be suitable for both 50 Hz and 60 Hz systems, 1480 seemed to be a good choice. If you wish, you are free to change it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22262"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Wed, 02/07/2014 - 18:53.</div>
    <div class="content">
     <p>I am using the programmer to power the emontx V3 since i require values at serial monitor.</p>
<p>Based on the code pasted above, i got the following values at the serial monitor:</p>
<p>0.14&nbsp; 34.60<br />
	0.14&nbsp; 33.79<br />
	0.14&nbsp; 33.87<br />
	0.14&nbsp; 34.04<br />
	0.14&nbsp; 34.06<br />
	0.14&nbsp; 33.99<br />
	0.14&nbsp; 34.18<br />
	0.14&nbsp; 33.79</p>
<p>The values in the left column are for irms current and those in the second column are for apparent power. My question is that why do i keep getting different values for apparent power for the same current value? The Vrms value is fixed at 240 V and based on the multiplication i should keep getting the constant value:</p>
<p>0.14 (A) * 240 (V) = 33.6 VA</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22264"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 02/07/2014 - 20:21.</div>
    <div class="content">
     <p>I think this is just an effect of the precision with which the value for Irms is being displayed.&nbsp; 0.15 (A) * 240 (V) = 36 VA, so any power value between 33.6 and 36 could reasonably be displayed alongside the 0.14 value.&nbsp; If you were to display the Irms value to more precision, this effect would probably disappear.&nbsp;</p>
<pre>
Serial.println(Irms, 4);  // to display four decimal places rather than the normal two</pre><p>If you can monitor voltage as well as current, your value for power will be much more accurate.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22265"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Wed, 02/07/2014 - 22:33.</div>
    <div class="content">
     <p>Thank you.</p>
<p>I am facing another problem too. I keep getting the 0.14 A value irrespective of the connection of the Current Transformer.&nbsp;</p>
<p>When the Current Transformer is not connected to any wire, i get the same value of 0.14 A and when i connect it across a t.v powering cable, i still get the same value.&nbsp;</p>
<p>From what i think, i should get 0 A when CT is not connected across a cable and 0.14 A value only when it is clipped across a cable.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22268"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 02/07/2014 - 23:10.</div>
    <div class="content">
     <p>Unless you are clipping the CT around one core only, of the TV&#39;s power lead you will not get a reading as you are effectively measuring in 2 places in 2 directions which will cancel each other out.</p>
<p>A TV is not the best load to use for testing, a short extn lead with a short length of the outer sheath removed will allow you to clip ct on one core and test on a steady resistive load like a incandescent lamp or a kettle.</p>
<p>There may also be some &quot;noise&quot; present when working correctly but no load present, it is unlikely to read exactly 0.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22272"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 03/07/2014 - 06:32.</div>
    <div class="content">
     <p><em>From what i think, i should get 0 A when CT is not connected across a cable and 0.14 A value only when it is clipped across a cable.</em></p>
<p>If no current is flowing through your test cable, it should not matter whether the CT is clipped around the cable or not.&nbsp; You should be seeing 0 A in both cases</p>
<p>When using the&nbsp; &quot;current-only&quot; sketch (which involves squaring the measured value), all signal from the CT is seen as positive, so the calculated value is always greater than zero.&nbsp; But when you measure voltage as well (which is negative for 50% of the time), nearly all of that calculated power goes away.</p>
<p>On the systems that I build, the background power value is never greater that a Watt, and usually much less.&nbsp; That&#39;s 35 times lower than you are seeing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22314"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Fri, 04/07/2014 - 11:57.</div>
    <div class="content">
     <p>I am still a little confused about the values of calibration for CT. Sometimes its 111.1 and other times its 90.9.</p>
<p>1) Can someone briefly explain which one of them is correct since both give different values of Irms.&nbsp;</p>
<p>I need to know this so that i can get on with my work rather than spend time worrying about calibration values.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22315"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 04/07/2014 - 12:58.</div>
    <div class="content">
     <p>They are both correct - in different circumstances. Of course they will give different values, that is what calibration is all about. Look for the page about &quot;CT and AC power adaptor installation and calibration theory&quot; in Building Blocks.&nbsp; You can read all about it there.</p>
<p>You will also find it very instructive to read the page &quot;Calibration&quot;.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22358"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Mon, 07/07/2014 - 16:06.</div>
    <div class="content">
     <p>The UK mains supply 230 V RMS. If that&#39;s the case then i don&#39;t understand the logic of calculating Vrms based on the following code:</p>
<p>double V_RATIO = VCAL *((SUPPLYVOLTAGE/1000.0) / (ADC_COUNTS));<br />
	Vrms = V_RATIO * sqrt(sumV / numberOfSamples);</p>
<p>Why can&#39;t we just put a constant value of 230 V instead of calculation above?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22359"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3434.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jpbrigg&#039;s picture" title="jpbrigg&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/3434.html" title="View user profile.">jpbrigg</a> on Mon, 07/07/2014 - 18:28.</div>
    <div class="content">
     <p>BS 7671 Appendix 2 section 14.<br />
	The UK supply 230 V +10% - 6%</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22361"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Mon, 07/07/2014 - 19:13.</div>
    <div class="content">
     <p>I understand the logic of calculating RMS voltage and RMS current since the product of these two quantities gives us the apparent power. However what confuses me the most is the calculation of real power.</p>
<p>
	From my understanding, the real power is simply the average of the instantaneous power (product of instantaneous current and instantaneous voltage).&nbsp; The code uses the following lines to calculate the real power (or average power)</p>
<p>
	1) (calculates the instantaneous power)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; instP = phaseShiftedV * filteredI;&nbsp;&nbsp;</p>
<p>
	2) (Takes the average)<br />
	sumP +=instP;&nbsp;&nbsp;<br />
	sumP / numberOfSamples;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>Now my question simply is that how can we assume <strong>phaseshiftedV</strong> is the instantaneous voltage when it simply is the&nbsp;RMS voltage measured by the AC-AC adapter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22367"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 07/07/2014 - 21:03.</div>
    <div class="content">
     <p><em>&quot;Now my question simply is that how can we assume phaseshiftedV is the instantaneous voltage when it simply is the RMS voltage measured by the AC-AC adapter.</em>&quot;</p>
<p>That is totally wrong, and where your misunderstanding lies. It is not the rms value (the ac-ac adapter does no calculation of its own, it is only a transformer in a case), phaseshiftedV is indeed the instantaneous voltage - but &quot;phaseshifted&quot; is probably the wrong word, it would be more accurate (but a lot harder to write) to call it the interpolated/extrapolated time-shifted instantaneous approximation. You can read up about it in Building Blocks (of course) in &quot;Explanation of the phase correction algorithm&quot;.</p>
<p>You can read why the UK voltage has asymmetrical tolerances in the appendix to my test reports on the AC adapters.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22389"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Tue, 08/07/2014 - 12:48.</div>
    <div class="content">
     <p>Thanks Robert.</p>
<p>From my understanding based on your explanation in&nbsp;<strong>Ideal Power 9V AC-AC Adaptor (Voltage Transformer),&nbsp;</strong>i assume that the adapter exhibits a phase lead in the input voltage to the arduino processor. Now in order to overcome this error, we pass on the calibration constant (1.7) in the code to determine the&nbsp;<strong>phaseShiftedV&nbsp;</strong>which we utilize to measure the realPower (please correct me if i am wrong)</p>
<p>My question is that can we use&nbsp;<strong>phaseShiftedV&nbsp;</strong>instead of&nbsp;<strong>filteredV</strong>​ to determine the&nbsp;<strong>Vrms?</strong></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22392"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 08/07/2014 - 16:10.</div>
    <div class="content">
     <p>Phase is vitally important when calculating real power. That is why the correction is applied. Note the correction is not because of the phase lead in the VT, it is because of the phase <em>difference</em> between the ct and vt, plus the <em>time</em> difference between the two samples. Phase does not matter when calculating rms voltage (or rms current). You could make the change, but why should you want to? The only reason that I can see is to account for the small amplitude difference that the interpolation/extrapolation algorithm introduces.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22393"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Tue, 08/07/2014 - 16:30.</div>
    <div class="content">
     <p>Thank you Robert</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22433"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6377.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="yhabib&#039;s picture" title="yhabib&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/6377.html" title="View user profile.">yhabib</a> on Thu, 10/07/2014 - 13:36.</div>
    <div class="content">
     <p>I have started to get the following error while uploading the sketches:</p>
<p><strong>Found programmer: Id = &quot;&quot;; type =</strong></p>
<p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;Software Version = &nbsp; .; Hardware Version = .a</strong></p>
<p><strong>avrdude: error: buffered memory access not supported. Maybe it isn&#39;t<br />
	a butterfly/AVR109 but a AVR910 device?</strong></p>
<p>&nbsp;</p>
<p>Can someone help?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26721"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7229.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="truzzman&#039;s picture" title="truzzman&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/7229.html" title="View user profile.">truzzman</a> on Mon, 12/01/2015 - 20:55.</div>
    <div class="content">
     <p>I&#39;m a real dummy....</p>
<p>I try ti set some print.serial line to show also apparent power Irms and power factor but I am unable to have some code that works.</p>
<p>Could you write the exact code? thanks</p>
<p>I use emontx 3 and &quot;emonTxV3_RFM12B_DiscreteSampling.ino&quot;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26728"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 12/01/2015 - 23:09.</div>
    <div class="content">
     <p>Yes, I could. But instead I will tell you how to find what you want to print.</p>
<p>Look at your sketch. How is Real Power printed?  It comes from ct1.RealPower</p>
<p>So what is ct1?  It's an instance of the class EnergyMonitor. What's that? Just above where you find the definition of ct1, you see "#include "EmonLib.h"" Find that file. That's where the class EnergyMonitor is declared.  Look down it and you'll see a list of names that are "public". Amongst them you'll find realPower, plus the ones that you are looking for.</p>
<p>Now does that tell you what you need to do to print apparentPower and powerFactor? - It should do.<br />
For ct1, the variables you want are ct1.apparentPower and ct1.powerFactor.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26761"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7229.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="truzzman&#039;s picture" title="truzzman&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/7229.html" title="View user profile.">truzzman</a> on Tue, 13/01/2015 - 22:31.</div>
    <div class="content">
     <p>Thanks, some work (after a night of study) and this code seems to work:</p>
<p>&nbsp;if (debug==1) {<br />
&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;CT1 REAL POWER= &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(ct1.realPower);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot; &quot;); &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;CT1 APPARENT POWER= &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(ct1.apparentPower);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot; &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;CT1 Power Factor= &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(ct1.powerFactor);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot; &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Irms CT1= &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(ct1.Irms);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot; &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot; &quot;);</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26767"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Code to upload first?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 13/01/2015 - 23:21.</div>
    <div class="content">
     <p>That's all correct. Learning is always hard work, I hope it was worth the effort. Now you understand a little about object oriented programming and how classes work.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5324"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-n3jxMtGdSz57JS2jvjsdFhlQFjLvl2wAxwzG-DFqkvE" value="form-n3jxMtGdSz57JS2jvjsdFhlQFjLvl2wAxwzG-DFqkvE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
