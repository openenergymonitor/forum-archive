<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3467 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:01:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>water meter... yeah again i know | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">water meter... yeah again i know</h3>
        <span class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 01/01/2014 - 07:17</span>
        <div class="content"><p>I just saw that v3&nbsp;has come out</p>
<p>&nbsp;</p>
<p>does this make is any easier to read water meters that have a read switch and the bounce that comes with it compared to an optical read that gives a low/high output with nice sharp signal ??</p>
<p>&nbsp;</p>
<p>last time i used openenergy i had trouble with the meters dial slowly went out of sync with what i could count on the read switch....&nbsp;</p>
<p>&nbsp;</p>
<p>is there any interest in water meter monitoring ?&nbsp;</p>
<p>&nbsp;</p>
<p>as said i have a meter... very much interested in doing monitor on it... but if course i have to be able to count on the data i collect....&nbsp;</p>
<p>&nbsp;</p>
<p>an idea right out of my mind could be some kind of calibration routine, ie a special sketch that you load and you tell it how many pulses each liter, then you open the tap and messure say excat 10 liters... and the emon board should now check if what you have told fits and maybe give you numbers for a software debounce&nbsp;routine so the &quot;normal&quot; sketch only counts the relly on state and the relly off state and not the noise that happens when the reed switch makes contact and when it breaks contact</p>
<p>&nbsp;</p>
<p>on the emon cms&nbsp;side i also missed an easy way to see these things: flow rate, total usage, usage between readings, dayli usage....</p>
<p>&nbsp;</p>
<p>one more thought that just came to mind, fine tune calibration.... you could do that by connecting a laptop to ftdi connector and hit enter to get a form of CLI... then enter what the dial says.... the sketch should then calc the difference and adjust with that... so quickly it should stay in sync....&nbsp;</p>
<p>&nbsp;</p>
<p>does it make any sense?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5942.html" class="topic-previous" title="Go to previous forum topic">‹ Mounting DS18B20s on pipework</a>
              <a href="5987.html" class="topic-next" title="Go to next forum topic">Multiple transmitters ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-17166"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3367.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3367.jpg" alt="Dan Woodie&#039;s picture" title="Dan Woodie&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3367.html" title="View user profile.">Dan Woodie</a> on Wed, 01/01/2014 - 15:39.</div>
    <div class="content">
     <p>I have not attempted this yet but have an interest in using my emonTX v2 to measure my gas and water meter. I have not verified if they have magnets in them yet but hope to do that this week. My thoughts on switch bounce was to have it look for a set time period of unchanging state before it declares the switch as having flipped. So, it reads the digital input, and then starts timing and waits for the value to not change for a set period of time. If it sees the same input value for 0.5 second or more, it concludes the switch has flipped and records it. I figured the switch bounce has to occur on a much smaller time scale than the meter wheel turning so setting that time period will not be an issue.</p>
<p>I am using a interrupt driven electrical power measuring routine to measure power (EmonLibPro), so my main loop simply repeats until the appropriate calculation / output interval. Adding a routine to check the input with a timer and flip a logical state seemed to me to be a low calculation overhead routine that might work. I am open to comments from more experienced folks if that assumption is incorrect.</p>
<p>Dan</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17181"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 01/01/2014 - 23:35.</div>
    <div class="content">
     <p>I think you are on to something.... my meter says one pulse pr liter and even at full blast it takes about 7 sec&#39;s to get the one liter.... of course the more taps that are open the fast the wheel would spin... having 5 taps i guess that period could become very small, but who opens 5 taps at full blast at same time...</p>
<p>&nbsp;</p>
<p>its rare i have kitchen tap open full at same time as dishwasher takes in water while clothes washer do the same.... and that was only 3 of them... now it would be less rare that the bathroom sink is open at full while someone takes a shower and the toilet is flushed.... :-D so in fact it was 6 taps... so its 1 sec or so if in theory all taps are open at full at same time....&nbsp;</p>
<p>&nbsp;</p>
<p>last time i did monitor my usage i had most figures down.... flowrate even thou it was a pain to get right</p>
<p>&nbsp;</p>
<p>usage between readings was also nasty to figure out....</p>
<p>&nbsp;</p>
<p>with my best math everything was right, but then i discovered that over time the number on the meter and the one messuered&nbsp;started to drift more and more apart...</p>
<p>thou if i filled a bucket with 10 liters it would still messure&nbsp;so...&nbsp;</p>
<p>&nbsp;</p>
<p>and as there was not an easy way for me to get that right it made no sense to continue...</p>
<p>&nbsp;</p>
<p>not that openenegy is bad... far from... the idea is right... but it just seems to much focused on electricity&nbsp;alone</p>
<p>&nbsp;</p>
<p>i wish that emoncms had calc routines for water build in... ie quick way to calc&nbsp;useage&nbsp;numbers... and routines to get the meter to stay in sync... i gues some stuff cant be calced&nbsp;at the backend but has to me figured on the board... stuff like flowate changes so fast it has to be done at board level...</p>
<p>&nbsp;</p>
<p>again... openenergy is a good site.... i just wish it would add easy handling for water etc etc</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19167"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1178.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1178.jpg" alt="alco&#039;s picture" title="alco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/1178.html" title="View user profile.">alco</a> on Tue, 11/03/2014 - 21:45.</div>
    <div class="content">
     <p><em>@Boelle, did you have some luck to get a daily water use (or total) on the emoncms /server side?<br />
	I have read some older post from your water meter and I got the same problem.</em></p>
<p>	My optical sensor gets the pulses and count them for 60 seconds and than it sends the total of pulses to emoncms. But How do I get a total of this at a daily rate? I tried with the power_to_kwhd but no luck.. I get this kind of graphics in emoncms now:</p>
<p>Do<img alt="" src="../sites/default/files/water%20pulse.png" style="height: 199px; width: 550px;" /></p>
<p>So did somebody get this working yet?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19168"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Tue, 11/03/2014 - 22:00.</div>
    <div class="content">
     <p>Hi,</p>
<p>Take your pulse input and add an accumulator process, then you want to add &quot;kWh to kWhd&quot; after that. In other words, you&#39;ll have three feeds from the one input: instantaneous pulse count, total pulses (accumulator) and daily pulses (kWh to kWhd).</p>
<p>You can then visualise daily pulses feed using a bar chart.</p>
<p>This takes advantage of what &quot;kWh to kWhd&quot; really does, which is &quot;incrementing counter to daily increments&quot; - it doesn&#39;t matter if your count is of kWh or anything else :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19176"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1178.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1178.jpg" alt="alco&#039;s picture" title="alco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/1178.html" title="View user profile.">alco</a> on Wed, 12/03/2014 - 10:44.</div>
    <div class="content">
     <p>Tnx Dave,</p>
<p>It works like a charm :)</p>
<p>For reference to other users: a print screen from the input processors:</p>
<p><img alt="" src="../sites/default/files/daily_water.png" style="width: 550px; height: 177px;" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19178"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Wed, 12/03/2014 - 11:00.</div>
    <div class="content">
     <p>I added an oblique reference to this under the kWh to kWhd entry in the emonCMS documentation recently, but I can understand why nobody would read that just in case it did water monitoring. I think it might be possible to justify renaming processes to be less electricity specific at some future point.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19180"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Wed, 12/03/2014 - 13:07.</div>
    <div class="content">
     <p>Perhaps you could consider looking at the reed switch bounce in a different way - rather than trying to program it out, put in a simple circuit to fix it?</p>
<p>Its a very common problem in digital electronics, and can normally be reduced using a capacitor and a small circuit, look here for ideas.</p>
<p><a href="http://www.labbookpages.co.uk/electronics/debounce.html" title="http://www.labbookpages.co.uk/electronics/debounce.html">http://www.labbookpages.co.uk/electronics/debounce.html</a></p>
<p><a href="http://www.eng.utah.edu/~cs5780/debouncing.pdf" title="http://www.eng.utah.edu/~cs5780/debouncing.pdf">http://www.eng.utah.edu/~cs5780/debouncing.pdf</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19564"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Fri, 21/03/2014 - 07:50.</div>
    <div class="content">
     <p>hmm...</p>
<p>&nbsp;</p>
<p>been away for some time but might get back to monitoring...</p>
<p>&nbsp;</p>
<p>the hardware way seems ok, will look again at the first link, just have to figure values so i dont filter out real event.</p>
<p>if i remember correct it took me 7 sec&#39;s to fill 1 liter at full blast from one tab, and dont think the pressure is high enough to half that if i open more</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19565"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Fri, 21/03/2014 - 08:03.</div>
    <div class="content">
     <p>You shouldn&#39;t need to worry about a hardware debounce - j<span style="font-size: 12px;">ust get the sketch to ignore interrupts within a certain time period of the first one.</span></p>
<p><span style="font-size: 12px;">If you think about what a debounce is, hardware or&nbsp;</span><span style="font-size: 12px;">firmware&nbsp;</span><span style="font-size: 12px;">it results in the same outcome - contacts above a certain frequency are ignored. You may as&nbsp;well avoid the hardware side altogether and set your maximum frequency in firmware where it&#39;s easy to adjust.</span></p>
<p><span style="font-size: 12px;">If one tap provides a pulse every 7 seconds, then I&#39;m guessing you could probably set a maximum frequency of 1Hz (get the sketch to ignore interrupts that happen &lt; 1000ms from the time of the last interrupt), allowing you to run seven taps full blast...</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21539"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 24/05/2014 - 11:10.</div>
    <div class="content">
     <p>So slowly building my sketch now..&nbsp;</p>
<p>&nbsp;</p>
<p>based it of the low power temp sketch even thou it will be powered by 5V... just wanting to keep it efficient.</p>
<p>&nbsp;</p>
<p>Also planning to have it in sleep unless i actually use water... as for the debounce i got a few examples to go from</p>
<p>&nbsp;</p>
<p>BUT: how do i make sure i dont loose data during a power outage? i mean i can easy count up the pulses etc and lucky me 1 pulse = 1 liter..</p>
<p>&nbsp;</p>
<p>but should i really count one pulse then transmit and reset to 0 and then back to sleep and then just add them in emoncms?</p>
<p>and how do i calc the flow rate ? ie liters pr min or sec can that be done reliable in emoncms too?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21540"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 24/05/2014 - 11:14.</div>
    <div class="content">
     <p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/emonTx_Pulse/emonTx_Pulse.ino" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/emonTx_Pulse/emonTx_Pulse.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2...</a></p>
<p>&nbsp;</p>
<p>suggests that the counted pulses are reset at each transmit right?</p>
<p>&nbsp;</p>
<p>and flow are calculated at each pulse or interrupt... only downside would be that emoncms thinks the flow is high between transmits? or do i get it wrong?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21541"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 24/05/2014 - 11:49.</div>
    <div class="content">
     <p>tried to hack together a sketch, let me know if its total bonkers</p>
<p>#define RF_freq RF12_433MHZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Frequency of RF12B module can be RF12_433MHZ, RF12_868MHZ or RF12_915MHZ. You should use the one matching the module you have.<br />
	const int nodeID = 18;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // emonTx temperature RFM12B node ID - should be unique on network<br />
	const int networkGroup = 210;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // emonTx RFM12B wireless network group - needs to be same as emonBase and emonGLCD</p>
<p>#define RF69_COMPAT 0 // set to 1 to use RFM69CW<br />
	#include &lt;JeeLib.h&gt;&nbsp;&nbsp; // make sure V12 (latest) is used if using RFM69CW<br />
	#include &lt;avr/sleep.h&gt;<br />
	ISR(WDT_vect) { Sleepy::watchdogEvent(); }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Attached JeeLib sleep function to Atmega328 watchdog -enables MCU to be put into sleep mode inbetween readings to reduce power consumption</p>
<p>typedef struct {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int flow;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; int pulse;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp; int battery;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	} Payload;<br />
	Payload emontx;</p>
<p>const int LEDpin = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //LED connected to Pin 9. Used to flash when transmitting</p>
<p>// Pulse counting settings<br />
	long pulseCount = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Number of pulses.<br />
	unsigned long pulseTime,lastTime;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Used to measure flowrate.<br />
	double flow, elapsedl;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // flow and liter<br />
	int ppl = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // pulses pr. liter.</p>
<p>long debouncing_time = 1000; //Debouncing Time in Milliseconds<br />
	volatile unsigned long last_micros;</p>
<p>void setup() {<br />
	&nbsp; Serial.begin(9600);<br />
	&nbsp; Serial.println(&quot;OpenTRV Pulse counting Example&quot;);<br />
	&nbsp; Serial.println(&quot;opentrv.org.uk&quot;);<br />
	&nbsp; Serial.print(&quot;Node: &quot;);<br />
	&nbsp; Serial.print(nodeID);<br />
	&nbsp; Serial.print(&quot; Freq: &quot;);<br />
	&nbsp; if (RF_freq == RF12_433MHZ) Serial.print(&quot;433Mhz&quot;);<br />
	&nbsp; if (RF_freq == RF12_868MHZ) Serial.print(&quot;868Mhz&quot;);<br />
	&nbsp; if (RF_freq == RF12_915MHZ) Serial.print(&quot;915Mhz&quot;);<br />
	&nbsp; Serial.print(&quot; Network: &quot;);<br />
	&nbsp; Serial.println(networkGroup);</p>
<p>	&nbsp;<br />
	&nbsp;<br />
	&nbsp; rf12_initialize(nodeID, RF_freq, networkGroup);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // initialize RFM12B<br />
	&nbsp; rf12_control(0xC040);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // set low-battery level to 2.2V i.s.o. 3.1V<br />
	&nbsp; delay(10);<br />
	&nbsp; rf12_sleep(RF12_SLEEP);</p>
<p>
	&nbsp; pinMode(LEDpin, OUTPUT);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Setup indicator LED<br />
	&nbsp; digitalWrite(LEDpin, LOW);<br />
	&nbsp;<br />
	&nbsp;<br />
	attachInterrupt(1, debounceInterrupt, RISING);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // interrupt attached to pin3</p>
<p>}</p>
<p>void loop()<br />
	{</p>
<p>	&nbsp; emontx.pulse=pulseCount; pulseCount=0;<br />
	&nbsp; emontx.battery=readVcc();<br />
	&nbsp; rf12_sleep(RF12_WAKEUP);<br />
	&nbsp; // if ready to send + exit loop if it gets stuck as it seems too<br />
	&nbsp; int i = 0; while (!rf12_canSend() &amp;&amp; i&lt;10) {rf12_recvDone(); i++;}<br />
	&nbsp; rf12_sendStart(0, &amp;emontx, sizeof emontx);<br />
	&nbsp; // set the sync mode to 2 if the fuses are still the Arduino default<br />
	&nbsp; // mode 3 (full powerdown) can only be used with 258 CK startup fuses<br />
	&nbsp; rf12_sendWait(2);<br />
	&nbsp; rf12_sleep(RF12_SLEEP);&nbsp;<br />
	&nbsp; digitalWrite(LEDpin, HIGH); delay(2); digitalWrite(LEDpin, LOW);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // flash LED<br />
	&nbsp; Sleepy::loseSomeTime;<br />
	}</p>
<p>long readVcc() {<br />
	&nbsp; long result;<br />
	&nbsp; ADMUX = _BV(REFS0) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1);<br />
	&nbsp; delay(2);<br />
	&nbsp; ADCSRA |= _BV(ADSC);<br />
	&nbsp; while (bit_is_set(ADCSRA,ADSC));<br />
	&nbsp; result = ADCL;<br />
	&nbsp; result |= ADCH&lt;&lt;8;<br />
	&nbsp; result = 1126400L / result;<br />
	&nbsp; return result;<br />
	}</p>
<p>
	void debounceInterrupt() {<br />
	&nbsp; if((long)(micros() - last_micros) &gt;= debouncing_time * 1000) {<br />
	&nbsp;&nbsp;&nbsp; onPulse();<br />
	&nbsp;&nbsp;&nbsp; last_micros = micros();<br />
	&nbsp; }<br />
	}</p>
<p>void onPulse()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	{<br />
	&nbsp; lastTime = pulseTime;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //used to measure time between pulses.<br />
	&nbsp; pulseTime = micros();<br />
	&nbsp; pulseCount++;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //pulseCounter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; emontx.flow = int((3600000000.0 / (pulseTime - lastTime))/ppl);&nbsp; //Calculate flowrate in Liters pr. hour<br />
	}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21543"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 24/05/2014 - 13:43.</div>
    <div class="content">
     <p>Bo, the generally perceived wisdom is you can&#39;t debounce a mechanical switch with interrupts. You need a history of what has gone before and when, and ideally after too, and that is not available in enough detail. I threw together a sketch for a gas meter, which Eric Amann says is working perfectly, and you&#39;re welcome to try that. But it works by polling, not interrupts (the interrupts are just the timebase) so it&#39;s not practical for a battery-powered rig.</p>
<p>Somewhere, probably under gas monitoring, there&#39;s a long discussion about the best strategy for lost and interrupted power/data. Basically, it&#39;s hard to win under every set of conditions. If you keep an &#39;all-time&#39; total at source and send that at intervals, then at emonCMS you need to make assumptions to cater for resetting and roll-over, and differentiate to get rates, which will be wrong if data is lost in transmission, though the accumulated total will be correct. If you send rates in some guise or other, then emonCMS needs to make assumptions about the rate when data is lost, and the accumulated total will be wrong (and most probably the rate as well). You can try to store the accumulated count at source in EEPROM, but that has a limited number of writes, so cannot be done every few seconds (but from memory, daily is reasonable).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21561"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 26/05/2014 - 08:29.</div>
    <div class="content">
     <p>oki, will do a hunt for the sketch....i just figured interrupts was ok to use if yd did it carefull enough...&nbsp;</p>
<p>&nbsp;</p>
<p>the idea of my sketch was to count the pulse on interrupt and ignore any pulses within the next second... my meter takes 2 sec&#39;s before it has taken a full turn with all taps open, 7 sec&#39;s if only one tap open.</p>
<p>&nbsp;</p>
<p>also i would move the transmission stuff down in the interrupt routine so it would only transmit if something happens and hence have it in sleep most of the time</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21562"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 26/05/2014 - 08:47.</div>
    <div class="content">
     <p>your sketch is the one posted at &nbsp;Fri, 25/04/2014 - 22:17</p>
<p>??</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21563"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 26/05/2014 - 09:04.</div>
    <div class="content">
     <p>hmm.. looking a bit at emontx v2 vs v3...</p>
<p>is it to push it to have the v3 monitor 3 phases of electricity and a water meter at same time given that 3 phases will require 2 extra ac inputs.</p>
<p>if that is doable what is left of IO ?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21565"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 26/05/2014 - 09:37.</div>
    <div class="content">
     <p>looking at it... there is DIG 8 and 10 as pads... those i could use to read my heat meter, its an kamstrup multical 601 and has a 2 way Ir&nbsp;port on the front, it will not put out data unless requested so need both ways</p>
<p>&nbsp;</p>
<p>there is one AC input so only need 2 more and could use DIG19 /&nbsp;ADC5 for one of them as i dont plan to messure&nbsp;temp</p>
<p>&nbsp;</p>
<p>i dont see any other free ADC pins so are the only way to desolder the components at CT4 and use that one...</p>
<p>&nbsp;</p>
<p>of course it all assumes that i hardwire this in .... using DIG2 to count pulses...</p>
<p>&nbsp;</p>
<p>does it sound total bonkers? have i counted things wrong?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21575"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 26/05/2014 - 13:05.</div>
    <div class="content">
     <p>The sketch is on Github - emonTx V3 - Examples.</p>
<p>There&#39;s very little done in the ISR, so I don&#39;t see why it should add an appreciable load. I used the V3 and DIO2 for testing as it has the pull-down fitted, and most people are migrating towards the V3. You could use any convenient input.</p>
<p>I understand what you mean about sleeping but as I wrote above, you need to know what has happened before and after the real transition in order to determine that it really was a genuine transition that you are interested in. If you wake up on an interrupt, you can make a good guess at the state before the edge you triggered on, but how do you know the state that it will eventually settle to? - You might have seen a single isolated fast spike. You cannot know for certain.</p>
<p>I could not get the interrupt - triggered principle to work reliably, whereas the polled version appears to be totally reliable (I did say &quot;appears&quot;). You might be able to do better, but I was deliberately using a push-button switch that, using Trystan&#39;s original sketch, gave a count of anything between 10 and 40 pulses per transition.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21577"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 26/05/2014 - 13:53.</div>
    <div class="content">
     <p>Oki</p>
<p>&nbsp;</p>
<p>but i want to monitor both my heat meter and water meter plus 3 phases on the electricity side</p>
<p>for that i would need 2 digital pins for the heat meter (IR tx and rx)</p>
<p>water meter is one digital input for pulse counting.</p>
<p>electricity is 3 ct&#39;s and 3 ac&#39;s</p>
<p>&nbsp;</p>
<p>would that be possible using DIG 8 and 10 for the IR coms, DIG 2 to count pulses,&nbsp;</p>
<p>&nbsp;</p>
<p>i then need 2 extra AC inputs and ADC5 / DIG19&nbsp;could be used as i dont plan to messure temp. and CT4&nbsp;with its components desoldered&nbsp;could be the other AC input</p>
<p>&nbsp;</p>
<p>but again do i look at it the wrong way or can i do the hardware side in this way?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21579"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 26/05/2014 - 15:43.</div>
    <div class="content">
     <p>If you&#39;re using a V3, I think you&#39;ll need to do a bit more unsoldering because of the pull-up resistor from A5 to D5 - see the circuit diagram on Solderpad. When that&#39;s done, you have A0 - A4 on plugs, A5 is on the terminal strip.</p>
<p>D2 and D5 are also on the terminal strip, D9 is adjacent and D10 is near the ISP header. D11 (MOSI), D12 (MISO) &amp; D13 (SCK) are on the ISP header.</p>
<p>You might be able to use DIO 6 for both the LED and your heat meter TX, depending on how important the LED is to you and whether the heat meter ignores stuff it does not understand.</p>
<p>The neatest arrangement I think is D2 for the water meter, add a terminal in D9 and use that plus D5 for the heat meter. That leaves D6 for the LED and D10 spare.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21588"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 26/05/2014 - 18:47.</div>
    <div class="content">
     <p>yep i think the heat meter ignores if it does not understand... LED... hmm... not as important thou nice to have for debug... i even have a sketch somewhere for the heat meter, just need to dig it out...&nbsp;</p>
<p>&nbsp;</p>
<p>so at least its possible to connect it all hardware vise.... is it hard to mod the libs&nbsp;to calc&nbsp;3phase&nbsp;with 3 ct and 3 ac&#39;s ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21591"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 26/05/2014 - 19:25.</div>
    <div class="content">
     <p><em>&quot;is it hard to mod the libs to calc 3phase with 3 ct and 3 ac&#39;s</em>&quot; It shouldn&#39;t be if you know about OOP and C++ classes.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21596"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 26/05/2014 - 21:23.</div>
    <div class="content">
     <p>hehehe, then it is :-/</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21597"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 26/05/2014 - 22:32.</div>
    <div class="content">
     <p>Depending on which sleep mode you guys use, Timers can also be used to wake you up. &nbsp; Perhaps you could have the switch IO pin ISR do nothing more than start a 100 msec&nbsp;eggtimer (or restart it if it&#39;s already running). &nbsp;When that eggtimer ISR&nbsp;finally fires, you know the dust has settled for 100 msecs and it can read the pin state now, and compare it to its previous value.</p>
<p>But you&#39;re still exposed to the cpu load risk associated with feeding an undebounced signal straight into an interrupt pin. &nbsp; If there&#39;s ringing on that signal, &nbsp;the CPU might end up doing nothing other than servicing that ISR. &nbsp; &nbsp;You might be able to solve that by having the IO pin ISR&nbsp;disable itself, and the eggtimer ISR re-enable it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21598"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 26/05/2014 - 22:33.</div>
    <div class="content">
     <p>All you actually need to do, having created three instances of EnergyMonitor (one for each phase) is to set up each with a different voltage input pin (so instead of three or four instances having the same voltage pin, which is what happens when the 4 currents are all on the same phase, each has its own). You don&#39;t have to touch the library at all.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21599"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 26/05/2014 - 22:53.</div>
    <div class="content">
     <p>oki, will give it a go once i got the board</p>
<p>&nbsp;</p>
<p>but its in emonlib i have to do the edits right? ie&nbsp;to edit the voltagepin for each instance</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21601"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 26/05/2014 - 23:21.</div>
    <div class="content">
     <p>It&#39;s<strong> in your sketch </strong>that you instantiate EnergyMonitor and feed it the pin numbers.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21604"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 27/05/2014 - 08:06.</div>
    <div class="content">
     <p>now i&#39;m lost</p>
<p>&nbsp;</p>
<p>when i look in the example sketches they dont&nbsp;use pin numbers, so they must get them from emonlib?</p>
<p>&nbsp;</p>
<p>will look again to make sure its me that was blind</p>
<p>&nbsp;</p>
<p>EDIT:</p>
<p>&nbsp;</p>
<p>So looking in&nbsp;https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM12B/Examples/emonTxV3_RealPower_Voltage/emonTxV3_RealPower_Voltage.ino</p>
<p>i cant see anywhere that it tells what pin AC input is on... so it must be in emonlib right? there i see them... but just need to be sure where to do edits</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21611"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 27/05/2014 - 12:54.</div>
    <div class="content">
     <p>It depends on how you initialise the class instance, in emonLib there are two ways. One way sets them by channel number - that&#39;s what you were looking at - voltageTX(...) and currentTX(...). But look at voltage(...) and current(...) and they accept pin numbers. The two pairs achieve the same thing, just by a different route.</p>
<p>It&#39;s much better to change your sketch than the library, because the Arduino IDE gets totally mixed up when searching for libraries - the rules it follows elude me.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21642"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 28/05/2014 - 18:19.</div>
    <div class="content">
     <p>hmm just saw a note on github:</p>
<p>&nbsp;</p>
<p>Note: CT must be clipped round either the Live or Neutral wire, not both!</p>
<p>&nbsp;</p>
<p>putting a CT arround the neutral would that not give me a total of the 3 phases?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21643"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 28/05/2014 - 18:54.</div>
    <div class="content">
     <p>What current flows in the neutral? (Look up Building Blocks if you&#39;re unsure.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21646"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 28/05/2014 - 19:32.</div>
    <div class="content">
     <p>the blue or neutral or N.. i would be tempted to say the sum &nbsp;of the 3 phases...&nbsp;</p>
<p>&nbsp;</p>
<p>looking in building blocks but have not found the end of the rainbow yet</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21647"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 28/05/2014 - 19:42.</div>
    <div class="content">
     <p>i see stuff are not the same in the UK....</p>
<p>&nbsp;</p>
<p>in DK we have all 3 phases in the house... so we have 3 main fuses, big ones... one for each phase, after that a earth leakage relay where each phase and the neutral is connected, it trips if there is a mismatch between in and out of more than 30mA... after than in my case 1 of the phases are used to supply 1 part of the flat and the next phase supply the other half. stove and clothes washer are connected to 3 phase over a seperate&nbsp;breaker for each wall outlet..</p>
<p>but its only the stove that is 3 phase, the washer is single phase...</p>
<p>&nbsp;</p>
<p>i suspect my idea of one CT on the neutral is only good if every thing is single phase ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21648"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 28/05/2014 - 19:49.</div>
    <div class="content">
     <p>looked at most of it but did not find a clue on if i could get away with one CT on the blue / neutral..&nbsp;</p>
<p>but i guess not ???</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21650"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 28/05/2014 - 21:08.</div>
    <div class="content">
     <p>dooh... even if i could messure on the neutral then it would require that the 3 phases are not angled, but they are 120 degrees... so out with that idea...&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21653"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 28/05/2014 - 21:29.</div>
    <div class="content">
     <p>You need to be thinking phasors. The neutral current is indeed the sum of the three currents in the three phases - the <strong><em>vector sum.</em></strong> So if the three phases are accurately balanced, the vector sum is zero - there is no neutral current and you can throw away the neutral conductor, because it&#39;s doing nothing. In reality of course, the phases are not balanced so the neutral carries only the (vector) difference current.</p>
<p>Have you noticed there&#39;s no neutral conductor on the grid transmission lines, where the load is always relatively well balanced? Some three-phase cables have what is called a &quot;reduced neutral&quot; - the area of the neutral conductor is reduced compared to the phase conductors because it should be carrying very little current. (It makes the cable cheaper!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21655"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 28/05/2014 - 22:15.</div>
    <div class="content">
     <p>yeah a lot of knowledge have turned to vapour&nbsp;over the years... i did attend tech college to be a electrician but never found an apprenticeship so could not continue.... and the knowledge have just disapeared like air from a party baloon.</p>
<p>&nbsp;</p>
<p>it was just a tempting thought to clip one CT on the neutral and then one AC adapter... but now i see a bit of light at the tunnel...&nbsp;</p>
<p>&nbsp;</p>
<p>i just wonder how much&nbsp;accuracy difference there is between 1 AC adapter for 3 phases and 3 ac adapters - 1 for each phase</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21656"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 28/05/2014 - 22:40.</div>
    <div class="content">
     <p><em>&quot;i just wonder how much accuracy difference there is between 1 AC adapter for 3 phases and 3 ac adapters - 1 for each phase&quot;</em></p>
<p>That depends completely on how stiff and how well balanced the supply is where you are, and the only way to know will be to measure it over a period of time. If the total load is always well balanced, then all three voltages will rise and fall together. If the supply is very stiff, all three voltages will scarcely move at all. Anything else and you have unbalanced voltages, to what degree is anyone&#39;s guess. You can get some idea by measuring the voltage dip when you connect a large load on one phase.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21660"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 29/05/2014 - 08:15.</div>
    <div class="content">
     <p>well we have a distribution transformer station across the street no more than 20 meters from my window, but i take that is no gurantee at all, just a pointer...</p>
<p>&nbsp;</p>
<p>but lets assume that everything is nice and 100 equal balanced... how much will the difference be between 1 ac adapter and 3 ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21662"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 29/05/2014 - 09:11.</div>
    <div class="content">
     <p>As I wrote above, it is anyone&#39;s guess. You need to measure and record the three voltages and see what the difference is at various times of the day and week (and maybe the year too!).</p>
<p>The phases should be within a few percent of each other, but that is not guaranteed.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24015"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 20/09/2014 - 15:19.</div>
    <div class="content">
     <p>So i got my heat meter on emoncms and electricity...&nbsp;</p>
<p>only thing left is the damm water meter that i know have a reed switch that has bounce noise like hell</p>
<p>&nbsp;</p>
<p>what is the &quot;standard&quot; arround this nowadays? hardware debounce or software?</p>
<p>&nbsp;</p>
<p>for hardware i had this small circuit in mind</p>
<p>&nbsp;</p>
<p>
	<img alt="" src="../../../3.bp.blogspot.com/-wAYF14jJWx0/T2Fq_yhoBnI/AAAAAAAABDk/UmTVve9tS70/s1600/cap%20button.PNG" style="width: 298px; height: 225px;" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24031"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 20/09/2014 - 21:57.</div>
    <div class="content">
     <p>Eric seemed pleased with my interrupt-driven polled software debounce - <a href="5022.html#comment-21046" title="http://openenergymonitor.org/emon/node/5022#comment-21046">http://openenergymonitor.org/emon/node/5022#comment-21046</a></p>
<p>But a hardware debounce as well should not do any harm.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24035"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 20/09/2014 - 22:37.</div>
    <div class="content">
     <p>oki, i just have the 100nf&#39;s and resistors, and would avoid to change the normal pulse sketch</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24123"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 23/09/2014 - 23:04.</div>
    <div class="content">
     <p>Got the 2nd node up and attached to the water meter</p>
<p>&nbsp;</p>
<p>copied over the pulse example and changed ppwh to ppl&nbsp;and set it to 1, my meter gives one pulse for each liter</p>
<p>&nbsp;</p>
<p>and then i transmit the number of pulses between each reading and i try to also transmit the flow rate in liters each hour</p>
<p>&nbsp;</p>
<p>will this line do that or is my math wrong?:</p>
<p>&nbsp;</p>
<p>emontx.power = int((3600000000.0 / (pulseTime - lastTime))/ppl); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp;</p>
<p>sketch attached also</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24125"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 23/09/2014 - 23:22.</div>
    <div class="content">
     <p>Your maths looks wrong. Say you have a flow rate of 1 l/s, that&#39;s 3600 l/h.</p>
<p>pulseTime - lastTIme = 1 s = 1000 (ms), and you said ppl = 1. You want the left hand side to be 3600, and that is not 3600000000.0 / 1000. It looks as if you have too many 0&#39;s there.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24131"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 24/09/2014 - 08:27.</div>
    <div class="content">
     <p>:-/ me just blindly copied over the pulse example for electricity pulse counting...&nbsp;</p>
<p>&nbsp;</p>
<p>So have removed 3 0&#39;s and will test later on the day....&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24132"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 24/09/2014 - 08:28.</div>
    <div class="content">
     <p>btw... using timeseries engine only is there a easy way i can clear data without touching emoncms as such? can i just delete the data files?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24138"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 24/09/2014 - 15:37.</div>
    <div class="content">
     <p>So i have looked at my water usage and i&#39;m really in doubt if its counting right...</p>
<p>&nbsp;</p>
<p><a href="http://energymonitor-dk.dns4e.net/emoncms/boelle/water" title="http://energymonitor-dk.dns4e.net/emoncms/boelle/water">http://energymonitor-dk.dns4e.net/emoncms/boelle/water</a></p>
<p>&nbsp;</p>
<p>if you zoom in on today at arround&nbsp;17:11:15 to 17:14:30 at the first graph, it says 1 at the hole time so that is 1 pulse for all readings... that sounds ok to me since that means no bounce or false triggers...&nbsp;</p>
<p>&nbsp;</p>
<p>but then if you look at same time on the liter/h and liter/15 mins it said just shy of 30 liters when i got out from the shower...&nbsp;</p>
<p>30 liters for a shower does that sound right?</p>
<p>&nbsp;</p>
<p>the 3 last graphs are bargraphs&nbsp;with 86400sec interval, 3600 interval and 900 sec interval... both with delta of 1... they are based on a&nbsp;accumulate feed of the first feed that simply just stores the pulses between readings...&nbsp;</p>
<p>one tap at full blast takes 7 sec to fill a 1 liter jar</p>
<p>&nbsp;</p>
<p>are there much else i can do to test if it reads right? ex. take a 10 liter bucket and fill it as fast i can after the 15 min graph has said 0 for a few times... ie after 1 hour of no use?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24139"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 24/09/2014 - 15:58.</div>
    <div class="content">
     <p>You could try holding a bucket of known capacity under the shower and timing how long it takes to fill it, then you know the flow rate for the shower and by timing how long it takes you to have a shower, you can calculate the volume of water you use.</p>
<p>And you can of course read your meter at intervals (every 15 min, hourly, daily, weekly?) and check that you have the same number of pulses as the meter shows (you should see 1000 pulses per m<sup>3</sup>).</p>
<p>I only checked once, I used 40 l for a shower, so your 30 l is likely to be close.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24140"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 24/09/2014 - 18:04.</div>
    <div class="content">
     <p>yep</p>
<p>&nbsp;</p>
<p>i did the math and each liters takes 7 sec... so my 3 min of shower time comes to about 25 liters...&nbsp;</p>
<p>i was just shocked that so much water can pass in that little time...&nbsp;</p>
<p>&nbsp;</p>
<p>now when i&#39;m 100% sure it work as it should is there an easy way to clear the data?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24152"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 25/09/2014 - 15:59.</div>
    <div class="content">
     <p>so no easy way to just clear the readings without touching the feeds or anythingelse?</p>
<p>&nbsp;</p>
<p>also how do i create a feed that takes the difference between the readings? i want to use that to record usage on my heat meter between the readings</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24155"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 25/09/2014 - 17:09.</div>
    <div class="content">
     <p>I don&#39;t know about clearing feeds - but I&#39;ve seen posts about that recently. Try a search.</p>
<p>As for the difference, you have &quot;-input&quot; in the input processing, will that not do what you want? I.E:</p>
<p>In input 1</p>
<p>Log to feed [Input 1]<br />
	-input [2]<br />
	log to feed [difference]</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24156"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 25/09/2014 - 19:19.</div>
    <div class="content">
     <p>it will do it... but as it is an ever increasing value would that not generate a negative new feed? but its close.. i can see that much</p>
<p>&nbsp;</p>
<p>the reason why i have asked abut the clearing feed is that a search did not help me much... sure me that is stupid :-D</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24157"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 25/09/2014 - 19:27.</div>
    <div class="content">
     <p>found this link... but no soloution to what i want...&nbsp;</p>
<p><a href="2931.html" title="http://openenergymonitor.org/emon/node/2931">http://openenergymonitor.org/emon/node/2931</a></p>
<p>&nbsp;</p>
<p>at page 12 of search and nothing that looks remotely what i&#39;m after</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24158"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 25/09/2014 - 19:36.</div>
    <div class="content">
     <p>tried to remove the -input thing... not it has stopped logging everything and i cant remove edit that input....</p>
<p>&nbsp;</p>
<p>the other i can edit but they are not updating anymore</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24159"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 25/09/2014 - 19:37.</div>
    <div class="content">
     <p>did a reboot and now they are all listed as inactive...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24160"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 25/09/2014 - 19:43.</div>
    <div class="content">
     <p>had to delete the inputs to get it going... so yes one way is to delete and rebuild everything to clear data...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24498"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 12/10/2014 - 23:34.</div>
    <div class="content">
     <p>i updated my water meter sketch...</p>
<p>&nbsp;</p>
<p>the meter is still 1 pulse each liter and have run fine for weeks now without a false count,</p>
<p>BUT</p>
<p>i never came arround to have it calce the flow rate and send it over.</p>
<p>i figured since i get one pulse for each liter it was just a matter of calculate the time difference between pulses and then divide than in to the number of ms that happens on an hour... i did a check on calculator and if i have a difference in 7000ms between each pulse that would get me about 500 liters an hour...&nbsp;</p>
<p>so i adjusted my sketch but changed from int to float since my numbers would now be 500.00 of course this would go up and down as how much open the tap is</p>
<p>i have attached the sketch</p>
<p>NOW</p>
<p>i adjusted emonhub.conf to:</p>
<p>(last part)</p>
<p>&nbsp;</p>
<p>[[5]]</p>
<p>datacodes = h, h, f, f, f, f, f, f, f, f,</p>
<p>[[6]]</p>
<p>datacodes = f, f,</p>
<p>&nbsp;</p>
<p>for some reason it will mark node 6 as inactive, but if i change it to</p>
<p>&nbsp;</p>
<p>[[5]]</p>
<p>datacodes = h, h, f, f, f, f, f, f, f, f,</p>
<p>#[[6]]</p>
<p>#datacodes = f, f,</p>
<p>node 6 is active again, thou it reports 3 inputs and not 2 like it should</p>
<p>&nbsp;</p>
<p>i have eyeballed the sketch and cant see any obvious errors... and i cant &nbsp;see any wrong in the conf either...&nbsp;</p>
<p>&nbsp;</p>
<p>but i have made a booboo somewhere...can i get a clear pointer ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24499"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 12/10/2014 - 23:36.</div>
    <div class="content">
     <p>maybe these 2 lines in the sketch could go away?</p>
<p>&nbsp;</p>
<p>double power, elapsedWh;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // power and energy<br />
	int ppl = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Pulses per Liter - found or set on the meter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24500"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 12/10/2014 - 23:46.</div>
    <div class="content">
     <p>of course emonhub.conf should be :</p>
<p>&nbsp;</p>
<p>[[5]]</p>
<p>datacodes = h, h, f, f, f, f, f, f, f, f,</p>
<p>[[6]]</p>
<p>datacodes = f, h,</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>last one changed from f to h as it is an int...&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24501"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 12/10/2014 - 23:52.</div>
    <div class="content">
     <p>that was much better... thou in emoncms i did get a number around 5 point something and not the 500 figured i calc&#39;ed before i flashed the sketch</p>
<p>&nbsp;</p>
<p>have i simply done my math in the sketch wrong?</p>
<p>&nbsp;</p>
<p>emontx.power = float((3600000.0 / (pulseTime - lastTime)));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Calculate flow</p>
<p>&nbsp;</p>
<p>it should be liters each hour...&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24509"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 10:36.</div>
    <div class="content">
     <p>did a test this morning, 1.22 was the highest i could get</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24511"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 13/10/2014 - 10:49.</div>
    <div class="content">
     <p>What are the units of time? How many <u>micro</u>seconds are there in an hour? ! ! !</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24512"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 10:58.</div>
    <div class="content">
     <p>there are 1000ms on a sec... thats 60000 ms each min... again there are 60 of those on a hour ....&nbsp;3600000ms ?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24513"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 13/10/2014 - 11:15.</div>
    <div class="content">
     <p><em>there are 1000ms on a sec... thats 60000 ms each min... again there are 60 of those on a hour .... 3600000ms ?</em></p>
<p>All of this is true but not quite what Robert asked, note his <u>clue</u> !&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24514"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 12:01.</div>
    <div class="content">
     <p>had a sudden visit...</p>
<p>&nbsp;</p>
<p>hmm... it&#39;s something with micro... just a wild guess here, but what i get is just how many times the time difference between each pulse fits inside an hour?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24516"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 12:04.</div>
    <div class="content">
     <p>or am i mixing micro and mili here?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24517"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 12:10.</div>
    <div class="content">
     <p>bugger....</p>
<p>the time difference is micro-second right? clue to me is micros</p>
<p>but i&#39;m using mili-second also....</p>
<p>1 hour should be&nbsp;3600000000 micro seconds right?</p>
<p>&nbsp;</p>
<p>so if i&#39;m right the formula should be&nbsp;</p>
<p>&nbsp;</p>
<p>emontx.power = float((3600000000 / (pulseTime - lastTime)));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Calculate flow</p>
<p>&nbsp;</p>
<p>or am i still wrong?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24518"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 13/10/2014 - 12:43.</div>
    <div class="content">
     <p>Bo, stop panicking, sit back and just read the code. Read the code that the processor is running, not the code that you&#39;re imagining that&#39;s in your head. You&#39;re using two time units, ms &amp; &micro;s, but for quite separate purposes. Just trace through and check which is used for what purpose.</p>
<p>[I&#39;m not trying to be nasty, I&#39;m giving you the benefit of personal experience!]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24519"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 12:45.</div>
    <div class="content">
     <p>i know... not thinking bad thoughts here.... just trying to figure what i&#39;m&nbsp;doing wrong :-)</p>
<p>&nbsp;</p>
<p>but yes i just discovered the 2 time units issue above.... on one side of the division i used mili&#39;s and on the other micro&#39;s</p>
<p>&nbsp;</p>
<p>i corrected that, but will double check my math in a bit</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24520"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 12:55.</div>
    <div class="content">
     <p>so this is how i understand the code that is triggered when a pulse comes in</p>
<p>&nbsp;</p>
<p>it sets last time to pulsetime</p>
<p>and then pulse time is set to mirosec since start</p>
<p>and it will add 1 to pulsecount</p>
<p>it then uses pulsetime and last time to figure how many times the difference will fit inside one hour</p>
<p>the last bit can also be said like how many times will the difference fit inside an hour if the flow rate is constant..</p>
<p>&nbsp;</p>
<p>so is my brains understanding of it in sync with what really happens?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24522"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 13/10/2014 - 14:45.</div>
    <div class="content">
     <p>That&#39;s about right. The &#39;flow rate&#39; you get is the flow rate between the last pulse and this one.&nbsp;</p>
<p>The <u>milli</u>second timer has nothing to do with the pulses and flow rate, all it does is trigger the transmission. So what is actually transmitted is the flow rate between the last pulse before transmission and the one before that one, and the number of pulses since the last transmission. You do not send (unless there has been only one pulse), the average flow rate between transmissions. If there have been no pulses, <strike>you still send the last average flow rate,</strike> [wrong!] you send a zero and if there is more than 71.6 minutes between pulses, the micros( ) counter has overflowed more than once and the answer is wrong anyway.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24524"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 15:25.</div>
    <div class="content">
     <p>oki, then i&#39;m&nbsp;closer now...</p>
<p>&nbsp;</p>
<p>both pulse count and flowrate is reset between transmission so it will go to 0 pretty fast after i close the tab...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24525"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 15:48.</div>
    <div class="content">
     <p>the first number when tab was at full blast was 5700</p>
<p>at 2nd reading it was 1219...</p>
<p>&nbsp;</p>
<p>but it makes sense since you said i transmit the flow rate between the last pulse before transmission and the one before that one,</p>
<p>&nbsp;</p>
<p>will have to poke my mind on how to get the current flow rate as long the tab is open</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24527"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 16:54.</div>
    <div class="content">
     <p>would the pulse as trigger to transmit be the solution or should i simply reduce the time between transmit?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24530"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 13/10/2014 - 21:42.</div>
    <div class="content">
     <p>I don&#39;t know the answer to this - I have not thought about it. But there are clearly some improvements that need to be made to the sketch that you are using so that you avoid sending misleading data.<strike> For example, if I am correct, and you use water at 5700 l/h, then shut off the tap and do not use any more water for 8 hours, then although the number of pulses will be zero for 8 hours, the flow rate will show 45600 l used.</strike> [Wrong!]</p>
<p>I think you should change small things like that. Remember you are also able to process the data in emonCMS, so there you can calculate the average flow rate over periods of time, for example. You know what information you want, I think you must make your sketch and emonCMS together give you that information.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24531"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 22:31.</div>
    <div class="content">
     <p>hmm... the flow rate goes to 0 once i have closed the tab... &nbsp;so you are not quite correct... but the 5700 number is the first number i get when i open the tab... at next transmit it drops to 1219 and will stay at that as long the tab is at full blast. once i close the tab the flow number drops to 0 after a max of 2 transmits and it &nbsp;will stay there until i open again</p>
<p>&nbsp;</p>
<p>what i know is that the 1219 number is not correct.. it should be half that... but i will double check that its still 1 liter in 7 sec</p>
<p>&nbsp;</p>
<p>for used liters i use pulses counted only... one pulse is one liter... on emoncms i log both the pulses between transmit and i acc. them so i know how much used since start</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24532"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 13/10/2014 - 22:34.</div>
    <div class="content">
     <p>bummer... i rechecked the flow rate.</p>
<p>&nbsp;</p>
<p>its not 1 liter in 7 sec but 1.3 liters</p>
<p>&nbsp;</p>
<p>EDIT: means the approx liters an hour should be&nbsp;668,57</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24533"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 13/10/2014 - 22:39.</div>
    <div class="content">
     <p>OK, I missed seeing that&nbsp;emontx.power is set to zero when the message is transmitted, so you are right - it will not report the wrong value when no pulses are being received.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24534"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 13/10/2014 - 22:47.</div>
    <div class="content">
     <p>Your 5700 number - how long is it since the last pulse when you get that number? Why I ask is the micros( ) counter will overflow after approx 71.6 minutes, so if it has has overflowed more than once (i.e. it has been longer than 71.6 minutes), that would explain a wrong number (but not if it is consistently 5700).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24540"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 14/10/2014 - 08:37.</div>
    <div class="content">
     <p>oh...</p>
<p>&nbsp;</p>
<p>that can be anything... but its only the first time after i open the tab.... so i guess if i only close the tab for like 5 min then the first number reported when i open again will be more close to the correct value...</p>
<p>&nbsp;</p>
<p>so a early in the morning and brain not in gear wild guess: could it work if i also reset micros() after each transmit ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24551"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 14/10/2014 - 15:34.</div>
    <div class="content">
     <p><em>&quot;could it work if i also reset micros() after each transmit ?&quot;</em> Then you would lose the time of the last pulse.<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24552"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 14/10/2014 - 15:39.</div>
    <div class="content">
     <p>of course...&nbsp;</p>
<p>&nbsp;</p>
<p>hmm, dont know how i can solve this one, might throw the towel in the ring and just monitor my usage</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24553"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 14/10/2014 - 15:49.</div>
    <div class="content">
     <p>Why do you need micros( ) here? If your meter is ~ 1 pulse / l, what is the minimum time between pulses with every tap open? i.e, what is your maximum flow rate? Would millis( ) give you adequate accuracy? &nbsp;If your maximum flow is 10 l/s,&nbsp; a 1 ms error would give you a reading good to 1% (1 ms error in 100 ms) and it gets better at lower flow rates.</p>
<p>Millis( ) of course overflows 1000 times less frequently.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24554"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 14/10/2014 - 16:06.</div>
    <div class="content">
     <p>Why? i dont know... i&#39;m simply just reusing a sketch without know much about programming in general&nbsp;</p>
<p>&nbsp;</p>
<p>the meter is excatly 1 pulse / Liter... unless some idiot have stamped the wrong numbers on it.</p>
<p>&nbsp;</p>
<p>the only way i could figure the minimum time was to repeat the &quot;fill bowl in 7 sec&quot; like last night. with shower hot and cold and tap in bath hot and cold and the same in kitchen i can still fill it with 1.3 liters in 7 sec.... so must have good pressure for a 1st floor flat.</p>
<p>&nbsp;</p>
<p>1% sounds fine for flow rate indication...&nbsp;</p>
<p>&nbsp;</p>
<p>10 liter a sec sounds high... i would say about 2 if everything is taking water (kitchen tap, dish washer, clothes washer, bath tap, shower, wc) given that the kitchen tap is taking 0.18 liter a sec no matter if one tap or 3 is open.</p>
<p>but as you say it can only get better...</p>
<p>&nbsp;</p>
<p>if millis overflow will i not get the same issue as with micros? but not so fast as with micros...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24558"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 14/10/2014 - 21:50.</div>
    <div class="content">
     <p>I think you want to use millis( ) for both the transmit interval and pulse timing. Millis( ) will of course overflow and wrap around - but it&#39;s only going to worry you (i.e. you get&nbsp;<u>two</u> overflows without a pulse) if you go on holiday and don&#39;t use any water for at least 4&frac14; million seconds - just over 7 weeks. So unless you have a round-the-world cruise planned...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24560"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 14/10/2014 - 22:12.</div>
    <div class="content">
     <p>not in my plans anytime soon no... unless somebody is really jumping up and down and wants to pay me for it :-D</p>
<p>&nbsp;</p>
<p>so my latest attached sketch should do it if i just use millis for both transmit and pulse timing?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24561"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 14/10/2014 - 22:13.</div>
    <div class="content">
     <p>that one is a hell long back... and i ight have changed it so here is a fresh copy before any changes</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24562"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 15/10/2014 - 00:13.</div>
    <div class="content">
     <p>I think you might need an unsigned long for&nbsp;<em>lastpoll</em>, see here: <a href="http://playground.arduino.cc/Code/TimingRollover" title="http://playground.arduino.cc/Code/TimingRollover">http://playground.arduino.cc/Code/TimingRollover</a></p>
<p>Other than that, just replace micros( ) and don&#39;t forget to lose 3 zeros when calculating the &quot;power&quot;. (You ought to rename that &quot;flowRate&quot;.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24563"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 15/10/2014 - 00:21.</div>
    <div class="content">
     <p>will do.... fingers crossed tomorrow :-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24566"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Wed, 15/10/2014 - 11:02.</div>
    <div class="content">
     <p>girlfriend/partner did a showner and i got numbers arround&nbsp;720 liters/ hour.... much better...</p>
<p>a normal shower eats about 35 liters and takes 3 mins... so pretty close now i must say</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24694"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 21/10/2014 - 12:28.</div>
    <div class="content">
     <p>have been running little under a week and must say this runs ok now.... thanks a bunch</p>
<p>have some problems with one electricity feed that shows up negative... but will create another thread for that</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24815"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Sun, 26/10/2014 - 18:27.</div>
    <div class="content">
     <p>Boelle (B&oslash;lle?), you seem like you&#39;ve come far in your project -- I&#39;m wanting to do the same stuff, but still just getting the building blocks together (should be good now, though).</p>
<p>Given we&#39;re both Danish, maybe I could lend some information from you - where did you connect on your electricity board, there&#39;s nowhere I have free access to the phases to clip on the CT (three of them I guess from reading the above). Maybe I need to call an electrician to make the wires accessible in a safe manner...</p>
<p>And did you purchase a separate water-meter to measure water usage? I was hoping to do the same, but didn&#39;t find anything in the cheap range... My current water meter - from the water company -&nbsp;is purely analog.</p>
<p>Thanks</p>
<p>Lasse</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24842"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: water meter... yeah again i know</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 28/10/2014 - 01:19.</div>
    <div class="content">
     <p>Hi there...</p>
<p>&nbsp;</p>
<p>for the water meter i was lucky in talking the water company in to change mine out with one that has pulse output in the form of a read switch, you need to do some hardware debounce but not the biggest problem :-D</p>
<p>I done not use CT&#39;s but the flasher/blinker on the meter itself... for that i simply took off the fuse panel cover and routed a 3 core wire through the wall next to the mains wires that comes from the meter... i then placed a photo transistor in front of the flasher with some good double stick tape. it far more precise than CT&#39;s given that non of the Emontx&#39;s so far have true 3 phase support... they only have 1 AC input and it will always be a math fix to figure the 2 other AC&#39;s... so yes in the end i just opted to let me meter do all the math.&nbsp;</p>
<p>Where about in DK do you live? you are welcome to send me a PM also... but be warned that the forum does not send out an mail so it might be some time before i send an reply...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3467"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-YQNRSAKIFg5peROOhqIOBwypPpL6v8YBhhnVNF71yoo" value="form-YQNRSAKIFg5peROOhqIOBwypPpL6v8YBhhnVNF71yoo"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
