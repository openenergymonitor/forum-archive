<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6403 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:27:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Help ... I can not set RTC - module with DS1302 | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Help ... I can not set RTC - module with DS1302</h3>
        <span class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Thu, 01/01/2015 - 21:19</span>
        <div class="content"><p>Hello everyone<br />
I bought this RTC module</p>
<p><a href="http://www.hobbytronics.co.uk/raspberry-pi-real-time-clock" title="http://www.hobbytronics.co.uk/raspberry-pi-real-time-clock">http://www.hobbytronics.co.uk/raspberry-pi-real-time-clock</a></p>
<p>I can not boot the steps to compile and make working the clock, I&#39;m trying to follow the guidance of the link, but I can not.</p>
<p>Kindly who can help me.</p>
<p>Happy New Year to all</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10234.html" class="topic-previous" title="Go to previous forum topic">‹ HDD Setup, Creating a local EmonCMS installation on a Raspberry Pi with HDD</a>
              <a href="10233.html" class="topic-next" title="Go to next forum topic">Multiple ds18b20 on Emontx3.4 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26328"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 01/01/2015 - 22:26.</div>
    <div class="content">
     <p><i>"I'm trying to follow the guidance of the link, but I can not."</i><br />
Why not? What does not work? Do you see errors - what are they?</p>
<p>[Edit]<br />
I downloaded the code. There are two files in the zip download: "rtc-pi" and "rtc-pi.c".<br />
"rtc-pi" is already compiled, therefore you copy the file to your SD card then do as the instructions tell you from here:</p>
<p style="margin-left:4ex">
<br>And make it executable using<br />
<br>chmod +x rtc-pi<br><br />
Setting the Date and Time<br> To set the data and time on the module use<br><br />
<br>sudo ./rtc-pi CCYYMMDDhhmmss<br><br />
<br> And to read the date and time from the module and set the Raspberry Pi clock<br />
<br><br />
<br>sudo ./rtc-pi<br />
<br><br />
<br> You should set this command to run when the Raspberry Pi boots up. There are many ways to do this, so  we will leave it up to you to decide which method is best for you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26330"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Thu, 01/01/2015 - 23:33.</div>
    <div class="content">
     <p>hello&nbsp; Robert thanks for the reply</p>
<p>in fact the one you quoted is what you want to do, but while not giving the time errors if reboot the raspberry, it is not correct, then I wondered what mistake.</p>
<p>I copied the file rtc-pi.c in sd card in the &quot;boot&quot; partition and wondered if it was correct.</p>
<p>Since I have to change a few lines of the file rtc-pi.c seen that use the raspberry B + I also have to recompile the file, giving the command &quot;&quot; cc media / boot / rtc-pi.c &quot;&quot; but does not do anything.</p>
<p>So I follow the instructions but definitely something wrong, thanks again for the help</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26334"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 02/01/2015 - 01:09.</div>
    <div class="content">
     <p> <i>"" cc media / boot / rtc-pi.c ""</i><br />
You should not have spaces in there!</p>
<p>Try changing to the directory where rtc-pi.c is located. First, find where it is:</p>
<p>&nbsp;&nbsp;whereis rtc-pi.c</p>
<p>then cd to there.</p>
<p>Then try:</p>
<p>&nbsp;&nbsp;cc rtc-pi.c</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26338"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Fri, 02/01/2015 - 08:14.</div>
    <div class="content">
     <p>hello  Robert thanks for the reply</p>
<p>On that partition I increased the space.<br />
 My main doubt is that each command does not give me any error but nothing works.<br />
I wanted to be sure of the procedure and where to run</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26341"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 02/01/2015 - 10:46.</div>
    <div class="content">
     <p>Do you have ANY response to ANY command?</p>
<p>what does this do? </p>
<p>&nbsp;&nbsp;ls</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26342"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Fri, 02/01/2015 - 11:07.</div>
    <div class="content">
     <p>This is the screen.</p>
<p>The file rtc-pii, I created but I can not find it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26344"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 02/01/2015 - 11:48.</div>
    <div class="content">
     <p>I see now where you are! In the 'boot' volume was the wrong place. Putty is looking (for me) at "/home/pi" inside "2.9 GB Volume" where you have bin, boot, dev, etc, <b>home</b>, lib...  and you need to move the file rtc-pi.c into the directory /home/pi</p>
<p>Then you can see it using Putty.</p>
<p>Now the instructions will work. If you see the error: "Cannot open output file a.out: Read-only file system.... "</p>
<p>do rpi-rw  (NOT rpi -rw)</p>
<p>when you have finished, do rpi-ro to make the file system read-only again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26356"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Fri, 02/01/2015 - 17:15.</div>
    <div class="content">
     <p>
I do not understand I seem to do everything correctly, but if I turn off and turn on the raspberry the date is not updated.</p>
<p>&nbsp;</p>
<p>ps: the screen in local emoncms, you can not see the time that used to record the data?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26360"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 02/01/2015 - 17:37.</div>
    <div class="content">
     <p>Are you doing<br />
&nbsp;&nbsp;rtc-pi<br />
automatically when the RPi starts up?<br />
Do a Google search (in Italian) for "execute command at startup Raspberry Pi"</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26362"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Fri, 02/01/2015 - 17:41.</div>
    <div class="content">
     <p>Thanks again for the answer</p>
<p>No, I think that once installed rtc would send automatic time, while I understand it I have to start all times the file &quot;rtc-pi&quot; with an automatic.<br />
Then the command &quot;chmod + x rtc-pi&quot; what is it?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26364"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 02/01/2015 - 18:23.</div>
    <div class="content">
     <p>Mmmmmmh, not the best product or instructions I&#39;ve seen,</p>
<blockquote><p><em>The DS1302 chip uses a slightly quirky serial interface which we won&#39;t go into here.</em></p>
</blockquote>
<p>Isn&#39;t very reassuring to start with. Moving on to&nbsp;</p>
<blockquote><p><em>Note:&nbsp;If you find you cannot set the date and time, there is a write protect register value which needs to be cleared (register 0x8E). We have had a few of these modules where this write protect has been turned on. You can clear it by setting register 0x8E to 0 in code, or by simply removing the battery and re-inserting it (The default value for the register is off)</em></p>
</blockquote>
<p>Have you tried removing the battery to reset it ?</p>
<blockquote><p><em>There is a wiring diagram on the EPE magazine page, but unfortunately it is wrong as they have CLK connected to GPIO#17 and RST (CE) connected to GPIO#21. These two connections should be swapped.</em></p>
</blockquote>
<p>Are you using the corrected connections?</p>
<blockquote><p><em>And to read the date and time from the module and set the Raspberry Pi clock</em></p>
<p><em>sudo ./rtc-pi</em></p>
</blockquote>
<p>This isn&#39;t clear if it will actually &quot;show&quot; the time and date or just set the Pi&#39;s time and date to match the rtc&#39;s behind the scene&#39;s, if you are not getting any confirmation try running the command &quot; date&nbsp;&quot; then changing the rtc&#39;s time &amp; date to something obviously different, run &quot;&nbsp;sudo ./rtc-pi&nbsp;&quot; and then &quot; date &quot; again to see if you are getting a change.</p>
<blockquote><p><em>You should set this command to run when the Raspberry Pi boots up. There are many ways to do this, so&nbsp; we will leave it up to you to decide which method is best for you.</em></p>
</blockquote>
<p>You will need to create a method of automating this command to run at start up or remember to manually run it every so often, it won&#39;t run at start up&nbsp;unless you set it up to do so.</p>
<p>In an earlier post you said</p>
<blockquote><p><em>&quot;&nbsp;Since I have to change a few lines of the file rtc-pi.c seen that use the raspberry B + &quot;</em></p>
</blockquote>
<p>If that is due to the &quot;Changes for Raspberry Pi V2 boards&quot; section at the end of the page, as it also says</p>
<blockquote><p><em>I also found that a pullup resistor is needed between DAT and VCC (= 3.3V). A 10k..30k resistor seems to work fine.</em></p>
</blockquote>
<p>did you also fit the pull-up resistor?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26374"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Fri, 02/01/2015 - 20:43.</div>
    <div class="content">
     <p>I fear that it is complicated to my knowledge, anyway .... I will continue to do the tests.</p>
<p>I will try to disconnect the battery to reset the module, and in a second time I will get the resistance.</p>
<p>I&#39;ll try to find a way to start automatically when you start the file rtc-pi, eventually will change the connections as you suggested, I will check using the model raspberry B + so I edited the file as the guide advised.<br />
I will keep you updated on the tests done, if you have other suggestions, in particular on how to start the file automatically, kindly inform me.</p>
<p>Thank you all for your cooperation.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26378"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 02/01/2015 - 23:48.</div>
    <div class="content">
     <p><span class="rangySelectionBoundary" id="selectionBoundary_1420242238365_6268403006251901" style="line-height: 0; display: none;">﻿</span>Adding the command to /etc/rc.local will run it at start up, use this line to insert it into the file before &quot;exit 0&quot;</p>
<blockquote><p>sudo sh -c &quot;sed -i &#39;/^exit 0/i\sudo ./rtc-pi\n&#39; /etc/rc.local&quot;</p>
</blockquote>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26379"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sat, 03/01/2015 - 03:46.</div>
    <div class="content">
     <p>Not to complicate matters, but since adding an RTC to my Pi is one of the things I&#39;ve been considering, I did some searching and found a few articles that mention removing fake-hwclock, and starting the add-on RTC by modifying /etc/init.d/hwclock.sh instead of adding a line to /etc/rc.local.</p>
<p>In addition to removing the fake-hwclock itself, the fake-hwclock cron jobs need to be removed too. (covered in the article linked to in step 3, below)</p>
<p><a href="http://www.raspberrypi.org/forums/viewtopic.php?f=66&amp;t=85683">www.raspberrypi.org/forums/viewtopic.php?f=66&amp;t=85683</a></p>
<p>Excerpt form the article at the link above:</p>
<p><em>SO .... here&#39;s what to do. I&#39;ve only tried this using a ds1307 based RTC module, but it should work (with appropriate changes) for RTCs based on other I2C clock chips.</em></p>
<p><em>Step 1: Follow the instructions on the Adafruit site <a href="https://learn.adafruit.com/adding-a-real-time-clock-to-raspberry-pi?view=all" title="https://learn.adafruit.com/adding-a-real-time-clock-to-raspberry-pi?view=all">https://learn.adafruit.com/adding-a-real-time-clock-to-raspberry-pi?view...</a> to get your I2C RTC connected and tested, but DO NOT make the suggested changes to /etc/rc.local</p>
<p>Step 2:Make the changes to /etc/init.d/hwclock.sh as described here <a href="http://www.elevendroids.com/2012/12/setting-up-hardware-rtc-in-raspbian/" title="http://www.elevendroids.com/2012/12/setting-up-hardware-rtc-in-raspbian/">http://www.elevendroids.com/2012/12/setting-up-hardware-rtc-in-raspbian/</a></p>
<p>Step 3: Ignore the first part of <a href="http://blog.remibergsma.com/2013/05/08/" title="http://blog.remibergsma.com/2013/05/08/">http://blog.remibergsma.com/2013/05/08/</a> ... pberry-pi/ but do follow the instructions on removing the fake-hwclock.</em><br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26380"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Sat, 03/01/2015 - 06:19.</div>
    <div class="content">
     <p>Thanks paul feel for the first suggestion that seems to me the simplest .</p>
<p>I just want to ask you which folder should be the file rtc -pi</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Sat, 03/01/2015 - 08:33.</div>
    <div class="content">
     <p>Well a step forward has been made ...<br />
I removed the battery<br />
starting with &quot;startx&quot; the graphic terminal and typing &quot;./rtc-pi&quot; shows me the correct time.</p>
<p>Except that if you restart the raspberry gives me an error of which I include photos, maybe put in the syntax file &quot;rc.local&quot; is wrong</p>
<p>This is my text in the file &quot;rc.local&quot;</p>
<p>*********************************************<br />
#! / bin / sh -e<br />
#<br />
# rc.local<br />
#<br />
# This script is executed at the end of each multiuser runlevel.<br />
# Make sure That the script will &quot;exit 0&quot; on success or any other<br />
# Value on error.<br />
#<br />
# In order to enable or disable this script just change the execution<br />
# Bits.<br />
#<br />
# By default this script does nothing.</p>
<p># Print the IP address<br />
_IP = $ (Hostname -I) || true<br />
if [&quot;$ _IP&quot;]; then<br />
&nbsp;&nbsp; printf &quot;My IP address is% s \ n&quot; &quot;$ _IP&quot;<br />
fi</p>
<p>
#riga inserted to start rtc-pi startup 02/02/15-sergio<br />
&nbsp;<u><strong> sudo ./rtc-pi</strong></u></p>
<p>sudo sh -c &quot;sed -i &#39;/ ^ exit 0 / i \ sudo ./rtc-pi\n&#39; /etc/rc.local&quot;</p>
<p>exit 0</p>
<p>********************************************<br />
The line of code highlighted &quot;sudo ./rtc-pi&quot; has included him automatically, I just inserted<br />
that which thou hast attached</p>
<p>I enclose also has pictures of the screen with error</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26389"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 03/01/2015 - 12:13.</div>
    <div class="content">
     <p>serbat, My fault for not specifying the location. and the command I suggested was intended to do the edit for you not to be put in the rc.local itself, sorry I should of been clearer.&nbsp;If you edit&nbsp;/etc/rc.local so the last lines are</p>
<blockquote><p>#riga inserted to start rtc-pi startup 02/02/15-sergio<br />
sudo&nbsp;/home/pi/data/rtc-pi</p>
<p>exit 0</p>
</blockquote>
<p>This should get you running at least.</p>
<p>The location of rtc-pi&nbsp;isn&#39;t great and using an init script is preferable to using rc.local. But this was the simplest way for now.&nbsp;</p>
<p>Hi Bill - I also looked into this when tackling the read-only sd card issues and found a wide variety of info, this article is a good example of a compilation of facts and is quite common, there is also a lot of good info out there but it&#39;s not always clear which is which.</p>
<p>Using init scripts is the preferred&nbsp;method for any daemon, However I wouldn&#39;t recommend editing the fake-hwclock&#39;s&nbsp;init script to suit as A) if you have fully&nbsp;removed fake-hwclock&nbsp;correctly it shouldn&#39;t exist and B) any edits you do make could easily be overwritten if there is an update to fake-hwclock.</p>
<p>​I too prefer the idea of an I&sup2;C connected rtc and the type I favor can work with&nbsp;fake-hwclock, The rtc is added as a ntp server and the Pi is none the wiser to the fact ntp is contacting the connected rtc rather than a remote server. So the fake-hwclock is still used in the moments prior to establishing the correct time during boot up and will continue to operate long after the battery has expired on the rtc.</p>
<p>Some&nbsp;rtc&#39;s&nbsp;can also perform minor ongoing corrections and/or be corrected by ntp so they need to be kept running.&nbsp;I did buy a couple to play with but haven&#39;t done anything with them yet.</p>
<p>Regards serbats&nbsp;device I do not know exactly how it works so advice is vague and less specific, will it work in a read only file-system? does it use &quot;ntp standard commands&quot; and fit in with raspbian&#39;s existing ntp system? or does it just fetch the time at start up?&nbsp; there are many possibilities.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26395"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sat, 03/01/2015 - 14:23.</div>
    <div class="content">
     <p>Hello Paul,</p>
<p><em>Using init scripts is the preferred&nbsp;method for any daemon, However I wouldn&#39;t recommend editing the fake-hwclock&#39;s&nbsp;init script </em></p>
<p>The script the article talks about editing is /etc/init.d/hwclock.sh, as opposed to /etc/init.d/fake-hwclock</p>
<p>As you mentioned, if /etc/init.d/fake-hwclock is removed properly, (purged) it wont exist.</p>
<p>Regards,</p>
<p>Bill</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6715.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="serbat&#039;s picture" title="serbat&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/6715.html" title="View user profile.">serbat</a> on Sat, 03/01/2015 - 14:52.</div>
    <div class="content">
     <p>thanks Paul</p>
<p>Now everything is working.</p>
<p>Thanks again ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26413"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 03/01/2015 - 22:57.</div>
    <div class="content">
     <p>Excellent news serbat :-)</p>
<p>Hi Bill - I had indeed&nbsp;missed the fact it was the hwclock&nbsp;init&nbsp;rather than the fake-hwclock init but<span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">&nbsp;</span><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">(IMHO)</span><span style="font-size: 12.7272720336914px; line-height: 18.9090900421143px;">&nbsp;</span><span style="font-size: 13px; line-height: 1.6;">it still isn&#39;t good practice as an update to </span>hwclock<span style="font-size: 13px; line-height: 1.6;"> could easily overwrite the changes, it would be better to write an additional one as it&#39;s not too difficult.</span></p>
<p><span style="font-size: 13px; line-height: 1.6;">Paul</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26425"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sun, 04/01/2015 - 03:41.</div>
    <div class="content">
     <p><em>it would be better to write an additional one as it&#39;s not too difficult.</em></p>
<p>If nothing else, a renamed copy of the original file would be a reasonable starting point to write one&#39;s own, wouldn&#39;t it?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26437"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 04/01/2015 - 17:08.</div>
    <div class="content">
     <p>You could definitely go that route, however&nbsp;I haven&#39;t compared the init scripts to see how&nbsp;much that helps. There is also a basic template included in raspbian&nbsp;<strong>/etc/init.d/skeleton.</strong></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28328"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7770.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rjmsr&#039;s picture" title="rjmsr&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Help ... I can not set RTC - module with DS1302</h3>

    <div class="submitted">Submitted by <a href="../user/7770.html" title="View user profile.">rjmsr</a> on Sun, 01/03/2015 - 19:32.</div>
    <div class="content">
     <p><strong>Problems with RPi2</strong></p>
<p>Have use the DS1302 module and software with good success on RPi B ver 2 and also RPi B+. Now that I have a new RPi 2, I cannot get the unit to update my time.</p>
<p>Setting time to the module seems OK, no errors indicated.</p>
<p>In reading time <strong>/rtc $ sudo ./rtc-pi</strong></p>
<p>I get the message<strong>&quot;Unable to change the system time. Did you run the program as administrator? The operation returned the message &quot;Invalid Argument&quot;&quot;.</strong></p>
<p>The module works fine on the B+ and RPi B ver 2.</p>
<p>I re-compiled the .c program on the RPi2 as I did on the original unit thinking that was the problem..No change.</p>
<p>Am I overlooking something?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6403"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ET0NcO4AuswJae3PDbimYlCkC06LmvRdHvin9xRzewY" value="form-ET0NcO4AuswJae3PDbimYlCkC06LmvRdHvin9xRzewY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/6403 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:27:22 GMT -->
</html>
