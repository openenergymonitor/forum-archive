<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10834 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:11:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>LDR or the optical pulse sensor + EmonTH (battery powered) | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">LDR or the optical pulse sensor + EmonTH (battery powered)</h3>
        <span class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 10/06/2015 - 07:27</span>
        <div class="content"><p>Hi,</p>
<p>I&#39;m using an LDR to detect the optical pulses of my electric meter (as described <a href="http://jeelabs.org/2012/03/18/detecting-a-blinking-led/">here</a>). Contrary to photodiode, the energy consumption is compatible with a battery powered sensor. In my case, pulses are sent to emoncms by an EmonTH.</p>
<p>It very usefull because many meters are too far away from a power socket</p>
<p>&nbsp;</p>
<p>I made my own led pulse sensor (see attached). It works fine but I&#39;m looking for a off-the-shelf solution. Something like <a href="http://shop.openenergymonitor.com/optical-utility-meter-led-pulse-sensor/?page_context=category&amp;faceted_search=0">the pulse sensor available in the shop</a> but using a LDR.</p>
<p>Do somebody know where to buy such a sensor ?</p>
<p>Thank&#39;s</p>
<p>Eric</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11754.html" class="topic-previous" title="Go to previous forum topic">‹ Water &amp; Gas Monitoring Test: Flukso Gas and Water meter sensors + emonPi / emonTx or emonTH? </a>
              <a href="12180.html" class="topic-next" title="Go to next forum topic">EmonTX Shield v2 And ESP 8266 12-F ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31634"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8333.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nzpaul&#039;s picture" title="nzpaul&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/8333.html" title="View user profile.">nzpaul</a> on Tue, 23/06/2015 - 11:09.</div>
    <div class="content">
     <p>@Eric, I too would like to know the answer. I am wanting to build a similar system. My meter is far away from any power points.</p>
<p>Did you wrote you own firmware for the emonTH? I can&#39;t find where to configure a emonTH to read pulses.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Tue, 23/06/2015 - 12:51.</div>
    <div class="content">
     <p>Hi,</p>
<p>I&#39;m writting it. It&#39;s a pain to make it low-power but I&#39;m doing some progress.</p>
<p>I will publish it as soon as it&#39;s ready and fully tested</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31695"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Thu, 25/06/2015 - 11:59.</div>
    <div class="content">
     <p>
Here is my sketch.</p>
<p>I&#39;m not very happy with it because it&#39;s not simple but I failed to write a simple and low-power sketch. Here is the full story.</p>
<p>First, I tried the emonTH pulse counting sketch found on <a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_PulseCounting/emontx_lib.ino">github</a>. Between two sent, there is no power saving =&gt; battery lasts only 4 days ...</p>
<p>Then, I moved to a low power sketch where Emonth sleeps between two interrupts. Something like <a href="https://learn.openenergymonitor.org/?redirect=pulse-counting-sleep">this one</a>. The remaining question was : when should Emonth send data to emoncms ? Every times a pulse is counted ? No, because I want to be able to handle at least 10 pulses / seconds.</p>
<p>As EmonTh loses track of time when sleeping (like us ;),one can&#39;t make it send data every x seconds using time counters. I think it&#39;s imposible without using an external RTC.</p>
<p>So I envisaged first to make it send data every x pulses. It&#39;s not a good deal as it means that the update rate will vary a lot considering the pulse rate. In my case, I&#39;m counting pulses from electric meter (1 pulse = 1 Wh). Power may vary from 100W (one pulse every 36 seconds)&nbsp; to 36 kW (one pulse every 0.1 seconds). So, if x=100 pulses (emonth sends data every 100 pulses), the update rate may vary from 3600 s to 10 seconds ...</p>
<p>So I decided to add another&nbsp; condition to send data to emoncms. Data will be send when x pulses have been counted from the last sent OR&nbsp; when y ranges of short time without any pulses (z ms) have elapsed from the last sent.</p>
<p>In the attached sketch, x is PULSE_MAX_NUMBER, y is WDT_MAX_NUMBER, and z is WDT_PERIOD. Desired values for x, y and z must be choosen with the attached ods file according to your meter and the targeted update interval.</p>
<p>I&#39;m only sendinf pulses (ie kWh) , so power must be calculated in emoncms using the kwh_to_power process.</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31698"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 25/06/2015 - 13:21.</div>
    <div class="content">
     <p>I have just measured the current consumption of the new pulse sensor. It draws near zero current in between pulses and a transient 8mA when a pulse is detected so it should be able to be used with the emonTH&nbsp;for a decent time period on batteries. emonTH firmware will need to be modified.&nbsp;<a href="https://learn.openenergymonitor.org/?redirect=opticalpulsesensor">http://openenergymonitor.org/emon/buildingblocks/opticalpulsesensor</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31699"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 01/07/2015 - 08:29.</div>
    <div class="content">
     <p>Hi,</p>
<p>Great news !</p>
<p>Unfortunately, a sensor based on a LDR is not very easy to setup. Mine works fine at low frequency, but I&#39;m not sure it&#39;s ok with 10 pulses/seconds.&nbsp; The value of the pull up resistor is also difficult to setup. A large value make the sensor miss pulses at high frequency (due to LDR latency). A low value drains batteries. For DIYer, it remains a cheap solutions (less than 1&euro;/$).</p>
<p>You&#39;re talking about a decent time period on batteries. Could you please tell us more ? Several days, weeks or months ? What would be the battery life at high pulse rate ?&nbsp; Let say one pulse every <s>0.5s</s> 0.2s (18kW) ?</p>
<p>Eric</p>
<p>EDIT : if you can have a look on my sketch ... Comments will be appreciated.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31820"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 01/07/2015 - 08:29.</div>
    <div class="content">
     <p>Hi,</p>
<p>I read on <a href="https://learn.openenergymonitor.org/?redirect=opticalpulsesensor">here</a> that the current consumption&nbsp;of the new pulse sensor is about 0mA in darkness but about 8mA for duration of pulse (standard meter 100ms).</p>
<p>8mA during 100ms, that&#39;s a lot ! With one pulse every 0,2 s (18kW), it means that EmonTH battery will only last 24 days. (according to this <a href="http://oregonembedded.com/batterycalc.htm">tool</a>)</p>
<p>Glyn, could you please confirm your current measurement. ? ( 8mA for duration of pulse)</p>
<p>Thanks</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32495"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8478.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="kirkholt&#039;s picture" title="kirkholt&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/8478.html" title="View user profile.">kirkholt</a> on Fri, 24/07/2015 - 06:34.</div>
    <div class="content">
     <p>Hi</p>
<p>Here is an idea that I haven&#39;t tested:</p>
<p>Connect the power wire from the sensor to screw terminal 5 on the EmonTH. This way you can control the power to the sensor.</p>
<p>Now in the interrupt routine in the sketch, turn off the power to&nbsp;the sensor, count the pulse and set flag for new pulse true.</p>
<p>In the main loop:<br />
if flag for new pulse<br />
&nbsp;&nbsp;sleep&nbsp;for the minimum duration of the pulse (100 ms)<br />
&nbsp; Then turn the power to the sensor back on.<br />
&nbsp;&nbsp;Set flag for new pulse false</p>
<p>in setup&nbsp;change:<br />
attachInterrupt(0, onPulse, FALLING) to&nbsp;<br />
attachInterrupt(0, onPulse, RISING);<br />
&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33617"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 26/08/2015 - 07:00.</div>
    <div class="content">
     <p>Hi kirkholt,</p>
<p>Sorry for the late answer. Just back from long holidays.</p>
<p>Thank you for helping me. I tried your idea and it seems to work fine with the optical pulse sensor from the shop.</p>
<p>Unfortunately, I can&#39;t say if it really save the emonth battery. I guess I need an oscilloscope (and more knowledge !)</p>
<p>Please find attached the modified sketch.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34664"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 03/10/2015 - 12:58.</div>
    <div class="content">
     <p>Hello Eric, I see what you mean now regarding your pm and after struggling with this for a bit, can I add your example to the EmonTH github repo? with attribution to yourself of course. Thanks a lot for sharing it!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34665"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 03/10/2015 - 13:02.</div>
    <div class="content">
     <p>I tested the current draw when it sleeps and it does drop down to 0.06mA, the same as the main emonth firmware example without the pulse counting.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34666"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 03/10/2015 - 14:39.</div>
    <div class="content">
     <p>I&#39;ve tried merging your code with the&nbsp;emonTH_DHT22_DS18B20_RFM69CW example and I think I have it working. I&#39;ve uploaded it here: <a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS18B20_RFM69CW_Pulse/emonTH_DHT22_DS18B20_RFM69CW_Pulse.ino" title="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS18B20_RFM69CW_Pulse/emonTH_DHT22_DS18B20_RFM69CW_Pulse.ino">https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS1...</a></p>
<p>I put a millis() elapsed check in the sketch to count the awake time, it seems to be reporting that its always awake, or the timer for millis is not turned off as expected, but then the current consumption does drop to 0.06mA, Im getting the same result with your original example too.. Not sure whats happening there.</p>
<p>Edit: I also had to remove the use of the DS18B20 ADC or power pin to turn on and off the power to the optical pulse sensor as they may be used by a DS18B20 temperature sensor, I need to find an alternative method.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34669"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sat, 03/10/2015 - 21:29.</div>
    <div class="content">
     <p>Check out&nbsp;Sleepy::loseSomeTime() at&nbsp;<a href="https://github.com/jcw/jeelib/blob/master/Ports.cpp#L1139">https://github.com/jcw/jeelib/blob/master/Ports.cpp#L1139</a>. &nbsp;After it wakes up &nbsp;again (provided it was woken up by the watchdog) &nbsp;it knows how long it was asleep &nbsp;and fixes up the timers so you won&#39;t appear to have lost any time. &nbsp;If it&#39;s woken up by your pulse, then it guesses a correction.</p>
<p>Unrelated to that,&nbsp;&nbsp;you probably want to declare this guy as volatile:</p>
<p><span style="line-height: 1.6;">boolean &nbsp;p;</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34686"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6437.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6437.jpg" alt="Charly86&#039;s picture" title="Charly86&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/6437.html" title="View user profile.">Charly86</a> on Sun, 04/10/2015 - 13:33.</div>
    <div class="content">
     <p>That&#39;s an interesting post, may be the 8ma are because of the onboard led of&nbsp;Optical Utility Meter LED Pulse Sensor. I did not find the schematics, are they open source ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34715"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Tue, 06/10/2015 - 07:29.</div>
    <div class="content">
     <p>Hi Trystan,</p>
<p>I&#39;m happy to see that you dived into that piece of code. Feel free to improve/publish it as you want. According to me, a battery-powered EmonTH being able to count pulses for month is a must feature ! In France, most of electric meters (about one over two) are not inside the house. All others monitoring solutions have it.</p>
<p>I have been testing my sketch for weeks and it works fine whatever the pulse rate is. From 0,1 pulse/sec to 10 pulse/sec. But I&#39;m not very satisfied with that sketch because :</p>
<ul>
<li>The code is not easy to read/understand.</li>
<li>Some constants must be set accordingly to the pulse rate and the pulse duration.</li>
<li>The time between two sents is dependent from the pulse rate...</li>
</ul>
<p>It looks like it is not possible to make the EmonTH count interrupts, sleep between interrupts and send data at a fixed rate using the current hardware. Can this be solved adding a cheap piece of hardware on the EmonTH ? I&#39;m thinking about a low power counter or a low power RTC but I have no idea if it is possible.</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34737"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 06/10/2015 - 22:53.</div>
    <div class="content">
     <p>Thanks dBC, that&#39;s really interesting, I missed that.</p>
<p>Thanks Eric, I&#39;ve uploaded your example here replacing my initial attempt:<br />
<a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_pulse_lowpower/emonTH_pulse_lowpower.ino" title="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_pulse_lowpower/emonTH_pulse_lowpower.ino">https://github.com/openenergymonitor/emonTH/blob/master/emonTH_pulse_low...</a>.</p>
<p>I&#39;ve realised there is another issue with the LED on the optical pulse sensor in that it stays on constantly when no power is being used (red led on utility meter stays on when power consumption is 0). Which means my test emonth is down to 2.8v already...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34751"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 07/10/2015 - 11:13.</div>
    <div class="content">
     <p>The signal from a passive LDR sensor can also be detected by regular polling at any IO port.&nbsp; Each pulse from my electricity meter is approx 38 ms in duration, so can be reliably detected by polling once per mains cycle.&nbsp; If this source of timing is not available, a repetitive hardware timer could be used instead.&nbsp;</p>
<p>If the LDR sensor is well shielded, it will only consume any power when the meter&#39;s LED is on.&nbsp; In most situations, this will only be for a very small fraction of the time.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34755"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Wed, 07/10/2015 - 11:53.</div>
    <div class="content">
     <p>I think that varies a lot from meter to meter. &nbsp;My revenue meter signals each Wh of consumption via its LED, but it appears to do it with a 50% duty cycle square wave on the LED. &nbsp;In other words, every Wh consumed it turns the LED on but it doesn&#39;t turn&nbsp;it off until 0.5Wh later. &nbsp; It&#39;s a toss of a coin whether my meter spends the entire day with the LED on, or off... depending on where it happened to be when the PV output started exceeding my consumption.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39278"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5694.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5694.jpg" alt="Patrice Diliakou&#039;s picture" title="Patrice Diliakou&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5694.html" title="View user profile.">Patrice Diliakou</a> on Tue, 09/02/2016 - 19:45.</div>
    <div class="content">
     <p>Hello,</p>
<p>Is your sketch working on emonth v1.4 ?</p>
<p>I&#39;ve got one but impossible to make it working...</p>
<p>Thank&#39;s !</p>
<p><em>[Please DO NOT DOUBLE-POST. The duplicate has been deleted. Read &#39;Read this before posting&#39; to know what happens. Moderator (RW)]</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39287"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Tue, 09/02/2016 - 21:14.</div>
    <div class="content">
     <p>Hi</p>
<p>Many different sketch have been discussed in that post for months.</p>
<p>What sketch are you talking about ?</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39288"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5694.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5694.jpg" alt="Patrice Diliakou&#039;s picture" title="Patrice Diliakou&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5694.html" title="View user profile.">Patrice Diliakou</a> on Wed, 10/02/2016 - 11:49.</div>
    <div class="content">
     <p>Thanks for your answer.</p>
<p>This one :</p>
<p><a href="https://github.com/openenergymonitor/emonTH/tree/master/old/emonTH_pulse_lowpower">https://github.com/openenergymonitor/emonTH/tree/master/old/emonTH_pulse_lowpower</a></p>
<p>&nbsp;</p>
<p>PS : C&#39;est bidonnant deux fran&ccedil;ais qui parlent en anglais... :D</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39337"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Fri, 12/02/2016 - 08:04.</div>
    <div class="content">
     <p>Salut,</p>
<p>This sketch is intended to work on EmonTH 1.4.</p>
<p>No led activity is programmed in this low power sketch.</p>
<p>What sensor are you using with the EmonTH ?</p>
<p>How is it wired to the EmonTH ?</p>
<p>&nbsp;</p>
<p>Eric</p>
<p>PS : Oui c&#39;est dingue, d&#39;autant que je ne suis pas sur que l&#39;on se comprenne mieux en anglais ... mais pour les autres qui nous lisent, c&#39;est mieux. Si c&#39;est trop compliqu&eacute;,&nbsp; on discutera par message en francais.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39343"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5694.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5694.jpg" alt="Patrice Diliakou&#039;s picture" title="Patrice Diliakou&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5694.html" title="View user profile.">Patrice Diliakou</a> on Fri, 12/02/2016 - 11:43.</div>
    <div class="content">
     <p>Hello,</p>
<p>Thank you for your answer.</p>
<p>I will make another tests this evening.</p>
<p>This is a reed contact that i try to use. Wired between 5 and 4 and with pull-down resistor between 4 and ground.</p>
<p>&nbsp;</p>
<p>A+</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39349"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Fri, 12/02/2016 - 13:39.</div>
    <div class="content">
     <p>Hi Patrice,</p>
<p>I got it !&nbsp; In the discussed sketch, there a mistake ...</p>
<p>Replace &quot;attachInterrupt(1, onPulse, RISING);&quot; with &quot;attachInterrupt(0, onPulse, RISING);&quot; to make it work on EmonTh V1.4</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39480"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5694.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5694.jpg" alt="Patrice Diliakou&#039;s picture" title="Patrice Diliakou&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LDR or the optical pulse sensor + EmonTH (battery powered)</h3>

    <div class="submitted">Submitted by <a href="../user/5694.html" title="View user profile.">Patrice Diliakou</a> on Wed, 17/02/2016 - 11:32.</div>
    <div class="content">
     <p>Hello,</p>
<p>Thank you for your answer.</p>
<p>I test it as soon as possible.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10834"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-w_Zcop3d6NzeICUYqQ8IEFBdx7ub75WVjdaUxUXxWKw" value="form-w_Zcop3d6NzeICUYqQ8IEFBdx7ub75WVjdaUxUXxWKw"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
