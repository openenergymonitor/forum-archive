<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5309 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:58:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Combine Wh readings onboard emontxv3 | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Combine Wh readings onboard emontxv3</h3>
        <span class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Tue, 17/06/2014 - 11:27</span>
        <div class="content"><p>I have been trying to modify the emontxv3_kwhtotals_noeeprom sketch to subtract the Wh totals recorded for two of the CT&#39;s from a third CT&#39;s Wh total but I can&#39;t get the figures to add up correctly.&nbsp;</p>
<p>I searched the web trying to figure out what&#39;s going wrong with the sketch but came up with nothing. I think I may have the syntax wrong or something more complicated like rollover is happening.</p>
<p>This is the line I have in the sketch....tx_data.PV_usedwh_CT2 = tx_data.expwh_CT2 - (tx_data.wh_CT3 + tx_data.expwh_CT1);</p>
<p>Substituting s<span style="font-size: 12px;">ome numbers I took from the </span>emontx<span style="font-size: 12px;">&nbsp;gives this as an example....17156 - (525 + 9505) &nbsp;= 9418 &nbsp; &nbsp;This should come to 7126 not 9418</span></p>
<p>Can anybody shed some light on what&#39;s going on here?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10976.html" class="topic-previous" title="Go to previous forum topic">‹ Help - Can&#039;t get Pi Sensor to read anything - Hair Pulling out</a>
              <a href="10973.html" class="topic-next" title="Go to next forum topic">SOLVED Problem with new Jeelink not receiving data from emonTX v3.4 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-21993"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 17/06/2014 - 12:15.</div>
    <div class="content">
     <p>How do you know it is not adding up accurately? Are you reading the same numbers that it is adding up? I can&#39;t read your picture accurately, but at first sight you seem to be doing the calculation in the wrong place. Can you attach the complete sketch - not a screenshot - to a post so that we can see it in its entirety?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21994"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Tue, 17/06/2014 - 12:33.</div>
    <div class="content">
     <p>Hi Robert , thanks for looking. &nbsp;<span style="font-size: 12px;">I&#39;ve attached the sketch. The problem </span>calc<span style="font-size: 12px;"> is at line 567 in &quot;case 70&quot;</span></p>
<p>I have another calculation at line 597 in &quot;case 90&quot; which seems to be working as predicted but it&#39;s just a simple addition of two CT Wh values.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21996"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Tue, 17/06/2014 - 12:59.</div>
    <div class="content">
     <p>Robert, sorry I missed the question when I first read your post. As far as I know I am using the same values to do the calcs. &nbsp;I have used the individual Wh&nbsp;values that the emontxv3 is sending to my nodes page to check the calculations.</p>
<p>I checked using the totals recorded since the emontxv3 was reset during sketch upload, with several resets to make sure. I also checked using the values recorded by the Wh accumulator processor from midnight to midnight the next day and also the kWh to kWhd feed values. All these values agree with each other and match my utility meters yet the calculation is way off.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21997"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 17/06/2014 - 14:57.</div>
    <div class="content">
     <p>I was concerned that one of the values was being changed by accident elsewhere, but that&#39;s not the case. I can&#39;t see a reason for the sum being wrong, I suspect something is getting corrupted along the way. On the face of it, this &quot;All these values agree with each other and match my utility meters yet the calculation is way off.&quot; is self-contradictory. I&#39;m sure you didn&#39;t mean that - it&#39;s a case of what you mean by &quot;all of these values&quot;.</p>
<p>It&#39;s still not clear to me where you are reading the values, and which ones. Do the sums work and are the numbers from the Serial.print directly out of the emonTx mutually consistent, are you reading the numbers after they are imported into emonCMS and are they mutually consistent? This &quot;I have used the individual Wh values that the emontxv3 is sending to my nodes page to check the calculations.&quot; seems to say that the numbers emonCMS is seeing are not mutually consistent. Is that the case? If so, and if the Serial.print values are correct, then have you checked that you have counted the bytes correctly at the emonCMS nodes page and you&#39;re allocating the bytes to the correct variables?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21999"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Tue, 17/06/2014 - 15:23.</div>
    <div class="content">
     <p>I&#39;ve just rechecked the numbers I&#39;m receiving in emoncms and it seems the figures on the nodes page are working out correctly. ie. the onboard calculations are working ok.&nbsp;</p>
<p>However the same calculations based on the kWh to&nbsp;kWhd&nbsp;&#39;feed&#39; values and also on the realtime&nbsp;graphs Wh accumulator based&nbsp;24hr elapsed values are way off the stored calculation. &nbsp;</p>
<p>What is confusing me is the kWh to kWhd and Wh accumulator based feeds match each other and my utility meters exactly yet I can&#39;t get the simple plus and minus calcs to match the emontx&nbsp;calc value when it&#39;s stored as a feed.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22001"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Tue, 17/06/2014 - 16:36.</div>
    <div class="content">
     <p>The two screenshots attached where taken within a second or so of each other. The first shows the nodes page whose values calculate out ok with the calc below.</p>
<p>expWh CT2 - (expWh CT1 + Wh CT3) = pvused Wh CT2</p>
<p>The second screenshot shows the feeds page where the same calculation doesn&#39;t work despite the values coming from the same source.</p>
<p>pvWhd produced - (pvWhd exported to grid + pvWhd diverted to immersion) = pvWhd used in house</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22002"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 17/06/2014 - 18:18.</div>
    <div class="content">
     <p>I wouldn&#39;t expect these values to match unless you have started with a totally clean slate since midnight,</p>
<p>&nbsp;</p>
<p>1st screenshot</p>
<p>expWh CT2 - (expWh CT1 + Wh CT3) = pvused Wh CT2</p>
<p>34697-(1258+19085) = 14354</p>
<p>This is the total &quot;used in house&quot; since counting began</p>
<p>&nbsp;</p>
<p>2nd screenshot</p>
<p>pvWhd produced - (pvWhd exported to grid + pvWhd diverted to immersion) = pvWhd used in house</p>
<p>8668 - (327+5792) =2549</p>
<p>This is the total &quot;used in house&quot; since midnight</p>
<p>&nbsp;</p>
<p>When you created the wh accumulators you would of allocated names to those feeds, those feeds should match the values in screenshot 1 and continue to increase throughout today and tomorrow etc, where as the feeds you refer to in screenshot 2 should reset at midnight &nbsp;and record tomorrows figures only. if you were to sum each of the daily totals since you started counting they would &nbsp;match the wh accumulator totals.</p>
<p>the wh accumulator has been designed to not reset the feed to zero if the emontx&nbsp;is disconnected or powered down etc. in theory if you manually edit those feed values in emoncms to your current meter readings they should continue to increase in line with your meters regardless of whether you reset the emontx.</p>
<p>So this means that the actual values being used in the&nbsp;emontx&nbsp;sketch will not necessarily match the values you see in emoncms&nbsp;but the rate of change should be the same. For that reason I think you would be better doing these calculations in emoncms rather than the emontx, emoncms&nbsp;has the persistent database storage where as the emontx&nbsp;will count from zero at each reset.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22006"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Tue, 17/06/2014 - 19:55.</div>
    <div class="content">
     <p>Thanks for the comments Paul. Sorry I wasn&#39;t very clear with my explanation.</p>
<p>The feeds Whd section in the 2nd screenshot also has the calculated value feed taken from the emontx&nbsp;all time calculated value. This also resets at midnight. see feed 44196 which is showing 3844 Wh&nbsp;since midnight whereas it should be showing 2549 per your workings out.</p>
<p>I used the Whd&nbsp;screenshot as it illustrates the discrepancy&nbsp;better than the all time Wh accumulator feeds which also have the same discrepancy.</p>
<p>I am trying to do the calcs in the emontx to try and increase the robustness of the all time calculated&nbsp;Wh&nbsp;figures in the same way the other Wh figures direct from&nbsp;the emontxv3/ CT&#39;s are more robust than emoncms derived ones. Losing the odd days worth of Whd figures is not a problem as long as the all time Wh&nbsp;accumulator figures can be relied on.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22021"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 18/06/2014 - 08:34.</div>
    <div class="content">
     <p>Aha, sorry for the confusion, I can see what you&#39;re saying now.&nbsp;</p>
<p>If the 3844wh is direct from an input feed it does indeed contradict the other inputs, since all the wh values are immediately passed through wh accumulators you don&#39;t actually get to see the raw data,&nbsp;</p>
<p>Until you have reliable data I would recommend adding a &#39;log to feed&#39; as the first processing step to each of your wh inputs, this won&#39;t effect the results but it will allow you to see the the raw input values to assess if emoncms is getting the correct data.</p>
<p>Paul</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22025"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Wed, 18/06/2014 - 10:54.</div>
    <div class="content">
     <p>I took screenshots of my Node and Feed pages at midnight last night and again this morning and went through them feed by feed and node by node then calculated the PVusedWh manually from the recorded figures for the period. From this I was able to identify where the discrepancy is occurring&nbsp;but can&#39;t understand why its happening.</p>
<p>1. The CT&nbsp;Wh figures and the&nbsp;PVusedWh calculation are reaching the emoncms&nbsp;Nodes page accurately from the emontxv3.</p>
<p>2. The CT derived&nbsp;Wh figures from the Nodes page are being transferred to the feeds page accurately via Wh Accumulator and Wh to Whd processors.</p>
<p>3. The PVusedWh calculation figures are not being transferred&nbsp;from the Nodes page to the Feeds page via Wh Accumulator or via Wh to Whd processors accurately. &nbsp;At first It looked&nbsp;as though this feed value error was increasing exponentially each day ie. midnight to 3pm&nbsp;yesterday gave figures 32% high and figures midnight to 9am&nbsp;today gave figures 12.7% high. However this morning I deleted and then recreated the PVused&nbsp;Wh accumulator feed and the error seems to be very inconsistent so far which doesn&#39;t make sense.</p>
<p>&nbsp;</p>
<p>I&#39;ve added log to feed processors as the first process for each node but so far they are mimicking the nodes values exactly as they should.</p>
<p>It seems as though the Wh accumulator and Wh&nbsp;to Whd processors don&#39;t like the data presented from my PVused&nbsp;Wh Node but what could be making this data any different to the other Wh nodes which the processors have no problems with?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22028"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 18/06/2014 - 12:06.</div>
    <div class="content">
     <p>Okay, that&#39;s&nbsp;progress.</p>
<p>This is new territory for me I haven&#39;t got that involved with wh accumulator before now, but if I understand it&#39;s workings correctly then the easy way to diagnose it further would be to add a &quot;subtract feed&quot; immediately after the wh accumulator to subtract the original received/input value feed, this should give you the difference between the &#39;since reset&#39; value &nbsp;and the &#39;since counting started&#39; value, this should be constant and only change if the emontx is restarted.</p>
<p>Since this is only a theory I would suggest also doing it to a feed that is behaving correctly for a reference.</p>
<p>If the difference varies it would suggest the wh accumulator is not behaving and if it&#39;s unique to this feed I can only guess it&#39;s to do with the range of values or rate of change breaching the 25kw/h filter. I would be surprised&nbsp;if it was but stranger things have happened I guess.</p>
<p>Any change in value on additional &quot;difference&quot; feeds will highlight when an issue occurs, this should at the very least give you a point in time to examine the values closer to understand what&#39;s&nbsp;happening.</p>
<p>you could try editing the filter out of the picture as a test eg&nbsp;100000&nbsp;<a href="https://github.com/emoncms/emoncms/blob/d70905feb48cb5367be4e6c402d491f46b0ffdd9/Modules/input/process_model.php#L602">/Modules/input/process_model.php line 602</a>&nbsp;to see if that has any effect. It has previously been increased from 10k to 25k although I&#39;m not sure why.</p>
<p>I wouldn&#39;t worry too much about the Wh to Whd just yet as that can&#39;t function correctly unless the Wh accumulator is correct.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22034"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Wed, 18/06/2014 - 15:20.</div>
    <div class="content">
     <p>Thanks for the suggestions Paul, I &nbsp;edited the 25k filter value to 25025k.</p>
<p>Next I added a log to feed at the beginning of two of the Nodes then subtracted that log to feed value at the end. The &quot;PV produced&quot; Node I applied it to has stayed stationary so far. However the PVused&nbsp;&quot;problem&quot; node is showing &nbsp;an erratic increase in the feed value. (See screen shot).</p>
<p>The increase in the error seems to be affected roughly by the energy diverted to the immersion feed as can be seen from comparing the two screenshots.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22037"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 18/06/2014 - 16:27.</div>
    <div class="content">
     <p>That&#39;s puzzling, they are too similar to be unrelated.</p>
<p>have you used the same feed for the subtraction eg</p>
<p class="rteindent1">log to feed &quot;ABC&quot;</p>
<p class="rteindent1">wh accumulator&nbsp;&quot;ABC_wh_total&quot;</p>
<p class="rteindent1">subtract&nbsp;feed &quot;ABC&quot;</p>
<p>If not then you should try changing it so it is the exact same feed being subtracted, because for that value to increase the lost wh&#39;s&nbsp;that resemble the immersion value, are either being lost in the wh calc or are missing from the subtracted feed.</p>
<p>Try editing the filter well out of range 99000 for example</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22040"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Wed, 18/06/2014 - 18:52.</div>
    <div class="content">
     <p>I used the exact same log to feed value for the subtraction, see screenshot. I had to do it that way as the nodes page doesn&#39;t have any + - node input processors yet. The old inputs page + - input processors don&#39;t work any more now I&#39;ve switched to the new Node inputs page method.</p>
<p>&nbsp;I&#39;ve suspected there was something going on with the diverted to immersion feed for the past week as I&#39;ve noticed a few times that all the daily feed values are in equilibrium until the immersion starts diverting at about 7am each morning.</p>
<p>It&#39;s as if the immersion value is being added to the PV produced value instead of being subtracted, but that can&#39;t be the case or the node input values wouldn&#39;t add up and the error value is not a match for the immersion value anyway.</p>
<p>I&#39;&#39;ve got the filter value set at 100000000 now so it should be well out of range.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22046"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 18/06/2014 - 20:50.</div>
    <div class="content">
     <p>Sounds like you&#39;re on the right track, see what happens when the sun comes up in the morning, I guess.....</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22055"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Thu, 19/06/2014 - 09:59.</div>
    <div class="content">
     <p>The error stopped overnight but, as can be seen on the screen shots, started again at 05:50 when diversion to immersion and export to grid started again.</p>
<p>I can&#39;t think why the rate of error addition is roughly mimicking the diversion to immersion and export to grid inputs yet I can&#39;t see a link with the &quot;PV used&quot; log to feed.</p>
<p>As all the calculations for the &quot;PVusedWh&quot; input have already been done on board the emontxv3&nbsp;and the input values from the calculation are correct, the Wh accumulator is just working out the difference between two Wh&nbsp;numbers and storing that difference to a feed value exactly the same as it does for all the other Wh inputs. It&#39;s as if it is rounding this feed up or changing the data type before saving to the feed.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22056"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 19/06/2014 - 11:09.</div>
    <div class="content">
     <p>It&#39;s not easy to tell from screenshots but &nbsp;it looks like the increases are equal to the difference between what&#39;s being diverted to immersion and the PV being exported &nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22062"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Thu, 19/06/2014 - 13:30.</div>
    <div class="content">
     <p>That&#39;s exactly what I thought but when I examined the data the error/ increase was varying a lot. Between 05:50 and 0810 this morning the error worked out at 84% of the diverted to immersion and exported to grid total, however looking at earlier data the error amount &nbsp;is much smaller than the actual diverted and exported amounts. eg. Over three days midnight 15th to midnight&nbsp;18th the diverted to immersion + exported to grid Wh&nbsp;was 33156 and the error was 6607Wh so 20%</p>
<p>I also checked the error as a percentage of the PV produced and this also varied between 16% and 12 % for the same two periods respectively.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22066"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 19/06/2014 - 18:28.</div>
    <div class="content">
     <p>Having re read my last post it wasn&#39;t quite what I meant. I happened to notice the increases in error (22wh) plus the increase in exported amount (8wh) seemed to equal the increase in the diverted amount (30wh) and the graphs seemed to show the same at any time ie not proportional &nbsp;but the sum of the changes to exported and pv used = the change in diverted, but It was a very small sample and early in the day so may be just a coincidence.</p>
<p>After a few hours, assuming nothing has been changed and the&nbsp;emontx&nbsp;hasn&#39;t been restarted, if the sum of &nbsp;&quot;pv&nbsp;used in house&nbsp;Whd&nbsp;bare&quot; and &#39;PV Whd exported to grid&#39; is equal to &#39;Wh diverted to immersion&#39; then it&#39;s not just a coincidence.</p>
<p>It&#39;s odd it only happens to that feed, especially as the log to feed is so steady. maybe as a last resort you should try substituting a fixed value in place of the calculation in the sketch for a short burst just to see if the error still occurs in emoncms&nbsp;or if not then the issue lies in the sketch. if you substitute the current value from the&nbsp;emoncms&nbsp;log to feed there should be no increase or movement on that feed in emoncms&nbsp;and if you keep the test short the data loss should be minimal as emoncms can pick up where it left off after editing sketch back to the calculation.</p>
<p>How are you diverting? could this be &quot;energy bucket&quot; related. I use MartinR&#39;s&nbsp;PLL&nbsp;sketch and with the anti flicker i always record some export during times that I know i&#39;m&nbsp;not exporting due to the bucket filling and emptying being counted. my&nbsp;nett value will be correct but import and export figures are exaggerated.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22067"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Thu, 19/06/2014 - 19:36.</div>
    <div class="content">
     <p>I substituted the calc&nbsp;for a fixed value of &nbsp;15473 and for the last 35 minutes the &quot;PVused after subtracting feed&quot; feed has remained fixed suggesting the problem is in the sketch.</p>
<p>It&#39;s strange that the node inputs all seemed to be in equilibrium when the calc was running previously.</p>
<p>I&#39;m using a homemade standalone diverter that uses an anologue comparator to maintain a steady 20 to 80W export whilst varying the output to the immersion with a crydom in phase shift mode.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22078"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Fri, 20/06/2014 - 10:34.</div>
    <div class="content">
     <p>I did some more substitutions in the sketch (as below) to try and identify the source of the error and it seems to be suggesting that the Wh accumulator can&#39;t handle data derived from a calculation with a subtraction in it but the input on the node page can.</p>
<p>1. &nbsp;tx_data.PV_usedwh_CT2 = tx_data.expwh_CT2 - (tx_data.wh_CT3 + tx_data.expwh_CT1); &nbsp; &nbsp; gives correct input values but processing the input value further with the&nbsp;Wh accumulator feed gives errors.</p>
<p>2.&nbsp;tx_data.PV_usedwh_CT2 = &nbsp;127543 &nbsp; &nbsp; &nbsp;using a fixed number gives no errors in input or Wh accumulator feed.</p>
<p>3.&nbsp;tx_data.PV_usedwh_CT2 = tx_data.expwh_CT2 + tx_data.wh_CT3 + tx_data.expwh_CT1; &nbsp; &nbsp; &nbsp; Removing the subtractions gives no errors in input or Wh accumulator feed. &nbsp;</p>
<p>4. &nbsp;&nbsp;tx_data.PV_usedwh_CT2 = tx_data.expwh_CT2 + &nbsp;(-1*tx_data.wh_CT3) + (-1*tx_data.expwh_CT1); &nbsp;I tried this as a long shot but still got errors the same as 1. above.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22079"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 20/06/2014 - 15:35.</div>
    <div class="content">
     <p>The tests certainly do seem to suggest the Wh accumulator is not handling values derived from a calculation containing a subtraction, but how would it be aware of a values history? surely a number is a number, there must be something else&nbsp;happening that is not easily spotted.</p>
<p>You could try putting the whole calc in parenthesis&nbsp;</p>
<p class="rteindent1">tx_data.PV_usedwh_CT2 = ( tx_data.expwh_CT2 - (tx_data.wh_CT3 + tx_data.expwh_CT1))</p>
<p>or splitting the calc</p>
<p class="rteindent1">long temp_val =&nbsp;tx_data.wh_CT3 + tx_data.expwh_CT1</p>
<p class="rteindent1">tx_data.PV_usedwh_CT2 = tx_data.expwh_CT2 - temp_val</p>
<p>or splitting the calc and changing the sign</p>
<p class="rteindent1">long temp_val = (tx_data.wh_CT3 + tx_data.expwh_CT1) * -1</p>
<p class="rteindent1">tx_data.PV_usedwh_CT2 = tx_data.expwh_CT2 +&nbsp;temp_val</p>
<p>or just&nbsp;&nbsp;try to&nbsp;subtract a fixed value maybe</p>
<p class="rteindent1">tx_data.PV_usedwh_CT2 = &nbsp;tx_data.expwh_CT2 - 123</p>
<p>These sort of tests may narrow the search for where it&#39;s struggling but should really be irrelevant to emoncms, it would be better if we could see the absolutely raw values, perhaps adding some code to serial print the tx_data.values in the &quot;void send_rf_data()&quot; so you can see exactly&nbsp;what is being passed to the rf module may show something.</p>
<p>Unfortunately&nbsp;using bytes directly into the nodes module method you cannot see the actual real values in transit , but &nbsp;if you can post some emonhub.log file contents both when faulting and when behaving, or copy the log file to dropbox we can look at the byte values to see if there is anything obvious, we would need some time/date info to locate areas of interest.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22084"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Fri, 20/06/2014 - 22:36.</div>
    <div class="content">
     <p>Paul, I tried some of your suggestions...</p>
<p>tx_data.PV_usedwh_CT2 = ( tx_data.expwh_CT2 - (tx_data.wh_CT3 + tx_data.expwh_CT1)) &nbsp; &nbsp; gave the same errors as before.</p>
<p>tx_data.PV_usedwh_CT2 =&nbsp; tx_data.expwh_CT2 - 123 &nbsp; &nbsp; &nbsp; gave no errors</p>
<p>I couldn&#39;t get the other two code suggestions to compile without other mods to the sketch but ran out of sunlight before I could get them to run.</p>
<p>Below are links to a log from today and also some serial output taken when the error was happening.</p>
<p>I checked the subtraction graph and small errors where being produced around 17:50. I&#39;ll try and save a better log tomorrow when more diversion/ errors are happening.</p>
<p><a href="https://www.dropbox.com/s/x2qs9yojz5l467u/emonhub.log.1dd" title="https://www.dropbox.com/s/x2qs9yojz5l467u/emonhub.log.1dd">https://www.dropbox.com/s/x2qs9yojz5l467u/emonhub.log.1dd</a></p>
<p><a href="https://www.dropbox.com/s/flv63lf3xbmp5xb/serial_output.txt" title="https://www.dropbox.com/s/flv63lf3xbmp5xb/serial_output.txt">https://www.dropbox.com/s/flv63lf3xbmp5xb/serial_output.txt</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22092"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Sat, 21/06/2014 - 09:33.</div>
    <div class="content">
     <p>Paul,</p>
<p>Below is Dropbox&nbsp;link to emonhub.log from this morning when lots of errors where being produced.&nbsp;</p>
<p>I don&#39;t understand what the log is showing. I read your explanation of how ints are transferred on another thread but don&#39;t understand how longs are transferred.</p>
<p><a href="https://www.dropbox.com/s/432gayyov395ekr/emonhub.logDD" title="https://www.dropbox.com/s/432gayyov395ekr/emonhub.logDD">https://www.dropbox.com/s/432gayyov395ekr/emonhub.logDD</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22095"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 21/06/2014 - 12:13.</div>
    <div class="content">
     <p>I was looking at your post from last night earlier and have spotted a few things of interest, your comment &quot;-123 gave no errors&quot; suggests it&#39;s the subtraction of those variables/values rather than the subtraction itself that&#39;s an issue.</p>
<p>The log is quite bulky and difficult to pin point errors in values so I won&#39;t look into that in too much depth until we&#39;re fairly sure that what&#39;s coming out of v3 is &quot;suitable&quot;. Having said that I have noticed what I can only describe as a &quot;stutter&quot; on several occasions the same message number is resused but with different values. I would assume the message number should be unique to each frame/message.</p>
<p>There are several &quot;anomolies&quot; in the serial data but that data is &quot;as sent&quot; so may not be an issue. none the less the data is not useful for it&#39;s intended use because there are several instances where numbers are concatenated&nbsp;eg val1 = 11&nbsp;val2 = 33 is displayed as a single value 1133, but that&#39;s easily fixed with some additional separators.</p>
<p>There is a new line occurring every 5th cycle and there is a &quot;bump&quot; in the values every 5th cycle, which moves across to the next Wh value every 3rd or 4th&nbsp;occurrence. (my guess is the case statement timing is playing a big part here)</p>
<p>While I haven&#39;t figured out why or how, I&#39;m inclined to agree with Roberts opening comment about these calculations possibly being in the wrong place.</p>
<p>Until the sketch is acting correctly I recommend adding a print function like this</p>
<blockquote><p>void print_rf_data()<br />
		{<br />
		&nbsp; Serial.println (tx_data.msgNumber);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.realPower_CT1);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.realPower_CT2);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.realPower_CT3);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.realPower_CT4);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.impwh_CT1);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.expwh_CT1);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.expwh_CT2);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.impwh_CT2);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.wh_CT3);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.grosswh_CT1);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.PV_usedwh_CT2);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.expwh_CT4);<br />
		&nbsp; Serial.print(&#39;, &#39;);<br />
		&nbsp; Serial.print&nbsp; (tx_data.impwh_CT4);<br />
		)</p>
</blockquote>
<p>to the end of the sketch (this is untested so may need tweaking) and a &quot;print_rf_data()&quot; line just before the&nbsp;send_rf_data() command, so that each time the data is sent it also prints an identical copy to serial. You will be able to see the real values in the serial window as they arrive in emoncms and compare then against the emonhub.log if needed.</p>
<p>It may help to comment out any other print statements as if it&#39;s still not clear you can copy and paste the serial output to excel if needed. also if you need to, you can temporarily have more than one print_rf_data command or move it around to locate an issue.</p>
<p>It&#39;s important that every wh is updated at each send as passing several increments in one or omitting values will bring the Wh&nbsp;logic and filter into play. any reductions at all or increases over 6.9Wh/sec will be ignored (based on default 25000).</p>
<p>&nbsp;</p>
<p>The unsigned integer byte conversion for a byte pair 100 150 would be</p>
<p>100 + (150*256) = 38500</p>
<p>the calc for a signed int&nbsp;is as above but if result greater than 32768 then subtract 65536</p>
<p>38500 - 65536 = -27036</p>
<p>&nbsp;</p>
<p>An unsigned long&nbsp;byte conversion for a byte array 100 150 200 250 would be</p>
<p>100 + (150*256) + (200*256*256) + (250*256*256*256) = 4194304000</p>
<p>the same applies to a signed long if it is greater than&nbsp;2147483648 then subtract&nbsp;4294967296</p>
<p>4194304000 -&nbsp;4294967296 = -100663296</p>
<p>&nbsp;</p>
<p>&nbsp;I do think the sketch would benefit from some remedial work before delving into the byte values in emonhub.log</p>
<p>You appear to have 2 send_rf&nbsp;commands, It looks like somehow you have updated the sketch <a href="https://github.com/openenergymonitor/emonTxFirmware/commit/2b645c213ca5358ac9f0cbb85b07af7d692a8dc3">as per this commit </a>by adding the new stuff but not removing the old.</p>
<p>if it was me, I would put the case statements back as they where and do all my&nbsp;maths&nbsp;in a custom function (like the print_rf_data example), then i could do the calcs where ever I put the relevant command. I would start by trying it just before the send_rf along with the print_rf.So that v3 can do its thing and then when it&#39;s ready to send do the final calcs -&gt; print to serial -&gt; send by rf. But that&#39;s me I&#39;m no expert with arduino and there may well be better ways.</p>
<p>One benefit of this method is if you want to change/update the sketch, your sums (and print) can be copied over with minimal&nbsp;fuss.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22100"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Sat, 21/06/2014 - 18:22.</div>
    <div class="content">
     <p>Paul, thanks for taking the time to go through all that, it&#39;s given me a lot to go at. I originally had the calcs in case 100 with the msgNumber&nbsp;statement but I moved them when I found I was getting errors. You where right about the origin of the 2 send_rf commands I updated the sketch by eye but didn&#39;t spot the deletions.</p>
<p>I&#39;ll try and implement the changes asap.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22135"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Mon, 23/06/2014 - 21:38.</div>
    <div class="content">
     <p>I&#39;ve been struggling to get the separated print function to send any legible data to serial so tidied up the serial print statements already present.&nbsp;</p>
<p>I captured the attached serial output just before the sun was fading tonight and I think it is showing what the problem is. (The calculated fields are just before the text &quot;samples&quot; in the attached serial output)</p>
<p>The PV_produced Wh&#39;s are sometimes increasing before the diverted to immersion Wh&#39;s are clicking over to the next full Wh&nbsp;causing the calculated Wh values to increase temporarily before dropping back. The calculations are correct based on the serial outputs and as the Node inputs page just displays the values &#39;as is&#39; they are correct too. This also explains why the Wh accumulator gave errors on the calculated fields but not on the straight Wh fields.</p>
<p>What I need to do now is implement some sort of ratchet function on the calculated fields in the v3 sketch if that&#39;s possible..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22144"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 24/06/2014 - 09:19.</div>
    <div class="content">
     <p>The serial output looks much better. I think the update frequency would of played a large part because the sketch was sending every 2 seconds and again every 10secs&nbsp;on top.</p>
<p>If you removed the older send_rf and moved the calcs&nbsp;out of the case then the results should be more stable and with the improved serial print output it should be easier to follow.</p>
<p>With a lower posting rate the fluctuation should be minimal as at a 10 second post rate the filter won&#39;t kick in unless a 69wh increase is seen (@25k default) and the &quot;late&quot; wh will be counted next post.</p>
<p>How are the results in emonCMS behaving today? are they matching the serial output?</p>
<p>The data values in the serial prints are printed at different times spanning&nbsp;a 2 second interval so the if you were to have the same steadily increasing variable as the 1st and last printed, there would be a change. 2 seconds is quite a large window for the values to change, this was the reasoning behind the &quot;print all at once&quot; statement and the positioning just before the rf_send was to get values relevant to the values received at emonCMS.</p>
<p>If there are still errors at emoncms&nbsp;maybe we should try and get a Serial.print function working,&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22164"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Tue, 24/06/2014 - 13:35.</div>
    <div class="content">
     <p>I have removed the older send_rf statement so at the moment it is only sending at 10 sec intervals.</p>
<p>The errors are continuing today as before.</p>
<p>I understand that the late Wh&nbsp;increases will be caught next time, but if that is causing the calculated value result to momentarily drop then the Wh accumulator will count the same increase twice thus giving the errors I am seeing won&#39;t it?</p>
<p>ie. 3, 3, 3,4,4,4,4 will give 1 Wh increase and 3,3,4,3,3,3,4,4 will give 2 Wh increase with the Wh accumulator.</p>
<p>When I tried to implement the print all at once statement I was getting approximately a ten digit number followed by a load of garbage/ symbols on each line. I&#39;ll have another try this evening to make it work.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22173"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Tue, 24/06/2014 - 21:38.</div>
    <div class="content">
     <p>I did some more modifications to the sketch with mixed results....</p>
<p>1. Separated out the serial print but again it was printing symbols, see screenshot.</p>
<p>2. Modified the calculation to hopefully make sure the result of the calculation never drops. This seemed to be a success but errors eventually started to show. The magnitude of the errors seemed to be much less though I only tested for two hours.</p>
<p>3. Then I took the new calcs outside the case statements so they are only done every 10 secs. Again errors started to show up. On checking the log to feed raw data graph I can see that the results of the calc&nbsp;are still dropping occasionally so the new calc&nbsp;is not right yet. see screenshot2</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22185"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Wed, 25/06/2014 - 14:43.</div>
    <div class="content">
     <p>I think I may have found why the errors are showing up in the Wh&nbsp;accumulator feed...</p>
<p>I noticedthat the Wh accumulator code in process_model.php has a &nbsp; &quot;if ($val_diff&gt;0...&quot; &nbsp; &nbsp; line but not a &nbsp; &nbsp;&quot;if ($val_diff&lt;=0&quot;</p>
<p>I&#39;ve tried to added in the following line: &nbsp; &quot;if ($val_diff&lt;=0 &amp;&amp; $power&lt;$max_power) $totalwh = $last_input[&#39;value&#39;];&quot;</p>
<p>Can anybody tell me if this function is correct and if not let me know the correct way of doing it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22186"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Wed, 25/06/2014 - 19:14.</div>
    <div class="content">
     <p>Been testing and now realise&nbsp; the line I put in the Wh&nbsp;accumulator code whilst completely removing the errors also stops the code behaving as an accumulator meaning a reset of the emontx also resets the Wh accumulator feeds.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22206"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 27/06/2014 - 11:25.</div>
    <div class="content">
     <p>Sorry for not responding, things have been a bit hectic and I&#39;ve not been about much the last couple of days.</p>
<p>I see what you mean about the calculation resulting in a reduction rather than just not increasing until next sample. That reduction would cause a problem I guess.</p>
<p>I think it will always be a possibility as the core wh calculations are spread over the 2 seconds so I guess some sort of mechanism is required if these calcs are done within the sketch. Having said that, while I totally understand the need to calc the positive and negative flows in the sketch, as net wh is not of much use, I can&#39;t help but think the calcs involving more than one feed should be done in emoncms. the feeds in the equation will have passed through wh accumulators and the difference between them should always make sense as per your original findings.</p>
<p>Since PV_used = produced - (immersion + exported) then pv_used is the &quot;unaccounted for&quot; remainder, which may actually turn out to as accurate and robust in emoncms as the wh totals in the sketch count in whole wh units and the energy flow can switch direction anytime, effectively reseting the zero time from which the whole values are counted from, plus the 2 sec spread of readings and any in-accuracy in the power readings will result in some in-accuracy in the wh totals, If each channels wh totals (imp &amp; exp) are accurate and robust then all wh values including those calculated in emoncms should be acurate to within the changes over the last 2seconds at any given time.</p>
<p>We can however, still try and get the results from the v3 if thats what you prefer.</p>
<p>The reason your modification to process_model php causes counting to restart will probally be due to using last_input rather than last_feed, but aside from including the filter I&#39;m not sure the line adds anything as totalwh value would already be equal to $last_feed[&#39;value&#39;].</p>
<p>The spaces before the opening parenthasis could be the cause of the serial print function not working as expected (appologies if it is), You can see similar code is used in the <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/noRF/emonTxV3_DirectSerial/emonTxV3_DirectSerial.ino">emonTxV3_DirectSerial.ino</a> sketch , (I also noticed that sketch only uses spaces rather than csv, I&#39;m not so sure that matters though)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22224"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Fri, 27/06/2014 - 20:12.</div>
    <div class="content">
     <p>The reducing value error is caught by the kWh to kWhd processor but I&nbsp;realize now that modifying the Wh accumulator to do the same is not an option as it would break the Wh&nbsp;accumulators main function which is to preserve the data when emontx resets.</p>
<p>I now also realize that the &quot;errors&quot; are not actually errors just unwanted results caused by data used in the calc arriving sequentially like you said.</p>
<p>I agree that doing the calcs in emoncms based on accumulator feeds would be just as robust but setting this up is a laborious process each time emoncms needs rebuilding as each feed added or subtracted to build the calc needs removing again before the kWh to kWhd&nbsp;process can be added as the last process.</p>
<p>I have been trying to get the sketch to only forward positively incremented values for the calculated variables by comparing a variable value to a &nbsp;previous variable value&nbsp;and am now struggling to figure out why it&#39;s still letting negatively incremented values through.</p>
<p>I just tried the serial.print without the spaces before the parenthesis but it&#39;s still not legible.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22226"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 27/06/2014 - 20:55.</div>
    <div class="content">
     <blockquote><p>I agree that doing the calcs in emoncms based on accumulator feeds would be just as robust but setting this up is a laborious process each time emoncms needs rebuilding as each feed added or subtracted to build the calc needs removing again before the kWh to kWhd process can be added as the last process.</p>
</blockquote>
<p>I&#39;m not at home right now so I can&#39;t confirm this, but I think the kwh&nbsp;to kwh/d process has no effect on the chain, that is although the resulting feed resets each day, the next process in the chain receives&nbsp;the full value, so you could slot it in immediately&nbsp;after each wh accumulator before any calcs.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22227"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Fri, 27/06/2014 - 21:22.</div>
    <div class="content">
     <p>I had the calcs all set up on the &nbsp;inputs of the earlier versions of emoncms but I&#39;ve tried a few times now to set them up in the nodes version and gave up. I forget exactly what the problems where but it was a lot more straightforward to set up with the inputs versions of emoncms.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22228"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 27/06/2014 - 22:05.</div>
    <div class="content">
     <p>I&#39;m not sure why that would be, I still use the input module rather than node module so have no in depth experience&nbsp;of the processing in the nodes module.</p>
<p>The inputs can still be used in exactly the same way as the node module is an alterative rather than a replacement, &nbsp;If you prefer the input module you could try this&nbsp;<a href="5289.html">version of&nbsp;emonhub&nbsp;</a>&nbsp;the node data you would need include in emonhub.conf for your current sketch would be&nbsp;</p>
<blockquote><p>[[10]]<br />
		&nbsp; datacodes = h, h, h, h, l, l, l, l, l, l, l, l, l</p>
</blockquote>
<p>This version decodes the data in emonhub and forwards the data as real numbers, so should be easier to diagnose any custom values, without print statements etc</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22231"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Sat, 28/06/2014 - 10:02.</div>
    <div class="content">
     <p>I&#39;m happy using the nodes input page now I&#39;ve made the switch. It was a decision I put off because of not being able to import historical data, but hopefully someone will produce an import script.</p>
<p>For now I&#39;m going to continue my quest to do the calculations onboard the emontxv3 and keep emoncms&nbsp;lean.</p>
<p>I moved the &nbsp; Serial.print(prev_PV_usedwh_calc); &nbsp;and &nbsp;Serial.print(PV_usedwh_calc); statements to where they would show up what is being stored in the variables and found that nothing was being saved in&nbsp;prev_PV_usedwh_calc.&nbsp;</p>
<p>I then changed the variables from long to static long and the serial output now shows the variable values being saved properly for use in the if else comparison. &nbsp;The sketch now seems to be working as intended but I&#39;ll wait and see how it behaves during the day.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22238"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Sat, 28/06/2014 - 19:25.</div>
    <div class="content">
     <p>Good news, the sketch has worked faultlessly all day, not a single error was recorded, It looks like the issue is solved. Thanks for the help Robert and Paul.</p>
<p>I&#39;ve attached the working sketch in case anybody else wants to use it.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26824"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1039.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/1039.html" title="View user profile.">mattwire</a> on Sat, 17/01/2015 - 20:01.</div>
    <div class="content">
     <p>Hi, thanks for this. &nbsp;I wanted to do the same thing with import/export Wh totals so I&#39;ve included those changes into my version of the emonTx_continuous_watthours sketch here:&nbsp;<a href="https://github.com/mattwire/emonTxFirmware/tree/master/emonTxV2/emonTx_continuous_importexport_watthours_V_temp">https://github.com/mattwire/emonTxFirmware/tree/master/emonTxV2/emonTx_continuous_importexport_watthours_V_temp</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32170"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8314.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nigel91&#039;s picture" title="nigel91&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/8314.html" title="View user profile.">nigel91</a> on Mon, 13/07/2015 - 07:55.</div>
    <div class="content">
     <p>Hello im kinda&nbsp;new here . But i was wondering how can i get the energy reading from the power measurements. I am using the system in a Single Phase System.How do i convert the power readings to a Wh reading.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32173"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Combine Wh readings onboard emontxv3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 13/07/2015 - 16:38.</div>
    <div class="content">
     <p>You cannot convert from one to the other directly. They are different quantities. Power is the rate at which energy is used, in other words the rate of change - the time differential - of energy, energy (Wh) is the power integrated over time.</p>
<p>If you supplier's meter clocks up 3 kWh over a period of 90 mins, your <u>average</u> power over that period is 2 kW. </p>
<p>If you use power at 3 kW for 1 hour, then nothing for &frac12; hour, you've still used 3 kWh over that 1&frac12; hour period. </p>
<p>Therefore you need to measure the power over small periods of time and accumulate the total, taking care of the units as you do so. The sketches on Github with "kwh" in the name do exactly that. You can also do the integration in emonCMS.</p>
<p>[If you want to continue this discussion, it would be better to start a new thread as it's completely off-topic for this one.]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5309"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-au9pLgNm7oc2TRSJZYaUa7cGqmQcjVuoM9HeEfRZkgY" value="form-au9pLgNm7oc2TRSJZYaUa7cGqmQcjVuoM9HeEfRZkgY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/5309 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:58:55 GMT -->
</html>
