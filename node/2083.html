<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2083 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:53:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>rate-of-change process.... | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">rate-of-change process....</h3>
        <span class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sat, 02/03/2013 - 08:17</span>
        <div class="content"><p>I have an input process that looks something like this:</p>
<p>log to feed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&gt; &nbsp;feed1</p>
<p>rate-of-change &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&gt; &nbsp;feed2</p>
<p>x 60</p>
<p>log to feed &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -&gt; feed3</p>
<p>The raw number posted to the input ends up in feed1 ok, and it&#39;s delta from the previous reading ends up in feed2 nicely, but feed3 always remains 0. &nbsp;It&#39;s as if rate-of-change doesn&#39;t pass its result on down the chain. &nbsp;Is it supposed to?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2030.html" class="topic-previous" title="Go to previous forum topic">‹ Why is emoncms.org server doing port scanning of my IP</a>
              <a href="2028.html" class="topic-next" title="Go to next forum topic">[arduino] How to mensure if does current in a wire - UP codes 03-05 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-10224"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sat, 02/03/2013 - 10:02.</div>
    <div class="content">
     <p>I don&#39;t recognise this logic.&nbsp; What is the context?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10228"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 02/03/2013 - 12:32.</div>
    <div class="content">
     <p><span style="display: none;">&nbsp;What is the context?What is the context?</span><span style="display: none;"> What is the context?</span><span style="display: none;"> What is the context?What is the context?</span><em>What is the context?</em> emoncms inputs to the dashboard (eventually).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10233"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sat, 02/03/2013 - 13:52.</div>
    <div class="content">
     <p>OK, thanks (says he, none the wiser).&nbsp;</p>
<p>Mental note to self - stay well clear of the Software forum &#39;cos you won&#39;t understand a word of it!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10253"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sat, 02/03/2013 - 22:58.</div>
    <div class="content">
     <p>Sorry, I should have included more context with my original posting.</p>
<p>The feed is the number of pulses counted in the last 60 seconds. &nbsp;Each pulse represents 1Wh of consumption. The rate-of-change process gives me the delta since the last posting, which represents Wh/min. &nbsp;Multiply that &nbsp;by 60 to get Wh/hr, or Watts.</p>
<p>To further confuse you, I had a typo in my original posting (x6 instead of x60) which I&#39;ll correct once I post this reply.</p>
<p>I&#39;ve got feed2 going to a dial, where I can specify a x60 scale to get it in watts. &nbsp;But I also want to be able to store the x60 value for graphing. &nbsp;So at the moment, my dial represents watts (well strictly average watts over the last 60 seconds), but my graph remains a plot of &quot;pulses per min&quot; which is not so user friendly:</p>
<p><a href="http://emoncms.org/dBCC/tled" title="http://emoncms.org/dBCC/tled">http://emoncms.org/dBCC/tled</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10327"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Delphy&#039;s picture" title="Delphy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by Delphy (not verified) on Wed, 06/03/2013 - 12:30.</div>
    <div class="content">
     <p>While I understand what you are trying to do, I&#39;d like to suggest a (better) approach.</p>
<p>Since 1 pulse = 1 watt hour, then if you only calculate the number of pulses over 60 seconds you don&#39;t get an idea of power spikes within a short period (say, 30 seconds) - instead, only the overall level will go up for that minute.</p>
<p>A better way to do this would be to time the pulses. &nbsp;Here&#39;s some Arduino code that I use:</p>
<p>void onPulse()<br />
	{</p>
<p>&nbsp; //used to measure time between pulses.<br />
	&nbsp; lastTime = pulseTime;<br />
	&nbsp; pulseTime = micros();<br />
	&nbsp;<br />
	&nbsp; // ignore first pulse<br />
	&nbsp; if (lastTime &gt; 0) {<br />
	&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp; //Calculate power<br />
	&nbsp;&nbsp;&nbsp; power = (3600000000.0 / (pulseTime - lastTime));</p>
<p>	&nbsp; &nbsp; //Print the values.<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;PulsePower: &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.println(power,4);<br />
	&nbsp; }<br />
	}</p>
<p>&nbsp;</p>
<p>Basically you time how many seconds (or in this case microseconds) between pulses and divide that by the number of (micro)seconds in one hour * 1000. &nbsp;Then, for each pulse, you log it to emoncms. (I use a python program to read the serial port of the Arduino then send it to the API). &nbsp;It&#39;s better to log per-pulse so you get a better idea on &quot;transient&quot; power spikes (ones that happen very quickly) rather than only doing it on a per-minute feed.</p>
<p>Hope this helps!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10332"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 06/03/2013 - 13:16.</div>
    <div class="content">
     <p>Logging the occurrence of every individual meter pulse sounds like an awful lot of data.</p>
<p>What happens when micros() overflows every 70 mins?&nbsp; Maybe you could use millis() which is good for 50 days.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10346"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 07/03/2013 - 00:12.</div>
    <div class="content">
     <p>Yeh, I&#39;m fast coming to the conclusion that pulse-based stuff is good for tracking what the meter is saying without having to go out and read it, but problematic for any kind of &nbsp;&quot;instantaneous&quot; consumption calculation. &nbsp;</p>
<p>This is particularly true of my water meter that pulses every 5L consumed.</p>
<p>When it ticks at 7am say, there&#39;s no way of distinguishing between someone just drawing out 5L in a rush, or the dishwasher using 4.9L the night before and someone just having a glass of water the next morning, or a slow leak somewhere that finally ticked over at 7am</p>
<p>If you attribute the entire 5L&nbsp;consumption to the 7am sample, you get a spike and it looks like a very big glass of water. &nbsp;If you attribute it to the entire interval since the last tick the night before, then it looks like you&#39;ve got a slow overnight leak. &nbsp;Any of these scenarios are possible and indistinguishable. &nbsp;I guess the best you can get from it is gross usage figures like L/day and then keep any eye out for unusual behaviour.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10350"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 07/03/2013 - 09:55.</div>
    <div class="content">
     <p>Recording each individual pulse is fine, it&#39;s what you then do with all that information that really matters.&nbsp;</p>
<p>I think it&#39;s important to decide up-front what the system needs to do before starting to build it.&nbsp; System design is everything.</p>
<p>(not that I always follow my own advice!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10351"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Delphy&#039;s picture" title="Delphy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by Delphy (not verified) on Thu, 07/03/2013 - 10:01.</div>
    <div class="content">
     <p>You&#39;re probably right &nbsp;about the micros at least. &nbsp;But it&#39;s not that much data - 1 row per data point, at 8 bytes per row (4 bytes for a int and 4 for a float) isn&#39;t that much. &nbsp;Even the index is only another 4 bytes or so. Plus this is only talking about the realtime data - personally I only want to store that for at most 30 days, so I just prune the mysql table using a cronjob once a month. :)</p>
<p>Edit: I totally agree about the point that you have to know up front what you want to do and how much data you want to store! &nbsp;I knew that I only wanted a certain resolution for a certain number of days so for my situation registering per-pulse data is perfectly fine. &nbsp;Your situation could be different. :)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10352"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 07/03/2013 - 10:29.</div>
    <div class="content">
     <p><em>Your situation could be different. :)</em></p>
<p>Yes, I want my PV Router to work as effectively as possible - and record nothing!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10354"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="o_cee&#039;s picture" title="o_cee&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by o_cee (not verified) on Thu, 07/03/2013 - 12:11.</div>
    <div class="content">
     <p>Here&#39;s some code I&#39;ve been working on for my pulse counting: <a href="https://github.com/oscarcarlsson/sensors/tree/master/PulsesEnergyMeter" title="https://github.com/oscarcarlsson/sensors/tree/master/PulsesEnergyMeter">https://github.com/oscarcarlsson/sensors/tree/master/PulsesEnergyMeter</a><br />
	It tries to do some preemptive lowering of power measurements when power is declining.&nbsp;</p>
<p><em>This is particularly true of my water meter that pulses every 5L consumed.</em><br />
	I&#39;ve seen water meters with 85 pulses/liter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10377"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: rate-of-change process....</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 07/03/2013 - 23:16.</div>
    <div class="content">
     <p><em>I&#39;ve seen water meters with 85 pulses/liter.</em></p>
<p>Wow... with a reed switch? &nbsp;If everyone hits the showers at the same time &nbsp;I&#39;ve seen up to about 100L/min flows. &nbsp;That would get that meter chattering away at 142 Hz! &nbsp;I think my pulse counting h/w is only good for about 12Hz on each of 4 channels. Anything faster than that gets sucked up by the debouncing logic.</p>
<p>Your time-decaying averaging code looks good, thanks for the pointer.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2083"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ALfCXMoO66VhtLza5uBEL4riuqj4hd3yI2rVZ1fuC9I" value="form-ALfCXMoO66VhtLza5uBEL4riuqj4hd3yI2rVZ1fuC9I"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/2083 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:53:37 GMT -->
</html>
