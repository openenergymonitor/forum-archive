<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3053 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:57:17 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>you, me, shield and 3 phases of confusion | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">you, me, shield and 3 phases of confusion</h3>
        <span class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Wed, 30/10/2013 - 14:16</span>
        <div class="content"><p>Hello!</p>
<p>I&#39;m new happy owner of <u>emontx Shield</u> that i&#39;ve coupled with current sensor and AC-AC sensor from guys here doing the good work. Also got 4 temp sensor running across muchos&nbsp;cat5 wire.</p>
<p>But I ran into a problem with 3 phases. My house receives 3 phases from the grid, not splitting one into 3 inhouse..</p>
<p>Problem was not apparent when i monitored just one phase but with multiple, i start getting negative and conflicting values.</p>
<p>From what i gather, solution with one ac-ac source is&nbsp;adressed&nbsp;by Glyn in this fine example for emontx:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_CT123_3Phase_Voltage" title="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_CT123_3Phase_Voltage">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_C...</a></p>
<p>&nbsp;</p>
<p>Now, I&#39;m not yet a programmer, more like copy-paste warrior in them interwebs, as much as i can make sense of different parts of code. But trying to mix Glyn&#39;s example for emontx with whats my working base:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxShield/emonTxShield_CT1234_Voltage" title="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxShield/emonTxShield_CT1234_Voltage">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxSh...</a></p>
<p>I&#39;m a little overwhelmed.. shield doesnt define any pins, does tricks by going directly to RF&nbsp;(?) and ...</p>
<p><strong>TLDR</strong>: <strong>In short</strong>, could anybody please find time to copy paste an example together for shield 3 phase (4?) sketch.. using one AC-AC (let&#39;s say on CT1) as a voltage reference for all phases..</p>
<p>Maybe being so nice to point out what parts got replaced with what? :)</p>
<p>In any case, thank you in advance for your time!</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3229.html" class="topic-previous" title="Go to previous forum topic">‹ Error: &#039;send_rf_data&#039; was not declared in this scope</a>
              <a href="3217.html" class="topic-next" title="Go to next forum topic">cant upload sketch on EmonGLCD ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-16040"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 30/10/2013 - 16:02.</div>
    <div class="content">
     <p>There seem to be just two simple problems: you need to take the pin designations from the Shield sketch and plant them in the 3-phase sketch; and you need to keep the calibration constants from the shield sketch.</p>
<p>From memory (I&#39;ve not checked) you don&#39;t need to do anything with the radio - other than get the frequency right.</p>
<p>So basically, for the emonTx, the input pins are</p>
<p>int inPinV = 2;&nbsp;&nbsp; /* Voltage */<br />
	int inPinI1 = 3;&nbsp; /* CT 1&nbsp;&nbsp;&nbsp;&nbsp; */<br />
	int inPinI2 = 0;&nbsp; /* CT 2&nbsp;&nbsp;&nbsp;&nbsp; */<br />
	int inPinI3 = 1;&nbsp; /* CT 3 &nbsp;&nbsp;&nbsp; */</p>
<p>And for the shield these are 0, 1, 2, 3. (You knew that! - Clue: those are the first parameter in &quot;ct1.current(1, 60.606);&quot; etc.)</p>
<p>You need to change the 3 Ical values to 60.6 as a starting value (you&#39;ll change this to calibrate the inputs). It assumes CT1 is on the phase that you measure the voltage of. If you get negative powers on the other phases, swap CT2 &amp; 3.</p>
<p>I think it should work then. Bear in mind phase calibration can be tricky but there are notes in the comments at the top of the sketch.</p>
<p>(BTW, Glyn didn&#39;t write the 3-phase sketch.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16042"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Wed, 30/10/2013 - 16:41.</div>
    <div class="content">
     <p>Thanks for the reply Robert,&nbsp;</p>
<p>I did not know that theses are pins on the ct parameters, the comment states &quot;setup emonTX&nbsp;CT channel&quot; - now i know it means board pin, thank you :)&nbsp;</p>
<p>I will see how far i get with these pointers!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16043"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 30/10/2013 - 16:53.</div>
    <div class="content">
     <p>&quot;I did not know that theses are pins on the ct parameters,&quot;</p>
<p>If you look at the source code for emonLib, it&#39;s actually written out there. You do need to be careful because some methods use &quot;channel&quot; as a route to a pin look-up table that is inside the library (and for emonTx only), the older methods use the pin number directly.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16061"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Thu, 31/10/2013 - 12:10.</div>
    <div class="content">
     <p>grr.. got the sketch together i think but stuck with calibrating.. Put the CT&#39;s onto same 60watt lamp lane and now struggling to get the thing to show the correct values.</p>
<p>Main problem atm is that the calibration page:</p>
<p><a href="../modules/emontx/firmware/calibration.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware/calibration">http://openenergymonitor.org/emon/modules/emontx/firmware/calibration</a></p>
<p>tells me &quot;the expected range for the CT calibration is 109.44 &ndash; 112.78&quot; - but this is for emontx&nbsp;i presume, because shieldtx example comes with the value being set to: 60.606 so there must be totally different resistance in the mix that comes up with this number, but I can not find what is the range for CT for shield.. anyone? please?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16065"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 31/10/2013 - 14:51.</div>
    <div class="content">
     <p>Don&#39;t expect to be able to calibrate with a load as low as 60 W. You are not fully out of the area where random noise is having an influence. The calibration was indeed written for the emonTx - I warned you above that the starting value is about 60. If you follow the maths, you should be able to work out the range for yourself - and learn a bit about it in the process. I don&#39;t know what your max. current is, but you should be calibrating at around 60% of that, or the highest current that you can measure if that is lower.</p>
<p>[Edit: for people who can&#39;t work out what 60.6 &plusmn; 4% is, I&#39;ve added the numbers.]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16078"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 01/11/2013 - 08:52.</div>
    <div class="content">
     <p>I&#39;ve ported the emonTx 3-phase example over the the shield (simple changed the port numbers and calibration). Plesae could you test if it works for you. I don&#39;t have access to three-phase. If it works I will push the example to GitHub</p>
<p>[Edit by RW: This is the standard single-phase sketch, NOT the 3-phase.]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16122"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Sun, 03/11/2013 - 05:14.</div>
    <div class="content">
     <p>Hey Robert, dont be a meanie! I did not know that 60.6 is the middle from what to calculate up and down, now i do, thank you :)</p>
<p>&nbsp;</p>
<p>Will test it out in 24h Glyn, away from home atm, will report back.</p>
<p>Before going away had real trouble getting 1st phase socket to be as precise about that 60w&nbsp;bulb as other 3 are.. no matter what phase reader I used. Could it be that I have really bad &quot;random roll&quot; of resistors as they are 5%.. would it be fine to replace those with 1% parts of same rated resistance? and could those be the trouble makers?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16133"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 03/11/2013 - 12:32.</div>
    <div class="content">
     <p>We had this discussion some time ago, but in a slightly different context: I think if you change the resistors you may see an improvement - even using a different one from the same batch. Changing them to 1% may or may not make a difference, because 1 step of the ADC is around 0.1% and you&#39;re looking at positioning the quiescent input at somewhat better than that. Changing the burden to 1% will improve the certainty of your measurement and reduce the band that the calibration constant occupies. But realise that by far the largest contribution to the error comes from the internal bandgap reference, ~ 11%. That will affect all inputs equally, and if you haven&#39;t calibrated that you might need constants way outside the range mentioned (and in case you are wondering, the <em>stability</em> of the internal reference is a lot better than most other sources so once calibrated all should be well). But I have to reiterate: Depending of course on your voltage and the maximum current that your c.t. expects, 60 W might be 250 mA which is 0.25% of full scale. You&#39;re expecting a lot to measure that with any degree of accuracy with a 10-bit ADC that needs at least 5 bits, preferably &plusmn; 5 bits, to get anywhere near to a decent representation of a sine wave.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16142"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Mon, 04/11/2013 - 00:59.</div>
    <div class="content">
     <p>Let me throw in some background :)</p>
<p>Here sits a guy that does not really know how AC works, who has put together some electric bikes, done some other layman level tinkering with stuff and can clearly see that Robert does what in the poker world is called &quot;overleveling the opponent&quot; - assuming the other guy knows a lot more than he really does and acting based on that assumption :D</p>
<p>I write all that in a good spirit, i&#39;m glad you explain stuff and i&#39;m&nbsp;trying to take away from it as much as I can. Reason that I use 60w&nbsp;pulb is that I do not have AC clamp thingys and thats the first thing around i found with wattage that I think i can somewhat reliably believe in. I have electric heaters and stuff but I&#39;m absolutely not sure if 1500w heater really draws exacly that etc, and no way to make sure. I&#39;m definitely not building my stuff to be monitoring some 60w&nbsp;rates, my house draws stupid amounts of electricity and i&#39;m building it to be in position I would call &quot;if you can measure it, you can improve it&quot;.</p>
<p>Now, I would hope I&#39;m not completly&nbsp;hopless, just that this far i&#39;ve been reading and teaching myself mostly about DC and batteries, related to ebikes&nbsp;etc. Sinewave&#39;s and phase angles on AC stuff.. &quot;holy kittens some deep stuff here&quot; was the first reaction. After buying all parts and running it on 1 phase, I kinda went into checking the wiki and yeah, there&#39;s a lot for me to learn I believe :D</p>
<p>Here&#39;s the result using Glyn&nbsp;example, but thats on the same 60w bulb and one phase, didnt make it to cellar yet. Here you can see how the reading differs from ports. No corrections or calibrations are made for results on this image:</p>
<p><img alt="" src="../../../dl.dropboxusercontent.com/u/7889321/Home-energy/3phaseShieldExampleTest60w.jpg_%3b%20filename_%3dUTF-8%27%273phaseShieldExampleTest60w.jpg" /></p>
<p>From Roberts explanations I now understund that I&#39;m toying around in a really small &quot;spectrum of the AC?&quot; with this 60w load but what i see from other ports are pretty reasonable in my oppinion, just the first port overshoots. I&#39;m using only two clamps atm, designated &quot;C1&quot; and &quot;C2&quot;, third in mail.</p>
<p>Will log some more results tomorrow in the cellar with different source phases!</p>
<p>Oh.. but the theme is confusion and here&#39;s some more of it..</p>
<p>I believe that because I have 4 ports for phases, I can skip the messing around with resistors and other drama on port 1 and use 3, 4, 5. But I can not see on the Glyn example where does it define.. that all calculations for realpower are done using the same power source.. or that port 1 is the reference? is it? no.. the voltage port is.. no, the voltage reading is stored and shifted and.. magic.. atleast on the emontx&nbsp;3phase example.. how did Glyn now manage to do without all that?? I should sleep.. educate me a little more pls.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16144"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 04/11/2013 - 02:21.</div>
    <div class="content">
     <p><em>&quot;Here sits a guy that does not really know how AC works</em>&quot;&nbsp; Go <a href="../buildingblocks.html">here</a> and read the first 2 items listed under &quot;Electricity Monitoring&quot; - S L O W L Y. Don&#39;t rush it, and make sure you&#39;ve understood one before you move on. You may want to quickly scan the 3rd, then read the 4th, which explains your 3-phase supply.</p>
<p>I don&#39;t want to write any more now because you&#39;ll no doubt have a lot of questions from those.<br />
	And let&#39;s leave the 3-phase sketch until you&#39;re happy you know how a 3-phase supply works.</p>
<p>What you&#39;re showing when you move the same c.t. to inputs 2,3 &amp; 4 is the tolerance of the burden resistor. 2, 3 &amp; 4 appear to be reasonably close. 1 does appear to be reading high. Do you have 5% resistors for the burdens ( orange orange black gold) ? If so, my guess would be that you have three that are low and No.1 is high. Your two c.t&#39;s are also different (they can have 3% error). What I would do here is dedicate a c.t. to its own input, put all three on the same wire and adjust the calibration constants so that they all read the same (or as close as seems reasonable) on a reasonable load - significantly bigger than 60 W, like your 1500 W heater. That&#39;s part of the reason why the calibration constants are there, after all.</p>
<p>There&#39;s just one thing I could mention: You&#39;re allowed to lie to c.t&#39;s.&nbsp; If you pass the wire to your 60 W lamp through the c.t. twice, it will measure the current twice and it&#39;ll appear to be a 120 W lamp, three times - 180 W and so on. (You don&#39;t think I actually used 250 A when testing the c.t&#39;s ? ! ! ! ).&nbsp; You will probably find you get much more consistent results at higher powers.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16150"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Mon, 04/11/2013 - 12:08.</div>
    <div class="content">
     <p>Thanks for the links and showing what to read up on, I will do that. Before that, as i&#39;m more hands-on guy I jumped to my board and discovered, that resistors I got with the kit are actually 1% ones.. hmm, I bought the kit from this site, didnt use any of my own parts, mby should have said that earlier. (here&#39;s a linkie of me putting it together!&nbsp;<a href="http://www.youtube.com/watch?v=1roh8-MZ_pI">http://www.youtube.com/watch?v=1roh8-MZ_pI</a>&nbsp;)</p>
<p>Now, i did not find on wiki or schematic page what resistors do you mean by &quot;burden resistors&quot; exactly, I assumed the three behind the CT1 port? 33R 470K 470K? ( <a href="http://solderpad.com/openenergymon/emontx-shield/">http://solderpad.com/openenergymon/emontx-shield/</a> )</p>
<p>I dont see any other resistors coming in parts of 4 to be port exclusive so like by process of elimination i assume nothing else could be difference maker in here? The 10u capacitor is the only other part but that.. cant make for the reading error i think. Guess I should remove the three and check them out with a tester, maybe there&#39;s a faulty one in the patch?</p>
<p>* fixed links</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16156"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 04/11/2013 - 14:55.</div>
    <div class="content">
     <p>The burden resistor is specifically the one that is connected across the c.t. secondary - the 33 &Omega; in your case. (It is the one that provides a load - &#39;burden&#39; to the c.t.&nbsp; In the good old days before electronics, the burden would have been a meter - a moving iron ammeter or the current coils of a wattmeter.&nbsp; The 2 x 470 k&Omega; are the &quot;bias&quot; resistors that set the quiescent working point to half-supply voltage. The 10 &micro;F capacitor bypasses the bias resistors - it gives a near short-circuit to a.c. and connects the &quot;earthy&quot; end of the c.t. to ground.</p>
<p>I was a bit surprised you said 5% because I thought all the kit resistors were 1%. I would not risk damaging the board by trying to unsolder anything. If you read approx. half the supply voltage (= 1.65 V) at the junction of the two 470 k&Omega; resistors, that&#39;s good enough. It doesn&#39;t have to be exact. The 33 &Omega; is probably more accurate than your meter on that range, so measuring that will not prove anything - we know from the numbers it&#39;s not all that far out.</p>
<p>Have you tried a higher current to see what the match is like then?&nbsp; You haven&#39;t said which c.t. you are using, I&#39;m assuming it is the 100 A YHDC SCT-013-000, and you haven&#39;t said what your system voltage is either, so I&#39;m assuming 240 V. (Power means nothing to a c.t. - it only knows about current!)</p>
<p>If you really want to know how the errors build up, there&#39;s <a href="https://learn.openenergymonitor.org/?redirect=emontx-error-sources">this</a> to read. I don&#39;t think you necessarily have a faulty component in there, I think it is simply a case that the tolerances have added up badly.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16162"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Mon, 04/11/2013 - 21:58.</div>
    <div class="content">
     <p>Robert, the voltage on my screenshot above is shown on each line. And i&#39;m indeed using yhdc sct&#39;s.</p>
<p>Desodlered&nbsp;burden resistor, checked, seemed fine. 33.1, put it back together again. -- readings went better.. not sure what was the cause, maybe the foami thing i used under the arduino .. anyway, got them somewhat balanced now cheating with dual-triple loops on 60w. I still do not understand complicated stuff about how the math actually goes, but calibration numbers are beating me..</p>
<p>Initially for shield they are 60.606 - that reads about correct, now.. isnt&nbsp;it one number &quot;60.606&quot; but somehow two values for some equasion like 60 and 606 ?? because I ended up on 57.586 giving me closest to 180w (triple loop) like ~183, but if i changed it to 57.566 it is jumping up to ~187 ... whats the logic here..</p>
<p>Results with Glyn example:</p>
<p><img alt="" src="../../../dl.dropboxusercontent.com/u/7889321/Home-energy/3phaseShieldExampleTest2-120w.jpg_%3b%20filename_%3dUTF-8%27%273phaseShieldExampleTest2-120w.jpg" /></p>
<p>switching CT to another phase gives false readings.. please advise. Needs some voltage storing phase shifting magic i think..</p>
<p>I also tried some self copy pasted fixed version of the emontx sketch, similar results, difference was that it&#39;s results had negative value.</p>
<p>&nbsp;</p>
<p>forgot to explain: changes in example sketch I made -- disabled CT4 and pasted in my temperature stuff (last 4 numbers)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16168"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 05/11/2013 - 02:11.</div>
    <div class="content">
     <p><em>&quot;maybe the foami thing i used under the arduino&quot; </em></p>
<p>You should not have anything under the Arduino. If you mean the black anti-static foam that the chips are packed in, that conducts electricity and it is anyone&#39;s guess what that will do to your readings. You must not have that around once the I.Cs are inserted in their sockets on the PCB.</p>
<p>If you read the current on one phase and the voltage from a different phase, the rms current and rms voltage will be read correctly (of course) and the apparent power (VA) will read correctly too, but the real power will be seriously wrong because of the phase shift of 120&deg; between the two waves. You have read the 3-phase article now, haven&#39;t you? What you need to do is explained towards the end of that piece, and that&#39;s what the 3-phase sketch does.</p>
<p><em>&quot;self copy pasted fixed version of the emontx sketch</em>&quot;</p>
<p>I don&#39;t understand what that is.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16188"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Wed, 06/11/2013 - 01:24.</div>
    <div class="content">
     <p>&quot;self copy pasted fixed version of the emontx sketch&quot; - that was the sketch i copy pasted together from emontx 3phase sample and your pin teaching above at the thread start.</p>
<p>I managed to get that &quot;monster&quot; to measure correct numbers:</p>
<p><img alt="" src="../../../dl.dropboxusercontent.com/u/7889321/Home-energy/3phaseTest4.JPG_%3b%20filename_%3dUTF-8%27%273phaseTest4.JPG" /></p>
<p>current 3 should be 120w so i got it pretty close, you can see settings of sketch for calibration too.. 3rd CT still havent arrived so I&#39;m messing with two atm.</p>
<p>&nbsp;</p>
<p>Now the Glyn example results following: (and made me reverse the current 3 CT on phasewire&nbsp;vs &quot;emontx&quot; sketch running previously)</p>
<p><img alt="" src="../../../dl.dropboxusercontent.com/u/7889321/Home-energy/3phaseTest3.JPG_%3b%20filename_%3dUTF-8%27%273phaseTest3.JPG" /></p>
<p>It seems to be missing a &quot;double&quot; ? I can not get it to show 120w in 0.0 to 2.0 phasecal value. But it does show pretty accurate 60w&nbsp;(half) at 0.2 phasecal for that phase.</p>
<p>Need coding help, thread first post has the link for sketch that contains the math required for this doulbe trick i believe.. not sure i can manage to sort it out and put into right place</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16198"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 06/11/2013 - 12:16.</div>
    <div class="content">
     <p>I can&#39;t interpret what your problem is now. Post the sketch you are using as a file attachment and say exactly where your voltage monitor is and where your c.t&#39;s are.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16207"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Wed, 06/11/2013 - 20:49.</div>
    <div class="content">
     <p>sorry, english is not my first language, i can be hard to understand at times, i&#39;m sure.</p>
<p>What i ment is, using the emontx 3phase code mixed for shield, i got the correct reading, look at Current 3 on first screenshot. Thats running on different phase through doublecheat 60w lamp, that is 120w.- this is correct.</p>
<p>Attatched under : emonTxShield_CT1234_3Phase_VoltageTemp.ino</p>
<p>The second screenshot, third column is phase 3, running through same loop and not reading 120w but 60w, using glyn posted sketch as a source, attatched under: PhaseExShield_CT1234_Voltage.ino</p>
<p>So my understanding is, that the Glyn example for shield above is missing a doubling.. variable..?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16208"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 06/11/2013 - 23:21.</div>
    <div class="content">
     <p>OK, I can see the sketches. Thanks.</p>
<p>At this time, I am <u>only</u> looking at the sketch &quot;PhaseExShield_CT1234_Voltage.ino&quot;</p>
<p>This is a single-phase sketch and you must have the three c.t&#39;s on the same phase as the voltage measurement. If you do not, you will get results that are wrong. To understand why, you need to know how the sketch measures real power: It measures the instantaneous voltage and current, multiplies them together to get the instantaneous power, and then does that for 10 cycles (20 crossings) of mains (0.2 s). Then it calculates the average power over this time. If the voltage wave and the current wave belong to the same phase, that will be the correct answer. Now look at the diagrams <a href="https://learn.openenergymonitor.org/?redirect=3-phase-power">here</a> and if you imagine the current is the red phase and the voltage is the blue phase, you can see that because the waves are 1/3 cycle out of step, you are multiplying the wrong two numbers together each time and you will get the wrong answer.</p>
<p>I cannot see a mistake in the sketch so if your c.t. &quot;phase 3, running through same loop and not reading 120w but 60w,&quot; was on the same cable as the voltage sensor, then there is a fault somewhere that must be found and corrected before you try to get the three-phase sketch working.</p>
<p>To get your three-phase sketch working, I need to know what is your mains frequency, 50 Hz or 60 Hz?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16209"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4446.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4446.jpg" alt="xmasta&#039;s picture" title="xmasta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/4446.html" title="View user profile.">xmasta</a> on Wed, 06/11/2013 - 23:45.</div>
    <div class="content">
     <p>I&#39;m from Estonia and.. googling around found this page that lets me believe we are at 50hz -&nbsp;<a href="http://www.mainsfrequency.com/">http://www.mainsfrequency.com/</a></p>
<p>I&#39;m not sure did you miss Glyn&#39;s&nbsp;post? :) It is 7th in this thread, that is why I&#39;m even messing around with that shield sketch you looked at.</p>
<p>And I dont have any trouble getting readings for one phase working, I&#39;m, as the thread name states too, messing around to get a shield sketch going for 3 phase system, using one voltage reader on phase 1 :)</p>
<p>From the screenshots above you can see I got correct reading with emontx 3phase&nbsp;messy sketch.</p>
<p>I&#39;m always measuring voltage from 1st phase and there is no problem with ct&nbsp;or realpower on it, what I&#39;m failing at is trying to make Glyn&#39;s&nbsp;sketch to do the same 3 phase trick :) Reading voltage from 1st phase and then phaseangling it around for calculations with ct&#39;s on second and third phase for realpower.</p>
<p>Hope this made things clearer and thanks for helping me :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16226"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 07/11/2013 - 17:36.</div>
    <div class="content">
     <p>Thank you for explaining. I have FINALLY realised what has happened. I am sorry it took me so long:</p>
<p class="rteindent1">Submitted by glyn.hudson on Fri, 01/11/2013 - 08:52.</p>
<p class="rteindent1">I&#39;ve ported the emonTx 3-phase example over the the shield (simple changed the port numbers and calibration). Plesae could you test if it works for you. I don&#39;t have access to three-phase. If it works I will push the example to GitHub</p>
<p class="rteindent1">Attachment Size<br />
	emonTxShield_CT1234_Voltage.tar.gz&nbsp; 2.41 KB</p>
<p><em><strong>That is not a 3-phase sketch, it is the single phase sketch!</strong></em>&nbsp; It will <u>never</u> work for 3 phases because it does not have the array to record the voltage and &#39;play it back&#39; 8 and 17 samples later for the second and third phases. It also explains why your current on phase 2 is half what it should be and negative - that is exactly the value I expect when the c.t. is on the wrong phase.</p>
<p>I cannot believe Glyn made that mistake - but he has. Over the next day or two, I shall port the original 3-phase sketch for the Shield, but it will be almost exactly the same as your port so you should use that. When I&#39;ve done that and tested it, I&#39;ll send it to Glyn and I&#39;ll tell him (away from the forum!).</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16444"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="promy&#039;s picture" title="promy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by promy (not verified) on Mon, 25/11/2013 - 21:34.</div>
    <div class="content">
     <p>I would also like to monitor&nbsp;my 3 Phase installation with 3xCT and 1x voltage sensor.</p>
<p>Am I correct that the files on the git&nbsp;in the dir &quot;emonTxFirmware / emonTxV2 / emonTx_CT123_3Phase_Voltage&quot; (changed november 8 2013) are the correct&nbsp;and latest ones I should use?</p>
<p>I&nbsp;build&nbsp;my own emonTx around a meduino nano (3.3V 16MHz Mega328 arduino comatible board) with 3 CT sensors and 1 voltage sensor.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16445"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 25/11/2013 - 22:43.</div>
    <div class="content">
     <p>Is this <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/emonTx_CT123_3Phase_Voltage/emonTx_CT123_3Phase_Voltage.ino" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/emonTx_CT123_3Phase_Voltage/emonTx_CT123_3Phase_Voltage.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2...</a> the sketch you mean?&nbsp; I have not been involved with any changes so I cannot comment on whether this sketch will work unchanged on your hardware. If you will not be using the emonTx, then you must either change the ports in the sketch to match your new hardware, or build your hardware to match the emonTx.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16446"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: you, me, shield and 3 phases of confusion</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 25/11/2013 - 23:52.</div>
    <div class="content">
     <p>I posted a sketch <a href="2917.html">here</a> on 17/10/13 which provides four continuous sets of real power measurements (two on each of the phases that are being measured).&nbsp; All six analogue inputs are sampled in turn: voltage on two phases, and four current.&nbsp; The resulting power values are dispatched by RF with no interruption of the sampling process.</p>
<p>It would not be difficult to change this to three voltage and three current measurements.&nbsp; That would allow three continuous measurements of real power, one on each phase.</p>
<p>When using all six of the analogue inputs in this way, the emonTx hardware is not well suited for this task.&nbsp; But the alternative hardware that I posted should be fine, with minor changes as necessary.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3053"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-cZ2GGNfwZBg_zaN7c5LYiqhKchRDZI9i6CWaPDdG2kI" value="form-cZ2GGNfwZBg_zaN7c5LYiqhKchRDZI9i6CWaPDdG2kI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/3053 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:57:19 GMT -->
</html>
