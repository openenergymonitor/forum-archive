<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11990 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:44:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>LightWaveRF as a data source to EmonCMS | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">LightWaveRF as a data source to EmonCMS</h3>
        <span class="submitted">Submitted by <a href="../user/9288.html" title="View user profile.">j0hngi11am</a> on Thu, 14/01/2016 - 17:56</span>
        <div class="content"><p>Hi I&#39;m new to the forum but I have been using emon for a while - I have also been looking (and purchased) some more LiightWaveRF devices. Beyond the works done with MQTT to switch lightwave devices on and off has anyone looked at / interested in pulling data from devices (radiator valves / thermostats) into Emon?</p>
<p>I have done some research looking at requesting / listening for data (easiest is UDP) - responses are JSON and I figured (because I&#39;m not a software developer!) it should be reasonably easy to pick the data from the lightwave link (via UDP) and strip the JSON for teh values needed and then post to emon as a feed???</p>
<p>My ultimate aim is to get to the real time OpenBEM running using these feeds + using the intelligence from the feeds to proactively control the heating.</p>
<p>I can post my current findings / info .. i&#39;m hitting a wall due to my lack of programming skills :-)</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11994.html" class="topic-previous" title="Go to previous forum topic">‹ House setup - what to do with pv excess</a>
              <a href="5825.html" class="topic-next" title="Go to next forum topic">Project announcement: Energy monitor light ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-38262"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LightWaveRF as a data source to EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Thu, 14/01/2016 - 21:35.</div>
    <div class="content">
     <p>There is a Lightwaverf node in node-red <a href="https://www.npmjs.com/package/lightwaverf" title="https://www.npmjs.com/package/lightwaverf">https://www.npmjs.com/package/lightwaverf</a> so you can probably create a flow into emoncms via MQTT.&nbsp; Note some other posts if you want to use JSON. I&#39;m doing just this with an Edimax smartplug.</p>
<p>Sorry this is just a nodejs module.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38273"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9288.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="j0hngi11am&#039;s picture" title="j0hngi11am&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: LightWaveRF as a data source to EmonCMS</h3>

    <div class="submitted">Submitted by <a href="../user/9288.html" title="View user profile.">j0hngi11am</a> on Fri, 15/01/2016 - 09:35.</div>
    <div class="content">
     <p>thanks for the link I will check that out,&nbsp;I made some progress last night with some very basic python. I can make a request of the lightwavelink (LWL) for a specific device and wait for the response and pull out the value.&nbsp;</p>
<div>I&#39;m just looking at how to take the&nbsp;value from the JSON string and reform them to do a url post to the emonCMS&nbsp;</div>
<div>&nbsp;</div>
<div>e.g. the full JSON string would be (below is the &#39;print&#39; result from json.loads)</div>
<div>
<p>{u&#39;prod&#39;: u&#39;tmr1ch&#39;, u&#39;ver&#39;: 33, u&#39;output&#39;: 100, u&#39;prof&#39;: 5, u&#39;cTarg&#39;: 22.0, u&#39;nTarg&#39;: 18.5, u&#39;state&#39;: u&#39;run&#39;, u&#39;cTemp&#39;: 19.3, u&#39;mac&#39;: u&#39;20:37:1D&#39;, u&#39;batt&#39;: 3.22, u&#39;time&#39;: 1452849394, u&#39;router&#39;: u&#39;20371D&#39;, u&#39;serial&#39;: u&#39;F46C02&#39;, u&#39;trans&#39;: 806, u&#39;type&#39;: u&#39;temp&#39;, u&#39;nSlot&#39;: u&#39;10:00&#39;}</p>
<p>I want to pull out the keys cTarg cTemp batt time&nbsp;</p>
<p>then reform them to a&nbsp;http://172.16.44.149/input/post.json?time=1452849394&amp;node=1&amp;json={cTarg:22, cTemp:19.3, batt:3.22}@apikey=xxxxxxx</p>
<p>​</p>
<p>is this easy to do?? I have been googling around and I can&#39;t find a straight forward help on&nbsp;</p>
<p>how to extract just a few keys needed, then contrstuct the url...&nbsp;</p>
<p>this is the basic script to listen:</p>
<blockquote><pre>
import socket
import json

UDP_IP_LISTEN = &quot;172.16.44.149&quot;
UDP_PORT_LISTEN = 9761

sock = socket.socket(socket.AF_INET, # Internet
                      socket.SOCK_DGRAM) # UDP
sock.bind((UDP_IP_LISTEN, UDP_PORT_LISTEN))

counter = 0
while True:
     data, addr = sock.recvfrom(1024) # buffer size is 1024 bytes
     if data[0][0] != &quot;*&quot;:
       print &quot;!&quot;
     else:
       json_string = data[2:]
       if &#39;prod&#39; in (data):
    parsed_json = json.loads(json_string)
    print parsed_json #prints the full JSON
    print parsed_json[&#39;cTemp&#39;] #prints just the value for key cTemp
</pre></blockquote>
<p>​and this is the script to make the requests:</p>
<blockquote><pre>
import socket
import json
import time

#list of devices
device = &quot;R2Dh&quot;
#this is the code you received when pairing this device

LWL_PAIR_CODE = &quot;666&quot;
RANDOM = &quot;123&quot;
BANG = &quot;!&quot;
LWL_REQ = &quot;F*r&quot;

#Send
UDP_IP_SEND = &quot;172.16.44.148&quot;
UDP_PORT_SEND = 9760
MESSAGE = LWL_PAIR_CODE + &quot;,&quot; + RANDOM + &quot;,&quot; + BANG + device + LWL_REQ
print &quot;UDP target IP:&quot;, UDP_IP_SEND
print &quot;UDP target port:&quot;, UDP_PORT_SEND
print &quot;message:&quot;, MESSAGE

sock = socket.socket(socket.AF_INET, # Internet
                      socket.SOCK_DGRAM) # UDP
sock.sendto(MESSAGE, (UDP_IP_SEND, UDP_PORT_SEND))

n = 15
sum = 0
counter = 1
while counter &lt;= n:

    sum = sum + counter
    counter += 1
    print &quot;message:&quot;, MESSAGE
    print &quot;counter:&quot;, counter

    sock = socket.socket(socket.AF_INET, # Internet
                      socket.SOCK_DGRAM) # UDP
    sock.sendto(MESSAGE, (UDP_IP_SEND, UDP_PORT_SEND))

    print &quot;sleeping...&quot;
    time.sleep(5)

</pre></blockquote>
</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11990"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-1G28GuYOKGrOoMhR5YZ9RUp3-iZv8fo33tjttCM7jME" value="form-1G28GuYOKGrOoMhR5YZ9RUp3-iZv8fo33tjttCM7jME"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/11990 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:44:07 GMT -->
</html>
