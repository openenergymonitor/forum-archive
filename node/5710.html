<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5710 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:54:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Elster A1100 IRDA emontx v2 Help... | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Elster A1100 IRDA emontx v2 Help...</h3>
        <span class="submitted">Submitted by <a href="../user/6780.html" title="View user profile.">ewiandr</a> on Fri, 05/09/2014 - 09:35</span>
        <div class="content"><p>Has anyone been able to read the IRDA port of an Elster A1100 with a emontx V2 Yet?</p>
<p>If so how did you do it?</p>
<p>I tried the A100c version from this site but it doesn&#39;t work...</p>
<p>Thanks</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12426.html" class="topic-previous" title="Go to previous forum topic">‹ local data logging - no data recorded</a>
              <a href="12418.html" class="topic-next" title="Go to next forum topic">EMONTH slow response ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-28630"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Fri, 13/03/2015 - 11:06.</div>
    <div class="content">
     <p>How far did you get with&nbsp;the A1100? &nbsp;Was there any IR? &nbsp;Did the code you tried&nbsp;receive any data, but was just unable to parse it?</p>
<p>I&#39;m trying to get data out of a couple of A1100s using a couple of different&nbsp;USB&lt;-&gt;IRDA&nbsp;dongle under Linux&nbsp;(since that&#39;s what I had lying around)&nbsp;but haven&#39;t had any luck, yet. &nbsp;Looking at the datasheet, it has three configurable baud rates - 2400, 4800 (non-standard for IrDA?) or 9600.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29616"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Wed, 15/04/2015 - 15:48.</div>
    <div class="content">
     <p>I think the A1100&nbsp;doesn&#39;t have a bright&nbsp;enough Infrared output LED to trigger the TSL261R&nbsp;photo sensor when using Dave Berkeley scheme and&nbsp;the circuit which was linked from the A100C.</p>
<p>Another possibility is that it uses&nbsp;a slightly different wavelength (<a href="https://en.wikipedia.org/wiki/Infrared_Data_Association" title="https://en.wikipedia.org/wiki/Infrared_Data_Association">https://en.wikipedia.org/wiki/Infrared_Data_Association</a> says IrDA&nbsp;uses 850nm to 900nm. &nbsp;The peak response for the TSL261R is 940nm according to the datasheet, and sensitivity is 70% lower at 850nm than it is at 940nm.</p>
<p>At my best guess, the output from the Elster looked at least an order of magnitude&nbsp;dimmer than an infrared remote control when viewed with my Moto G camera phone.</p>
<p>Interestingly I have a Nokia phone who&#39;s IrDA output is completely invisible with the Moto G camera, but again no idea if that&#39;s down to brightness or &quot;colour&quot; (wavelength) of IR light.</p>
<p>My analog electronics is weak (and my digital only a bit better), but I thought I might be able to do something with the Atmega328&#39;s&nbsp;analogue comparator (either using a voltage divider, or the bandgap output, or even one of the analogue outputs with suitable smoothing connected back to the comparator) to set the threshold.</p>
<p>Any thoughts from any electronics people?</p>
<p>Tim.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29617"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Wed, 15/04/2015 - 16:08.</div>
    <div class="content">
     <p>Does this sound viable:</p>
<p>Feed the output of the photo sensor into an RC network (with relatively high input resistance to the RC network), to establish a &#39;base&#39; voltage. &nbsp;Use this voltage (via a divider to lower it slightly) as one of the Atmega&nbsp;analogue comparator inputs.</p>
<p>Simultaneously feed the photo sensor output into the other input of the analogue comparator, that way it should be able to detect relative intensity instead of absolute intensity, and thus increase the sensitivity of the infrared detector.</p>
<p>?</p>
<p>Cheers,</p>
<p>Tim.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29619"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 15/04/2015 - 16:16.</div>
    <div class="content">
     <p>Going by your OP you&#39;ve&nbsp;seen the &quot;<a href="626.html">Reading IrDA data from an Elster A100C electricity meter</a>&quot; thread and the links from that page. Did you also see the &quot;<a href="6143.html">Using TinyTX and LDR to measure Watt on my power meter</a>&quot; thread, Just confirming a change can be detected and then establishing the min and max voltages&nbsp;should&nbsp;help&nbsp;establish if it&#39;s going to be readable. I&#39;m no expert but if you can see it with a camera (at all) I would expect it to be readable unless it streams data at some ridiculous&nbsp;speed of course but even that should still be detectable even if not readable I would of thought.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29623"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Wed, 15/04/2015 - 20:15.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Thanks for your reply. &nbsp;I suspect the pulse durations may be too short for the LDR.</p>
<p>I created a sketch which toggles the onboard Arduino LED state on change of state of pin 2, and using the photo sensor connected to the arduino as per the A100c circuit. &nbsp;This could detect my infrared remote control at a distance of up to about 10&nbsp;centimetres. &nbsp;I couldn&#39;t detect the output of an IrDA&nbsp;USB dongle or that of the Nokia phone.</p>
<p>I then changed the circuit to use the UNO&#39;s analogue comparator, and made one input (arduino&nbsp;digital pin 6) 0.7v using a resistor network. &nbsp;The other input of the comparator (setup to be digital pin 7)&nbsp;was wired to the photo sensor. &nbsp;Now it will detect the same infrared remote at up to about 2 metres. &nbsp;Promisingly, it now also detects&nbsp;the IrDA dongle, but still not the Nokia. &nbsp;As I can see the IrDA dongle with the Moto G phone camera (and also see that it&#39;s substantially dimmer than this remote), hopefully it&#39;ll be good enough for the Elster&nbsp;A1100 as well... &nbsp;To complicate matters further,&nbsp;I don&#39;t have the Elster meter here -&nbsp;it&#39;s over the other side of town!</p>
<p>I took a quick look at the EmonShield schematics, and it looks like this approach won&#39;t work with that, unless you have no radio on the board (as one of the comparator inputs DIG6&nbsp;aka AIN0&nbsp;is wired to the radio). &nbsp;You can however tell it to use the internal 1.1v reference instead of dig6, which might be good enough (and I&#39;ll try that too).</p>
<p>Perhaps you could shift&nbsp;GND for the photo sensor up toward the 1.1v reference voltage&nbsp;to improve sensitivity, dunno...</p>
<p>Tim.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29624"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Wed, 15/04/2015 - 21:06.</div>
    <div class="content">
     <p>I wondered about something like the attached to drive the comparator?</p>
<p>The idea is to be sensitive to small pulses, but also to automatically adapt to background light levels.</p>
<p>The idea is that one of the comparator inputs ends up at the averaged-over-time&nbsp;output of the opto sensor, on the basis that the sending LED is mostly off (IrDA&nbsp;SIR&nbsp;sends baseband&nbsp;serial comms&nbsp;with a shortened pulse I believe, and also the LED only sends one short burst of traffic every few seconds).</p>
<p>The other input&nbsp;gets its the instantaneous value instead, dropped slightly by the series diode (dunno if R3 is needed or not?). &nbsp;The diode would need a suitably low forward voltage drop (maybe a germanium or&nbsp;shottky diode?).</p>
<p>Any good?</p>
<p>I think I&#39;ll try out the circuit I already have up (using a simple divider for the comparator instead) first...</p>
<p>Tim.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29625"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 15/04/2015 - 21:06.</div>
    <div class="content">
     <p>If the pulse train is more or less continuous, one way to pull pulses out is to use an integrator to detect the average level and a comparator. The comparator has the raw pulse input for one input and the integrator output for the other, the idea being that if the voltage from your photodiode (or whatever) drifts with temperature, ambient light or anything else, the integrator tracks the slowly changing average value and the comparator switches on the pulses superimposed on it. (I.E. the comparator switches as the pulse crosses the average value, not as it crosses any specific voltage.) </p>
<p>If the pulse train isn't continuous, this is liable to produce a train of random pulses generated from the noise in the circuit.</p>
<p>[You posted while I was typing!  Something like that, except you might have a resistor or two too many in there.]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29626"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Wed, 15/04/2015 - 21:15.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Thanks for your reply - I think that&#39;s roughly&nbsp;what I had in mind (and we both posted at about the same time). &nbsp;Do you think the circuit I sketched out is any cop? &nbsp;I&#39;m assuming it&#39;s OK to drive a bit of voltage back into the sensor output (which would happen if the ambient light levels drop whilst the cap discharged through R1). &nbsp;If that&#39;s not acceptable, then perhaps it could do with an extra diode in series with R2, and then another resistor in parallel with the cap?</p>
<p>TSL261R datasheet is here BTW -&nbsp;<a href="http://roborugby.ucd.ie/docs/Taos-TSL260R.pdf">http://roborugby.ucd.ie/docs/Taos-TSL260R.pdf</a></p>
<p>Cheers,</p>
<p>Tim.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29632"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 15/04/2015 - 23:43.</div>
    <div class="content">
     <p>You probably do need a bit of hysteresis, too much and you kill it stone dead if the output amplitude is low, but if it's greater than the noise, then you don't have the problem when there are no pulses. (This depends on what you meter outputs, and when. If it responds to interrogation, then you probably need to provoke some output - any output - to set the integrator and then enable the input before you send the command to emit the data you want; then shut down the input when complete.)</p>
<p>I think for speed reasons I'd go for a discrete component front end, delivering pulses that you can read with a digital input, rather than use an analogue input as a comparator, though I might be over-cautious here.</p>
<p>I know I've seen a working circuit with values on it, I'll try to find it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29661"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Thu, 16/04/2015 - 13:03.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Thanks for the reply.</p>
<p>The Elster A1100&#39;s&nbsp;sending LED is mostly off, it does something like:</p>
<p>1 Send a train of pulses which are (I believe) IrDA SIR - which is effectively just RS232&nbsp;comms with a short IR pulse on each rising (I think) edge. &nbsp;The train lasts about 1 second, and can be seen flickering using the phone camera. &nbsp;I think the LED should be lit for less than 25% of the time during this period.</p>
<p>2. Send nothing (i.e. LED off) for about 5 seconds.</p>
<p>3. Repeat.</p>
<p>The meter needs no setup or other&nbsp;provocation to do this, and is the default operation mode on these meters (same as with the Elster A100C).</p>
<p>So I&#39;d guess the overall duty of the LED I&#39;m trying to read is going to be&nbsp;under 5% (possibly well under), and the integrator can probably work over a number of seconds</p>
<p>The ATmega&#39;s&nbsp;built-in comparator is effectively a digital input - in the mode I&#39;ve set it up, you read a register, and you get a &#39;1&#39; if the voltage on D6 is greater&nbsp;than the voltage on D7, and a &#39;0&#39; otherwise. &nbsp;You can also trigger an interrupt on change of the comparator output (on rise, or on fall, or on both transitions).</p>
<p>Page 235 of&nbsp;http://www.atmel.com/images/Atmel-8271-8-bit-AVR-Microcontroller-ATmega48A-48PA-88A-88PA-168A-168PA-328-328P_datasheet_Complete.pdf gives the details:</p>
<p>In section 23.3.2 &quot;&bull; Bit 5 &ndash; ACO: Analog Comparator Output<br />
The output of the Analog Comparator is synchronized and then directly connected to ACO. The synchronization<br />
introduces a delay of 1 - 2 clock cycles. &quot;</p>
<p>... so directly reading the output using a read and binary arithmetic&nbsp;is probably faster than reading the digital ports using the Arduino&nbsp;digitalRead() function (since digitalRead() will&nbsp;probably get compiled to several more&nbsp;instructions vs. just reading the register and doing the necessary&nbsp;binary arithmetic).</p>
<p>I&#39;m trying to keep my component count down (because of&nbsp;time pressure and ease of construction rather than expense)!</p>
<p>I&#39;ve got a circuit working with a cap and 3 resistors - will post when I&#39;ve put it through its paces a bit...</p>
<p>Cheers,</p>
<p>Tim.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29666"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Thu, 16/04/2015 - 21:02.</div>
    <div class="content">
     <p>This circuit seems to work surprisingly well. &nbsp;The infrared remote control works if you bounce it off a couple of walls, and the IrDA devices all work from more than&nbsp;a metre away. &nbsp;Performance is better in low light, but also works in quite bright conditions.</p>
<p>I&#39;ve just swapped out R1 for a 4.7k Ohm resistor, as it seems that one of the monitors at my desk is bloody noisy in near IR, and neither my circuit nor the IrDA to USB dongle that I&#39;m using to test will work when they&#39;re looking at it.</p>
<p>Changing R1 to 4.7k to make the circuit less sensitive seems to improve matters a lot. &nbsp;Increasing the value of R3, or increasing the capacitance&nbsp;of C1 would probably also help (depends on the frequency of the IR noise).</p>
<p>One of the comparator inputs gets a smoothed time-averaged version of the opto sensor output.</p>
<p>The second&nbsp;comparator input gets a reduced voltage version of the opto sensor&#39;s instantaneous output.</p>
<p>With no light the second comparator input is lower than the first. &nbsp;A pulse raises the voltage of the second comparator input, and if it exceeds the voltage of the first comparator input then we can read that as a digital signal in the ATmega.</p>
<p>Solved the Nokia mystery too - they don&#39;t speak unless they&#39;re spoken to (despite the flashing IR transmit icon on their LCD display!) - but if they detect incoming IrDA enquiry then they reply, and this circuit seems to detect that too...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29667"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Thu, 16/04/2015 - 21:10.</div>
    <div class="content">
     <p>I&#39;m using the onboard LED to debug with this sketch:</p>
<pre>
// From <a href="http://forum.arduino.cc/index.php?topic=149840.15" title="http://forum.arduino.cc/index.php?topic=149840.15">http://forum.arduino.cc/index.php?topic=149840.15</a>
/* On board LED connected to Pin 13

Adapted by Tim Small from code 
created 27 Feb 2013
by Anthony Fremont

*/

void setup() {
   // initialize serial communications at 9600 bps:
   Serial.begin(9600); 

   ACSR =
     (0 &lt;&lt; ACD)  | // Comparator: Enabled
     (0 &lt;&lt; ACBG) | // Comparator Bandgap Select: Disabled
                   // (AIN0 is applied to the positive input)
     (1 &lt;&lt; ACI)  | // Comparator Interrupt Flag: Clear Pending Interrupt
     (0 &lt;&lt; ACIE) | // Comparator Interrupt: Disabled
     (0 &lt;&lt; ACIC) | // Comparator Input Capture (to Timer1): Disabled
     (1 &lt;&lt; ACIS1) | (1 &lt;&lt; ACIS0);   // Analog Comparator Interrupt Mode:
                                    // Interrupt on Rising Output Edge
   
   DIDR1 = (1 &lt;&lt; AIN0D) |  // disable digital input on AIN0 (PD6) DIG6
           (1 &lt;&lt; AIN1D);   // disable digital input on AIN1 (PD7) DIG7

   pinMode(13, OUTPUT); 
}

void loop() {

   if(ACSR &amp; (1 &lt;&lt; ACO)) {     // read comparator output flag
       digitalWrite(13, LOW);
   } else {
       digitalWrite(13, HIGH); // and write the inverse to the LED
       delay(50);              // stretch min on-time to 1/20th sec
   }

             
}


// Enable ACIE to use this...
//ISR(ANALOG_COMP_vect ) {
// digitalWrite(13, !digitalRead(13));   // toggle state of Pin 13
//}
</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29678"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 16/04/2015 - 23:33.</div>
    <div class="content">
     <p>It sounds like you don't need my circuit anyway, which is just as well as I can't find it! But from reading your posts, you're doing almost exactly the same thing but using the built-in comparator rather than an op. amp.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29859"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7665.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7665.jpg" alt="TimSmall&#039;s picture" title="TimSmall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Wed, 22/04/2015 - 11:44.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Thanks for the input.</p>
<p>I have things working now using the built-in comparator - final circuit attached.&nbsp;&nbsp;Annoyingly I only just found that the A1100&nbsp;manual gives some info on it&#39;s infrared output - in particular it specifies&nbsp;that its IR pulse width is&nbsp;5&nbsp;&mu;s.</p>
<p><a href="http://web.media.mit.edu/~ayb/irx/irda/IrPHY_1_2.PDF" title="http://web.media.mit.edu/~ayb/irx/irda/IrPHY_1_2.PDF">http://web.media.mit.edu/~ayb/irx/irda/IrPHY_1_2.PDF</a></p>
<p>gives this for IrDA pulse widths at 2400 baud (page 8):</p>
<p>min 1.41&nbsp;&nbsp;&mu;s&nbsp;</p>
<p>nominal 78.13&nbsp;&nbsp;&mu;s</p>
<p>max 88.15&nbsp;&mu;s</p>
<p>- the datasheet gives the&nbsp;TSL261R&nbsp;typical response time as&nbsp;70&nbsp;&mu;s.</p>
<p>This perhaps explains why it works with the A100c, but not the A1100 without the use of the comparator - the signal must be pretty tiny and saw tooth I guess (I don&#39;t have a scope so can&#39;t see). &nbsp;It&#39; also explains why it looks dim on the camera phone.</p>
<p>I&#39;ve ordered a couple of TSL262R-LF&nbsp;from Farnell. &nbsp;They have&nbsp;a response&nbsp;time of 7&nbsp;&mu;s. &nbsp;With a pull-up 100k&nbsp;resistor (as per example circuits which are present in the newer versions of the datasheet e.g. the AMS version), I&#39;m hoping this will be attachable to a digital I/O pin instead.</p>
<p>Wish I&#39;d noticed that a while back!</p>
<p>Tim.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40711"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9721.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nissan6789&#039;s picture" title="nissan6789&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Elster A1100 IRDA emontx v2 Help...</h3>

    <div class="submitted">Submitted by <a href="../user/9721.html" title="View user profile.">nissan6789</a> on Tue, 29/03/2016 - 22:56.</div>
    <div class="content">
     <p>Hello! I run this python code:</p>
<p><a href="https://github.com/DaveBerkeley/elster_meter/blob/master/solar_meter_reader.py" title="https://github.com/DaveBerkeley/elster_meter/blob/master/solar_meter_reader.py">https://github.com/DaveBerkeley/elster_meter/blob/master/solar_meter_rea...</a></p>
<p>and I get the below messages:</p>
<p>=========== RESTART: C:\Users\LENOVO\Desktop\solar_meter_reader.py ===========<br />
Traceback (most recent call last):<br />
File &quot;C:\Users\LENOVO\Desktop\solar_meter_reader.py&quot;, line 11, in &lt;module&gt;<br />
ser = serial.Serial(&#39;/dev/ttyUSB0&#39;, 9600)<br />
File &quot;C:\Users\LENOVO\AppData\Local\Programs\Python\Python35-32\lib\site-packages\serial\serialwin32.py&quot;, line 38, in __init__<br />
SerialBase.__init__(self, *args, **kwargs)<br />
File &quot;C:\Users\LENOVO\AppData\Local\Programs\Python\Python35-32\lib\site-packages\serial\serialutil.py&quot;, line 282, in __init__<br />
self.open()<br />
File &quot;C:\Users\LENOVO\AppData\Local\Programs\Python\Python35-32\lib\site-packages\serial\serialwin32.py&quot;, line 66, in open<br />
raise SerialException(&quot;could not open port %r: %r&quot; % (self.portstr, ctypes.WinError()))<br />
serial.serialutil.SerialException: could not open port &#39;/dev/ttyUSB0&#39;: FileNotFoundError(2, &#39;The system cannot find the path specified.&#39;, None, 3)</p>
<p>What have I done wrong?</p>
<p><em>[Duplicate post deleted. Moderator (RW)]</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5710"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-LG0ouQhraj7DLzheLTcVtEbfoDIldjosD6b3owlWhBU" value="form-LG0ouQhraj7DLzheLTcVtEbfoDIldjosD6b3owlWhBU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
