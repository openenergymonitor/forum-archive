<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5385 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:46:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Backup/migration of emoncms data [SOLVED] | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Backup/migration of emoncms data [SOLVED]</h3>
        <span class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sun, 06/07/2014 - 15:28</span>
        <div class="content"><p>Just read with interest the revised blog post about backing up the databases/folders, and wondered if anyone had put all this together as a php script that could be run, say as a Cron job? So it would halt sql &amp; raspberry pi_run, back up sql, back up the folders, then restart the services again. Paul</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5394.html" class="topic-previous" title="Go to previous forum topic">‹ Misformed RX packet from Arduino to RPI gateway via serial</a>
              <a href="5282.html" class="topic-next" title="Go to next forum topic">cant register user in 8.2.6 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-22349"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1513.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nerdy&#039;s picture" title="nerdy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/1513.html" title="View user profile.">nerdy</a> on Mon, 07/07/2014 - 09:32.</div>
    <div class="content">
     <p>Definitely interested in this. I have had to start from scratch several times after trying to diagnose a faulty HD.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22354"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 07/07/2014 - 14:29.</div>
    <div class="content">
     <p>You should be able to do this ok with the newly updated backup script, it doesnt require stopping the services on the remote server. It recalculates the feeds npoints metadata from the download size rather than copying meta data that becomes out of sync with the feed data. So just running backup.php from cron should be ok.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22364"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 07/07/2014 - 20:42.</div>
    <div class="content">
     <p>I&#39;ve tried running the script on the same Raspberry Pi which hosts my&nbsp;emoncms, but I&#39;m getting errors as per below.</p>
<p>I&#39;ve created a backup folder with subdirectories, currently chmod to 777, and the script/libraries chmod&nbsp;to 755.</p>
<p>php backup.php<br />
	22 Emoncms.org feeds found<br />
	PHP Notice:&nbsp; Undefined variable: id in /home/pi/myscripts/emoncms/usefulscripts/backup/backup.php on line 90<br />
	PHP Notice:&nbsp; Undefined variable: server in /home/pi/myscripts/emoncms/usefulscripts/backup/backup.php on line 90<br />
	PHPTIMESTORE:<br />
	PHP Warning:&nbsp; file_get_contents(/feed/getmeta.json?apikey=57ee7xxxxxxmyapikeyxxxxxb5e&amp;id=): failed to open stream: No such file or directory in /home/pi/myscripts/emoncms/usefulscripts/backup/lib/phptimestore.php on line 7<br />
	PHP Notice:&nbsp; Trying to get property of non-object in /home/pi/myscripts/emoncms/usefulscripts/backup/lib/phptimestore.php on line 55<br />
	PHP Notice:&nbsp; Trying to get property of non-object in /home/pi/myscripts/emoncms/usefulscripts/backup/lib/phptimestore.php on line 55<br />
	--layer: 0 Failed to access remote server<br />
	PHP Notice:&nbsp; Undefined variable: id in /home/pi/myscripts/emoncms/usefulscripts/backup/backup.php on line 90<br />
	PHP Notice:&nbsp; Undefined variable: server in /home/pi/myscripts/emoncms/usefulscripts/backup/backup.php on line 90</p>
<p>+ lots more similar errors</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22366"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 07/07/2014 - 21:01.</div>
    <div class="content">
     <p>Ah sorry Paul, I missed a crucial bit for phptimestore, should be fixed now.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22370"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 07/07/2014 - 21:47.</div>
    <div class="content">
     <p>Thanks, that has helped, I just need &nbsp;to sort out a corrupt Timestore feed now.</p>
<p>PHPTIMESTORE: 11<br />
	PHP Notice:&nbsp; Trying to get property of non-object in /home/pi/myscripts/emoncms/usefulscripts/backup/lib/phptimestore.php on line 55<br />
	PHP Notice:&nbsp; Trying to get property of non-object in /home/pi/myscripts/emoncms/usefulscripts/backup/lib/phptimestore.php on line 55<br />
	--layer: 0 Timestore feed 11 corrupt</p>
<p>...presumably, the next step is the &#39;integrity check&#39; and &#39;data recovery&#39;.</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22371"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 07/07/2014 - 22:10.</div>
    <div class="content">
     <p>...integrity check shows;</p>
<p>CHECKING INTEGRITY OF phptimestore META DATA:<br />
	Feed 11 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 12 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 13 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 17 [npoints meta file does not exist] [07:07:2014 22:03]<br />
	Feed 25 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 36 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 70 [npoints meta file does not exist] [07:07:2014 22:49]<br />
	Feed 90 [npoints meta file does not exist] [07:07:2014 22:44]<br />
	Feed 94 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 97 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 98 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 99 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 101 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Feed 102 [npoints meta file does not exist] [07:07:2014 22:50]<br />
	Error count: 14<br />
	Number of feeds: 14</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22372"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 07/07/2014 - 22:29.</div>
    <div class="content">
     <p>Can you download the feeds from scratch? might be easier, might be work making a copy of the one&#39;s you have into another folder</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22374"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 07/07/2014 - 22:38.</div>
    <div class="content">
     <p>...but why does all 14 of my Timestore&nbsp;feeds all appear to have a problem?</p>
<p>They all display OK &nbsp;within emoncms...</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 08/07/2014 - 08:57.</div>
    <div class="content">
     <p>Apart from the Timestore issue, it does not appear to be backing up either - see screen shot of my PHPFIWA&nbsp;backup folder after running the script;</p>
<p><img alt="" src="../sites/default/files/screen_2.jpg" style="width: 321px; height: 190px;" /></p>
<p>Both feed&#39;s 120 &amp; 121 should be 4mb in size.</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22383"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3371.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bob Smith&#039;s picture" title="Bob Smith&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3371.html" title="View user profile.">Bob Smith</a> on Tue, 08/07/2014 - 09:41.</div>
    <div class="content">
     <p>I have also been trying to use the backup script.</p>
<p>My set-up is a RasPi&nbsp;running emoncms&nbsp;v8.0.8 but I am trying to backup to Windows 8.1.</p>
<p>I initially planned to link data to a working&nbsp;Wamp&nbsp;emoncms v8.2.8 configuration but ran into an issue with the backup script and&nbsp;redis (could not find versions of php_redis.ddl and php_redis.pdb that work with php&nbsp;v5.5.12).</p>
<p>Trying to download just the data (by setting $link_to_local_emoncms to false in backup.php) results in the same sort of issues as Paul is having, i.e. corrupt Timestore feeds and failing backup.</p>
<p>Bob&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22385"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 08/07/2014 - 10:10.</div>
    <div class="content">
     <p>@Paul, there should be a 3rd file there with a .dat extension holding the data, so something must be going wrong early on.</p>
<p>What I think has failed is the call to $server.&quot;/feed/getmeta.json?apikey=$apikey&amp;id=$id&quot; in lib/phptimestore.php</p>
<p>Il have added a couple of lines to the code to catch this error and print what the server is giving us. I wonder if you can get the latest changes and run it again?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22388"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3371.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bob Smith&#039;s picture" title="Bob Smith&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3371.html" title="View user profile.">Bob Smith</a> on Tue, 08/07/2014 - 12:01.</div>
    <div class="content">
     <p>With latest changes I get:</p>
<p>39 Emoncms.org feeds found<br />
	PHPTIMESTORE: 1<br />
	Error in fetching remote meta data, received: false</p>
<p>etc.</p>
<p>PHPTIMESTORE: 41<br />
	Error in fetching remote meta data, received: false<br />
	PHPFIWA: 43<br />
	Cannot open local npoints meta data file</p>
<p>etc.</p>
<p>PHPFIWA: 46<br />
	Cannot open local npoints meta data file</p>
<p>Same result from Windows 8 and RasPi also integritycheck.php fails with:</p>
<p>CHECKING INTEGRITY OF phptimestore</p>
<p>META DATA:Feed 1 [npoints meta file does not exist] [08:07:2014 12:39]</p>
<p>They all display OK&nbsp; within emoncms...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22401"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 08/07/2014 - 20:51.</div>
    <div class="content">
     <p>I should have been more clear, it needs your write apikey, I&#39;ve added a note to the code. The phpfiwa error may be because you need to create a folder in your target directory for each feed engine type: phpfina, phpfiwa, phptimestore, phptimeseries.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22403"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 08/07/2014 - 21:32.</div>
    <div class="content">
     <p>The write apikey may have been the issue!</p>
<p>I&#39;ve updated with Git and just tried it with the read/write apikey, and got exactly the same result - no data backed up. BUT then I deleted the previous data that had been backed-up in the phpfiwa, phpfina etc backup folders, so all of the folders were empty, and ran the script again.</p>
<p>This time success! and over 100mb&nbsp;of data successfully&nbsp;recovered.</p>
<p>&nbsp;</p>
<p>Thanks</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22418"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3371.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bob Smith&#039;s picture" title="Bob Smith&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3371.html" title="View user profile.">Bob Smith</a> on Wed, 09/07/2014 - 16:30.</div>
    <div class="content">
     <p>Just to confirm backup.php now works for me ;-)</p>
<p>One of the other errors I had was down to the backup.php script looking for a folder in my target directory named &#39;timestore&#39; not &#39;phptimestore&#39; as stated in the backup instructions.</p>
<p>Now if I could just solve the redis issue with my Windows Wamp set-up...</p>
<p>Thanks</p>
<p>Bob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22426"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Thu, 10/07/2014 - 08:35.</div>
    <div class="content">
     <p>Hi</p>
<p>I have set up a new linux server to act as backup.</p>
<p>I am trying to use backup.php</p>
<p>I think I have edited the file as required but I get the following when I run backup.php:-&nbsp;</p>
<p>ian@ian-N250P /var/www/emoncms/usefulscripts/backup $ php backup.php<br />
	PHP Notice:&nbsp; Use of undefined constant _ENABLE_PASSWORD_RESET_ - assumed &#39;_ENABLE_PASSWORD_RESET_&#39; in /var/www/emoncms/settings.php on line 55<br />
	22 Emoncms.org feeds found<br />
	PHP Notice:&nbsp; Undefined index: datadir in /var/www/emoncms/usefulscripts/backup/backup.php on line 103</p>
<p>Notice: Undefined index: datadir in /var/www/emoncms/usefulscripts/backup/backup.php on line 103<br />
	PHPFIWA: 22<br />
	--layer: 0 PHP Notice:&nbsp; Undefined variable: feed in /var/www/emoncms/usefulscripts/backup/lib/phpfiwa.php on line 68</p>
<p>Notice: Undefined variable: feed in /var/www/emoncms/usefulscripts/backup/lib/phpfiwa.php on line 68<br />
	PHP Notice:&nbsp; Trying to get property of non-object in /var/www/emoncms/usefulscripts/backup/lib/phpfiwa.php on line 68</p>
<p>Notice: Trying to get property of non-object in /var/www/emoncms/usefulscripts/backup/lib/phpfiwa.php on line 68<br />
	PHPFiwa feed&nbsp; corrupt<br />
	ian@ian-N250P /var/www/emoncms/usefulscripts/backup $</p>
<p>One thing that puzzles me.</p>
<p>in backup.php &nbsp;it states:-</p>
<p>// if you are linking to a local emoncms installation, the settings will be fetched from<br />
	&nbsp;&nbsp;&nbsp; // your settings.php file instead.</p>
<p>If I look in settings.php it says</p>
<p>// The default data directory is /var/lib/phpfiwa,phpfina,phptimeseries</p>
<p>Then a few lines down you have:-</p>
<p>&#39;phpfiwa&#39;=&gt;array(<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&#39;datadir&#39;=&gt;&#39;/home/username/emoncmsdata/phpfiwa/&#39;</p>
<p>Is this correct?</p>
<p>Regards</p>
<p>Ian</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22427"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 10/07/2014 - 09:03.</div>
    <div class="content">
     <p>Hello Ian.</p>
<p>To get rid of the _ENABLE_PASSWORD_RESET_ error, set $enable_password_reset to true or false in settings.php.</p>
<p>Thanks for highlighting the datadir error,</p>
<p>I&#39;ve uncommented the default datadir entries so that they override the defaults set within the engines themselves. Thats likely better as at least now they are accessible to scripts that include settings.php</p>
<p>A quick fix would be to replace the engine defenitions with:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;phpfiwa&#39;=&gt;array(<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;datadir&#39;=&gt;&#39;/var/lib/phpfiwa/&#39;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;phpfina&#39;=&gt;array(<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;datadir&#39;=&gt;&#39;/var/lib/phpfina/&#39;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;phptimeseries&#39;=&gt;array(<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;datadir&#39;=&gt;&#39;/var/lib/phptimeseries/&#39;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22431"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Thu, 10/07/2014 - 11:28.</div>
    <div class="content">
     <p>Hi Trystan</p>
<p>Made changes in settings.php</p>
<p>Now get:-</p>
<p>ian@ian-N250P /var/www/emoncms/usefulscripts/backup $ php backup.php<br />
	22 Emoncms.org feeds found<br />
	PHPFIWA: 22<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPTIMESERIES: 37<br />
	Cannot open local data file<br />
	PHPFIWA: 38<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPTIMESERIES: 39<br />
	Cannot open local data file<br />
	PHPFIWA: 40<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 41<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 42<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 43<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 44<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 45<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 46<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 47<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 48<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 49<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 52<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 55<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 56<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPFIWA: 58<br />
	Cannot open local meta data file: Does the phpfiwa folder exist?<br />
	PHPTIMESERIES: 59<br />
	Cannot open local data file<br />
	PHPTIMESERIES: 62<br />
	Cannot open local data file<br />
	PHPTIMESERIES: 64<br />
	Cannot open local data file<br />
	PHPTIMESERIES: 65<br />
	Cannot open local data file</p>
<p>The folders do exist in \var\lib\. How can I tell where I have made a mistake? I Pulled the latest&nbsp;default.settings.php and used that as the template for my settings.php so I am assuming I have an error in backup.php</p>
<p>Could I have an error in folder permissions? If so how do you check folder permissions from a terminal?</p>
<p>Regards</p>
<p>Ian</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22440"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Backup/migration of emoncms data [SOLVED]</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Thu, 10/07/2014 - 19:32.</div>
    <div class="content">
     <p>To check permissions;</p>
<p>$ ls -l</p>
<p>To change directory permissions recursively;</p>
<p>$ sudo find emoncmsdata -type d -exec chmod 755 {} \;</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5385"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-z9SdcOHhFQd3Wci-9-BA0xb1sjaPsK3hqy5h-ewr_Os" value="form-z9SdcOHhFQd3Wci-9-BA0xb1sjaPsK3hqy5h-ewr_Os"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/5385 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:46:49 GMT -->
</html>
