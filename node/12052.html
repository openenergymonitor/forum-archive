<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12052 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:48:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Arduino Mini + Pi2 + emonSD-22Dec2015.img | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Arduino Mini + Pi2 + emonSD-22Dec2015.img</h3>
        <span class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Thu, 21/01/2016 - 22:27</span>
        <div class="content"><p>I am running the following configuration:<br />
- Arduino Mini with emonTxV3_DirectSerial.ino loaded, slightly adapted for my needs.<br />
- PI2 with emonSD-22Dec2015 image<br />
- Ethernet cable<br />
Arduino is connected directly to the Pi2 serial port through a level adapter (5V --&gt; 3.3V)</p>
<p>My problem:<br />
When I first boot Pi2 and Arduino, I get an &quot;MainThread ArduinoMini thread is dead&quot; message.<br />
I then stop and restart the emonhub service.<br />
Then everything works as expected. Nodes/Inputs are created, OpenHAB works just fine. If I reboot the PI, same message. I need to restart the service again.</p>
<p>Here is the emonhub.log file:</p>
<pre style="font-size: 125%">
2016-01-21 20:29:05,332 INFO     MainThread EmonHub emonHub &#39;emon-pi&#39; variant v1.1
2016-01-21 20:29:05,334 INFO     MainThread Opening hub...
2016-01-21 20:29:05,336 INFO     MainThread Logging level set to DEBUG
2016-01-21 20:29:05,338 INFO     MainThread Creating EmonHubSerialInterfacer &#39;ArduinoMini&#39; 
2016-01-21 20:29:05,347 DEBUG    MainThread Opening serial port: /dev/ttyAMA0 @ 9600 bits/s
2016-01-21 20:29:05,349 DEBUG    MainThread Setting ArduinoMini subchannels: [&#39;ToRFM12&#39;]
2016-01-21 20:29:05,351 DEBUG    MainThread Interfacer: Subscribed to channel&#39; : ToRFM12
2016-01-21 20:29:05,355 DEBUG    MainThread Setting ArduinoMini pubchannels: [&#39;ToEmonCMS&#39;]
2016-01-21 20:29:05,358 DEBUG    MainThread Interfacer: Subscribed to channel&#39; : ToRFM12
2016-01-21 20:29:05,361 INFO     MainThread Creating EmonHubMqttInterfacer &#39;MQTT&#39; 
2016-01-21 20:29:05,364 INFO     MainThread MQTT Init mqtt_host=127.0.0.1 mqtt_port=1883
 mqtt_user=emonpi
2016-01-21 20:29:05,372 DEBUG    MainThread MQTT Subscribed to channel&#39; : ToEmonCMS
2016-01-21 20:29:05,375 INFO     MainThread Creating EmonHubEmoncmsHTTPInterfacer &#39;emoncmsorg&#39; 
2016-01-21 20:29:05,379 DEBUG    MainThread emoncmsorg Subscribed to channel&#39; : ToEmonCMS
2016-01-21 20:29:05,482 INFO     MQTT       Connecting to MQTT Server
2016-01-21 20:29:05,488 INFO     MQTT       connection status: Connection successful
2016-01-21 20:29:05,490 DEBUG    MQTT       CONACK =&gt; Return code: 0
2016-01-21 20:29:05,595 INFO     MQTT       on_subscribe
2016-01-21 20:29:15,589 WARNING  MainThread ArduinoMini thread is dead
2016-01-21 20:29:15,847 WARNING  MainThread ArduinoMini thread is dead
2016-01-21 20:29:16,105 WARNING  MainThread ArduinoMini thread is dead
//REMOVED DUPLICATED
2016-01-21 20:29:35,368 WARNING  MainThread ArduinoMini thread is dead
2016-01-21 20:29:35,382 INFO     emoncmsorg sending: <a href="http://localhost/emoncms/input" title="http://localhost/emoncms/input">http://localhost/emoncms/input</a>
/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[]&amp;sentat=1453408175
2016-01-21 20:29:35,622 WARNING  MainThread ArduinoMini thread is dead
2016-01-21 20:29:35,818 WARNING  emoncmsorg send failure: wanted &#39;ok&#39; but got &#39;Error:
 Format error, json string supplied is not valid
&#39;
2016-01-21 20:29:35,893 WARNING  MainThread ArduinoMini thread is dead
//REMOVED DUPLICATED
2016-01-21 20:30:05,355 WARNING  MainThread ArduinoMini thread is dead
2016-01-21 20:30:05,395 INFO     emoncmsorg sending: <a href="http://localhost/emoncms/input" title="http://localhost/emoncms/input">http://localhost/emoncms/input</a>
/bulk.json?
apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[]&amp;sentat=1453408205
2016-01-21 20:30:05,483 WARNING  emoncmsorg send failure: wanted &#39;ok&#39; but got &#39;Error: 
Format error, json string supplied is not valid
&#39;
2016-01-21 20:30:05,484 INFO     emoncmsorg sending: <a href="http://localhost/emoncms/myip/set.json" title="http://localhost/emoncms/myip/set.json">http://localhost/emoncms/myip/set.json</a>?
apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y
2016-01-21 20:30:05,536 WARNING  emoncmsorg emoncmsorg couldn&#39;t send to server, HTTPError: 406
2016-01-21 20:30:05,604 WARNING  MainThread ArduinoMini thread is dead
//REMOVED DUPLICATED
2016-01-21 20:31:05,366 WARNING  MainThread ArduinoMini thread is dead
2016-01-21 20:31:05,427 INFO     emoncmsorg sending: <a href="http://localhost/emoncms/myip/set.json" title="http://localhost/emoncms/myip/set.json">http://localhost/emoncms/myip/set.json</a>?
apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y
2016-01-21 20:31:05,472 WARNING  emoncmsorg emoncmsorg couldn&#39;t send to server, HTTPError: 406
2016-01-21 20:31:05,576 INFO     emoncmsorg sending: <a href="http://localhost/emoncms/input" title="http://localhost/emoncms/input">http://localhost/emoncms/input</a>
/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[]&amp;sentat=1453408265
2016-01-21 20:31:05,618 WARNING  MainThread ArduinoMini thread is dead
2016-01-21 20:31:05,657 WARNING  emoncmsorg send failure: wanted &#39;ok&#39; but got &#39;Error:
 Format error, json string supplied is not valid
&#39;</pre><p>Run the command:<br />
sudo service emonhub stop</p>
<pre style="font-size: 125%">
2016-01-21 20:31:57,693 DEBUG    MainThread SIGINT received.
2016-01-21 20:31:57,694 WARNING  MainThread ArduinoMini thread is dead
2016-01-21 20:31:57,895 INFO     MainThread Exiting hub...
2016-01-21 20:31:57,930 INFO     MainThread Exit completed</pre><p>On the command line:</p>
<pre style="font-size: 125%">
pi@emonpi:~$ sudo service emonhub status
● emonhub.service - LSB: Start/stop emonHub
   Loaded: loaded (/etc/init.d/emonhub)
   Active: active (running) since Thu 2016-01-21 20:29:03 GMT; 2min 24s ago
  Process: 472 ExecStart=/etc/init.d/emonhub start (code=exited, status=0/SUCCESS)
   CGroup: /system.slice/emonhub.service
           └─674 python /usr/share/emonhub/emonhub.py --logfile /var/log/emonhub/emonhub.log
 --config-file /home/pi/data/emo...

Jan 21 20:29:03 emonpi systemd[1]: Started LSB: Start/stop emonHub.
Jan 21 20:29:15 emonpi emonhub[472]: Exception in thread ArduinoMicro:
Jan 21 20:29:15 emonpi emonhub[472]: Traceback (most recent call last):
Jan 21 20:29:15 emonpi emonhub[472]: File &quot;/usr/lib/python2.7/threading.py&quot;, line 810,
 in __bootstrap_inner
Jan 21 20:29:15 emonpi emonhub[472]: self.run()
Jan 21 20:29:15 emonpi emonhub[472]: File &quot;/home/pi/emonhub/src/interfacers
​/emonhub_interfacer.py&quot;, line 73, in run
Jan 21 20:29:15 emonpi emonhub[472]: rxc = self.read()
Jan 21 20:29:15 emonpi emonhub[472]: File &quot;/home/pi/emonhub/src/interfacers
​/EmonHubSerialInterfacer.py&quot;, line 90, in read
Jan 21 20:29:15 emonpi emonhub[472]: c.nodeid = int(f[0])
Jan 21 20:29:15 emonpi emonhub[472]: ValueError: invalid literal for int() with base 10: &#39;&#39;
pi@emonpi:~$ sudo service emonhub stop</pre><p>
Run command:<br />
sudo service emonhub restart</p>
<pre style="font-size: 125%">
2016-01-21 20:49:36,542 INFO     MainThread EmonHub emonHub &#39;emon-pi&#39; variant v1.1
2016-01-21 20:49:36,543 INFO     MainThread Opening hub...
2016-01-21 20:49:36,544 INFO     MainThread Logging level set to DEBUG
2016-01-21 20:49:36,545 INFO     MainThread Creating EmonHubSerialInterfacer &#39;ArduinoMini&#39; 
2016-01-21 20:49:36,549 DEBUG    MainThread Opening serial port: /dev/ttyAMA0 @ 9600 bits/s
2016-01-21 20:49:36,550 DEBUG    MainThread Setting ArduinoMini subchannels: [&#39;ToRFM12&#39;]
2016-01-21 20:49:36,552 DEBUG    MainThread Interfacer: Subscribed to channel&#39; : ToRFM12
2016-01-21 20:49:36,553 DEBUG    MainThread Setting ArduinoMini pubchannels: [&#39;ToEmonCMS&#39;]
2016-01-21 20:49:36,554 DEBUG    MainThread Interfacer: Subscribed to channel&#39; : ToRFM12
2016-01-21 20:49:36,556 INFO     MainThread Creating EmonHubMqttInterfacer &#39;MQTT&#39; 
2016-01-21 20:49:36,558 INFO     MainThread MQTT Init mqtt_host=127.0.0.1 mqtt_port=1883
 mqtt_user=emonpi
2016-01-21 20:49:36,562 DEBUG    MainThread MQTT Subscribed to channel&#39; : ToEmonCMS
2016-01-21 20:49:36,564 INFO     MainThread Creating EmonHubEmoncmsHTTPInterfacer &#39;emoncmsorg&#39; 
2016-01-21 20:49:36,567 DEBUG    MainThread emoncmsorg Subscribed to channel&#39; : ToEmonCMS
2016-01-21 20:49:36,664 INFO     MQTT       Connecting to MQTT Server
2016-01-21 20:49:36,669 INFO     MQTT       connection status: Connection successful
2016-01-21 20:49:36,671 DEBUG    MQTT       CONACK =&gt; Return code: 0
2016-01-21 20:49:36,773 INFO     MQTT       on_subscribe
2016-01-21 20:49:45,131 DEBUG    ArduinoMini 1 NEW FRAME : 10 9.52 4.03
2016-01-21 20:49:45,132 DEBUG    ArduinoMini 1 Timestamp : 1453409385.13
2016-01-21 20:49:45,133 DEBUG    ArduinoMini 1 From Node : 10
2016-01-21 20:49:45,134 DEBUG    ArduinoMini 1    Values : [9.52, 4.03]
2016-01-21 20:49:45,136 INFO     ArduinoMini Publishing: emonhub/rx/10/values 9.52,4.03
2016-01-21 20:49:45,139 INFO     ArduinoMini Publishing: emonhub/rx/10/rssi 0
2016-01-21 20:49:45,141 DEBUG    ArduinoMini 1 adding frame to buffer =&gt;
 [1453409385, 10, 9.52, 4.03]
2016-01-21 20:49:45,142 DEBUG    ArduinoMini 1 Sent to channel&#39; : ToEmonCMS
2016-01-21 20:49:54,377 DEBUG    ArduinoMini 2 NEW FRAME : 10 9.10 3.87
2016-01-21 20:49:54,379 DEBUG    ArduinoMini 2 Timestamp : 1453409394.38
2016-01-21 20:49:54,380 DEBUG    ArduinoMini 2 From Node : 10
2016-01-21 20:49:54,381 DEBUG    ArduinoMini 2    Values : [9.1, 3.87]
2016-01-21 20:49:54,382 INFO     ArduinoMini Publishing: emonhub/rx/10/values 9.1,3.87
2016-01-21 20:49:54,385 INFO     ArduinoMini Publishing: emonhub/rx/10/rssi 0
2016-01-21 20:49:54,387 DEBUG    ArduinoMini 2 adding frame to buffer =&gt;
 [1453409394, 10, 9.1, 3.87]
2016-01-21 20:49:54,389 DEBUG    ArduinoMini 2 Sent to channel&#39; : ToEmonCMS
2016-01-21 20:50:06,360 DEBUG    ArduinoMini 3 NEW FRAME : 10 12.44 4.84
2016-01-21 20:50:06,362 DEBUG    ArduinoMini 3 Timestamp : 1453409406.36
2016-01-21 20:50:06,363 DEBUG    ArduinoMini 3 From Node : 10
2016-01-21 20:50:06,364 DEBUG    ArduinoMini 3    Values : [12.44, 4.84]
2016-01-21 20:50:06,366 INFO     ArduinoMini Publishing: emonhub/rx/10/values 12.44,4.84
2016-01-21 20:50:06,376 INFO     ArduinoMini Publishing: emonhub/rx/10/rssi 0
2016-01-21 20:50:06,379 DEBUG    ArduinoMini 3 adding frame to buffer =&gt;
 [1453409406, 10, 12.44, 4.84]
2016-01-21 20:50:06,380 DEBUG    ArduinoMini 3 Sent to channel&#39; : ToEmonCMS
2016-01-21 20:50:06,626 INFO     emoncmsorg sending: <a href="http://localhost/emoncms/input/bulk.json" title="http://localhost/emoncms/input/bulk.json">http://localhost/emoncms/input/bulk.json</a>?
apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1453409385,10,9.52,4.03],
[1453409394,10,9.1,3.87],[1453409406,10,12.44,4.84]]&amp;sentat=1453409406
2016-01-21 20:50:06,677 DEBUG    emoncmsorg acknowledged receipt with &#39;ok&#39; from <a href="http://localhost/emoncms" title="http://localhost/emoncms">http://localhost/emoncms</a>
2016-01-21 20:50:14,747 DEBUG    ArduinoMini 4 NEW FRAME : 10 9.23 4.23
2016-01-21 20:50:14,749 DEBUG    ArduinoMini 4 Timestamp : 1453409414.75
2016-01-21 20:50:14,750 DEBUG    ArduinoMini 4 From Node : 10
2016-01-21 20:50:14,751 DEBUG    ArduinoMini 4    Values : [9.23, 4.23]
2016-01-21 20:50:14,752 INFO     ArduinoMini Publishing: emonhub/rx/10/values 9.23,4.23
2016-01-21 20:50:14,754 INFO     ArduinoMini Publishing: emonhub/rx/10/rssi 0
2016-01-21 20:50:14,757 DEBUG    ArduinoMini 4 adding frame to buffer =&gt;
 [1453409414, 10, 9.23, 4.23]
2016-01-21 20:50:14,758 DEBUG    ArduinoMini 4 Sent to channel&#39; : ToEmonCMS
2016-01-21 20:50:24,392 DEBUG    ArduinoMini 5 NEW FRAME : 10 9.22 4.11
2016-01-21 20:50:24,393 DEBUG    ArduinoMini 5 Timestamp : 1453409424.39
2016-01-21 20:50:24,394 DEBUG    ArduinoMini 5 From Node : 10
2016-01-21 20:50:24,395 DEBUG    ArduinoMini 5    Values : [9.22, 4.11]
2016-01-21 20:50:24,396 INFO     ArduinoMini Publishing: emonhub/rx/10/values 9.22,4.11
2016-01-21 20:50:24,398 INFO     ArduinoMini Publishing: emonhub/rx/10/rssi 0
2016-01-21 20:50:24,401 DEBUG    ArduinoMini 5 adding frame to buffer =&gt;
 [1453409424, 10, 9.22, 4.11]
2016-01-21 20:50:24,402 DEBUG    ArduinoMini 5 Sent to channel&#39; : ToEmonCMS
2016-01-21 20:50:34,450 DEBUG    ArduinoMini 6 NEW FRAME : 10 8.57 3.71
2016-01-21 20:50:34,452 DEBUG    ArduinoMini 6 Timestamp : 1453409434.45
2016-01-21 20:50:34,453 DEBUG    ArduinoMini 6 From Node : 10
2016-01-21 20:50:34,453 DEBUG    ArduinoMini 6    Values : [8.57, 3.71]
2016-01-21 20:50:34,455 INFO     ArduinoMini Publishing: emonhub/rx/10/values 8.57,3.71
2016-01-21 20:50:34,458 INFO     ArduinoMini Publishing: emonhub/rx/10/rssi 0
2016-01-21 20:50:34,461 DEBUG    ArduinoMini 6 adding frame to buffer =&gt;
 [1453409434, 10, 8.57, 3.71]
2016-01-21 20:50:34,462 DEBUG    ArduinoMini 6 Sent to channel&#39; : ToEmonCMS
2016-01-21 20:50:36,401 DEBUG    MainThread SIGINT received.
2016-01-21 20:50:36,402 INFO     MainThread Exiting hub...
2016-01-21 20:50:36,508 INFO     MainThread Exit completed</pre><p>
There are other threads in the forum talking about a similar issue but I could not find any solution.</p>
<p>Can someone help with this?</p>
<p>Thanks for your help.</p>
<p>Walter</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12077.html" class="topic-previous" title="Go to previous forum topic">‹ Redis-server failing to start</a>
              <a href="11817.html" class="topic-next" title="Go to next forum topic">No feeds to emoncms.org ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-38652"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7723.jpg" alt="daturach&#039;s picture" title="daturach&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino Mini + Pi2 + emonSD-22Dec2015.img</h3>

    <div class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Sat, 23/01/2016 - 17:48.</div>
    <div class="content">
     <p>I am going to use &quot;shutdownpi&quot; from your archive folder and modify it so that it calls a&nbsp;service&nbsp;emonhub&nbsp;restart when doing a short&nbsp;press on a button and a shutdown for a long&nbsp;press.</p>
<p>That should resolve my problem I hope.</p>
<p>Walter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38659"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino Mini + Pi2 + emonSD-22Dec2015.img</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 24/01/2016 - 11:53.</div>
    <div class="content">
     <p>Seems the problem was the first value in the packet was not an&nbsp;integer,&nbsp;</p>
<p>Jan 21 20:29:15 emonpi emonhub[472]: File &quot;/home/pi/emonhub/src/interfacers ​/EmonHubSerialInterfacer.py&quot;, line 90, in read<br />
Jan 21 20:29:15&nbsp;emonpi&nbsp;emonhub[472]: c.nodeid = int(f[0])&nbsp;<br />
Jan 21 20:29:15&nbsp;emonpi&nbsp;emonhub[472]:&nbsp;ValueError: invalid&nbsp;literal for int() with base 10: &#39;&#39;</p>
<p>The code should be more robust&nbsp;so as not to crash when faced with a non-integer. Perhaps a try-catch <a href="https://github.com/openenergymonitor/emonhub/blob/emon-pi/src/interfacers/EmonHubSerialInterfacer.py#L90">(around lines 86 to 91)</a> to abort further processing without falling over, that way it wouldn&#39;t then continue to try and send the failed packet to emoncms.</p>
<p>2016-01-21 20:29:35,382 INFO emoncmsorg sending: <a href="http://localhost/emoncms/input" title="http://localhost/emoncms/input">http://localhost/emoncms/input</a> /bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[]&amp;sentat=1453408175</p>
<p>The &quot;data=[]&quot; contains the content of the packet that failed ie nothing!</p>
<p>2016-01-21 20:31:05,657 WARNING&nbsp;emoncmsorg&nbsp;send failure: wanted &#39;ok&#39; but got &#39;Error: Format error,&nbsp;json&nbsp;string supplied is not valid</p>
<p>This&nbsp;response from emoncms&nbsp;means that that whole payload was discarded&nbsp;which in this instance was just 1 empty packet, but could have been a whole 30 seconds worth&nbsp;of data from several nodes.</p>
<p>Is it possible the arduino pro mini has sent something other than an integer as a first value?</p>
<p>is there any startup messages that occur after the serial connection is established?</p>
<p>If this is happening every time you start then there&nbsp;probably is, however if it happens randomly there is a less probable change of a timing issue causing the first (integer) value to be missed and emonhub&nbsp;seeing one of the following floats (2nd or 3rd values) as the first (node id) value.</p>
<p>Removing any print statements from your sketch will be a much better solution, especially if you have a watchdog in your sketch, as any reseting of the pro-mini will more than likely crash emonhub.</p>
<p>Paul</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38666"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7723.jpg" alt="daturach&#039;s picture" title="daturach&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino Mini + Pi2 + emonSD-22Dec2015.img</h3>

    <div class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Sun, 24/01/2016 - 17:18.</div>
    <div class="content">
     <p>Thanks for your answers.</p>
<p>I ran Minicom&nbsp;but could not see anything wrong.</p>
<p>It happens&nbsp;every time. This is why I am looking at a solution with a script.</p>
<p>Something else comes to my mind. I am powering both modules from the same power supply. I noticed the Arduino&nbsp;is taking quite &quot;some&quot; time before sending its first values to&nbsp;the serial port. It seems the PI2 is faster to boot than the mini. Maybe that&#39;s the problem.</p>
<p>What do you think?</p>
<p>I am going to use a second power supply and see what happens.</p>
<p>Walter</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38672"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7723.jpg" alt="daturach&#039;s picture" title="daturach&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino Mini + Pi2 + emonSD-22Dec2015.img</h3>

    <div class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Sun, 24/01/2016 - 19:32.</div>
    <div class="content">
     <p>With one power supply as before,&nbsp;I have rebooted the Pi2, leaving the arduino running. Nothing has changed.</p>
<p>I am going to stick with the script and a button. I will upload it here once done.</p>
<p>Walter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38674"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino Mini + Pi2 + emonSD-22Dec2015.img</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 24/01/2016 - 20:17.</div>
    <div class="content">
     <p><em>&quot;Something else comes to my mind. I am powering both modules from the same power supply. I noticed the Arduino&nbsp;is taking quite &quot;some&quot; time before sending its first values to&nbsp;the serial port. It seems the PI2 is faster to boot than the mini. Maybe that&#39;s the problem.&quot;</em></p>
<p>Most probably yes. There&#39;s no way the arduino should take longer to get started than the Pi takes to load and start an OS and then start several services including emonhub. That is where you need to look.</p>
<p>Why does the sketch take so long to start?</p>
<p>Does it start the serial connection at the start, or towards the end of its setup?</p>
<p>Does it print any start up messages?</p>
<p>With minicom running, reset just the arduino&nbsp;and watch the serial&nbsp;output. Does every line, without exception, start with the node id?</p>
<p>The script &amp; button isn&#39;t really a fix for this issue, since any power interruption no matter how brief, will need you to push the button. Will you always know? Will you always be at home? What if it happens during the night? Delaying emonhub&#39;s start would be marginally better, but &nbsp;it should not be necessary. The Arduino should be much quicker to boot.</p>
<p>Paul&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38681"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7723.jpg" alt="daturach&#039;s picture" title="daturach&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino Mini + Pi2 + emonSD-22Dec2015.img</h3>

    <div class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Sun, 24/01/2016 - 21:49.</div>
    <div class="content">
     <p><em>Why does the sketch take so long to start? Does it start the serial connection at the start or towards the end of it&#39;s setup?&nbsp;Does it print any start up messages?</em></p>
<p>I am using the sketch in&nbsp;https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/noRF/emonTxV3_DirectSerial , compiled&nbsp;for an Arduino&nbsp;mini. 3 values are sent (Node, realPower and Voltage) every 10 secs.</p>
<p>It prints &quot;emonTx V3 Direct serial Example&quot; at the start.</p>
<p><em>With minicom running, reset just the arduino&nbsp;and watch the serial&nbsp;output&nbsp;does every line&nbsp;without exception start with the node id?</em></p>
<p>Yes, every line is clean, nodeid, then the&nbsp;2 values, separated by a space.</p>
<p><em>The script &amp; button isn&#39;t really a fix for this issue since any power interruptions no matter how brief will need you to push the button. will you always know? will you always be at home? what if it happens during the night? delaying emonhub&#39;s start would be marginally better but &nbsp;it should not be necessary, the arduino should be much quicker to boot.</em></p>
<p>Leaving the Arduino running and rebooting the PI did not solve the&nbsp;problem. Why is emonhub not catching the beginning of the transmission? I have a level adapter (HEF4050) between the mini TX out &nbsp;and the PI RX in. If there was a problem there, minicom should catch it.</p>
<p>As a side note, I have another system measuring my 3 phases system using another combination of components (emonTx V3.4&nbsp;+ RF + Pi&nbsp;B+). No problems so far, running since 6 months.</p>
<p>For this project, I intend to use this device&nbsp;for measuring and comparing different appliances. It should not run for a long time.</p>
<p>Walter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38733"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7723.jpg" alt="daturach&#039;s picture" title="daturach&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino Mini + Pi2 + emonSD-22Dec2015.img</h3>

    <div class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Mon, 25/01/2016 - 21:52.</div>
    <div class="content">
     <p>I am now using a usb2serial adapter and it&#39;s definitely better. When I boot both Arduino and PI, the data is&nbsp;going through, without me having to restart the service. However, I must not restart the Arduino&nbsp;at a later stage. The message &quot;ArduinoMini thread is dead&quot; is back.</p>
<p>When I used the serial port, I suspect my programming device was pulling&nbsp;the Arduino reset signal to ground for a certain time. This increased the boot time.</p>
<p>I think I am going to keep both options: through the serial or the USB ports. I will decide later.</p>
<p>Next step is to move everything to a HDD or SSD drive.</p>
<p>Thanks for your help.</p>
<p>Walter</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12052"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-SMSZaxCk8YlBZ2I9GdshX0vYAh_ZQYfL_597DT36jyc" value="form-SMSZaxCk8YlBZ2I9GdshX0vYAh_ZQYfL_597DT36jyc"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
