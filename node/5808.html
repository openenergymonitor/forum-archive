<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5808 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:26:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Yun+EmonTX Sheild SMT calibration in the US | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Yun+EmonTX Sheild SMT calibration in the US</h3>
        <span class="submitted">Submitted by Guest on Sun, 21/09/2014 - 17:09</span>
        <div class="content"><p>Hello,</p>
<p>I&#39;m just getting started with an energy monitoring project with the intention to monitor power use of a 9KW&nbsp;240VAC 60Hz&nbsp;electric boiler which provides heat for a radiant floor. &nbsp;As this is in the US, I will use a pair of CTs, one for each leg of the 240. &nbsp;I have the 9VAC&nbsp;wall-wart to allow sampling of the voltage as well. &nbsp;I would power the Yun+shield with a 5V USB wall-wart. &nbsp;Ultimately&nbsp;I will send the usage data to my existing linux&nbsp;environment, hence the purchase of the Yun&nbsp;which has convenience of the networking and additional proc. &nbsp;Summary of components purchased (all from the OEM shop other than the Yun):</p>
<ul>
<li>
		Arduino&nbsp;Yun</li>
<li>
		EmonTX Shield SMT</li>
<li>
		2&nbsp;SCT-013-000</li>
<li>
		1&nbsp;9VAC wall-wart (US plug)</li>
</ul>
<p>I&#39;ve found the number of sketches a little dizzying, so I&#39;m trying to start with the basics and build toward the above goal. &nbsp;I thought that calibration building block would make a good starting point. &nbsp;I&#39;m starting with the calibration of the internal reference voltage and using the CalVref&nbsp;sketch. &nbsp;The sketch calls for measuring 3.3 on the batt&nbsp;pins which doesn&#39;t seem to apply to the SMT sheild. &nbsp;I&#39;m using a Fluke 87V&nbsp;meter to measure between AREF &amp; GND pins instead. &nbsp;I was expecting to see a fairly stable reference voltage, but instead I observe significant fluctuations, particularly if I&#39;m using the the 5V USB wall-warts; example fluctuations: .040 &amp; .039. &nbsp;There is less fluctuation when I use USB power from my laptop (running off its battery). &nbsp;When I make similar measurements using a Arduino Uno clone (SparkFun redboard), I see much more stable voltage, example fluctuation .004. &nbsp;I think this all boils down to the lack of a 5V regulator on the Yun, which then causes me to question if the Yun is usable for this application unless I provide it with a regulated 5V supply.</p>
<p>The data that I gathered using the Fluke and CalVref running on the Yun follows.</p>
<p>--Larry</p>
<p>Using black KDL-5100A wall-wart USB power</p>
<p><strong>Fluke 87V: Min 4.677 Max 4.717 Avg 4.711</strong></p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 254 counts or 1.165 V if measured with your meter.<br />
	The constant for that is 1192784L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4696 mV.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 234 counts or 1.073 V if measured with your meter.<br />
	The constant for that is 1099098L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4697 mV.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 234 counts or 1.074 V if measured with your meter.<br />
	The constant for that is 1099332L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4698 mV.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 247 counts or 1.133 V if measured with your meter.<br />
	The constant for that is 1160406L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4698 mV.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 235 counts or 1.078 V if measured with your meter.<br />
	The constant for that is 1104265L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4699 mV.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 235 counts or 1.078 V if measured with your meter.<br />
	The constant for that is 1104265L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4699 mV.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 234 counts or 1.074 V if measured with your meter.<br />
	The constant for that is 1099800L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4700 mV. The difference is due to integer rounding.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 234 counts or 1.074 V if measured with your meter.<br />
	The constant for that is 1099800L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4700 mV. The difference is due to integer rounding.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 234 counts or 1.074 V if measured with your meter.<br />
	The constant for that is 1100033L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4700 mV. The difference is due to integer rounding.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 234 counts or 1.074 V if measured with your meter.<br />
	The constant for that is 1100033L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4700 mV. The difference is due to integer rounding.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 234 counts or 1.074 V if measured with your meter.<br />
	The constant for that is 1100268L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4702 mV.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 233 counts or 1.070 V if measured with your meter.<br />
	The constant for that is 1095566L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4702 mV.</p>
<p>You measured 4.70 V.<br />
	That means your internal reference is 234 counts or 1.075 V if measured with your meter.<br />
	The constant for that is 1100502L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4703 mV.</p>
<p>------------------------------------------------------------------------</p>
<p>Using Apple A1265 wall-wart USB power</p>
<p><strong>Fluke 87V: Min 4.556 Max 4.595 Avg 4.593</strong></p>
<p>You measured 4.59 V.<br />
	That means your internal reference is 240 counts or 1.077 V if measured with your meter.<br />
	The constant for that is 1102559L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4593 mV. The difference is due to integer rounding.</p>
<p>You measured 4.59 V.<br />
	That means your internal reference is 241 counts or 1.081 V if measured with your meter.<br />
	The constant for that is 1107153L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4593 mV. The difference is due to integer rounding.</p>
<p>You measured 4.59 V.<br />
	That means your internal reference is 241 counts or 1.081 V if measured with your meter.<br />
	The constant for that is 1107153L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4593 mV. The difference is due to integer rounding.</p>
<p>You measured 4.59 V.<br />
	That means your internal reference is 240 counts or 1.076 V if measured with your meter.<br />
	The constant for that is 1102320L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4593 mV.</p>
<p>You measured 4.59 V.<br />
	That means your internal reference is 240 counts or 1.077 V if measured with your meter.<br />
	The constant for that is 1102559L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4593 mV. The difference is due to integer rounding.</p>
<p>------------------------------------------------------------------------</p>
<p>Using laptop USB power with SparkFun redboard (Uno clone)</p>
<p>Measuring across AREF and GND pins</p>
<p><strong>Fluke 87V: Min 4.964 Max 4.968 Avg 4.967</strong></p>
<p>You measured 4.97 V.<br />
	That means your internal reference is 223 counts or 1.082 V if measured with your meter.<br />
	The constant for that is 1107641L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4967 mV.</p>
<p>You measured 4.97 V.<br />
	That means your internal reference is 224 counts or 1.087 V if measured with your meter.<br />
	The constant for that is 1112608L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4967 mV.</p>
<p>You measured 4.97 V.<br />
	That means your internal reference is 224 counts or 1.087 V if measured with your meter.<br />
	The constant for that is 1112608L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4967 mV.</p>
<p>You measured 4.97 V.<br />
	That means your internal reference is 223 counts or 1.082 V if measured with your meter.<br />
	The constant for that is 1107641L<br />
	Using that in &quot;readVcc( )&quot;, it will return 4967 mV.</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5712.html" class="topic-previous" title="Go to previous forum topic">‹ emonTx V3 AC AC</a>
              <a href="5719.html" class="topic-next" title="Go to next forum topic">Oemgateway: Warning Send Failure ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-24052"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Yun+EmonTX Sheild SMT calibration in the US</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 21/09/2014 - 18:35.</div>
    <div class="content">
     <p>That&#39;s the point of measuring the inaccurate (in terms of the initial value) but stable (over time) internal reference when you are using the supply as the reference for measurements. I believe that, in the past, accuracy and stability have been confused. If you have a supply that is both accurate and stable, then there&#39;s no need to calibrate the analogue reference, and you can use a constant value in place of that returned by readVcc(). If you don&#39;t - like a battery whose voltage droops over time - then it&#39;s necessary to measure the analogue reference to maintain calibration.</p>
<p>Your problem is how stable your supply is between measuring it and completing the measurement sequence. If there are minimal fluctuations during that interval, you can use the emonLib library with calibration by readVcc(). If not, you need a better power supply.</p>
<p>You might like to look at <a href="http://openenergymonitor.blogspot.com/2011/08/not-all-usb-power-supplies-are-created.html">Not all USB power adapters are created equal.</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5808"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-VlJRsSE8ffIWk1kzsqm9UdajQMHP5DHEc2-nFq8h1ZM" value="form-VlJRsSE8ffIWk1kzsqm9UdajQMHP5DHEc2-nFq8h1ZM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
