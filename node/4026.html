<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/4026 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:03:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>1-wire sensor order | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">1-wire sensor order</h3>
        <span class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Fri, 07/03/2014 - 22:20</span>
        <div class="content"><p>I have no idea how 1-wire works, but just looking at the sketch so I can modify it for multiple sensors (and make it as generic as possible), it occurred to me that the order the sensors are discovered may be important.</p>
<p>So firstly, how are the 1-wire device addresses discovered? &nbsp;Is it first come first served, or is there a specific order?</p>
<p>The reason for asking is that if the order they are discovered and added to the address array can vary between power cycles, the input feeds will be from different devices after a power cycle.</p>
<p>If that is true, the only way to ensure consistency is to hard code the addresses.</p>
<p>Can anyone tell me how the 1-wire devices are discovered?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3746.html" class="topic-previous" title="Go to previous forum topic">‹ USB RFM12</a>
              <a href="3992.html" class="topic-next" title="Go to next forum topic">EmonTH - detect extractor on/off ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-19099"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 1-wire sensor order</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sat, 08/03/2014 - 09:38.</div>
    <div class="content">
     <p>The order is deterministic, based on the unique address of each sensor.</p>
<p>I recommend you discover your addresses and use them directly, because this is the only way to prevent inputs switching over.</p>
<p>Say your system develops a dodgy wire - with address based sketches you&#39;ll see the actual sensor dropping off. If you use a sketch that just cycles through the sensors on the bus, although they&#39;ll always be in the same order, if one is intermittent it will shuffle all your subsequent inputs around.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19101"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 1-wire sensor order</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Sat, 08/03/2014 - 09:47.</div>
    <div class="content">
     <p>@schism &quot;The order is deterministic, based on the unique address of each sensor.&quot; if it is based on the unique address then it must be ordered in some way based on the address. &nbsp;If it is deterministic then it would be based on which one was found first (which is what I suspected and what the rest of your answer implies).</p>
<p>Had not thought of the case of a sensor dropping out in any case, so it looks like I will have to hard code. &nbsp;Shame you cannot send setup data to the EmonTx.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19103"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 1-wire sensor order</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sat, 08/03/2014 - 12:11.</div>
    <div class="content">
     <p>Correct - you will always get the sensors returned in the same order, for any given set of sensors - &nbsp;a new one might appear first, last, or in the middle of the list depending on its address.</p>
<p>You&#39;ll see there are sensor discovery sketches in github, which make it easy to find out your addresses (I then keep a log of these in a spreadsheet as I deploy them, to save the bother in case I need to move a sensor to a new node, for some reason...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19104"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 1-wire sensor order</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 08/03/2014 - 12:20.</div>
    <div class="content">
     <p>I was looking at the Data Sheet to try to find the answer - there&#39;s a hint there that the sensor replies after a random time. I wondered whether this in fact determines the order they respond, i.e. the first to respond gets the first slot in the address array, etc, but there is no definitive statement. As you say, the only sure way is to get the individual address and use that.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19107"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 1-wire sensor order</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Sat, 08/03/2014 - 15:43.</div>
    <div class="content">
     <p>I think the library we&#39;re using guarantees the ordering (rather than some property of the sensors themselves). I haven&#39;t looked, but assume it waits a certain period of time for sensors to call in, orders the array based on the address, and goes from there...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19109"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 1-wire sensor order</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Sat, 08/03/2014 - 18:00.</div>
    <div class="content">
     <p>Ok, I think you are right, the sensors always seem to respond in the same order.</p>
<p>I now have 8 temperature sensors up and running. &nbsp;I actually cannot see why this could not be put in by default as they would just return 0 where there is no value/sensor. &nbsp;I have it set so the strut has space for 9 although only 8 are fitted/discovered.</p>
<p>I used a constant for the max number of sensors and so only one thing needs to be changed in the sketch to vary the max number of sensors it will report.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19114"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 1-wire sensor order</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 08/03/2014 - 23:10.</div>
    <div class="content">
     <p>The library issues the &quot;Search ROM [F0h]&quot; command, and for that the data sheet refers to the &quot;iButton&reg; Book of Standards at <a href="http://www.maxim-ic.com/ibuttonbook."" title="www.maxim-ic.com/ibuttonbook.&quot;">www.maxim-ic.com/ibuttonbook.&quot;</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19116"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: 1-wire sensor order</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Sun, 09/03/2014 - 06:59.</div>
    <div class="content">
     <p>The order is due to the search algorithm that 1-Wire uses. Essentially it says &quot;Everyone show me your first bit&quot;. Everything on the bus tries at the same time. The bus will return a logical AND of the values returned - if you get a 1, everything has a 1. If you get a 0, it could be everything is 0 or a mixture.&nbsp;</p>
<p>So then the master asks for the complement of the first bit. If you had a 1 the first time, and now a 0, you know all devices have 1 in this position. If you had a 0 the first time, and now a 1, you know all devices have a 0 in this position. If you get 0 and then 0, you know there is a mixture. (1 and 1 is an error!).</p>
<p>So if you know there is a mixture of 1s and 0s, you the master then says &quot;For the next bit, only devices with a 1 as their MSB respond&quot;. This then means that you know that the devices from this point in the search all have 1 as their MSB. You keep on going down this tree until you have the entire address of the first device.</p>
<p>To get the next address, you do the same search again, but take a different branch.</p>
<p>The implementation of this is in software so the order from one implementation to another could differ.&nbsp;</p>
<p>All details in this app note:</p>
<p><a href="http://www.maximintegrated.com/app-notes/index.mvp/id/187" title="http://www.maximintegrated.com/app-notes/index.mvp/id/187">http://www.maximintegrated.com/app-notes/index.mvp/id/187</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/4026"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-wA0EIrOgZXnK7M3dlABX8FDhEAU9tGIyjBvU0wj0l2c" value="form-wA0EIrOgZXnK7M3dlABX8FDhEAU9tGIyjBvU0wj0l2c"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/4026 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:03:26 GMT -->
</html>
