<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/580 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:07:06 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Questions about programming | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Questions about programming</h3>
        <span class="submitted">Submitted by Guest on Thu, 12/04/2012 - 06:07</span>
        <div class="content"><p>&nbsp;</p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">I have some questions regarding the old version of programming please, which I can&#39;t understand:</p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">&nbsp;</p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">1)The&quot; &nbsp;Ac_Wall_Voltage 122 &quot; is it the voltage from the mains??</p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">&nbsp; &nbsp; The &quot; AC_Adapter_Voltage 15.2&quot; is it the voltage on the voltage adapter, for example the 9 Volts that you standardized??</p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">&nbsp;</p>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	2)// Initial gueses for ratios, modified by VCAL/ICAL tweaks</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp; &nbsp;#define AC_ADAPTER_RATIO &nbsp; &nbsp; &nbsp; (AC_WALL_VOLTAGE / AC_ADAPTER_VOLTAGE)</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp; &nbsp;double V_RATIO = AC_ADAPTER_RATIO * AC_VOLTAGE_DIV_RATIO * 5 / 1024 * VCAL;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp; &nbsp;double I_RATIO = (long double)CT_TURNS / CT_BURDEN_RESISTOR * 5 / 1024 * ICAL;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp; I cant understand the reasoning of the calculations of the ratio</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	3)When you are doing the high pass filter :</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp; &nbsp;filteredV = 0.996*(lastFilteredV+sampleV-lastSampleV);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp; &nbsp;filteredI = 0.996*(lastFilteredI+sampleI-lastSampleI);</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	I cant understand &nbsp;why you are doing filtering.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	If someone can help me please.</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	Thank you</div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp; &nbsp;</div>
  <div class="forum-topic-navigation clear-block">
          <a href="624.html" class="topic-previous" title="Go to previous forum topic">‹ Location of library files</a>
              <a href="654.html" class="topic-next" title="Go to next forum topic">Solar hot water  acces denied ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-3780"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 12/04/2012 - 07:01.</div>
    <div class="content">
     <p>Ac_Wall_Voltage is the mains voltage yes.</p>
<p>AC_Adapter_Voltage: yes the output voltage of the ac-ac adapter (9v)</p>
<p>Maybe the word ratio is unclear, V_RATIO and I_RATIO are the final voltage and current calibration including the fine tuning calibration given by ICAL and VCAL.&nbsp;</p>
<p>Have a look at this page, it might help to shed some light on the calibration equation calculation:&nbsp;http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor-installation-and-calibration-theory</p>
<p>The high pass filter is required to subtract the 2.5V bias provided by the biasing voltage divider in the CT and Voltage circuit: <a href="https://learn.openenergymonitor.org/?redirect=ct-sensors-interface" title="http://openenergymonitor.org/emon/buildingblocks/ct-sensors-interface">http://openenergymonitor.org/emon/buildingblocks/ct-sensors-interface</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3821"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Sat, 14/04/2012 - 11:08.</div>
    <div class="content">
     <p><span style="font-size:12px;">Im sorry if Im asking too much...</span></p>
<p><span style="font-size:12px;">1)I read the links you gave me but if im not using the emontx.. therefore the AC_VOLTAGE_DIV_RATIO is not 11 for me? since im not using R13 and R14. My resistors are 10K&nbsp;ohm and not 3.3V but 5V... so how am I going to find my ratio.</span></p>
<p><span style="font-size:12px;">When I read about the filtering, I only found this sentence:</span></p>
<p><span style="font-size:12px;">&#39;<span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">but this is immediately removed by a software filter, &#39;</span></span></p>
<p><span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">and you just chose 10K ohm for R 3 and R4 to be equal. that is I can choose any other number for resistor as long as they are equal and not high enough to increase noise</span></span></p>
<p><span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">​so actually I still cant understand the reason behind all, for example why it is multiplied by 0.996 and why the equation is like that:</span></span></p>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	<span style="font-size:12px;">&nbsp; filteredV = 0.996*(lastFilteredV+sampleV-lastSampleV);</span></div>
<div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	<span style="font-size:12px;">&nbsp; &nbsp;filteredI = 0.996*(lastFilteredI+sampleI-lastSampleI);</span></div>
<p><span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">2)​So the ICAL and VCAL&nbsp;and also the PHASECAL&nbsp;I need to find them by trial and error right? That is I clip on a normal reader, see what I get, then try with my arduino and try to arrange them to get close to the other. In order to be used in the ratio...</span></span></p>
<p><span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">​The part of the ratio I understood from the links above...</span></span></p>
<p>&nbsp;</p>
<p><span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">​I am really sorry if I am asking too much.. however I would like to build my own software on something similar , and here is the only help I can find. But first I have to understand your software in order to build mine.</span></span></p>
<p><span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">Thanks again</span></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3829"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 20/04/2012 - 07:45.</div>
    <div class="content">
     <p>A little more explanation:</p>
<blockquote><p>&quot;1) .... <span style="font-size:12px;">so how am I going to find my ratio.&quot;</span></p>
</blockquote>
<p><span style="font-size: 12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 17px; text-align: left;">See here: </span></span><a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory">http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor-installation-and-calibration-theory&nbsp;</a>&nbsp; <span style="font-size:12px;">You do not say exactly what you have, So I cannot tell you what to do.&nbsp; You </span>will need to compare what you have with the standard emonTx circuit and follow through the reasoning in the link above.</p>
<blockquote><p>&quot;<span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">and you just chose 10K ohm for R 3 and R4 to be equal. that is I can choose any other number for resistor as long as they are equal and not high enough to increase noise&quot;</span></span></p>
</blockquote>
<p><span style="font-size: 12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 17px; text-align: left;">Yes - and provided that they are not very low either. Noise will not be a problem with 10 K Ohm resistors.</span></span></p>
<blockquote><p>&quot;<span style="font-size:12px;">filteredV = 0.996*(lastFilteredV+sampleV-lastSampleV);&quot;</span></p>
</blockquote>
<p><span style="font-size: 12px;">This is a standard software high pass filter. See here: </span><a href="https://en.wikipedia.org/wiki/High-pass_filter">https://en.wikipedia.org/wiki/High-pass_filter</a> <span style="font-size: 12px;">for the full theory (scroll down to &quot;</span><span class="mw-headline" id="Algorithmic_implementation">Algorithmic implementation&quot;</span>). <span style="font-size: 12px;">The best way to understand it is to simulate it with a spreadsheet and study how it works (Hint: filteredV and sampleV are the current line on the spreadsheet, lastFilteredV and lastSampleV are the line above. Start with a simple step of &#39;sampleV&#39; and watch how &#39;filteredV slowly settles back towards zero). &quot;0.996&quot; controls the time constant. </span></p>
<blockquote><p>&quot;<span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">2)​So the ICAL and VCAL&nbsp;and also the PHASECAL&nbsp;I need to find them by trial and error right?&quot;</span></span></p>
</blockquote>
<p><span style="font-size: 12px;"><span style="color: rgb(0, 0, 0); font-family: Verdana,Arial,Helvetica,sans-serif; line-height: 17px; text-align: left;">For your starting point for these, see here: </span></span><a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory">http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor-installation-and-calibration-theory</a>&nbsp;&nbsp; Again, you will have to follow the reasoning and calculate your own equations using the numbers from the components you are using. If you can measure voltage and current with another accurate meter, then you can adjust the calibration constants to make the Arduino show the same values. Otherwise, use the theoretical calibration constants.</p>
<p>[edited: wrong page referenced]</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3977"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Mon, 23/04/2012 - 12:52.</div>
    <div class="content">
     <p><span style="font-size:12px;">thanks a lot</span></p>
<p>&nbsp;</p>
<p><span style="font-size:12px;">1)if I add this program to the xbee send part. therefore i should add it under:</span></p>
<p><span style="font-size:12px;">xbeeSerial.begin(9600);</span></p>
<p><span style="font-size:12px;">2)and another thing, under each : Serial.print(&#39; &nbsp;&#39;); should i write :&nbsp;sendDataToXbee(); or should I just write it after I reset the accumulators.. because if I put it after the program ends, absviously&nbsp;the accumulators will be reset to zero and therefore the xbee will send just zeros</span></p>
<div>
	&nbsp;</div>
<div>
	<span style="font-size:12px;">4) I dont have an emonTx&nbsp;all im using is the&nbsp;<span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">AC mains non-invasive V3 &nbsp;version, so thats why Im&nbsp;finding it difficult to find my ratio. I am using and arduino of 5 V, &nbsp;9V&nbsp;voltage sensor the ct senor Yhdc SCT-013-00. and for voltage the circuit is the same as yours 100 Kohm and 3 * 10Kohm, while the current part has a burden of 33 ohm and 2 * 10Kohm</span></span></div>
<h1 style="margin-bottom: 0.5em; font-size: 1.5em; font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
	&nbsp;</h1>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3980"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 23/04/2012 - 18:46.</div>
    <div class="content">
     <blockquote><p>&quot;<span style="font-size:12px;">1)if I add this program to the xbee send part. therefore i should add it under:</span></p>
<p><span style="font-size:12px;">xbeeSerial.begin(9600);</span>&quot;</p>
</blockquote>
<p>What program?&nbsp; The operating system of the Arduino calls two functions. When it starts it calls setup( ). When that returns, it enters a loop, calling loop( ) repeatedly. (The clue is in the names!). So anything you want done repeatedly goes in loop( ). The EnergyMonitor::calibration( ) method - look at Emon.h to see how it&#39;s defined and in Emon.cpp to see what it does - just sets the calibration constants. Hopefully, these never need to change, so it naturally goes into setup( ).</p>
<blockquote><p>&quot;<span style="font-size:12px;">2)and another thing,&quot;</span></p>
</blockquote>
<p><span style="font-size: 12px;">Haven&#39;t you answered your own question here? Is your real problem that you don&#39;t understand the language the program is written in? If so, try working through this </span><a href="http://www.relisoft.com/book/index.htm">http://www.relisoft.com/book/index.htm</a></p>
<blockquote><p>&quot;<span style="font-size:12px;">4) I dont have an emonTx&nbsp;all im using is the&nbsp;<span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">AC mains non-invasive V3 &nbsp;version, so thats why Im&nbsp;finding it difficult to find my ratio. &quot;</span></span></p>
</blockquote>
<p>Yes, but you need to follow exactly the same reasoning. Look at the circuit diagram for the emonTx and look at the calibration theory, and relate one to the other. Then draw out your circuit diagram (with pencil and paper ! ) for the voltage input from mains to input pin; then write out the program calculations from reading the input to transmitting the final value and write on the paper all the calculations using the real numbers along the way. Of course you must substitute the values of your components. As you do this, you will see how to generate your own calibration constant.</p>
<p>Then do the same for current.</p>
<p>You might have a problem working out the voltage from the voltage sensor if it is not one that we have accurate data for, in that case you will need to monitor the mains voltage and adjust the calibration constant by trial and error to get the correct value.</p>
<p>Here&#39;s the exam question: Why do the values of the biasing resistors not enter into the calibration?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3989"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Mon, 23/04/2012 - 23:47.</div>
    <div class="content">
     <p>those are used to provide a 2.5V, that is it would not oscillate from negative to positive as the arduino&nbsp;only needs a positive voltage, if im not mistaken</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3991"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 24/04/2012 - 09:53.</div>
    <div class="content">
     <p>So you are saying the bias resistors do not affect the signal amplitude? Correct !&nbsp; All they do is set the &#39;no load current&#39; (or &#39;no mains voltage&#39; in the case of the voltage input) to the midpoint of the analogue to digital converter&#39;s range.&nbsp;</p>
<p>Also, you need not worry about peak-peak values and rms values, as long as you consistently work in one or the other. As we want to display and use the rms current, it makes sense to work in rms values for all of the calibration calculations. You only need to worry about peak-peak values when you are designing to ensure that the signals remain within the range of the analogue to digital converter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4002"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Tue, 24/04/2012 - 14:00.</div>
    <div class="content">
     <p>exactly they give 2,5V in order to be safe in my case since Im using a 5 V arduino.. for emonTx wich is 3.3V one has to arrange the resistors in order to get 1,5V.&nbsp;</p>
<p>Thanks a lot and sorry for being a pest :D</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4005"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 24/04/2012 - 16:16.</div>
    <div class="content">
     <p>I was a student once - over 40 years ago !&nbsp; Microprocessors didn&#39;t exist then, even the 709 op-amp was cutting edge.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4038"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Wed, 25/04/2012 - 23:01.</div>
    <div class="content">
     <p>:O i think it was really tough engineering back then... and im freaking myself out hahahha trying to figure out this :/..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4043"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Thu, 26/04/2012 - 08:58.</div>
    <div class="content">
     <p>why to find the real power, you still multiply by I_Ratio and V_Ratio, if it is already taken care the ratio to find the RMS of V and I.&nbsp;</p>
<p>I mean the ratio to find the RMS is multiplied by the ratio, in order to take care of the scale down due to the sensors and the circuit. But why is there the need to multiply by I_Ratio and V_ratio to find the real power as well??</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4058"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 27/04/2012 - 00:02.</div>
    <div class="content">
     <p>You are referring to&nbsp; (3) Post loop calculations in EmonLib.cpp</p>
<p>Because you are not using the rms values of current and voltage to obtain power! The sum I think you have in mind [P = V.I.cos(&Oslash;)] only works for pure sine waves. You are not guaranteed pure sine waves in the real world. The voltage wave might be relatively close to a sine wave, but the current wave most certainly will be distorted especially if you have lamp dimmers, switched mode computer power supplies and such.</p>
<p>The correct way to calculate power is exactly as the calculations are done in the software: multiply the <strong><em>instantaneous values</em></strong> of current and voltage [(F) Instantaneous power calc], and then take the mean.</p>
<p>(I think you have mixed up some of the variables when you read through the program).</p>
<p>It&#39;s cheaper (in terms of program execution time) to multiply at the end outside the loop rather than multiply each reading inside the loop, and you get the same answer.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4084"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Sun, 29/04/2012 - 10:04.</div>
    <div class="content">
     <p>thanks :))))))))) ... I wrote all the program now in my own words :D.. now Im waiting for the PCB so I can calibrate all the stuff .. I will soon start the Ethernet part</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4101"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 29/04/2012 - 19:04.</div>
    <div class="content">
     <p><em>Robert Wall, on 2/4/2012:</em></p>
<p><em>&quot;<span style="font-size: 12px;">filteredV = 0.996*(lastFilteredV+sampleV-lastSampleV);&quot;</span></em></p>
<p><em><span style="font-size: 12px;">This is a standard software high pass filter. See here: </span><a href="https://en.wikipedia.org/wiki/High-pass_filter">https://en.wikipedia.org/wiki/High-pass_filter</a> <span style="font-size: 12px;">for the full theory (scroll down to &quot;</span><span class="mw-headline" id="Algorithmic_implementation">Algorithmic implementation&quot;</span>). <span style="font-size: 12px;">The best way to understand it is to simulate it with a spreadsheet and study how it works (Hint: filteredV and sampleV are the current line on the spreadsheet, lastFilteredV and lastSampleV are the line above. Start with a simple step of &#39;sampleV&#39; and watch how &#39;filteredV slowly settles back towards zero). &quot;0.996&quot; controls the time constant. </span></em></p>
<p>Thanks for that really helpful explanation.&nbsp; I&#39;ve just tried out your idea of the spreadsheet demo, and it does indeed behave as you say.&nbsp; Using the time-constant value of 0.996, it takes forever (well, nearly) to settle.&nbsp; To get anywhere near to zero from 10 would take more screen-worths than I&#39;m prepared to scroll down!&nbsp; By changing the time-constant to 0.8, the dc-blocking behaviour can be seen on a more compressed timescale, with 20% of the ac-transmission being sacrificed.</p>
<p>When I switch my Emon system on from cold, crazy readings often appear, but the system thankfully settles down after a few seconds.&nbsp; Maybe this is the dc-blocking filters getting to grips with the 2.5V offsets in our voltage and current readings?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4106"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 29/04/2012 - 21:57.</div>
    <div class="content">
     <p>Yes, it&#39;s the filter.</p>
<p>&quot;<em><span style="font-size: 12px;">The best way to understand it is to simulate it with a spreadsheet...&quot;&nbsp; --</span></em><span style="font-size: 12px;"> Make one cycle of a sine wave in column 1 of the correct amplitude</span> (it need not be very accurate, say every pi/10) , square it in <span style="font-size: 12px;">column</span> 2 and then sum <span style="font-size: 12px;">column</span> 2 and take the root. Do the same with a big offset on the sine wave and see just how crazy the numbers are. It&#39;s obvious really when you think what rms means - it&#39;s the equivalent direct current that gives the same heating effect, so if you add a load of dc to it (in the short term) it will heat a resistor more.</p>
<p>A thought: It ought to be possible to pre-load the filter at startup and reduce (but probably not eliminate) the settling time.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4152"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Fuzzylogic&#039;s picture" title="Fuzzylogic&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Fuzzylogic (not verified) on Tue, 01/05/2012 - 20:34.</div>
    <div class="content">
     <p>Thanks for this great project!</p>
<p>I&#39;m using the calcIrms() function on a PIC (12F1822) to measure -only- the current on a three phase mains line.</p>
<p>It&#39;s working fine, if only using one CT, if i add a second channel in the code, and vary the input of&nbsp; this channel manually with a potentiometer, the measured data on the first channel will be not correct anymore.</p>
<p>I think i found the problem that is causing this behavior. When the loop is started sampleI and filteredI are uninitialized (or contain values from the last channel). So DC settling is taking place every time i switch to the next channel.</p>
<p>I&#39;m currently sampling with 2048 samples, and that seems to be to low. But even increasing it to 4096 samples will not completely remove this &quot;interference&quot; from the previous channel.</p>
<p>A solution for me was to add an extra loop, with a lower time constant for the high pass filter, so that it settles quickly, and once it has, the measurement loop is started</p>
<p>for (int n = 0; n &lt; 100; n++)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; lastSampleI = sampleI;<br />
	&nbsp;&nbsp;&nbsp; sampleI = analogRead(inPinI);<br />
	&nbsp;&nbsp;&nbsp; lastFilteredI = filteredI;<br />
	&nbsp;&nbsp;&nbsp; filteredI = 0.9*(lastFilteredI+sampleI-lastSampleI);<br />
	&nbsp; }</p>
<p>I&#39;ve ordered a emonTx today, so i soon will be able to verify this on the official hardware too.</p>
<p>
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4156"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 01/05/2012 - 22:48.</div>
    <div class="content">
     <p>You are programming in C++?&nbsp;</p>
<p>The two channels should each be using their own instance of the EnergyMonitor class, so each uses its own set of properties inside the filter equation (assuming you have copied the standard emonTx sketch and library).</p>
<p>e.g. you declare:&nbsp; EnergyMonitor ct1,ct2;&nbsp;</p>
<p>When you do this, you actually have (seen from outside of the calc( ) method and assuming those properties/variables to be visible, which they are not)</p>
<p>when you are looking at ct1:</p>
<blockquote><p>ct1.lastSampleI = ct1.sampleI;</p>
</blockquote>
<p>when you are looking at ct2:</p>
<blockquote><p>ct2.lastSampleI = ct2.sampleI;</p>
</blockquote>
<p>etc. and the two channels will not interact.</p>
<p>If you are not using C++ or other object-oriented language, then you need a second set of variables with different names for the second channel.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4162"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Fuzzylogic&#039;s picture" title="Fuzzylogic&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Fuzzylogic (not verified) on Wed, 02/05/2012 - 10:40.</div>
    <div class="content">
     <p>That was the problem. Thanks for the correct solution.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4178"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Thu, 03/05/2012 - 06:10.</div>
    <div class="content">
     <p>can anyone give me any light on the programming of the ethernet&nbsp;shield and xbee receive together???</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4196"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Polidano&#039;s picture" title="Polidano&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by Polidano (not verified) on Fri, 04/05/2012 - 06:16.</div>
    <div class="content">
     <p>&nbsp;</p>
<div>
	&nbsp;//Calculation of Powers</div>
<div>
	&nbsp;Real_Power=V_final*I_final*total_P/3000; &nbsp;</div>
<div>
	&nbsp;Apparent_Power=RMS_V*RMS_I;</div>
<div>
	&nbsp;PF=Real_Power/Apparent_Power;</div>
<div>
	&nbsp;</div>
<div>
	//Send data trough Xbee</div>
<div>
	Serial.print(Real_Power);</div>
<div>
	xbeeSerial.print(&#39; &#39;);</div>
<div>
	&nbsp;</div>
<div>
	Serial.print(Apparent_Power);</div>
<div>
	xbeeSerial.print(&#39; &#39;);</div>
<div>
	&nbsp;</div>
<div>
	Serial.print(PF);</div>
<div>
	xbeeSerial.print(&#39; &#39;);</div>
<div>
	&nbsp;</div>
<div>
	Serial.print(RMS_V);</div>
<div>
	xbeeSerial.print(&#39; &#39;);</div>
<div>
	&nbsp;</div>
<div>
	Serial.print(RMS_I);</div>
<div>
	xbeeSerial.print(&#39; &#39;);</p>
<p>	I wrote the send part like that.. should I close it in a loop or it is good like that?? and therefore on the receive part i should only add to the ethernet program this:</div>
<div>
<div>
		&nbsp;</div>
<div>
<div>
			//Ethernet unit arduino sketch - openenergymonitor.org GPL</div>
<div>
			//Author: Trystan Lea</div>
<div>
			&nbsp;</div>
<div>
			//Libraries</div>
<div>
			#include &lt;Ethernet.h&gt;</div>
<div>
			#include &lt;NewSoftSerial.h&gt;</div>
<div>
			&nbsp;</div>
<div>
			//Sets the unique mac address for the ethernet board</div>
<div>
			byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED };</div>
<div>
			//Sets the IP address of the ethernet board</div>
<div>
			//You need to make sure this is in the right range.</div>
<div>
			//A good way to check is to find the ip of other things in your house like a laptop</div>
<div>
			//and set the ethernet to be a similar ip for example if your laptop is&nbsp;</div>
<div>
			//192,168,1,45 set your ethernet ip to</div>
<div>
			//192,168,1,44 (as long as there is nothing else on this address)</div>
<div>
			byte ip[] = { 192, 168, 1, 44 };</div>
<div>
			&nbsp;</div>
<div>
			//Router IP address</div>
<div>
			byte gateway[] = { 192, 168, 1, 253 };</div>
<div>
			//Server IP address</div>
<div>
			byte server[] = { 85, 92, 86, 84 }; //OpenEnergyMonitor.org shared server</div>
<div>
			&nbsp;</div>
<div>
			//Setup a client</div>
<div>
			Client client(server, 80);</div>
<div>
			&nbsp;</div>
<div>
			//Xbee serial connection.</div>
<div>
			NewSoftSerial xbeeSerial(2, 3);</div>
<div>
			&nbsp;</div>
<div>
			//Character array used to convert recieved serial characters to floats.</div>
<div>
			char cArray[10];</div>
<div>
			int ic=0;</div>
<div>
			&nbsp;</div>
<div>
			double realPower = 0,&nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp;apparentPower = 0,</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp;powerFactor = 0,</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp;Vrms = 0,</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp;Irms = 0,</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp;Freq = 0;</div>
<div>
			&nbsp;</div>
<div>
			//Used to determine significant change - detailed below.</div>
<div>
			int currentValue, lastValue, secondLastValue;</div>
<div>
			&nbsp;</div>
<div>
			int lastValueSent;</div>
<div>
			//Significant change of more than 20W in this case.</div>
<div>
			int differenceThreshold = 20;</div>
<div>
			&nbsp;</div>
<div>
			&nbsp;</div>
<div>
			void setup() &nbsp; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</div>
<div>
			&nbsp;&nbsp;</div>
<div>
			&nbsp; //Start ethernet, usb serial and xbee serial.</div>
<div>
			&nbsp; Ethernet.begin(mac, ip, gateway);</div>
<div>
			&nbsp;&nbsp;</div>
<div>
			&nbsp; //Serial.begin(9600); &nbsp;</div>
<div>
			&nbsp;&nbsp;</div>
<div>
			&nbsp; xbeeSerial.begin(9600);</div>
<div>
			&nbsp;</div>
<div>
			&nbsp; delay(1000);</div>
<div>
			&nbsp;&nbsp;</div>
<div>
			}</div>
<div>
			&nbsp;</div>
<div>
			//Reads in data from xbee, converting the character stream to floats.</div>
<div>
			int readXbeeData()</div>
<div>
			{</div>
<div>
			&nbsp; &nbsp;int done = 0;</div>
<div>
			&nbsp; &nbsp;</div>
<div>
			&nbsp; &nbsp;int inByte;</div>
<div>
			&nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp;while (xbeeSerial.available() &gt; 0)&nbsp;</div>
<div>
			&nbsp; &nbsp;{</div>
<div>
			&nbsp; &nbsp; &nbsp; //Read in a byte</div>
<div>
			&nbsp; &nbsp; &nbsp; inByte = xbeeSerial.read();</div>
<div>
			&nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; //Serial.print((char)inByte);</div>
<div>
			&nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; //Each value send is marked with a character</div>
<div>
			&nbsp; &nbsp; &nbsp; //atof converts the character array to a float.</div>
<div>
			&nbsp; &nbsp; &nbsp; if (inByte==&#39;A&#39;) realPower = atof(cArray);</div>
<div>
			&nbsp; &nbsp; &nbsp; if (inByte==&#39;B&#39;) apparentPower = atof(cArray);</div>
<div>
			&nbsp; &nbsp; &nbsp; if (inByte==&#39;C&#39;) powerFactor = atof(cArray);</div>
<div>
			&nbsp; &nbsp; &nbsp; if (inByte==&#39;D&#39;) Vrms = atof(cArray);</div>
<div>
			&nbsp; &nbsp; &nbsp; if (inByte==&#39;E&#39;) Irms = atof(cArray);</div>
<div>
			&nbsp; &nbsp; &nbsp; if (inByte==&#39;F&#39;) {Freq = atof(cArray); done = 1;}</div>
<div>
			&nbsp; &nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; //If the recieved byte is a digit (specified by ASCII values 65 to 90)</div>
<div>
			&nbsp; &nbsp; &nbsp; if (inByte&gt;64 &amp;&amp; inByte&lt;91)&nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; {</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ic=0;</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for(int i=0; i&lt;10; i++) cArray[i] = 0;</div>
<div>
			&nbsp; &nbsp; &nbsp; }</div>
<div>
			&nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; //If the recieved byte is a digit (specified by ASCII values 65 to 90)</div>
<div>
			&nbsp; &nbsp; &nbsp; //or a decimal point ASCII 46</div>
<div>
			&nbsp; &nbsp; &nbsp; if ((inByte&gt;47 &amp;&amp; inByte&lt;58) || inByte==46) &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; {</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//add to character array</div>
<div>
			&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cArray[ic] = inByte; ic++;</div>
<div>
			&nbsp; &nbsp; &nbsp; }</div>
<div>
			&nbsp; &nbsp;}</div>
<div>
			&nbsp; &nbsp;</div>
<div>
			&nbsp; &nbsp;//Return status</div>
<div>
			&nbsp; &nbsp;return done;</div>
<div>
			}</div>
<div>
			&nbsp;</div>
<div>
			&nbsp;</div>
<div>
			void loop() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</div>
<div>
			{</div>
<div>
			&nbsp;</div>
<div>
			if (readXbeeData()==1){</div>
<div>
			&nbsp;&nbsp;</div>
<div>
			&nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; /*In order to reduce the number of server calls, data is only sent when there is</div>
<div>
			&nbsp; &nbsp; a significant change in power consumption. This means that we get rid of the&nbsp;</div>
<div>
			&nbsp; &nbsp; needless detail but keep the very definite change in power consumption when it</div>
<div>
			&nbsp; &nbsp; does change significantly (The detailed data can be stored on the USB pen)</div>
<div>
			&nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; //To determine if there has been a significant change we compare the last value</div>
<div>
			&nbsp; &nbsp; with the current value if the difference is &gt; differenceThreshold then a significant</div>
<div>
			&nbsp; &nbsp; change has happend. But to make sure its significant and lasting, not just a blip we</div>
<div>
			&nbsp; &nbsp; also compare the current value to the 2nd last value.*/</div>
<div>
			&nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; //Set the 2nd last value</div>
<div>
			&nbsp; &nbsp; secondLastValue = lastValue;</div>
<div>
			&nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; //Set the last value</div>
<div>
			&nbsp; &nbsp; lastValue = currentValue;</div>
<div>
			&nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; //Set the current</div>
<div>
			&nbsp; &nbsp; currentValue=(int)realPower;</div>
<div>
			&nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; //Do the comparison</div>
<div>
			&nbsp; &nbsp; if (abs(currentValue-lastValue)&gt;differenceThreshold &amp;&amp; abs(currentValue-secondLastValue)&gt;differenceThreshold){</div>
<div>
			&nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; //Send the data</div>
<div>
			&nbsp; &nbsp; if (client.connect()) { &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; //Accessing a shared server requires the server domain name in here as there is no fixed ip address.</div>
<div>
			&nbsp; &nbsp; &nbsp; //If your accessing a shared server you need to add your URL &quot;GET http://yourwebsite.org/cgi-bin/post.pl?L=&quot;</div>
<div>
			&nbsp; &nbsp; &nbsp; //This is because a shared server shares one fixed IP between many users, its the url that points to your website on the shared hosting.</div>
<div>
			&nbsp; &nbsp; &nbsp; client.print(&quot;GET <a href="http://power.openenergymonitor.org/cgi-bin/test.pl?L=%22" title="http://power.openenergymonitor.org/cgi-bin/test.pl?L=&quot;">http://power.openenergymonitor.org/cgi-bin/test.pl?L=&quot;</a>);</div>
<div>
			&nbsp; &nbsp; &nbsp;</div>
<div>
			&nbsp; &nbsp; &nbsp; client.print(lastValueSent);</div>
<div>
			&nbsp; &nbsp; &nbsp; client.print(&quot;&amp;C=&quot;);</div>
<div>
			&nbsp; &nbsp; &nbsp; client.print(currentValue);</div>
<div>
			&nbsp; &nbsp; &nbsp; lastValueSent=currentValue;</div>
<div>
			&nbsp; &nbsp; &nbsp; client.println();</div>
<div>
			&nbsp; &nbsp; &nbsp; client.stop();</div>
<div>
			&nbsp; &nbsp; } else {</div>
<div>
			&nbsp; &nbsp; &nbsp; //Serial.println(&quot;Failed to connect to client&quot;);</div>
<div>
			&nbsp; &nbsp; }</div>
<div>
			&nbsp;</div>
<div>
			&nbsp; &nbsp; delay(1000);</div>
<div>
			&nbsp; &nbsp;&nbsp;</div>
<div>
			&nbsp; &nbsp; }</div>
<div>
			&nbsp;</div>
<div>
			&nbsp;</div>
<div>
			}</div>
<div>
			&nbsp;</div>
<div>
			}</div>
<div>
			&nbsp;</div>
<div>
			&nbsp;</div>
<div>
			This will go from one to the next.. as in from the apparent power to the pf or i should write it for each and everyone??</div>
</div>
</div>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4346"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Questions about programming</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 10/05/2012 - 10:07.</div>
    <div class="content">
     <p>Hello Polidano</p>
<p>Best way to program xbee and ethernet together, is to start by getting xbee&nbsp;each part to work independently of each other. Maybe for now drop using my code that you have pasted above and try and assemble the code you need from the examples given by the xbee and ethernet libraries. There are a few things going on in my code above that you may not need and its quite old so you may run into problems with the latest libraries etc.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/580"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Q_yKRDDQQaVHOK-dL8US-d_UI1iLNjcSzp-YBTr0xWE" value="form-Q_yKRDDQQaVHOK-dL8US-d_UI1iLNjcSzp-YBTr0xWE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/580 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:07:06 GMT -->
</html>
