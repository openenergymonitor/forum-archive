<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>SD Card Life | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/5">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">SD Card Life</h3>
        <span class="submitted">Submitted by <a href="/emon/user/4861" title="View user profile.">doddz3h</a> on Mon, 01/06/2015 - 12:33</span>
        <div class="content"><p>Hi all,</p>
<p>My SD card on my pi running the low write emoncms finally succumbed to wear and tear after almost 2&nbsp;years of continued usage. I don&#39;t know if it is a definite tell tale sign but there was a big drop off in performance of emoncms weeks before the doom hit.&nbsp;This gives me an excuse to upgrade to the latest version now and migrate my backup data (Any advice?).</p>
<p>I was prepared, are you? <strong>Set your backups!</strong></p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/10877" class="topic-previous" title="Go to previous forum topic">‹ Emoncms export data problem</a>
              <a href="/emon/node/10838" class="topic-next" title="Go to next forum topic">emonPi:  why no built-in support for backups? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-30855"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3" title="View user profile.">TrystanLea</a> on Tue, 02/06/2015 - 15:18.</div>
    <div class="content">
     <p>Thanks for letting us know, is it 2 years already!?</p>
<p>What form is your backup in? mysqldump? and feed data files?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30938"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4861" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4861.jpg" alt="doddz3h&#039;s picture" title="doddz3h&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4861" title="View user profile.">doddz3h</a> on Fri, 05/06/2015 - 10:12.</div>
    <div class="content">
     <p>Yeah I had mysql&nbsp;dumps done, now I realise that may not have been enough :(&nbsp;I&#39;m going to download some forensic tools to see if I can rescue any of the scripts and stuff I had sitting on there I hadn&#39;t backed up.&nbsp;</p>
<p>Going forward for the new install I&#39;m going to look into tarsnap&nbsp;as an offsite backup solution for the data partition, seems like it will plug in and be relatively cheap to hold.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-30948"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3016" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3016" title="View user profile.">dBC</a> on Fri, 05/06/2015 - 23:37.</div>
    <div class="content">
     <p>I&#39;ve been using tarnsap&nbsp;(not for emoncms stuff)&nbsp;for well over a year now, and am very impressed with it. &nbsp;I&#39;ve now got &quot;110GB&quot; of tar files stored with them, or at least that&#39;s how it appears to me (to their servers it appears as about 850MB). &nbsp;Each of my full backups is about 2.2GB, but thanks to the magic of block de-duplication and compression, a full backup takes just moments&nbsp;and results in just a few hundred kB being written to the cloud (subject to how active I&#39;ve been). &nbsp;Some days it shows an entire day&#39;s work can be summed up in just a few kBs! &nbsp;My initial $5 deposit has been depleted down to $2.57.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31083"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8255" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="goodfidelity&#039;s picture" title="goodfidelity&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8255" title="View user profile.">goodfidelity</a> on Tue, 09/06/2015 - 19:46.</div>
    <div class="content">
     <p>Hello guys, sorry for the loss..</p>
<p>&nbsp;</p>
<p>I had an idea about how to make smaller changes to the setup on the pi in order to get a more durable system. I am not a unix&nbsp;wiz and dont know how much of this is possible in reality. But using common services as dropbox, and OS features like RAM disk might help us out in creating systems that will run forever and never need manual backup. If this can be automated it will really be useful.</p>
<p>&nbsp;</p>
<p>Imagine &quot;time machine&quot; (Built in OS X super simple backup feature)&nbsp;like backup from the raspberry to dropbox or any other free service.</p>
<p>I wrote som in this thread about the idea, feel free to comment.</p>
<p><a href="http://openenergymonitor.org/emon/node/10812" title="http://openenergymonitor.org/emon/node/10812">http://openenergymonitor.org/emon/node/10812</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31091"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3426" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3426" title="View user profile.">Bill Thomson</a> on Tue, 09/06/2015 - 03:03.</div>
    <div class="content">
     <p>Here&#39;s a daemon that would help extend flash memory life. Excerpted from the author&#39;s webpage:</p>
<p><em>Ramlog act as a system daemon. On startup it creates ramdisk, it copies files from /var/log into ramdisk and mounts ramdisk as /var/log. All logs after that will be updated on ramdisk. Logs on harddrive are kept in folder /var/log.hdd which is updated when ramlog is restarted or stopped. On shutdown it saves log files back to harddisk so logs are consistent. Ramlog 2.x is using tmpfs by default, ramfs and kernel ramdisk are suppored as well. Program rsync is used for log synchronization.</em></p>
<p>I&#39;ve been running it on an early Model B Pi since Sep of 2014, and have not had any problems with it.</p>
<p>Site URL: <a href="http://www.tremende.com/ramlog/">www.tremende.com/ramlog/</a></p>
<p>Ramlog is GPLv3 software.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31107"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4861" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4861.jpg" alt="doddz3h&#039;s picture" title="doddz3h&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4861" title="View user profile.">doddz3h</a> on Tue, 09/06/2015 - 13:31.</div>
    <div class="content">
     <p>Wow, that is&nbsp;an encouraging insight dBC! Glad to hear that setup is working well for you.&nbsp;I hope that a $5 deposit will last a long time.</p>
<p>goodfidelty and Bill, the prospects of RAMdisk and ramlog&nbsp;seem interesting. Maybe Trystan&nbsp;can throw in his 2 cents because I remember in the early days the read/write topic&nbsp;received some investigation and these ideas/tools may have been considered already.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31128"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8255" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="goodfidelity&#039;s picture" title="goodfidelity&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8255" title="View user profile.">goodfidelity</a> on Tue, 09/06/2015 - 19:43.</div>
    <div class="content">
     <p>Yepp.</p>
<p>&nbsp;</p>
<p>In my opinion the dropbox idea should be considered as an option for all users anyways, a nice online automatic backup of the database would be very nice.</p>
<p>I am not very well aware of other system settings that needs to be backuped, but using an automated script that keeps settings, scripts, plugins or whatever backed up together with database to dropbox account would be almost to good to be true =)</p>
<p>Having the same script in the pre installed SD image file with an option to recover from backup would make it just to easy when making new installations. Just put dropbox user ID and PW and everything is just where you left it.</p>
<p>Dropbox is free, and by inviting friends you can get as much as 16Gb of free data. I am not sure but i guess that will cover many years of usage. And for customers who like to pay for this service i am sure its still a good feature.</p>
<p>The whole RAM Disk idea i think needs more tinkering. But i am sure that anyone with some LINUX experience can get it done.</p>
<p>//J</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31144"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8263" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Steve&#039;s picture" title="Steve&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8263" title="View user profile.">Steve</a> on Wed, 10/06/2015 - 08:45.</div>
    <div class="content">
     <p>Raspbian on the Pi is already using the RAM Disk feature for its temporary files.&nbsp; The Unix name for this is &quot;tmpfs&quot; as described here: <a href="https://en.wikipedia.org/wiki/Tmpfs">Wikipedia article on tmpfs</a></p>
<p>We have 6 separate tmpfs filesystems in the Pi&#39;s RAM -- /dev, /tmp, /var/log and 3 under /run.</p>
<p>Indeed it would be possible to use another tmpfs for data logging.&nbsp; My emonPi durrently has 740 Mbytes of memory free, so it would be safe to allocate maybe 200M for this purpose.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31380"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8255" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="goodfidelity&#039;s picture" title="goodfidelity&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8255" title="View user profile.">goodfidelity</a> on Tue, 16/06/2015 - 22:24.</div>
    <div class="content">
     <p>Thank you Steve for this valuable input.</p>
<p>&nbsp;</p>
<p>Maybe you know how much data is created in one month of average logging? Is 200Mb enough for one year or so? I think it will probably be more then enough.</p>
<p>How much of a hassle will it be to reconfigure the emonSD card to make all the logging to ramdisk in the low write mode?</p>
<p>Will there be any major savings to read/write cycles on the SD if everything is logged to the RAM and later to the SD maybe once every day? Maybe this can be done with RAR or something to save space and cycles?</p>
<p>I think this is one very important feature for the whole system, to be durable and redundant.</p>
<p>//J</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8255" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="goodfidelity&#039;s picture" title="goodfidelity&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8255" title="View user profile.">goodfidelity</a> on Tue, 16/06/2015 - 22:27.</div>
    <div class="content">
     <p>I just want to add this link for cross reference:</p>
<p>&nbsp;</p>
<p><a href="http://openenergymonitor.org/emon/node/10812" title="http://openenergymonitor.org/emon/node/10812">http://openenergymonitor.org/emon/node/10812</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31416"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8263" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Steve&#039;s picture" title="Steve&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8263" title="View user profile.">Steve</a> on Wed, 17/06/2015 - 10:49.</div>
    <div class="content">
     <p>One year of logging will be no problem.&nbsp; My Pi uses the PHPFINA engine and the files named /home/pi/data/phpfina/NN.dat (where NN is the feed number) grow by 24 bytes every minute.</p>
<p>That&#39;s 34 kbytes for a day and 12 Mbytes for a year.&nbsp; I have 3 feeds (house, solar and solar kWh) so altogether 36 Mbytes of logged data in one year.</p>
<p>Logging to RAM would take a small amount of scripting.&nbsp; After a reboot we begin with an empty RAM filesystem, so a boot-time script must set up the logging directories.</p>
<p>Of course data will be lost at any power failure or reboot, so your idea to copy back to SD once a day is good.&nbsp; Compression will help -- I tried gzip on one of my .dat files and the compressed data is 30% of the original.&nbsp; The big saving is in not writing the directory (actually the inodes) every minute.</p>
<p>For my 3 feeds, Linux on the Pi reports 6 kbytes per minute written to the&nbsp;mmcblk0p3 filesystem, the one with the logs.&nbsp; Much more than 3*24 bytes due to the directory overheads and the 1k filesystem blocksize.&nbsp; I used this command to get the bytes written, then checked again 10 minutes later:</p>
<pre>
iostat -p /dev/mmcblk0</pre><p>Inside the SD card the bytes written will be even more than 6k/minute due to blocksizes and wear levelling.&nbsp; So a daily copy from RAM would be a big improvement.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31419"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Wed, 17/06/2015 - 11:21.</div>
    <div class="content">
     <p>I don&#39;t think moving the data feeds to RAM will improve much as when&nbsp;the existing SDcard image is&nbsp;using low-write emoncms the data is already buffered in RAM and then written to disk once&nbsp;every minute, this minimizes the data loss if there is a restart to 1 min at&nbsp;most.</p>
<p>As your calculations show the writing of the data to the data feeds is minimal and that part itself would take an eternity to wear out a SD card as the same part is never written to twice, even editing and rewriting past data has been&nbsp;prohibited. I believe the main cause of SDcard burnout is the use of mySQL, The indexing (and &quot;last value&quot; and &quot;time of last update&quot; type fields) will constantly be rewritten and quickly hit the wear limits for a particular location.</p>
<p>Perhaps it is possible to move the mySQL files around as a form of wear leveling or move the sql tables to RAM and write to disc&nbsp;once an hour or so???</p>
<p>Ultimately the way to go would be to replace the SQL&nbsp;tables with text based files&nbsp;but that probably involves a major&nbsp;rewrite of emoncms&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31430"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8263" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Steve&#039;s picture" title="Steve&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8263" title="View user profile.">Steve</a> on Wed, 17/06/2015 - 12:08.</div>
    <div class="content">
     <p>Paul,</p>
<p>On my Pi I can&#39;t see any significant SQL activity.&nbsp; Timestamp on /home/pi/data/mysql/ibdata1 is the time of the last boot. In the emoncms subdirectory the only recent activity is in the &quot;rememberme&quot; table, from a few hours ago when I started a web browser session.</p>
<p>Unless I missed something, all the action is in the phpfina files.&nbsp; (My config is simple -- 2 current sensors, logged to 3 feeds then viewed in My Solar.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31457"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Wed, 17/06/2015 - 19:37.</div>
    <div class="content">
     <p>I know very little about SQL or the intricacies of&nbsp;writing data&nbsp;to&nbsp;the SD card and&nbsp;struggle to understand&nbsp;how writing data to the SDcard&nbsp;in whole blocks once and once only to any single point could significantly&nbsp;contribute to the SDcard wear, I understood&nbsp;that database activity was a main cause of SD card failure so from that I&#39;m led to believe it is databasing&nbsp;but not the feeds themselves, which makes sense (to me) as I expected mySQL&nbsp;indexing and updating to be write intensive and occur frequently in a fairly&nbsp;consistent manner (location and time wise)&nbsp;.</p>
<p>If it isn&#39;t the the SQL indexes then could it be&nbsp;the inode&nbsp;metadata file being updated constantly? if so perhaps an automated process&nbsp;that regularly&nbsp;results in a new (relocated)&nbsp;inode&nbsp;could increase SD card life expectancy.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31463"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3426" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3426" title="View user profile.">Bill Thomson</a> on Wed, 17/06/2015 - 22:18.</div>
    <div class="content">
     <p>Here&#39;s an interesting read about how the way an SD card is formatted can affect not only its performance, but its <em>lifespan</em> too: <a href="http://3gfp.com/wp/2014/07/formatting-sd-cards-for-speed-and-lifetime/">http://3gfp.com/wp/2014/07/formatting-sd-cards-for-speed-and-lifetime/</a></p>
<p>Excerpt from the article:</p>
<p><em>Raw flash chips are divided up into several integral read and write sizes. It is important to keep these sizes and their alignment into consideration or a card may end up performing 2 write operations for each 1 write operation intended thereby cutting the life of the flash in half.</em></p>
<p>The article made me wonder if that&#39;s one of the contributing factors (among many) as to why some folks seem to burn through SD cards, while others seem to get reasonably long life from them.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31476"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8263" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Steve&#039;s picture" title="Steve&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8263" title="View user profile.">Steve</a> on Thu, 18/06/2015 - 09:10.</div>
    <div class="content">
     <p>Paul,</p>
<p>I also don&#39;t know how to reconcile the low writing rate with the topic of this thread, namely the death of an SD card after 2 years.</p>
<p>Much depends on the SD card&#39;s internal design.&nbsp; Those once-a-minute writes could hit 6 blocks (3 files and 3 inodes) and a block could be 32k or more, so inside the chip we are writing 6 times 32k which is 32 times the rate observed in Linux.</p>
<p>Bill,</p>
<p>From that article I learned that flash controllers are optimised for FAT32.&nbsp; For a Linux perpsective try <a href="http://lwn.net/Articles/428584/">Optimizing Linux with cheap flash drives</a> (written in 2011 when the kernel programmers were working in this area).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31493"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Thu, 18/06/2015 - 17:58.</div>
    <div class="content">
     <p>Maybe the answer is to establish a optimum &quot;write&quot; regime and work backwards. eg from a quick glance through Bill&#39;s link it looks like 128kiB&nbsp;blocksize is an optimum size if aligned with the partition structure. each day or hour (which ever is more efficient) the &quot;current&quot; block gets moved to minimize wear and when the block is full append it to the main data file and create a new one, so &quot;the feed&quot; is actually made of 2 files a static &quot;main&quot; and a rolling &quot;current&quot;??</p>
<p>Just throwing ideas out there, as I see the potential loss of up&nbsp;to an hour or a day&#39;s worth of data a much bigger inconvenience than replacing the SD card once a year, as a preventative measure since&nbsp;we get quite a few power interruptions, mostly momentary, but nonetheless, enough to cause a reboot.&nbsp;</p>
<p>Even if the ideas won&#39;t fly, if someone points that out, I consider myself a step closer to finding a solution :-)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31505"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8263" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Steve&#039;s picture" title="Steve&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: SD Card Life</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8263" title="View user profile.">Steve</a> on Fri, 19/06/2015 - 08:15.</div>
    <div class="content">
     <p>Unfortunately the optimum blocksize may be different for each make/model of SD card.&nbsp; This page has a long list from a survey in 2012-13: <a href="https://wiki.linaro.org/WorkingGroups/KernelArchived/Projects/FlashCardSurvey">Flash memory card design</a>&nbsp; My conclusion is that it&#39;s too hard to improve on the optimisations already done, both in the kernel and by the delayed write strategy.</p>
<p>For peace of mind I will move my phpfina directory away from the SD card, either to RAM or a USB stick.&nbsp; Then the only writes will be for software updates, config changes and the &#39;rememberme&#39; table in mysql.</p>
<p>Backups of the feeds in phpfina will be:</p>
<ol>
<li>emoncms.org</li>
<li>daily (cron&#39;d) copy to a Linux machine</li>
</ol>
<p>I&#39;ll use rsync to make a mirror of the phpfina directory on my Linux machine.&nbsp; This needs no extra software on the Pi, just a key in /home/pi/.ssh/authorized_keys.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/10773"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-mCV3r5UU-DaG4UjTqZzI4ey9lkL7vSPNt5laJvxAgZw" value="form-mCV3r5UU-DaG4UjTqZzI4ey9lkL7vSPNt5laJvxAgZw"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>

</html>
