<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11912 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:48:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Upgrading from EmonCMS 8.4 on HDD | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Upgrading from EmonCMS 8.4 on HDD</h3>
        <span class="submitted">Submitted by <a href="../user/6143.html" title="View user profile.">andy_l</a> on Fri, 01/01/2016 - 12:07</span>
        <div class="content"><p>Hi all,</p>
<p>Apologies if this has been asked before (I did do a forum search beforehand)... however:</p>
<p>&nbsp;</p>
<p>My simple&nbsp;OpenEnergyMonitor installation has been running for nearly 2 years now,&nbsp;and consists of an emonTX v3, four&nbsp;emonTH nodes, an emonGLCD and a Pi based emonBase&nbsp;running on a USB&nbsp;HDD. Whilst I have kept my system up-to-date within 8.x,&nbsp;as a &#39;casual&#39; user&nbsp;I must admit some confusion with the recent development direction of the various emonCMS branches. As these seem to be now merging into a single 9.x master, I have once again considered upgrading my installation.</p>
<p>&nbsp;</p>
<p>However I am unclear as to the migration mechanism from moving data from an 8.4 installation to 9.x - is there any conversion of the data feeds required?&nbsp;Furthermore my original install was using the 2014-02-23-emoncms_raspberrypi_hdd_stack image and I am unsure&nbsp;what the best installation route is this time around. For instance, is it best to start with a clean Raspbian&nbsp;install and go from there?&nbsp;Is there an upgrade&nbsp;summary doc anywhere?</p>
<p>&nbsp;</p>
<p>Cheers,</p>
<p>&nbsp;</p>
<p>Andy</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12076.html" class="topic-previous" title="Go to previous forum topic">‹ rfmpi pulse not processed as input</a>
              <a href="12073.html" class="topic-next" title="Go to next forum topic">Migration to new image problems ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-37722"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 01/01/2016 - 17:33.</div>
    <div class="content">
     <p>Hello Andy. We&#39;ve been working on the upgrade/migration to v9 procedure for the June 2015 image: emonSD-17-06-15.img.zip which is the version running the low-write branch of emoncms. <a href="11843.html">http://openenergymonitor.org/emon/node/11843</a>.</p>
<p>Its been a while since I have used the image you&#39;re running. However, if I remember correctly, that image supported all feed engines including PHPFINA, PHPFIWA and PHPTIMESERIES. How many feeds do you have that use any of those engines? They are listed in the feeds list under the engine field.</p>
<p>I would recommend to start with, making a backup of your MySQL database and the feed engine data files. Then it may be best to start with the latest image we are building here: <a href="11799.html" title="http://openenergymonitor.org/emon/node/11799">http://openenergymonitor.org/emon/node/11799</a>, then move the data across.</p>
<p>If you are currently using a hard drive and wish to keep it that way, you may not need to do any data conversion. Let me know what feed engines you&#39;re using first, and we can go from there.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37728"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6143.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="andy_l&#039;s picture" title="andy_l&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/6143.html" title="View user profile.">andy_l</a> on Fri, 01/01/2016 - 20:00.</div>
    <div class="content">
     <p>Hi Trystan,</p>
<p>Thanks for your reply -&nbsp;I have 23 PHPFIWA feeds and 2 PHPFINA feeds. I&#39;d probably prefer to stick with a hard drive because the existing setup has been rock solid, and I&#39;m also running a small instance of Cacti on the same Pi. On the other hand the prebuilt image is appealing as the path of least resistance ;)</p>
<p>Cheers and Happy New Year,</p>
<p>Andy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37733"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 01/01/2016 - 22:35.</div>
    <div class="content">
     <p>An alternative (plan B!) would be to backup your data as per Trystan&#39;s&nbsp;post, and start afresh <a href="https://github.com/emoncms/emoncms/tree/master/docs/RaspberryPi">using this guide to install emoncms&nbsp;on your&nbsp;SD card</a>.<br />
Once installed on the SD card, there is now a <a href="https://github.com/emoncms/emoncms/blob/master/docs/RaspberryPi/USB_HDD.md">script to move your OS to the HDD</a>.<br />
Then import your data - again as per Trystan&#39;s&nbsp;link.</p>
<p>Should take about an hour to complete.</p>
<p>Paul</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37772"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 02/01/2016 - 21:04.</div>
    <div class="content">
     <p>Yes good idea Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38667"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6143.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="andy_l&#039;s picture" title="andy_l&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/6143.html" title="View user profile.">andy_l</a> on Sun, 24/01/2016 - 17:28.</div>
    <div class="content">
     <p>Thanks for the replies - just to let you know that I succeeded in migrating from 8.4 to 9.3.</p>
<p>&nbsp;</p>
<p>Performed a clean install of Jessie onto a new RPi 2 and&nbsp;installed emonCMS as per the book. I did the feed engine and DB migration manually because I had already taken a backup from the old install&nbsp;before I saw Trystan&#39;s&nbsp;nice&nbsp;new script. I also chose to start with clean emonHub and emonCMS config files.</p>
<p>&nbsp;</p>
<p>It was mostly painless, there were a couple of things I noticed along the way:</p>
<p>- Needed&nbsp;to use raspi-config&nbsp;to turn off serial console login (equivalent of modifying inittab in Wheezy). Don&#39;t think this&nbsp;is mentioned in the build docs.</p>
<p>- After import of the DB the emonCMS timezone settings were null. Easily spotted after looking at the emonHub logs.</p>
<p>- The multi-graphs made it across fine (contrary to what I&#39;d read before) although they did need re-saving to draw reliably.</p>
<p>- Realtime&nbsp;widgets had lost their feed association, although easily remade.</p>
<p>&nbsp;</p>
<p>Other than that, all seems to be working. The only thing left to do is the migration to HDD.&nbsp;Thanks again!</p>
<p>&nbsp;</p>
<p>Andy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38671"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6143.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="andy_l&#039;s picture" title="andy_l&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/6143.html" title="View user profile.">andy_l</a> on Sun, 24/01/2016 - 18:49.</div>
    <div class="content">
     <p>One unexpected thing which is immediately obvious running 9.3 is how much regular packet loss I seem to be getting. Without the new &#39;Skip Missing Data&#39; flag set in the visualisation, the graphs look like the attached.</p>
<p>&nbsp;</p>
<p>Looking at the emonHub debug logs in noisy mode, there are plenty of discarded packets.&nbsp;I guess 868 is pretty crowded&nbsp;round here, something else to look at when I get time!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Andy</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38675"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 24/01/2016 - 20:32.</div>
    <div class="content">
     <p>Good to hear you upgraded everything without too much trouble. Glad you seized the opportunity to install a fresh &quot;Jessie&quot; OS (the full version I hope).</p>
<p>The &quot;releasing the serial port&quot; is included in the guide in the <a href="https://github.com/emoncms/emoncms/tree/master/docs/RaspberryPi#install-emonhub">&quot;install&nbsp;emonhub&quot;</a> section. Editing inittab is no longer required with Jessie so just editing cmdline.txt is all that&#39;s required.</p>
<p>Regards the missing datapoints, there are several possibilities, the foremost are&nbsp;&quot;bitslip&quot; on emonTx&#39;s or &quot;RFM not waking fast enough&quot; in emonTH&#39;s&nbsp;or &quot;RF collisions&quot; in either. If you can attach a chunk of emonhub.log it shouldn&#39;t be too difficult to fathom it out from the &quot;discarded packets&quot; what&#39;s happening.</p>
<p>The discarded packets are a much better indication of dropped packets than the fixed interval feeds in emoncms, if, for example a 10 second interval is actually 10.5 seconds then 5% of packets will appear to been dropped even when every packet is successfully&nbsp;received.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38679"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6143.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="andy_l&#039;s picture" title="andy_l&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/6143.html" title="View user profile.">andy_l</a> on Sun, 24/01/2016 - 21:28.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Yes I used the full-fat version of Jessie :)</p>
<p>Regarding releasing the serial port, I was under the impression that configuration&nbsp;in cmdline.txt affects whether console data is output to the serial port during boot, whereas the inittab config (as it was in Wheezy) enabled console <em>login</em>&nbsp;via the serial port. Certainly just editing cmdline.txt did not have the desired effect until I then disabled&nbsp;serial access via raspi-config. Still, I was doing several&nbsp;things concurrently so without building it again from scratch I can&#39;t be certain.</p>
<p>I&#39;ve attached a&nbsp;2&nbsp;minute chunk of debug level logs. There is a definite periodicity to many of the missing datapoints so an interaction of sampling intervals would make sense.</p>
<p>Cheers for your help,</p>
<p>&nbsp;</p>
<p>Andy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38682"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 24/01/2016 - 21:50.</div>
    <div class="content">
     <p>Actually most if not all of the discarded packets in that log are weak ( -90+ rssi) and unlikely to be &quot;lost&quot; packets. I havent looked that closly but the few node 10 packets I checked were over 11 secs apart so you should see at least 10 percent of datapoints recorded as null if using a 10 second fixed interval.</p>
<p>The changes to cmdline.txt are only seen at boot time so changing it will have no effect until it&#39;s rebooted. Jessie is able to take that boot time info and configure the serial console or not using a deamon rather than needing the inittab&nbsp;file. If you were to check the&nbsp;raspi-config source code the only change for Jessie to the serial console part is they added an &quot;if&nbsp;exists&quot; to the part that changes the inittab&nbsp;file.</p>
<p>Paul&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38684"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6143.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="andy_l&#039;s picture" title="andy_l&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Upgrading from EmonCMS 8.4 on HDD</h3>

    <div class="submitted">Submitted by <a href="../user/6143.html" title="View user profile.">andy_l</a> on Sun, 24/01/2016 - 22:18.</div>
    <div class="content">
     <p>Yes having&nbsp;spent some time actually looking at the logs I can see that this is more of a sampling artifact. The periodicity&nbsp;of this can be seen in the attached graph from node 10. Can anything be done to tighten up the timings of the nodes, or indeed does it even matter?&nbsp;&nbsp;</p>
<p>Cheers,</p>
<p>&nbsp;</p>
<p>Andy</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11912"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-OBS1WUnVqEDO0qfhjtXr2C6XSdCPYtFMpk9noXLbuC0" value="form-OBS1WUnVqEDO0qfhjtXr2C6XSdCPYtFMpk9noXLbuC0"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
