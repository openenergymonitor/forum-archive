<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5789 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:46:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Bar graph  - improvements | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Bar graph  - improvements</h3>
        <span class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Thu, 18/09/2014 - 05:06</span>
        <div class="content"><p>Hi,</p>
<p>	I just discovered <a href="5387.html#comment-23832">here</a> that the &quot;new&quot; bargraph visualization can pull out daily kWh from a &quot;total kWh&quot; feed. In fact, you can choose any interval, but it can&#39;t show monthly/yearly kWh as the number of day per month/year is variable.</p>
<p>So, I made some modifications to be able to pull out the exact monthly and yearly kWh.<br />
	When configuring the bar graph, enter a interval code : &quot;d&quot; for daily kWh, &quot;m&quot; for monthly kWh and &quot;y&quot; for yearly kWh. It is still needed to set the &quot;delta&quot; parameter to &quot;1&quot;. Entering an interval in seconds is still possible.</p>
<p>This view (daily/monthly/yearly) can also be modified dynamically by clicking on the kWh/D, kWh/M, kWh/Y buttons. Like for the zoom visualization, you can zoom-in/zoom-out by clicking on/outside a bar.</p>
<p>But, there is still a bug that need to be fixed. When calculating the daily kWh, it returns the kwh elapsed in 24h starting from an erratic time (20:13:30 in my example). It&#39;s the same erratic time for all days.&nbsp; This time seems depend on the feed itself. THis comes from the return of the ajax request.</p>
<p>As a consequence, one can see on the graph (see attached), that there is a shift between the day on the x-axis and the bar of the corresponding day. According to me, the ajax request should return the kwh elapsed in 24h from midnight to midnight. This will align the bar on the x-axis.</p>
<p>Please find attached in a zip the two files I modified.</p>
<p>Eric</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6193.html" class="topic-previous" title="Go to previous forum topic">‹ timestore api</a>
              <a href="5027.html" class="topic-next" title="Go to next forum topic">New feed logging to wrong day ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-23887"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 18/09/2014 - 10:36.</div>
    <div class="content">
     <p>Thanks Eric, that&#39;s brilliant, I was wondering where to start with getting the exact month/year data. Il take a look at the code.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23890"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Thu, 18/09/2014 - 10:53.</div>
    <div class="content">
     <p>Hi,</p>
<p>I didn&#39;t put any comments ... but it&#39;s quite simple. How it works :</p>
<p>When the interval code is &#39;d&#39; or &#39;m&#39; or &#39;y&#39;, the interval in seconds is set to 84600 which correspond to 24h. Then, monthly/yearly kWh are just sums of the daily values of the corresponding month/year.</p>
<p>If you can, have a look on the problem explained above. (ajax request)</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24178"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bodiroga&#039;s picture" title="bodiroga&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/723.html" title="View user profile.">bodiroga</a> on Fri, 26/09/2014 - 18:15.</div>
    <div class="content">
     <p>Hi guys!</p>
<p>Are this changes pushed to github? It seems that they are not added to the emoncms repository, but perhaps I haven&#39;t look at it correctly. Anyway, I have copied the two files manually to my emoncms&nbsp;installation (Ubuntu server running in a x86&nbsp;box) and I have restarted my box, but I&#39;m still seeing the same problem that Eric comments in his first post. Bars are not aligned to the corresponding day and if you pass the mouse over the bar, the date displayed corresponds to the previous day.</p>
<p>Eric, did I misunderstand your post or do your modified files should also fix the shifted bars problem?</p>
<p>Trystan, do you know how to fix the shifted bars problem? :(</p>
<p>Many thanks for your help and I&#39;m looking forward to hearing from you, I wish I could solve this problem as soon as possible.</p>
<p>Best regards,</p>
<p>Aitor</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24180"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Fri, 26/09/2014 - 21:16.</div>
    <div class="content">
     <p>Hi,</p>
<p>I didn&#39;t push my modifications to github (I need to learn how to do it) but one can just overwrite the original file as you did (.../emoncms/Modules/vis/visualisations/bargraph.php and ../emoncms/Modules/dashboard/Views/js/widgets/vis/vis_render.js). No need to restart.</p>
<p>My modified files do NOT fix&nbsp; the shifted bars problem. It only brings the daily/montly/yealy view. The bars are shifted because the kwh/d are calculated from 18:00 to 18:00 the day after (as an example) instead of from 00:00 to 00:00 the day after. If you want to align the bars, you can just uncomment lines 266 to 268 in bargraph.php. This will move the bars on the x-axis BUT the calculation of the kWh/d will still be wrong (from 18:00 to 18:00).</p>
<p>I don&#39;t know how to fix that bug which seems to be related to the ajax request.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24181"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bodiroga&#039;s picture" title="bodiroga&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/723.html" title="View user profile.">bodiroga</a> on Fri, 26/09/2014 - 21:34.</div>
    <div class="content">
     <p>Hi Eric!</p>
<p>Many thanks for your answer and your help, I really appreciate that you have answered my comment!</p>
<p>Let&#39;s see then if Trystan has enough time to fix the ajax problem and we can have correctly aligned bars ;)</p>
<p>Thanks again for your help and best regards,</p>
<p>Aitor</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24356"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5386.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="darrepac&#039;s picture" title="darrepac&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/5386.html" title="View user profile.">darrepac</a> on Tue, 07/10/2014 - 15:47.</div>
    <div class="content">
     <p>Sounds great! it would permit to have dailly, weekly, monthly consumption in one graph which I never succeed to do...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24383"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 08/10/2014 - 16:05.</div>
    <div class="content">
     <p>Hello Eric, I&#39;ve added in your changes above to the bargraph visualisation, these changes are now in the master branch of emoncms:</p>
<p><a href="https://github.com/emoncms/emoncms/commit/0a50c63808e94e60b756641a04d57465b18216d4" title="https://github.com/emoncms/emoncms/commit/0a50c63808e94e60b756641a04d57465b18216d4">https://github.com/emoncms/emoncms/commit/0a50c63808e94e60b756641a04d574...</a><br />
	<a href="https://github.com/emoncms/emoncms/commit/fdcb0a55551684368e17bda17426a36e9b4c43fd" title="https://github.com/emoncms/emoncms/commit/fdcb0a55551684368e17bda17426a36e9b4c43fd">https://github.com/emoncms/emoncms/commit/fdcb0a55551684368e17bda17426a3...</a></p>
<p>Looking into the AJAX issue next</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24385"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 08/10/2014 - 16:50.</div>
    <div class="content">
     <p>I think the error Im seeing is not an arbitrary time offset but that the daily values when the delta flag is applied are labeled as one day ahead so I see the 4th of October as 20kWh where that is actually the consumption for the 3rd..</p>
<p>The bargraph vis makes use of the browser&#39;s timezone setting so that 20kWh is correct for british summer time for me.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24391"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 08/10/2014 - 18:44.</div>
    <div class="content">
     <p>Hi,</p>
<p>The time offset is different for each of my feeds (PHPTimestore) : 22:27:00, 17:58:00, 18:08:00, ...</p>
<p>I read that time values on my emoncms server (modifying the bargraph php file).</p>
<p>That&#39;s is also the case on my emoncms.org acount.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24426"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 09/10/2014 - 14:27.</div>
    <div class="content">
     <p>Hello Eric, Ah that might explain it, the issue might be PHPTimestore and I&#39;ve been testing on PHPFina/Fiwa. I will try and look into why that is.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25426"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="bodiroga&#039;s picture" title="bodiroga&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bar graph  - improvements</h3>

    <div class="submitted">Submitted by <a href="../user/723.html" title="View user profile.">bodiroga</a> on Sat, 29/11/2014 - 19:47.</div>
    <div class="content">
     <p>Hi Trystan!</p>
<p>Any update on this issue? ;)</p>
<p>Many thanks for all your hard work!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5789"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Us6OT1YfR4ElaO1d7viwGUffeYjaQi4V_Nt-E4FALYg" value="form-Us6OT1YfR4ElaO1d7viwGUffeYjaQi4V_Nt-E4FALYg"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/5789 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:46:50 GMT -->
</html>
