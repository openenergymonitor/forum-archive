<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5326 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:21:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Oemgateway in read only | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Oemgateway in read only</h3>
        <span class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 23/06/2014 - 05:27</span>
        <div class="content"><p>HI,</p>
<p>I&#39;m following <a href="4283.html">that guide</a> to setup an OEMgateway forwarding data to my EmonCMS.org account.</p>
<p>It works fine until I try to setup Raspbian to run in read-only mode for increased stability.</p>
<p>If I put the following lines in /etc/fstab as mentioned in the guide, the OEMgateway doesn&#39;t work anymore.</p>
<p><strong><em>tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /tmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmpfs&nbsp;&nbsp; nodev,nosuid,size=30M,mode=1777&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0<br />
	tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /var/log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmpfs&nbsp;&nbsp; nodev,nosuid,size=30M,mode=1777&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0<br />
	proc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /proc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proc&nbsp;&nbsp;&nbsp; defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br />
	/dev/mmcblk0p1&nbsp; /boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vfat&nbsp;&nbsp;&nbsp; defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2<br />
	/dev/mmcblk0p2&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ext4&nbsp;&nbsp;&nbsp; defaults,ro,noatime,errors=remount-ro&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br />
	# /dev/mmcblk0p3&nbsp; /home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ext4&nbsp;&nbsp;&nbsp; defaults,noatime</em></strong></p>
<p>&nbsp;</p>
<p>Before that step, here is my file system :</p>
<p><strong>pi@raspberrypi ~ $ df -T<br />
	Filesystem&nbsp;&nbsp;&nbsp;&nbsp; Type&nbsp;&nbsp;&nbsp;&nbsp; 1K-blocks&nbsp;&nbsp;&nbsp; Used Available Use% Mounted on<br />
	rootfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; rootfs&nbsp;&nbsp;&nbsp;&nbsp; 2721336 2086676&nbsp;&nbsp;&nbsp; 476708&nbsp; 82% /<br />
	/dev/root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ext4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2721336 2086676&nbsp;&nbsp;&nbsp; 476708&nbsp; 82% /<br />
	devtmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; devtmpfs&nbsp;&nbsp;&nbsp; 215824&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 215824&nbsp;&nbsp; 0% /dev<br />
	tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 44820&nbsp;&nbsp;&nbsp;&nbsp; 208&nbsp;&nbsp;&nbsp;&nbsp; 44612&nbsp;&nbsp; 1% /run<br />
	tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5120&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5120&nbsp;&nbsp; 0% /run/lock<br />
	tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp; tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 89620&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 89620&nbsp;&nbsp; 0% /run/shm<br />
	/dev/mmcblk0p1 vfat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 57288&nbsp;&nbsp; 19072&nbsp;&nbsp;&nbsp;&nbsp; 38216&nbsp; 34% /boot</strong></p>
<p>&nbsp;</p>
<p>Must I replace <strong>/dev/mmcblk0p2&nbsp; </strong>with<strong>  /dev/root</strong> in fstab ?</p>
<p>Bye</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5332.html" class="topic-previous" title="Go to previous forum topic">‹ Cannot create a multigraph [SORTED]</a>
              <a href="5321.html" class="topic-next" title="Go to next forum topic">arduino FAIL! : FIXED ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-22109"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 23/06/2014 - 08:08.</div>
    <div class="content">
     <p>Hi Eric.</p>
<p>No, the the &quot;/dev/mmcblk0p2&quot; in the fstab&nbsp;is the physical location of the root file system, without that it won&#39;t boot correctly either.</p>
<p>Have you added&nbsp;RAMPTMP=yes to the end of /etc/default/rc5 and replaced /etc/mtab&nbsp;with a symlink to /proc/self/mounts ?</p>
<p>I have written a guide to this in the emonhub documentation which isn&#39;t up and running just yet. But t<a href="https://github.com/openenergymonitor/documentation/blob/master/Modules/RaspberryPI/Gateway/gateway.md#read-only-mode">here is a copy in Trystan&#39;s documentation</a> for his later,&nbsp;emonhub based version of the gateway you are installing.&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22111"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 23/06/2014 - 08:52.</div>
    <div class="content">
     <p>I followed each steps of<a href="4283.html"> this guide</a>. So I made the modifications that you mentioned. So it &#39;s not the problem.</p>
<p><strike>I just understood that there is typo in the step a) :</strike></p>
<p><strike>a) sudo nano /etc/default/rc<u><strong>S</strong></u>, add line RAMTMP=yes&nbsp;&nbsp; ---&gt; a) sudo nano /etc/default/rc<u><strong>5</strong></u><u>,</u> add line RAMTMP=yes</strike></p>
<p><strike>May I edit this guide ?</strike></p>
<p>EDIT : there is a typo in you message, it&#39;s /etc/default/rcS and not /etc/default/rc5</p>
<p>EDIT 2 : I will try with &quot;RAMPTMP=yes&quot; instaed of &quot;RAMTMP=yes&quot;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22112"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 23/06/2014 - 09:20.</div>
    <div class="content">
     <p>Apologies for the typos in my post (the guides do have rcS&nbsp;&amp; RAMTMP), seems the old grey matter isn&#39;t firing on all cylinders this morning. I&#39;ve not used the guide you are working from, but I can&#39;t see any reason for not working. I regularly use the method in my guide as, just cutting and pasting this chunk of code does everything and eliminates typo errors etc.</p>
<p>sudo cp /etc/default/rcS /etc/default/rcS.orig<br />
	sudo sh -c &quot;echo &#39;RAMTMP=yes&#39; &gt;&gt; /etc/default/rcS&quot;<br />
	sudo mv /etc/fstab /etc/fstab.orig<br />
	sudo sh -c &quot;echo &#39;tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /tmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmpfs&nbsp;&nbsp; nodev,nosuid,size=30M,mode=1777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&#39; &gt;&gt; /etc/fstab&quot;<br />
	sudo sh -c &quot;echo &#39;tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /var/log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmpfs&nbsp;&nbsp; nodev,nosuid,size=30M,mode=1777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&#39; &gt;&gt; /etc/fstab&quot;<br />
	sudo sh -c &quot;echo &#39;proc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /proc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proc&nbsp;&nbsp;&nbsp; defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0&#39; &gt;&gt; /etc/fstab&quot;<br />
	sudo sh -c &quot;echo &#39;/dev/mmcblk0p1&nbsp; /boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vfat&nbsp;&nbsp;&nbsp; defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 2&#39; &gt;&gt; /etc/fstab&quot;<br />
	sudo sh -c &quot;echo &#39;/dev/mmcblk0p2&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ext4&nbsp;&nbsp;&nbsp; defaults,ro,noatime,errors=remount-ro 0&nbsp;&nbsp;&nbsp; 1&#39; &gt;&gt; /etc/fstab&quot;<br />
	sudo sh -c &quot;echo &#39; &#39; &gt;&gt; /etc/fstab&quot;<br />
	sudo mv /etc/mtab /etc/mtab.orig<br />
	sudo ln -s /proc/self/mounts /etc/mtab</p>
<p>it also keeps all 3 original files so reverting to standard is easy. (I think I will post the full instructions on forum as it also has shortcuts to lock and unlock filesystem)</p>
<p>Also just as a &quot;heads up&quot; I don&#39;t think the oem_gateway&nbsp;you are using has variable size buffers or bulk upload enabled as discussed in your other thread.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22114"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 23/06/2014 - 10:00.</div>
    <div class="content">
     <p>Thank&#39;s for your chunk of code&nbsp; and for your support in general!</p>
<p>It doesn&#39;t fix the problem. As soon as I setup Raspbian to run in read-only mode, the oemgateway doesn&#39;t work anymore after a reboot. When trying to stop the oemgateway service, I gotr the following error :</p>
<p>pi@raspberrypi ~/oem_gateway $ sudo service oemgateway stop<br />
	[....] Stopping OpenEnergyMonitor Gateway: oemgatewaystart-stop-daemon: warning: failed to kill 2463: No such process</p>
<p>The only way to make it work, is to come back to the three original files (fstab, mtab and rcS). But then the file systeme is in RW mode ... As you can see below there is no difference between mtab and mtab.origin. Is it normal ?</p>
<p>&nbsp;</p>
<p>pi@raspberrypi ~ $ diff /etc/mtab /etc/mtab.orig</p>
<p>pi@raspberrypi ~ $ diff /etc/default/rcS.orig /etc/default/rcS<br />
	24a25<br />
	&gt; RAMTMP=yes</p>
<p>	pi@raspberrypi ~ $ diff /etc/fstab /etc/fstab.orig<br />
	1,6c1,4<br />
	&lt; tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /tmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmpfs&nbsp;&nbsp; nodev,nosuid,size=30M,mode=1777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0<br />
	&lt; tmpfs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /var/log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tmpfs&nbsp;&nbsp; nodev,nosuid,size=30M,mode=1777&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0<br />
	&lt; proc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /proc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proc&nbsp;&nbsp;&nbsp; defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 0<br />
	&lt; /dev/mmcblk0p1&nbsp; /boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vfat&nbsp;&nbsp;&nbsp; defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 2<br />
	&lt; /dev/mmcblk0p2&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ext4&nbsp;&nbsp;&nbsp; defaults,ro,noatime,errors=remount-ro 0&nbsp;&nbsp;&nbsp; 1<br />
	&lt;&nbsp;<br />
	---<br />
	&gt; proc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /proc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; proc&nbsp;&nbsp;&nbsp; defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0<br />
	&gt; /dev/mmcblk0p1&nbsp; /boot&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; vfat&nbsp;&nbsp;&nbsp; defaults&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2<br />
	&gt; /dev/mmcblk0p2&nbsp; /&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ext4&nbsp;&nbsp;&nbsp; defaults,noatime&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1<br />
	&gt; # a swapfile is not a swap partition, so no using swapon|off from here on, use&nbsp; dphys-swapfile swap[on|off]&nbsp; for that</p>
<p>&nbsp;</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22115"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 23/06/2014 - 10:11.</div>
    <div class="content">
     <p>Anyway, I will try to install the Emonhub on a SD card with a RO file system to get variable size buffers or bulk upload enabled.</p>
<p>Which guide should I follow ?<a href="https://github.com/openenergymonitor/documentation/blob/master/Modules/RaspberryPI/Gateway/gateway.md#read-only-mode"> This one ?</a></p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22117"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 23/06/2014 - 11:23.</div>
    <div class="content">
     <p>Unfortunately I&#39;m not able to access a pi right now and I don&#39;t know 100% what to expect as I&#39;m not sure how diff handles symlinks and I don&#39;t know the exact content of your mtab.orig. It certainly doesn&#39;t look right to me but I cannot be 100% without trying it.</p>
<p>You could use the version that that guide installs, it does have variable buffer size but not bulk upload, I&#39;m not overly familiar with that version so may be of limited help to you.</p>
<p>Personally I would recommend (and appreciate) you installing the dev version of emonhub&nbsp;as I am more familiar with it and actively developing it. It has both variable buffer size and bulk upload. It currently posts to the input module rather than the node module as I&#39;m working on a solution that utilises both rather than only one or other.</p>
<p>One line will install and set-up emonhub</p>
<blockquote><p><strong>git clone <a href="https://github.com/emonhub/dev-emonhub.git" title="https://github.com/emonhub/dev-emonhub.git">https://github.com/emonhub/dev-emonhub.git</a> &amp;&amp; dev-emonhub/install.sh</strong></p>
</blockquote>
<p>then the conf file needs to be edited, just add an api key for basic operation, then add node details to change data types.</p>
<blockquote><p><strong>nano /etc/emonhub/emonhub.conf</strong></p>
</blockquote>
<p>&nbsp;</p>
<p>For example to add the node data for the&nbsp;emonTxV3_continuous_kwhtotals_noeeprom.ino v3 sketch for node 10</p>
<blockquote><p><strong>[[10]]<br />
		&nbsp; codes = L, h, h, h, h, l, l, l, l</strong></p>
</blockquote>
<p>and then use <a href="5331.html">this guide</a> I just posted to forum to switch to read-only.</p>
<p>Paul</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22120"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 23/06/2014 - 11:48.</div>
    <div class="content">
     <p>I did a try with <a href="https://github.com/openenergymonitor/documentation/blob/master/Modules/RaspberryPI/Gateway/gateway.md#read-only-mode">that</a> Emonhub installation guide</p>
<p>Firstly, I had to modify the emonhubNode.conf file in order to modify the log file path that wasn&#39;t correct (logfile = /var/log/emonhub.log --&gt;&nbsp; /var/log/emonhub/emonhub.log)</p>
<p>Then, I got the problem described above : after configuring raspbian in RO mode, Emonhub isn&#39;t working ... But, I did some progress !&nbsp;</p>
<p>&nbsp;</p>
<p>When restarting the emonhub service, I get the following messages :</p>
<p><em>Restarting OpenEnergyMonitor emonHub: emonhubstart-stop-daemon: warning: failed to kill 1962: No such process<br />
	Could not start EmonHub: [Errno 2] No such file or directory: &#39;/var/log/emonhub/emonhub.log&#39;</em></p>
<p>If I unlock the file system, I get the same errors.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>The workaround is to execute the following command.</p>
<p><em>sudo mkdir /var/log/emonhub<br />
	sudo chown pi /var/log/emonhub<br />
	sudo chmod 750 /var/log/emonhub<br />
	rpi-ro<br />
	sudo service emonhub restart</em></p>
<p>&nbsp;</p>
<p>Then Emonhub works until the next reboot ...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>EDIT : after a reboot :</p>
<p>pi@raspberrypi ~ $ sudo ls /var/log/emonhub<br />
	ls: cannot access /var/log/emonhub: No such file or directory</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22121"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 23/06/2014 - 11:49.</div>
    <div class="content">
     <p>The original location for the logfile&nbsp;was going to be /var/log/emonhub/emonhub.log but this doesn&#39;t work with RO image as the /var/log/emonhub&nbsp;directory is lost every time the pi reboots since /var/log is relocated to RAM and therefore recreated at every boot.</p>
<p>emonhub&#39;s default was changed to /var/log/emonhub.log to be RO compatible. If you change the emonhub.conf file back to &quot; logfile = /var/log/emonhub.log &quot; this should no longer be an issue.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22124"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 23/06/2014 - 12:49.</div>
    <div class="content">
     <p>Ok, it&#39;s now working in RO !</p>
<p>Unfortunately, as you said me, this version is limited. So I will install the dev version of emonhub.</p>
<p>Do you think this dev version is enough reliable to be installed on a site that I will not be able to access ? (neither physically speaking, nor by shh)</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22128"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Mon, 23/06/2014 - 14:24.</div>
    <div class="content">
     <p>I installed the dev version of Emonhub on a SD card and than switch to read-only. YESS !</p>
<p>Paul, I really like your installation-procedure (one line) !</p>
<p>Note that it was not working until I made some modifications :</p>
<p>1. At the bottom of the /etc/inittab file, I commented out the line, by adding a &lsquo;#&rsquo; at beginning) and the cmdline.text file</p>
<p>2. Changes&nbsp; /boot/cmdline.txt file with those lines :</p>
<p>sudo cp /boot/cmdline.txt /boot/cmdline.txt.origin<br />
	sudo sh -c &quot;echo &#39;dwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait&#39; &gt; /boot/cmdline.txt&quot;</p>
<p>&nbsp;</p>
<p>It seemed to work only after the first modification, so I&#39;m not sure that the second one is required.</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22129"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Oemgateway in read only</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 23/06/2014 - 14:43.</div>
    <div class="content">
     <p>I have no reason to doubt it&#39;s reliability but as with all new software only time will tell. any recent version of emonhub or oem gateway will not have the time served reassurance of the original oem gateway but they are built on the same reliable solution.</p>
<p>I have been using emonhub for a while now without any issues under normal running conditions, you would be wise to &quot;stress test&quot; any software you decide to use before committing. for example the buffers, you should try changing the url to something it cannot find to max out the buffers to test the size, the ability to resume sending and what happens if the buffer size is exceeded as these characteristics may change with larger buffer sizes, especially if you are anywhere close to maxing out the RAM.</p>
<p>The &quot;dev&quot; status is just to denote that emonhub is being tested and things are subject to change before a release version is finalised. In this &quot;dev&quot; version the files are not put where they should be rather they are symlinked so that git pull can be used to update, this method will not be used instead it will be available as a&nbsp;debian&nbsp;package at release time, I hope.</p>
<p>Yes both files need to be edited for the rfm2pi to access the uart&nbsp;with any software or OS on the pi. I did include a little reminder &quot;(note - if&nbsp; serial UART&nbsp; access required make those changes before restarting)&quot; at the end of the RO guide.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5326"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-xsccQtVxIAts3uOXMLS7za6Weqgyj9fd93AERdUbxPM" value="form-xsccQtVxIAts3uOXMLS7za6Weqgyj9fd93AERdUbxPM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
