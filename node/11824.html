<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11824 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:12:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emon not processing all frames from node | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emon not processing all frames from node</h3>
        <span class="submitted">Submitted by <a href="../user/9140.html" title="View user profile.">Bjorksta</a> on Fri, 18/12/2015 - 06:36</span>
        <div class="content"><p>I have some trouble with the base/RFM69Pi not processing all the frames sent by&nbsp;<br />
my node (EmonTX V2).</p>
<p>It work correctly when I only<br />
had a temperature sensor, but now since I upgraded it<br />
with pulse counter not all frames seems to be&nbsp;<br />
processed correctly.</p>
<p>A good frame:<br />
2015-12-18 06:31:38,146 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 81 NEW FRAME : OK 10 111 2 2 0 33 7 (-45)<br />
2015-12-18 06:31:38,165 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 81 Timestamp : 1450420298.15<br />
2015-12-18 06:31:38,178 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 81 From Node : 10<br />
2015-12-18 06:31:38,182 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 81 &nbsp; &nbsp;Values : [623, 2, 18.25]<br />
2015-12-18 06:31:38,185 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 81 &nbsp; &nbsp; &nbsp;RSSI : -45<br />
2015-12-18 06:31:38,201 INFO &nbsp; &nbsp; RFM2Pi &nbsp; &nbsp; Publishing: emonhub/rx/10/values 623,2,18.25<br />
2015-12-18 06:31:38,216 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 81 adding frame to buffer =&gt; [1450420298, 10, 623, 2, 18.25, -45]</p>
<p>&nbsp;</p>
<p>Then I have loads of disregarded frames:<br />
You can see from the first value and time stamp that these&nbsp;are not noise</p>
<p>2015-12-18 06:33:20,292 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 113 2 2 0 33 7 (-48)<br />
2015-12-18 06:33:30,516 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 52 2 1 0 33 3 (-44)<br />
2015-12-18 06:33:40,789 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 113 2 2 0 33 7 (-44)</p>
<p>Whilst noise looks like this:</p>
<p>2015-12-18 06:33:41,036 DEBUG RFM2Pi Discarding RX frame &#39;unreliable content&#39;? 138 66 225 247 230 11 147 210 13 75 35 205 120 222 103 59 178 90 214 102 61 (-102)</p>
<p>
The node config:</p>
<p>[[10]]<br />
&nbsp; &nbsp; nodename = Sovrum<br />
&nbsp; &nbsp; firmware = &quot;&quot;<br />
&nbsp; &nbsp; hardware = &quot;emonTX V2&quot;<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; names = W, p, T1<br />
&nbsp; &nbsp; &nbsp; &nbsp; datacode = h<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1,1,0.01<br />
&nbsp; &nbsp; &nbsp; &nbsp; units = W,p,C</p>
<p>Previous config when only temperature was measured:</p>
<p>#[[10]]<br />
# &nbsp; &nbsp;nodename = Sovrum<br />
# &nbsp; &nbsp;firmware = &quot;&quot;<br />
# &nbsp; &nbsp;hardware = &quot;emonTX V2&quot;<br />
# &nbsp; &nbsp;[[[rx]]]<br />
# &nbsp; &nbsp; &nbsp; &nbsp;name = T1<br />
# &nbsp; &nbsp; &nbsp; &nbsp;datacode = h<br />
# &nbsp; &nbsp; &nbsp; &nbsp;scale = 0.01<br />
# &nbsp; &nbsp; &nbsp; &nbsp;unit = C</p>
<p>&nbsp;</p>
<p>Any thoughts on this?</p>
<p>&nbsp;</p>
<p>Thanks in advance!</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11713.html" class="topic-previous" title="Go to previous forum topic">‹ ESP8266, emonlib and thingspeak</a>
              <a href="12070.html" class="topic-next" title="Go to next forum topic">Help with Project ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-37163"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9140.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bjorksta&#039;s picture" title="Bjorksta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/9140.html" title="View user profile.">Bjorksta</a> on Fri, 18/12/2015 - 06:37.</div>
    <div class="content">
     <p>Oh, here is the node configuration:</p>
<p>[[10]]<br />
&nbsp; &nbsp; nodename = Sovrum<br />
&nbsp; &nbsp; firmware = &quot;&quot;<br />
&nbsp; &nbsp; hardware = &quot;emonTX V2&quot;<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; names = W, p, T1<br />
&nbsp; &nbsp; &nbsp; &nbsp; datacode = h<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 1,1,0.01<br />
&nbsp; &nbsp; &nbsp; &nbsp; units = W,p,C</p>
<p>Privous one when i only ran temperature (worked good):</p>
<p>#[[10]]<br />
# &nbsp; &nbsp;nodename = Sovrum<br />
# &nbsp; &nbsp;firmware = &quot;&quot;<br />
# &nbsp; &nbsp;hardware = &quot;emonTX V2&quot;<br />
# &nbsp; &nbsp;[[[rx]]]<br />
# &nbsp; &nbsp; &nbsp; &nbsp;name = T1<br />
# &nbsp; &nbsp; &nbsp; &nbsp;datacode = h<br />
# &nbsp; &nbsp; &nbsp; &nbsp;scale = 0.01<br />
# &nbsp; &nbsp; &nbsp; &nbsp;unit = C</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37165"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Fri, 18/12/2015 - 07:08.</div>
    <div class="content">
     <p>@Bjotksta,</p>
<p>The Discarding RX frame &#39;unreliable content&#39; is because those packets are failing the CRC check, shown by the &#39;?&#39;.</p>
<p>If you could capture some more (with good packets in between), the bit position that is first failing will become clearer. The earliest part of the packet is ok since the node ID / length fields are correct - a glitch is occurring later on (seemingly quite early if that &#39;52&#39; is typical).</p>
<p>The signal strength is fine - this is more likely a timing issue.&nbsp; Your version of EmonTX V2 is using an RFM12B radio module?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37168"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9140.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bjorksta&#039;s picture" title="Bjorksta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/9140.html" title="View user profile.">Bjorksta</a> on Fri, 18/12/2015 - 09:42.</div>
    <div class="content">
     <p>Thanks for the input!</p>
<p>Perhaps this is an error in the code of the emonTX, i should have a look at that.</p>
<p>The emonTX&nbsp;also has a RFM69&nbsp;module.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37169"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9140.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bjorksta&#039;s picture" title="Bjorksta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/9140.html" title="View user profile.">Bjorksta</a> on Fri, 18/12/2015 - 10:01.</div>
    <div class="content">
     <p>Got some more frames:</p>
<p>How do you decode the data?&nbsp;</p>
<p>2015-12-18 09:45:02,295 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 666 NEW FRAME : OK 10 16 2 2 0 189 6 (-61)<br />
2015-12-18 09:45:12,101 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 21 2 2 0 189 6 (-47)<br />
2015-12-18 09:45:22,396 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 667 NEW FRAME : OK 10 15 2 1 0 189 6 (-51)<br />
2015-12-18 09:45:32,534 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 16 2 2 0 189 6 (-45)<br />
2015-12-18 09:46:03,226 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 17 2 1 0 189 6 (-49)<br />
2015-12-18 09:46:13,416 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 670 NEW FRAME : OK 10 20 2 2 0 189 6 (-46)<br />
2015-12-18 09:46:23,647 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 671 NEW FRAME : OK 10 10 2 1 0 189 6 (-45)<br />
2015-12-18 09:46:33,818 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 20 2 2 0 189 6 (-47)<br />
2015-12-18 09:46:44,107 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 11 2 1 0 189 6 (-47)<br />
2015-12-18 09:46:54,258 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 209 1 1 0 189 6 (-50)<br />
2015-12-18 09:47:04,532 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 672 NEW FRAME : OK 10 208 1 2 0 189 6 (-45)<br />
2015-12-18 09:47:14,710 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 189 1 1 0 189 6 (-45)<br />
2015-12-18 09:47:25,013 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 673 NEW FRAME : OK 10 194 1 1 0 189 6 (-45)<br />
2015-12-18 09:47:35,159 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 201 1 2 0 189 6 (-48)<br />
2015-12-18 09:47:45,373 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 674 NEW FRAME : OK 10 217 1 1 0 189 6 (-46)</p>
<p>
2015-12-18 09:50:49,257 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 682 NEW FRAME : OK 10 206 1 1 0 189 6 (-46)<br />
2015-12-18 09:50:59,394 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 683 NEW FRAME : OK 10 202 1 2 0 189 6 (-46)<br />
2015-12-18 09:51:09,650 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 216 1 1 0 189 6 (-45)<br />
2015-12-18 09:51:19,836 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 684 NEW FRAME : OK 10 202 1 1 0 182 6 (-47)<br />
2015-12-18 09:51:30,036 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 685 NEW FRAME : OK 10 200 1 2 0 189 6 (-45)<br />
2015-12-18 09:51:40,305 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 198 1 1 0 182 6 (-46)<br />
2015-12-18 09:51:50,464 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 686 NEW FRAME : OK 10 206 1 1 0 189 6 (-46)<br />
2015-12-18 09:52:00,695 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 687 NEW FRAME : OK 10 216 1 1 0 182 6 (-45)<br />
2015-12-18 09:52:10,884 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 688 NEW FRAME : OK 10 212 1 2 0 189 6 (-48)<br />
2015-12-18 09:52:21,186 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 66 1 (-45)<br />
2015-12-18 09:52:31,404 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; Discarding RX frame &#39;unreliable content&#39;? 10 206 1 1 0 182 6 (-45)<br />
2015-12-18 09:52:41,641 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 689 NEW FRAME : OK 10 202 1 2 0 189 6 (-45)</p>
<p>I can check and post the transmitter code after the weekend, but basically its a mix of the examples available on the site;&nbsp;emonTx_Pulse and&nbsp;emontx_temperature_power.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37170"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 18/12/2015 - 10:07.</div>
    <div class="content">
     <p>I agree a larger dataset is needed to&nbsp;make&nbsp;possible to recognize a pattern.</p>
<p>Is the emonTx v2 battery or AC powered?</p>
<p>How are the pulses being collected?</p>
<p>Is the RFM being put to sleep between sends?</p>
<p>Is the temp sensor just a regular&nbsp;ds18b20 ?</p>
<p>Can we see the sketch?</p>
<p>Since the packet and the crc do not match, the probability is one or the other is changed after it&#39;s set. The obvious (but IMO unlikely in this instance) is RF interference or poor signal etc. I don&#39;t think there are enough bits to suspect a &quot;drift&quot; especially if the issue is early in the packet.&nbsp;</p>
<p>The chances are something is happening to the packet after crc is set but before transmission in the sketch following the edit to add pulse counting. whether it&#39;s the pulse counting itself or just a consequence of the change I wouldn&#39;t like to say. My feeling is it&#39;s a&nbsp;misbehaving&nbsp;interrupt routine altering or the rfm not being ready to&nbsp;use&nbsp;(see&nbsp;<a href="11062.html">emonTH Unreliable reading timing?</a>) or another similar timing issue.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37171"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Fri, 18/12/2015 - 10:39.</div>
    <div class="content">
     <p>@Bjotksta,</p>
<p>You could certainly drop the Tx power setting, even to minimum - there is plenty of signal there.&nbsp; Good for battery life if you are using and will eliminate one possible cause of packet corruption due to voltage sag</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37347"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9140.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bjorksta&#039;s picture" title="Bjorksta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/9140.html" title="View user profile.">Bjorksta</a> on Mon, 21/12/2015 - 20:24.</div>
    <div class="content">
     <p>Thanks for the inputs!</p>
<p>The node is powered via 5V USB.&nbsp;</p>
<p>The pulses are collected with a TSL257 in a home-built enclosure.&nbsp;</p>
<p>The temp sensor is a regular DS18B20.</p>
<p>Yes, the sketch is built up by the examples on github, which puts the RFM to sleep and wakes it up just before transmission without delay.</p>
<p>I also thought the interrupt routine may change the values between the CRC being calculated and transmission, so i modified it a bit after posting this thread, but there was no significant change. I even tried to send constant values, but without success.</p>
<p>Then I&nbsp;added a 120ms delay between wake-up of the RFM and the transmission (which seemed to be the cause in the thread regarding emonTH) and that made a huge difference. Since that moment I have not spotted a single disregarded frame!</p>
<p>I now have a working temperature sensor/energy consumption monitor!</p>
<p>Thanks for the help!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38847"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Thu, 28/01/2016 - 20:26.</div>
    <div class="content">
     <p>I am also seeing many discarded frames. What exactly did you do to add the 120ms delay? ie what did you edit and where?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38848"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9140.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bjorksta&#039;s picture" title="Bjorksta&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/9140.html" title="View user profile.">Bjorksta</a> on Thu, 28/01/2016 - 20:37.</div>
    <div class="content">
     <p>Look in emontx_lib.ino, where the transmit function is:</p>
<p>void send_rf_data()<br />
{<br />
  rf12_sleep(RF12_WAKEUP);<br />
  // if ready to send + exit loop if it gets stuck as it seems too<br />
  int i = 0; while (!rf12_canSend() &amp;& i<10) {rf12_recvDone(); i++;}<br />
  rf12_sendStart(0, &amp;emontx, sizeof emontx);<br />
  // set the sync mode to 2 if the fuses are still the Arduino default<br />
  // mode 3 (full powerdown) can only be used with 258 CK startup fuses<br />
  rf12_sendWait(2);<br />
  rf12_sleep(RF12_SLEEP);<br />
}</p>
<p>Add a delay ( delay(120); )<br />
After<br />
rf12_sleep(RF12_WAKEUP);</p>
<p>/Bjorksta</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38849"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Thu, 28/01/2016 - 21:24.</div>
    <div class="content">
     <p>I have found it but. What does it look like once done? &nbsp;same line ? next line? I have no idea how to write this stuff so thanks in advance.</p>
<p>Mine is emontx3.4 so a bit different.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38852"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 28/01/2016 - 21:08.</div>
    <div class="content">
     <p>There are several different causes for packets being discarded due to crc failure. If you can post some of the discarded packets, it may be possible to confirm the actual cause. The fix used here is quite specific to the rf12 sleep routine affecting the next&nbsp;packet&nbsp;sent.</p>
<p>Is this in connection with the emonTx&nbsp;v3&nbsp;you are posting about in another thread? If so, it is more likely to be due to the unused temp sensor circuits causing a long run of zero bits.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38866"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Fri, 29/01/2016 - 10:56.</div>
    <div class="content">
     <p>I have zero discards from the older Pi with rf12 emontx3.2 firmware even though the emontx are at long distance from Pi. And lots of discards from new Pi rf69&nbsp;emontx3.4 firmware with node really close..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38874"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Sun, 31/01/2016 - 14:42.</div>
    <div class="content">
     <p>Could you post that as a longer text file - the single screen full is a bit limiting.&nbsp; What <em>is </em>shown are discarded noise packets (look at the signal strength in brackets at the end of the packet dump).&nbsp; The &#39;good&#39; packets <u>are way too strong</u> - just fold the antenna up on the Tx side to get the strength below -30dBm</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38883"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Fri, 29/01/2016 - 19:57.</div>
    <div class="content">
     <p>Paul, This is the new pi2 with emon tx3.4 with firmware as supplied 2 weeks ago. So temp string is 300 for non existent ones. I get zero discards from old pi(with new firmware) and emontx3.2 with zeros in temp string even though the emontxs&nbsp;are at range extremities. The emontx3.4 is reporting signals of -30 on good packets due to the 2 units being side by side. too strong? I did consider hard wiring them together but purchasing without rf modules wasn&#39;t possible I was told.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38932"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 31/01/2016 - 13:31.</div>
    <div class="content">
     <p>So are you actually missing any data ?</p>
<p>If so where are you seeing the data is missing? if in emoncms it may be a quirk of &quot;fixed intervals&quot; and you should check emonhub.log.&nbsp;</p>
<p>&quot;discarded&quot; packets are anything that didn&#39;t pass the crc checks, this includes anything that is received from other non-rfm devices eg a&nbsp;neighbors doorbell, baby monitors etc, plus any rfm packets from another group and occasionally some corrupted valid packets caused by issues including those mentioned above eg bitslip&nbsp;or the rf12 wakeup issue.</p>
<p>If there are lost packets to be retrieved we may be able to find the cause by studying the &quot;discarded&quot; packets, to do that we would need a sizeable chunk of actual data that can be manipulated, sorted and searched rather than a picture of a snippet. The first thing to be done would probably be to filter out anything with a very low RSSI as it can be assumed these are distant devices of no interest (unless debugging a weak signal of course) then patterns and similarities between valid and failed packets are studied.</p>
<p>If you do not want to use the RF&nbsp;search the term &quot;serial-direct&quot; on this forum, it is possible to not use the rf regardless of whether the emontx&nbsp;is&nbsp;available without a fitted rfm module.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38935"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5606.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="webby&#039;s picture" title="webby&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/5606.html" title="View user profile.">webby</a> on Sun, 31/01/2016 - 14:33.</div>
    <div class="content">
     <p>Thanks Paul,</p>
<p>Yes I saw the stuff about direct connection a little while back. That&#39;s what made me think of doing it because the devices are so close together in this instance. But when I discovered that the units came with rf anyway I decided to use rf.</p>
<p>What is interesting (I think) is that the older pi with 2 emontx3.2s and their firmware suffers zero discarded packets even though one emon tx is again 6&nbsp;inches away from the pi and the other is 30yrds through 2 brick walls.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38938"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emon not processing all frames from node</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 31/01/2016 - 14:56.</div>
    <div class="content">
     <p>I think it is the term &quot;discarded&quot; that maybe unhelpful. lets use the term &quot;garbage&quot;, most of the time the &quot;garbage&quot; is just that, garbage, not abnormal and of zero interest. The older system seems to be operating as expected, 30 yards and 2 brick walls isn&#39;t an impossible ask and the fact you have no dropped packets confirms that. there will be a difference in received signal strength between the near and far devices but you cannot see that as it is an rfm12b based receiver, another brick wall or 5&nbsp;more&nbsp;yards may of had different results and if you were finding the occasional dropped packet the first easy check may have been to try and reduce that span to reduce signal loss as a test, but you are not so all is well on that front.</p>
<p>The newer system which I also suspect is not losing any packets is a rfm69 based receiver&nbsp;so it is a more sensitive receiver and will not only see stronger and more &quot;good packets&quot; but also more &quot;garbage&quot; as it has a stronger listener. it is also a potentially noisier frequency depending on other tech you and you neighbors have. so it is not abnormal to see lots of garbage in the -90 to -100 RSSI range and some in the -70 to -80 but at this time&nbsp;you would only really be interested&nbsp;in any packets in say the 0 to -40 range IF you were trying to locate missing packets, otherwise there is unlikely to be anything of interest.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11824"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-oZVeb7aMdrZ3t2rR7JUuVQrUWk8nIV38R4Rjheb-D8c" value="form-oZVeb7aMdrZ3t2rR7JUuVQrUWk8nIV38R4Rjheb-D8c"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
