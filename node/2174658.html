<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/217?page=2 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:18:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Solar Power Manager | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
          <span class="submitted"></span>
      <div class="taxonomy"></div>
      <div class="content"><p>&nbsp;I have used the 2 channel non invasive sketch, to build a device which monitors how much power is being used in the home, and how much &nbsp;power is being generated by the solar panels. If I am generating more than I am currently using, then the excess power is diverted to an immersion heater - to heat domestic hot water. This is a better option than it flowing back to the grid for which I don't get paid (solar renta roof).</p>
<p>This was a steep learning curve as I have never worked with a microprocessor before, but great fun and a great sense of acheivement when it actually works!</p>
<p><img alt="PCB" width="600" height="401" src="http://error404.000webhost.com/?" /></p>
<p>The first version was built on a Arduino Uno board, with the input components mounted on veroboard, but then I decided to build it as a standalone, with everything on one board.<br />
The LCD is reclaimed from an old alarm keypad, and I had a USB panel socket laying about so I used that for the 4 CT input connections. (did I mention that I am a Yorkshireman...)</p>
<p>As the peak solar &nbsp;power generation is 3.5kw, I used a shunt resistor to range up to 5kw, but fitted clamping &nbsp;diodes (Glyn's idea - see forum) to ensure that the mains usage did not exceed 5kw and damage the Atmega chip.</p>
<p><img alt="fitted in box" width="600" height="439" src="http://error404.000webhost.com/?" /><br />
&nbsp;</p>
<p>With a bit of sawing and hacking, managed to fit the PCB into a Maplins project box.</p>
<p><img alt="power readings" width="600" height="386" src="http://error404.000webhost.com/?" /></p>
<p>Here you can see the power results, which if less than 1kw displays in watts, otherwise kw's.</p>
<p>The tiny LED is multi function and indicates;</p>
<p>1) flashing every 4 seconds - indicates that the unit is functioning, but not enough solar power to activate either relay.<br />
2) steady but lit 25% - indicates that 500w is being unused, and activates relay 1, with a diode in series to limit the load to 500w (yes it does work, I've done the sums on the leccy meter!)<br />
3) steady but lit brightly - indicates that in excess of 1kw is being unused, switches off relay 1 and activates relay 2 which delivers a full kw (which is the rating of the immersion heater).</p>
<p>The button is a menu navigator, and switches between displays (copied from another project).</p>
<p><img alt="kwh" width="600" height="399" src="http://error404.000webhost.com/?" /><br />
&nbsp;</p>
<p>This display shows how much power is generated within a 24hr period, before resetting back to zero at midnight. There is no external timing here, just a simple millis() counter which resets every 24hrs. On startup, the counter resets after 12hrs for one occassion ( so if it's powered up at midday, it will &nbsp;reset at midnight and every midnight thereafter.</p>
<p><img width="600" height="399" alt="" src="http://error404.000webhost.com/?" /></p>
<p>This display shows voltage and power factor, which of course is needed for calibration purposes.<br />
To calibrate it, I took the readings from the LCD, removed the chip and wrote the new sketch via a Arduino Uno board, before replacing it in the standalone.</p>
<p>The sketch is posted <a href="http://bit.ly/p0QhTE">here</a>&nbsp;, please feel free to make any suggestions or create a new version of the paste in pastebin., and although a new guy to Arduino's/programming, if I can help, please email me at (the last word in bold in this post) <strong>@gmail.com</strong></p>
<p>Sketch has also been uploaded to OpenEnergyMonitor. Download it <a href="../sites/default/files/SolarEnergyMonitor.html">here</a></p>
<h2>...UPDATE 7th Sept</h2>
<p>Following Glyn's advice (in comments below) I have built a Nanode, and have connected both units via their Rx/Tx serial bus, and use a simple Serial.print statement in the above device, to be decoded in the Nanode by the CmdMessenger library.</p>
<p>Data is then <a href="http://bit.ly/nADmAo">uploaded to Pachube</a> every 20seconds by the Nanode, provided that the data values have changed.</p>
<p>&nbsp;</p>
<p>Many thanks to Trystan &amp; Glyn</p>
<p><strong>yorkshirepudn</strong></p>
<p>Please post any comments and questions about the Solar PV Manager system to the <a href="../forum.html">forums</a></p>
<p>&nbsp;</p>
</div>
    
    
      </div>
<div id="comments">
  <div class="indented"><a id="comment-2043"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="eof&#039;s picture" title="eof&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by eof (not verified) on Sun, 28/08/2011 - 23:49.</div>
    <div class="content">
     <p>Thanks - I'd better make some progress then!</p>
<p>There should be no specific compensation needed for the immersion heater: the control loop will just try to keep the grid current to a small value in the export direction.&nbsp; Damping it correctly will probably be a challenge.</p>
<p>It would be a pity if another chip were needed to produce the pulses.&nbsp; I'm very new to this so haven't really got a handle on it yet, but you've got the micros() function which could be used to get fairly accurate timings, assuming your loop iterates quickly enough.&nbsp; Am I right in thinking that it is limited by the speed at which ADC samples appear?&nbsp; I see that the microcontroller has three timers and interrupt capability, so perhaps something could be done with that?&nbsp; I haven't worked out how you are managing to call delay() without losing samples.</p>
<p>I&nbsp;presume a power MOSFET would have to sit inside a bridge rectifier, so would probably be less efficient than a triac after you take into account two diode drops.&nbsp; The triac would be bolted to a nice earthed metal case, and the worst that could happen would be that it would fail short circuit, just putting the immersion heater on &quot;manual&quot;.</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div><a id="comment-1996"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 09/08/2011 - 19:50.</div>
    <div class="content">
     <p>Fantastic work Paul! It looks great in that box. I'v uploaded the code to OpenEnergyMonitor and attached it to your post as a more permanent solution than paste bin. I'v kept your link to past bin.&nbsp;</p>
<p>Would you mind adding you email to the end of the post so any questions could be directed to you?&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-1999"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 09/08/2011 - 21:12.</div>
    <div class="content">
     <p>Cheers Glyn, I am well pleased with the project, and today has been the first full day since installation.<br />
It has diverted 2.4kWh to the immersion heater today and has met our total hot water needs, so the gas boiler didn't even need to fire up, reducing our gas power usage.</p>
<p>I wish I had used a ethernet/pachube output though, because I could check the status via my iPhone instead of having to go into the garage and look at the LCD.</p>
<p>Can you suggest a low cost solution to get this data to pachube - with or without the LCD. My router is about 3mtrs away from the unit.<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2003"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 09/08/2011 - 23:06.</div>
    <div class="content">
     <p>&nbsp;Hi Paul,</p>
<p>Probably the cheapest and most flexible&nbsp;option is to use a <a href="http://wiki.hackspace.org.uk/wiki/Project:Nanode">Nanode</a>. There is a code example of uploading data to Pachube using the nanode <a href="https://gist.github.com/1130021">here</a>. You have the luxury&nbsp;of having your router so close, so wireless transmission will not be required. The Nanode could exchange serial data with your other arduino on the Rx and Tx pins. On the Nanode the Rx and Tx pins are broken out to the green terminal block. One power supply could be used to power both boards.&nbsp;</p>
<p>Thanks for adding your emai btw!&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2011"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 10/08/2011 - 21:08.</div>
    <div class="content">
     <p>&nbsp;Thanks Glyn, could you clarify a few points please;;</p>
<p>1) As I am not using a Arduino Uno board, do I use pins 2 &amp; 3 (D0 &amp; D1) from the Atmega 328 to gain access to Rx &amp; Tx, and is it a simple wired connection from Tx on the Atmega to Rx on the Nanode, and from Rx on the Atmega to Tx on the Nanode?</p>
<p>2) The Nanode sketch is pretty scary, how much additional programming would be needed in both the Atmega &amp; Nanode sketches to make this happen?</p>
<p>You will probably have realised by now that I am running uphill!!</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2012"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 10/08/2011 - 22:33.</div>
    <div class="content">
     <p>Yes that's it.Maybe do some testing using a normal Arduino talking to the Nanode if you have a spare one laying around.&nbsp;</p>
<p>Not much extra should be needed on your Atmega, just a few lines to serial print out the data you want to send to the Nanode. On the Nanode the data needs to be received, stored in the correct variables then posted to Pachube. If you want to send multiple variables you could send them in CVS format then use <a href="https://gist.github.com/1138458">this </a>sketch that some friends of mine wrote to decode/convert the serial data stream back into variables. &nbsp;</p>
<p>It would be a good idea to test out posting some test data to Pachube using the Nanode with it stand-alone to begin with. I've not actually used that sketch or am experiance in using pachube. I've head other people having success with that sketch. &nbsp;</p>
<p>Good luck,&nbsp;</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2017"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Thu, 11/08/2011 - 13:26.</div>
    <div class="content">
     <p>Thanks Glyn, I have ordered one from Ken, so no turning back now!</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div></div></div><a id="comment-2000"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Steve Knight&#039;s picture" title="Steve Knight&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by Steve Knight (not verified) on Tue, 09/08/2011 - 21:33.</div>
    <div class="content">
     <p>Paul, Good work, This is just what i have been trying to do, but without as much success as you have had!.<br />
I have had the system working, but with a 3 kW immersion heater, and using a Triac to limit the power to that available, but your stand alone method is a very elegant solution, is there a chance you could publish the vero board layout ? </p>
<p>Regards Steve</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2001"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 09/08/2011 - 21:50.</div>
    <div class="content">
     <p>Steve, I too have considered triacs, and especially the linear power controllers (Crydom), but they are not totally linear in operation and difficult to match supply/demand.</p>
<p>I also considered fitting a full wave bridge rectifier to the load, and using a Mosfet to control the power via PWM...</p>
<p>Eventually, I went for the relay option, which is a safe and logically dependable option (but maybe not the most efficient!), but I accept the trade-off.</p>
<p>I sketched the veroboard layout on paper but made a number of mistakes, which were corrected post build, so give me a couple of days, and if I can, I'll post it.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
<div class="indented"><a id="comment-2002"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Steve Knight&#039;s picture" title="Steve Knight&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Solar Power Manager</h3>

    <div class="submitted">Submitted by Steve Knight (not verified) on Tue, 09/08/2011 - 22:54.</div>
    <div class="content">
     <p>Thanks Paul, I was using PWM to control the Triac, from an Arduino dimmer project published elsewhere. It works fine, although you need a big heatsink or the Triac overheats and will avalanche, also it is safer to use an isolated tab Triac in case you accidentally touch it while it powered up!!</p>
<p>To get round the supply/demand problem I had to wire the immersion heater circuit outside the c/t otherwise its seen as load and the system see-saws. I do this by putting the c/t on the neutral to the consumer unit and passing the immersion heater neutral back through the c/t, thus cancelling the I/heater load. Luckily I have 16mm tails, I'm not sure if you could fit both in the c/t if you have 25mm tails. It's at this point I should say I'm a qualified electrician, and that anyone thinking of trying this at home should take care not to electrocute themselves... or use the services of your friendly neighbourhood electrician</p>
<p>Steve</p>
         </div>
    <div class="links">&raquo; </div>
  </div>
</div></div></div></div><div class="item-list"><ul class="pager"><li class="pager-first first"><a href="217.html" title="Go to first page" class="active">« first</a></li>
<li class="pager-previous"><a href="2172679.html?page=1" title="Go to previous page" class="active">‹ previous</a></li>
<li class="pager-item"><a href="217.html" title="Go to page 1" class="active">1</a></li>
<li class="pager-item"><a href="2172679.html?page=1" title="Go to page 2" class="active">2</a></li>
<li class="pager-current">3</li>
<li class="pager-item"><a href="2179ba9.html?page=3" title="Go to page 4" class="active">4</a></li>
<li class="pager-next"><a href="2179ba9.html?page=3" title="Go to next page" class="active">next ›</a></li>
<li class="pager-last last"><a href="2179ba9.html?page=3" title="Go to last page" class="active">last »</a></li>
</ul></div></div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
