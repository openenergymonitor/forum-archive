<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11124 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:30:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>RFM12Pi damaged by thunderstorm??? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">RFM12Pi damaged by thunderstorm???</h3>
        <span class="submitted">Submitted by <a href="../user/5733.html" title="View user profile.">Andrew Wedmore</a> on Fri, 14/08/2015 - 15:23</span>
        <div class="content"><p>After 2+ years, my RFM12PiV2 receiver seems to have gone phut.&nbsp; It did happen around the time of a big thunderstorm - could this be the reason?</p>
<p>Anyway, I have ordered a RFM69PiV3 as a replacement and hopefully I won&#39;t have any compatibility problems.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="../https_/%252Fgithub.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/unsorted_examples/emonT/emonTxV3_R.8bf.delaye" class="topic-previous" title="Go to previous forum topic">‹ How to verify if the RF modules are working?</a>
              <a href="11131.html" class="topic-next" title="Go to next forum topic">Can i use  one AC power adapter for [Measuring AC Voltage and power supply for electric circuits] at the same time ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-33358"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM12Pi damaged by thunderstorm???</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 15/08/2015 - 10:04.</div>
    <div class="content">
     <p>Can you expand on &quot;gone phut&quot; ?</p>
<p>Although electrical surges etc can do very unexpected things I would be surprised if &#39;only&#39; your rfm2pi&nbsp;was effected if it was due to the storm. There should be no compatibility issues beyond setting the usual&nbsp;baseid, group and frequency if required except for perhaps setting the baud, if your v2 was 2yrs old it would be using a baud of 9600 and the v3 will be 38400,</p>
<p>What have you tried to test / revive it? is there any led activity at power up? do you get any response to this ?</p>
<p><strong>avrdude -v -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 38400</strong></p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33432"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andrew Wedmore&#039;s picture" title="Andrew Wedmore&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM12Pi damaged by thunderstorm???</h3>

    <div class="submitted">Submitted by <a href="../user/5733.html" title="View user profile.">Andrew Wedmore</a> on Wed, 19/08/2015 - 08:31.</div>
    <div class="content">
     <p>Paul, thank you for that.</p>
<p>When I power up, a green LED on the RFM12Pi comes on briefly and then goes out and stays out.</p>
<p>The rfm12piphp service is running, but the emoncms &quot;inputs&quot; web page is showing no data being received on any of the nodes that get data via the rfm12pi.&nbsp; I have other nodes on my system that are continuing to log data that comes from other sources (not via the rfm12pi) so I think the actual data logging side is working OK.&nbsp; I&#39;ll attach a screenshot that shows this - node 7 is a non-rfm12pi node.&nbsp; Nodes 8 and 9, are rfm12pi nodes and they used to receive data OK.&nbsp; I don&#39;t think it is the transmitters at fault because there are completely separate 3 transmitters and one receiver listening to them, and the data from all 3 transmitters stopped being received at the same time.&nbsp; So when I say it has &quot;gone phut&quot; I mean that I am no longer getting any data from it. I don&#39;t know for sure that it is a hardware problem; it just seemed the easiest culprit to suspect and replace.</p>
<p>Here is the output from the avrdude command.&nbsp;</p>
<pre>
avrdude-original: Version 5.11.1, compiled on May 23 2012 at 11:08:25
                  Copyright (c) 2000-2005 Brian Dean, <a href="http://www.bdmicro.com/" title="http://www.bdmicro.com/">http://www.bdmicro.com/</a>
                  Copyright (c) 2007-2009 Joerg Wunsch

                  System wide configuration file is &quot;/etc/avrdude.conf&quot;
                  User configuration file is &quot;/root/vrduderc&quot;
                  User configuration file does not exist or is not a regular file, skipping

                  Using Port                    : /dev/ttyAMA0
                  Using Programmer              : arduino
                  Overriding Baud Rate          : 38400
done with autoreset
avrdude-original: stk500_getsync(): not in sync: resp=0x78
</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33435"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM12Pi damaged by thunderstorm???</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 19/08/2015 - 09:55.</div>
    <div class="content">
     <p>You are most probably right to suspect the rfm2pi&#39;s&nbsp;not doing it&#39;s bit, I just wondered whether&nbsp;it was terminal&nbsp;as they are normally pretty reliable.</p>
<p>The LED flash suggests something is happening, although the avrdude&nbsp;log shows a communication error which could mean a HW fault or bootloader issue but it isn&#39;t conclusive as there are a number of things that can also cause a communication issue. since avrdude is a bit finicky, Was the&nbsp;rfm12piphp service running at the time? serial port access must be exclusive for any SW to work correctly, so the service must be stopped.</p>
<p>A good power supply is essential so removing any non-essential usb devices may help</p>
<p>you could try using a serial console (minicom etc) to try and get a response from the rfm2pi,</p>
<p>You could also test the Pi serial port by linking the gpio rx/tx pins together, anything &quot;sent&quot; in the serial console should appear in the &quot;received&quot; box due to the loop, but I&#39;ve not known a serial port to fail on a Pi and&nbsp;the serial port and the SW will get tested when you try the RFM69Pi. However....</p>
<p>I didn&#39;t realize&nbsp;you were using the raspberrypi module as far as I&#39;m aware there is no way to set the baud in the interface so you will need to edit the code from 9600 to 38400 at <a href="https://github.com/emoncms/raspberrypi/blob/master/raspberrypi_run.php#L73">L73 of raspberrypi_run.php</a> (probably?) or edit, recompile and upload a modified&nbsp;sketch to the rfm69pi&nbsp;(or move to emonHub)&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33440"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andrew Wedmore&#039;s picture" title="Andrew Wedmore&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM12Pi damaged by thunderstorm???</h3>

    <div class="submitted">Submitted by <a href="../user/5733.html" title="View user profile.">Andrew Wedmore</a> on Wed, 19/08/2015 - 11:19.</div>
    <div class="content">
     <p>Paul - thanks again for your help.&nbsp; I now think I know what my problem is, and it&#39;s not what I thought it was.!</p>
<p>I have run the avrdude command again after stopping the rfm12piphp service and as a result I now think that the reciever IS working and that all 3 transmitters HAVE stopped working, while the RFM12Pi is OK!&nbsp; That sounds like an amazing coincidence, but I think there may have been a common cause that blew all 3 at the same time. I will paste the new avrudude output at the end of the message.</p>
<p>Looking at the EMONCMS graphs and inputs from just before the monitoring stopped working, I can see that all 3 transmitters were reporting a very high AC voltage.&nbsp; The last AC voltage reading from node 8 was 307.58; from node 9 it was 310.1 and from node 10 it was 308.58 volts.&nbsp; These are RMS voltages and normally they are in the range 210 - 240.&nbsp; I have been logging the AC voltage from node 10 for over a year and it has always been in this range.&nbsp;</p>
<p>I have attached a screenshot showing my AC voltage graph just before things went down.&nbsp; [ACVoltageGraph.png - the brown is the AC RMS voltage and the blue is the generator output in watts.]</p>
<p>All my 3 EmonTxV3 transmitters are powered through the 9V AC transformers, not via USB.&nbsp; So I calculate with a 310V input, these will be pumping 9 x 310/230 volts into the EmonTxV3 units - ie over 12 volts.</p>
<p>As an &quot;off-gridder&quot; my AC is all produced by a Victron inverter/charger (specifically, a Victron Phoenix Multiplus 5000/48).&nbsp; I have had one previous occasion several years ago (before I started using the OpenCMS products) when the AC voltage from the inverter ran out of control.&nbsp; On that occasion, it damaged part of my consumer unit panel but, worryingly, did not trip any trip switches.&nbsp; In fact that episode was part of my motivation for installing the OpenCMS products,&nbsp; Now that the problem has occurred again and I have the logging data (which to my mind is pretty conclusive) I will take it up with the manufacturers - but I am not particularly hopeful of their response.&nbsp; (There is also a solar inverter in the system, but it is the Victron that determines the voltage and frequency - except when the generator is on, but that&#39;s a different story).</p>
<p>I checked the AC voltage with a multimeter just now and it is about 240V - a little higher than it should be, but acceptable.&nbsp;</p>
<p>Anyway if I&#39;m right I now have 3 dead EmonTxV3 units - which is a shame as they are a lot more expensive than the RFM12Pi (or the RFM69PiV3 that arrived in the post yesterday and is sitting on my desk).&nbsp; In fact I am pretty sure that they are dead as they used to have a flashing red LED and it isn&#39;t flashing any more, not even on power-up.&nbsp; I had been intending to change them to be powered by USB but I just hadn&#39;t got round to it - perhaps that would have saved them from being damaged.&nbsp; I don&#39;t know if there is any way that they can be repaired.&nbsp;</p>
<p>Another thought is that I could rig up OpenCMS to send me an alarm when the AC voltage goes out of range.&nbsp; But actually I think what I really need to do is to install some separate electro-mechanical device that shuts off the AC if the voltage gets too high.</p>
<p>Finally, I am intending to switch to emonhub but that is another thing I haven&#39;t got round to yet.&nbsp; I have got 18 months&#39; worth of data in timestore which I am very keen to preserve as it will help me figure out where to upgrade the system in the future.</p>
<p>Here is the avrdude output. &nbsp;</p>
<pre>
pi@raspberrypi ~ $ sudo service rfm12piphp stop
Log is turned off
Stopping RPI: stopped
pi@raspberrypi ~ $ avrdude -v -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 38400              
avrdude-original: Version 5.11.1, compiled on May 23 2012 at 11:08:25
                  Copyright (c) 2000-2005 Brian Dean, <a href="http://www.bdmicro.com/" title="http://www.bdmicro.com/">http://www.bdmicro.com/</a>
                  Copyright (c) 2007-2009 Joerg Wunsch

                  System wide configuration file is &quot;/etc/avrdude.conf&quot;
                  User configuration file is &quot;/root/.avrduderc&quot;
                  User configuration file does not exist or is not a regular fil             e, skipping

                  Using Port                    : /dev/ttyAMA0
                  Using Programmer              : arduino
                  Overriding Baud Rate          : 38400
done with autoreset
                  AVR Part                      : ATMEGA328P
                  Chip Erase delay              : 9000 us
                  PAGEL                         : PD7
                  BS2                           : PC2
                  RESET disposition             : dedicated
                  RETRY pulse                   : SCK
                  serial program mode           : yes
                  parallel program mode         : yes
                  Timeout                       : 200
                  StabDelay                     : 100
                  CmdexeDelay                   : 25
                  SyncLoops                     : 32
                  ByteDelay                     : 0
                  PollIndex                     : 3
                  PollValue                     : 0x53
                  Memory Detail                 :

                                           Block Poll               Page                                    Polled
                    Memory Type Mode Delay Size  Indx Paged  Size   Size #Pages              MinW  MaxW   ReadBack
                    ----------- ---- ----- ----- ---- ------ ------ ---- ------              ----- ----- ---------
                    eeprom        65    20     4    0 no       1024    4      0               3600  3600 0xff 0xff
                    flash         65     6   128    0 yes     32768  128    256               4500  4500 0xff 0xff
                    lfuse          0     0     0    0 no          1    0      0               4500  4500 0x00 0x00
                    hfuse          0     0     0    0 no          1    0      0               4500  4500 0x00 0x00
                    efuse          0     0     0    0 no          1    0      0               4500  4500 0x00 0x00
                    lock           0     0     0    0 no          1    0      0               4500  4500 0x00 0x00
                    calibration    0     0     0    0 no          1    0      0                  0     0 0x00 0x00
                    signature      0     0     0    0 no          3    0      0                  0     0 0x00 0x00

                  Programmer Type : Arduino
                  Description     : Arduino
                  Hardware Version: 3
                  Firmware Version: 4.4
                  Vtarget         : 0.3 V
                  Varef           : 0.3 V
                  Oscillator      : 28.800 kHz
                  SCK period      : 3.3 us

avrdude-original: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.01s

avrdude-original: Device signature = 0x1e950f
avrdude-original: safemode: lfuse reads as 0
avrdude-original: safemode: hfuse reads as 0
avrdude-original: safemode: efuse reads as 0

avrdude-original: safemode: lfuse reads as 0
avrdude-original: safemode: hfuse reads as 0
avrdude-original: safemode: efuse reads as 0
avrdude-original: safemode: Fuses OK
</pre><p>All comments gratefully received.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33442"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM12Pi damaged by thunderstorm???</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 19/08/2015 - 11:37.</div>
    <div class="content">
     <p>Well that good new about the rfm2pi, but not so hot about the emonTx&#39;s&nbsp;:-(</p>
<p>Again I wouldn&#39;t assume they are beyond repair just yet, in fact if you have no led activity you should start by checking the AC adapters, I think they are less likely to survive a &gt;300vac&nbsp;supply than the emonTx.&nbsp;</p>
<p>Try powering the emonTx&#39;s from a different supply/method eg 5vdc,&nbsp;Do you have a USB programmer ? if so do you see any serial activity when hooked up to a PC?&nbsp;</p>
<p>It may be a software issue so reloading the sketches may help, or it maybe a problem with the rectifier/reg circuit only used when powering from AC/AC, if it is then it just power via 5vdc&nbsp;as you intended.</p>
<p>Upgrading to emonhub is different to emoncms, the timestore factor won&#39;t effect emonhub (or vice versa) you will need to convert the timestore data to continue logging to that feed with the latest emoncms versions.</p>
<p>Paul&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33448"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM12Pi damaged by thunderstorm???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 19/08/2015 - 12:43.</div>
    <div class="content">
     <p>I second Paul&#39;s &quot;Try them on a programmer&quot;.</p>
<p>I blew the rectifier diode in my emonTx V3.4 while testing the supply, and that was nowhere near 300 V. I&#39;ve got a wire-ended one in place of the SMT now.</p>
<p><img alt="" src="../sites/default/files/Diode.jpg" style="width: 700px; height: 518px;" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33452"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5733.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andrew Wedmore&#039;s picture" title="Andrew Wedmore&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM12Pi damaged by thunderstorm???</h3>

    <div class="submitted">Submitted by <a href="../user/5733.html" title="View user profile.">Andrew Wedmore</a> on Wed, 19/08/2015 - 14:16.</div>
    <div class="content">
     <p>Your comment was spot on.&nbsp; It is the 9V AC transformers that have blown.&nbsp; I have switched to USB power supply and all is well - everything working again - except of course that I don&#39;t have AC voltage measurements.&nbsp; I have also removed the JP2 power supply jumpers.&nbsp; All I need now is to replace one of the AC transformers and I can be measuring voltage again.</p>
<p>Thanks for all the help.&nbsp; I must try and learn not to jump to conclusions too quickly.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11124"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-Z9zyTOtAGYme0vLexlV4vfkEA5Io_XEKeiI1mGaWzrU" value="form-Z9zyTOtAGYme0vLexlV4vfkEA5Io_XEKeiI1mGaWzrU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/11124 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:30:23 GMT -->
</html>
