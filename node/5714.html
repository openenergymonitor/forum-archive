<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5714 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:26:37 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Diverting surplus PV Power: PLL using emonTx V3 | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Diverting surplus PV Power: PLL using emonTx V3</h3>
        <span class="submitted">Submitted by <a href="../user/6476.html" title="View user profile.">johnemo</a> on Sat, 06/09/2014 - 06:59</span>
        <div class="content"><p>I have attempted to use my emonTx V3 running the Diverting surplus PV Power: PLL sketch. At this point I do not have anything attached to the triac output although I have an SSR that I intend to use. Nor do I have a temperature sensor.</p>
<p>The sketch is written for the V2 so pin assignments need to be changed.</p>
<p>Here is mine:</p>
<p>// Arduino I/O pin usage<br />
	#define VOLTSPIN 0<br />
	#define CT1PIN 1<br />
	#define CT2PIN 2<br />
	#define LEDPIN 6 // was 9<br />
	// #define SYNCPIN 6 // this output will be a 50Hz square wave locked to the 50Hz input<br />
	// #define SAMPPIN 5 // this output goes high each time an ADC conversion starts or completes<br />
	#define RFMSELPIN 10<br />
	#define RFMIRQPIN 2<br />
	#define SDOPIN 12<br />
	#define W1PIN 4 // 1-Wire pin for temperature<br />
	#define TRIACPIN 5 // triac driver pin terminal block next to reset - was 3</p>
<p>Initially I used the pins detailed in the Wiki but the radio link did not work. I looked at a working sketch for the V3 and found that the RFMIRQ and RFMSEL were different to the Wiki and the same as the V2 sketch. I have also commented out references to SYNCPIN and SAMPPIN within the sketch.</p>
<p>After uploading the sketch and using the serial monitor all looked okay with the expected readout. My Raspberry Pi emoncms and emonGLCD both looked good. Then I disconnected my laptop from the emontx and the radio stopped working! Connect it back again and it&#39;s working again.</p>
<p>So I guess that the programmer is holding a pin high or low and as soon as I disconnect.......</p>
<p>Can somebody help me out please?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5512.html" class="topic-previous" title="Go to previous forum topic">‹ 3-phase EmonTX?</a>
              <a href="5734.html" class="topic-next" title="Go to next forum topic">EmonTx v4? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-23598"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 06/09/2014 - 09:30.</div>
    <div class="content">
     <p>Is JP2&nbsp;shorted so the emonTx&nbsp;v3 is able to power from AC adapter ?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23601"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6476.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johnemo&#039;s picture" title="johnemo&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/6476.html" title="View user profile.">johnemo</a> on Sat, 06/09/2014 - 10:03.</div>
    <div class="content">
     <p>Hi Paul, thanks for your input.</p>
<p>Yes, JP2 is shorted. The Tx v3 works fine using the standard sketch powered from the AC adapter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23604"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 06/09/2014 - 14:38.</div>
    <div class="content">
     <p>I&#39;m looking at that for you. I&#39;m not getting past line 448 - SDO is not going high so it sticks there forever waiting.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23614"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6476.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johnemo&#039;s picture" title="johnemo&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/6476.html" title="View user profile.">johnemo</a> on Sat, 06/09/2014 - 23:39.</div>
    <div class="content">
     <p>Thanks Robert, I appreciate it.</p>
<p>I am surprised that this has not come up before. Is there nobody out there who has tried the emonTx V3 with that sketch?</p>
<p>John.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23615"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/09/2014 - 00:39.</div>
    <div class="content">
     <p>There seems to have been little interest in MartinR&#39;s sketch - even before the V3. I don&#39;t understand why. My best guess is people don&#39;t understand it and are frightened by the low-level commands used for setting up the radio and temperature measurement etc.</p>
<p>Unfortunately, Ciseco don&#39;t appear to have gone into any great detail about the interconnections between the processor and the RFM12B, apart from saying D8 is needed to turn on the wireless (which appears not to help).</p>
<p>BTW, RFMIRQPIN appears to be unused.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23617"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6476.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johnemo&#039;s picture" title="johnemo&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/6476.html" title="View user profile.">johnemo</a> on Sun, 07/09/2014 - 01:06.</div>
    <div class="content">
     <p>Thanks for your insight.</p>
<p>The theory of the sketch from a superficial point of view to me looks very elegant, I hasten to add that my actual understanding of it is pretty poor, however, from a practical point of view I thought the implementation looked straightforward.</p>
<p>My lack of knowledge is betrayed by the fact that, apart from the pin reassignments, I just expected it to work on the V3</p>
<p>re RFMIRQPIN: Oh, right. It has been defined but not incorporated in the sketch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23623"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/09/2014 - 11:13.</div>
    <div class="content">
     <p>It ought to work, and others have reported it working, on the V3. But the situation is slightly confused by the use of the RFu 328, which appears to connect the RFM12B and the ATMega 328 slightly differently to the V2. I&#39;m going to have to read up on the SPI library and take the JeeLib library apart to see exactly what happens in there.</p>
<p>What&#39;s also puzzling me is the problem that I have is totally independent of whether the programmer is connected or not - and that&#39;s not what you report, so I&#39;m wondering whether there are two separate problems. I may have a slightly different RFu328? One thing you could check: can you comment out all serial output and see what happens then when you disconnect the programmer? It just might be that unhandled serial output is blocking the radio.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23647"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6476.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johnemo&#039;s picture" title="johnemo&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/6476.html" title="View user profile.">johnemo</a> on Sun, 07/09/2014 - 23:51.</div>
    <div class="content">
     <p>Thanks for your help.</p>
<p>With all serial.print statements commented out the result remains the same.:-(</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23651"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 08/09/2014 - 13:54.</div>
    <div class="content">
     <p>The <a href="http://www.ciseco.co.uk/downloads/documents/RFu -328 v1.2.pdf">RFu-328 schematic</a> seems to confirm the pin numbers in the&nbsp;<a href="../../../wiki.openenergymonitor.org/index.php/File_EmonTx_V3.2_PortMap.html?title=File:EmonTx_V3.2_PortMap.png">v3 wiki</a> are correct</p>
<blockquote><p>#define RFMSELPIN 4<br />
		#define RFMIRQPIN 3</p>
</blockquote>
<p>Is it possible to retry those settings whilst the serial prints are still commented out and without the programmer attached ?</p>
<p>maybe the serial activity or programmer presence&nbsp;prevented the RF&nbsp;alone from working</p>
<p>The D8&nbsp;instruction is far from clear but as the schematic shows D8&nbsp;at the &quot;3rd 7-way row of pads&quot; which are not physically connected to a RFM12B it may be safe to assume that applies only to the alternative&nbsp;SRF module.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23652"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 08/09/2014 - 14:30.</div>
    <div class="content">
     <p>Paul, nice one, that works for me. I&#39;d PM&#39;d John earlier to say I&#39;d gone down with a cold and had a non-functioning brain, so I haven&#39;t looked at the problem.</p>
<p>But note, RFMIRQPIN although defined is not used in the sketch - in RFu_jeelib/RFu_RF12.cpp I believe it&#39;s called RFM_IRQ&nbsp; and it&#39;s set to 2 but there&#39;s a note saying that it can be hooked anywhere subject to some other changes.</p>
<p>John,<br />
	Does your SSR work with an input that only swings to 3.3 V? And what load does it put on the output? Why I mention that is the dc supply derived from the ac-ac adapter is strictly limited in the current it can supply, and if you need more than 9.3 mA (11.5 mA if you don&#39;t have a temperature sensor) then you need a separate 5 V supply to power the emonTx V3.<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23655"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 08/09/2014 - 15:45.</div>
    <div class="content">
     <p>No worries Robert, sorry to hear your not feeling 100%.</p>
<p>It will be interesting to hear if it works for John also, as his symptoms were slightly different, Do you know if it was just the pin mapping or if the serial prints and/or programmer effect the RF? I don&#39;t have a v3 to try unfortunately.</p>
<p>I&nbsp;really&nbsp;don&#39;t know my way around the&nbsp;RFu_jeelib/RFu_RF12.cpp but thought <a href="https://github.com/openenergymonitor/RFu_jeelib/blob/master/RFu_RF12.cpp#L90">this line</a> set the (unused) IRQ pin to 3, &nbsp;no ?</p>
<p>A note for anyone else adopting this adaptation, the&nbsp;TRIACPIN is originally digitalpin 3 and that pin needs to be freed up for RFMIRQPIN, John has disabled&nbsp;SAMPPIN and reassigned TRIACPIN as digitalpin 5.</p>
<p>Just out of interest do you think this sketch could be stretched utilize&nbsp;all 4 of the v3&#39;s&nbsp;ct&#39;s ?&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23656"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 08/09/2014 - 16:15.</div>
    <div class="content">
     <p>I&#39;ll only answer the bits my brain is up to!</p>
<p><em>&quot;but thought this line set the (unused) IRQ pin to 3,&nbsp; no ?</em>&quot; - YES, I told you my brain wasn&#39;t working. :-( . . .&nbsp; [that&#39;s my runny nose]</p>
<p>Wouldn&#39;t you use D2 for the triac and leave D5 for the temperature, should you want it? Unless you want D2 for the pulse input (though I can&#39;t say it&#39;s a lot of use other than as a cross-check / proof that it&#39;s working properly, unless you&#39;re trying to synchronise this with the meter&#39;s energy levels).</p>
<p>Dan Woodie did 3 CT&#39;s @ 60 Hz: <a href="2679.html" title="http://openenergymonitor.org/emon/node/2679">http://openenergymonitor.org/emon/node/2679</a> with a reduced sample rate, so it may well do it, otherwise dropping the number of samples a bit (that&#39;s where SAMPPIN &amp; SYNCPIN come in) should do the trick.</p>
<p>I am a bit concerned that John is apparently seeing a quite different cause, which I can&#39;t explain other than the serial output was blocking the radio, but even that is back-to-front and it doesn&#39;t appear to be the case anyway. Mine is now sending RF with or without the programmer connected - but before the change to RFMSELPIN it didn&#39;t work at all, programmer or no programmer. We&#39;ll see what he says.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23663"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 08/09/2014 - 23:11.</div>
    <div class="content">
     <p>Yes, you&#39;re right using digitalpin 2 for TRIACPIN&nbsp;would be much better, as changing W1PIN from D4 to D5&nbsp;would then retain the temp sensing . I guess&nbsp;A5 will still need to be assigned because of R24 so the sketch would need a small mod to provide a &quot;PWRPIN&quot;</p>
<p>SAMPPIN &amp; SYNCPIN&nbsp;could be assigned digital pins 9 &amp; 10, it looks like both are available for assignment and although not available at the connectors they are available at the test points marked as &quot;Dig 9&quot; &amp; &quot;Dig 10&quot;<a href="../../../wiki.openenergymonitor.org/index.php/File_EmonTxV3-io.html?title=File:EmonTxV3-io.png"> (next to the reset button &amp; below the ISP conn).</a></p>
<p>So a pinout&nbsp;could look like...</p>
<table border="1" cellpadding="1" cellspacing="1" style="width: 400px;">
<tbody>
<tr>
<td class="rtecenter">
				<strong>Analogue pin assignments</strong></td>
<td class="rtecenter">
				<strong>EmonTx v2</strong></td>
<td class="rtecenter">
				<strong>EmonTx v3</strong></td>
</tr>
<tr>
<td>
				VOLTSPIN</td>
<td class="rtecenter">
				2</td>
<td class="rtecenter">
				0</td>
</tr>
<tr>
<td>
				CT1PIN</td>
<td class="rtecenter">
				3</td>
<td class="rtecenter">
				1</td>
</tr>
<tr>
<td>
				CT2PIN</td>
<td class="rtecenter">
				0</td>
<td class="rtecenter">
				2</td>
</tr>
<tr>
<td>
				CT3PIN (if implemented)</td>
<td class="rtecenter">
				1</td>
<td class="rtecenter">
				3</td>
</tr>
<tr>
<td>
				CT4PIN&nbsp;(if possible)</td>
<td class="rtecenter">
				-</td>
<td class="rtecenter">
				4</td>
</tr>
<tr>
<td>
				PWRPIN&nbsp;(temp sensor power)</td>
<td class="rtecenter">
				-</td>
<td class="rtecenter">
				5</td>
</tr>
<tr>
<td class="rtecenter">
				<strong>Digital pin assignments</strong></td>
<td class="rtecenter">
				&nbsp;</td>
<td class="rtecenter">
				&nbsp;</td>
</tr>
<tr>
<td>
				LEDPIN</td>
<td class="rtecenter">
				9</td>
<td class="rtecenter">
				6</td>
</tr>
<tr>
<td>
				SYNCPIN</td>
<td class="rtecenter">
				6</td>
<td class="rtecenter">
				10</td>
</tr>
<tr>
<td>
				SAMPPIN</td>
<td class="rtecenter">
				5</td>
<td class="rtecenter">
				9</td>
</tr>
<tr>
<td>
				RFMIRQPIN</td>
<td class="rtecenter">
				10</td>
<td class="rtecenter">
				4</td>
</tr>
<tr>
<td>
				SDOPIN</td>
<td class="rtecenter">
				12</td>
<td class="rtecenter">
				12</td>
</tr>
<tr>
<td>
				W1PIN</td>
<td class="rtecenter">
				4</td>
<td class="rtecenter">
				5</td>
</tr>
<tr>
<td>
				TRIACPIN</td>
<td class="rtecenter">
				3</td>
<td class="rtecenter">
				2</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>I suppose&nbsp;it is possible if John has a v1.1&nbsp;RFu&nbsp;then the connected programmer may influence the&nbsp;RFM12B&#39;s&nbsp;nINT/VDI&nbsp;pin via the linked&nbsp;RST&nbsp;line (v1.1 only).</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23664"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6476.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johnemo&#039;s picture" title="johnemo&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/6476.html" title="View user profile.">johnemo</a> on Mon, 08/09/2014 - 23:57.</div>
    <div class="content">
     <p>Many thanks. Living in Australia I am also out of sync with the rest of the known world!</p>
<p>I have amended as per your earlier post Paul. The symptoms have changed insomuch that there is now no radio even with programmer connected to emonTx and pc connected to programmer. (Although LED - pin6 - flashes periodically).</p>
<p>RFMSELPIN 4</p>
<p>RFMIRQPIN 3</p>
<p>&nbsp;</p>
<p>Paul, your latest post the table now shows RFMIRQPIN connects to PIN 4 and no mention of RFMSELPIN.</p>
<p>How do I know if I have a v1.1 RFu?</p>
<p>John.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23665"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 09/09/2014 - 01:20.</div>
    <div class="content">
     <p>Hi John, &nbsp;not sure what happened to the table I did check it more than once (but clearly not very well) It was supposed to read...</p>
<table border="1" cellpadding="1" cellspacing="1" style="width: 400px;">
<tbody>
<tr>
<td class="rtecenter">
<p><strong>Analogue pin assignments</strong></p>
</td>
<td class="rtecenter">
				<strong>EmonTx v2</strong></td>
<td class="rtecenter">
				<strong>EmonTx v3</strong></td>
</tr>
<tr>
<td>
				VOLTSPIN</td>
<td class="rtecenter">
				2</td>
<td class="rtecenter">
				0</td>
</tr>
<tr>
<td>
				CT1PIN</td>
<td class="rtecenter">
				3</td>
<td class="rtecenter">
				1</td>
</tr>
<tr>
<td>
				CT2PIN</td>
<td class="rtecenter">
				0</td>
<td class="rtecenter">
				2</td>
</tr>
<tr>
<td>
				CT3PIN (if implemented)</td>
<td class="rtecenter">
				1</td>
<td class="rtecenter">
				3</td>
</tr>
<tr>
<td>
				CT4PIN (if possible)</td>
<td class="rtecenter">
				-</td>
<td class="rtecenter">
				4</td>
</tr>
<tr>
<td>
				PWRPIN (temp sensor power)</td>
<td class="rtecenter">
				-</td>
<td class="rtecenter">
				5</td>
</tr>
<tr>
<td class="rtecenter">
				<strong>Digital pin assignments</strong></td>
<td>
				&nbsp;</td>
<td>
				&nbsp;</td>
</tr>
<tr>
<td>
				LEDPIN</td>
<td class="rtecenter">
				9</td>
<td class="rtecenter">
				6</td>
</tr>
<tr>
<td>
				SYNCPIN</td>
<td class="rtecenter">
				6</td>
<td class="rtecenter">
				10</td>
</tr>
<tr>
<td>
				SAMPPIN</td>
<td class="rtecenter">
				5</td>
<td class="rtecenter">
				9</td>
</tr>
<tr>
<td>
				RFMSELPIN</td>
<td class="rtecenter">
				10</td>
<td class="rtecenter">
				4</td>
</tr>
<tr>
<td>
				RFMIRQPIN</td>
<td class="rtecenter">
				2</td>
<td class="rtecenter">
				3</td>
</tr>
<tr>
<td>
				SDOPIN</td>
<td class="rtecenter">
				12</td>
<td class="rtecenter">
				12</td>
</tr>
<tr>
<td>
				W1PIN</td>
<td class="rtecenter">
				4</td>
<td class="rtecenter">
				5</td>
</tr>
<tr>
<td>
				TRIACPIN</td>
<td class="rtecenter">
				3</td>
<td class="rtecenter">
				2</td>
</tr>
</tbody>
</table>
<blockquote><p>The symptoms have changed insomuch that there is now no radio even with programmer connected to emonTx and pc connected to programmer.&nbsp;(Although LED - pin6 - flashes periodically).</p>
</blockquote>
<p>Did you try unplugging the programmer as well? the LED flasking&nbsp;suggests the sketch is running and therefore probably&nbsp;executing&nbsp;the &quot;send&quot; code but the rfm12b is not actioning it. Possibly due to the programmers presence.</p>
<p>I don&#39;t think you will be able to determine the version without sliding the pcb&nbsp;out to see the number on the&nbsp;RFu-328, see in the top RH corner &nbsp;<a href="http://openmicros.org/index.php/articles/88-ciseco-product-documentation/268">here</a>&nbsp;and bottom left corner <a href="../../../wiki.openenergymonitor.org/images/EmonTxV3-io.png">here</a>. If you bought it recently it&#39;s unlikely to be a v1.1.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23666"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6476.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="johnemo&#039;s picture" title="johnemo&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/6476.html" title="View user profile.">johnemo</a> on Tue, 09/09/2014 - 03:13.</div>
    <div class="content">
     <p>SOLVED!</p>
<p>Thanks for that table - it focused the mind.</p>
<p>Original problem was that I had RFMSELPIN as 10 - it did still not work when changed correctly to 4 but what I omitted to change was the pin assignment for W1PIN!</p>
<p>Paul and Robert thanks for all your help.</p>
<p><strong>The table should be offered as a standard to help avoid similar cross wires in the future.</strong></p>
<p>John</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23671"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 09/09/2014 - 11:39.</div>
    <div class="content">
     <p><strike>I&#39;ve got a better idea - I&#39;ll add the table and modified sketch to MartinR&#39;s PLL Diverter article.</strike></p>
<p>I&#39;ve added the table to MartinR&#39;s Diverter article.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23696"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 10/09/2014 - 09:55.</div>
    <div class="content">
     <p>Would it be worth also including a link back here or a brief explanation&nbsp;of &quot;PWRPIN (temp sensor power)&quot; since it&#39;s not mentioned anywhere in the original sketches?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23702"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Diverting surplus PV Power: PLL using emonTx V3</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 10/09/2014 - 12:50.</div>
    <div class="content">
     <p>Doh!&nbsp; I told you my brain wasn&#39;t working. It&#39;s a good point, that of course didn&#39;t exist on the V2. (Also, MartinR said his original - not published - design used temperature to switch diversion, so he didn&#39;t use the tank thermostat, hence the &#39;diverted energy&#39; really meant that, not &quot;energy available for diversion&quot; which is what it means if the tank &#39;stat turns diversion off.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5714"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-cTY4_GSuzgCcxY1SLFFb2ki-R2MPwj6RSMfOemGQLmk" value="form-cTY4_GSuzgCcxY1SLFFb2ki-R2MPwj6RSMfOemGQLmk"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
