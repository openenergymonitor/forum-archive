<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/895 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:57:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>using PIC microcontroller for energy monitor | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">using PIC microcontroller for energy monitor</h3>
        <span class="submitted">Submitted by Guest on Sat, 28/07/2012 - 04:05</span>
        <div class="content"><p>Hi,</p>
<p>is it the circuit <a href="https://learn.openenergymonitor.org/?redirect=how-to-build-an-arduino-energy-monitor" title="http://openenergymonitor.org/emon/buildingblocks/how-to-build-an-arduino-energy-monitor">http://openenergymonitor.org/emon/buildingblocks/how-to-build-an-arduino...</a></p>
<p>can use with PIC microcontroller instead of using arduoino.</p>
<p>it is because i want to built energy monitor using PIC as it is one of the condiotion of my project.</p>
<p>hope you guys out there can help me.</p>
<p>thank a lot.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2200.html" class="topic-previous" title="Go to previous forum topic">‹ Emoncms host computers </a>
              <a href="2189.html" class="topic-next" title="Go to next forum topic">&quot;EmonLib.h&quot; - reading SCT on mega 2560 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-5435"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: using PIC microcontroller for energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 28/07/2012 - 13:32.</div>
    <div class="content">
     <p>The Arduino and the PIC are generally similar and both use a 5 V input, but that is all. The connections - pin numbers - are different. None of the software for the Arduino will work on a PIC without a lot of changes.</p>
<p>But you could use the general ideas that you find in the programs (sketches) for the emonTx. In just a few minutes, I found much information about the PIC analogue inputs. I think that is your starting point. When you can read two analogue inputs, you can then use the algorithm in the emonTx sketches to calculate the voltage, current and power.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5539"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="kllsamui&#039;s picture" title="kllsamui&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: using PIC microcontroller for energy monitor</h3>

    <div class="submitted">Submitted by kllsamui (not verified) on Wed, 08/08/2012 - 02:25.</div>
    <div class="content">
     <p>i will test the EMON on PIC soon, using the chipKIT MAX32</p>
<p>info about CPU: <a href="http://www.microchip.com/wwwproducts/Devices.aspx?dDocName=en545655" target="_blank">PIC32MX795F512H</a><br />
<strong> - 512K Flash (plus 12K boot Flash)<br />
- 128K RAM<br />
- 80MHz, 1.56 DMIPS/MHz, 32-bit MIPS <br />
- Fast and Accurate 16 channel 10-bit ADC, Max 1 Mega sample per second<br />
</strong></p>
<p>Regarding EMON ARDUINO&nbsp;code, only in readVCC AVR specific code is used,</p>
<p>the arduino code will work.</p>
<p>the speed must be slowed down for EMON batch by a delay ( this PIC about 10 times faster ),</p>
<p>because of RAM and FLASH much more code / options can be loaded, (like SCOPE / FFT / GSM SMS ALARM.. )</p>
<p>As first step pls find my PoorManScope2 in the download area of my BLOG,</p>
<p>same code runs with arduino 1.0.1 and with MPIDE.</p>
<p><img alt="emon arduino" src="../../../lh3.googleusercontent.com/-AWX0g_m3CzE/UAKby0kxErI/AAAAAAAACiU/u4Mog4ROWJU/s553/scan_07.jpg" /></p>
<p>EMON&nbsp;shield , Volt, Amp signal, on arduino uno at 4.3kHz , that is max speed for 2 analog in, for this PIC it is 100kHz.</p>
<p>For one analog in, the limit is 8.3kHz (UNO), 199kHz (PIC).</p>
<p>The PMS2 scope window is a processing application, runs on PC, connected to UNO or MAX32 board. pls test it.</p>
<p>&nbsp;pls check progress <a href="http://kll.byethost7.com/kll_en7/news.php?readmore=34">kll.byethost7.com/kll_en7/news.php</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5615"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="kllsamui&#039;s picture" title="kllsamui&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: using PIC microcontroller for energy monitor</h3>

    <div class="submitted">Submitted by kllsamui (not verified) on Fri, 10/08/2012 - 00:24.</div>
    <div class="content">
     <p>GOOD&nbsp;NEWS, <strong>on PIC</strong>:</p>
<p>with EMON&nbsp;FULL&nbsp;WAVE&nbsp;sketch,</p>
<p>&nbsp;- only readVcc replaced with fix value 3300, ( because its AVR code what can not run on PIC )</p>
<p>&nbsp;- a delaytimer in batch loop of 353usec</p>
<p>&nbsp;and EMON&nbsp;shield virtual ZERO circuit:&nbsp;</p>
<p>&nbsp;- not to 5V, instead to 3V3 shield pin connected&nbsp; ( i installed a 3pin jumper )</p>
<p>BUT&nbsp;SAME&nbsp;TUNING.. like on ARDUINO&nbsp;UNO</p>
<p><strong>get same timing and results</strong> with the chipKIT MAX32 board.</p>
<p><em>using the full 30kHz speed the readings about 7% to small???</em></p>
<p>&nbsp;</p>
<p>pls find attached code to be used in MPIDE&nbsp;(0023) or ARDUINO&nbsp;1.0.1</p>
<p>for chipKIT MAX32 or ARDUINO&nbsp;UNO</p>
<p>and also PoorManScope2 ( CHART&nbsp;recoder sketch only for fast wave form check )</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10887"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="n3glv&#039;s picture" title="n3glv&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: using PIC microcontroller for energy monitor</h3>

    <div class="submitted">Submitted by n3glv (not verified) on Thu, 04/04/2013 - 01:29.</div>
    <div class="content">
     <p>Project to log and display DC wattage use.</p>
<p>I have a DC powered electric assisted bicycle. He runs on approx 24v although the range is more like 29.6 to 22v from charged</p>
<p>to full discharge states. I have a current circuit that sends 0-50A as 0-50mv to a milliavolt meter on my handle bars now.</p>
<p>Max reading is 35A (that is the PWM controller limit).</p>
<p>I&#39;ll soon be adding another feed wire to send raw batt voltage to the same area of the bike.</p>
<p>I have an arduino UNO, and also I pi, but I would very much like to use just the UNO.</p>
<p>What I am looking for is a trip-watt-o-meter (my term). I need to count current@voitage * minutes or seconds and log to NV /</p>
<p>send to some kind of display (I have some 16x2 lcd and other lcd on hand).</p>
<p>Ideally I want to be able to set a starting quantity equal to my fully charged 24v/20ah pack expected reserve. Lets call this wmax</p>
<p>(watts max available) And then count down to zero, based on use. If it could drive two horizontal graphs for real time V and I</p>
<p>(ideally going reverse of each other) and have the remaining at the end, or center, that would be fantastic.</p>
<p>So, if I say 0-33mv I can use the onboard 3.3v supply for A/D right? And directly read the current. I should also be able to (with</p>
<p>less resolution) devide the remainder above 22v by something to get 0-3.3v. (or run on external 5v ref, but that would reduce</p>
<p>the accuracy of the wattage calc from the ammeter).</p>
<p>It looks like I can use some of the sketch from emontx, I&#39;m looking for thoughts / input from the group, thanks.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10899"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: using PIC microcontroller for energy monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 04/04/2013 - 13:13.</div>
    <div class="content">
     <p>Hello Jeff,</p>
<p>Firstly, we use mainly the Atmel (Arduino) processor here. There is quite a bit of information in the sketches, but I think little that will be of great help, simply because this site is all about monitoring a.c. power. But there is enough knowledge here to be able to help you, if you can put your own hardware together.</p>
<p>As I understand, you have a current signal of 0 - 50 mV, and a voltage signal of 0 - 30 V (approx). and you want a bargraph display of both these, and you want an estimate of energy remaining in your battery - as numbers and a bargraph?</p>
<p>If you can use the Atmel ATMEGA328P, then the emonGLCD has a LCD screen on which you can draw bargraphs and text, and the processor has analogue inputs that, with some amplification for the current signal and voltage dividers for the battery voltage, will give you your inputs.</p>
<p>So I am thinking that you take the emonGLCD circuit for the display, and build on to it the analogue inputs (you don&#39;t need the radio input). You can run the processor at 3.3 V but use the 1 V reference for the analogue inputs, which means the current input will require less amplification (20 x ) (without amplification, at best you only get 50 steps in the current measurement - that might be good enough but I don&#39;t really think so). The voltage input is not a problem.</p>
<p>Does that help?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/895"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-_bKKYPRQfBvZJ0W9Mn8BhCsw5hnK6EN-F6RGy7yJ-vA" value="form-_bKKYPRQfBvZJ0W9Mn8BhCsw5hnK6EN-F6RGy7yJ-vA"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
