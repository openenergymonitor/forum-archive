<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10509 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:52:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Mind the metadata gap | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Mind the metadata gap</h3>
        <span class="submitted">Submitted by <a href="../user/7665.html" title="View user profile.">TimSmall</a> on Wed, 22/04/2015 - 19:59</span>
        <div class="content"><p>Hello,</p>
<p>First of all, thanks for putting together OpenEnergyMonitor, great hardware,&nbsp;service and community&nbsp;etc.!</p>
<p>One thing that&#39;s struck me as a newbie, is that there seems to be knowledge in the embedded code about each data collected (e.g. type of data, units, and perhaps things like which physical port), but that this all gets discarded by the layers between it and the EmonCMS, and then has to be recreated - which is laborious and error-prone (not to say difficult / intimidating when setting things up for the first time!).</p>
<p>Some possible ways to fix this:</p>
<p>1. Output metadata along with the data every time e.g. have the embedded code output JSON directly.</p>
<p>+ Simple</p>
<p>- Possibly wasteful of batteries and bandwidth for radio devices</p>
<p>2. Output metadata one-off or&nbsp;periodically (e.g. on establishment of communications, or every 10 minutes etc.)</p>
<p>+ Common datatypes could nicknamed to save bandwidth, and embedded code size, or just a hash of the full metadata description string&nbsp;transmitted etc. &nbsp;e.g. code which output.</p>
<p>&nbsp;</p>
<p>-&nbsp;Grows the code a bit (but for the basic case e.g. output the metadata once on establishement of comms - hardly any).</p>
<p>&nbsp;</p>
<p>I&#39;ve done a quick proof of concept using the EmonShield 3 phase power code, by getting it to output json over serial, and modifying emonhub to pass that onto EmonCMS - it&#39;s a bit rough and could be improved, but it works.</p>
<p>To extend this, I was wondering about using the ATmega&#39;s EEPROM to store stuff such as a serial number, node name (e.g. &quot;basement4&quot;), and passing this up too.</p>
<p>Calibration values could also be stored in the EEPROM&nbsp;- so that these aren&#39;t hard coded, and could be updated without touching the code, and also set at production time etc.</p>
<p>Such changes wouldn&#39;t be mandatory (e.g. for cases where code size / bandwidth / battery etc. efficiency is essential), but relatively simple changes to the emonhub could accomodate&nbsp;it automatically recognizing and handling a &quot;new style&quot; output format - thus removing a lot of daunting (for the beginner)&nbsp;manual setup work.</p>
<p>&nbsp;</p>
<p>Any thoughts?</p>
<p>Tim.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10493.html" class="topic-previous" title="Go to previous forum topic">‹ Calibration of Vrms on emontx v2.2 - question on coefficient</a>
              <a href="4358.html" class="topic-next" title="Go to next forum topic">EmonCMS update &amp; check error ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-29889"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Mind the metadata gap</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 22/04/2015 - 20:45.</div>
    <div class="content">
     <p>This is very much related to the current development discussions for the link between emonhub and emoncms. emonhub&nbsp;is basically holding the device data on a per node or value basis eg name, unit, scale, datatype etc and this data is going to be made available to both&nbsp;emoncms&nbsp;and a custom sketch uploader.</p>
<p>I would be very interested to hear how your trials go, especially with the use of the eeprom for calibration data. the calibration data could also be held with the planned firmware version and hardware reference (device type) and could also be updated/maintained by emonhub&nbsp;via the serial or rfm network so that calibration edits can be done editing the values in the emonhub.conf&nbsp;via an emoncms&nbsp;page (which is currently the plan for the other settings) and emonhub would pick up the changes and upload them to the device.</p>
<p>Perhaps down the line a emoncms module that allowed to enter a manual meter reading could suggest (or implement?) a new calibration figure based on a data comparison?&nbsp;could be a winner !!</p>
<p>I&#39;m not sure the units, names etc need to be held on the eeprom&nbsp;if they are in emonhub.conf as the sketch and device do not use them directly and they cannot be included in the standard transmissions but potentially even node ids could be set in the eeprom&nbsp;too which moves towards removing the need to edit the sketch at all.</p>
<p>Trystan&nbsp;is working on a &quot;local-only&quot; version where emoncms reads emonhub.conf directly and I am currently looking at an alternative way where emonhub will keep emoncms informed of any changes to the conf so that a remote&nbsp;emoncms can be used with 1 or more emonhubs.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10509"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-rwRn1FoQJg2mTIbLcZPmoOzUY8c0UJQO3w47G-zJNXY" value="form-rwRn1FoQJg2mTIbLcZPmoOzUY8c0UJQO3w47G-zJNXY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
