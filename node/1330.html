<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>SM5100B-D GSM modem with OpenKontrol Gateway â€“ an alternative emonbase? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
          <span class="submitted"></span>
      <div class="taxonomy"></div>
      <div class="content"><p>I&rsquo;ve been running trials using the Ethernet for uploading energy data to emoncms.</p>
<p>Works fine, and I tested that it works with the OpenKontrol Gateway as well.</p>
<p>However, some people still don&rsquo;t have reliable broadband, and others won&rsquo;t want you using their upload capacity to get energy data online.</p>
<p>So, it was time to try to get a GPRS option working. This summary is going to tell you what I&rsquo;ve done so far! Any input would be appreciated &ndash; I had hoped to write this up with it working, but I&#39;ll update this as I go. &nbsp;<a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/SM5100BOKG_overview.jpg" /></a></p>
<p>Figure 1. Overview of the OKG with SM5100B. I started with buying the OpenKontrol Gateway from the shop, and bought the following from CoolComponents:</p>
<p>1 x Cellular Shield with SM5100B</p>
<p>1 x Quad Band Cellular Antenna SMA</p>
<p>2 x Stackable Header - 6 Pin</p>
<p>Alternative shields are the SIM900 and the awesome looking cooking-hacks shield.</p>
<p>I used this power supply for the OKG.</p>
<p><a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/OKG_PowerSupply.jpg" /></a></p>
<p>Figure 2. Power Supply for the OKG</p>
<p>I downloaded this terminal program to the laptop from <a href="https://sites.google.com/site/terminalbpp/" title="https://sites.google.com/site/terminalbpp/">https://sites.google.com/site/terminalbpp/</a> so that I could see 2-way comms with the SM5100B.</p>
<p><a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/SM5100B_Comms.jpg" /></a></p>
<p>Figure 3. Terminal showing successful registration on network.</p>
<p>The following drawing isn&rsquo;t far off what I was trying to do&hellip;. <a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/Wireless-EFCom-18.jpg" /></a></p>
<p>Figure 4. Useful schematic to illustrate one approach using a SIM900 module from <a href="http://www.elecfreaks.com/wiki/index.php?title=File:Wireless-EFCom-18.jpg" title="http://www.elecfreaks.com/wiki/index.php?title=File:Wireless-EFCom-18.jpg">http://www.elecfreaks.com/wiki/index.php?title=File:Wireless-EFCom-18.jpg</a></p>
<p>I setup a separate power supply for the SM5100B as recommended in Ref 1. <a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/SM5100B_PowerSupply.jpg" /></a></p>
<p>Figure 5. Power Supply for the SM5100B-D (needs to be at least 2A!)</p>
<p>I also use a tiewrap to secure the antenna connection. There isn&rsquo;t any cable support to prevent mechanical strain on the soldered connections, and I knew it would get a lot of movement on the desk. <a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/SM5100B_connections.jpg" /></a></p>
<p>Figure 6. Tiewrap to secure RF connection.</p>
<p>The reset and GND lines from the OKG and the SM5100B were connected, as well as the appropriate UART port; I used the SS/MISO pins on the expansion port of the OKG(pins 10,11 on the Atmega328). I&rsquo;ve including a few photo&rsquo;s showing the setup in more detail. Note that I&rsquo;m using a M2M[ Machine SIM] with no pin. Make sure you disable the pin requirement before you test with your own SIM card.</p>
<p><a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/SM5100B_connections_2.jpg" /></a> <a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/SM5100B_connections_3-1.jpg" /></a> <a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/SM5100B_connections_4.jpg" /></a> <a href="http://s609.beta.photobucket.com/user/Scoileanna/library/SM5100B%20Writeup" target="_blank"><img alt="Photobucket" border="0" src="http://i609.photobucket.com/albums/tt176/Scoileanna/SM5100B%20Writeup/OKG_connections-1.jpg" /></a></p>
<p>Figure 7-10. Closer views of connections.</p>
<p>I used the sample sketch (Ref 8) at <a href="http://dlnmh9ip6v2uc.cloudfront.net/datasheets/Cellular/Cellular_Shield_Passthrough_b.zip" title="http://dlnmh9ip6v2uc.cloudfront.net/datasheets/Cellular/Cellular_Shield_Passthrough_b.zip">http://dlnmh9ip6v2uc.cloudfront.net/datasheets/Cellular/Cellular_Shield_...</a> and simply added my SoftwareSerial port like this, in the sketch &hellip;..&rsquo;SoftwareSerial cell(10,11);&rsquo; since the ATmega328 only has one hardware serial.</p>
<p>I&rsquo;ve read that since you are limited to 9600 baud using the SoftwareSerial port, data loss might be a problem. 115200 baud is recommended to keep up with the SM5100B. Might need to use a 128 which has 2 hardware ports&hellip;.but I should be able to connect before I need to go swopping it out. I was able to register on the GSM network and receive calls. However, when I try to send data to emoncms, the socket closes and the connection is lost. I do get an ack back in the +SOCKSTATUS: confirming the data has been received though.</p>
<p>The following is a set of test results with the SM5100B.</p>
<p>1: Validate Registration on O2 network</p>
<p>AT+CGATT? AT+CGATT=1 (GPRS Attached) AT+CGDCONT=1,&quot;IP&quot;,&quot;Internet&quot;,&quot;&quot;,0,0(Setup PDP context for your network)</p>
<p>AT+CGPCO=0,&quot;&quot;,&quot;&quot;,1 (Configure parameters, in my case username and password isn&rsquo;t needed)</p>
<p>AT+CGACT=1,1( Activate the PDP context)</p>
<p>AT+SDATACONF=1,&quot;TCP&quot;,&quot;213.138.101.177&quot;,80 (Configure a remote host before we open a TCP or UDP connection) AT+SDATASTART=1,1 (Start Connecting)</p>
<p>AT+SSTRSEND=1,http://emoncms.org/api/post?apikey=MYAPIKEY&amp;json={power:274}</p>
<p>AT+SDATASTATUS=1(Query the socket status)&nbsp;</p>
<p>+SOCKSTATUS: 1,1,0102,173,173,0(Means we&rsquo;ve sent 173 characters and have receive ack&rsquo;s for 173 from the remote host) RESULT: OK at terminal &ndash; no update on emoncms.org I&rsquo;ll update this as I continue&hellip;...</p>
<p><strong>Update(19th&nbsp;Nov 2012):&nbsp;</strong></p>
<p>When I useusing the sockettest&nbsp;[Ref 12 ] tool to just test out whfor this[ Client tab]. The IP address is pointing me to&nbsp;http://vis.openenergymonitor.org/ for some reason....</p>
<p>S: http://emoncms.org/api/post?apikey=MYAPIKEY&amp;json={power:274}</p>
<p>&nbsp;&lt;SNIP&gt;</p>
<p>&nbsp; &nbsp; &nbsp; &lt;p&gt;Hello! This is the old entry point for the hosted openenergymonitor emoncms. The new entry point is emoncms.org, if &nbsp; &nbsp; &nbsp; you have an account on vis.openenergymonitor.org all your data can be accessed via emoncms.org just log in as usual.&lt;/p&gt;</p>
<p>&nbsp; &nbsp; &lt;h2&gt;&lt;a href=&quot;http://emoncms.org&quot; &gt;emoncms.org&lt;/a&gt;&lt;/h2&gt;<br />
	&nbsp; &nbsp; &lt;p&gt;&lt;a href=&quot;http://vis.openenergymonitor.org/emoncms3/&quot; &gt;Old Emoncms Login&lt;/a&gt;&lt;/p&gt;<br />
	&nbsp; &nbsp; &lt;p&gt;If you have any questions feel free to drop me an email: &lt;b&gt;trystanlea@openenergymonitor.org&lt;/b&gt;&lt;/p&gt;<br />
	&nbsp; &nbsp; &lt;/div&gt;</p>
<p>&nbsp;&lt;SNIP&gt;</p>
<p>____________________________________________________________________________________________</p>
<p>By Eamonn O&#39;Brien (<a href="http://openenergymonitor.org/emon/user/349">EnergyRnR</a>).</p>
<p>__________________________________________________________________</p>
<p>References</p>
<p>1. Tutorial in 2 parts, but doesn&rsquo;t yet deal with GPRS data <a href="http://tronixstuff.wordpress.com/2011/01/19/tutorial-arduino-and-gsm-cellular-part-one/" title="http://tronixstuff.wordpress.com/2011/01/19/tutorial-arduino-and-gsm-cellular-part-one/">http://tronixstuff.wordpress.com/2011/01/19/tutorial-arduino-and-gsm-cel...</a></p>
<p>2. Excellent application. <a href="http://www.imamuseum.org/blog/2012/06/26/tracking-the-island-resident-with-an-arduino/" title="http://www.imamuseum.org/blog/2012/06/26/tracking-the-island-resident-with-an-arduino/">http://www.imamuseum.org/blog/2012/06/26/tracking-the-island-resident-wi...</a></p>
<p>3. Useful TCP/IP AT command ref <a href="http://www.sparkfun.com/datasheets/CellularShield/SM5100B%20TCPIP%20App%20Note.pdf" title="http://www.sparkfun.com/datasheets/CellularShield/SM5100B%20TCPIP%20App%20Note.pdf">http://www.sparkfun.com/datasheets/CellularShield/SM5100B%20TCPIP%20App%...</a></p>
<p>4. Example code (from someone who&rsquo;s got it working with an UNO) <a href="http://rexids.blogspot.ie/2012/08/so-ive-been-working-with-arduino-uno.html" title="http://rexids.blogspot.ie/2012/08/so-ive-been-working-with-arduino-uno.html">http://rexids.blogspot.ie/2012/08/so-ive-been-working-with-arduino-uno.html</a></p>
<p>5. COSM example : <a href="http://community.cosm.com/node/623" title="http://community.cosm.com/node/623">http://community.cosm.com/node/623</a></p>
<p>6. Useful checklist before you start : <a href="http://nicegear.co.nz/blog/gprs-with-the-sm5100b-arduino-gsm-shield/" title="http://nicegear.co.nz/blog/gprs-with-the-sm5100b-arduino-gsm-shield/">http://nicegear.co.nz/blog/gprs-with-the-sm5100b-arduino-gsm-shield/</a></p>
<p>7. The sparkfun comments here are useful <a href="https://www.sparkfun.com/products/9607" title="https://www.sparkfun.com/products/9607">https://www.sparkfun.com/products/9607</a></p>
<p>8. The documents listed below the product descriptions should be reviewed also <a href="https://www.sparkfun.com/products/9607" title="https://www.sparkfun.com/products/9607">https://www.sparkfun.com/products/9607</a></p>
<p>9. And of course Arduino.cc has some folks who&rsquo;ve had experience with the SM5100B <a href="http://arduino.cc/forum/index.php?topic=71787.0" title="http://arduino.cc/forum/index.php?topic=71787.0">http://arduino.cc/forum/index.php?topic=71787.0</a></p>
<p>10. Similar project using the SIM900 module <a href="http://www.elecfreaks.com/wiki/index.php?title=File:Wireless-EFCom-18.jpg" title="http://www.elecfreaks.com/wiki/index.php?title=File:Wireless-EFCom-18.jpg">http://www.elecfreaks.com/wiki/index.php?title=File:Wireless-EFCom-18.jpg</a></p>
<p>11. Excellent Application <a href="http://labs.vectorform.com/2011/10/remote-temperature-monitoring-with-the-arduino-sm5100b/" title="http://labs.vectorform.com/2011/10/remote-temperature-monitoring-with-the-arduino-sm5100b/">http://labs.vectorform.com/2011/10/remote-temperature-monitoring-with-th...</a></p>
<p>12. Useful UDP/socket tool;&nbsp;<a href="http://sockettest.sourceforge.net/">http://sockettest.sourceforge.net/</a></p>
<p>13. Good summary of the different GPRS options from makezine.com.&nbsp;<a href="http://books.google.ie/books?id=14HZK0Pi-mEC&amp;pg=PA395&amp;dq=telit+gm862+SM5100b+compared&amp;hl=en&amp;sa=X&amp;ei=elurULC2HtGV0QWZi4HgAQ&amp;ved=0CCwQ6AEwAA#v=onepage&amp;q&amp;f=true">http://books.google.ie/books?id=14HZK0Pi-mEC&amp;pg=PA395&amp;dq=telit+gm862+SM5100b+compared&amp;hl=en&amp;sa=X&amp;ei=elurULC2HtGV0QWZi4HgAQ&amp;ved=0CCwQ6AEwAA#v=onepage&amp;q&amp;f=true</a></p>
<p>14. Another possibility;&nbsp;<a href="http://store.open-electronics.org/?_route_=/Arduino/Shield/GSM_GPRS_GPS_SHIELD">http://store.open-electronics.org/?_route_=/Arduino/Shield/GSM_GPRS_GPS_SHIELD</a></p>
</div>
    
    
      </div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
