<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Gas meter monitoring with Hall effect sensor | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/6">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Gas meter monitoring with Hall effect sensor</h3>
        <span class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Sun, 23/12/2012 - 22:46</span>
        <div class="content"><p>Hi all.</p>
<p>	I&#39;d like to monitor a gas meter with an emonTX. The gas meter has a rotating ring with a magnet as described <a href="http://openenergymonitor.org/emon/buildingblocks/gas-meter-monitoring">here</a>. See <a href="http://openenergymonitor.org/emon/node/1704">this thread</a> for the pictures of the meter.</p>
<p>	There seems to be two kinds of device to detect the magnet : the hall effect sensor and the reed switch. The reed switch has a bouncing issue the hall effect sensor does not. See <a href="http://www.kjmagnetics.com/blog.asp?p=reed-switches-and-hall-effect-sensors">this page</a>,or <a href="http://sensors-and-transducers.blogspot.fr/2012/01/reed-switchmagnet-and-hall-effect-units.html">this one</a> for a comparison. There&#39;s a <a href="http://openenergymonitor.org/emon/node/1585">thread</a> here discussing the bouncing issue and how to deal with it. Anyway, the page on gas meter monitoring suggests a hall effect sensor, which suits me.</p>
<p>	I understand that all I need to do is get myself a <a href="http://uk.rs-online.com/web/p/hall-effect-sensor-ics/7512862/">sensor</a> then, through a <a href="https://www.sparkfun.com/products/717">breakout board</a>, solder it to a jack cable as indicated in the <a href="http://openenergymonitor.org/emon/emontx/reference">design reference</a>. What about resistor R8 ? Should it be used or not ? <a href="http://openenergymonitor.org/emon/modules/emontx/features">It needs to be removed when using TSL257 optical sensor</a>, but I didn&#39;t understand why.</p>
<p>	I don&#39;t have the emonTX yet. I wanted to anticipate any hardware adaptation need before ordering the kit and doing the soldering. In fact, I expected more difficulties, but after all, as long as the sensor delivers a raising or falling edge to the IRQ pin, it shouldn&#39;t be different that the LED flashing counting.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/10186" class="topic-previous" title="Go to previous forum topic">‹ Feed Deleting Bug &amp; REDIS Integration</a>
              <a href="/emon/node/10184" class="topic-next" title="Go to next forum topic">Switching to full emoncms (master branch) - Local no longer working? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-8679"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 24/12/2012 - 01:08.</div>
    <div class="content">
     <p>R8: The data sheet says:&nbsp; &quot;Single open drain output.&quot;&nbsp; If you look at the data sheet, you will see that it clearly shows a pull-up resistor to Vdd. If you look at the emonTx circuit diagram, you&#39;ll see R8 is a pull-down resistor, so it is in the wrong place and you must not have it.</p>
<p><img alt="" src="data:image/png;base64,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" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8742"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Sat, 29/12/2012 - 15:03.</div>
    <div class="content">
     <p>Thank you Robert for answering.</p>
<p>Electronics is definitely not my field. I&#39;ve been doing a little bit of reading and I understand the role of the pull-up resistor.</p>
<p>Should I understand that if I use this sensor, I need to add a pull-up resistor somewhere between its output and Vcc (or the center contact of SJ1) ?</p>
<p>Or is there a property of the ATMega IRQ input pin that wakes that unneeded ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8746"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sat, 29/12/2012 - 17:21.</div>
    <div class="content">
     <p>I see you need to learn how to read and interpret data sheets ;-)</p>
<p>Correct, you need to remove R8.&nbsp; A pull-up resistor instead is needed - between Vcc and the output pin as you again correctly say. Download the Atmel data sheet and look at Page 314. It states that there is an internal pull-up resistor with a value between 20 k and 50 k Ohms.</p>
<p>Download the RS data sheet and look beneath the diagram. It states &quot;RL is the pull-up resistor, the recommended resistance is 10kOhm ~ 100kOhm.&quot;</p>
<p>So it is quite likely that the internal pull-up is sufficient.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9043"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Fri, 11/01/2013 - 13:32.</div>
    <div class="content">
     <p>Hi Robert, and thank you for your reply. I didn&#39;t have time to look into it, hence the delay.</p>
<p>I did not understand how the port could have both a pull-up (internal) and a pull-down (on our board) resistor. You answer makes it clear : the pull-up is internal but optional and software controlled. I now realize this must be obvious for someone familiar with Arduino...</p>
<p>I found more info on <a href="https://sites.google.com/site/qeewiki/books/avr-guide/external-interrupts-on-the-atmega328">this tutorial</a>, as well as on the <a href="http://arduino.cc/en/Tutorial/DigitalPins">DigitalPins</a> page of the Arduino reference and <a href="http://arduino.cc/forum/index.php?topic=54880">on the Arduino forum</a>.</p>
<blockquote><pre>
attachInterrupt(0, CountPulse, RISING);//turn on interrupt for flow sensor on pin 2
digitalWrite(2, HIGH);&nbsp; //turn on pull up resistor for flow sensor on pin 2</pre></blockquote>
<p>It should be as simple as adding a digitalWrite(2, HIGH) in the setup() of <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_Pulse/emonTx_Pulse.ino">emonTx_Pulse.ino</a>. I would add it before the call to attachInterrupt(), though.</p>
<p>I ordered a kit a few days ago. Once I get it, I&#39;ll try to have the &quot;reference&quot; setup working, that is temperature and CT measuring. Then, I hope to try the gas monitoring.</p>
<p>Cheers.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10760"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Sun, 31/03/2013 - 14:43.</div>
    <div class="content">
     <p>Hi.</p>
<p>I finally went into it.</p>
<p>I ordered a few hall effect sensors. I chose <a href="http://www.farnell.com/datasheets/621735.pdf">SS451A</a>, from Honeywell. I got them from <a href="http://fr.farnell.com/jsp/search/productdetail.jsp?sku=1784738&amp;CMP=i-bf9f-00001000">Farnell</a>&#39;s. Those are omnipolar, as suggested in the doc, open drain and thru-hole, which makes them easier to use : no need for a breakout board.</p>
<p>I describe the connection and the test code on my profile.</p>
<p>The gas meter is an actaris g4 gallus 2000 (<a href="http://www.minolusa.com/pdf/ACTARIS%20--%20Gallus%202000%20Specs.pdf">specs</a>, <a href="http://www.follinflo-controls.com/PDFs/diaphragms/Gallus2000_Install_wiring_diag.pdf">installation guide</a>).</p>
<p>I&#39;ve been testing and unfortunately the rotation of the wheel is not detected.</p>
<p>A common fridge magnet triggers an interrupt, so I know the code works, but I don&#39;t detect anything from the gas meter. I&#39;ve been trying several positions, and for each one I&#39;ve been waiting for a complete round of the least significant digit wheel. Nothing.</p>
<p>Here&#39;s the magnet :</p>
<p><img alt="" src="http://jolimont.fr/openenergymonitor/gas_sensor_ss451a_magnet_small.jpg" style="width: 400px; height: 300px;" /></p>
<p>I tried several positions :</p>
<p><img alt="" src="http://jolimont.fr/openenergymonitor/gas_sensor_ss451a_in_small.jpg" style="width: 400px; height: 300px;" /></p>
<p><img alt="" src="http://jolimont.fr/openenergymonitor/gas_sensor_ss451a_front_small.jpg" style="width: 400px; height: 300px;" /></p>
<p>Even silly ones :</p>
<p><img alt="" src="http://jolimont.fr/openenergymonitor/gas_sensor_ss451a_side_small.jpg" style="width: 400px; height: 300px;" /></p>
<p>The spec seems to indicated the gas meter does have a magnet in the wheel, but it is likely that the sensor is not sensitive enough.</p>
<p>Indeed, the two sensor proposed on <a href="http://openenergymonitor.org/emon/buildingblocks/gas-meter-monitoring">the gas monitoring </a>page can be triggered by lower magnetic fields:</p>
<p>SS451A (mine):</p>
<p><img alt="SS451A" src="http://jolimont.fr/openenergymonitor/magnetic_perf_SS451A.png" style="width: 776px; height: 359px;" /></p>
<p>The two other sensors:</p>
<p><img alt="" src="http://jolimont.fr/openenergymonitor/magnetic_perf_MLX90248ESE.png" style="width: 1015px; height: 343px;" /></p>
<p><img alt="" src="http://jolimont.fr/openenergymonitor/magnetic_perf_AH180N.png" /></p>
<p>Basically, it takes about 100 Gauss for the SS451A to get triggered, and about 40 Gauss for the two others.</p>
<p>Should I try with a more sensitive sensor ? Or am I wrong about the magnet in the meter ?</p>
<p>Anyone has tried any other sensor with success ?</p>
<p>Does the sensor have to be omnipolar ?</p>
<p>I chose the SS451A for practical reasons: it is easier to connect (thru-hole) and it was available. I didn&#39;t find any other thru-hole omnipolar sensor, and I didn&#39;t find any other shop that would sell both one of the two SMT sensors above and a breakout board (I&#39;d rather avoid ordering from two different shops, because ot the shipping costs).</p>
<p>I see people here using reed switches. I understand there are bouncing issues. Or perhaps are they using a hardware with debouncing included. For instance, the&nbsp;<a href="https://www.flukso.net/content/gas-probe">FLS02-F1</a>, as seen <a href="http://openenergymonitor.org/emon/node/2001">here</a>. For the price, I suppose it does debouncing. I don&#39;t mind paying 10&euro; for a sensor, but it would be nice to identify a cheap one the OEM shop could sell as an option to the TX (like the temp sensor).</p>
<p>Could the needed sensitivity vary depending o the gas meter ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10762"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 31/03/2013 - 15:18.</div>
    <div class="content">
     <p>I have an Actaris meter and it does have a magnet in the fastest wheel - N is at 7.5 and S is at 2.5 (tested with a compass).</p>
<p>To try to get an estimate of the field strength, I put the compass in the centre of a rectangular coil measuring approx 35 x 45 mm and with 50 turns, and with approx 1 A flowing, it balanced the magnet in the meter at a distance of approx 15 mm from the window (meaning at &frac34; A, it didn&#39;t reverse the needle and at 1&frac12; A, it did).</p>
<p>I think that&#39;s about 10 mT (100 Gauss) according to <a href="http://www.calctool.org/CALC/phys/electromagnetism/solenoid">here</a>&nbsp; [edit] but according to <a href="http://hyperphysics.phy-astr.gsu.edu/hbase/magnetic/curloo.html#c2">here</a> and treating the coil a single turn carrying 50 A, it is about 1 mT (10 Gauss).</p>
<p>So if my estimates and the first reference is correct, your sensor should work, and if the second, it will not.</p>
<p>[Disclaimer: I was at the top of a stepladder balancing a power supply on the too narrow meter shelf and holding compass and coil in one hand, and twiddling the current limit knob with the other hand. The measurement may thus be a little imprecise.]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10765"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Sun, 31/03/2013 - 16:05.</div>
    <div class="content">
     <p>Hi Robert. Thanks for answering.</p>
<p>Please don&#39;t try to take a picture of your experiment. You (supposedly) only have two arms, and I wouldn&#39;t like you to get hurt.</p>
<p>It took me a few readings but I think I understand what you mean. You&#39;re applying a magnetic field to your compass and you determine the maximum field the meter magnet can defeat.</p>
<p>I can&#39;t comment on the conclusions, but if the meter magnet only develops 1 mT (10 Gauss), then none of the other sensors would work anyway.</p>
<p>Where would you place the sensor ? I tried both on the front (window) and in the hole under the wheels (see pictures).</p>
<p>(I also wonder what that thing on the right of the wheels is. Looking at it I would expect a LED to flash from times to times, but this does not happen.)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10766"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Sun, 31/03/2013 - 16:53.</div>
    <div class="content">
     <p>My meter has the registers in a clear plastic box protruding from the front of the meter case (post above edited to add a picture), and the fastest wheel is accessible from underneath with a cut-away section that comes very close (about the same distance as the main window - 2 mm or so - from the wheel), so that&#39;s where I would put a sensor so as not to obscure the register. But in your case, it needs to be right in front of the wheel. As far as I know, there is no electricity of any sort in my meter, so I don&#39;t expect to see a LED.</p>
<p>If you have an ordinary (walkers) magnetic compass, you could at least tell whether there is a magnet there or not.</p>
<p>The principle of my test was to impose an equal but opposite magnetic field from the coil, so that the compass needle swung freely. That proved impossible in practice, so the best I could do was ramp up the current and note when the needle flipped, then ramp down the current and note when it flipped back. The 15 mm was the radius of the compass case, so the case was touching the window.</p>
<p>I don&#39;t have any experience of working directly with magnetic fields, I haven&#39;t got a feel for the numbers so I&#39;d limit my comment on the conclusions to saying (1) that a more precise measurement is needed, (2) what I&#39;ve done seems to indicate that you probably need the most sensitive detector that won&#39;t latch under the Earth&#39;s magnetic field (said to be about 0.5 Gauss) and any residual magnetism in the meter&#39;s metal case, and (3) something 20 or so times the Earth&#39;s field sounds not unreasonable.</p>
<p>I&#39;m almost certain that the field strength will vary somewhat between examples of the same meter model, and even more between manufacturers.</p>
<p>[Edit]</p>
<p>Reading the data sheet on your sensor, it appears to say it might operate at 35 Gauss, but it requires 135 Gauss to guarantee operation; and it requires the field to fall to 10 Gauss to guarantee it will release.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10773"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1958" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1958.png" alt="fluppie007&#039;s picture" title="fluppie007&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1958" title="View user profile.">fluppie007</a> on Sun, 31/03/2013 - 19:38.</div>
    <div class="content">
     <p>Maybe this one will do? <a href="https://www.flukso.net/content/gas-probe" title="https://www.flukso.net/content/gas-probe">https://www.flukso.net/content/gas-probe</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10877"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Wed, 03/04/2013 - 17:30.</div>
    <div class="content">
     <p>Hi.</p>
<p>Thank you for your answers.</p>
<p>@fluppie007: Yes, I saw this one. As I said at the end of an earlier comment, I&#39;d like to identify a cheap sensor that would work &quot;everywhere&quot;. OEM could even re-sell in the shop. It would make a common setup for everyone, thus facilitating code sharing, and making it easier to obtain (all elements from the same shop).</p>
<p>Yet, I&#39;d like my setup to finally work and it is not expensive. <a href="https://www.flukso.net/content/actaris-g4-gallus-2000-and-fls02-f1">I posted</a> on the forum to know if it would work.</p>
<p>@Robert: It might not be obvious from the pictures, but I have the same kind of hole under the wheel. And I don&#39;t think my meter is powered either.</p>
<p>My compass was at my office, but I checked with a compass application on a friend&#39;s phone, and the meter does move the &quot;needle&quot;, so there definitely is something there. I also checked the water meter for the same conclusion: it has influence on the compass, but does not trigger the hall effect sensor. (This time, I was myself in turn in a precarious position, so I wouldn&#39;t swear it does not work, but I&#39;m pretty sure.)</p>
<p>It is a bit more difficult than I expected, as the sensor needs not only to get triggered by the magnet when this one passes by, but also to get released when the wheel turns. As you pointed out, my sensors may be too lousy in its specs to guarantee correctness.</p>
<p>I should try with one of the two sensors proposed in the documentation page. I liked the one I picked for its availability, and its thru-hole connection. I guess I&#39;ll have to go through the retail websites again, and hope to find one with both the sensor and the breakout board.</p>
<p>I can&#39;t figure out to which extend I&#39;m entering unknown territory, here. Hence this post, to know what people here actually use (and eventually get a pointer to something easily available).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10885"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="electrocoolman&#039;s picture" title="electrocoolman&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by electrocoolman (not verified) on Thu, 04/04/2013 - 00:38.</div>
    <div class="content">
     <p>Hi,</p>
<p>There&#39;s some info about gas meters here &nbsp; &nbsp;http://www.bes.co.uk/products/031.asp</p>
<p>my meter is a standard U6&nbsp;type and I just purchased the pulse module and lead......(yes a rip-off price) but it just fitted straight on to the meter and is secured with the screw supplied.</p>
<p>With regards to pull up resistor, in the Arduino there is an internal pull up that can be activated.....you then switch the input to 0v&nbsp;to make it active. &nbsp;Also it&#39;s easy to debounce&nbsp;the input in software.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Thu, 04/04/2013 - 19:09.</div>
    <div class="content">
     <p>Hi. Thanks for the pointer. (Although I&#39;d rather not sell a kidney for a sensor.)</p>
<p>Yes, I know about the internal pull-up. See Robert&#39;s answers at the beginning of the thread. I documented my code modifications on my profile, until I get something fully working.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10911"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 05/04/2013 - 01:34.</div>
    <div class="content">
     <p>Capitalising on that and this <span class="field-content"><a href="http://openenergymonitor.org/emon/node/2152">Gas Meter Pulse Reading</a></span>, I&#39;ve discovered that <a href="http://spiratronics.com/magnetic-reed-switch-en.html">one of these</a> works with my Actaris meter. It gives two pulses per revolution when positioned below the fastest register wheel, as in the picture.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11153"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3319" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3319.jpg" alt="johny5_uk&#039;s picture" title="johny5_uk&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3319" title="View user profile.">johny5_uk</a> on Fri, 12/04/2013 - 10:25.</div>
    <div class="content">
     <p>Thanks for this info Robert, looks to be a massive saving from the pulse block if all that is required is a reed switch.</p>
<p>Have you managed to connect this up? will it just be a case of connecting the reed switch directly to an emontx?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11157"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Fri, 12/04/2013 - 12:53.</div>
    <div class="content">
     <p>I don&#39;t think it is absolutely plug and play.</p>
<p>The connection should not be difficult. The switch closes when exposed to a magnetic fields. I think you just have to solder it to a two-wire cable such that one end connects to Vcc (tip) and the other end to the interrupt pin (ring).</p>
<p>Conversely, you could connect it to GND (sleeve) and IT pin (ring) and activate the internal pull-up resistor in the code. I don&#39;t know which is best.</p>
<p>Also, reed switches generate bouncing: when changing open/close state, they can open/close a few times quickly, thus generating several interrupts when you would expect one. I hope I&#39;m making myself clear. You can deal with the debouncing in the code with a tempo. You&#39;d find people in this forum who did that already or at least planned to.</p>
<p>Thank you Robert for the hint.</p>
<p>I&#39;m ordering a few Hall effect sensors and Reed switches tomorrow to make some tests. I paid more attention to activation and release magnetic field and I hope to get better results (and give feedback about which work better). The issue for such cheap parts is the shipping cost, so I&#39;m buying several, and I managed to group my command with someone from my hacklab. I hope this time I can get it to work.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11162"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Fri, 12/04/2013 - 13:56.</div>
    <div class="content">
     <p>As <a href="http://openenergymonitor.org/emon/user/1531" title="View user profile.">J&eacute;r&ocirc;me</a> writes, it does need some work. The reed switch needs to be attached to the meter in a way that will not cause the energy supplier to object, and the switch needs wiring to the emonTx. There&#39;s some information about pulse inputs in Building Blocks. I don&#39;t think the internal pull-up will overcome R8, so if you want to use the internal pull-up, leave R8 out. I would keep R8 and wire the switch Tip-Ring, and I would use a twisted pair of wires if the switch is any distance from the emonTx, to minimise any induced voltages. The reed switch will indeed need de-bouncing and this is easy to do in software - but the pulse rate is quite low so a simple R-C filter may be good enough.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11780"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Wed, 01/05/2013 - 18:01.</div>
    <div class="content">
     <p>Hi.</p>
<p>I ordered a few Hall effect sensors and Reed switches. Here are the results I get from my tests.</p>
<p>Basically, although all of them would detect a fridge magnet, none would be triggered by the meter, except for the Standex ORD324-1015 Reed switch.</p>
<h5>
	Hall effect sensors</h5>
<table border="1" cellpadding="1" cellspacing="1">
<tbody>
<tr>
<td>
				<a href="http://fr.farnell.com/jsp/search/productdetail.jsp?sku=1784738">Honeywell SS451</a></td>
<td>
				No</td>
</tr>
<tr>
<td>
				<a href="http://it.mouser.com/Search/ProductDetail.aspx?R=AH180-PL-Bvirtualkey62110000virtualkey621-AH180-PL-B">Diodes Inc. AH180-PL-B</a></td>
<td>
				No</td>
</tr>
<tr>
<td>
				<a href="http://it.mouser.com/Search/ProductDetail.aspx?R=AH180N-ZG-7virtualkey62110000virtualkey621-AH180N-ZG-7">Diodes Inc. AH180N-ZG-7</a></td>
<td>
				No</td>
</tr>
</tbody>
</table>
<h5>
	Reed switches</h5>
<table border="1" cellpadding="1" cellspacing="1">
<tbody>
<tr>
<td>
				<a href="http://it.mouser.com/Search/ProductDetail.aspx?R=ORD324-1015virtualkey99990000virtualkey876-ORD324-1015">Standex ORD324-1015</a></td>
<td>
				Yes</td>
</tr>
<tr>
<td>
				<a href="http://it.mouser.com/Search/ProductDetail.aspx?R=CT10-1540-G4virtualkey52840000virtualkey816-CT10-1540-G4">Coto tech. 15-40 AT SPST</a></td>
<td>
				No</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p>I guess it depends on the meters because <a href="http://openenergymonitor.org/emon/buildingblocks/gas-meter-monitoring">the AH180N is said to work</a> on other meters.</p>
<p>I&#39;m a bit surprised.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11790"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Wed, 01/05/2013 - 23:09.</div>
    <div class="content">
     <p>I&#39;m not too surprised at your results. The Standex reed has a smaller body and the contact rating @ 10 VA is the same as the Spiratronics one that worked for me.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11791"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1531" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1531" title="View user profile.">Jérôme</a> on Wed, 01/05/2013 - 23:12.</div>
    <div class="content">
     <p>I&#39;m surprised about the AH180N not working.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11792"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Thu, 02/05/2013 - 00:04.</div>
    <div class="content">
     <p>The very rough measurements that I did showed the field to be somewhere between 10 G and 100 G. Those Hall effect devices need 50 G or 60 G to operate, the geometric mean of my estimates is 30 G so I think it must be on the edge of operating, and just failing. Is it possible to put another magnet behind the Hall device to bias it? Ideally, it would be about the same strength as the wheel magnet. The wheel presents N &amp; S poles at diametrically opposite points, therefore by adjusting the distance you can trim the auxiliary magnet so that the two fields add when the wheel is in the correct position and when the wheel has turned 180&deg; the two fields exactly cancel. That way you get one pulse per revolution, not two.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27749"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/7583" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dmb&#039;s picture" title="dmb&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/7583" title="View user profile.">dmb</a> on Mon, 16/02/2015 - 17:55.</div>
    <div class="content">
     <p>For anyone interested in gas monitoring, I tried lots of ideas to get data from my meter and having finally succeeded thought I&#39;d post here as this thread gave me some good ideas, so I thought someone else might find this useful :)&nbsp;The meter is some kind of Schlumberger&nbsp;meter, I think it&#39;s an old (1999 ?) version of an Actaris. It has a reflective dot on the zero and using a pocket compass I found a rotating magnet point as indicated by the arrow below:</p>
<p><img alt="" src="http://emoncms.yellowbell.net/images/meter.png" /></p>
<p>I built a little circuit based around a&nbsp;55100 hall effect sensor that I bought here&nbsp;http://spiratronics.com/hall-effect-sensor-en.html, after trekking around lots of sites that wanted more for postage than the parts cost :) The circuit also has an LED that turns on when the magnet comes around, so I can see it&#39;s working (could also use this to drive a pulse block if you wanted to use an EnviR with an optical sensor like a GaSmart or OptiSmart).</p>
<p>The LED comes on when &quot;7&quot; comes up on the right most wheel, as shown in the photo, and turns off at &quot;8&quot;-ish, so one pulse per 0.01m3.</p>
<p>The circuit I used is as shown, I connected it up to a Raspberry Pi Model B Rev 1 that I also&nbsp;use&nbsp;with emonhub&nbsp;to record a bunch of emonTH modules:</p>
<p><img alt="" src="http://emoncms.yellowbell.net/images/gas_sensor.png" /></p>
<p>Finally I ran up some python code using the GPIO library to count revs per 5 minutes and log them to my server (data is stored in a mysql&nbsp;database and forwarded to emoncms on the same server):</p>
<blockquote><p>#!/usr/bin/python<br />
#<br />
# Count gas meter revs per 5 minutes, convert to watts and&nbsp;kWh<br />
#<br />
# 1) Number of units used (n)<br />
# 2) Multiply by volume correction factor (Vc=1.022640)<br />
# &nbsp; &nbsp; &nbsp; The correction factor is used to take account of the temperature<br />
# &nbsp; &nbsp; &nbsp; and atmospheric conditions at a site. It is generally of the order<br />
# &nbsp; &nbsp; &nbsp; of 1.02264, so we have defaulted to this<br />
# 3) Multiply by calorific value (CV=39.3)<br />
# &nbsp; &nbsp; &nbsp; The calorific value (CV) is a measurement of the amount of energy<br />
# &nbsp; &nbsp; &nbsp; contained in the gas. CV is usually quoted in megajoules per cubic metre<br />
# &nbsp; &nbsp; &nbsp; (MJ/m3). Gas delivered to your premises will have a CV of between<br />
# &nbsp; &nbsp; &nbsp; 37.5 MJ/m3 and 43.0 MJ/m3. This is continually measured by Transco<br />
# &nbsp; &nbsp; &nbsp; for each Local Distribution Zone and passed to your gas supplier daily<br />
# 4) Divide by kWh conversion factor (3.6)<br />
#<br />
# 1 m3 gas is approx 10 kWh<br />
#<br />
# E(kWh) = n * Vc * CV / 3.6<br />
# P(W) = (1000 * E(kWh)) / t(hr) = (3600 * 1000 * E(kWh))) / t(s)<br />
# E(kWh) = P(W) * t(hr) / 1000<br />
#</p>
<p># Read more: <a href="http://www.ukpower.co.uk/home_energy/gas_meter_readings#ixzz3RXckREUQ" title="http://www.ukpower.co.uk/home_energy/gas_meter_readings#ixzz3RXckREUQ">http://www.ukpower.co.uk/home_energy/gas_meter_readings#ixzz3RXckREUQ</a><br />
#</p>
<p>import RPi.GPIO as GPIO<br />
import os<br />
from time import sleep<br />
from datetime import datetime</p>
<p>revs=0<br />
interval=300</p>
<p># print a log message<br />
def printMsg(msg):<br />
&nbsp; &nbsp; i = datetime.now()<br />
&nbsp; &nbsp; print i.strftime(&#39;%Y/%m/%d %H:%M:%S&#39;) + &#39; &#39; + msg</p>
<p># triggered when the GPIO pin goes low (meter magnet comes around)<br />
def eventHandler(channel):<br />
&nbsp; &nbsp; global revs</p>
<p>&nbsp; &nbsp; printMsg(&quot;Port &quot; + str(channel) + &quot; is 0/LOW/False - LED ON&quot;)<br />
&nbsp; &nbsp; revs = revs + 1</p>
<p># log the kWh consumed in the last interval<br />
def logConsumption():<br />
&nbsp; &nbsp; units = revs / 100.0 &nbsp; &nbsp; &nbsp; &nbsp;# units consumed in interval, 1 rev = 0.01m3<br />
&nbsp; &nbsp; VC=1.022640 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Volume correction factor<br />
&nbsp; &nbsp; CV=39.3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; # Calorific value</p>
<p>&nbsp; &nbsp; kWh = (units * VC * CV) / 3.6; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# kWh consumed in interval<br />
&nbsp; &nbsp; power = 3600 * 1000 * kWh / interval; &nbsp; &nbsp; &nbsp; # Power (W) consumed in interval</p>
<p>&nbsp; &nbsp; printMsg(&quot;log &quot; + str(kWh) + &quot; kWh&quot;);</p>
<p># &nbsp; &nbsp;do whatever you want with the data</p>
<p>#&nbsp; &nbsp; Note: the following lines failed: if I called an external script, no further interrupts were generated ???????? Instead I wrote the python equivalent of the logging script</p>
<p># &nbsp; &nbsp;cmd = &quot;perl -f /data/bin/loggas.pl GASC &quot; + str(kWh) + &quot; &#39;Gas consumption&#39;&quot;<br />
# &nbsp; &nbsp;os.system(cmd)</p>
<p>def main():<br />
&nbsp; &nbsp; global revs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # revs counted in the current interval</p>
<p>&nbsp; &nbsp; # read input from 55100 on pin 18, GPIO 24<br />
&nbsp; &nbsp; cmdPin = 24</p>
<p>&nbsp; &nbsp; GPIO.setmode(GPIO.BCM)</p>
<p>&nbsp; &nbsp; # Pull the pin up to stop false signals<br />
&nbsp; &nbsp; GPIO.setup(cmdPin, GPIO.IN, pull_up_down=GPIO.PUD_UP)</p>
<p>&nbsp; &nbsp; # now the program will do nothing until the signal on port 24<br />
&nbsp; &nbsp; # starts to fall towards zero. This is why we used the pullup<br />
&nbsp; &nbsp; # to keep the signal high and prevent a false interrupt</p>
<p>&nbsp; &nbsp; GPIO.add_event_detect(cmdPin, GPIO.FALLING)<br />
&nbsp; &nbsp; GPIO.add_event_callback(cmdPin, eventHandler)</p>
<p>&nbsp; &nbsp; try:<br />
&nbsp; &nbsp; &nbsp; &nbsp; while True: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# this will carry on until you hit CTRL+C<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; revs = 0<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sleep(interval)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; printMsg(&quot;Detected &quot; + str(revs) + &quot; revs in the last &quot; + str(interval) + &quot; seconds&quot;)<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; logConsumption()<br />
&nbsp; &nbsp; except KeyboardInterrupt:<br />
&nbsp; &nbsp; &nbsp; &nbsp; GPIO.cleanup() &nbsp; &nbsp; &nbsp; # clean up GPIO on CTRL+C exit</p>
<p>main()</p>
<p>&nbsp;</p>
</blockquote>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27772"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/7696" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Phil_S&#039;s picture" title="Phil_S&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/7696" title="View user profile.">Phil_S</a> on Mon, 16/02/2015 - 14:24.</div>
    <div class="content">
     <p>Hello dbm</p>
<p>Looks just like my set-up. Iguess looking at the moulding&nbsp;on the left-hand side (your arrow), it is actually intended to have some sort of pulse detector fitted as an accessory. I used a&nbsp;AL112UA-T (Allegro unipolar) which works a treat - the position mine is in fires the Hall device between 56 and 75 on the last dial. I used Hall as I had 5-V available permanently, but for a radio link, a reed works just as well (doing the same thing on the water meter). I made up a two enclosure box to screw on using the existing moulded screw hole just to make it look better.</p>
<p>I haven&#39;t looked at your code etc., but I guess you have sorted the problem of when the dial stops for a long time at the Hall firing position. I did a little CMOS&nbsp;Schmitt circuit that does a short 100-mS&nbsp;pulse when it gets the rising(or falling) edge from the Hall (probably old hat to the experienced). For info, I&#39;m using Zigbee for the meshing capability. Taken well over a year to get the pulses back on the PC, but very satisfying, and accurate to date.</p>
<p>All I need now is for BG to come along and change the meter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27784"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/7583" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dmb&#039;s picture" title="dmb&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/7583" title="View user profile.">dmb</a> on Mon, 16/02/2015 - 17:52.</div>
    <div class="content">
     <p>Hi !</p>
<p>Yes, it does look like there should be an &#39;off the shelf&#39; pulse detector, in fact I think having scoured the internet that it&#39;s the one here&nbsp;http://www.thecodestore.co.uk/shop/details/1300/pulse-block-metur-008.html. However&nbsp;when I spoke to these guys they thought this was an optical pulse block, and there&#39;s definitely no light on the meter ! I gave up looking at that point and decided to roll my own :)</p>
<p>The code just sleeps for five minutes at a time, then counts the number of interrupts that came in during that interval as an indicator of how much gas was used. One interrupt is generated on the falling edge from the&nbsp;Hall, so it&#39;s fine if the dial sits on the firing position for ages&nbsp;- no gas usage gets counted until it goes around again and generates a new interrupt. I&#39;m still trying to figure out whether to report in m3, kWh, watts or just revs ! I&#39;d like to convert m3 usage into watts so I can compare gas and electricity usage across the day, but I&#39;m not convinced I have the conversion right yet - seems like 1 rev = 0.01m3 = 1400W which sounds like a lot of watts !!</p>
<p>Great to have some data coming in anyway, next to find out what&#39;s using all that gas ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27804"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3016" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3016" title="View user profile.">dBC</a> on Tue, 17/02/2015 - 01:16.</div>
    <div class="content">
     <p>I think you might be confusing energy and power a bit there. &nbsp;The energy in 1m&sup3; of gas varies a bit, but 37MJ seems to be a common estimate. &nbsp;So in 0.01m&sup3; there&#39;s 0.37MJ, which is 0.103 kWH.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27812"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/7583" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dmb&#039;s picture" title="dmb&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Gas meter monitoring with Hall effect sensor</h3>

    <div class="submitted">Submitted by <a href="/emon/user/7583" title="View user profile.">dmb</a> on Tue, 17/02/2015 - 10:39.</div>
    <div class="content">
     <p>I think you&#39;re right !</p>
<p>1 rev = 0.01m3 = 0.37MJ</p>
<p>P(W) = E(J)/t(s)</p>
<p>so for say 4 revs in 5 minutes that&#39;s (0.04 * 3700000) / 300 = 493W</p>
<p>​Sounds much more like it !</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/1732"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-yBNxDTxL5tpMwLAwn8X3agjeJLEch4RgqSDySjbY1NY" value="form-yBNxDTxL5tpMwLAwn8X3agjeJLEch4RgqSDySjbY1NY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
