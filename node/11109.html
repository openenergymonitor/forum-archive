<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11109 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:56:48 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>New user alert - Owl Intuition PV capture/logging | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">New user alert - Owl Intuition PV capture/logging</h3>
        <span class="submitted">Submitted by <a href="../user/8569.html" title="View user profile.">j20ands10</a> on Wed, 12/08/2015 - 14:09</span>
        <div class="content"><p>I am seeing snippets all over the internet saying it is possible to capture the packets from the OWL hub but no real details of how to set it all up and put it into practice to publish the stats on Emoncms. &nbsp;</p>
<p>Has anyone managed it and willing to share their information?</p>
<p>Thanks</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11072.html" class="topic-previous" title="Go to previous forum topic">‹ JSON time format</a>
              <a href="11195.html" class="topic-next" title="Go to next forum topic">Minor issue in new v9 feeds UI ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-33285"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 12/08/2015 - 16:10.</div>
    <div class="content">
     <p>I have an owl lurking in the back of one of my cupboards somewhere, it was one of the systems I trialed&nbsp;on the route to this project.</p>
<p>I have collected some links of interest with an intention of doing something one&nbsp;day, in no particular order</p>
<p><a href="https://theowl.zendesk.com/hc/en-gb/articles/201284603-Multicast-UDP-API-Information">Multicast &amp; UDP API Information (OWL website)</a></p>
<p><a href="https://github.com/micolous/intuition">micolous/intuition</a> &amp;&nbsp;<a href="https://github.com/micolous/intuition/blob/master/doc/protocol.rst">Protocol notes for Owl Intuition</a>&nbsp;</p>
<p><a href="http://forum.jeelabs.net/node/1038.html">OWL Energy Monitor @ 433Mhz</a></p>
<p><a href="3302.html">​Re: Owl Intuition Multicast not working on emoncms raspberry pi sd image (SOLVED)</a></p>
<p>The &quot;network owl&quot; seems to&nbsp;transmit&nbsp;UDP and multicast&nbsp;packets which is apparently quite easy to capture, the JeeLabs&nbsp;bit is interesting as I also have an Oregon weatherstation&nbsp;in another cupboard gathering dust.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33286"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8569.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="j20ands10&#039;s picture" title="j20ands10&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8569.html" title="View user profile.">j20ands10</a> on Wed, 12/08/2015 - 16:16.</div>
    <div class="content">
     <p>Cheers Paul just in the process of building a clean raspbian&nbsp;SD card hope to run the python script on that if I can get my head around it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33293"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Wed, 12/08/2015 - 20:21.</div>
    <div class="content">
     <p>I used this script (<a href="https://github.com/cornetp/eagle-owl" title="https://github.com/cornetp/eagle-owl">https://github.com/cornetp/eagle-owl</a>) to interface with my Owl CM160 a while back (no longer use it after moving to an EmonTx). I had it set up to monitor the values and publish to openHAB over the REST API which means it should be pretty easy to modify for publishing to EmonCMS in the required format.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33447"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8569.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="j20ands10&#039;s picture" title="j20ands10&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8569.html" title="View user profile.">j20ands10</a> on Wed, 19/08/2015 - 12:39.</div>
    <div class="content">
     <p>spent a few hours looking at the python code last night got to the point now where it will not even compile; I guess this is why people move across to EmonTX etc rather than using 3rd party devices. not giving up but wish I had spotted Open Energy Monitor before buying the owl.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33454"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 19/08/2015 - 15:23.</div>
    <div class="content">
     <p>I just hooked mine up to try (no CT&#39;s etc) and could receive&nbsp;the owl multicast&nbsp;using</p>
<blockquote><p>#!/usr/bin/env python</p>
<p>import socket<br />
import struct</p>
<p>MCAST_GRP = &#39;224.192.32.19&#39;<br />
MCAST_PORT = 22600</p>
<p>sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP)<br />
sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)<br />
sock.bind((&#39;&#39;, MCAST_PORT)) &nbsp;# use MCAST_GRP instead of &#39;&#39; to listen only<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# to MCAST_GRP, not all groups on MCAST_PORT<br />
mreq = struct.pack(&quot;4sl&quot;, socket.inet_aton(MCAST_GRP), socket.INADDR_ANY)</p>
<p>sock.setsockopt(socket.IPPROTO_IP, socket.IP_ADD_MEMBERSHIP, mreq)</p>
<p>while True:<br />
&nbsp; print sock.recv(1024)</p>
</blockquote>
<p>Also had to add port 22600 to the ufw allowed list, but then I received&nbsp;xml packets&nbsp;that don&#39;t look too difficult to parse into a emoncms&nbsp;url or if you are using emonhub it would be quite easy to adapt a SocketInterfacer to a OwlInterfacer.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33460"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 19/08/2015 - 21:24.</div>
    <div class="content">
     <p>Just tried &quot;xmltodict&quot; python module for parsing, if replacing&nbsp;the &quot;print sock.recv(1024)&quot; line (above) with</p>
<blockquote><p>data = xmltodict.parse(sock.recv(1024))<br />
&nbsp; &nbsp; if &#39;electricity&#39; in data:<br />
&nbsp; &nbsp; &nbsp; &nbsp; if data[&#39;electricity&#39;][&#39;@id&#39;] == &#39;123456789abc:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;rssi&nbsp;&nbsp; &nbsp; &nbsp; : &quot; + data[&#39;electricity&#39;][&#39;signal&#39;][&#39;@rssi&#39;]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;lqi &nbsp; &nbsp; &nbsp; &nbsp;: &quot; + data[&#39;electricity&#39;][&#39;signal&#39;][&#39;@lqi&#39;]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;batt&nbsp;level : &quot; + data[&#39;electricity&#39;][&#39;battery&#39;][&#39;@level&#39;][:-1]\<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + &quot; &quot; + data[&#39;electricity&#39;][&#39;battery&#39;][&#39;@level&#39;][-1]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for ct in (0, 1, 2):<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if data[&#39;electricity&#39;][&#39;chan&#39;][ct]:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;CT&quot; + str(ct + 1) + &quot; power &nbsp;: &quot; \<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + data[&#39;electricity&#39;][&#39;chan&#39;][ct][&#39;curr&#39;][&#39;#text&#39;] + &quot; &quot; \<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + data[&#39;electricity&#39;][&#39;chan&#39;][ct][&#39;curr&#39;][&#39;@units&#39;]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;CT&quot; + str(ct + 1) + &quot; energy : &quot; \<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + data[&#39;electricity&#39;][&#39;chan&#39;][ct][&#39;day&#39;][&#39;#text&#39;] + &quot; &quot; \<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + data[&#39;electricity&#39;][&#39;chan&#39;][ct][&#39;day&#39;][&#39;@units&#39;]</p>
<p>&nbsp; &nbsp;&nbsp;elif&nbsp;&#39;solar&#39; in data:<br />
&nbsp; &nbsp; &nbsp; &nbsp; if data[&#39;solar&#39;][&#39;@id&#39;] == &#39;123456789abc&#39;:<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;generating : &quot; + data[&#39;solar&#39;][&#39;current&#39;][&#39;generating&#39;][&#39;#text&#39;]\<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + &quot; &quot; + data[&#39;solar&#39;][&#39;current&#39;][&#39;generating&#39;][&#39;@units&#39;]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;generated &nbsp;: &quot; + data[&#39;solar&#39;][&#39;day&#39;][&#39;generated&#39;][&#39;#text&#39;]\<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + &quot; &quot; + data[&#39;solar&#39;][&#39;day&#39;][&#39;generated&#39;][&#39;@units&#39;]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;exporting &nbsp;: &quot; + data[&#39;solar&#39;][&#39;current&#39;][&#39;exporting&#39;][&#39;#text&#39;]\<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + &quot; &quot; + data[&#39;solar&#39;][&#39;current&#39;][&#39;exporting&#39;][&#39;@units&#39;]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;exported &nbsp; : &quot; + data[&#39;solar&#39;][&#39;day&#39;][&#39;exported&#39;][&#39;#text&#39;]\<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + &quot; &quot; + data[&#39;solar&#39;][&#39;day&#39;][&#39;exported&#39;][&#39;@units&#39;]</p>
</blockquote>
<p>and adding <strong>import xmltodict</strong>&nbsp;at the head of the script&nbsp;gives a print out of&nbsp;</p>
<blockquote><p>rssi &nbsp; &nbsp; &nbsp; : -20<br />
lqi &nbsp; &nbsp; &nbsp; &nbsp;: 0<br />
batt level : 100 %<br />
CT1 power &nbsp;: 0.00 w<br />
CT1 energy : 0.00 wh<br />
CT2 power &nbsp;: 0.00 w<br />
CT2 energy : 0.00 wh<br />
CT3 power &nbsp;: 0.00 w<br />
CT3 energy : 0.00 wh<br />
generating : 0.00 w<br />
generated &nbsp;: 0.00 wh<br />
exporting &nbsp;: 0.00 w<br />
exported &nbsp; : 0.00 wh</p>
</blockquote>
<p>if the device&nbsp;id is matched (Ive used 123456789abc in the example above)&nbsp;</p>
<p>The data comes in in 2 packets so ideally needs to be collated and then sent as 1 node id or sent as 2 individual nodes, or as 2&nbsp;halves of the same node id maybe better.</p>
<p>This is just debug prints the final payload can be just the usual timestamped&nbsp;data array with a node id.</p>
<p>the xmltodict&nbsp;module can be installed using <strong>sudo pip install xmltodict&nbsp;</strong>if pip is installed</p>
<p>Paul&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33461"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8569.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="j20ands10&#039;s picture" title="j20ands10&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8569.html" title="View user profile.">j20ands10</a> on Wed, 19/08/2015 - 22:03.</div>
    <div class="content">
     <p>this is the code i am using</p>
<p>from twisted.internet.protocol import DatagramProtocol<br />
from lxml import objectify<br />
from decimal import Decimal<br />
import socket<br />
import requests</p>
<p>sock = socket.socket(socket.AF_INET, # Internet<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; socket.SOCK_DGRAM) # UDP</p>
<p>MCAST_ADDR = &#39;224.192.32.19&#39;<br />
MCAST_PORT = 22600</p>
<p>class node(object):<br />
# structure for storing data about channels<br />
&nbsp; &nbsp; def __init__(self, channel_id, current_w, daily_wh):<br />
# &nbsp;self.channel_id = channel_id<br />
&nbsp; &nbsp; &nbsp; self.current_w = Decimal(current_w)<br />
# &nbsp;self.daily_wh = Decimal(daily_wh)</p>
<p>def __str__(self):<br />
&nbsp; return &#39;%s&#39; % (<br />
# &nbsp; self.channel_id,<br />
&nbsp; &nbsp;self.current_w,<br />
# &nbsp; self.daily_wh<br />
&nbsp; )</p>
<p>class OwlMessage(object):<br />
&nbsp; &nbsp; def __init__(self, datagram):<br />
&nbsp; #print &quot;datagram: %r&quot; % (datagram,)<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.root = objectify.fromstring(datagram)<br />
&nbsp;<br />
&nbsp; # there are also weather events -- we don&#39;t care about these<br />
&nbsp; &nbsp; &nbsp; &nbsp; assert (self.root.tag == &#39;electricity&#39;), (&#39;OwlMessage XML must have `electricity` root node (got %r).&#39; % self.root.tag)<br />
&nbsp;<br />
&nbsp; # note that the MAC address is given by the message, not the packet.<br />
&nbsp; # this can be spoofed<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.mac = self.root.attrib[&#39;id&#39;]<br />
&nbsp;<br />
&nbsp; # read signal information for the sensor&#39;s 433MHz link<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.rssi = Decimal(self.root.signal[0].attrib[&#39;rssi&#39;])<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.lqi = Decimal(self.root.signal[0].attrib[&#39;lqi&#39;])<br />
&nbsp;<br />
&nbsp; # read battery information from the sensor.<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.battery = Decimal(self.root.battery[0].attrib[&#39;level&#39;][:-1])<br />
&nbsp;<br />
&nbsp; # read sensors (channels)<br />
&nbsp; &nbsp; self.channels = {}<br />
&nbsp; &nbsp; for channel in self.root.chan:<br />
&nbsp; &nbsp; &nbsp; &nbsp; assert channel.attrib[&#39;id&#39;] not in self.channels, &#39;Channel duplicate&#39;<br />
&nbsp; &nbsp; &nbsp; &nbsp; assert channel.curr[0].attrib[&#39;units&#39;] == &#39;w&#39;, &#39;Current units must be watts&#39;<br />
&nbsp; &nbsp; &nbsp; &nbsp; assert channel.day[0].attrib[&#39;units&#39;] == &#39;wh&#39;, &#39;Daily usage must be watthours&#39;<br />
&nbsp;&nbsp;<br />
&nbsp; &nbsp;# we&#39;re good and done our tests, create a channel<br />
&nbsp; &nbsp; &nbsp; &nbsp; self.channels[channel.attrib[&#39;id&#39;]] = node(channel.attrib[&#39;id&#39;], channel.curr[0].text, channel.day[0].text)</p>
<p>def __str__(self):<br />
&nbsp; return &#39;csv=%s&#39; % (<br />
&nbsp; &nbsp;&#39;,&#39;.join((str(x) for x in self.channels.itervalues()))<br />
&nbsp; )</p>
<p>class OwlIntuitionProtocol(DatagramProtocol):<br />
&nbsp; &nbsp; def __init__(self, iface=&#39;&#39;):<br />
&nbsp; &nbsp; &nbsp; &quot;&quot;&quot;<br />
&nbsp; &nbsp; &nbsp; Protocol for Owl Intution (Network Owl) multicast UDP.<br />
&nbsp;<br />
&nbsp; &nbsp; &nbsp; :param iface: Name of the interface to use to communicate with the Network Owl. &nbsp;If not specified, uses the default network connection on the cost.<br />
&nbsp; &nbsp; &nbsp; :type iface: str<br />
&nbsp; &nbsp; &nbsp; &quot;&quot;&quot;<br />
&nbsp; &nbsp; &nbsp; self.iface = iface</p>
<p>&nbsp; &nbsp; def startProtocol(self):<br />
&nbsp; &nbsp; &nbsp; self.transport.joinGroup(MCAST_ADDR, self.iface)</p>
<p>&nbsp; &nbsp; def datagramReceived(self, datagram, address):<br />
&nbsp; &nbsp; &nbsp; msg = OwlMessage(datagram)<br />
&nbsp; &nbsp; &nbsp; self.owlReceived(address, msg)</p>
<p>&nbsp; &nbsp; def owlReceived(self, address, msg):<br />
&nbsp; &nbsp; &nbsp; print &#39;%s&#39; % (msg)<br />
&nbsp; &nbsp; &nbsp; curlmessage = &#39;%s&#39; % (msg)<br />
&nbsp; &nbsp; &nbsp; r = requests.post(&quot;http://emoncms.org/input/post.json?node=1&amp;&quot;+curlmessage+&quot;,&quot;&quot;&amp;apikey=xxxxxxxxxx&quot;)</p>
<p>if __name__ == &#39;__main__&#39;:<br />
&nbsp; &nbsp; from twisted.internet import reactor<br />
&nbsp; &nbsp; from argparse import ArgumentParser<br />
parser = ArgumentParser()<br />
parser.add_argument(&#39;-i&#39;, &#39;--iface&#39;, dest=&#39;iface&#39;, default=&#39;&#39;, help=&#39;Network interface to use for getting data.&#39;)</p>
<p>options = parser.parse_args()</p>
<p>protocol = OwlIntuitionProtocol(iface=options.iface)<br />
reactor.listenMulticast(MCAST_PORT, protocol, listenMultiple=True)<br />
reactor.run()</p>
<p>but when it runs I gets an error on line 27 in &lt;module&gt;&nbsp;and 47 in owlmessage</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33467"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 19/08/2015 - 23:21.</div>
    <div class="content">
     <p>When I started looking at the various scripts they all seemed a bit heavy for what seemed a simple task, so I wondered how little code it could be done with. considering the bulk of all&nbsp;the print statements I used that can be stripped away after dev I think this could be be small enough to include in an emonHub&nbsp;interfacer.</p>
<p>Looking at Line 47 it looks like there is an indentation issue (hard to be sure in a post) the &quot;self.channels = {}&quot; and the following 5 lines block should be indented once more so the&nbsp;&quot;self.channels = {}&quot; lines up with the &quot;self.battery = Decimal(self.root.battery[0].attrib[&#39;level&#39;][:-1])&quot; line above it not the &quot;def __init__(self, datagram):&quot; further up.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33606"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8627.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="G6EJD&#039;s picture" title="G6EJD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8627.html" title="View user profile.">G6EJD</a> on Tue, 25/08/2015 - 15:41.</div>
    <div class="content">
     <p>I&#39;ve got the Ardunio reading the network owl UDP datagrams:</p>
<p>/*<br />
Network OWL UDP Reader using an Arduino with Ethernet shield attached.</p>
<p>The Arduino is assigned an arbitrary network address (192.168.0.177)and then monitors port 22600 used by the Network Owl to distribute data.<br />
The Serial monitor is used to see the received data from the Wiznet Ethernet shield.</p>
<p>This is an example of the Network UDP Datagram broadcast on UDP port 22600 (typically 321 bytes of data)</p>
<p>&lt;electricity id=&#39;443719000DDC&#39;&gt;<br />
&nbsp; &lt;signal rssi=&#39;-56&#39; lqi=&#39;30&#39;/&gt;<br />
&nbsp; &lt;battery level=&#39;100%&#39;/&gt;<br />
&nbsp; &lt;chan id=&#39;0&#39;&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;curr units=&#39;w&#39;&gt;273.00&lt;/curr&gt;&lt;day units=&#39;wh&#39;&gt;2699.73&lt;/day&gt;<br />
&nbsp; &lt;/chan&gt;<br />
&nbsp; &lt;chan id=&#39;1&#39;&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;curr units=&#39;w&#39;&gt;0.00&lt;/curr&gt;&lt;day units=&#39;wh&#39;&gt;0.00&lt;/day&gt;<br />
&nbsp; &lt;/chan&gt;<br />
&nbsp; &lt;chan id=&#39;2&#39;&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;curr units=&#39;w&#39;&gt;0.00&lt;/curr&gt;&lt;day units=&#39;wh&#39;&gt;0.00&lt;/day&gt;<br />
&nbsp; &lt;/chan&gt;<br />
&lt;/electricity&gt;</p>
<p>This is an exmplae of the weather data packet:<br />
&lt;weather id=&#39;00A0C914C851&#39; code=&#39;263&#39;&gt;<br />
&nbsp; &lt;temperature&gt;19.00&lt;/temperature&gt;<br />
&nbsp; &lt;text&gt;Patchy light drizzle&lt;/text&gt;<br />
&lt;/weather&gt;</p>
<p>*/<br />
#include &lt;SPI.h&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
#include &lt;Ethernet.h&gt;<br />
#include &lt;EthernetUdp.h&gt;</p>
<p>// Enter a MAC address and IP address for your controller below.<br />
// The IP address will be dependent on your local network:<br />
byte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED };<br />
IPAddress ip(192, 168, 0, 177);&nbsp;&nbsp; // Give the Arduino an attribary IP address<br />
unsigned int localPort = 22600;&nbsp;&nbsp; // local port to listen on</p>
<p>// An EthernetUDP instance to let us send and receive packets over UDP<br />
EthernetUDP Udp;</p>
<p>//char packetBuffer[UDP_TX_PACKET_MAX_SIZE]; //buffer to hold incoming packet,<br />
#define buffer_size 260</p>
<p>char packetBuffer[buffer_size]; //buffer to hold incoming packet,<br />
int start_point;<br />
String UDP_Data;<br />
boolean address_shown = false;</p>
<p>void setup() {<br />
&nbsp;&nbsp; // start the Ethernet and UDP:<br />
&nbsp;&nbsp; Serial.begin(115200);<br />
&nbsp;&nbsp; Ethernet.begin(mac,ip);<br />
&nbsp;&nbsp; Udp.begin(localPort);<br />
&nbsp;&nbsp; Serial.println(&quot;Receiving packets of data&quot;);<br />
&nbsp;&nbsp; //Serial.println(UDP_TX_PACKET_MAX_SIZE); / Diagnostic print option<br />
}</p>
<p>void loop() {<br />
&nbsp;&nbsp; int packetSize = Udp.parsePacket();<br />
&nbsp;&nbsp; if(packetSize)<br />
&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp;&nbsp; if (!address_shown) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Received data packet of size &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(packetSize);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot; From &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IPAddress remote = Udp.remoteIP();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int i =0; i &lt; 4; i++) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(remote[i], DEC);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (i &lt; 3) {Serial.print(&quot;.&quot;);}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;, port: &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(Udp.remotePort());<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; address_shown = true;<br />
&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp;&nbsp; Udp.read(packetBuffer,buffer_size);<br />
&nbsp;&nbsp;&nbsp;&nbsp; //Serial.println(&quot;Received data:&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp; UDP_Data = packetBuffer; // Convert char array to string for ease of manipulation<br />
&nbsp;&nbsp;&nbsp;&nbsp; //Serial.println(UDP_Data); // Diagnostic print. If required uncomment start of line<br />
&nbsp;&nbsp;&nbsp;&nbsp; // First look for Watts data<br />
&nbsp;&nbsp;&nbsp;&nbsp; start_point = UDP_Data.indexOf(&quot;&lt;curr units=\&#39;w\&#39;&gt;&quot;) + 16;<br />
&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(UDP_Data.substring(start_point,UDP_Data.indexOf(&quot;&lt;/curr&gt;&quot;,start_point)));<br />
&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot; Watts&nbsp; &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp; // Next look for accumlated Watts used today<br />
&nbsp;&nbsp;&nbsp;&nbsp; start_point = UDP_Data.indexOf(&quot;&lt;day units=\&#39;wh\&#39;&gt;&quot;) + 16;<br />
&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(UDP_Data.substring(start_point,UDP_Data.indexOf(&quot;&lt;/day&gt;&quot;,start_point)));<br />
&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot; W-Hours or &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp; float KW_Hours = (UDP_Data.substring(start_point,UDP_Data.indexOf(&quot;&lt;/day&gt;&quot;,start_point))).toFloat() / 1000;<br />
&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(KW_Hours, 2);<br />
&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot; KWHrs (accumulated power used today)&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp; // Display associated weather data<br />
&nbsp;&nbsp;&nbsp;&nbsp; // UDP_Data = &quot;&lt;weather id=&#39;00A0C914C851&#39; code=&#39;263&#39;&gt;&lt;temperature&gt;19.00&lt;/temperature&gt;&lt;text&gt;Patchy light drizzle&lt;/text&gt;&lt;/weather&gt;&quot;; // test data<br />
&nbsp;&nbsp;&nbsp;&nbsp; if (UDP_Data.indexOf(&quot;&lt;weather&quot;) &gt;= 0) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println();<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Weather report: &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start_point = UDP_Data.indexOf(&quot;&lt;temperature&gt;&quot;) + 13;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(UDP_Data.substring(start_point,UDP_Data.indexOf(&quot;&lt;/temperature&gt;&quot;,start_point)));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;&#39;C&nbsp; &quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; start_point = UDP_Data.indexOf(&quot;&lt;text&gt;&quot;) + 6;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(UDP_Data.substring(start_point,UDP_Data.indexOf(&quot;&lt;/text&gt;&quot;,start_point)));<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println();<br />
&nbsp;&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33656"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8569.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="j20ands10&#039;s picture" title="j20ands10&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8569.html" title="View user profile.">j20ands10</a> on Thu, 27/08/2015 - 19:42.</div>
    <div class="content">
     <p>G6EJD,</p>
<p>All I am getting is&nbsp;&quot;Receiving packets of data&quot; any ideas?</p>
<p>John</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33714"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8627.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="G6EJD&#039;s picture" title="G6EJD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8627.html" title="View user profile.">G6EJD</a> on Sun, 30/08/2015 - 19:41.</div>
    <div class="content">
     <p>What Ethernet card are you using - 5100, 5200 or the latest 5500, make sure you have the correct library, but generally only 5500 needs EthernetV2.0. Do the&nbsp; examples in the Ethernet folder work e.g. NTP . I presume your network owl is connected and running OK. Have you changed any of the default UDP/Push settings in the network owl, you should find it set to port 22600 by default, it may be different.</p>
<p>I assume your network owl is on the same network. Your ethernet card will need t obe plugged into a router.</p>
<p>Using the WiFi card does work, but it&#39;s buffer size is very small, so you can only just receive power usage, that&#39;s all, but it works nonetheless.</p>
<p>Put some diagnostic print statements in the code, so you can see that it arrives at various places. e.g. Serial.println(&quot;Start of the main loop&quot;);</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33715"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8627.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="G6EJD&#039;s picture" title="G6EJD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8627.html" title="View user profile.">G6EJD</a> on Sun, 30/08/2015 - 19:43.</div>
    <div class="content">
     <p>BTW works on IDE 1.6.5 but 1.06 would be a more stable choice.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33744"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8569.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="j20ands10&#039;s picture" title="j20ands10&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8569.html" title="View user profile.">j20ands10</a> on Mon, 31/08/2015 - 21:14.</div>
    <div class="content">
     <p>its working forgot I had the owl base plugged into the router and the cable which came down to the living room was plugged into a 1gig switch. Both plugged into the router and all sorted, now the fun begins.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33784"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 01/09/2015 - 23:17.</div>
    <div class="content">
     <p>@John - Have you decided not to use the Pi now?</p>
<p>I expanded the stuff I posted above to send to emoncms&nbsp;and/or via emonhub&nbsp;(see attached)</p>
<p>Although I&#39;m not able to spend much time on this now, I have noticed that the &quot;udp push&quot; interface can actually accept commands too, including setting the AC voltage and power factor (defaults to 230vac and pf1.0) so it is probally&nbsp;quite possible to use data from a emontx&nbsp;to adjust the owl settings on a regular interval eg 1min&nbsp;and make it considerably more accurate, something to look at another time :-)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33785"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8569.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="j20ands10&#039;s picture" title="j20ands10&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: New user alert - Owl Intuition PV capture/logging</h3>

    <div class="submitted">Submitted by <a href="../user/8569.html" title="View user profile.">j20ands10</a> on Tue, 01/09/2015 - 23:21.</div>
    <div class="content">
     <p>Paul I was really struggling with the RPi and got side tracked onto arduino&nbsp;in a hope I could understand what was going on more; as the nights get darker i am sure I will get back to RPi.</p>
<p>Having had the hiccup with the router and&nbsp;switch thats what might have been causing my issue on the RPi. :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11109"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-YqwS4IoQsF8LCpbpnSZpX7e4x_OO44r9MMmmMFY1HhI" value="form-YqwS4IoQsF8LCpbpnSZpX7e4x_OO44r9MMmmMFY1HhI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
