<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5207 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:49:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Development: Emoncms + MQTT | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Development: Emoncms + MQTT</h3>
        <span class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 24/05/2014 - 16:05</span>
        <div class="content"><p>We&#39;ve discussed the idea of using MQTT within emoncms several times before but the idea came up again during discussion about the best way to implement node decoding in emonhub. Emoncms could provide some of the same features of emonhub ie multiple listeners and multiple dispatchers in an elegant way if it incorporated mqtt message queues. It would also provide benefits for control as initially explored here last December <a href="https://github.com/emoncms/development/tree/master/experimental/control/nodejs_websocket_thermostat">https://github.com/emoncms/development/tree/master/experimental/control/nodejs_websocket_thermostat</a></p>
<p>Here&#39;s a system diagram of how it could look like:</p>
<p><img alt="" src="../sites/default/files/systemdesign_emoncms_mqtt.jpg" style="width: 700px; height: 495px;" /></p>
<p>Here&#39;s an initial working concept with working serial listener and node processor, with step by step setup guide: <a href="https://github.com/openenergymonitor/documentation/blob/master/Modules/RaspberryPI/FullStackHDD/FullStackHDD.md">https://github.com/openenergymonitor/documentation/blob/master/Modules/RaspberryPI/FullStackHDD/FullStackHDD.md</a></p>
<p>This approach needs a fair bit of work to make it a really nice solution, If you think this is the way to go it would be great to get some help with making it happen, in particular:</p>
<ul>
<li>
		Integrating the event module by running it as its own process subscribed to the applicable mqtt topics.</li>
<li>
		Writing a process for the emonhub style dispatcher for sending data to other services such as a remote emoncms or another service entirely such as PVOutput or ThingSpeak</li>
<li>
		Creating raspberrypi module style emoncms gui for the new python based listener setting the rfm12pi radio settings.</li>
<li>
		Managing all these processes, a process status interface in emoncms?</li>
</ul>
<p>Richard Hatfield and I have also been doing work on setting up Emoncms + MQTT + scheduler for heating control, the raspberrypi software setup guide for the configuration so far is here:<br />
	<a href="https://github.com/openenergymonitor/documentation/blob/master/Modules/RaspberryPI/FullStackHDDScheduler/FullStackHDDScheduler.md">https://github.com/openenergymonitor/documentation/blob/master/Modules/RaspberryPI/FullStackHDDScheduler/FullStackHDDScheduler.md</a></p>
<p>There are also some new related MQTT mini examples in the emoncms/development repository: <a href="https://github.com/emoncms/development">https://github.com/emoncms/development</a></p>
<p>Interested to hear peoples thoughts.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5377.html" class="topic-previous" title="Go to previous forum topic">‹ My electric : how to share it without giving my Read-Write API key ?</a>
              <a href="5371.html" class="topic-next" title="Go to next forum topic">Ignore nodes ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-21548"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Development: Emoncms + MQTT</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 24/05/2014 - 21:07.</div>
    <div class="content">
     <p>I&#39;ve not a great deal of knowledge about MQTT, but would this then allow for greater integration with <strong>Node-Red</strong> via MQTT nodes?</p>
<p>If so, wouldn&#39;t Node-Red provide a ready made flexible solution for handling events instead of developing the event module?<br />
	Recent additions to Node-Red include an &#39;Email&#39; node, &#39;pushbullet&#39;, &#39;pushover&#39;, &#39;nma&#39;, &#39;prowl&#39;, &#39;twitter&#39;, and as of today &#39;pusher&#39; which opens up a whole new level of opportunities.</p>
<p>Paul.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21618"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Development: Emoncms + MQTT</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 27/05/2014 - 14:09.</div>
    <div class="content">
     <p>Yes maybe! although I havent done much with node-red, Glyn&#39;s explored it a bit I think. There&#39;s some good work done here by Dom Bramley&#39;s of IBM on documenting a openenergymonitor + jeenode + nodered integration</p>
<p>Part 1: <a href="https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/home_automation_with_node_red_jeenodes_and_the_oen_energy_monitor_project?lang=en" title="https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/home_automation_with_node_red_jeenodes_and_the_oen_energy_monitor_project?lang=en">https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/home_aut...</a></p>
<p>Part 2: <a href="https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/node_red_and_the_open_energy_monitor_emonth?lang=en" title="https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/node_red_and_the_open_energy_monitor_emonth?lang=en">https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/node_red...</a></p>
<p>Part 3: <a href="https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/sending_data_from_node_red_to_emoncms?lang=en" title="https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/sending_data_from_node_red_to_emoncms?lang=en">https://www.ibm.com/developerworks/community/blogs/B-Fool/entry/sending_...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21629"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Development: Emoncms + MQTT</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 27/05/2014 - 20:36.</div>
    <div class="content">
     <p>Don Bramley&#39;s&nbsp;blog makes good reading, however it is not totally suited to running node-red and emoncms&nbsp;on the same device, because it currently relies upon a node-red &#39;serial node&#39; to listen for input data on /dev/ttyAMA0&nbsp;which of course is the same bus used by emoncms, and you can&#39;t have two devices connected to the same serial bus at the same time.</p>
<p>To work and integrate, emoncms would need a MQTT&nbsp;output for each input, which could be picked up by node-red.</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21633"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1741.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1741.jpg" alt="ukmoose&#039;s picture" title="ukmoose&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Development: Emoncms + MQTT</h3>

    <div class="submitted">Submitted by <a href="../user/1741.html" title="View user profile.">ukmoose</a> on Tue, 27/05/2014 - 21:03.</div>
    <div class="content">
     <p>I&#39;m using a modified version of Dom&#39;s scripts to take data from my RFM12PI into Node-Red. &nbsp;</p>
<p>I must admit to loving the&nbsp;ease of adding additional outputs and the ability for node-red to add event messaging.</p>
<p>Before much time is spent developing a bespoke version I would encourage you to take a look&nbsp;at NodeRed. &nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21705"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Development: Emoncms + MQTT</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 30/05/2014 - 13:07.</div>
    <div class="content">
     <p>MQTT is a topic being discussed on emonHub github currently and NodeRed&nbsp;has been mentioned. Although I currently know very little about either I read good things about NodeRed and at the very least would expect NodeRed integration via a custom dispatcher and maybe a listener&nbsp;too.</p>
<p>My guess is NodeRed&nbsp;may not be a total solution for all users so would expect a need for emonHub (oem gateway) to remain and maybe some NodeRed integration in emonHub may have other gains.....</p>
<p>@ ukmoose - Is it possible to see the script you are using, is it on github ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21926"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Development: Emoncms + MQTT</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Wed, 11/06/2014 - 05:19.</div>
    <div class="content">
     <p>I am new here but saw this thread and am very interested in MQTT as a messaging protocol. I am already using it extensively in my home automation software, including using it as a control signal for Arduino&nbsp;slaves with sensors and output relays - for switching loads etc.</p>
<p>I also use it for all my notifications - using a python script called mqttwarn (<a href="https://github.com/jpmens/mqttwarn" title="https://github.com/jpmens/mqttwarn">https://github.com/jpmens/mqttwarn</a>). This could be a light weight alternative to something like NodeRed as has been discussed here.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22302"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2239.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ichilton&#039;s picture" title="ichilton&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Development: Emoncms + MQTT</h3>

    <div class="submitted">Submitted by <a href="../user/2239.html" title="View user profile.">ichilton</a> on Thu, 03/07/2014 - 21:01.</div>
    <div class="content">
     <p>This is interesting! - i&#39;ve not read it properly yet, but i&#39;ve been working on something along the same lines.</p>
<p>I&#39;ve got another base next to my RF which talks to emoncms.org - I tried to get it receiving the transmissions from my emonTx&nbsp;&amp; 28 sensor nodes and putting them into MQTT, but it wouldn&#39;t work properly - too much for an ATMega328 to handle I think, so i&#39;ve currently got the 328 spitting the data over serial, and I have some ruby code reading that, parsing it and spitting it into mqtt topics.</p>
<p>I&#39;ve then got various subscribers, which take that and put it into redis for quick access of the latest values and mysql for historic logging.</p>
<p>I&#39;ve then started a basic web interface, which lets me control my wireless mains sockets and garden watering by publishing to mqtt topics and having some Nanode RF&#39;s subscribed to those topics to action the requests.</p>
<p>I&#39;m also going to write a little script to subscribe to the sensor topics and periodically send to emoncms.org.</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5207"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ETvq94T1wTKCo-Tbf2qnITinZ3RNw0wMFQqP14_MjtI" value="form-ETvq94T1wTKCo-Tbf2qnITinZ3RNw0wMFQqP14_MjtI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
