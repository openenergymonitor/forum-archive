<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/1990 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:07:51 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Forward data to remote emoncms server | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Forward data to remote emoncms server</h3>
        <span class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Sun, 03/02/2013 - 23:44</span>
        <div class="content"><p>Hi all.</p>
<p>A few days ago, I managed to get a setup runnig with</p>
<p>- an emonTX in my room monitoring temperature</p>
<p>- a raspberry in the living room</p>
<p>- an emoncms installation on my remote server</p>
<p>The data is sent using Martin&#39;s perl gateway. For some reason, the perl scripts is stopped after a few hours. But in the meantime, it works, and I get the temperature logged : <a href="http://jolimont.fr/emoncms/vis/rawdata&amp;feedid=3">rawdata</a> (don&#39;t pay attention to units, this was just a test).</p>
<p>Martin told me his gateways are obsolete and I should use an emoncms on the rasp instead.</p>
<p>(I liked the idea of a local simple gateway and a remote server, I don&#39;t see the need for a whole local emoncms installation, but I don&#39;t really mind.)</p>
<p>So I installed emoncms on the rasp as per <a href="http://wiki.openenergymonitor.org/index.php?title=Raspberry_Pi">the documentation</a>, and I have it working fine, apparently : I get the inputs, and I created feeds just like I had done on the remote server earlier. I get the charts and all, all on the Pi.</p>
<p>Yet, I would like to send the data to my remote server.</p>
<p>There&#39;s an option for this in the raspberry module configuration menu that seems pretty self explanatory, but I can&#39;t get it to work. I entered domain.tld/emoncms and the API key. It says &quot;Authentication successful&quot;. But I don&#39;t see anything coming.</p>
<p>Besides, whenever I try to launch raspberrypi_run.php myself, I get the &quot;Already running&quot; message.</p>
<p>Anything I may have forgotten ?</p>
<p>The emoncms installation is in /var/www/ on the Pi but in another location on the server. This doesn&#39;t matter, does it ?</p>
<p>How should I proceed for the debugging ? Remove the cron line and launch manually, adding &quot;echo&quot; statements in the script ? Can I keep the cron line and get the &quot;echo&quot; in some logfile ?</p>
<p>Thanks.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="1998.html" class="topic-previous" title="Go to previous forum topic">‹ RPi local server sync with remote enomcms</a>
              <a href="1971.html" class="topic-next" title="Go to next forum topic">trouble with rfm12b ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-9598"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward data to remote emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 04/02/2013 - 12:13.</div>
    <div class="content">
     <p>From the source code, it seems the importlock file is never closed. My understanding is that it is released when the script dies, and before that it is here to prevent cron fom relaunching a second instance of the script while the first is still running. Is this correct ?</p>
<p>I commented the crontab line and after a reboot, I can launch the raspberry module script manually.</p>
<p>After a few tests, I could figure what goes wrong. The gethostbyname() function yields an IP address if given an input such as domain.tld, but it fails with &quot;domain.tld/emoncms&quot; or &quot;domain.tld/emoncms/&quot; (the former has another issue : when added &quot;:80&quot;, it gives &quot;domain.tld/emoncms:80&quot; which does not seem to work, whereas &quot;domain.tld/emoncms/:80 does, at least when entered into firefox URL bar.&quot;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9600"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward data to remote emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 04/02/2013 - 13:26.</div>
    <div class="content">
     <p>I managed to get it a little bit further.</p>
<p>&quot;domain.tld&quot; can be extracted from &quot;domain.tld/emoncms/&quot;. Then gethostbyname() can get the IP address.</p>
<p>But then, next failure is the GET request that is made with a &quot;malformed Host header&quot;.</p>
<p>I worked that around with some more hardcoding and regex trickery, but ultimately, I think there should be a new field added in the config, so as to enter :</p>
<p>server : domain.tld</p>
<p>directory / path / whatever-we-want-to-call-that : emoncms (or whatever the path actually is)</p>
<p>apikey :</p>
<p>What do you think about that ?</p>
<p>FWIW, here&#39;s what I did :</p>
<p>--------------------------------------------------------------------------------</p>
<p>diff --git a/raspberrypi_run.php b/raspberrypi_run.php<br />
	index 96ed29e..87f4610 100644<br />
	--- a/raspberrypi_run.php<br />
	+++ b/raspberrypi_run.php<br />
	@@ -211,8 +211,13 @@</p>
<p>	&nbsp;function getcontent($server, $port, $file)<br />
	&nbsp;{<br />
	+<br />
	&nbsp;&nbsp;&nbsp; $cont = &quot;&quot;;<br />
	-&nbsp;&nbsp; $ip = gethostbyname($server);<br />
	+<br />
	+&nbsp;&nbsp; $serv = preg_replace(&quot;/\/.*/&quot;,&#39;&#39;,$server);<br />
	+&nbsp;&nbsp; $dir = &#39;/emoncms&#39;; // could be regexed<br />
	+<br />
	+&nbsp;&nbsp; $ip = gethostbyname($serv);<br />
	&nbsp;&nbsp;&nbsp; $fp = fsockopen($ip, $port);<br />
	&nbsp;&nbsp;&nbsp; if (!$fp)<br />
	&nbsp;&nbsp;&nbsp; {<br />
	@@ -220,17 +225,20 @@ function getcontent($server, $port, $file)<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp; {<br />
	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $com = &quot;GET $file HTTP/1.1\r\nAccept: */*\r\nAccept-Language: de-ch\r\nAccept-Encoding: gzip, deflate\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $com = &quot;GET $dir$file HTTP/1.1\r\nAccept: */*\r\nAccept-Language: de-ch\r\nAccept-Encoding: gzip, deflate\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windo<br />
	+<br />
	+&nbsp;&nbsp; echo &quot;\n&quot;.$com.&quot;\n&quot;;<br />
	+<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fputs($fp, $com);<br />
	/* Don&#39;t realy need to fetch output as it slows us down<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (!feof($fp))<br />
	--------------------------------------------------------------------------------</p>
<p>Care should also be taken to catch exception such as missing leading or trailing slash in the directory/path, as this can lead to failures.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9616"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward data to remote emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 05/02/2013 - 15:01.</div>
    <div class="content">
     <p>Hi again.</p>
<p>I think I got that done.</p>
<p>I added a new field to allow for a remote path to be specified.</p>
<p>Do you think this is useful ? Was there a simpler way to answer my need (remote server with custom path) ?</p>
<p>Obviously, I&#39;d be glad to see this modest contribution merged into the project.</p>
<p>What is the best way to send contributions ?</p>
<p>Here is a diff, based on latest commit :</p>
<p>(I hope I didn&#39;t break anything. I did not do extensive testing, I just checked it worked in my case. I don&#39;t claim to have good enough knowledge of the emoncms code architecture.)</p>
<p>-----------------------------------------------------------------------------------------------</p>
<p>diff --git a/raspberrypi_controller.php b/raspberrypi_controller.php<br />
	index 12954ca..0857d04 100644<br />
	--- a/raspberrypi_controller.php<br />
	+++ b/raspberrypi_controller.php<br />
	@@ -43,15 +43,17 @@<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $frequency = intval(get(&#39;frequency&#39;));<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $baseid = intval(get(&#39;baseid&#39;));<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $remotedomain = urldecode(get(&#39;remotedomain&#39;));<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $remotepath = get(&#39;remotepath&#39;);<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if($remotepath[0]!=&#39;/&#39;) {$remotepath=&#39;/&#39;.$remotepath;} // ensure leading slash in remotepath<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $remoteapikey = db_real_escape_string(preg_replace(&#39;/[^.\/A-Za-z0-9]/&#39;, &#39;&#39;, get(&#39;remoteapikey&#39;)));</p>
<p>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $remotesend = false;<br />
	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($remotedomain &amp;&amp; $remoteapikey) {<br />
	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $result = file_get_contents(&quot;http://&quot;.$remotedomain.&quot;/time/local.json?apikey=&quot;.$remoteapikey);<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($remotedomain &amp;&amp; $remoteapikey &amp;&amp; $remotepath) {<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $result = file_get_contents(&quot;http://&quot;.$remotedomain.$remotepath.&quot;/time/local.json?apikey=&quot;.$remoteapikey);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($result[0]==&#39;t&#39;) $remotesend = true;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; raspberrypi_set($userid,$apikey,$sgroup,$frequency,$baseid,$remotedomain,$remoteapikey,$remotesend);<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; raspberrypi_set($userid,$apikey,$sgroup,$frequency,$baseid,$remotedomain,$remotepath,$remoteapikey,$remotesend);</p>
<p>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $output[&#39;message&#39;] = &quot;Raspberry PI settings updated&quot;;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	diff --git a/raspberrypi_model.php b/raspberrypi_model.php<br />
	index f4d0aef..5a798e2 100644<br />
	--- a/raspberrypi_model.php<br />
	+++ b/raspberrypi_model.php<br />
	@@ -18,16 +18,16 @@</p>
<p>	&nbsp;&nbsp;&nbsp;&nbsp; if (!$row)<br />
	&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db_query(&quot;INSERT INTO raspberrypi ( userid, apikey, sgroup ,frequency, baseid, remotedomain, remoteapikey, remotesend) VALUES ( &#39;0&#39; , &#39;&#39; ,&#39;1&#39;,&#39;4&#39;,&#39;15&#39; ,&#39;emoncms.<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; db_query(&quot;INSERT INTO raspberrypi ( userid, apikey, sgroup ,frequency, baseid, remotedomain, remotepath, remoteapikey, remotesend) VALUES ( &#39;0&#39; , &#39;&#39; ,&#39;1&#39;,&#39;4&#39;,&#39;15<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $result = db_query(&quot;SELECT * FROM raspberrypi&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $row = db_fetch_array($result);<br />
	&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp; return $row;<br />
	&nbsp;&nbsp; }</p>
<p>	-&nbsp; function raspberrypi_set($userid,$apikey,$sgroup,$frequency,$baseid,$remotedomain,$remoteapikey,$remotesend)<br />
	+&nbsp; function raspberrypi_set($userid,$apikey,$sgroup,$frequency,$baseid,$remotedomain,$remotepath,$remoteapikey,$remotesend)<br />
	&nbsp;&nbsp; {<br />
	-&nbsp;&nbsp;&nbsp; db_query(&quot;UPDATE raspberrypi SET `userid` = &#39;$userid&#39;, `apikey` = &#39;$apikey&#39;, `sgroup` = &#39;$sgroup&#39;, `frequency` = &#39;$frequency&#39;, `baseid` = &#39;$baseid&#39; ,`remotedomain`<br />
	+&nbsp;&nbsp;&nbsp; db_query(&quot;UPDATE raspberrypi SET `userid` = &#39;$userid&#39;, `apikey` = &#39;$apikey&#39;, `sgroup` = &#39;$sgroup&#39;, `frequency` = &#39;$frequency&#39;, `baseid` = &#39;$baseid&#39; ,`remotedomain`<br />
	&nbsp;&nbsp; }</p>
<p>	&nbsp;&nbsp; function raspberrypi_running()<br />
	diff --git a/raspberrypi_run.php b/raspberrypi_run.php<br />
	index 96ed29e..45a1af6 100644<br />
	--- a/raspberrypi_run.php<br />
	+++ b/raspberrypi_run.php<br />
	@@ -56,10 +56,11 @@<br />
	&nbsp;&nbsp; $baseid = $settings[&#39;baseid&#39;];</p>
<p>	&nbsp;&nbsp; $remotedomain = $settings[&#39;remotedomain&#39;];<br />
	+&nbsp; $remotepath = $settings[&#39;remotepath&#39;];<br />
	&nbsp;&nbsp; $remoteapikey = $settings[&#39;remoteapikey&#39;];</p>
<p>	&nbsp;&nbsp; $sent_to_remote = false;<br />
	-&nbsp; $result = file_get_contents(&quot;http://&quot;.$remotedomain.&quot;/time/local.json?apikey=&quot;.$remoteapikey);<br />
	+&nbsp; $result = file_get_contents(&quot;http://&quot;.$remotedomain.$remotepath.&quot;/time/local.json?apikey=&quot;.$remoteapikey);<br />
	&nbsp;&nbsp; if ($result[0]==&#39;t&#39;) {echo &quot;Remote upload enabled - details correct \n&quot;; $sent_to_remote = true; }</p>
<p>	&nbsp;&nbsp; // Create a stream context that configures the serial port<br />
	@@ -114,9 +115,9 @@<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($settings[&#39;frequency&#39;] !=$frequency) {$frequency = $settings[&#39;frequency&#39;]; fprintf($f,$frequency.&quot;b&quot;); }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($settings[&#39;baseid&#39;] !=$baseid) {$baseid = $settings[&#39;baseid&#39;]; fprintf($f,$baseid.&quot;i&quot;);}</p>
<p>	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($settings[&#39;remotedomain&#39;] !=$remotedomain || $settings[&#39;remoteapikey&#39;] !=$remoteapikey)<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($settings[&#39;remotedomain&#39;] !=$remotedomain || $settings[&#39;remoteapikey&#39;] !=$remoteapikey || $settings[&#39;remotepath&#39;] !=$remotepath)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $result = file_get_contents(&quot;http://&quot;.$remotedomain.&quot;/time/local.json?apikey=&quot;.$remoteapikey);<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $result = file_get_contents(&quot;http://&quot;.$remotedomain.$remotepath.&quot;/time/local.json?apikey=&quot;.$remoteapikey);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if ($result[0]==&#39;t&#39;) {echo &quot;Remote upload enabled - details correct \n&quot;; $sent_to_remote = true; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>	@@ -133,7 +134,7 @@<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $remotedata .= &quot;]&quot;;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;Sending remote data&quot;;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //echo $remotedata.&quot;\n&quot;;<br />
	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getcontent($remotedomain,80,&quot;/input/bulk.json?apikey=&quot;.$remoteapikey.&quot;&amp;data=&quot;.$remotedata);<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; getcontent($remotedomain,80,$remotepath.&quot;/input/bulk.json?apikey=&quot;.$remoteapikey.&quot;&amp;data=&quot;.$remotedata);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ni = 0; $remotedata = &quot;[&quot;;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $start_time = time();<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	@@ -211,7 +212,9 @@</p>
<p>	&nbsp;function getcontent($server, $port, $file)<br />
	&nbsp;{<br />
	-&nbsp;&nbsp; $cont = &quot;&quot;;<br />
	+&nbsp;&nbsp; //$cont = &quot;&quot;;<br />
	&nbsp;&nbsp;&nbsp; $ip = gethostbyname($server);<br />
	&nbsp;&nbsp;&nbsp; $fp = fsockopen($ip, $port);<br />
	&nbsp;&nbsp;&nbsp; if (!$fp)<br />
	@@ -220,7 +223,10 @@ function getcontent($server, $port, $file)<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp; {<br />
	-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $com = &quot;GET $file HTTP/1.1\r\nAccept: */*\r\nAccept-Language: de-ch\r\nAccept-Encoding: gzip, deflate\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows<br />
	+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $com = &quot;GET $file HTTP/1.1\r\nAccept: */*\r\nAccept-Language: de-ch\r\nAccept-Encoding: gzip, deflate\r\nUser-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows N</p>
<p>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fputs($fp, $com);<br />
	&nbsp;/* Don&#39;t realy need to fetch output as it slows us down<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while (!feof($fp))<br />
	diff --git a/raspberrypi_schema.php b/raspberrypi_schema.php<br />
	index 26e0355..06ab2d9 100644<br />
	--- a/raspberrypi_schema.php<br />
	+++ b/raspberrypi_schema.php<br />
	@@ -8,6 +8,7 @@ $schema[&#39;raspberrypi&#39;] = array(<br />
	&nbsp;&nbsp; &#39;baseid&#39; =&gt; array(&#39;type&#39; =&gt; &#39;int(11)&#39;),<br />
	&nbsp;&nbsp; &#39;running&#39; =&gt; array(&#39;type&#39; =&gt; &#39;int(11)&#39;),<br />
	&nbsp;&nbsp; &#39;remotedomain&#39; =&gt; array(&#39;type&#39; =&gt; &#39;text&#39;),<br />
	+&nbsp; &#39;remotepath&#39; =&gt; array(&#39;type&#39; =&gt; &#39;text&#39;),<br />
	&nbsp;&nbsp; &#39;remoteapikey&#39; =&gt; array(&#39;type&#39; =&gt; &#39;text&#39;),<br />
	&nbsp;&nbsp; &#39;remotesend&#39; =&gt; array(&#39;type&#39; =&gt; &#39;int(11)&#39;)<br />
	&nbsp;);<br />
	diff --git a/raspberrypi_view.php b/raspberrypi_view.php<br />
	index 09bbde7..ce74e2c 100644<br />
	--- a/raspberrypi_view.php<br />
	+++ b/raspberrypi_view.php<br />
	@@ -37,6 +37,7 @@<br />
	&nbsp;&lt;p&gt;&lt;b&gt;Forward data to remote emoncms server&lt;/b&gt;&lt;/p&gt;</p>
<p>	&nbsp;&lt;p&gt;Domain name&lt;br&gt;&lt;input type=&quot;text&quot; name=&quot;remotedomain&quot; value=&quot;&lt;?php echo $settings[&#39;remotedomain&#39;]; ?&gt;&quot; /&gt;&lt;/p&gt;<br />
	+&lt;p&gt;Path to emoncms&lt;br&gt;&lt;input type=&quot;text&quot; name=&quot;remotepath&quot; value=&quot;&lt;?php echo $settings[&#39;remotepath&#39;]; ?&gt;&quot; /&gt;&lt;/p&gt;<br />
	&nbsp;&lt;p&gt;Write apikey&lt;br&gt;&lt;input type=&quot;text&quot; name=&quot;remoteapikey&quot; value=&quot;&lt;?php echo $settings[&#39;remoteapikey&#39;]; ?&gt;&quot; /&gt;&lt;/p&gt;<br />
	&nbsp;&lt;?php if ($settings[&#39;remotesend&#39;]) echo &quot;&lt;p&gt;&lt;b&gt;Authentication successful&lt;/b&gt;&lt;/p&gt;&quot;; else echo &quot;&lt;p&gt;&lt;b&gt;Incorrect remote server details&lt;/b&gt;&lt;/p&gt;&quot;; ?&gt;</p>
<p>-----------------------------------------------------------------------------------------------</p>
<p>Note this adds an attribute in the database. The magical &quot;Update and check&quot; button in the Admin tab sorted this all out perfectly.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward data to remote emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 06/02/2013 - 12:03.</div>
    <div class="content">
     <p>Hello Jerome</p>
<p>This sounds great, I would be happy to merge it into the module. Can you send me a pull request to the raspberry pi repo on github? You will need to make your own fork first, commit to that and then send a pull request.</p>
<p>Thanks a lot</p>
<p>Trystan</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9643"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Forward data to remote emoncms server</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Wed, 06/02/2013 - 23:54.</div>
    <div class="content">
     <p><a href="https://github.com/emoncms/raspberrypi/pull/6">Done</a>.</p>
<p>Thank you !</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/1990"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-0DHHeW7i9uXkyMvDVF9YsMNseemwQ2UtCGjOCx8kLpc" value="form-0DHHeW7i9uXkyMvDVF9YsMNseemwQ2UtCGjOCx8kLpc"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/1990 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:07:51 GMT -->
</html>
