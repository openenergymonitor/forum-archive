<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2663 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:05:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonCMS absolute value for feed | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonCMS absolute value for feed</h3>
        <span class="submitted">Submitted by Guest on Wed, 07/08/2013 - 22:17</span>
        <div class="content"><p>Hi,</p>
<p>I&#39;m getting strange results from my CTs on emonCMS giving positive and negative values for a PV single phase system. I was wondering if theres a way to make the feed only show an absolute (always postive, flip sign if negative) value?</p>
<p><a href="http://54.243.157.143/emoncms/vis/auto?feedid=83" title="http://54.243.157.143/emoncms/vis/auto?feedid=83">http://54.243.157.143/emoncms/vis/auto?feedid=83</a></p>
<p>Try the link above to visualize the feed.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2664.html" class="topic-previous" title="Go to previous forum topic">‹ How do I power breadboard/arduino in the &quot;How to build an arduino energy monitor - measuring current only&quot; guide????????????</a>
              <a href="2662.html" class="topic-next" title="Go to next forum topic">Separate CT Calibration ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-14169"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonCMS absolute value for feed</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 07/08/2013 - 23:10.</div>
    <div class="content">
     <p>That looks to me as if your values are overflowing. Remember, you can only send signed integers and the range is -32768 to +32767 Watts. So you are generating nearly 65 kW? If that&#39;s really the case, I think it means you must scale the value you are sending by 0.5 in the emonTx, and in emonCMS multiply that input by 2 before passing it on to the feed.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14175"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="virosoft&#039;s picture" title="virosoft&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonCMS absolute value for feed</h3>

    <div class="submitted">Submitted by virosoft (not verified) on Thu, 08/08/2013 - 01:55.</div>
    <div class="content">
     <p>Thanks Robert !<br />
	<strike>I don&#39;t have access to the emonTx it&#39;s out on a remote location, what is the best option? I&#39;m thinking I could perhaps change the data type on the database from a signed 16 bit to an unsigned (The PV sites are rated for 50kW). I also have a 200kW site so I might need to go as far as 32bit integer without changing the emontx code!...</strike></p>
<p><strike>Or could I take the input and multiply it by 0.5 before storing it as a feed? I&#39;ll try this first.</strike></p>
<p>&quot;On the Arduino Uno (and other ATMega based boards) an int stores a 16-bit (2-byte) value. This yields a range of -32,768 to 32,767 (minimum value of -2^15 and a maximum value of (2^15) - 1).&quot; - <a href="http://arduino.cc/en/Reference/int" title="http://arduino.cc/en/Reference/int">http://arduino.cc/en/Reference/int</a><br />
	typedef struct {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int power1;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int power2;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int power3;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Vrms;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int temperature;<br />
	} PayloadTX;</p>
<p>The code on the emonTx will NEED to be changed, I think the best method for me is to send the current for ct&#39;s along with the voltage instead of the power.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14180"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonCMS absolute value for feed</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 08/08/2013 - 09:31.</div>
    <div class="content">
     <p>But you won&#39;t then be recording real power, only apparent power. In the UK (and most places, I believe) you pay for watts, not VA.</p>
<p>You divide your power by 10 (to give you 327 kW max - or any suitable number!) before you fill that struct with the value, then as I wrote restore it at the other end. You will then have your power in increments of decawatts!</p>
<p>If you have your own emoncms, you might be able to change the code to use signed longs, but I don&#39;t know emoncms so I can&#39;t tell you how hard that would be. It probably still needs to be signed if you go down that route.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14203"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="virosoft&#039;s picture" title="virosoft&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: emonCMS absolute value for feed</h3>

    <div class="submitted">Submitted by virosoft (not verified) on Thu, 08/08/2013 - 22:46.</div>
    <div class="content">
     <p>These solar PV sites should have a power factor pretty much at unity (KVAh=KWh), but good point. I could also send the power factor within the payload, or to save on data just use your divide by 10. Note that they are directly tied into the grid from the PV inverters.</p>
<p>Changing the emonCMS data type won&#39;t matter since it&#39;s the emonTx&#39;s code data type that is the root cause of the problem! Unless I changed both the emonTx and emonCMS data type together.</p>
<p>It&#39;s interesting to see that a value greater than 32,767 will become negative where generating 50kW will display:<br />
	-1 * ( -32,767 + 50,000 )= -17,233</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14204"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonCMS absolute value for feed</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 08/08/2013 - 23:24.</div>
    <div class="content">
     <p><em>Changing the emonCMS data type won&#39;t matter since it&#39;s the emonTx&#39;s code data type that is the root cause of the problem! Unless I changed both the emonTx and emonCMS data type together.</em></p>
<p>Yes, well, they are designed for each other!</p>
<p><em>It&#39;s interesting to see that a value greater than 32,767 will become negative where generating 50kW will display:<br />
	-1 * ( -32,767 + 50,000 )= -17,233</em></p>
<p>That&#39;s how signed binary arithmetic works!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2663"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-VWux8IAyj33kkAy7CBadaWWPHj27YHTQFfbKvNfngCY" value="form-VWux8IAyj33kkAy7CBadaWWPHj27YHTQFfbKvNfngCY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
