<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/1213 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:36:28 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Incorrect time from emoncms.org....sometimes | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Incorrect time from emoncms.org....sometimes</h3>
        <span class="submitted">Submitted by Guest on Sun, 21/10/2012 - 16:51</span>
        <div class="content"><p>Now that my DHCP issues with the Nanode have been resolved, I&#39;ve had some time to fine tune my configuration. I&#39;ve recently switched from having a local emoncms server running to using emoncms.org (my local pc steadfastly refused to update emoncms). My emoncms.org account is set up, nanode is posting to it, time offset on the account is set to +1 hour. All seems ok.</p>
<p>I&#39;ve noticed that my GLCD time is incorrect when I&#39;m up and about early in the morning. Around 6-6:30am, the time reads approximately 20 minutes early. However, when I&#39;m home from work at 6pm, the time is correct and appears to remain correct until midnight, not that I sit and watch it for six hours, but I did make a special effort to keep an eye on it the other night :)</p>
<p>The wife hasn&#39;t noticed any errors in the time during the day, but she also didn&#39;t realise there was a clock on it.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="1215.html" class="topic-previous" title="Go to previous forum topic">‹ RESOLVED - EmonTX voltage error</a>
              <a href="582.html" class="topic-next" title="Go to next forum topic">Which Burden Resistor for SCT 019 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-6809"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Incorrect time from emoncms.org....sometimes</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Sun, 21/10/2012 - 17:03.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Have noticed the same - early in the morning the emonGLCD goes backwards sometimes, time is synchronized using nanodeRF and emonCMS.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6836"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1587.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="edllew&#039;s picture" title="edllew&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Incorrect time from emoncms.org....sometimes</h3>

    <div class="submitted">Submitted by <a href="../user/1587.html" title="View user profile.">edllew</a> on Tue, 23/10/2012 - 16:34.</div>
    <div class="content">
     <p>This is a bug which is also affecting me.&nbsp; I think it is because:</p>
<p><a href="http://emoncms.org/time/local.json?apikey=" title="http://emoncms.org/time/local.json?apikey=">http://emoncms.org/time/local.json?apikey=</a> [YOUR APIKEY HERE]</p>
<p>returns a time string like:</p>
<p>t9,28,39</p>
<p>The code in NanodeRF_Power_RTCrelay_GLCDtemp.ino expects formating like this instead:</p>
<p>t09,28,39</p>
<p>where it is doing some parsing:</p>
<p>&nbsp;&nbsp;&nbsp; char tmp[] = {line_buf[1],line_buf[2],0};<br />
	&nbsp;&nbsp;&nbsp; byte hour = atoi(tmp);<br />
	etc.</p>
<p>The problem could be fixed there, but should really be fixed at the time server on emoncms.org.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6838"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1587.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="edllew&#039;s picture" title="edllew&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Incorrect time from emoncms.org....sometimes</h3>

    <div class="submitted">Submitted by <a href="../user/1587.html" title="View user profile.">edllew</a> on Wed, 24/10/2012 - 00:16.</div>
    <div class="content">
     <p>I also notice that at the moment (17:12 local time, aka 5:12 PM USA west coast, or 00:12 in the UK I think) the time server is returning to me:</p>
<p>t-7,11,21</p>
<p>My local time time offset in hours on my EmonCMS account page is set to -7.</p>
<p>Again, this could be corrected for on the emonGLCD, but would best be corrected on emoncms.org.&nbsp; I poked around the emoncms codebase a little, but struck out trying to find where the time server calculations go on.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6855"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1587.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="edllew&#039;s picture" title="edllew&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Incorrect time from emoncms.org....sometimes</h3>

    <div class="submitted">Submitted by <a href="../user/1587.html" title="View user profile.">edllew</a> on Thu, 25/10/2012 - 18:11.</div>
    <div class="content">
     <p>To fix this I changed NanodeRF_Power_RTCrelay_GLCDtemp.ino:</p>
<p>in my_callback() I replaced the 6 lines calculating hour, minute, second with:</p>
<p>&nbsp;&nbsp;&nbsp; //Time received can be: t-7,11,21&nbsp; or&nbsp; t9,28,39&nbsp; or&nbsp; t09,28,39&nbsp; .&nbsp; Null terminated.<br />
	&nbsp;&nbsp;&nbsp; int j = int (line_buf[3]==&#39;,&#39;); //j is true/1 if comma in 4th byte<br />
	&nbsp;&nbsp;&nbsp; byte hour = (atoi(line_buf+1) + 24) % 24;&nbsp; //make hour non-negative<br />
	&nbsp;&nbsp;&nbsp; byte minute = atoi(line_buf+3+j);<br />
	&nbsp;&nbsp;&nbsp; byte second = atoi(line_buf+6+j);</p>
<p>So far it works for me at my local time offset of -7 hours, as well as at some other random values I tested at.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6868"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1994.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="RobertK&#039;s picture" title="RobertK&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Incorrect time from emoncms.org....sometimes</h3>

    <div class="submitted">Submitted by <a href="../user/1994.html" title="View user profile.">RobertK</a> on Fri, 26/10/2012 - 13:31.</div>
    <div class="content">
     <p>A nice solution! I would prefer to do the test this way:</p>
<pre>
    int j = (line_buf[3]==&#39;,&#39;) ? 1: 0;</pre><p>(using the ternary operator. It specifically sets j to either 0 or 1. &nbsp;I think it is safer and clearer.).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6875"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Incorrect time from emoncms.org....sometimes</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Fri, 26/10/2012 - 17:01.</div>
    <div class="content">
     <p>Wow - thanks, just programmed this in. ;-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/1213"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-vkRCaDoqygil9h8oC26G2h0s2MRxSmPgxvNXfHClAEM" value="form-vkRCaDoqygil9h8oC26G2h0s2MRxSmPgxvNXfHClAEM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
