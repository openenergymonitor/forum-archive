<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6296 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:39:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Pls Help 3phase emonglcd code | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Pls Help 3phase emonglcd code</h3>
        <span class="submitted">Submitted by <a href="../user/7363.html" title="View user profile.">nihonjin</a> on Sun, 14/12/2014 - 23:58</span>
        <div class="content"><p>Hi i have the hardware all working but im pretty sure the code is not right as i have 3 phase power here in Australia and i would like to know what i need to do to correctly read the 3 phases and combine this into one output for my emonglcd. &nbsp;I also have solar which does not&nbsp;appear&nbsp;to be reporting correctly.</p>
<p>I assume i need to change the following code in my emonglcd to add the 3 phases:</p>
<p>&nbsp;if (SolarPV_type==1){<br />
&nbsp; &nbsp; usekwh += (emontx.power1 * 0.2) / 3600000;<br />
&nbsp; &nbsp; genkwh += (emontx.power2 * 0.2) / 3600000;</p>
<p>and also this:</p>
<p>if (SolarPV_type==1){<br />
&nbsp; &nbsp; cval_use = cval_use + (emontx.power1 - cval_use)*0.50;<br />
&nbsp; &nbsp; cval_gen = cval_gen + (emontx.power2 - cval_gen)*0.50;</p>
<p>&nbsp;</p>
<p>I have the 3 phases connected&nbsp;to CT1 through to CT3 and then the solar connected to CT4 on the emonTx is this correct?&nbsp; Do i need to change any code in the emonTx as well?</p>
<p>&nbsp;</p>
<p>thanks.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2634.html" class="topic-previous" title="Go to previous forum topic">‹ Current sensor TA17-03 from elecfreaks.com</a>
              <a href="6299.html" class="topic-next" title="Go to next forum topic">Control RF Oase FM Master Plugs using the RFM12Pi V2 ? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-25848"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pls Help 3phase emonglcd code</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 15/12/2014 - 11:29.</div>
    <div class="content">
     <p>Sorry, I have crystal ball malfunction. I need more information than that. What are you doing in the emonTx, because that's where the information that the GLCD displays comes from?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7363.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nihonjin&#039;s picture" title="nihonjin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pls Help 3phase emonglcd code</h3>

    <div class="submitted">Submitted by <a href="../user/7363.html" title="View user profile.">nihonjin</a> on Mon, 15/12/2014 - 12:27.</div>
    <div class="content">
     <p>Sorry I want clear. </p>
<p>I wish to monitor my power usage and solar pv generation.  So I have bought the emonTx receiver and emonglcd display kit to do this.  I have 3 phase power at home and 5kw of solar pv. </p>
<p>I've recently (since my first post) uploaded this sketch to the emonTx but still im not getting correct readings on my emonglcd.</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM12B/Examples/emonTxV3_3Phase_Voltage/emonTxV3_3Phase_Voltage.ino" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM12B/Examples/emonTxV3_3Phase_Voltage/emonTxV3_3Phase_Voltage.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3...</a></p>
<p>I've tried various different changes to the solarpv sketch to suit 3 phase power but again the readings in getting don't match what my inverter says my solar is generating.</p>
<p>as mentioned above I have phase 1 ct clips connected to ct1 and phase 2 and 3 to ct2 and ct3 respectively.  My solar pv is then connected to ct4.  I'm also powering it via the 9v ac-ac adaptor. </p>
<p>I hope this clarifies of not please let me know what else I can say to help solve my issues. </p>
<p>Thanks. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25852"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pls Help 3phase emonglcd code</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 15/12/2014 - 13:31.</div>
    <div class="content">
     <p>The 3-phase emonTx sketch reports the data for each of the 3 phases separately. Your emonGLCD sketch was designed for a single phase installation (because 3-phase is almost unheard-of for domestic installations in the UK). Therefore, because memory in the GLCD is limited, the easiest and best thing to do is to add the powers for the three phases in the emonTx, then change the PayloadTX structure to send the values you want in the format that the GLCD expects. You'll find help on interpreting the structure of the transmissions in RFM12B - Part 2, in Building Blocks.</p>
<p>By default CT4 is also on phase 1, but you can change that if necessary (line 395) - what you need to do should be relatively obvious from the lines above.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25854"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="burner&#039;s picture" title="burner&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Pls Help 3phase emonglcd code</h3>

    <div class="submitted">Submitted by burner (not verified) on Mon, 15/12/2014 - 16:57.</div>
    <div class="content">
     <p>The content of this post has been deemed offensive by the moderators, and has been deleted. - RW</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25858"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7363.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nihonjin&#039;s picture" title="nihonjin&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pls Help 3phase emonglcd code</h3>

    <div class="submitted">Submitted by <a href="../user/7363.html" title="View user profile.">nihonjin</a> on Mon, 15/12/2014 - 23:50.</div>
    <div class="content">
     <p>thank you for your post and pointing me in the right direction. &nbsp;Unfortunately this is all very new to me and im still lost as to what i should do.</p>
<p>I have read the document on interpreting the structure of the transmission in RFM12B&nbsp;but cant quite work out where to start. &nbsp;I assume i need to add the 3 phases power readings and combine these into power1 and assign the solar pv reading and send this as power2&nbsp;as this is what the emonglcd&nbsp;solar &nbsp;pv&nbsp;sketch is looking for 2 numbers power1 and power2 where power1 is the house power and power2 is the solar pv power.</p>
<p>&nbsp;</p>
<p>How i do this i still do not know and would appreciate any ideas and or sample code to play with. &nbsp;Thanks.</p>
<p>***update****</p>
<p>So i have changed the code as follows in the emonTx:</p>
<p>emontx.power1 = realPower1 + realPower2 + realPower3; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Copy the desired variables ready for transmision<br />
emontx.power2 = realPower4;<br />
//emontx.power3 = realPower3;<br />
//emontx.power4 = realPower4;<br />
emontx.Vrms &nbsp; = Vrms;</p>
<p>and loaded the standard solar PV sketch for the emonglcd. &nbsp;It appears to be working more like it should now but my solar readings are not exactly as what my inverter says its out by about 500watts ie the emonglcd is reporting 3.4kw when it should be 3.9kw. &nbsp;Is this an exceptable&nbsp;error margin or is there something i can do &nbsp;to fix this.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25860"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pls Help 3phase emonglcd code</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 16/12/2014 - 00:01.</div>
    <div class="content">
     <p>I would start, as you suggest, with the GLCD. You haven't said where your CTs are connected in relation to where the PV infeed is, so you'll need to bear that in mind when you're changing the code. I'm guessing your 3 'main' CTs are on the grid connection and see the nett import/export, i.e. a 'Type 2' installation.</p>
<p>For a 'Type 2' it's expecting the nett grid power to be in emontx.power1, and the generated PV power in emontx.power2. Therefore the consumed power is the sum of these two. emontx.power3 is not used. We'll leave the code in the emonGLCD as it is - unless of course you want to see the individual phase powers at some point - except of course you'll need to set it as a Type 2.</p>
<p>So look now at the 3-phase sketch in the emonTx.<br />
All the powers are available towards the end of loop( ) just before the data packet is sent to the RFM12B with send_rf_data(), so that's where we need to jump in. But first, we need to make the struct emontx the same as the one in the GLCD. So copy it from there and paste it into line 144 where it's defined, replacing what's there.<br />
Now go back to the bottom of loop( ) where the powers are loaded into the emontx struct. You want<br />
emontx.power1 = realPower1 + realPower2 + realPower3 (this is the total nett grid power)<br />
and emontx.power2 = realPower4 (this is the PV infeed).<br />
You can forget emontx.power3 or set it to zero as you wish, as it's unused.<br />
emontx.Vrms is fine.</p>
<p>And with a bit of luck, I've got that right and you should get sensible numbers (assuming what I guessed above is correct). (I'm also assuming that PV power is positive in daylight, and each phase is positive when importing from the grid. That's our convention. Flip the CT if one is wrong.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25861"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pls Help 3phase emonglcd code</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 16/12/2014 - 00:27.</div>
    <div class="content">
     <p><i>"So i have changed the code as follows in the emonTx:</i></p>
<p><i>emontx.power1 = realPower1 + realPower2 + realPower3;                      // Copy the desired variables ready for transmision<br />
 emontx.power2 = realPower4;<br />
 //emontx.power3 = realPower3;<br />
 //emontx.power4 = realPower4;<br />
 emontx.Vrms   = Vrms;</i></p>
<p><i>and loaded the standard solar PV sketch for the emonglcd.  It appears to be working more like it should now but my solar readings are not exactly as what my inverter says its out by about 500watts ie the emonglcd is reporting 3.4kw when it should be 3.9kw.  Is this an exceptable error margin or is there something i can do  to fix this."</i></p>
<p>Did you go through the full calibration procedure for your emonTx? That is the starting point. There are notes about installation and calibration in Building Blocks, but the overriding calibration process for that 3-phase sketch is in the comments at the top of the sketch. It's perfectly acceptable to tweak the constants (Ical4 in the case of your PV) to make the numbers agree with your meters.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25864"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Pls Help 3phase emonglcd code</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 16/12/2014 - 09:44.</div>
    <div class="content">
     <p>The emonGLCD can only display data that it receives from the emonTx.&nbsp; The data that the emonTx is generating can be inspected at its Serial Monitor, so it may simplify the operation to check the numbers there.</p>
<p>I thought I&#39;d posted a message to this effect yesterday but can&#39;t see it here now.&nbsp; Maybe I clicked &#39;Preview&#39; rather than &#39;Save&#39;.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6296"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-qmLeD_pyF0_2ovgDuzKC63UML5SMhoozfrmFIkJn0I0" value="form-qmLeD_pyF0_2ovgDuzKC63UML5SMhoozfrmFIkJn0I0"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
