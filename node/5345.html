<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>RFM69CW ISP Upload Problem - Reset timming  | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/4">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">RFM69CW ISP Upload Problem - Reset timming </h3>
        <span class="submitted">Submitted by <a href="/emon/user/10" title="View user profile.">glyn.hudson</a> on Thu, 26/06/2014 - 09:54</span>
        <div class="content"><p>Recently I&#39;ve been testing (with success) the new RFM69CW&nbsp;RF module, it&#39;s pin compatible and backwards compatible with RFM12B, JeeLabs&nbsp;JeeLib RF12 driver now supports the RFM69CW. It&#39;s been tested to work on emonTx V2, emonGLCD.&nbsp;RFM12Pi and emonPi.&nbsp;</p>
<p><a href="http://openenergymonitor.org/emon/sites/default/files/2014-06-26 10.50.53.jpg"><img alt="" src="http://openenergymonitor.org/emon/sites/default/files/2014-06-26 10.50.53.jpg" style="width: 300px; height: 225px;" /></a><em>RFM69CW on RFM12Pi</em></p>
<p>All was going well until I fitted an RFM69CW to a board with a blank ATmega328&nbsp;(no bootloader), I went ahead to upload a bootlader via arduino (or avrdude) in the normal way and the ISP upload failed. So I investigated further...</p>
<p>It seems when the RFM69CW is fitted to reset line is only asserted low for half the time compared to when the RFM12B (or no RF module) is fitted. See scope trace below.</p>
<p><strong>The red trace shows a healthy ISP reset when the RFM12B is fitted (90ms) and the blue trace shows the reset line when the RFM69CW is fitted (50ms).</strong></p>
<p>&nbsp;</p>
<p><img alt="" src="https://lh3.googleusercontent.com/-OA3Ptlv3nXw/U6vZGrf-I_I/AAAAAAAAAxI/LalvKRbRz90/w800-h480-no/Reset_ISP_RFM69CW.jpg" style="width: 500px; height: 300px;" /></p>
<p>&nbsp;</p>
<p>So, the question is can avrdude be set to force reset for longer..? I&#39;ll investigate. Has anyone else noticed this problem? I&#39;ve still not been able to post on the forum, do you need to do something with my account..<br />
	​<br />
	I&#39;m using an an AVRISP MKII&nbsp;ISP programmer with the board powered by 3.3V and running the following AVRdude command which checked for the presence of a chip and reads it&#39;s device signature.</p>
<p><em>$ sudo avrdude -c avrispmkii -p m328p -P usb -v</em></p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/2461" class="topic-previous" title="Go to previous forum topic">‹ Reading Ampy meters via the inductive serial port</a>
              <a href="/emon/node/5300" class="topic-next" title="Go to next forum topic">RFM12Pi V3 corrupted data [SOLVED] ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-22195"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3016" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM69CW ISP Upload Problem - Reset timming </h3>

    <div class="submitted">Submitted by <a href="/emon/user/3016" title="View user profile.">dBC</a> on Thu, 26/06/2014 - 11:42.</div>
    <div class="content">
     <p>When you&#39;re using the ISP, I&#39;m pretty sure it holds the target AVR&#39;s /RESET low for the entire transaction. &nbsp;That puts the AVR into a dumb SPI slave mode so that the ISP can act as a SPI master to program it. &nbsp; &nbsp;So it may be that the ISP is de-asserting /RESET because it&#39;s given up, i.e. the /RESET behaviour you&#39;re seeing may be another symptom, rather than the cause.</p>
<p>Do you have an external pull-up on the RFM69CW&#39;s /CS? &nbsp;I&#39;m wondering if the module may think it&#39;s selected (because nobody is pulling /CS high) and so driving MISO which is interfering with ISP&lt;-&gt;AVR transactions. &nbsp; Then when the ISP doesn&#39;t see the responses it expects from the AVR&nbsp;(because of that interference), it gives up and de-asserts /RESET. &nbsp;</p>
<p>You can&#39;t rely on AVR internal pull-ups for SPI&nbsp;/CSs&nbsp;if those SPI devices are going to be on the bus while you&#39;re trying to program the initial&nbsp;bootloader, because there&#39;s no code running on the AVR&nbsp;yet to enable those internal pull-ups.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22196"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/10" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM69CW ISP Upload Problem - Reset timming </h3>

    <div class="submitted">Submitted by <a href="/emon/user/10" title="View user profile.">glyn.hudson</a> on Thu, 26/06/2014 - 13:39.</div>
    <div class="content">
     <p>Yes! Your totally right, I was observing a result rather than the cause of the problem. Temporally&nbsp;puling up the RFM69CW&nbsp;SEL line (Dig10) with a 10K resistor solved the problem (update:&nbsp;100K also works ok). Thanks for your help.&nbsp;</p>
<p>Looks like a hardware change might be needed (add pull-up resistor) in order to make the RFM69CW&nbsp;allow ISP upload onto a blank ATmega328.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22201"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RFM69CW ISP Upload Problem - Reset timming </h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Thu, 26/06/2014 - 19:05.</div>
    <div class="content">
     <p>Glyn, I&#39;m pleased to hear that the RFM69C now appears to be working correctly for you.&nbsp; My own experience was that, although I could get the revised code to run without locking up, no RF was happening.</p>
<p>Might it be possible to post some working code on the thread that I started about this, at <a href="http://openenergymonitor.org/emon/node/5162">http://openenergymonitor.org/emon/node/5162</a>&nbsp;&nbsp;</p>
<p>An updated version of your <a href="https://github.com/openenergymonitor/RFM12B_Simple">simple RF checker sketches</a> would be perfect :D</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/5345"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-dWT2WdhcKlIEpkXqIja8faiKUB88Vw2D4DTaEP5mD4U" value="form-dWT2WdhcKlIEpkXqIja8faiKUB88Vw2D4DTaEP5mD4U"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
