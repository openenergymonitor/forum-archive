<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10196 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:27:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Hourly or Daily Dump to PostgreSQL | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Hourly or Daily Dump to PostgreSQL</h3>
        <span class="submitted">Submitted by <a href="../user/7722.html" title="View user profile.">Martinm3</a> on Thu, 19/02/2015 - 15:54</span>
        <div class="content"><p>Hello,</p>
<p>&nbsp;</p>
<p>Recently I&#39;ve been brought into a project to find an alternative storage method for emoncms feed data.&nbsp; The end goal is to do hourly or daily dumps of all feed data to an existing postgres database.&nbsp; Currently,&nbsp;it&#39;s my understanding that the storage to MySQL was phased out and now timestore is being used.&nbsp; I know that our&nbsp;set-up currently results in a number of .dat files.&nbsp; I&#39;m trying to determine where, in the flow of the current set-up, I would be able to pull the data out that it would still be in a manageable format for shipping to a postgres environment.</p>
<p>I&#39;ve tried searching through the forums, but because a lot of the content refers to outdated storage dataflow I&#39;ve had trouble tracking down the exact dataflow.&nbsp;&nbsp; Any suggestions or direction would be very much appreciated!</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10230.html" class="topic-previous" title="Go to previous forum topic">‹ Vcal calculation</a>
              <a href="10229.html" class="topic-next" title="Go to next forum topic">EmonCMS on Linux webhosting HowTo ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-27937"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6891.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="octagon&#039;s picture" title="octagon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hourly or Daily Dump to PostgreSQL</h3>

    <div class="submitted">Submitted by <a href="../user/6891.html" title="View user profile.">octagon</a> on Thu, 19/02/2015 - 17:21.</div>
    <div class="content">
     <p>Out of interest why don&#39;t you want to use the existing data stores?</p>
<p>Is it for further analysis ?</p>
<p>There is also a Redis&nbsp;storage system - 3 datastores !!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27938"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7722.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Martinm3&#039;s picture" title="Martinm3&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hourly or Daily Dump to PostgreSQL</h3>

    <div class="submitted">Submitted by <a href="../user/7722.html" title="View user profile.">Martinm3</a> on Thu, 19/02/2015 - 17:35.</div>
    <div class="content">
     <p>Personally I&#39;m unfamiliar with the methods it&#39;s using, and we already use Postgres for some of our other applications.&nbsp; I&nbsp;believe the idea is to keep everything stored in one&nbsp;environment to make access/backups/etc more stream-lined.&nbsp; By that I mean if the data from the feeds is stored in the same place as the data for our other projects it&#39;s easier to control access to the whole.&nbsp; My understanding of the current set-up isn&#39;t sufficient enough to rule it out, I&#39;m just thinking that using postgres fits what&#39;s asked of me better to that regard.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27975"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6891.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="octagon&#039;s picture" title="octagon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hourly or Daily Dump to PostgreSQL</h3>

    <div class="submitted">Submitted by <a href="../user/6891.html" title="View user profile.">octagon</a> on Fri, 20/02/2015 - 11:18.</div>
    <div class="content">
     <p>emoncms used the difference types of data stores for differing reasons read this thread</p>
<p><a href="5319.html" title="http://openenergymonitor.org/emon/node/5319">http://openenergymonitor.org/emon/node/5319</a></p>
<p>It explains why the data is where &amp; why.</p>
<p>Even if you managed the export I would imagine you&#39;d have issues trying to restore the dataset back into emoncms.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27983"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7722.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Martinm3&#039;s picture" title="Martinm3&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hourly or Daily Dump to PostgreSQL</h3>

    <div class="submitted">Submitted by <a href="../user/7722.html" title="View user profile.">Martinm3</a> on Fri, 20/02/2015 - 18:08.</div>
    <div class="content">
     <p>It wouldn&#39;t need to be imported back.&nbsp; We&#39;re using emoncms for our real-time monitoring/alerts, this would be more for historical storage.&nbsp; (After getting clarification from those working more closely with the actual system than I)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27984"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hourly or Daily Dump to PostgreSQL</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 20/02/2015 - 18:15.</div>
    <div class="content">
     <p>Martin, it sounds like perhaps implementing or extending the mysql engine would work for you? Or you could extract the data at the feed insert method, have a look here:<br />
<a href="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.php#L402" title="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.php#L402">https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.p...</a></p>
<p>or update method:<br />
<a href="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.php#L429" title="https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.php#L429">https://github.com/emoncms/emoncms/blob/master/Modules/feed/feed_model.p...</a></p>
<p>Or alternatively you might be interested to look at the short scripts I wrote here for reading the data directly out of the .dat .meta feed engine files:<br />
<a href="https://github.com/emoncms/usefulscripts/blob/master/enginereaders/phpfina.php" title="https://github.com/emoncms/usefulscripts/blob/master/enginereaders/phpfina.php">https://github.com/emoncms/usefulscripts/blob/master/enginereaders/phpfi...</a></p>
<p>You could use that as a basis and read the data from the emoncms feed engine file into your own database? That could allow you to read in larger blocks, may be a more efficient approach.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28126"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7722.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Martinm3&#039;s picture" title="Martinm3&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hourly or Daily Dump to PostgreSQL</h3>

    <div class="submitted">Submitted by <a href="../user/7722.html" title="View user profile.">Martinm3</a> on Tue, 24/02/2015 - 16:14.</div>
    <div class="content">
     <p>Looking at your script, I think adapting that will probably be the best route for what I&#39;m trying to do, thanks!</p>
<p>This is a bit of a nwebie question, but I&#39;m struggling with getting the fopen to read from the right location.&nbsp; It seems to be trying to find the path stored in $dir in the folder hosting the php file I have the adapted script in, and I&#39;m uncertain how to get it to go back up to var from html so it can drill back down to /lib/phpfiwa/.&nbsp; Any ideas?</p>
<p>The error for clarity: fopen(/phpfiwa/73.meta): failed to open stream: No such file or directory in /var/www/html/EmonDataGrab.php&nbsp;</p>
<p>It&#39;s stored in /var/lib.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28254"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7722.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Martinm3&#039;s picture" title="Martinm3&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hourly or Daily Dump to PostgreSQL</h3>

    <div class="submitted">Submitted by <a href="../user/7722.html" title="View user profile.">Martinm3</a> on Fri, 27/02/2015 - 15:21.</div>
    <div class="content">
     <p>I figured out the issue, there were stray quotes that needed to be cleaned up.&nbsp; I&#39;ve got it outputting, and it appears to be in pairs, displaying either a 4 or 6 digit number, followed by a feed value or NAN.&nbsp; As the engineers are the ones actually using the software, I&#39;m uncertain what the first set of characters indicate.&nbsp; They suggested it could be a UTC date stamp, but that doesn&#39;t seem to line up.&nbsp; Would anyone happen to know what the value indicates?</p>
<p>&nbsp;</p>
<p>A few examples:</p>
<p>7388 78.125</p>
<p>7392 78.29150390625</p>
<p>7396 78.267501831055</p>
<p>and</p>
<p>922352 77.900001525879</p>
<p>922356 78.080001831055</p>
<p>922360 NAN</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>*Edit* Upon further investigation, I&#39;m thinking it&#39;s a file point, and I apologize if there&#39;s documentation somewhere saying as much, I couldn&#39;t find anything.&nbsp; My question is, is there any way I can get a timestamp-type value from the dat files so I can pull it from these files and store it in the database in a time-noted manner?&nbsp; Is it not notated because of the use of PHPTimestore?&nbsp; I&#39;m very new to this, and haven&#39;t yet figured out how to effectively navigate github in a manner that helps me learn the infrastructure.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10196"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-yGMm6SoJ0YkK0MaOvaN1xppYeXHTQM85auUc21_ekeA" value="form-yGMm6SoJ0YkK0MaOvaN1xppYeXHTQM85auUc21_ekeA"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
