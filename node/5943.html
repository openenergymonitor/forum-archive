<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5943 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:44:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>MQTT and node-red for emonHub | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">MQTT and node-red for emonHub</h3>
        <span class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 17/10/2014 - 15:08</span>
        <div class="content"><p>I have started an issue tracker on GitHub for&nbsp;emonHub, I don&#39;t have a firm enough grasp of either node-red or MQTT to implement anything by myself but if there is any interested parties I am happy to work with them to get something&nbsp; into emonHub.</p>
<p><a href="https://github.com/emonhub/emonhub/issues/125">https://github.com/emonhub/emonhub/issues/125</a></p>
<p>It was mentioned in the <a href="5826.html">events module MQTT&nbsp;implementation</a> thread that it might be good to have a MQTT reporter publishing MQTT and I think it could make MQTT&nbsp;and/or Node-Red more accessible to more users if emonHub could publish topics, which would allow expansion into MQTT, openHAB and node-red alongside existing emonHub/emonCMS&nbsp;setups.</p>
<p>emonHub was designed to replace the PHP and Python scripts used to interface the rfm2pi&nbsp;to emonCMS&nbsp;and there are individual scripts out there to interface the RFM2Pi to either node-red or openHAB, however the RFM2Pi&nbsp;can only be used by one of these systems as it&#39; uses the uart serial port. I believe&nbsp;emonHub could actually also replace those scripts to make the RFM2Pi&nbsp;available to all three systems simultaneously.</p>
<p>Paul</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3253.html" class="topic-previous" title="Go to previous forum topic">‹ Power Quality Arduino Based Monitoring for Industrial, Commercial and Residential Facilities</a>
              <a href="11831.html" class="topic-next" title="Go to next forum topic">Pricing &amp; purchasing ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-24617"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 17/10/2014 - 19:10.</div>
    <div class="content">
     <p>Hi Paul. I am a big supporter of MQTT&nbsp;and would love to see emoncms&nbsp;publish feed data to MQTT so that I can use it in node-red. Sorry to say that my technical knowledge of MQTT&nbsp;is poor, but I now have a reasonable grasp of node-red, and will help wherever I can.</p>
<p>I&#39;ve read the most recent &#39;emonhub&#39; blog post - May 2014, but I have steered clear of emonhub so far, mainly through <a href="https://github.com/emonhub/emonhub/blob/master/README.md">lack of documentation</a>, but also because it is not included within the emoncms&nbsp;<span style="font-size: 12px;">Github&nbsp;account, and which raises the question - is it supported/endorsed by the OEM team at this time?</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 12px;">Paul</span><br />
	&nbsp;</p>
<p>
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24625"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 18/10/2014 - 11:40.</div>
    <div class="content">
     <p>@Paul Reed yes emonhub is fully endorsed and is the recommended method of connecting the rfm12pi to a local or remote emoncms install - currently documented via the raspberrypi setup documentation linked from the get started guide. Hosting emonhub in its own github account I think is a good thing, especially as its meant to provide the flexibility to connect to many different services, emoncms perhaps being just one of them.</p>
<p>Thanks Paul Burnell for continuing the discussion on this, as I&#39;ve mentioned before, Im also keen on this. I like the idea of connecting emonhub to emoncms via MQTT and implementing an emoncms MQTT API for inserting/posting data. I need to start trying some of these ideas out in emoncms, including the publishing of feed data to MQTT. But also happy to support anyone else if anyone else would like to run with this too.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24629"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 18/10/2014 - 12:53.</div>
    <div class="content">
     <p>What isn&#39;t described is how to replace the emoncms/raspberrypi&nbsp;interface (currently installed from the&nbsp;emoncms git account) with emonhub?</p>
<p>Does the current interface (is it php?) have to be removed first.</p>
<p>...and installation, is it a git clone from the Modules directory?</p>
<p>Paul</p>
<p>v8.3.6</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24643"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 18/10/2014 - 13:54.</div>
    <div class="content">
     <p>Yes your quite right, I should also archive the old raspberrypi module in the github and add a note to the top of the readme there. I will try and put together a blog post detailing the switchover procedure. I think emonhub has proven itself quite well over the last few months since the installation guides and new sd card switched over to it.</p>
<p>Yes the first step would be to remove the raspberrypi emoncms module and then install emonhub and configure emonhub as detailed here <a href="https://github.com/emoncms/emoncms/blob/bufferedwrite/docs/setup.md" title="https://github.com/emoncms/emoncms/blob/bufferedwrite/docs/setup.md">https://github.com/emoncms/emoncms/blob/bufferedwrite/docs/setup.md</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24646"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 18/10/2014 - 15:19.</div>
    <div class="content">
     <p>Hi Paul, you&#39;re not the first to mention the lack of emonhub documentation and I intend to document as soon as I can. There were 3 of us developing emonHub at first and I was going to focus on the documentation, but since I&#39;m now developing emonHub alone the coding has taken priority (which I&#39;m quite slow at). In the meantime Trystan has documented guides on installing and setting up emonHub and there are threads about decoding and the datatypes on the forum.</p>
<p>As Trystan says the raspberrypi module does need to be disabled to use emonHub, that due to only one software can use the serial UART the RFM2Pi is connected to. Most users have encounted emonHub by using the Read-only image and I have been concentrating on that but there is a basic installation script to automate installing emonHub and I am happy to focus on improving the installation routine using any feedback you have.should you decide to give it a whirl.</p>
<p>I would appreciate any input with implementing MQTT, I totally believe emonCMS needs to publish MQTT topics to make calculated feed values available to other systems,&nbsp;</p>
<p>The implementation in emonHub would be more about publishing the data received from the RFM2Pi and other &quot;connections&quot; to MQTT as early as possible in real values to all interested parties.</p>
<p>The decoder in emonhub would be able to handle almost any numerical data format and then forward the real values to (both emonCMS and) the MQTT broker so they are almost immediately available to any device subscribing to the relevant topics rather than being passed along the line ie via emonCMS to MQTT or via node-red to emonCMS etc. Hopefully this will increase responsiveness and also standardise the software used in most cases, emonHub was designed to unify and progress the PHP, python and OEM gateway approaches to handling RFM2Pi/Jeelink data and could also provide the OEM project with an alternative to using the node-red flow or openHAB binding.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24648"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 18/10/2014 - 17:00.</div>
    <div class="content">
     <p>Trystan/Paul. Thanks, and yes I&#39;ll help where I can.</p>
<p>I totally agree with you Paul, and as soon as Trystan&nbsp;completes his blog post (or with your help) I&#39;ll change to emonhub, and we can then take it from there. (I&#39;ll PM you my email address)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24650"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 18/10/2014 - 23:29.</div>
    <div class="content">
     <p>...we really need to get on board <a href="../user/3651.html">nubble&nbsp;(Jason)&nbsp;</a>&amp;<a href="../user/6498.html"> sumnerboy&nbsp;(Ben)</a>, they have the knowledge of MQTT&nbsp;to make this happen.<br />
I&#39;ll PM both to see if they can contribute.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24664"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Sun, 19/10/2014 - 20:29.</div>
    <div class="content">
     <p>I would love to help but unfortunately I have zero&nbsp;PHP coding experience. I would be happy to be included in the design phase however and help with discussions about how to build the MQTT component into emonCMS.</p>
<p>There seems to be a requirement for both import and export of data into/out of emonCMS using MQTT. I am currently using a modified emonTX&nbsp;Shield v2 to publish values to various MQTT topics. Since these currently can&#39;t be directly imported into emonCMS I am using a python script called mqttwarn to transform the payloads into JSON suitable for emonCMS. It would be great if emonCMS could &#39;subscribe&#39; to the various topics and enable me to remove this intermediate step.</p>
<p>As to how this would need to be configured in emonCMS I am not certain. Perhaps the simplest way would be to allow the configuration of a parent MQTT topic, such as /home/emontx/+ (where &#39;+&#39; is a wildcard meaning any child&nbsp;topic immediately under /home/emontx/. &#39;#&#39; is the other wildcard type, meaning any child, or childs child, etc to any level under that parent). emonCMS would then monitor this topic and any time a new value was published update the input list in the emonCMS UI - in the same way it does currently with the JSON inputs.&nbsp;</p>
<p>The other option is to force each topic to be explicitly defined for each data input.&nbsp;</p>
<p>For exporting data it might just be as simple as allowing an&nbsp;MQTT topic to be specified against an emonCMS feed (optional). If present whenever the feed is updated the new feed value would be published to that topic.</p>
<p>We would need somewhere to store the MQTT broker configuration and it should definitely support authentication, but this could be a text only config file since it only requires a one-time configuration. The recently updated event module could then be updated to use this config rather than have its own.</p>
<p>Hopefully this might get the ball rolling - as I said I can&#39;t help much with any of the PHP coding but am very eager to assist anywhere else I can.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24669"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 20/10/2014 - 09:34.</div>
    <div class="content">
     <p>Hi Ben&nbsp;</p>
<blockquote><p>For exporting data it might just be as simple as allowing an&nbsp;MQTT topic to be specified against an emonCMS feed (optional). If present whenever the feed is updated the new feed value would be published to that topic.</p>
</blockquote>
<p>I was thinking along the same lines, to create a &quot;Publish to&nbsp;MQTT&quot;&nbsp;input process that can be inserted at any point in the input process chains and just&nbsp;requires a topic&nbsp;to be specified&nbsp;the broker details can be specified in settings.php.</p>
<p>I&#39;m in the same boat with PHP so I can&#39;t comment on the best way to tackle getting MQTT&nbsp;into emonCMS directly, But the main reason for starting this thread was to try and create a MQTT&nbsp;type reporter&nbsp;for emonHub&nbsp;to publish topics&nbsp;so that openHAB, Node-Red&nbsp;and possibly emonCMS&nbsp;in the not to distant future, could all get the data from the RFM network (RFM2Pi or JeeLink), serial port, usb and at a later date I&sup2;C, 1-wire, Modbus&nbsp;etc.</p>
<p>emonHub is written in Python and&nbsp;It&#39;s modular structure&nbsp;should be &quot;relatively&quot; straight forward to add a custom reporter to. I&#39;m very familiar with emonHub&nbsp;and my Python is better than my PHP (granted, that&#39;s not&nbsp;exactly&nbsp;difficult), however I have zero experience of MQTT&nbsp;and therefore&nbsp;do not fully understand what&#39;s needed. even discussing the structure of the topics helps, as emonHub and emonCMS should share a theme maybe.</p>
<p>Any help would be appreciated and although I know you probably don&#39;t currently&nbsp;have a need for the emonHub&nbsp;MQTT&nbsp;implementation as you have the nanodeRF&#39;s&nbsp;directly connected to emonCMS using&nbsp;Ethernet, however,&nbsp;making MQTT available in emonHub alongside existing methods could push forward the emonCMS&nbsp;MQTT&nbsp;development at a faster pace as more users will be able to &quot;play&quot; with MQTT without making an outright&nbsp;switch.</p>
<p>Paul&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24672"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3651.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3651.png" alt="nubble&#039;s picture" title="nubble&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3651.html" title="View user profile.">nubble</a> on Mon, 20/10/2014 - 12:28.</div>
    <div class="content">
     <p>Hi,</p>
<p>Im not sure where to jump in here, but I&#39;m keen to contribute where I can. I am quite comfortable with MQTT [although Ben seems more advanced than I] and I am a much better python developer than php #zeroPhpLastWeek. So I am able to help with the design of it all at get my hands dirty coding.</p>
<p>I also want to add that there is also a MQTT-SN spec recently released that is developed as an extension to MQTT for sensor networks [Hope RF, Xbee, etc.]. this is designed to be wire efficient [less bytes per message].&nbsp;I have my&nbsp;setup successfully running at home using emontx units [RFM12B at 433MHz] that send MQTT-SN messages to my RFM12PI&nbsp;[custom sketch/firmware operating in a MQTT gateway capacity]&nbsp;which sends it on serially to the MQTT broker [RSMB]. &lt;Actually its to a python script I developed called TwistedRouter that essentially bridges serial and&nbsp;UDP for valid MQTT messages&gt;&nbsp;Once its at the broker the conventional MQTT subscriptions apply. So right at the sensor level Im doing MQTT. From what I can gather is that emonhub is performing a gateway function [translator]&nbsp;between radio comms/network and other [like JSON, MQTT] enroute to emoncms.</p>
<p>So please consider MQTT-SN in the design process for MQTT going forward.&nbsp;</p>
<p>In terms of emoncms&nbsp;export of MQTT, I agree with the conversation above especially if done at the input processing level. For emoncms&nbsp;import....</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24674"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 20/10/2014 - 14:15.</div>
    <div class="content">
     <p>Hi Jason, the more hands on deck the better.</p>
<blockquote><p><em>So please consider MQTT-SN in the design process for MQTT going forward.&nbsp;</em></p>
</blockquote>
<p>I&#39;ve just read a bit about MQTT-SN&nbsp;and it looks quite promising, As you know we currently use&nbsp;JeeLib from JeeLabs. To that we have recently added a layer of data formatting to accommodate&nbsp;a wide range of data types. it&#39;s quite new and not yet fully embraced/utilised, plus the RFM69CW&nbsp;is on the horizon which offers better range and&nbsp;RSSI data when in RFM12 compatability mode, and can also bring&nbsp;encryption etc to the party if not in compatibility mode. Combined with MQTT-SN the existing RF network may be due considerable change in the coming months.</p>
<p>emonHub is indeed like a gateway, it&#39;s purpose is to interface with&nbsp;&quot;things&quot; and package the data into emonCMS friendly packets. it&#39;s main interface currently is the RFM2Pi&nbsp;as that is the predominant OEM method but as more exotic things happen, especially with all the IO we have with arduino&#39;s and raspberrypi&#39;s. emonHub will hopefully provide easy means to hook &quot;things&quot; up to. Possibly even taking a more modular form so custom&nbsp;&quot;interfacers&quot; can be just dropped into a folder much like emonCMS modules do now.</p>
<p>I&nbsp;believe the first 2 things that are needed are A) emonHub&nbsp;MQTT reporter this makes most of the existing data that is currently being reported successfully&nbsp;to emonCMS, available to any MQTT&nbsp;system eg openHAB and Node-Red. And B) Create the &quot;MQTT process&quot; in emonCMS so that the calculated feed value not available from emonHub&nbsp;are also published. This would allow users to expand into MQTT and try openHAB and node-red.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24679"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3651.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3651.png" alt="nubble&#039;s picture" title="nubble&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3651.html" title="View user profile.">nubble</a> on Mon, 20/10/2014 - 19:24.</div>
    <div class="content">
     <p>I forked the emonhub repo and would like to collaborate on the MQTT reporter feature&nbsp;once i figure out the &#39;architecture&#39; of emonhub.&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24680"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Mon, 20/10/2014 - 19:52.</div>
    <div class="content">
     <p>I must admit I have no experience with MQTT-SN, however I would possibly argue that for something like the emonHub it is probably not necessary and standard MQTT&nbsp;is a better fit. From what I understand MQTT-SN is relatively new compared to standard MQTT, and using it might restrict the type of brokers that would be easily supported&nbsp;out-of-the-box. Also,&nbsp;this code is going to live on mains powered nodes with ethernet connectivity - i.e. the hub - so there is no need I can see for using the even-lower overhead of MQTT-SN. The SN variant is great for battery powered sensor nodes but in this case all our sensor nodes will be transmitting RF packets (as currently) and the gateway/hub will be responsible for translating those into MQTT messages.</p>
<p>My initial thoughts for the order of &#39;things&#39; required is;</p>
<p>1. Add MQTT&nbsp;&#39;subscribing&#39; to emonCMS&nbsp;- so that you can send readings directly to emonCMS using MQTT (this can be synthesised currently by using mqttwarn/nodered)</p>
<p>2. Add MQTT &#39;publishing&#39; to emonHUB&nbsp;- this turns the emonHUB into an MQTT gateway - receiving standard RF packets from emonTX and emonTH nodes and converting them to MQTT messages which emonCMS (1) can subscribe to</p>
<p>3. Add MQTT&nbsp;&#39;publishing&#39; to emonCMS for calculated feed data - I like your idea Paul of simply adding a &#39;publish to mqtt&#39; process. That is nice and clean and fits in nicely with the existing framework.&nbsp;</p>
<p>This would give us the following;&nbsp;</p>
<p>1. Any system can &#39;listen&#39; in to the raw data being generated by our emonTX and emonTH nodes by subscribing to the topics being published by emonHUB. This means you could run the system with no emonCMS and still have access to all the data in raw form.</p>
<p>2. Any system can &#39;listen&#39; in to the processed feed data calculated and published by emonCMS.&nbsp;</p>
<p>&nbsp;</p>
<p>I don&#39;t think we need to be changing the way emonTX and emonTH&nbsp;nodes report their readings back to the emonHUB. The current proprietary RF transmission protocol is fine and the most efficient. It is only once we get onto an&nbsp;IP network do we need to think about using MQTT, IMHO.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24682"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 20/10/2014 - 20:44.</div>
    <div class="content">
     <p>@Jason - Fantastic, When&nbsp;I get a chance in the next few days I will create a MQTT&nbsp;branch with the shell of a new reporter in  place with some notes to start things off.</p>
<p>@Ben - I tend to agree with your points about MQTT-SN&nbsp;however&nbsp;I&#39;m no&nbsp;authority on MQTT&nbsp;and wouldn&#39;t&nbsp;rule out some future implementation. But for now we would certainly need&nbsp;to stick&nbsp;with existing technology and maybe further down the line&nbsp;add an alternative rfm2pi&nbsp;MQTT interfacer if the need/demand was there.</p>
<p>I would normally agree with your &quot;order of &#39;things&#39; required&quot; it seems a logical order, however in practice as &quot;1,&quot; is probably the most difficult so may take the most time especially with limited PHP skills. As you point out getting data into emonCMS&nbsp;from MQTT is currently possible (in-directly) so I&#39;m inclined to tackle the publishing 1st. but I guess&nbsp;there&#39;s no reason they can&#39;t be done together if Trystan&#39;s keen.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24693"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 21/10/2014 - 10:51.</div>
    <div class="content">
     <p>So I have created a MQTT branch and started a MQTT reporter, it&#39;s basically just a shell with some TODO notes.</p>
<p><a href="https://github.com/emonhub/emonhub/commit/fe2e00bc39ac1f14851f8d0f3311d5756c1a7826">https://github.com/emonhub/emonhub/commit/fe2e00bc39ac1f14851f8d0f3311d5756c1a7826</a></p>
<p>​The current big question is what to do with regard to non-current data ? the norm is to buffer all data and then forward that data (FIFO) as and when a connection is established, once receipt is confirmed that &quot;batch&quot; of data is deleted from the buffer.&nbsp;will acks&nbsp;and/or batch sending&nbsp;be possible/plausible ?&nbsp;</p>
<p>In another discussion (about the events module I think) it was generally agreed there was no reason to send the time but this may be true for openHab if only receiving&nbsp;&quot;current state&quot; data but emonCMS&nbsp;wants historic and missed data. Initially there appears to be 2 main&nbsp;approaches&nbsp;to this A) always include the timestamp and let the recipient&nbsp;sort it out B) Sort and format data within emonhub&nbsp;and&nbsp;blindly publish new data with no timestamp as a &quot;current state&quot; topic and also buffer/publish timestamped&nbsp;data in a way that can be confirmed ok for deletion (if it&#39;s&nbsp;possible).</p>
<p>When emonCMS is installed locally &quot;current state&quot; data should be sufficient as there should be no break in the communication therefore no missing data to buffer. However if multiple hubs are used or emoncms is network connected there is a real chance of interruptions in connectivity.&nbsp;</p>
<p>On a positive note, I think the topics&nbsp;can be dynamically assigned using the [nodes] section of the configuration file. Since the incoming data elements will be in a fixed&nbsp;order, the topic element &nbsp;names can be defined using a csv string, as can the nodes name. The node ID and &quot;input&quot; number can be used by default if no node data is defined.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24698"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 21/10/2014 - 17:47.</div>
    <div class="content">
     <p>Great discussion, I think Im following, Id be happy to try the first item:</p>
<p><em>&quot;1) Add MQTT&nbsp;&#39;subscribing&#39; to emonCMS&nbsp;- so that you can send readings directly to emonCMS using MQTT&quot;.</em></p>
<p>If we where to follow the current api design for inputs, it could look like this:</p>
<p><strong>topic:</strong> emoncms/input</p>
<p>{<br />
&nbsp;&nbsp;&nbsp; &quot;apikey&quot;: KEY,<br />
&nbsp;&nbsp;&nbsp; &quot;node&quot;: 10,<br />
&nbsp;&nbsp;&nbsp; &quot;time&quot;: UNIXTIMESTAMP,<br />
&nbsp;&nbsp;&nbsp; &quot;csv&quot;: [3120, 1200, 24.5, 22.3]<br />
}</p>
<p>Or following your suggestion Ben here, perhaps? <a href="5826.html" title="http://openenergymonitor.org/emon/node/5826">http://openenergymonitor.org/emon/node/5826</a></p>
<p>emoncms/input/10/1&nbsp;&nbsp;&nbsp; 3120<br />
emoncms/input/10/2 &nbsp;&nbsp; 1200<br />
emoncms/input/10/3 &nbsp;&nbsp; 24.5<br />
emoncms/input/10/4 &nbsp;&nbsp; 22.3<span class="rangySelectionBoundary" id="selectionBoundary_1413913207020_6991782020001607" style="display:none; line-height:0">﻿</span><span class="rangySelectionBoundary" id="selectionBoundary_1413913207019_1887231542408374" style="display:none; line-height:0">﻿</span></p>
<p>where emoncms/input/<strong>nodeid</strong>/<strong>variableid</strong></p>
<p>or both?</p>
<p>I guess we would need two topics one for updating an input and the other for listening to an input? perhaps:</p>
<p>emoncms/input/post/10/1<br />
emoncms/input/get/10/1</p>
<p>Does anyone know if it&#39;s possible to allow any client to publish to a topic but only allow an authenticated subscriber (emoncms) to subscribe to it?</p>
<p>I have almost written a script to do this already in an older attempt to bring mqtt into emoncms which shouldn&#39;t take long to modify: <a href="https://github.com/emoncms/emoncms/blob/mqtt/run/nodeprocessor.php" title="https://github.com/emoncms/emoncms/blob/mqtt/run/nodeprocessor.php">https://github.com/emoncms/emoncms/blob/mqtt/run/nodeprocessor.php</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24699"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 21/10/2014 - 18:26.</div>
    <div class="content">
     <p>Ok here&#39;s an initial script implementing the first option: <a href="https://github.com/emoncms/emoncms/commit/33a87d76b1f4d22b6a55a7cf41d9355be5cd168e" title="https://github.com/emoncms/emoncms/commit/33a87d76b1f4d22b6a55a7cf41d9355be5cd168e">https://github.com/emoncms/emoncms/commit/33a87d76b1f4d22b6a55a7cf41d935...</a></p>
<p>it can be run with: $ sudo php mqtt_input.php</p>
<p>and to test it I ran this mini publisher script:</p>
<p>&lt;?php</p>
<p>&nbsp; error_reporting(E_ALL ^ (E_NOTICE | E_WARNING));<br />
&nbsp;<br />
&nbsp; require(&#39;SAM/php_sam.php&#39;);<br />
&nbsp;<br />
&nbsp; $conn = new SAMConnection();<br />
&nbsp; $conn-&gt;connect(SAM_MQTT, array(SAM_HOST =&gt; &#39;127.0.0.1&#39;, SAM_PORT =&gt; 1883));<br />
&nbsp;<br />
&nbsp; $m = array(<br />
&nbsp;&nbsp;&nbsp; &#39;time&#39;=&gt;time(),<br />
&nbsp;&nbsp;&nbsp; &#39;node&#39;=&gt;10,<br />
&nbsp;&nbsp;&nbsp; &#39;csv&#39;=&gt;array(200,300,400)<br />
&nbsp; );<br />
&nbsp;<br />
&nbsp; $msg = new SAMMessage(json_encode($m));<br />
&nbsp; $conn-&gt;send(&#39;topic://emoncms/input&#39;, $msg);</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24700"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 21/10/2014 - 18:28.</div>
    <div class="content">
     <p>Trystan - <a href="5943.html#comment-24643">earlier in this&nbsp;thread</a> you mentioned that you were intending to write&nbsp;a blog page re&nbsp;the process to switch&nbsp;from the &#39;emoncms&#39; Raspberry Pi module to&nbsp;&#39;emonhub&#39;.<br />
You may wish to hold back on that, as Paul B has developed a script which automates the whole process, and which will be documented in due course.</p>
<p>I&#39;ve been the guinea pig, and it ran faultlessly, stopping the service, removing the raspberry pi module and installing emonhub, all from one command, and now I have emonhub&nbsp;successfully running on my Git installed v8.3.6&nbsp;</p>
<p>Very slick &amp; totally painless!</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24701"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Tue, 21/10/2014 - 19:16.</div>
    <div class="content">
     <p>Great stuff Trystan. I think the better approach would be a separate topic for each value, this makes it a lot easier for other systems to monitor these topics and pull out the data if required - i.e. openHAB or Node-Red.</p>
<p>Configuration wise you would just need to tell EmonCMS&nbsp;what base-topic to subscribe to, i.e. in your example &#39;emoncms/input/&#39; and then it would expect topics of the form &#39;base-topic/nodeid/variableid&#39;. Does the variable id have to be an int? Or could it be a string? It would be nice if we could have descriptive names for nodes and variables but I assume the EmonCMS code is written assuming they are ints?</p>
<p>This would mean you only have to setup the MQTT listening topic once and adding additional nodes would be automatically picked up by EmonCMS.</p>
<p>FYI - to subscribe to this topic you would use&nbsp;&#39;base-topic/+/+&#39;. &#39;+&#39; is a&nbsp;single level placeholder. The alternative is &#39;base-topic/#&#39; where &#39;#&#39; is a multi-level wildcard and will match to anything under base-topic. But I don&#39;t think we want this in case there is other data being published under these topics for example. &#39;base-topic/+/+&#39; restricts to just those two levels.</p>
<p>Also, in answer to your question about authentication, this is broker dependent, but mosquitto (which I use) has good support for both authentication and ACL lists. So you can setup multiple users and enforce authentication when connecting, and then for each user define which topics they can read or write to. I use this a lot since my entire home automation system runs on MQTT and I don&#39;t want the irrigation controller to be able to disarm the alarm!</p>
<p>As for the outgoing messages, are you thinking you dump all feed values to MQTT topics always? I think I prefer Paul&#39;s idea of adding a &#39;Publish MQTT&#39; input process so you can optionally add this to any of your feeds, at any point in the calculation chain. Setting up this process would require specifying a topic so would negate the need for any derived topic names like we are doing for the input side of things.</p>
<p>It would be good to have a single place to setup the broker connection and authentication details for EmonCMS and then all these parts of the system could use the same details - i.e. input, feed processing and the event module.</p>
<p>Exciting times - think this will be a great addition to this already fantastic bit of software!&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24714"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 22/10/2014 - 09:40.</div>
    <div class="content">
     <p>Still trying to get to grips with fully comprehending the concept of MQTT, having read a couple of articles about naming strategies&nbsp;including one by <a href="http://harizanov.com/2014/09/mqtt-topic-tree-structure-improvements/">Martin Harizanov</a> I&#39;m inclined to agree with Ben&#39;s suggestion of having value level topics, It is quite possible for&nbsp;emonHub to assign the names and emonCMS can already accept string variable ids, the node id&#39;s currently need to be numeric, but the&nbsp;default numeric variable ids are automatically assigned by emoncms to &quot;unlabeled&quot; input variables</p>
<blockquote><p><strong>http://emoncms.org/input/post.json?node=10&amp;json={power:200}</strong></p>
</blockquote>
<p>Would update or create input id &quot;power&quot; for node 10 and&nbsp;</p>
<blockquote><p><strong>http://emoncms.org/input/post.json?node=10&amp;json={200}</strong></p>
</blockquote>
<p>will update or create input id &quot;1&quot; for node 10. The only reason emonHub isn&#39;t currently configured to use strings is that the bulk&nbsp;input&nbsp;doesn&#39;t accept strings and we currently only work with complete payloads of data so sending the string names is just extra&nbsp;baggage.</p>
<p>So we can currently have /nodeid/value_name with very little change but it would be much better if emoncms could accept a string node&nbsp;id.</p>
<p>Since emoncms is the main &quot;collector of data&quot; for monitoring would it be of benefit to make the &quot;home&quot; or the &quot;complete MQTT network&quot;&nbsp;the base-topic and use the wildcards to subscribe to but not save 2 or 3 levels to create a short list of all available topics.&nbsp;that can be selected or enabled by each node level topic to appear in the inputs page?</p>
<p>@ Paul &amp; Trystan - I think a post/blog explaining why and how to make the change to emonHub would still be a good idea and coming from&nbsp;Trystan rather than me would highlight the OEM seal of approval in case other users have similar reservations.&nbsp;</p>
<p><a href="https://github.com/emonhub/dev-emonhub/blob/master/README.md">https://github.com/emonhub/dev-emonhub/blob/master/README.md</a></p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24716"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Wed, 22/10/2014 - 10:05.</div>
    <div class="content">
     <blockquote><p>Since emoncms is the main &quot;collector of data&quot; for monitoring would it be of benefit to make the &quot;home&quot; or the &quot;complete MQTT network&quot;&nbsp;the base-topic and use the wildcards to subscribe to but not save 2 or 3 levels to create a short list of all available topics.&nbsp;that can be selected or enabled by each node level topic to appear in the inputs page?</p>
</blockquote>
<p>Not quite sure what you mean here sorry Paul. I don&#39;t think we want&nbsp;emonCMS to monitor ALL MQTT topics, i.e. &#39;#&#39;. Is that what you meant by &#39;complete MQTT network&#39;. In&nbsp;my case my MQTT broker has all sorts of data flying around in various topic hierarchies, including irrigation controllers&nbsp;/irrigation/vege&nbsp;and /irrigation/lawn, and security controllers /security/alarm/armed, /security/alarm/fire, etc etc.&nbsp;</p>
<p>You definitely want to restrict emonCMS to a subset of the topic tree I think. What this what you meant in your statement above? Sorry if I have gotten a little confused!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24719"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 22/10/2014 - 13:32.</div>
    <div class="content">
     <blockquote><p>You definitely want to restrict emonCMS to a subset of the topic tree I think.&nbsp;</p>
</blockquote>
<p>I agree we don&#39;t want every topic on the MQTT&nbsp;network&nbsp;to show up on the inputs page, however by using a &quot;emoncms&quot; subset you are restricting your self to monitoring just those topics. Using your own examples,&nbsp;if you were to decide further down the line that you wanted to monitor water usage and wanted emonCMS to monitor /irrigation/vege and /irrigation/lawn, you would need to rename/restructure your topics. likewise if you wanted to remove&nbsp;topics from the&nbsp;emonCMS inputs page.</p>
<p>One alternative would be to force the user to specify each topic which is not user friendly and would involve a lot of setup/configuration pages or files. My suggestion above was to have a emonCMS page that when opened it subscribes to /home/+/+ (or /network/+/+/+ etc) and shows a list of topics (no data values) which the user can then select or deselect the topics he wants to show in the emonCMS inputs page. When that &quot;list&quot; page is closed emonCMS&nbsp;no longer subscribes to /home/+/+ but instead just to the topics chosen.</p>
<p>What I&#39;m trying to describe reminds me a&nbsp;lot of the &quot;windows network printer tool&quot; if you ever used that. not every printer on the network is short listed when you want to print, but if you click &quot;find printers&quot; it will list every printer on the network by network name and you can then add any of them&nbsp;to your printer short list.</p>
<p>I&#39;m guessing this is where node-red comes in handy, I assume you would just have the one&nbsp;&quot;emoncms&quot; topic for emoncms to subscribe to&nbsp;and you route any topics you want to monitor into that. Which is almost what we would be doing by having a emonCMS subset, instead of each node having it&#39;s &quot;own&quot; topic it is in fact subscribing to&nbsp;<span style="line-height:20.7999992370605px">the&nbsp;</span>emoncms<span style="line-height:20.7999992370605px">&nbsp;topic albeit on&nbsp;</span><span style="line-height:1.6">it&#39;s own sub-topic.</span></p>
<p><span style="line-height:1.6">I could just see a situation where everything is put on the emoncms topic to make it available to monitor which will A) make the input page very messy and B) render the need for /home/emoncms&nbsp;subset&nbsp;unnecessary&nbsp;as all of /home is in /home/emonCMS too.</span></p>
<p><span style="line-height:1.6">This is the main reason I expected implementing&nbsp;the &quot;emonCMS&nbsp;subscribing&quot; to be the more difficult part as I knew it would not be ideal to subscribe to lots of individual topics, but hoped there would be something more flexible and intuitive than&nbsp;having&nbsp;all sensors to be monitored&nbsp;subscribing to the&nbsp;emoncms&nbsp;topic&nbsp;and those that are not (presently) monitored by&nbsp;emoncms&nbsp;on other&nbsp;topics.</span></p>
<p><span style="line-height:20.7999992370605px">I hope that&#39;s&nbsp;</span><span style="line-height:20.7999992370605px">a&nbsp;</span><span style="line-height:20.7999992370605px">little</span><span style="line-height:20.7999992370605px">&nbsp;clearer (</span><span style="line-height:20.7999992370605px">probably</span><span style="line-height:20.7999992370605px">&nbsp;not!) it sounds far more&nbsp;</span><span style="line-height:20.7999992370605px">complicated</span><span style="line-height:20.7999992370605px">&nbsp;than it I imagine it would actually be.</span></p>
<p><span style="line-height:1.6">Paul&nbsp;</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24759"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Thu, 23/10/2014 - 19:32.</div>
    <div class="content">
     <p>Hey Paul,</p>
<p>I think I follow what you are saying. And I take on board what you are trying to say with regard to making it nice and easy to setup/configure. My view would be that anything that is publishing to&nbsp;MQTT&nbsp;will typically be configurable - i.e. you will be able to specify what topics to publish to. And as you mentioned if there is something publishing to a non-emonCMS topic there are quite a few ways to *forward* messages from one topic to another - nodered and mqttwarn are two examples.</p>
<p>With that in mind, I think it would make life a lot easier in emonCMS if we just state that you must specify the *root* emonCMS&nbsp;topic - e.g. /home/emoncms/inputs - and all inputs are expected to appear here, in a known format - e.g. /home/emoncms/inputs/emontx1/grid, /home/emoncms/inputs/emontx1/solar, /home/emoncms/inputs/emonth1/temperature etc.</p>
<p>I.e. &lt;base topic&gt;/&lt;node&gt;/&lt;input&gt;. The input page can then be nicely formatted with human readable labels and names right from the get-go.</p>
<p>This is how other MQTT enabled systems have been designed (in my experience). They define a topic structure and anything publishing must adhere to that structure.&nbsp;</p>
<p>I would be wary of trying to make emonCMS *too smart* in terms of allowing all sorts of different topic structures. My feeling is we would be better off enforcing some relatively strict topic formats and making life a lot easier for emonCMS.</p>
<p>Anyone else got a view on this?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24765"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 24/10/2014 - 10:19.</div>
    <div class="content">
     <p>I&#39;ve done a little more experimenting, created a development branch called mqttdev:<br />
<a href="https://github.com/emoncms/emoncms/tree/mqttdev" title="https://github.com/emoncms/emoncms/tree/mqttdev">https://github.com/emoncms/emoncms/tree/mqttdev</a></p>
<p>This script here will read several different topic types:<br />
<a href="https://github.com/emoncms/emoncms/blob/mqttdev/scripts/phpmqtt_input_all.php" title="https://github.com/emoncms/emoncms/blob/mqttdev/scripts/phpmqtt_input_all.php">https://github.com/emoncms/emoncms/blob/mqttdev/scripts/phpmqtt_input_al...</a></p>
<p><strong>Full json:</strong><br />
<em>emoncms/input {&quot;apikey&quot;: APIKEY, &quot;time&quot;: UNIXTIMESTAMP, &quot;node&quot;: 10, &quot;data&quot;:[100,200,300]}</em></p>
<p><strong>CSV values to a specified node:</strong><br />
<em>emoncms/input/10 100,200,300</em></p>
<p><strong>value to a specified nodeid/input:</strong><br />
<em>emoncms/input/10/1 100<br />
emoncms/input/10/power 250</em></p>
<p>Theres a tester scipt here:<br />
<a href="https://github.com/emoncms/emoncms/blob/mqttdev/scripts/examples/mqtt_input_publisher_all.php" title="https://github.com/emoncms/emoncms/blob/mqttdev/scripts/examples/mqtt_input_publisher_all.php">https://github.com/emoncms/emoncms/blob/mqttdev/scripts/examples/mqtt_in...</a></p>
<p>The problem at the moment with the topics:<br />
<em>emoncms/input/10 100,200,300<br />
emoncms/input/10/1 100<br />
emoncms/input/10/power 250</em></p>
<p>Is that you have to set the userid in the script. Perhaps the userid could be another part of the topic string? or the apikey could be put in the topic string?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24775"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 24/10/2014 - 14:52.</div>
    <div class="content">
     <p>Hi Ben<br />
I totally agree one topic for all emoncms inputs is much easier, I just didn&#39;t think it was as&nbsp;intuitive or flexible. I&#39;ve thought about this some&nbsp;more and looked at various topic tree&#39;s and think there maybe another way, that is very simple as well as more intuitive.</p>
<p>In his blog <a href="http://harizanov.com/2014/09/mqtt-topic-tree-structure-improvements/">Martin Harizanov&#39;s</a> tree includes a natural order of node/sensor&nbsp;hierarchy and within each sensor or node he recommends splitting the inputs and outputs which made perfect sense when I read it, as does the idea of a single topic for emoncms to subscribe to. So since learning the topic wildcards can&nbsp;be used at any point in a topic&#39;s string/path, emoncms could subscribe to something like /#/input/ or if that&#39;s too generic we could use &quot;emoncms&quot; instead of &quot;input&quot;. in effect &quot;input&quot; or &quot;emoncms&quot; becomes a &quot;send to emoncms&quot; switch at the tail of the nodes topic tree.</p>
<p>This would also work very well for control signals going the other way, the sensors &quot;output&quot; topic meaning &quot;emonhub&quot; or &quot;rfm2pi&quot; etc, that emonhub can subscribe to and broadcast the controls.</p>
<p>Go to see you&#39;ve got something up and running Trystan, I&#39;ll have to read up on paho so that we can implement something and experiment&nbsp;passing some data from emonhub to emoncms.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24779"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Fri, 24/10/2014 - 21:04.</div>
    <div class="content">
     <p>@Paul - yep I think we should allow any type of topic structure, and using wildcards&nbsp;as you suggest makes a lot of sense. But this should all still be achievable by having a single topic for emonCMS to subscribe to - i.e. the base topic. Whether that base topic has wildcards or not is up to the user. For the case of a single emonTX&nbsp;if might just be /home/emoncms/inputs/+/+, but if you had a number of emonTX nodes and some emonTHs, then it might be /home/energy/+/+&nbsp;where each node is publishing to /home/energy/emontx1/+, /home/energy/emontx2/+, /home/energy/emonth1/+&nbsp;etc. The conceptual&nbsp;difference between these two is that the first treats the topic as being &#39;owned&#39; by emonCMS, the second the topics are &#39;owned&#39; by the nodes. Either way emonCMS will always look at the last two parts of the topic string and use them for&nbsp;the nodeid and inputid.&nbsp;</p>
<p>@Trystan - good point re. the user/api id. Didn&#39;t think of this in terms of a multi-user environment. The question is whether you intend to host an MQTT broker for users to use with the hosted emonCMS service? Or whether each user will need to run their own broker and configure emonCMS&nbsp;with the MQTT connection properties, including base topic.&nbsp;Assuming it is the later, then all the MQTT&nbsp;properties would be stored against a user so we could infer the userid/apikey&nbsp;directly in code - rather than have to include it in the topic/payload. If a few users decided to share a broker then it would be up to them to ensure they used unique topics, by perhaps including their userid in the topic string,&nbsp;but this would all be supported out of the box since each user would have a different base topic.</p>
<p>I just think we want to try and decouple the topic string from being too emonCMS specific if possible - as this will restrict 3rd party applications from being able to easily use the data. Hence the desire for simple value only publishing, and a generic base topic where possible.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24780"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Fri, 24/10/2014 - 21:15.</div>
    <div class="content">
     <p>@Paul - BTW I have read that great article about MQTT topic structures. I have based quite a lot of my topics on his ideas.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24781"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 24/10/2014 - 21:52.</div>
    <div class="content">
     <p><em>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#39;I just think we want to try and decouple the topic string from being too emonCMS specific if possible - as this will restrict 3rd party applications from being able to easily use the data. Hence the desire for simple value only publishing, and a generic base topic where possible.&#39;</em></p>
<p>My thoughts too Ben, to start including apikey, ect in the topic/payload&nbsp;will cause needless longer term issues.<br />
I was anticipating that the userid/apikey would be processed&nbsp;within emonhub?<br />
&#39;Simple value only&#39; publishing gets my vote.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24894"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 31/10/2014 - 11:14.</div>
    <div class="content">
     <p>Looking at this again this morning, making the base topic configurable and looking into what would be required to make it possible to use text names for nodeid&#39;s, so that we can subscribe to say (as your suggesting?):</p>
<p>home/energy/kitchen/cooker</p>
<p>where &quot;home/energy/#&quot; is the base topic.</p>
<p>Would it make sense to make the emoncms mqtt input listener able to subscribe to multiple basetopics?</p>
<p>Also working on creating an input processor for publishing to a MQTT topic.</p>
<p>It would I think be interesting to look at how flukso are doing this, I know Bart has put a lot of thought into all this and remember listening to a presentation from him about it: <a href="http://www.flukso.net/files/presentations/flukso.20121026.architecture.pdf" title="http://www.flukso.net/files/presentations/flukso.20121026.architecture.pdf">http://www.flukso.net/files/presentations/flukso.20121026.architecture.pdf</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24895"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 31/10/2014 - 12:56.</div>
    <div class="content">
     <p>Ok there&#39;s now a Publish to MQTT input processor, an input subscriber with a configurable base topic, and its possible to use text node names, all in the mqtt dev branch here: <a href="https://github.com/emoncms/emoncms/compare/mqttdev" title="https://github.com/emoncms/emoncms/compare/mqttdev">https://github.com/emoncms/emoncms/compare/mqttdev</a></p>
<p>&nbsp;&nbsp;&nbsp; emoncms/input/10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 100,200,300<br />
&nbsp;&nbsp;&nbsp; emoncms/input/10/1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 100<br />
&nbsp;&nbsp;&nbsp; emoncms/input/10/power&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 250<br />
&nbsp;&nbsp;&nbsp; emoncms/input/house/power&nbsp;&nbsp; 2500</p>
<p>or</p>
<p>&nbsp;&nbsp;&nbsp; home/energy/kitchen/cooker 3100</p>
<p>The MQTT topic and sub topic are set in the settings at the top of the phpmqtt_input.php script:</p>
<p>&nbsp;&nbsp;&nbsp; $mqttsettings = array(<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;userid&#39; =&gt; 12,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;basetopic&#39; =&gt; &quot;emoncms&quot;,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;basetopic_sub&#39; =&gt; &quot;input&quot;<br />
&nbsp;&nbsp;&nbsp; );</p>
<p>Screenshot of the Publish to MQTT input processor:</p>
<p><img alt="" src="../sites/default/files/pubtomqtt.png" style="height:176px; width:600px" /></p>
<p>You have to be careful not to create circular references here... as its easily possible to publish to the same input that the Publish to MQTT input processor is connected too...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Fri, 31/10/2014 - 19:30.</div>
    <div class="content">
     <p>Great stuff Trystan. One question, if you allow a /# wildcard in the base topic how do you know which parts of the topic name are the node/input ids? Are you just assuming it is the last two tokens in the topic name?</p>
<p>i.e. base topic of /home/energy/#, a message on /home/energy/kitchen/cooker would go to node &#39;kitchen&#39;, input &#39;cooker&#39;. What about /home/energy/kitchen/pantry/microwave?&nbsp;</p>
<p>I am not 100% sold either way, but I tend to think we are well within our rights to enforce some sort of sub-topic naming convention in order for emonCMS to handle messages, rather than just try and handle anything and everything that is thrown at it!</p>
<p>One idea I had was to just have a simple&nbsp;base topic configured as &#39;/home/energy&#39; in the emonCMS config file. emonCMS&nbsp;would then&nbsp;subscribe to /home/energy/+/+ and treat the first wildcard as nodeid, the second as&nbsp;input id. This makes it a bit easier to control what topics are being monitored rather than allowing /# wildcards. This would have to be well documented but I think is more in line with how the RF publishing tends to work, logically at least.</p>
<p>This would stop messages on /home/energy/+ and /home/energy/+/+/+ getting picked up by emonCMS which is quite likely if you look at the topic design blog by Martin - you can have data at any point in a topic tree.</p>
<p>I think it is probably a good idea to support multiple base topics, as you suggested. That way you can have data coming from multiple devices, publishing to their own topic trees, as long as they adhere to the &lt;basetopic&gt;/&lt;nodeid&gt;/&lt;inputid&gt; format.</p>
<p>Happy to discuss over email if you would prefer Trystan? PM me your email address if so.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24924"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sun, 02/11/2014 - 22:14.</div>
    <div class="content">
     <p>I got around to subscribing to the mqttdev branch this evening, but whenever I add a &#39;Publish to MQTT&#39; function in an input process, not only does it not work, but it stops all other inputs from being logged to feeds.</p>
<p>A check of the&nbsp;emonhub&nbsp;log shows;</p>
<p>2014-11-02 22:07:12,244 WARNING Send failure: wanted &#39;ok&#39; but got &lt;br /&gt;<br />
&lt;b&gt;Fatal error&lt;/b&gt;: &nbsp;Call to a member function connect() on a non-object in &lt;b&gt;/var/www/emoncms/Modules/input/process_model.php&lt;/b&gt; on line &lt;b&gt;644&lt;/b&gt;&lt;br /&gt;</p>
<p>&nbsp;</p>
<p>Paul</p>
<p>v8.3.6 mqttdev branch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24978"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 05/11/2014 - 09:00.</div>
    <div class="content">
     <p>Is anyone else finding the same issue?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24980"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 05/11/2014 - 10:48.</div>
    <div class="content">
     <p>Hello Paul, you may need to add a $mqtt_enabled = true; to your settings.php file. I&#39;ve also just added a fix to process_model.php that should get rid of the error.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24991"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 05/11/2014 - 20:24.</div>
    <div class="content">
     <p>Yes, that&#39;s <s>much better,</s> brilliant!&nbsp;now if I add a &#39;publish to mqtt&#39; function to an &#39;input process&#39; it works great, and I am now&nbsp;able to pick up the mqtt feeds in node-red which opens up the gateway to&nbsp;lots of interesting possibilities...<br />
...for example, it took less than 5 minutes to create a NR flow to send a push alert if a feed isn&#39;t updated within a certain time period.&nbsp;(Notify module alternative).</p>
<p>However, the reverse does not work for me, and if I set up a publish to mqtt node in node-red, such as&nbsp;emoncms/input/12/1&nbsp;or&nbsp;emoncms/input/house/power and send some values, they do&nbsp;not appear in my emoncms input list. Whilst the same&nbsp;named topic/subtopics in a node-red mqtt <u>listener</u> node does pick up the values.</p>
<p>I notice that you have a &#39;userid&#39; item in&nbsp;phpmqtt_input.php script, but unsure what this is (and if it&#39;s the reason why the emoncms mqtt input function is not working for me?).</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24999"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1958.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1958.png" alt="fluppie007&#039;s picture" title="fluppie007&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/1958.html" title="View user profile.">fluppie007</a> on Thu, 06/11/2014 - 11:52.</div>
    <div class="content">
     <p>Cool, going to try this out this weekend! Can I send MQTT messages (from a Flukso-meter)&nbsp;to emonhub?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25004"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 06/11/2014 - 18:58.</div>
    <div class="content">
     <p>Hello Paul, may well be the userid, perhaps try setting it to 1 if there is only the one user on your system?</p>
<p>Alternatively you can get your user id with:</p>
<p>localhost/emoncms/user/get.json</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25005"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Thu, 06/11/2014 - 20:36.</div>
    <div class="content">
     <p>Hi Trystan, I have tried changing the userid&nbsp;to &quot;1&quot; but unfortunately emoncms still does not subscribe to topics in the suggested format. (Does it make any difference that account No 1 is the admin account??)</p>
<p>I have checked my user ID (MYSQL table shows just one entry and ID of &quot;1&quot;)</p>
<p>No errors are evident using my browser developer&nbsp;console, and nothing showing in emonhub log either...</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25015"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 07/11/2014 - 16:13.</div>
    <div class="content">
     <p>Philippe, in answer to your question - quite possibly!</p>
<p>Reading the Flukso&nbsp;blog, I cant determine if the topic &amp; subtopic is hardcoded&nbsp;by the FLM in a set format. If that is so, you would need to edit the emoncms&nbsp;&#39;phpmqtt_input.php&#39;&nbsp;file to ensure that the topics/subtopics are the same.</p>
<p>However, as you will see from my post above, I&#39;m not having much luck at the moment getting emoncms to subscribe to topics, so it&#39;ll be interesting to hear how you get on.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25018"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/11/2014 - 18:01.</div>
    <div class="content">
     <p>Hello Paul, I think I found what I did wrong, in adding the publish to MQTT i broke the input reader. Should work ok now, <a href="https://github.com/emoncms/emoncms/commit/56c2062e69031e61ba87158de35534f56b32a0ef" title="https://github.com/emoncms/emoncms/commit/56c2062e69031e61ba87158de35534f56b32a0ef">https://github.com/emoncms/emoncms/commit/56c2062e69031e61ba87158de35534...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25022"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 07/11/2014 - 21:07.</div>
    <div class="content">
     <p>Sorry, it&#39;s reporting OK but&nbsp;still not subscribing.</p>
<ul>
<li>I&#39;ve pulled the latest mqttdev&nbsp;git</li>
<li>Ensured that&nbsp;$mqtt_enabled = true; is included in&nbsp;settings.php</li>
<li>Checked that userid&nbsp;= 1 is correct&nbsp;in phpmqtt_input.php. and matches&nbsp;MYSQL userid.</li>
<li>Rebooted</li>
<li>Confirmed that node-red is reporting on topic&nbsp;emoncms/input/13/1 via mosquitto broker on 192.168.1.5:1883</li>
</ul>
<p><img alt="" src="../sites/default/files/node.jpg" style="height:225px; width:705px" /></p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25023"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/11/2014 - 21:15.</div>
    <div class="content">
     <p>Hmm, do you see anything in the terminal window when you run:</p>
<p>sudo php phpmqtt_input.php</p>
<p>what happens if you run the publisher example in the examples folder?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25024"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/11/2014 - 21:17.</div>
    <div class="content">
     <p>This is what I see in the terminal window:</p>
<pre>
$ sudo php phpmqtt_input.php
[sudo] password for trystan:
Subscribing to: emoncms/input/#
emoncms/input/5 100,200,300
emoncms/input/10/power 350.3
emoncms/input/house/power 2500
emoncms/input/house/temperature 18.2</pre><p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25026"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 07/11/2014 - 21:38.</div>
    <div class="content">
     <p>I get;</p>
<pre>
pi@raspberrypi /var/www/emoncms/scripts $ sudo php phpmqtt_input.php
PHP Warning: &nbsp;Module &#39;dio&#39; already loaded in Unknown on line 0
Subscribing to: emoncms/input/#
emoncms/input/13/1 31
set_timevalue
emoncms/input/13/1 31
emoncms/input/13/1 31
emoncms/input/13/1 31</pre><p>...which is the topic &amp; value that I am publishing, but not sure what the php warning means?</p>
<p><u><strong>Edit</strong></u></p>
<p>When I ssh &#39;$ sudo php phpmqtt_input.php&#39; -&nbsp;suddenly Node13&nbsp;popped up in the&nbsp;emoncms inputs, and data started flowing on Key 1</p>
<p>...but when I exited &#39;$ sudo php phpmqtt_input.php&#39; it stopped updating again!</p>
<p>I tried it again, and got the same result, does&nbsp;it appear&nbsp;that the phpmqtt_input.php script is not being loaded&nbsp;unless started via ssh?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25028"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/11/2014 - 22:26.</div>
    <div class="content">
     <p>How are you running it when your not logged in via ssh? Are you using screen (linux command)? There&#39;s no automatic deamon for it yet.</p>
<p>Just added the bare bones MQTT code to make Paul Burnell&#39;s MQTT Reporter publish data in the form:<br />
emoncms/input/10/1</p>
<p>The changes can be found in the pull request here:<br />
<a href="https://github.com/emonhub/emonhub/pull/126/files" title="https://github.com/emonhub/emonhub/pull/126/files">https://github.com/emonhub/emonhub/pull/126/files</a></p>
<p>There&#39;s no config or debug info yet but I&#39;ve got it running here, works nicely!</p>
<p>@Paul Burnell do you have any thoughts on the best way to create a listener in emonhub that listens on a MQTT topic say emoncms/control and then pushes the byte data posted to that topic out onto the rfm12/69 network?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25029"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 07/11/2014 - 22:36.</div>
    <div class="content">
     <p><em>How are you running it when your not logged in via ssh?</em><br />
I just presumed that the mqtt&nbsp;modules would be loaded by emoncms?</p>
<p>​Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25031"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 07/11/2014 - 22:55.</div>
    <div class="content">
     <p>I wish it where so! we will need to create a deamon/service script to run it automatically at startup. If youd like to run it without keeping a ssh window open temporarily screen is quite useful.</p>
<p>$ screen<br />
&nbsp;&nbsp;&nbsp; sudo php phpmqtt_input.php<br />
&nbsp;&nbsp;&nbsp; exit</p>
<p>exit (second exit to exit ssh)</p>
<p>then after login:</p>
<p>$ screen -r (to reattach the screen)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25032"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 07/11/2014 - 23:17.</div>
    <div class="content">
     <p>I think that it&#39;s probably time for me to take a step back and await further development...</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25046"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 08/11/2014 - 23:49.</div>
    <div class="content">
     <p>Fantastic progress guys. it&#39;s been a busy week for me so I haven&#39;t been around as much as I would of liked. but I will look closer at&nbsp;MQTT this week hopefully.</p>
<p>Since&nbsp;I now have a I&sup2;C interfacer up and running, with several circuits being polled every 5 secs, the &quot;I&sup2;C Master&quot; runs in it&#39;s own thread&nbsp;sending and receiving I&sup2;C data using queue&#39;s to link to the main interfacer thread, this should be easy to port over to the&nbsp;JeeInterfacer so that a MQTT client can run in a seperate thread and add frames to a queue for the JeeInterfacer to pick up and&nbsp;broadcast. I was planning on trying it with the &quot;packetgen mod&quot; too.</p>
<p>@Trystan, thanks for getting the ball rolling again on the reporter, I have some ideas I would like to explore for the control side in&nbsp;general, I hope to implement some basic &quot;routing&quot; at the same time to escape the &quot;report everything to all&quot; mode currently used on the&nbsp;monitoring side. In the meantime if you want to try your hand at a &quot;MQTT mod&quot; for the JeeListener I will have a go at porting the&nbsp;thread and queue changes over, how does that sound ?</p>
<p>With regard to control topics, although the actual names can be anything I believe the topics should point to the node via the hub and&nbsp;interfacer eg emoncms/control/emonhub/rfm2pi/10/relay or similar as in time emonhub(s) will be reachable via emoncms and there is the&nbsp;potential to have several hubs each with several networks (jee or other eg I&sup2;C) and routing could be tricky.<a href="https://github.com/emonhub/emonhub/issues/64">https://github.com/emonhub/emonhub/issues/64</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25116"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 14/11/2014 - 01:22.</div>
    <div class="content">
     <p>Quick update on (the not so quick)&nbsp;emonhub&nbsp;progress, I have been looking at emonhubs&nbsp;threading, queuing and routing to get&nbsp;a uniform way of routing data out via interfacers. I think it&#39;s pretty much there now so that any interfacer can be bi-directional. Hopefully I will commit something in the next couple of days.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25216"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 18/11/2014 - 12:38.</div>
    <div class="content">
     <p>Hi guys.</p>
<p>I just set up my network in my new house and my Pi is up and running. I&#39;d like to find the time to dive back into emonHub. There&#39;s been a lot of talk, at least in the issue tracker. I tried to read everything. I also read this thread. MQTT is new to me, but sounds interesting.</p>
<p>Before anything, I&#39;d like to catch up with the code but I&#39;m a bit lost with all the branches. I see an MQTT branch, alright. Which version is the default ? Master ? Is it the one used in the SD cards, and/or installed by the switch script developped by Paul ? What are &quot;development&quot; and &quot;testing&quot; ? &quot;Node rework&quot; ? &quot;Emoncms integration&quot; ?</p>
<p>Thanks for any hint.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25219"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 18/11/2014 - 13:38.</div>
    <div class="content">
     <p>Hi&nbsp;J&eacute;r&ocirc;me, good to hear from you.</p>
<p>The repo branches are in various statuses, the &quot;master&quot; was cleared (and copied to&nbsp;master-backup)&nbsp; to make room for a &quot;released&quot; debian packaged&nbsp;version, which hasn&#39;t happened so the development is effectively the current master.</p>
<p>So &quot;development&quot; (version rc1.0)&nbsp;is the one in general use and&nbsp;on the sd card and&nbsp;&quot;testing&quot; (rc1.1) is changes queued for inclusion in next version currently being tested (predominantly by me).</p>
<p>There is an &quot;MQTT&quot; branch which is just a shell for a mqtt reporter as discussed in this thread, but hasn&#39;t got that far yet. I wouldn&#39;t worry about the others the &quot;node rework&quot; was one you created at the very beginning and can now be removed, the other 2 are my experiments &quot;wunderground&quot; has a custom interfacer&nbsp;to provide weather data and &quot;emoncms_integration&quot; has some very basic&nbsp;structure to comunicate with a &quot;hub&quot; module in emoncms.​</p>
<p>I am currently trying to&nbsp;introduce&nbsp;some routing so that all interfacers are potentially bi-directional and can put&nbsp;received data on any number of emonhubs&nbsp;internal &quot;busses&quot; and independently get data from any number of &quot;busses&quot; so there can effectively&nbsp;be a &quot;send by rfm2pi&quot; bus and a &quot;publish to mqtt&quot; bus in addition to a &quot;send to emoncms&nbsp;by http&quot; bus, It&#39;s almost there just finding it difficult to find the&nbsp;time to work on it right now, so progress is slow.</p>
<p>Currently rc1.0 is on the sd card image or you can use the dev-emonhub script, for more info see <a href="5986.html">Emonhub&nbsp;installation/update</a>&nbsp;about&nbsp;scripts/versions/updates/upgrades and the sd card image&nbsp;etc</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25225"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 18/11/2014 - 14:21.</div>
    <div class="content">
     <p>OK so &quot;everyone&quot; use development, and developers use testing.</p>
<p>So the process for a developer is to clone, checkout testing, then code each new feature in a dedicated branch, send the branch to Github for integration in testing. And, likewise, if I want to add something to the MQTT branch, I derive a dev branch from there, send it to Github for integration in MQTT branch.</p>
<p>If I&#39;m absolutely confident in what I&#39;m doing, I could be tempted to commit directly in testing or MQTT, but if we are several persons on the same branch, we may run into trouble doing so.</p>
<p>I hope I get the time to get a grab of all that happened in the last months, and then have more implication in the conception/development process.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25233"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 20/11/2014 - 09:37.</div>
    <div class="content">
     <p>That&#39;s pretty much it, I&#39;ll try and bring the &quot;issues&quot; up to date with the more recent developments etc,&nbsp;it will&nbsp;be great to have you on-board&nbsp;again.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25238"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2125.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-2125.jpg" alt="elyobelyob&#039;s picture" title="elyobelyob&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/2125.html" title="View user profile.">elyobelyob</a> on Thu, 20/11/2014 - 11:13.</div>
    <div class="content">
     <p>Aha, you&#39;ve all been busy little bees. Off to install this. Thanks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25472"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 01/12/2014 - 13:23.</div>
    <div class="content">
     <p>Has any further progress been made with MQTT integration, and is it still being developed</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25505"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 02/12/2014 - 10:34.</div>
    <div class="content">
     <p>Hi Paul, I haven&#39;t been developing MQTT directly but I am trying to spend time on changing the way emonHub&nbsp;passes data internally to facilitate bi-directional interfacers&nbsp;so that&nbsp;MQTT, I&sup2;C,&nbsp;RF and serial data can all be sent out to nodes&nbsp;from&nbsp;emonHub.</p>
<p>This would then allow one or more MQTT interfacers to be set up to listen for subscribed messages and also publish them. So I&#39;m trying to do this before we invest too much time in a potentially redundant reporter and so that these core changes can be accommodated&nbsp;in the interfacer design from the beginning rather than&nbsp;adapting it later. It&#39;s still a bit rough around the edges but I do have a &quot;routing&quot; version working.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25512"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Tue, 02/12/2014 - 19:22.</div>
    <div class="content">
     <p>Sounds like a great addition Paul - look forward to having a look.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25529"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 03/12/2014 - 00:00.</div>
    <div class="content">
     <p>Cheers - I&#39;m still a bit slow on the coding front but I think the concept works well, hope to get something on github for you guys to comment on as soon as I can.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25542"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 03/12/2014 - 10:22.</div>
    <div class="content">
     <p>Thanks for the update Paul, and looking forward to trying the next version.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25557"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 03/12/2014 - 14:41.</div>
    <div class="content">
     <p>Sounds great Paul, interested to hear more about how your making it bidirectional, Im still thinking about MQTT integration but havent had much time to work on it over the last couple of weeks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25788"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 12/12/2014 - 15:00.</div>
    <div class="content">
     <p>I have at last posted a working version of the concept to the<a href="https://github.com/emonhub/emonhub/tree/experimental"> &quot;experimental&quot; branch of emonhub</a>, It is exactly that &quot;experimental&quot;, so if you try it (and I hope you do) please do not use this on live valuable data. See the <a href="https://github.com/emonhub/emonhub/issues/131">&quot;experimental&quot; issue tracker</a> for more details.&nbsp;</p>
<p>I have successfully&nbsp;passed data around from interfacer to interfacer and involved packetgen. This is still work in progress and my working I&sup2;C interfacer hasn&#39;t been ported over oor finished (ie the control side) the code should now be modular enough and the routing definable enough to make proper use of MQTT and other control methods.</p>
<p>@Tystan - I see your <a href="https://github.com/emoncms/development/tree/master/experimental/control/open_thermostat_scheduler">new heating controller</a> uses MQTT and some emonhub stuff, maybe this could be used as a forrunner to an emonhub MQTT interfacer? I will take a closer look at it with a view to creating a basic interfacer soon.</p>
<p><a href="https://github.com/emonhub/emonhub/issues/129">Dave(schism) and J&eacute;r&ocirc;me&nbsp;are back on the firm now</a> so hopefully things can move somewhat faster once their&nbsp;up&nbsp;to speed again.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25841"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 14/12/2014 - 21:51.</div>
    <div class="content">
     <p>Experimental first draft of an <a href="https://github.com/emonhub/emonhub/commit/373659e9a9856b82b4efde7299e5dc9e64f499d9">MQTT&nbsp;interfacer&nbsp;just committed</a>. It&#39;s able to pub and sub messages ok, I haven&#39;t done the processing of the sent received data yet but it&#39;s a working mqtt client.&nbsp;</p>
<p>As well as topic structures and packet formats there is also security to consider too I guess,&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25843"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Sun, 14/12/2014 - 22:23.</div>
    <div class="content">
     <p>I am probably a bit confused here, but is it possible for EmonCMS to have an MQTT&nbsp;listener for receiving values directly? Or will we always need something to translate the MQTT publishes to JSON&nbsp;HTTP requests which EmonCMS can receive and process?</p>
<p>I won&#39;t be running EmonHub&nbsp;since all my nodes already publish MQTT messages over my LAN, so I was hoping this MQTT&nbsp;subscription stuff could be built into EmonCMS itself.&nbsp;</p>
<p>Or am I dreaming?!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25844"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 14/12/2014 - 23:24.</div>
    <div class="content">
     <p>Hi Ben</p>
<p>I&#39;m pretty sure the intention for emoncms&nbsp;was to be able to both subscribe and &quot;publish via an input process&quot;. emonHub&#39;s&nbsp;MQTT implementation is more about funneling the data to emoncms.&nbsp;Because emonhub&nbsp;can subscribe to several topics across multiple interfacers&nbsp;each with different targets, it means emoncms can subsribe to one topic and emonhub can not only pull together several topics and forward then to emoncms&nbsp;on that one topic&nbsp;but also send serial, rfm, I&sup2;C, gpio&nbsp;and more to emoncms via mqtt too,</p>
<p>In addition to emoncms&nbsp;functionality, emonhub can also push mqtt to rfm or I&sup2;C etc or transmit the mqtt&nbsp;packets comng out of emoncms over RFM etc. emonHub is all about connectivity, It will give&nbsp;emoncms&nbsp;(as well as&nbsp;openHAB and nodered)&nbsp;almost realtime&nbsp;control access to the rfm network and the other resources.</p>
<p>Plus you have the buffering. any data that can reach the Pi is then buffered, for example our internet connection has gone down twice in the last 3mths for over 12 hrs but I haven&#39;t lost a single data packet.</p>
<p>I think emoncms mqtt slowed a bit because emonhub was lagging behind, hopefully now emonhub is able to use&nbsp;mqtt&nbsp;we can progress with both and&nbsp;develop a common standard for topics and payload structures.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25845"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Sun, 14/12/2014 - 23:34.</div>
    <div class="content">
     <p>Great news - thanks Paul for taking the time to explain that!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25857"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 15/12/2014 - 21:29.</div>
    <div class="content">
     <p>Thanks Paul, great to see the mqtt experimental branch development work, yes I was think perhaps the rfmpi2mqtt.py script that Im using that&#39;s based on your emonhub decoder work could be a forerunner I just wanted at this stage to get a better understanding of requirements, I&#39;ve been experimenting with new server side code instead of emoncms and a cut down hardcoded version of rfm12demo too.</p>
<p>One of the things I was wondering about was whether it might be useful to integrate MQTT into emonhub in a more fundamental way, perhaps HTTP dispatchers could be separate scripts that subscribe to the emonhub node topic.. but then there are problems with how you then generate the HTTP requests for emoncms if MQTT messages are of the individual variable format (rx/room/temperature -&gt; 18.5) as it may be hard to recombine and send as a single request, I added it as an item in the <a href="https://github.com/emoncms/development/blob/master/experimental/control/open_thermostat_scheduler/readme.md">development questions at the bottom here</a> while I was thinking about it. There&#39;s something appealing about hanging dispatchers on an mqtt &#39;bus&#39; with each dispatcher being a separate script as it could make for more modular code but then it may be more trouble than its worth.</p>
<p>@summerboy the emoncms mqtt listener is in the mqttdev branch under the scripts folder, just tested it to work again today.<br />
<a href="https://github.com/emoncms/emoncms/tree/mqttdev/scripts" title="https://github.com/emoncms/emoncms/tree/mqttdev/scripts">https://github.com/emoncms/emoncms/tree/mqttdev/scripts</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25859"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Mon, 15/12/2014 - 22:24.</div>
    <div class="content">
     <p>@Trystan - I read the notes you linked to above and&nbsp;see your point about combining data to save on connections/bandwidth at emoncms.org. I would expect a properly configured MQTT broker would be able to handle this type of load, but anything to reduce load is probably worth considering.</p>
<p>From my perspective I run a local MQTT broker and&nbsp;emoncms instance and would much prefer to have a simple topic structure of /rx/node/variable -&gt;&nbsp;value, with no time component at all. This simplifies things greatly and allows my time-dumb Arduinos to simple post values as and when they can and leave all the time store stuff to emoncms. It also means I have full decoupling&nbsp;of emoncms from the MQTT&nbsp;stream - and allows other systems like openHAB to use the same stream.</p>
<p>Although I see the benefit of the emonhub&nbsp;buffering data during network outages and being capable of uploading that data to emoncms.org. I would imagine this is very useful to a lot of people using emoncms.org.</p>
<p>So I see two options;&nbsp;</p>
<p>Option&nbsp;1 we have two modes of operation in the emoncms MQTT subscriber - one for emonhub data (which will include timestamps and &#39;packaged&#39; data streams) and one for generic data - which is a simple /rx/node/variable -&gt; value stream.</p>
<p>Option 2 is to force local installs like myself to run an instance of emonhub which subscribes to my simple data streams and packages up the data into a format readily readable by emoncms (as you alluded to). This simplifies the emoncms code but makes life a bit more tricky for anyone not currently running emonhub.</p>
<p>Feels like we (I should really say &#39;you guys&#39;)&nbsp;are starting to make good progress with this stuff!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25922"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 17/12/2014 - 23:08.</div>
    <div class="content">
     <p>Having given this a bit of thought I have a couple of idea&#39;s to throw out there.&nbsp;</p>
<p>Firstly rather than have 2 independent &quot;methods&quot; of MQTT input how about using a &quot;keyword&quot; in the topic and it&#39;s position identifies the topic format.&nbsp;</p>
<p>for example if&nbsp;emoncms subs to home/emoncms/# and receives&nbsp;messages from these topics:-<br />
A) /home/emoncms, comparing the index of the keyword &quot;emoncms&quot; with the topic length tells us it&#39;s the final level and from that we could assume the payload is in the normal &quot;json bulk upload&quot; style of a list of &quot;time,node,val1,va2,val3&quot; frames.<br />
B) /home/emoncms/10, comparing the index of the keyword &quot;emoncms&quot; with the topic length tells us there is one topic level to the right of the keyword, this can be taken to be the nodeid. The payload can be a string of values or key:value pairs maybe.<br />
C /home/emoncms/10/temperature, this time 2 levels to the right are found by comparing the index of &quot;emoncms&quot; to the topic length, so that can be taken to be node and input. The payload could be just a single value or value=123, time=141234567, unit=kwh<br />
An additional benefit of this is the subscribed topic could be &quot;home/#&quot; and still catch home/groundfloor/grannyannex/kitchen/emoncms/10/temperature, we would effectively be putting the # wildcard in the middle of the topic eg &quot;home/#/emoncms&quot;, &quot;home/#/emoncms/+&quot; and &quot;home/#/emoncms/+/+&quot; in one.<br />
I&#39;m unable to write this in php but have written something in python that could be used to start from.(attached)</p>
<p>Next to enable emonHub to collect individual mqtt messages and pass them to emoncms using &quot;bulk&quot; by either the existing route or by the MQTT method above, we could modify emoncms to accept &quot;null placeholders&quot; in frames of data so if emonhub receives a MQTT message from say /home/emoncms/10/temperature it could establish the index of the temperature input from the [nodes] data in emonhub.conf and if it is the 4th input pass a data frame of time,node,null,null,null,temperature to the reporters buffer for inclusion in the next batch.<br />
This is a surprisingly simple amendment to emoncms input which I have previously had working so I will find the edit and submit it for consideration to git.</p>
<p>lastly, to be able to use input names and keep the existing bulk upload etc working we could use emoncms&#39;s input &quot;description&quot; field so that the &quot;numeric name&quot; is retained and the field in which we currently manually enter a &quot;descriptive name&quot; could be used to look up inputs by name instead. I&#39;ve looked into this and although I think I could fumble though it it&#39;s probably best left to the experts, but a new input route that calls alternative create_input() and get_inputs() should probably do it (eg create_input_with_desc() and get_inputs_by_desc()). &nbsp;&nbsp;</p>
<p>Something along these lines should allow a local emoncms to get fully addressed topic&#39;s (just for you Ben!) or MQTT messages to be &quot;buffered&quot; by emonhub to send by html or mqtt (or both?). and allow naming of nodes and inputs without breaking any existing use of the numbered inputs. It also simplifies subscription for emoncms in a way that emonhub could also subscribe to if not feeding emoncms directly. My python mock up of A) also has the ability to enable/disable each of the topic formats, so emoncms.org could easily accept only A) to reduce traffic.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25926"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 17/12/2014 - 23:27.</div>
    <div class="content">
     <p><em>Something along these lines should allow a local emoncms to get fully addressed topic&#39;s (just for you Ben!)</em></p>
<p>Well, it was Ben&#39;s&nbsp;birthday a couple of days ago!</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25928"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Wed, 17/12/2014 - 23:41.</div>
    <div class="content">
     <p>How did you know that?!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25930"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 17/12/2014 - 23:57.</div>
    <div class="content">
     <p>Moderator training &amp;&nbsp;intuition!</p>
<p>Paul<br />
<em>(or maybe that google&nbsp;has for some reason&nbsp;added your birthday to my calendar (facebook/twitter??))&nbsp;</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25931"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Thu, 18/12/2014 - 00:02.</div>
    <div class="content">
     <p>Ha - yes I do recall seeing a birthday cake when I went to do a Google search on the 12th. They obviously feel the need to share that with everyone ;).</p>
<p>If it gets me a feature request accepted then I am all for it ;)!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25932"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Thu, 18/12/2014 - 00:06.</div>
    <div class="content">
     <p>It must hurt being aware that the whole world knows that you are 63!</p>
<p>Paul<br />
(completely&nbsp;off topic)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25933"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 18/12/2014 - 00:06.</div>
    <div class="content">
     <p>Is there&nbsp;anything google doesn&#39;t know ?&nbsp;</p>
<p>Just submitted a <a href="https://github.com/emoncms/emoncms/pull/268">pull request for the &quot;null placeholders&quot;</a>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25934"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 18/12/2014 - 00:08.</div>
    <div class="content">
     <blockquote><p><em>&nbsp;the whole world knows that you are 63!</em></p>
</blockquote>
<p><em>Wow! not a grey hair&nbsp;in sight :-)</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25936"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6498.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-6498.jpg" alt="sumnerboy&#039;s picture" title="sumnerboy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/6498.html" title="View user profile.">sumnerboy</a> on Thu, 18/12/2014 - 01:07.</div>
    <div class="content">
     <p>Sh!t - does it have my age as well...</p>
<p>Not many grey hairs on my head...not many hairs full stop.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25946"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 18/12/2014 - 12:06.</div>
    <div class="content">
     <p>Although not directly linked to MQTT&nbsp;I have also <a href="https://github.com/emoncms/emoncms/pull/269">submitted a pull request to emoncms</a> to include a facility to&nbsp;&quot;fetch&quot; several feed values in one request. Initially intended to &quot;fetch&quot; data for displaying on emonGLCD etc but the proposed&nbsp;&quot;routing&quot; ability in emonHub&nbsp;would mean the same data could be published over MQTT.</p>
<p>This could go hand in hand with the suggestions above to enable users to have the option of&nbsp;a local MQTT&nbsp;network with remote emoncms&nbsp;with emonhub&nbsp;bulk posting topics via http as well as&nbsp;retrieving calculated or accumulated feed data and publishing it locally,</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25959"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 18/12/2014 - 15:25.</div>
    <div class="content">
     <p>Thanks Paul, merged it in.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25964"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 19/12/2014 - 15:12.</div>
    <div class="content">
     <p>Cheers Trystan. I will create a new thread post some notes on the new&nbsp;features. Did you see&nbsp;the post about <a href="5943.html#comment-25922">emonHub, emoncms and MQTT&nbsp;ideas</a> about 10 posts back,&nbsp;before the banter&nbsp;?&nbsp;Any thoughts?</p>
<p>My second point was taken care of by&nbsp;one of the merges and just needs utilizing by emonhub&nbsp;however the first point&nbsp;would need the python &quot;on_message&quot; I attached ported/integrated into php/emoncms&nbsp;and then expanded to actually record the data and the last point would also need some php work too. I happy to have a go if you think it can fly, but would probably benefit from your own expertise. I think it tackles the points you and Ben have raised or at least comes close.﻿</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25989"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 19/12/2014 - 13:08.</div>
    <div class="content">
     <p>Thanks Paul, yes trying to think through it, so many options..</p>
<p>To recap your post and add a couple of other options</p>
<p>A) /home/emoncms &rarr; &quot;time,node,val1,va2,val3&quot;&nbsp; (CSV)<br />
A) /home/emoncms &rarr; {&quot;10&quot;:{&quot;time&quot;:141234567,&ldquo;power1&rdquo;:123, &ldquo;power2&rdquo;:123}} (json)<br />
B.1) /home/emoncms/10 &rarr;{&ldquo;power1&rdquo;:123, &ldquo;power2&rdquo;:123} (json)<br />
B.2) /home/emoncms/10 &rarr; 123,123 (csv)<br />
C.1) /home/emoncms/10/temperature &rarr;123 (single value)<br />
C.2) /home/emoncms/10/temperature &rarr;value=123&amp;time= 141234567&amp;unit=kwh (url encoded)<br />
C.3) /home/emoncms/10/temperature &rarr;{&ldquo;value&rdquo;:123, &ldquo;time&rdquo;:141234567, &ldquo;unit&rdquo;:kwh} (json)<br />
C.4) /home/emoncms/10/temperature &rarr;141234567,123,kwh (csv)</p>
<p>Problems: B1, B2 ordering of json and csv may be different<br />
C2: url encoded might be a useful format<br />
C4: csv here is ok as the ordering can be specified as time,value,units</p>
<p>Agreed that base string &quot;/home/emoncms/&quot; can be flexible.</p>
<p>Not sure about putting the name in the description field. Perhaps emoncms doesnt need to know anything about the nodeid of the node that the nodeid only gets as far as emonhub&#39;s decoder where it is mapped to a name. Or maybe there is an advantage of passing both, maybe we could rename description to nodename and name to nodeid...</p>
<p>also interested in looking at changing the HTTP API to achieve consistency and moving to using GET, POST, PUT, DELETE request methods, we could make the above accessible under</p>
<p>POST <a href="http://emoncms/nodes/#" title="http://emoncms/nodes/#">http://emoncms/nodes/#</a><br />
POST <a href="http://emoncms/nodes/kitchen/temperature    " title="http://emoncms/nodes/kitchen/temperature    ">http://emoncms/nodes/kitchen/temperature    </a> 17.4 (post body)</p>
<p>GET <a href="http://emoncms/nodes/kitchen/temperature" title="http://emoncms/nodes/kitchen/temperature">http://emoncms/nodes/kitchen/temperature</a> -&gt; would return 17.4...</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25992"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 19/12/2014 - 14:14.</div>
    <div class="content">
     <p>I guess the answer to the problem of json/csv ordering is how its dealt with in emoncms at the moment. i.e if csv is used the variable name has to be the csv value index, and can then be written using json as follows:</p>
<p>A) /home/emoncms &rarr; &quot;time,node,val1,va2,val3&quot;&nbsp; (CSV)<br />
A) /home/emoncms &rarr; {&quot;10&quot;:{&quot;time&quot;:141234567,&ldquo;1&rdquo;:123, &ldquo;2&rdquo;:123, &quot;3&quot;:123}} (json)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25993"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 19/12/2014 - 14:29.</div>
    <div class="content">
     <p>A2 should be:</p>
<p>data=[<br />
&nbsp;&nbsp;&nbsp; {&quot;node&quot;:10, &quot;time&quot;:141234567,&ldquo;power1&rdquo;:123, &ldquo;power2&rdquo;:123},<br />
&nbsp;&nbsp;&nbsp; {&quot;node&quot;:10, &quot;time&quot;:141234577,&ldquo;power1&rdquo;:123, &ldquo;power2&rdquo;:123},<br />
&nbsp;&nbsp;&nbsp; {&quot;node&quot;:10, &quot;time&quot;:141234587,&ldquo;power1&rdquo;:123, &ldquo;power2&rdquo;:123}<br />
]&amp;sendat=141234592</p>
<p>for bulk data to work. or</p>
<p>data=[<br />
&nbsp;&nbsp;&nbsp; {&quot;node&quot;:10, &quot;time&quot;:141234567,&quot;variables&quot;:{&ldquo;power1&rdquo;:123, &ldquo;power2&rdquo;:123}},<br />
&nbsp;&nbsp;&nbsp; {&quot;node&quot;:10, &quot;time&quot;:141234577,&quot;variables&quot;:{&ldquo;power1&rdquo;:123, &ldquo;power2&rdquo;:123}},<br />
&nbsp;&nbsp;&nbsp; {&quot;node&quot;:10, &quot;time&quot;:141234587,&quot;variables&quot;:{&ldquo;power1&rdquo;:123, &ldquo;power2&rdquo;:123}}<br />
]&amp;sendat=141234592</p>
<p>if time and node are not to be reserved names.</p>
<p>I wonder if the difference in overhead is significant between the above format using names and the current format (on a busy server with hundreds of updates of this kind per second -it may not be significant given that disk io is the main bottleneck)</p>
<p>data=[<br />
&nbsp;&nbsp;&nbsp; [141234567,10,123,123],&nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp;&nbsp; [141234577,10,123,123],<br />
&nbsp;&nbsp;&nbsp; [141234587,10,123,123]<br />
]&amp;sendat=141234592</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25994"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 19/12/2014 - 15:04.</div>
    <div class="content">
     <p>Hi Trystan, there are indeed many, many options.</p>
<p>A) was primarily aimed at bulk uploads such as [[time,node,val1,va2,val3][time,node,val1,va2,val3][time,node,val1,va2,val3]] but there is no reason why a single frame of values can be passed, pretty much as we currently have with &quot;bulk&quot;. Each frame would be processed individually as CSV so I&#39;m not quite sure how that would work with named inputs (yet anyways) plus are manes counter productive in compacting a &quot;bulk upload&quot;?</p>
<blockquote><p><em>Not sure about putting the name in the description field. Perhaps emoncms doesnt need to know anything about the nodeid of the node that the nodeid only gets as far as emonhub&#39;s decoder where it is mapped to a name. Or maybe there is an advantage of passing both, maybe we could rename description to nodename and name to nodeid...</em></p>
</blockquote>
<p>I think something was &quot;lost in translation&quot; here maybe. or did you mean inputname and inpudid?&nbsp;I was referring to using the inputs &quot;description&quot; field to hold the inputs name rather than replacing the automatically generated &quot;numeric name&quot;. CSV can&#39;t be added to inputs that have a text &quot;name&quot;.&nbsp;</p>
<p>Currently when a new input is created in emoncms by passing csv to it, the incrementing id number is saved as the inputs &quot;name&quot; these numbers or more importantly the order of the numbers is important for subsequent data arrivals to be added to the correct input. We then tend to give the input a name which goes in the inputs &quot;description&quot; field and is never referenced it&#39;s just for display, like a unit. If that &quot;Name In The Description Field&quot; could be used to &quot;get_inputs()&quot; we could use names without overwriting the numeric id in the &quot;name&quot; field so that CSV and json can be used side by side. So&nbsp;</p>
<blockquote><p><em>Problems: B1, B2 ordering of json and csv may be different</em></p>
</blockquote>
<p>would not be an issue as the csv in B2 would be passed using the values position in the string to determine it&#39;s &quot;name&quot; (numeric id) as we currently do and json in B1 would be processed by &nbsp;using the &quot;description&quot;(&quot;Name In The Description Field&quot;)&nbsp;</p>
<p>I think a consistent api format is a very good idea and a more human readable http api may have benefits too. If you were to unify and remap the input api then that would be the perfect time to introduce a change in input fields so there is a &quot;Position in csv string&quot; id number and a &quot;input name&quot; text id</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25995"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 19/12/2014 - 15:15.</div>
    <div class="content">
     <p>Ahh you&#39;ve been busy while i was replying !!!</p>
<blockquote><p><em>I guess the answer to the problem of json/csv ordering is how its dealt with in emoncms at the moment.&nbsp;</em></p>
</blockquote>
<p>That is the bottom line yes but it can easily be got around using the description field. Only users making a switch from json&nbsp;by name to either bulk uploads or mqtt would be affected and all they need to do to be compatible is replace each nodes&nbsp;input names with incrementing&nbsp;numbers starting at 1.</p>
<p>Regards the names in bulk upload, I&#39;m not against it at all but I&#39;m not seeing a real&nbsp;benefit&nbsp;and although the extra traffic and&nbsp;workload may not be much it&#39;s a lookup at both ends plus redundant bytes on the network not to mention the extra dev work. If we retain the input numbering AND have naming (in the desc field) there would be no real purpose for named bulk uploads.</p>
<p>Even individual inputs arriving at emonhub&nbsp;for passing to emoncms&nbsp;using the bulk api&nbsp;will be [[time,node,val1][time,node,null,val2][time,node,null,null,val3][time,node,null,null,null,val4]] .</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36199"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8887.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="oymyakon&#039;s picture" title="oymyakon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/8887.html" title="View user profile.">oymyakon</a> on Sat, 21/11/2015 - 15:03.</div>
    <div class="content">
     <p>Hi,</p>
<p>i am a noob to the emon&nbsp;system. I have got the emonpi all running. How do i connect to the Mqqt&nbsp;from outside the pi? ie other controllers sending&nbsp;mqqt&nbsp;messages.</p>
<p>Paul.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37318"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gregl&#039;s picture" title="gregl&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/9051.html" title="View user profile.">gregl</a> on Mon, 21/12/2015 - 09:57.</div>
    <div class="content">
     <p>I too want to try access the mosquito running on the emonPi. ( im also new to emonCMS )</p>
<p>Im using the preconfigured&nbsp;SD card image ( v8.5)</p>
<p>I had a look at mosquitto.conf and i think it should allow connections from anywhere/one but i cannot connect to it from another machine on the network.</p>
<p>Is there a change i need to make to access mqtt ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37319"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9051.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gregl&#039;s picture" title="gregl&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: MQTT and node-red for emonHub</h3>

    <div class="submitted">Submitted by <a href="../user/9051.html" title="View user profile.">gregl</a> on Mon, 21/12/2015 - 10:01.</div>
    <div class="content">
     <p>Ah... just found the answer in this thread.http://openenergymonitor.org/emon/node/11668</p>
<p>Run :</p>
<p>sudo iptables -A INPUT -p tcp -m tcp --dport 1883 -j ACCEPT</p>
<p>Cheers..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5943"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-B1UMb81CLApw2EtsjaFmbdSiomTy0cOrhnmGwD4dtBs" value="form-B1UMb81CLApw2EtsjaFmbdSiomTy0cOrhnmGwD4dtBs"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
