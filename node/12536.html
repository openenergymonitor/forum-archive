<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12536 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:19:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Retrospectively write data to a feed? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Retrospectively write data to a feed?</h3>
        <span class="submitted">Submitted by <a href="../user/9662.html" title="View user profile.">MikeSims</a> on Thu, 21/04/2016 - 19:10</span>
        <div class="content"><p>I&#39;ve been thinking about how to display my gas usage, gleaned from a pulse-based meter, where 1 pulse represents 1 cubic foot of gas. Currently, on detection of a pulse, the WH of that CuFt of gas can be converted to average Watts over the duration since the previous pulse, and interrupt.ino on the Arduino tracks that duration, and makes the calculation, currently plonking it into emonPi.power2.&nbsp; That gives a single value written into the Feed at the time the value is received by emoncms. Well and good, but that gives me a series of spikes, one per pulse, scattered across a graph over a period of time, often with very long gaps between them.</p>
<p>After sending the value, emonPi.power2 is cleared to zero, as the current value is no longer relevant after the pulse, and no new value can be calculated until the next pulse is detected, and that might be hours in the future. The current value&#39;s actual relevance is for the time between the most recent pulse and the previous pulse, and yet nothing is written into any of the datapoints in the Feed for that entire duration except the one coinciding with the pulse, all the rest are zero.</p>
<p>That seems a very artificial way to display that data. I think there might be a better way, a way that spreads the data across more of the graph than current mechanisms for gas/other pulse meters do.</p>
<p>What if we write a suitable value retrospectively into as many datapoints preceding the pulse as far as either the previous pulsetime, or, say, 15 minutes, whichever is shorter.</p>
<p>My reasoning for a limit is that it doesn&#39;t make sense to write a very low value (35.3W) into every datapoint for the previous nine hours while my central heating was off overnight, it would make more sense to assume that all of that CuFt was consumed within, say, the last 15 minutes, and that all of the time prior to that limit no gas was consumed at all after the previous pulse. I would therefore calculate the Watts as 1273W, and write that into the last 90 datapoints, assuming 10 second intervals. Specifying a limit allows for long periods when it is clear that no gas is being consumed, and limits the number of writes in the update, and importantly, doesn&#39;t contradict the data, it is just a convenience that reinterprets the data in a more useful and arguably more intuitive manner, more closely resembling the electric Watts graphs. It achieves a more granular appearance than single bare pulses can do.</p>
<p>Any ideas as to how to achieve this? Is there a mechanism that exists in processes to do this? Where would I start?</p>
<p>Mike</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12444.html" class="topic-previous" title="Go to previous forum topic">‹ Apps menu on emonPi broken, shows &#039;Notice: Undefined offset: 0&#039;</a>
              <a href="12535.html" class="topic-next" title="Go to next forum topic">5pm blip ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
