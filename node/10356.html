<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10356 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:24:28 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>read multiple 1-wire sensors from emonTx terminal | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">read multiple 1-wire sensors from emonTx terminal</h3>
        <span class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Thu, 19/03/2015 - 18:11</span>
        <div class="content"><p>Hi, I&#39;ve got two 1-wire sensors (DS18B20) connect to the emonTx v3 terminal block.</p>
<p>When I run&nbsp;tail -f /var/log/emonhub/emonhub.log I get the readings from only one sensor.</p>
<p>How can I read from multiple sensors connected to the terminal block?</p>
<p>Alex</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10386.html" class="topic-previous" title="Go to previous forum topic">‹ needed changes in process_model for resend data</a>
              <a href="10375.html" class="topic-next" title="Go to next forum topic">Dashboard - Problem Widgets --&gt; Feedvalue ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-28832"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 19/03/2015 - 23:12.</div>
    <div class="content">
     <p>The latest firmware now includes auto detecting and reading from up to 5 temperature sensors. You can compile and upload from Arduino IDE using USB to UART cable&nbsp;</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM69CW/emonTxV3_RFM69CW_DiscreteSampling/emonTxV3_RFM69CW_DiscreteSampling.ino" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM69CW/emonTxV3_RFM69CW_DiscreteSampling/emonTxV3_RFM69CW_DiscreteSampling.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3...</a></p>
<p><span style="font-size: 13px; line-height: 1.6;">Be sure to set the flag on the first line of the sketch to set what rf module your using. Probably rfm12b.&nbsp;</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28852"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Fri, 20/03/2015 - 16:32.</div>
    <div class="content">
     <p>Hi, I uploaded that sketch with the flag set to rfm12b and the emonTx v3 stopped working. So I uploaded this sketch <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling/emonTxV3_RFM12B_DiscreteSampling.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling/emonTxV3_RFM12B_DiscreteSampling.ino</a> and it works but it&#39;s still only reading one sensor.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28856"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 20/03/2015 - 16:51.</div>
    <div class="content">
     <p>What sort of emonTx V3 do you have? Is it a V3.2 with the RFM12B radio module surface-mounted on a RF&mu;328 module that is surface-mounted on the main PCB, or is it a V3.4 with a RJ45 connector?</p>
<p>I'm almost certain it's  V3.2, but I'll wait for you to confirm that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28857"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Fri, 20/03/2015 - 16:57.</div>
    <div class="content">
     <p>It&#39;s V3.2.1 Feb 2014 with the rfm12b radio module surface-mounted on a RF&mu;328 module.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28859"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 20/03/2015 - 17:08.</div>
    <div class="content">
     <p>OK, the sketch Glyn pointed you at is for the V3.4.  What you'll need to change:</p>
<p>The library: #include &lt;JeeLib.h&gt; becomes  #include &lt;RFu_JeeLib.h&gt;</p>
<p>The radio module: #define RF69_COMPAT 0	  -- always</p>
<p>Delete all references to the DIP Switches &amp; Battery_voltage, and the code that goes with them</p>
<p>The Pulse input  Dig 3 / IRQ 1  becomes  Dig 2 / IRQ 0</p>
<p>I <i>think</i> that's all.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28949"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Mon, 23/03/2015 - 15:53.</div>
    <div class="content">
     <p>Ok so I</p>
<p>Added the include &lt;JeeLib.h&gt;</p>
<p>set RF69_Compat to 0</p>
<p>commented out the DIP Switches &amp; battery code</p>
<p>set pulse input to 2 !?</p>
<p>and the emonTx turns on but doesn&#39;t send anything and at one stage started blinking real fast.</p>
<p>I&#39;ve atteched the modified sketch</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28952"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 23/03/2015 - 16:03.</div>
    <div class="content">
     <p>You missed the &quot;gotcha&quot; that I missed for a while:</p>
<p>if (DS18B20_STATUS==0) attachInterrupt(1, onPulse, FALLING);</p>
<p>The <b>1</b> becomes a zero. It was a bit naughty of Glyn to use parameterised constants in most but not all of the places. I also changed emontx.pulseCount++; inside the ISR to get around a potential problem with timing. I&#39;ll attach my sketch, but I need to swap browsers to do it.</p>
<p>[After I wrote the post a few days ago, I &#39;back-converted&#39; the sketch, and now&nbsp;I&#39;ve attached it. It&#39;s untested from the temperature measurements angle as I don&#39;t have a spare DS18B20, let alone several. It recorded anything up&nbsp;to many tens of pulses when I dabbed a bit of wire onto the pulse input, so that aspect seems to work.]</p>
<p>[Edit: incorporated dBC&#39;s&nbsp;change - thanks for pointing that out]</p>
<p>[Edit 2: incorporated Glyn's change below. <br />
<a href="../sites/default/files/emonTxV3_RFM12B_DiscreteSampling_2.html">emonTx V3.2 RFM12B DiscreteSampling sketch</a>]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28958"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 23/03/2015 - 21:58.</div>
    <div class="content">
     <p><em>I also changed emontx.pulseCount++; inside the ISR to get around a potential problem with timing.</em></p>
<p>I fear there&#39;s still a race condition there.</p>
<pre>

if (pulseCount)  
{
 emontx.pulseCount += pulseCount;
 pulseCount = 0;
}
</pre><p>If an interrupt occurs between those last two lines, you&#39;ll lose that pulse. &nbsp; If you check the generated code you&#39;ll see there are a full six instructions between it reading pulseCount&nbsp;for the addition, and it eventually clearing it. The fix is pretty simple though:</p>
<pre>
if (pulseCount)
{
&nbsp;cli();
&nbsp;emontx.pulseCount += pulseCount;
&nbsp;pulseCount = 0;
&nbsp;sei();
}</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28964"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 24/03/2015 - 09:47.</div>
    <div class="content">
     <p>@dBC This has now been fixed, thanks:&nbsp;https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM69CW/emonTxV3_RFM69CW_DiscreteSampling/emonTxV3_RFM69CW_DiscreteSampling.ino#L436</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28967"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 24/03/2015 - 11:39.</div>
    <div class="content">
     <p>Er, no. But the attachment to my post above has been fixed.<br />
<a href="../sites/default/files/emonTxV3_RFM12B_DiscreteSampling_1.html" title="http://openenergymonitor.org/emon/sites/default/files/emonTxV3_RFM12B_DiscreteSampling_1.ino">http://openenergymonitor.org/emon/sites/default/files/emonTxV3_RFM12B_Di...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28997"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Wed, 25/03/2015 - 17:05.</div>
    <div class="content">
     <p>This sketch works but only with some and not with others. I have like 10 ds18b20 temp sensors and I can only get reading from 3 of them the others always read 850 (raw data). They read 850 on their own or in any combination. However I know they all work fine if I connect them to my desktop.</p>
<p>Any ideas of what could be causing a constant 850 output on most of my sensors.</p>
<p><span class="rangySelectionBoundary" id="selectionBoundary_1427297803727_9735537523525377" style="line-height: 0; display: none;">﻿</span>I am using them in parasite mode.</p>
<p>I&#39;ve just tested the sensors with the same sketch which only allows for 1 connection on the terminal and the sensors that give 850 on the new sketch&nbsp; work fine on it.</p>
<p>alex</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29001"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 25/03/2015 - 21:18.</div>
    <div class="content">
     <p>Is "850" the temperature &times; 10 as printed to serial, i.e. 85&deg;C? If so, that's the 'power-on' value of temperature and indicates that the device is not reading and converting the temperature.</p>
<p>It may be that 10 sensors are pulling the voltage on the bus down too far if they all do their thing at the same time - which they do. Page 5 of the data sheet gives some information. I think this is the likeliest given what you report. What is the topology of your wiring, the cable type &amp; lengths?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29008"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Thu, 26/03/2015 - 09:22.</div>
    <div class="content">
     <p>I get 850 (85 deg) even if I plug the one sensor straight into the terminal block using short wires.</p>
<p>But then if, without changing anything, I upload an older sketch to the tx, the same sensor connected the same way would work fine.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29025"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 26/03/2015 - 11:31.</div>
    <div class="content">
     <p>Hi Alex,</p>
<p>That&#39;s strange. Try increasing the value of&nbsp;#define ASYNC_DELAY 375, there have been reports of a value of 750 working better for multiple sensors.&nbsp;</p>
<p>By&nbsp;default the emonTx V3 is limited to maximum of 6 sensors. Make sure you are powering the emonTx&nbsp;via USB DC rather than AC-AC adapter when using so many sensors.&nbsp;</p>
<p>You can also try increasing the sleepy&nbsp;delay on line 336 from 50ms to a higher value.&nbsp;</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM69CW/emonTxV3_RFM69CW_DiscreteSampling/emonTxV3_RFM69CW_DiscreteSampling.ino#L366" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM69CW/emonTxV3_RFM69CW_DiscreteSampling/emonTxV3_RFM69CW_DiscreteSampling.ino#L366">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3...</a></p>
<p>​Let me know what your findings are. I could add code to disable sleep and increase delays when reading from many sensors as battery power is not practical.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29030"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Thu, 26/03/2015 - 12:34.</div>
    <div class="content">
     <p>Hi Glyn,</p>
<p>I just ran a test and found a way to make the sensors work.&nbsp; I am using two sketch images:</p>
<p>sketch1:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling/emonTxV3_RFM12B_DiscreteSampling.ino" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling/emonTxV3_RFM12B_DiscreteSampling.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3...</a></p>
<p>sketch2:</p>
<p><a href="../sites/default/files/emonTxV3_RFM12B_DiscreteSampling_1.html" title="http://openenergymonitor.org/emon/sites/default/files/emonTxV3_RFM12B_DiscreteSampling_1.ino">http://openenergymonitor.org/emon/sites/default/files/emonTxV3_RFM12B_Di...</a></p>
<p>So first I connect one temperature sensor directly to the emonTx terminal block (ground and 1-wire data) where ground and power are tied together on the sensor.</p>
<p>I run the tx with sketch 2 on it and verify that the output is a constant 85 degrees.</p>
<p>then without unplugging or touching anything I upload sketch 1 and sensor will start working fine. Next I reload sketch 2 and now the sensor continues to work fine.&nbsp; Sensor fixed?</p>
<p>I&#39;ve tried these steps with 3&nbsp; sensors and now the 3 work.</p>
<p>But I&#39;ve no idea of what going on here!!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29035"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 26/03/2015 - 13:14.</div>
    <div class="content">
     <p>What you're doing there is maintaining the power to the sensor while moving from one sketch to the other?<br />
That makes me think that Sketch 2 is not getting the address of the sensor correctly, or not initialising it correctly. To confirm this, can you get the address using the test sketch, then get Sketch 2 to display what it thinks is the address of the same sensor?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29036"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Thu, 26/03/2015 - 13:32.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>I agree, I think you&#39;re on the right track there. Yes, I didn&#39;t remove the power and now I have all the sensors working except for one which I kept for testing purposes. The fix seems permanent so it might be an initialising issue as you pointed there.</p>
<p>I&#39;ll try to output what sketch 2 sees first .... I don&#39;t want to run a script that would fix the sensor. So as to be able to keep replicating the problem</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29038"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 26/03/2015 - 13:36.</div>
    <div class="content">
     <p><i>"I have all the sensors working"</i></p>
<p>Is that working as in responding with what looks like a sensible temperature, or responding as in reporting accurately (after a bit of delay of course) changes in temperature?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29039"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Thu, 26/03/2015 - 13:43.</div>
    <div class="content">
     <p>I think they look like sesilble temperature measurements in around the 22 degrees + or - 1 from eachother ... and they respond well if I blow on them or sink them in water.&nbsp;</p>
<p>I don&#39;t know how to get the arduino to report on the address it sees but I&#39;ll look into that now.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29041"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 26/03/2015 - 15:01.</div>
    <div class="content">
     <p>Ah! I think I&#39;ve found the bug. The issue was in the new code the resolution of the sensor is not set every time&nbsp;after the sensors are powered up. Only once at startup. When the sensors are powered down in&nbsp;between readings they loose their resolution setting causing them to default back to 12 bit resolution. This then causes in issue since the async delay for the temperature conversion is only long enough to allow for 11 bit conversion (the emonTx / emonTH default).&nbsp;</p>
<p>This has now been fixed. Resolution of each sensor is set every time they are read.&nbsp;Please try this new sketch now:&nbsp;</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM69CW/emonTxV3_RFM69CW_DiscreteSampling/emonTxV3_RFM69CW_DiscreteSampling.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM69CW/emonTxV3_RFM69CW_DiscreteSampling/emonTxV3_RFM69CW_DiscreteSampling.ino</a></p>
<p>&nbsp;</p>
<p>If reading from many sensors I would not recommend using sensors in parasitic power mode &nbsp;or connection the &#39;pwr&#39; pin from the sensors to digital 11 to enable powering does the sensors in between readings. I would recommend connecting DS18B20&#39; &#39;pwr&#39; pin to 5V terminal block / RJ45, GND to GND and data pin to Dig 5</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29043"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7832.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="alex88&#039;s picture" title="alex88&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/7832.html" title="View user profile.">alex88</a> on Thu, 26/03/2015 - 16:19.</div>
    <div class="content">
     <p>That did it, great!</p>
<p>I added the lines to set the resolution to the sketch that I was using (see attached) (since I have an emonTx V3.2 with an RFM12B) and it worked. I then changed the max to 11 and I got the 11 sensors working fine.</p>
<p>I&#39;m aiming at getting about 20 DS18B20s connected to the tx so I will be connecting them non parasite mode next, thanks for pointing that out Glyn.</p>
<p>Thanks to everyone who helped me sort this out. Much appreciated.</p>
<p>Cheers,</p>
<p>Alex</p>
<p>
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29044"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 26/03/2015 - 17:06.</div>
    <div class="content">
     <p>I would recommend you use the latest sketch I linked to above. The only change required for use with RFM12B is change flag to 0 at beginning of the sketch </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29045"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: read multiple 1-wire sensors from emonTx terminal</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 26/03/2015 - 17:21.</div>
    <div class="content">
     <p>Glyn, he needs RFu_JeeLib and to change the interrupt no. and pins etc as he's using a V3.2 with the RF&mu;328.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10356"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-WdVwXRuwviEz5lp544dal3fhTXD-Pc7ntMGilPf1Uis" value="form-WdVwXRuwviEz5lp544dal3fhTXD-Pc7ntMGilPf1Uis"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/10356 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:24:29 GMT -->
</html>
