<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12554 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:16:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emoncms daily, weekly, monthly kWh and averaging | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emoncms daily, weekly, monthly kWh and averaging</h3>
        <span class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sun, 24/04/2016 - 15:10</span>
        <div class="content"><p>I&#39;ve been working on improving emoncms support for timezone correct daily, weekly &amp; monthly kWh data and also fully calculated average (mean) temperature, humidity, power etc.&nbsp;</p>
<p>Its now possible to access, view and export to CSV these values from the new emoncms graph interface as a start.</p>
<p>This screenshot shows average daily power data calculated from a power feed overlayed against daily kWh as calculated from a cumulative kWh feed. Both approaches arrive at the same values (apart from a few small differences if there are outages). But it illustrates that the calculation of daily mean is aligned correctly.</p>
<p><a href="../sites/default/files/graph_averaging.png"><img alt="" src="../sites/default/files/graph_averaging.png" style="width: 730px; height: 448px;" /></a></p>
<p>The request type can be selected from the type drop down menu and includes types:</p>
<ul>
<li>Interval - specify a periodic fixed interval at which to request datapoints i.e a data point every 3600 seconds.</li>
<li>Daily - daily data correct to timezone set in user profile</li>
<li>Weekly - weekly data correct to timezone set in user profile</li>
<li>Monthly - monthly data correct to timezone set in user profile</li>
</ul>
<p>To return the average for the period selected the average tickbox needs to be ticked, otherwise the value at the timestamp of the start of each interval will be returned - which is what is needed in the case of calculating kWh data from cumulative kWh feeds.</p>
<p>On request the averages are calculated on the fly in the background, the result is cached so that next time an average is requested the whole feed does not have to be processed. Because of the way this works at the moment &#39;reload&#39; needs to be clicked twice once to register the feed for averaging and second to display the result. I will be working on a way to make this a more seamless experience.</p>
<p>While most of the implementation for this is currently working on the emoncms master branch the part that registers the feed for background processing of averages is not yet complete and so the averaging will only work up to 7 days there while on emoncms.org averages covering the full feed can be returned. There are a couple of things left to do to fully complete this but for anyone keen to test its present state this is now available on emoncms.org and the master branch for testing.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12568.html" class="topic-previous" title="Go to previous forum topic">‹ modifying jgauge for decimal places</a>
              <a href="12532.html" class="topic-next" title="Go to next forum topic">Manipulating Week or Month Data ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-41368"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms daily, weekly, monthly kWh and averaging</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sun, 24/04/2016 - 15:23.</div>
    <div class="content">
     <p>daily, weekly, monthly data can be accessed from the vis &gt; bargraph by setting mode to daily, weekly or monthly:</p>
<p>Weeks are aligned to midnight (Start of the day) on monday of every week:</p>
<p><img alt="" src="../sites/default/files/bargraph_week.png" style="width: 730px; height: 329px;" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms daily, weekly, monthly kWh and averaging</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 26/04/2016 - 09:19.</div>
    <div class="content">
     <p>Two good examples of feed data on emoncms.org with and without averaging enabled</p>
<p><a href="../sites/default/files/without_averaging.png"><img alt="" src="../sites/default/files/without_averaging.png" style="width: 350px; height: 243px; float: left;" /></a></p>
<p><a href="../sites/default/files/withaveraging.png"><img alt="" src="../sites/default/files/withaveraging.png" style="width: 350px; height: 242px; float: left;" /></a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41398"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms daily, weekly, monthly kWh and averaging</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 26/04/2016 - 09:28.</div>
    <div class="content">
     <p>Hi Trystan - Please could you take a look at the <a href="11260.html#comment-41378">recent issues posted in the&nbsp;The Official Emoncms Android App thread</a>&nbsp;as those issues seem to coincide with the changes made to emoncms for these new features.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41412"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms daily, weekly, monthly kWh and averaging</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 26/04/2016 - 10:49.</div>
    <div class="content">
     <p>Thanks Paul.</p>
<p>One of the more useful parts of the new graph interface in emoncms is the CSV export tool. Its possible to select a feed, select an average interval or select for daily, weekly, monthly output then select the data range with the graph view and view the CSV output at the bottom. Its then quite easy to copy and paste this into excell for further analysis and visualisation if the inbuilt emoncms tools dont cover what you need.</p>
<p>You can also select the time format for the csv output: unix timestamp, seconds since start time or date time string.</p>
<p>I&#39;ve also been using the histogram view in the graph view to calculate the amount of time my heatpump is on standby to work out how that standby consumption affects COP, it can tell you the amount of time in seconds spent at say 0-50W 50-100W etc or when its actually running.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41413"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms daily, weekly, monthly kWh and averaging</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 26/04/2016 - 11:54.</div>
    <div class="content">
     <p>Hi Trystan</p>
<p>What you are doing here is very interesting, I haven&#39;t explored in-depth yet but now you mention the download api I wonder if what you are doing can be extended to facilitate something I intend to look at down the line.</p>
<p>I have a need to be able to distribute links to specific&nbsp;data for clients to use in their own presentations. I think the API behind those links could be of great use to many users and also allow custom data export functions to be placed as a single button on a dashboard, for example to currently download the last 7 days of daily data we need to navigate emoncms&nbsp;for a graphical route or manually write an API url using the start point in unix, the end point in unix&nbsp;the feed id and an interval (currently in secs but I guess this will change with what you are doing here) etc etc</p>
<p>I have had to issue the API url with lengthy&nbsp;instructions on how to alter the start and end points using a unix timestamp website when what I really want to do is issue a url that defaults to today as a default end time and calculates the start time from a &quot;number of intervals&quot; field so that the same url will always yield the same &quot;last 7 days&quot; and can easily be edited to report 30days or 365days by editing the one variable, preferably on the end.</p>
<p>This would allow hyperlinks and dash buttons to have labels like&nbsp;</p>
<p>Download the last 7 days daily solar&nbsp;totals</p>
<p>Download the last 30 days average daily temperatures</p>
<p>Download the the last 12 months imported energy totals&nbsp;</p>
<p>for use in excel, PP&nbsp;presentations and also to potentially integrate with other systems and softwares easily. Going back to our recent discussions on the apikeys, a single url (with read apikey)&nbsp;to a dashboard with API buttons (with read apikey) as described above&nbsp;could give any business, office or school etc the means to grant &quot;one-click&quot; access to pre-defined historic data, to all employees/students etc without them logging into emoncms or learning the intricacies of the raw api or making the data public.&nbsp;and all parties will be accessing the same data (different time windows) in a centrally administered&nbsp;way.</p>
<p>Paul</p>
<p>Edit - Combining multiple feeds in the same API url would be a great addition too as this would effectively be a basic report writer</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41441"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms daily, weekly, monthly kWh and averaging</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 27/04/2016 - 11:38.</div>
    <div class="content">
     <p>Good ideas there. It should be possible to adapt the api to provide those options, if parameters start and end are not set it could look for another, how about: period, timewindow, range? It might be possible for it to distinguish between 3600 (seconds) and 7days</p>
<p>&amp;period=7days</p>
<p>I dont think adding this would be too much work and it shouldnt affect normal operation.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12554"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ApVdnzmUdEyONEck0TXXgpfqdkUmIzIF5rlWjWrv7UY" value="form-ApVdnzmUdEyONEck0TXXgpfqdkUmIzIF5rlWjWrv7UY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/12554 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:16:10 GMT -->
</html>
