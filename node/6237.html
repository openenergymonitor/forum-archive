<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6237 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:46:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Battery voltage from emonTX node | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Battery voltage from emonTX node</h3>
        <span class="submitted">Submitted by <a href="../user/985.html" title="View user profile.">esawyja</a> on Thu, 04/12/2014 - 10:29</span>
        <div class="content"><p>Hi</p>
<p>Would it be possible to send the battery voltage on a V2 in the payload as well? Any ideas on how to do this?</p>
<p>Regards</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6221.html" class="topic-previous" title="Go to previous forum topic">‹ Logging accumulating Gas usage</a>
              <a href="6219.html" class="topic-next" title="Go to next forum topic">LEDs to show consumption ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-25601"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Battery voltage from emonTX node</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 04/12/2014 - 10:46.</div>
    <div class="content">
     <p>You can use the readVcc funciton in emonlib to read the supply voltage then add it as an payload onto the RF packet:&nbsp;https://github.com/openenergymonitor/EmonLib/blob/master/EmonLib.cpp#L227</p>
<p>See this Building Block topic for how the JeeLib RF payload RFM12B works:&nbsp;http://openenergymonitor.org/emon/buildingblocks/rfm12b2</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25604"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/985.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-985.jpg" alt="esawyja&#039;s picture" title="esawyja&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Battery voltage from emonTX node</h3>

    <div class="submitted">Submitted by <a href="../user/985.html" title="View user profile.">esawyja</a> on Thu, 04/12/2014 - 11:20.</div>
    <div class="content">
     <p>Thanks Glyn</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25608"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/985.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-985.jpg" alt="esawyja&#039;s picture" title="esawyja&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Battery voltage from emonTX node</h3>

    <div class="submitted">Submitted by <a href="../user/985.html" title="View user profile.">esawyja</a> on Thu, 04/12/2014 - 12:34.</div>
    <div class="content">
     <p>Hi Glyn,</p>
<p>I did the readVcc and I can see the batt voltage being printed on the serial of the TX node, but on the Base node I receive 0, I&#39;ve added the variable to the TX packet as follow</p>
<p>typedef struct { int power1, power2, power3, Vrms, T1, batv; } PayloadTX;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// neat way of packaging data for RF comms<br />
PayloadTX emontx;</p>
<p>Do I need to add it somewhere else, like on the receiving node?</p>
<p>This is what I get on the Base node</p>
<p>Data sent: /api/post.json?apikey=xxxxx&amp;node=20&amp;csv=2593<br />
Data sent: /api/post.json?apikey=xxxx&amp;node=10&amp;csv=128,0,0,25494,2387,0<br />
Data sent: /api/post.json?apikey=xxxx&amp;node=20&amp;csv=2593<br />
Data sent: /api/post.json?apikey=xxxx&amp;node=10&amp;csv=135,0,0,25513,2387,0</p>
<p>Another problem that I have is that emoncms sometimes reply with ok, if I post from a browser, I get ok every time, the base node is on the same subnet, I get DHCP and DNS ok, but sometimes, about 80% of the time, I don&#39;t get OK, it seems to vary from hour to hour as well, any ideas?</p>
<p>[webClient]<br />
DHCP status: 1<br />
IP:&nbsp; x.x.x.x<br />
GW:&nbsp; x.x.x.x</p>
<p>DNS: 8.8.8.8<br />
DNS status: 1<br />
SRV: 80.243.190.58<br />
Data sent: /api/post.json?apikey=xxxxx&amp;json={rf_fail:1}<br />
Data sent: /api/post.json?apikey=xxxxx&amp;node=20&amp;csv=2600<br />
Data sent: /api/post.json?apikey=xxxxx&amp;node=10&amp;csv=126,0,0,25509,2387,0<br />
Time request sent<br />
Data sent: /api/post.json?apikey=xxxxx&amp;node=20&amp;csv=2600<br />
Data sent: /api/post.json?apikey=xxxxx&amp;node=10&amp;csv=127,0,0,25425,2387,0<br />
&nbsp;</p>
<p>Thanks for all the good work, brilliant system</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25614"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Battery voltage from emonTX node</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 04/12/2014 - 15:17.</div>
    <div class="content">
     <p>Yes you also need the same packet structure on the receiving node&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25635"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/985.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-985.jpg" alt="esawyja&#039;s picture" title="esawyja&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Battery voltage from emonTX node</h3>

    <div class="submitted">Submitted by <a href="../user/985.html" title="View user profile.">esawyja</a> on Fri, 05/12/2014 - 05:11.</div>
    <div class="content">
     <p>Problem is I cannot seem to find where this is done in the Nanode_RF_multinode sketch, could you give me some indication please?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/985.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-985.jpg" alt="esawyja&#039;s picture" title="esawyja&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Battery voltage from emonTX node</h3>

    <div class="submitted">Submitted by <a href="../user/985.html" title="View user profile.">esawyja</a> on Fri, 05/12/2014 - 05:19.</div>
    <div class="content">
     <p>The guide also says &quot;NanodeRF_multinode The multinode firmware is the most flexible firmware for posting data up to emoncms, it relays data from up to the 30 nodes that the rfm12 library implementation can handle up to emoncms. You dont need to re-program the firmware each time you add a new node or variables on a particular node. It constructs a CSV format string to be sent to emoncms.&quot;</p>
<p>Not sure what I&#39;m doing wrong?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6237"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-fXCFPeIhXd9PZE-XF0gkemEKvnmg9_258mt19NyCUGE" value="form-fXCFPeIhXd9PZE-XF0gkemEKvnmg9_258mt19NyCUGE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
