<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5718 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:02:17 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Merging 2 sketches... | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Merging 2 sketches...</h3>
        <span class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 06/09/2014 - 15:02</span>
        <div class="content"><p>Hi</p>
<p>&nbsp;</p>
<p>As i just got reliable output from my heat meter i&#39;m trying to merge it in to sketch so i can log it with emoncms</p>
<p>&nbsp;</p>
<p>sketch_sep05a cantains&nbsp;just enough to print the data to serial out</p>
<p>sketch_sep06a&nbsp;is my attempt to merge the first one with a sketch that messures electricity with a &quot;blinker&quot; (10000 blinks each kw/h)</p>
<p>&nbsp;</p>
<p>there is one section from the first that i cant figure how and where to insert... of course its the part that reads the data from the meter and prints it to serial</p>
<p>anyone can give a bit of guidiance?</p>
<p>// kamReadReg - read a Kamstrup register<br />
	float kamReadReg(unsigned short kreg) {</p>
<p>&nbsp; byte recvmsg[30];&nbsp; // buffer of bytes to hold the received data<br />
	&nbsp; float rval;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this will hold the final value</p>
<p>&nbsp; // prepare message to send and send it<br />
	&nbsp; byte sendmsg[] = { 0x3f, 0x10, 0x01, (kregnums[kreg] &gt;&gt; 8), (kregnums[kreg] &amp; 0xff) };<br />
	&nbsp; kamSend(sendmsg, 5);</p>
<p>&nbsp; // listen if we get an answer<br />
	&nbsp; unsigned short rxnum = kamReceive(recvmsg);</p>
<p>&nbsp; // check if number of received bytes &gt; 0<br />
	&nbsp; if(rxnum != 0){<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; // decode the received message<br />
	&nbsp;&nbsp;&nbsp; rval = kamDecode(kreg,recvmsg);</p>
<p>&nbsp;&nbsp;&nbsp; // print out received value to terminal (debug)<br />
	&nbsp;&nbsp;&nbsp; Serial.print(kregstrings[kreg]);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;: &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(rval);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot; &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.println();<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; return rval;<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp; }</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5812.html" class="topic-previous" title="Go to previous forum topic">‹ Stackedsolar</a>
              <a href="5807.html" class="topic-next" title="Go to next forum topic">The while loop ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-23605"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 06/09/2014 - 15:17.</div>
    <div class="content">
     <p>of course also a stack of errors.. libs required should be installed... they pop up as imported libs... see attached pic for the folders</p>
<p>&nbsp;</p>
<p>sketch_sep06a:103: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;,&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;,&#39; token<br />
	sketch_sep06a:103: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:103: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:103: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:103: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:103: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a.ino: In function &#39;void setup()&#39;:<br />
	sketch_sep06a:116: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:116: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:116: error: expected primary-expression before &#39;,&#39; token<br />
	sketch_sep06a:116: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:116: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:116: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:116: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:117: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:117: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:117: error: expected primary-expression before &#39;,&#39; token<br />
	sketch_sep06a:117: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:117: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:117: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:117: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:120: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:120: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:120: error: expected primary-expression before &#39;,&#39; token<br />
	sketch_sep06a:120: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:120: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:120: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:120: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:121: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:121: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:121: error: expected primary-expression before &#39;,&#39; token<br />
	sketch_sep06a:121: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:121: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:121: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:121: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a.ino: In function &#39;void loop()&#39;:<br />
	sketch_sep06a:151: error: &#39;kamReadReg&#39; was not declared in this scope<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;,&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;?&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:155: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:155: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:155: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:155: error: expected `:&#39; before &#39;)&#39; token<br />
	sketch_sep06a:155: error: expected primary-expression before &#39;)&#39; token<br />
	sketch_sep06a:174: error: &#39;send_rf_data&#39; was not declared in this scope<br />
	sketch_sep06a:175: error: &#39;emontx_sleep&#39; was not declared in this scope</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23606"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 06/09/2014 - 15:18.</div>
    <div class="content">
     <p>It looks to me as if kamSend() is sending a request for data to your heat meter, and kamReceive() is checking to see if anything has come in, and if it has, it decodes it.</p>
<p>So you need to split that into two. The &#39;send&#39; part needs to be done whenever you want to get the data - say on a timer - and the &#39;receive&#39; part needs to be done every time around the main loop (because it will drop through is there&#39;s no data). When you have got the data, you can copy the data into the transmit structure and send it to emonCMS.</p>
<p>The code you want is going to be very much like the way the nanodeRF asks for and receives the time from the server, so you can look at that code to see how that is handled.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23610"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 06/09/2014 - 17:33.</div>
    <div class="content">
     <p>you are almost right...but its&nbsp;kamReadReg&nbsp;that triggers things and also that one that prints the data...</p>
<p>serial out in arduino ide looks like this:</p>
<p>Energy: 102,47<br />
	Current Power: 0<br />
	Temperature t1: 35,32<br />
	Temperature t2: 30,86<br />
	Temperature diff: 4,46<br />
	Flow: 0<br />
	Volumen 1: 1208,96<br />
	Volumen 2: 0</p>
<p>&nbsp;</p>
<p>also its from kamReadReg&nbsp;that the calls to send and receive is done....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23611"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 06/09/2014 - 18:16.</div>
    <div class="content">
     <p>i skipped the heat meter part so now it will only print to serial</p>
<p>&nbsp;</p>
<p>one error thou and i cant figure whats wrong, my fault of course but cant figure it</p>
<p>&nbsp;</p>
<p>sketch so far attach</p>
<p>&nbsp;</p>
<p>error:</p>
<p>&nbsp;</p>
<p>sketch_sep06a.ino: In function &#39;void loop()&#39;:<br />
	sketch_sep06a:174: error: &#39;send_rf_data&#39; was not declared in this scope<br />
	sketch_sep06a:175: error: &#39;emontx_sleep&#39; was not declared in this scope</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23612"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 06/09/2014 - 18:29.</div>
    <div class="content">
     <p>ahh, forgot to save emontx_lib.ino in same folder</p>
<p>&nbsp;</p>
<p>so now just left to figure how to get the data from the heat meter send to emoncms</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23618"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 08:49.</div>
    <div class="content">
     <p>moved read of DS chip etc up in same section as read of meter, in the end it makes more sense to read the meter every say 10 sec and at same time collect temp from DS chip and get numbers from the pulse input</p>
<p>&nbsp;</p>
<p>still i cant get my head arround how to put the numbers from the meter in to the correct variables...</p>
<p>&nbsp;</p>
<p>and also i need to take LED stuff out of this line:&nbsp;digitalWrite(PIN_LED, digitalRead(PIN_KAMSER_RX));</p>
<p>&nbsp;</p>
<p>new sketch attached</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23622"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/09/2014 - 10:51.</div>
    <div class="content">
     <p>Why can&#39;t you get the numbers from the meter in to the correct variables?&nbsp; What you need to find out is where the numbers come from, and where you want them to go to.</p>
<p>I think they come out of line 200 or thereabouts. You need to analyse that bit of code and work out what it&#39;s doing. The function on that line rval = kamDecode(kreg,recvmsg); takes two values in and returns one value. It&#39;s obviously called several times with different inputs, so how can you use that knowledge to put the returned value (because that&#39;s obviously the number you require) into the right place each time? (Hint 1: Where does the literal string &quot;Temperature t1&quot; come from, and what controls which string is printed? Hint 2: look at using a &quot;Switch&quot; statement).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23626"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 15:09.</div>
    <div class="content">
     <p>first of all the sketch that gets the data and just prints them to serial is not my work... its the work of the guy who figured the optical ir head...</p>
<p>&nbsp;</p>
<p>these strings are some i made up so that the data from the meter can be send in same fashion like temp and data from the blinker on the electricity meter....</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int Energy;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int CurrentPower;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Temperaturet1;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Temperaturet2;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Temperaturediff;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Flow;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Volumen1;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Volumen2;</p>
<p>&nbsp;</p>
<p>the names are the same as thou the heater meter uses but without spaces.... i just thought i would need this anyway</p>
<p>but the same ones with spaces does not come from the meter itself, .....</p>
<p>word const kregnums[] = { 0x003C,0x0050,0x0056,0x0057,0x0059,0x004a,0x0044 };<br />
	char* kregstrings[]&nbsp;&nbsp; = { &quot;Energy&quot;,&quot;Current Power&quot;,&quot;Temperature t1&quot;,&quot;Temperature t2&quot;,&quot;Temperature diff&quot;, &quot;Flow&quot;, &quot;Volumen 1&quot; };</p>
<p>what is done is that you ask the meter for register data in form of some hex values.... the first one&nbsp;0x003C&nbsp;is Energy.</p>
<p>so from what i understand is that you build up a string &nbsp;of these hex values and send them off and the meter will return them...&nbsp;</p>
<p>when it returns the data i guess the first vavlue is simply paired with the first string...&nbsp;</p>
<p>&nbsp;</p>
<p>but to make it short your suggestion is above my skills... so i kind of hoped not to be direct spoon feed but so strong pointers that i could guess my way through it...</p>
<p>&nbsp;</p>
<p>but well i will get it one way or the other and then i will order the hardware</p>
<p>&nbsp;</p>
<p>might be that the guy that made the ir interface will help me out</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23627"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 15:11.</div>
    <div class="content">
     <p>but yes looking at your suggestion twice...&nbsp;</p>
<p>&nbsp;</p>
<p>logical i must put in the numbers in the strings as they are decoded and printed to serial...</p>
<p>&nbsp;</p>
<p>hmm... will thinker a bit on that</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23628"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 15:18.</div>
    <div class="content">
     <p>ahh... just a thought</p>
<p>&nbsp;</p>
<p>// print out received value to terminal (debug)<br />
	&nbsp;&nbsp;&nbsp; Serial.print(kregstrings[kreg]);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;: &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(rval);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot; &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.println();<br />
	&nbsp;&nbsp;&nbsp;</p>
<p>&nbsp;</p>
<p>
	&nbsp;&nbsp;&nbsp; return rval;<br />
	&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>before return rval line, put in the vavlue of rval&nbsp;in the first string variable of thse:</p>
<p>&nbsp;</p>
<p>int Energy;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int CurrentPower;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Temperaturet1;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Temperaturet2;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Temperaturediff;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Flow;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Volumen1;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int Volumen2;</p>
<p>&nbsp;</p>
<p>are my logic far off?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23630"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/09/2014 - 15:34.</div>
    <div class="content">
     <p>Bo, I&#39;m trying to teach you how to find your way through the software!</p>
<p>OK, you&#39;re getting close.</p>
<p>What does kreg do? What is the link between kreg and the string it prints at the terminal to tell you what the quantity is?&nbsp;</p>
<p>What is rval - is it always the same variable coming back from the meter, or is it the variable that&#39;s being decoded at this instant?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23631"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 15:45.</div>
    <div class="content">
     <p>kreg is the registers in the meter...&nbsp;</p>
<p>&nbsp;</p>
<p>yes rval is the register value that is beeing decoded.... in the start of the sketch its told how many &nbsp;registers you ask for</p>
<p>&nbsp;</p>
<p>#define NUMREGS 7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Number of registers above</p>
<p>and it will also reply in the &nbsp;order you ask for them</p>
<p>word const kregnums[] = { 0x003C,0x0050,0x0056,0x0057,0x0059,0x004a,0x0044 };</p>
<p>you pair that with the names to make it a bit meaingfull</p>
<p>char* kregstrings[]&nbsp;&nbsp; = { &quot;Energy&quot;,&quot;Current Power&quot;,&quot;Temperature t1&quot;,&quot;Temperature t2&quot;,&quot;Temperature diff&quot;, &quot;Flow&quot;, &quot;Volumen 1&quot; };</p>
<p>&nbsp;</p>
<p>now i&#39;m guessing the sketch, but you ask for the data and loops the amount of registers that have been asked for</p>
<p>&nbsp;</p>
<p>// poll the Kamstrup registers for data<br />
	&nbsp;&nbsp;&nbsp; for (int kreg = 0; kreg &lt; NUMREGS; kreg++) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kamReadReg(kreg);</p>
<p>so it will jump back and forth to this part 7 times</p>
<p>&nbsp;</p>
<p>// kamReadReg - read a Kamstrup register<br />
	float kamReadReg(unsigned short kreg) {</p>
<p>&nbsp; byte recvmsg[30];&nbsp; // buffer of bytes to hold the received data<br />
	&nbsp; float rval;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this will hold the final value</p>
<p>&nbsp; // prepare message to send and send it<br />
	&nbsp; byte sendmsg[] = { 0x3f, 0x10, 0x01, (kregnums[kreg] &gt;&gt; 8), (kregnums[kreg] &amp; 0xff) };<br />
	&nbsp; kamSend(sendmsg, 5);</p>
<p>&nbsp; // listen if we get an answer<br />
	&nbsp; unsigned short rxnum = kamReceive(recvmsg);</p>
<p>&nbsp; // check if number of received bytes &gt; 0<br />
	&nbsp; if(rxnum != 0){<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; // decode the received message<br />
	&nbsp;&nbsp;&nbsp; rval = kamDecode(kreg,recvmsg);</p>
<p>&nbsp;&nbsp;&nbsp; // print out received value to terminal (debug)<br />
	&nbsp;&nbsp;&nbsp; Serial.print(kregstrings[kreg]);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;: &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(rval);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot; &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.println();<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; return rval;<br />
	&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>total nuts or does it get warmer?</p>
<p>&nbsp;</p>
<p>and sorry for this teaching, but i&#39;m a real idiot at writing &nbsp;code... have tried to learn it but have always ended hacking bits together....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23635"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/09/2014 - 19:13.</div>
    <div class="content">
     <p>You are a little bit closer, but you are missing the point I am trying to get to. Almost everything you need to look at is in those debug print statements, so concentrate your attention there. What does Serial.print(kregstrings[kreg]); print when kreg=0, 1, 2, ... ? What does that tell you about what rval represents?</p>
<p>Writing code is not difficult - I agree there are a few keywords and constructs to remember (but in C there are a lot fewer than most languages), the main part is just a matter of following the variables through in a logical manner. When you&#39;ve got the solution, I&#39;ll tell you exactly how I solved it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 19:30.</div>
    <div class="content">
     <p>all i can figure so far is that rval gets updated on each pass of the 7 times i jumps back and forth to get the data....</p>
<p>&nbsp;</p>
<p>not sure i ever get the point of it but will keep looking at it</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23640"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/09/2014 - 21:05.</div>
    <div class="content">
     <p>You wrote &quot;serial out in arduino ide looks like this:</p>
<p class="rteindent1">Energy: 102,47<br />
	Current Power: 0<br />
	Temperature t1: 35,32<br />
	Temperature t2: 30,86<br />
	Temperature diff: 4,46<br />
	Flow: 0<br />
	Volumen 1: 1208,96<br />
	Volumen 2: 0 &quot;</p>
<p>Here is the question I asked myself when I started to look at your problem: How does this get printed? Which print statement prints which part of each line, and what is the value of each variable for each line that is printed?</p>
<p>Because the values you want are in there - the answer <strong><em>must </em></strong>also be in there.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23641"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 21:30.</div>
    <div class="content">
     <p>of course the answer is in there and i know approx how it works...</p>
<p>&nbsp;</p>
<p>you send of one string to the meter where you ask for data on one or more registers...&nbsp;</p>
<p>&nbsp;</p>
<p>it will then send back the data... you first decode the first part and then print it... you then go back and decode the next bit and then back and print that...</p>
<p>&nbsp;</p>
<p>hmm a wild guess here... since we know that order the data comes.... could we get away with another section like this one:</p>
<p>for (int kreg = 0; kreg &lt; NUMREGS; kreg++) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kamReadReg(kreg);</p>
<p>&nbsp;</p>
<p>and place it here where the empty lines are:</p>
<p>&nbsp;</p>
<p>// print out received value to terminal (debug)<br />
	&nbsp;&nbsp;&nbsp; Serial.print(kregstrings[kreg]);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;: &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(rval);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot; &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.println();<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; return rval;</p>
<p>&nbsp;</p>
<p>we know that first time we enter the loop rval&nbsp;will hold the energy figure... next time we run the loop it will have current power... and so on... when we run that loop for the 7th time it should print the Volume&nbsp; number...</p>
<p>&nbsp;</p>
<p>but just guessing here...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23642"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/09/2014 - 21:58.</div>
    <div class="content">
     <p><em>&quot;but just guessing here...&quot;</em>&nbsp; Indeed you are. And you have not answered the question that pointed you towards the answer. There is no need to read anything again - you already have all the information that you need.</p>
<p><em>&quot;you send of one string to the meter where you ask for data on one or more registers...&quot; - </em>True, but not relevant.</p>
<p><em>&quot;it will then send back the data... you first decode the first part and then print it...&quot;</em> Let us stop there. When you print it, what do you know about the values in the print statement at that point? I am trying to get you to work out - from knowing what is printed at the terminal and knowing the code that does the printing, plus knowing how the words are defined up in line 29, what is the actual value in each of the variables in that code.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23643"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 22:04.</div>
    <div class="content">
     <p>that is what is over my head.... i just know that first time it goes through the decode thing its energy etc etc...</p>
<p>&nbsp;</p>
<p>but time to study the inside of my eyelids.... need to reasonable&nbsp;fresh and awake tomorrow</p>
<p>&nbsp;</p>
<p>but will poke my mind some more in the afternoon... not any gurantee that i ever get it</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23645"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/09/2014 - 22:30.</div>
    <div class="content">
     <p>OK, here&#39;s how to do it:</p>
<p>Laying it out so that you can see and compare:</p>
<pre>
Serial.print(kregstrings[kreg]); Serial.print(&quot;: &quot;); Serial.print(rval); Serial.print(&quot; &quot;); Serial.println();
                    Energy                     :                 102,47
</pre><p>That tells me that&nbsp; &quot;kregstrings[kreg]&quot; is &quot;Energy&quot;. Look at line 29 where this is defined:<br />
	char* kregstrings[]&nbsp;&nbsp; = { &quot;Energy&quot;,&quot;Current Power&quot;,&quot;Temperature t1&quot;,&quot;Temperature t2&quot;,&quot;Temperature diff&quot;, &quot;Flow&quot;, &quot;Volumen 1&quot; };</p>
<p>&quot;Energy&quot; is element 0 in the array, therefore to print &quot;Energy&quot;, the value of kreg was zero. Therefore this time around the loop, when kreg is zero, rval holds the value for Energy.&nbsp; When kreg holds the value 3, what does rval represent? - Temperature t2. (Can you see why?)</p>
<p>Therefore, what you need is a piece of program that allocates the value in rval to the appropriate variable in the emontx structure according to the value of kreg.</p>
<p>This is what I think you need, after:</p>
<p class="rteindent1"><em>// decode the received message<br />
	&nbsp;&nbsp;&nbsp; rval = kamDecode(kreg,recvmsg);</em></p>
<p class="rteindent1">switch (kreg) {<br />
	&nbsp; case 0 : emontx.Energy = rval;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp; case 1 : emontx.CurrentPower = rval;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp; case 2 : emontx.Temperaturet1 = rval;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp; case 3 : emontx.Temperaturet2 = rval;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp; case 4 : emontx.Temperaturediff = rval;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp; case 5 : emontx.Flow = rval;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp; case 6 : emontx.Volumen1 = rval;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	&nbsp; case 7 : emontx.Volumen2 = rval;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; break;<br />
	}</p>
<p class="rteindent1"><em>// print out received value to terminal (debug)</em></p>
<p>If you have not met &quot;switch&quot; - read up about it! Depending on kreg, it branches to one of the cases and executes what it finds there, &#39;break&#39; makes it break out and not do the cases below. So it goes on and prints the debugging statements.</p>
<p>Beware - if you have the 8th value (Volumen2), you MUST add that to the definition of kregstrings, else your program will most likely crash when it tries to print the string that does not exist.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23646"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 07/09/2014 - 22:59.</div>
    <div class="content">
     <p>dooh yes...</p>
<p>&nbsp;</p>
<p>i see some light at the end of the tunnel...</p>
<p>&nbsp;</p>
<p>kreg is the counter... so yes..... i feel a bit like a fool now...</p>
<p>&nbsp;</p>
<p>i did remove volumen2 from the sketch as it will always be 0, it meant to count cold water if a pulse device is attached to the meter... in my case not...&nbsp;</p>
<p>&nbsp;</p>
<p><a href="../sites/default/files/sketch_sep06a_1.html" title="http://openenergymonitor.org/emon/sites/default/files/sketch_sep06a_1.ino">http://openenergymonitor.org/emon/sites/default/files/sketch_sep06a_1.ino</a></p>
<p>&nbsp;</p>
<p>will have a look at your post again tomorrow when less knackered...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23650"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 08/09/2014 - 13:23.</div>
    <div class="content">
     <p>have been looking at i cant belive that it was right under my nose the whole time...</p>
<p>&nbsp;</p>
<p>had i just seen what kreg did i would have been so much closer...&nbsp;</p>
<p>&nbsp;</p>
<p>of course this will increment by one at each pass and you just have to put rval in the variables at the right time</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>*giving myself an good slap in the face*</p>
<p>&nbsp;</p>
<p>going to order the emontx v2, should be plenty enough for the role</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23684"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Tue, 09/09/2014 - 19:09.</div>
    <div class="content">
     <p>looked through the code some times... made empty lines the same and moved comments to the right...</p>
<p>could it be worthy as an &quot;official&quot; example when its been tested on hardware? glyn says they ship a huge box today or tomorrow</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23897"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 18/09/2014 - 14:05.</div>
    <div class="content">
     <p>starting to clean up and adjust the sketch so i can start log tonight (with a dash of luck)</p>
<p>&nbsp;</p>
<p>what does this line do?</p>
<p>&nbsp;</p>
<p>#include &lt;avr/wdt.h&gt;</p>
<p>&nbsp;</p>
<p>i know it loads a lib but what is its function?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23898"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 18/09/2014 - 14:28.</div>
    <div class="content">
     <p>watch dog timer of course----&nbsp;</p>
<p>&nbsp;</p>
<p>my guess it makes sure that the unit does not get stuck... so if there is to long time between the watchdog is reset it will reboot?</p>
<p>&nbsp;</p>
<p>if (UNO) wdt_enable(WDTO_8S);&nbsp;</p>
<p>&nbsp;</p>
<p>does that set the interval to 8 sec? so if i transmit say every 5 mins i have to adjust here ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23899"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 18/09/2014 - 14:34.</div>
    <div class="content">
     <p>So i tried to clean it up as best i could</p>
<p>Sketch attached....</p>
<p>&nbsp;</p>
<p>But are there room for improvement?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23900"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 18/09/2014 - 15:14.</div>
    <div class="content">
     <p>Almost success</p>
<p>&nbsp;</p>
<p>serial output from from arduino IDE:</p>
<p>&nbsp;</p>
<p>0 W<br />
	0 Pulses<br />
	Hot water cylinder is 2612 Degrees C<br />
	Total energy consumed on district hot water: 102 Gj<br />
	Current energy consumption on district hot water: 0 Kw<br />
	Incomming temp on district hot water: 35 Degrees C<br />
	Outgoing temp on district hot water: 34 Degrees C<br />
	Difference in temp on district hot water: 1 Degrees C<br />
	Curre&icirc;&euro;&euro;&euro;&yuml;&euro;&euro;&euro;&yuml;&yuml;&yuml;&yuml;&yuml;z&sup1; &lsquo;&yen;&Iacute;&Ntilde;&Eacute;&yen; &Ntilde; &euml;&lsaquo;&yuml; water: 0 Ltr./h<br />
	Total volumen: 1213 M3</p>
<p>&nbsp;</p>
<p>2nd&nbsp;line from buttom... i cant quite figure why these bogus signs show up...</p>
<p>&nbsp;</p>
<p>when it prints to serial it pauses right there and then prints the rest on the next go....&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23901"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 18/09/2014 - 16:10.</div>
    <div class="content">
     <p>Sending an RF message shortly after using Serial.print() can mess up the display.&nbsp;</p>
<p>If you comment out the send_rf_data() line or equivalent, this symptom may go away ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23902"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 18/09/2014 - 16:23.</div>
    <div class="content">
     <p>oki, will try it after dinner is over</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23904"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 18/09/2014 - 17:29.</div>
    <div class="content">
     <p>the lenght of bogus chars are now down to 3</p>
<p>i commencted out the send rf&nbsp;line... think i will need a delay also</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23905"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Thu, 18/09/2014 - 17:40.</div>
    <div class="content">
     <p>delay sorted it... 100ms&nbsp;was enough</p>
<p>&nbsp;</p>
<p>sketch with RF commented out attached</p>
<p>&nbsp;</p>
<p>is there anything i can do to improve it and make it so it could become a example on git ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23911"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 18/09/2014 - 23:27.</div>
    <div class="content">
     <p>You asked....</p>
<p>You don&#39;t use the array char* units[65], so that can all go.<br />
	It might be clearer if you called your temperatures &quot;TemperatureT1&quot; etc - but that&#39;s a personal preference.<br />
	&quot;Kamstrup Stuff Start&quot; should be &quot;end&quot; in line 108.<br />
	You probably need to warn that 57600 Baud needs to be set in the IDE - we normally use 9600.<br />
	We spell the word &quot;Incoming&quot;.<br />
	Are you happy with sending the temperatures in degrees? Would it be better to multiply rval by 10 when assigning to TemperatureT1 etc, and send tenths of a degree, to give better precision?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23926"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Fri, 19/09/2014 - 07:40.</div>
    <div class="content">
     <p>oki...&nbsp;</p>
<p>&nbsp;</p>
<p>yep i had a few thoughts after i got to bed...</p>
<p>&nbsp;</p>
<p>but array&nbsp;char is deff one of them.... i guess it has just stayed as a place holder for what the kamstrup protocol has to offer, but its not all meters that have all those numbers... electricity meters from kamstrup have some of them but not all, and the heat meters have others etc etc...</p>
<p>so off it goes....</p>
<p>also correcting temperatures....</p>
<p>as for BAUD... is there much difference in the speed i use versus 9600 ? i could go down to 9600 if it does not matter</p>
<p>Incoming will be corrected too...</p>
<p>&nbsp;</p>
<p>hehehe... funny you should mentioned if i&#39;m happy.... last thing i noted before going to sleep was that is sends the temp in whole numbers and not with decimals or at least as a 4 digit number i can process in emoncms... same goes for the temp probe in the hot water cylinder... but that is my own fault</p>
<p>&nbsp;</p>
<p>time for breakfast as i edit</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23927"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Fri, 19/09/2014 - 08:09.</div>
    <div class="content">
     <p>btw... should i not multiply rval by 100 to get 4 digits numbers just like when doing a ds18b20 ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23929"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Fri, 19/09/2014 - 09:48.</div>
    <div class="content">
     <p>so i had a small play with it..</p>
<p>&nbsp;</p>
<p>baud is still unchanged but can change it if the speed does not matter</p>
<p>&nbsp;</p>
<p>new sketch attached</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23974"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Fri, 19/09/2014 - 14:33.</div>
    <div class="content">
     <p>now that i got data in to emoncms there is one clear thing</p>
<p>&nbsp;</p>
<p>total vol&nbsp;on the meter is a 4 digit number with 2 decimals... but on emoncms&nbsp;it becomes a negative number...</p>
<p>&nbsp;</p>
<p>i assume the order of the inputs in emoncms&nbsp;is the same as transmit order</p>
<p>&nbsp;</p>
<p>i opted to multiply rval with 100, but maybe it should really only be 10?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23975"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Fri, 19/09/2014 - 14:48.</div>
    <div class="content">
     <p>now multiplying by 10 and the number is now positive but 1 decimal missing...</p>
<p>&nbsp;</p>
<p>what can i do to get the last one?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23977"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Fri, 19/09/2014 - 15:16.</div>
    <div class="content">
     <p><em><em>total vol on the meter is a 4 digit number with 2 decimals... but on emoncms it becomes a negative number...</em></em></p>
<p>So biggest possible number is 9999,99?</p>
<p>Try to split the value into two parts (e.g. integer part and decimal part) and send as two values. Recombine on Emoncms side.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24006"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 20/09/2014 - 13:49.</div>
    <div class="content">
     <p>yep that is the biggest number....</p>
<p>&nbsp;</p>
<p>just need to find an example on how to split it and copy the idea in to my sketch</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24009"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sat, 20/09/2014 - 14:37.</div>
    <div class="content">
     <p>Something like this:</p>
<pre>
float val;
uint16_t val_high, val_low;

val = 1234.56;
val_high = (uint16_t) val;
val_low = (uint16_t)((val-val_high)*100.0);</pre><p>Not very &#39;clean&#39; but should work.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24010"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 20/09/2014 - 14:38.</div>
    <div class="content">
     <p>If you put a long integer in your Payload structure, it is still transmitted as byte values. Inside emoncms, those bytes are interpreted two at a time as 2-byte integers. If you have a long integer, it takes up 4 bytes, the same space as two short integers, therefore inside emoncms the maths you need is [first value] + 65536 x [second value]. But beware the sign bit on [first value], which you need to ignore, so test for a negative first and add 65536 if so.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24011"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 20/09/2014 - 14:51.</div>
    <div class="content">
     <p>If you are using emonhub&nbsp;you are no longer tied to using just signed ints. you can use several data types and emonhub will decode them if you set the &quot;datacodes&quot; string for the node in the [nodes] section of emonhub.conf</p>
<p>So you could use a signed long instead of a signed int&nbsp;then you can multiply your float value by 100 in the sketch and multiply by 0.01 in the input processing of emoncms. ( a future version of emonhub&nbsp;will do scaling also but for now use emoncms )</p>
<p>Assuming for the moment you only need to change the one value you could change your existing payload to&nbsp;</p>
<blockquote><p>typedef struct {<br />
		&nbsp; int power;<br />
		&nbsp; int pulse;<br />
		&nbsp; int temp;<br />
		&nbsp; int Energy;<br />
		&nbsp; int CurrentPower;<br />
		&nbsp; int Temperaturet1;<br />
		&nbsp; int Temperaturet2;<br />
		&nbsp; int Temperaturediff;<br />
		&nbsp; int Flow;<br />
		&nbsp; <strong>long </strong>Volumen1;<br />
		} Payload;<br />
		Payload emontx;</p>
</blockquote>
<p>and that values &quot;case&quot; line in the sketch to</p>
<blockquote><p>case 6 : emontx.Volumen1 = (long)(rval*100+0.5);</p>
</blockquote>
<p>In emonhub.conf [nodes] section</p>
<blockquote><p>[[5]]</p>
<p>datacodes = h, h, h, h, h, h, h, h, h, l,</p>
</blockquote>
<p>This will tell emonhub to decode all node 5&#39;s packets as 9 ints and a long rather than the default all ints.</p>
<p>It sound more complex than it is, basically you are just setting the payload structure in your sketch before tx over rf then telling emonhun&nbsp;what that structure is so that it can defode the rf packet (payload)</p>
<p>Until fairly recently all sketches only used ints and all rfm2pi software decoded packets assuming they consisted only of ints&nbsp;so emonhub&nbsp;defaults to ints for compatability but you can use many data types now see</p>
<p><a href="5289.html">http://openenergymonitor.org/emon/node/5289</a>&nbsp;for more info&nbsp;<img alt="" src="../sites/default/files/datatypes2_0.png" style="width: 474px; height: 203px;" /></p>
<p>Paul</p>
<p>EDIT - Sorry Robert, took me a while to write and you&#39;ve posted in the meantime</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24012"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sat, 20/09/2014 - 15:03.</div>
    <div class="content">
     <p>Oh, this is very nice to know!</p>
<p>Then it would be even easier (faster) to send the float value and use the f parameter in datacodes ?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24016"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 20/09/2014 - 15:21.</div>
    <div class="content">
     <p>i didn&#39;t suggest that as I have not yet tested floats and whilst researching how to do these data conversions I was put off using floats altogether by the way they work in 0.125&#39;s rather than 0.1&#39;s it just seems horrendous to me so I like the scaling option. but please by all means give it a try I would love to know if its worth keeping the float option in emonhub.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24019"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 20/09/2014 - 15:30.</div>
    <div class="content">
     <p>i use the low write version of emoncms.... but i have edited&nbsp;emonhub.conf so i guess its emonhub still....</p>
<p>&nbsp;</p>
<p>will test it either tomorrow or during the week...&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24020"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sat, 20/09/2014 - 16:37.</div>
    <div class="content">
     <p><em>but please by all means give it a try .....</em></p>
<p>I have created a kWh counter with 0.001kWh resolution and send the value as float, decoded with f option and it works!!!</p>
<p>Resolution in Emoncms is 0.01 (value shown in Inputs!) but the value is decoded correctly.</p>
<p>Crosschecked with a constant float value of 876.5432 which is also decoded correctly.</p>
<p>So, please keep the float option :-))</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24021"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 20/09/2014 - 18:46.</div>
    <div class="content">
     <p>Fantastic, thanks for trying that&nbsp;J&ouml;rg. I guess floats are staying then :-)</p>
<p>In which case boelle, you should be able to just change the payload to define a float data type</p>
<blockquote><p>typedef struct {<br />
		&nbsp; int power;<br />
		&nbsp; int pulse;<br />
		&nbsp; int temp;<br />
		&nbsp; int Energy;<br />
		&nbsp; int CurrentPower;<br />
		&nbsp; int Temperaturet1;<br />
		&nbsp; int Temperaturet2;<br />
		&nbsp; int Temperaturediff;<br />
		&nbsp; int Flow;<br />
		&nbsp; <strong>float&nbsp;</strong>Volumen1;<br />
		} Payload;<br />
		Payload emontx;</p>
</blockquote>
<p>and add the datatypes for node 5 to emonhub.conf</p>
<blockquote><p>[[5]]</p>
<p>datacodes = h, h, h, h, h, h, h, h, h, <strong>f</strong>,</p>
</blockquote>
<p>&nbsp;</p>
<p>&nbsp;</p>
<blockquote><p>&nbsp;</p>
</blockquote>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24022"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 20/09/2014 - 19:15.</div>
    <div class="content">
     <p>So i dont need to alter the case stuff? ie</p>
<p>&nbsp;</p>
<p>case 6 : emontx.Volumen1 = (long)(rval*100+0.5);</p>
<p>&nbsp;</p>
<p>?</p>
<p>&nbsp;</p>
<p>i wondered why add 0.5 ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24025"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sat, 20/09/2014 - 20:54.</div>
    <div class="content">
     <p><em>i wondered why add 0.5 ?</em></p>
<p>(long)1.943 = 1</p>
<p>(long)(1.943+0.5) = (long)2.443 = 2</p>
<p>Conversion from float to Integer truncates. You get the nearest integer by adding 0.5 before conversion.</p>
<p>You can do a similar thing in integer divisions:</p>
<p>instead of:</p>
<p>val = val/980;</p>
<p>you get a &#39;better&#39; (= nearer) result by doing:</p>
<p>val = (val+980/2)/980;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24026"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 20/09/2014 - 21:13.</div>
    <div class="content">
     <p>so let&#39;s say rval is 15.34 there is no way i can get that exact number to emoncms?</p>
<p>&nbsp;</p>
<p>i just chekced up on the sketch and rval is a float... so could i get by changing all variables that i send to emoncms to floats also?</p>
<p>ie:</p>
<p>int power;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // power<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int pulse;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // pulses<br />
	&nbsp;&nbsp;&nbsp;&nbsp; int temp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // temperature of hotwater cylinder</p>
<p>&nbsp;<br />
	//********************************************Kamstrup Stuff Start********************************************</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;Energy;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;CurrentPower;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;TemperatureT1;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;TemperatureT2;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;TemperatureDiff;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float Flow;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; float&nbsp;Volumen1;</p>
<p>&nbsp;</p>
<p>i also discovered that temp is a float further down:</p>
<p>&nbsp;</p>
<p>float temp=(sensors.getTempCByIndex(0));</p>
<p>&nbsp;</p>
<p>should i correct the first temp to float also? just to keep it the same</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24027"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 20/09/2014 - 21:20.</div>
    <div class="content">
     <p>also i saw these 2 lines:</p>
<p>&nbsp;</p>
<p>digitalWrite(PIN_LED, digitalRead(PIN_KAMSER_RX));<br />
	&nbsp; delay(1000);</p>
<p>&nbsp;</p>
<p>that adds 1 sec of delay... could i get rid of it without much trouble? i pull data at 5 sec interval allready&nbsp;and this delay would really make it 6 right?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24028"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sat, 20/09/2014 - 21:51.</div>
    <div class="content">
     <p><em>so let&#39;s say rval is 15.34 there is no way i can get that exact number to emoncms?</em></p>
<p>there are different ways to transfer this value &#39;exactly&#39; to Emoncms:</p>
<p>- multiply by 100: 15.34*100 = 1534.0, convert to integer long with (long)(1534.0+0.5)&nbsp; and transfer as integer long</p>
<p>- transfer as float (with the f option on the input decoder as described above)</p>
<p>&nbsp;</p>
<p>You may change every value to float but float calculations in general need much more processing time (and double the space) compared to 16 bit integers. And if the range of possible values is small, this is simply overkill.&nbsp;</p>
<p>(and the &#39;accuracy&#39; of a float variable is exactly the same as that of a long, because both use 4 bytes and can have 2^32 possible different values)&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24029"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sat, 20/09/2014 - 21:42.</div>
    <div class="content">
     <p><em>i pull data at 5 sec interval allready and this delay would really make it 6 right?</em></p>
<p>Yes, if you do it like this (taken from your sketch):</p>
<pre>
if(millis() - lastpoll &gt; POLLINTERVAL or lastpoll == 0)

{
  // poll the Kamstrup registers for data
    for (int kreg = 0; kreg &lt; NUMREGS; kreg++) {
      kamReadReg(kreg);
      delay(100);
    }

      digitalWrite(PIN_LED, digitalRead(PIN_KAMSER_RX));
  delay(1000);

    // update lastpoll
    lastpoll = millis();

......

}</pre><p>The &#39;real&#39; poll interval will be at least POLLINTERVAL + (100*NUMREGS) + 1000 ms. I would not do it this way but rather like this:</p>
<pre>
uint32_t tmpL = millis()

if(tmpL - lastpoll &gt;= POLLINTERVAL or lastpoll == 0)

{
  // update lastpoll
  lastpoll = tmpL;

  // poll the Kamstrup registers for data
    for (int kreg = 0; kreg &lt; NUMREGS; kreg++) {
      kamReadReg(kreg);
      delay(100);
    }

      digitalWrite(PIN_LED, digitalRead(PIN_KAMSER_RX));
  delay(1000);

......</pre><p>}</p>
<p>This gives an exact polling intervall of POLLINTERVAL ms (as long as the code within the if clause takes less than POLLINTERVAL ms processing time). I think you can see the difference.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24044"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 10:31.</div>
    <div class="content">
     <blockquote><p>i also discovered that temp is a float further down:</p>
<p>&nbsp;</p>
<p>float temp=(sensors.getTempCByIndex(0));</p>
<p>&nbsp;</p>
<p>should i correct the first temp to float also? just to keep it the same</p>
</blockquote>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24045"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 10:41.</div>
    <div class="content">
     <p>or are the 2 temps different ones?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24046"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 11:51.</div>
    <div class="content">
     <p>Which 2?</p>
<p>Are you talking about the member &#39;temp&#39; in the payload struct emontx? This is for sure a completely different variable than the float temp declared further down in the sketch.</p>
<p>But, in your sketch you first read the temperature value from the sensor into the float variable temp and then immediately &#39;copy&#39; it into the struct member emontx.temp, which is an int:</p>
<pre>
float temp=(sensors.getTempCByIndex(0));
emontx.temp=temp;</pre><p>This gives the same result as if you directly read into emontx.temp:</p>
<p>emontx.temp=(sensors.getTempCByIndex(0));<br />
	&nbsp;</p>
<p>Now it is your decision if you change the type of emontx.temp from int to float. But if you do, you have to inform the decoder in emonhub that you are sending a float (f option).</p>
<p>&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24047"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 21/09/2014 - 12:03.</div>
    <div class="content">
     <p>Depending on the range you need, if you could also use</p>
<blockquote><p>emontx.temp=(sensors.getTempCByIndex(0) * 100 + 0.5 );</p>
</blockquote>
<p>in place of those 2 lines, then you would get a range of -327.68 to 327.67 by just multiplying by 0.01 in emoncms and only use 2bytes rather than 4.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24048"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 13:01.</div>
    <div class="content">
     <p>yep...&nbsp;</p>
<p>&nbsp;</p>
<p>it was those 2.. i was just unsure about it.... dont want to screw things up more than need be :-D</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24049"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 13:02.</div>
    <div class="content">
     <p>i tend to like the float option... thou it might be overkill.... but it makes life simple :-D at cost ot space</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24053"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 19:12.</div>
    <div class="content">
     <p>so i&#39;m trying to float option and the feed values are right... ie my hot water temp is 38.94</p>
<p>total energy is&nbsp;102.67 but in the input list its shown as 103... &nbsp;the temp above is shown as 38.9</p>
<p>&nbsp;</p>
<p>another is the incoming temp, feed value is&nbsp;34.56 but is shown as &nbsp;34.6</p>
<p>&nbsp;</p>
<p>the dashboard seems odd... one of the temp dials for district heating is 2 decimals and the others are not</p>
<p>temp gauge on the hot water cylinder is also only single decimal...&nbsp;</p>
<p>&nbsp;</p>
<p>are there some rounding off going on? or can i decide how many decimals to use?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24054"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 19:14.</div>
    <div class="content">
     <p>also my kwh&nbsp;is now negative... i i have set up an input processor that takes watt and turns then to kwh...&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24055"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 19:18.</div>
    <div class="content">
     <p>deleted the kwh&nbsp;feed and processor and created them again... so far it seems ok</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24056"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 19:43.</div>
    <div class="content">
     <p><em>also my kwh is now negative...</em></p>
<p>If this happens after a reboot, this could be due to a bug in the pre-configured image. I had this a couple of times now. Paul (pb66) and I tried to find the reason for it and it seems that it is due to missing real time information in the first seconds after reboot and before time information is fetched via ntp.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24057"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 19:48.</div>
    <div class="content">
     <p>attached are pics of the temp list... and a pic of the feed value for one of them... why is it 1 decimal on the list but when you look at feed value is not?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24059"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 20:23.</div>
    <div class="content">
     <p>This is just how someone (Trystan) decided to present the values.</p>
<p>If you use the values on your dashboards, you can decide how many decimals you want (possibly not for all widgets but for example for the &#39;feedvalue&#39; widget).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24060"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 21:48.</div>
    <div class="content">
     <p><em>you can decide how many decimals you want</em></p>
<p>&nbsp;</p>
<p>how do decide that? i want it to be 2 decimals for most of it...&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24061"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 21:53.</div>
    <div class="content">
     <p>in fact i would like the 2 decimals on both input list, feed list and on dashboard</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24063"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 22:29.</div>
    <div class="content">
     <p>But input list and feed list are for &#39;internal&#39; use only.</p>
<p>On the dashboard the &#39;feedvalue&#39; widget has a parameter for the number of decimals. Similar settings can be done for a number of other visualizations.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24064"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 22:37.</div>
    <div class="content">
     <p>well the dial vis does not have it... but sometimes it shows 2 deciamls and some times it does not</p>
<p>&nbsp;</p>
<p>and the same comes with the value in the feed and input list... some are 2 decimals and some are 1....</p>
<p>&nbsp;</p>
<p>*sigh*</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24065"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 22:40.</div>
    <div class="content">
     <p><a href="http://energymonitor-dk.dns4e.net/emoncms/boelle/heat" title="http://energymonitor-dk.dns4e.net/emoncms/boelle/heat">http://energymonitor-dk.dns4e.net/emoncms/boelle/heat</a></p>
<p>&nbsp;</p>
<p>look and the temp in and out and diff... there are not settings for decimals and yet they differ...</p>
<p>&nbsp;</p>
<p>try and compare that with my pic of the feed list... strange right?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24066"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 23:03.</div>
    <div class="content">
     <p><em>well the dial vis does not have it... but sometimes it shows 2 deciamls and some times it does not</em></p>
<p>Yes, thats right. The dials have no settings for decimals. This is why I wrote that only some of the widgets have these settings.</p>
<p><em>look and the temp in and out and diff... there are not settings for decimals and yet they differ...</em></p>
<p>In the black center of the dials you only have very limited space tp print the number. It would not be possible to print a 4 digit number with 6 decimals. So the code decides how many decimals to print. If the value is below 10, it prints two decimals, between 10 and 100 it prints 1 decimal and above 100 no decimals. But you can easily modify the code to change that.</p>
<p>If you want to understand these things better, look into the code.</p>
<p>&nbsp;</p>
<p><em>try and compare that with my pic of the feed list... strange right?</em></p>
<p>No, not really. It has been decided to print it this way (and you are free to change it). Similar reasons as with the dial widget. Smaller numbers are printed with more decimals than bigger numbers.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24067"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 23:06.</div>
    <div class="content">
     <p>ok... and what file should i start to look at to change it for the dials and the cylinder symbol?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24069"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 23:32.</div>
    <div class="content">
     <p>for example:</p>
<p>/var/www/emoncms/Modules/dashboard/Views/js/widgets/dial/dial_render.js</p>
<p>starting from line 274 there is this code:</p>
<pre>
if (isNaN(val))  val = 0;

    else if (val&gt;=100)
        val = val.toFixed(0);
    else if (val&gt;=10)
        val = val.toFixed(1);
    else if (val&lt;=-100)
        val = val.toFixed(0);
    else if (val&lt;=-10)
        val = val.toFixed(1);
    else
        val = val.toFixed(2);</pre><p>which is responsible for the formatting of the printout.</p>
<p>/var/www/emoncms/Modules/dashboard/Views/js/widgets/dial/cylinder_render.js</p>
<p>starting from line 118:</p>
<pre>
    ctx.fillText(cyl_top.toFixed(1)+&quot;C&quot;,midx,top_pos);
    ctx.fillText(cyl_bot.toFixed(1)+&quot;C&quot;,midx,bot_pos+15);</pre><p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24070"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 23:26.</div>
    <div class="content">
     <p>and i guess the number in the () says how many digits total? or is it decimal?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24072"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 23:30.</div>
    <div class="content">
     <p>Google tells me:</p>
<p>The toFixed() method converts a number into a string, keeping a specified number of decimals.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24073"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 23:31.</div>
    <div class="content">
     <p>i set it to 3 in all of them and no change... so i must be doing it wrong</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24074"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 23:32.</div>
    <div class="content">
     <p>try to clear the browser cache .....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24075"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 23:35.</div>
    <div class="content">
     <p>thanks...that did it</p>
<p>&nbsp;</p>
<p>and i guess i have to look for the same to change the cylinder?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24076"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Sun, 21/09/2014 - 23:36.</div>
    <div class="content">
     <p>see above!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24077"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 21/09/2014 - 23:46.</div>
    <div class="content">
     <p>doh yes...&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24078"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 00:21.</div>
    <div class="content">
     <p>oh well....</p>
<p>&nbsp;</p>
<p>now the feeds are not saved to graphs does not work...</p>
<p>&nbsp;</p>
<p>even tried to delete the feed and create them again...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24079"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 00:52.</div>
    <div class="content">
     <p>changed everything back</p>
<p>deleted the feeds and recreated them...</p>
<p>&nbsp;</p>
<p>still it does not save to disk anymore... ie feed size stays 0 kb</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24080"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 22/09/2014 - 02:43.</div>
    <div class="content">
     <p><em>i wondered why add 0.5 ?</em></p>
<p><em>Conversion from float to Integer truncates. You get the nearest integer by adding 0.5 before conversion.</em></p>
<p>But in general you&#39;ll get it a lot faster if you use the lrint() family of functions rather than force a floating point addition into the mix. &nbsp;When done in software (like on the AVR), a truncate-and-convert-to-int costs about the same as a round-and-convert-to-int, so if you want the rounded version you can save yourself a floating point addition by just asking for it.</p>
<p>In some pre-SSE3&nbsp;FPU architectures (not an issue for the AVR) a truncate can be extremely expensive because it involves reconfiguring the FPU&nbsp;global rounding mode (with associated pipeline flushes) into truncate mode. &nbsp;In those architectures you really want to avoid a truncate unless of course that&#39;s what you&#39;re really after. &nbsp;The SSE3 introduced a truncate instruction which removed that quirk. &nbsp;But even then, you can still avoid a floating point addition by calling for rounding when you want rounding.</p>
<p>A quick test on the AVR&nbsp;reveals:</p>
<p>Volumen1 = lrintf(rval*100.0); &nbsp;</p>
<p>is way faster than</p>
<p>Volumen1 = (long)(rval*100.0+0.5);</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24082"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Mon, 22/09/2014 - 07:49.</div>
    <div class="content">
     <p><em>Volumen1 = lrintf(rval*100.0);&nbsp;</em></p>
<p><em>is way faster than</em></p>
<p><em>Volumen1 = (long)(rval*100.0+0.5);</em></p>
<p>Good to know (although I try to avoid floats at all). In which library are these functions buried?</p>
<p>EDIT: Ok, found it. lrint is included in math.h</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24083"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Mon, 22/09/2014 - 07:54.</div>
    <div class="content">
     <p><em>Good to know (although I try to avoid floats at all)</em></p>
<p>Me too, even on my i7 with the mother of all FPUs, and absolutely on a little AVR. &nbsp;I just did some scope timing of the above 2 statements on a 16MHz AVR and it&#39;s roughly 23.6 usecs Vs 15 usecs.</p>
<p><em>In which library are these functions buried?</em></p>
<p>Should be in the standard math lib since about C99 I think.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24084"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 08:36.</div>
    <div class="content">
     <p>this is not the problem right now....</p>
<p>&nbsp;</p>
<p>now it will not save the feeds and hence graphs does not work,...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24085"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 08:38.</div>
    <div class="content">
     <p>and then now it does...</p>
<p>&nbsp;</p>
<p>all i did last night was to cold boot... ie&nbsp;power off external hard drive and the pi and this morning i booted and refreshed the feed list and now i grows</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24086"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 09:04.</div>
    <div class="content">
     <p>and now they are 0 again and not growing...</p>
<p>&nbsp;</p>
<p>once they all worked i wanted to start fresh data vise so removed all feeds and created them again...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24087"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 09:20.</div>
    <div class="content">
     <p>what could cause this strange behaveour ?&nbsp;</p>
<p>&nbsp;</p>
<p>when i create the power to kwh feed the value of it starts to climb... but the feed size does not...&nbsp;</p>
<p>&nbsp;</p>
<p>like something prevents that the feed is saved...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24088"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 09:24.</div>
    <div class="content">
     <p>also just noted that even thou i send data at approx 5 sec interval the input list can say up to 11 sec between updates...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24091"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 09:43.</div>
    <div class="content">
     <p>and the issue is the same whatever i choose local ip&nbsp;or wan ip</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24092"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Merging 2 sketches...</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Mon, 22/09/2014 - 11:09.</div>
    <div class="content">
     <p>discussion on the not saving issue continues here:&nbsp;http://openenergymonitor.org/emon/node/5811</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5718"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-n4w_gLWcGcB8ZAAUrbwBvfhzQe_l94KN66eEUl61ZWE" value="form-n4w_gLWcGcB8ZAAUrbwBvfhzQe_l94KN66eEUl61ZWE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/5718 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:02:20 GMT -->
</html>
