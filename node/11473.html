<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>V9.0 RC2 Daylight saving time bug | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/5">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">V9.0 RC2 Daylight saving time bug</h3>
        <span class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Sun, 25/10/2015 - 11:48</span>
        <div class="content"><p>Hi,</p>
<p>Some of my feeds have become corrupt showing negative values for today. It seems to happen to my KWH/D feeds showing no data anymore for the current day as well as in the my electric app with a power to kwh feed. It displays negative values for power used today as well as for the averages for daily, weekly, monthly and yearly.</p>
<p>&nbsp;</p>
<p>I&#39;ve found a thread from 2014 were people were having the same problem and it seems it still is not fixed in v9.0 RC2.</p>
<p>my 2 questions :</p>
<p>1) is there a way to fix the data or will it get fixed automaitcally tomorrow or so ?</p>
<p>2) how to prevent this from happening in the future ? i don&#39;t want to delete all my feeds every 6 months when daylight saving time happens, then emoncms becomes totally usesless for me as the main point for me is to have historical data. I don&#39;t use emoncms that long so i can still restart if there is a ways to prevent this from happening</p>
<p>here&#39;s a picture of the data of one of my power to kwh feeds:</p>
<p><img alt="" src="http://www.willemssoft.be/misc/power%20to%20kwh.JPG" style="width: 682px; height: 567px;" />some more info:</p>
<p>i&#39;m running a local version of emoncms v9.0 rc2 on intel nuc&nbsp; running windows 7 using wamp. The data gets entered using the input api like so : 2015/10/25 13:05:18 <a href="http://127.0.0.1:8083/emoncmsnew/input/post.json?node=3&amp;apikey=myapikey&amp;csv=0.38,44.20,4.35,225.65">http://127.0.0.1:8083/emoncmsnew/input/post.json?node=3&amp;apikey=myapikey&amp;csv=0.38,44.20,4.35,225.65</a></p>
<p>EDIT:</p>
<p>After some testing i found out that the script that was used to recalculate the power to kwh (after modifying it to make it work)&nbsp;feeds does work and all data is correct. However as soon as you post 1 new entry using the input api you can see it goes to negative values again as per this screenshot of the rawdata after i had run the script to recalculate this power to kwh feed.</p>
<p>My user&#39;s timezone is set to Europe/brussels, the same goes for apache&#39;s httpd.conf and php.ini all set to europe/brussels</p>
<p><img alt="" src="http://www.willemssoft.be/misc/rawdata.JPG" style="width: 489px; height: 561px;" /></p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/11518" class="topic-previous" title="Go to previous forum topic">‹ Can&#039;t connect to local MySQL server through socket &#039;/var/run/mysqld/mysqld.sock&#039; (2) [SOLVED]</a>
              <a href="/emon/node/11525" class="topic-next" title="Go to next forum topic">power_to_kwh script bug ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-35332"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Sun, 25/10/2015 - 12:17.</div>
    <div class="content">
     <p>Same here.</p>
<p>Paul<br />
Self hosted on Raspberry Pi, v9.0RC&nbsp;</p>
<p><img alt="" src="http://openenergymonitor.org/emon/sites/default/files/screen_2.png" style="width: 720px; height: 405px;" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35334"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Sun, 25/10/2015 - 15:10.</div>
    <div class="content">
     <p>i managed to recalculate my kwh feed by using and first modifying the power_to_kwh_manual.php script from the usefullscripts repository. you have to remove all references to the log also in the proces\lib folder replace the logging with just an echo so you do see the output.</p>
<p>My kwh feed is now correct yet the my electric app for some reason still shows negative numbers. I already cleared cache and tried in 2 browsers.</p>
<p>Also that script only fixes my kwh feeds, it does not fix my kdh/d feeds</p>
<p>edit:</p>
<p>it seems recalculating has no effect as soon as i post data again it shows the same effect as in my earlier screenshot. And my electric keeps showing negative numbers so the recalculating script which worked in 2014 does not seem to work that good for now. it just goes back to negative but on a later timestamp (after i had recalculated the feed). Also my timezone is set to europe / brussels also in php.ini</p>
<p><img alt="" src="http://www.willemssoft.be/misc/power%20to%20kwh2.JPG" style="width: 547px; height: 463px;" /></p>
<p>edit 2: i&#39;ve now set my timezone in apache httpd conf as well like so :</p>
<p>SetEnv TZ Europe/Brussels</p>
<p>this was not set in httpd.conf before. i&#39;m not certain if this fixed it or if it got autofixed somehow but now my kwh feed seems to be on track again. The only problem i&#39;m having seems to be getting rid of that dip. If i recalc using the recalc script i for some reason keep having the same dip in my graph data. my powerfeed is PHPFIWA don&#39;t know if that matters (i changed the source engine to this) the target engine is still PHPFINA</p>
<p><img alt="" src="http://www.willemssoft.be/misc/power%20to%20kwh3.JPG" style="width: 542px; height: 403px;" /></p>
<p>&nbsp;</p>
<p><s>edit 3: the kwh feed above seems to be fixed now with me. the recalc script only deleted&nbsp;the target&nbsp;feed if the source feed was phpfina&nbsp;i changed that line to phpfiwa and now the kwd feed in above screenshot is fixed.</s></p>
<p><s>However i have multiple power &amp; power&nbsp;to kwh feeds in total 5 of each 2 of them seem to be fixed now also when posting new data, the 3 others are not and i&#39;m clueless as to why&nbsp;some feeds&nbsp;are still&nbsp;not working while&nbsp;others are all of a sudden&nbsp;</s></p>
<p>&nbsp;</p>
<p>edit 4: it seems i was wrong, looking at the raw data i can see a dip each time after i recalculated the values using the script. The only reason it seemed it was showing correct data was because it had caught up with the values it had lost all my kwh feed still show the dip after recalculating. So nothing is fixed with me not even after recalculating</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35337"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Sun, 25/10/2015 - 15:24.</div>
    <div class="content">
     <p>I can&#39;t even get the scripts to run!!</p>
<p>If I run power_to_kwh.php (in usefulscripts), I get:</p>
<pre>
PHP Fatal error: &nbsp;Call to undefined function readline() in /home/pi/usefulscripts/process/power_to_kwh.php on line 12</pre><p>If I run&nbsp;power_to_kwh_manual.php (again in usefulscripts) I get:</p>
<pre>
PHP Fatal error: &nbsp;require(): Failed opening required &#39;Modules/log/EmonLogger.php&#39;
 (include_path=&#39;.:/usr/share/php:/usr/share/pear&#39;) in /home/pi/usefulscripts/process/power_to_kwh_manual.php on line 11</pre><p>If I add that line, and re-run the script, I get:</p>
<pre>
PHP Parse error: &nbsp;syntax error, unexpected &#39;=&#39; in /home/pi/usefulscripts/process/power_to_kwh_manual.php on line 11</pre><p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35338"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Sun, 25/10/2015 - 15:46.</div>
    <div class="content">
     <p>you need to run the other script power_to_kwh_manual.php and edit the php script by removing the require log thingie as well als all $log-&gt; entries (replace them with echo statements) you need to do this for all the files in the process directory including the lib folder. then the &nbsp;power_to_kwh_manual.php will work, i also changed the check for phpfina to phpfiwa where it would delete the files of the target feed and had set source engine to phpfiwa since well that&#39;s the case with me. then this script will work.</p>
<p>the other script i could not get working either i managed to fix the readline thing by adding this function but there are other problems in that script it&#39;s easier and faster (to edit) power_to_kwh_manual.php&nbsp; only thing you have to do is remove the log references at least that was the case with me since that logging thing doesn&#39;t seem to exist&nbsp;anymore&nbsp;</p>
<p>function readline($prompt = null){<br />
&nbsp;&nbsp;&nbsp; if($prompt){<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo $prompt;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $fp = fopen(&quot;php://stdin&quot;,&quot;r&quot;);<br />
&nbsp;&nbsp;&nbsp; $line = rtrim(fgets($fp, 1024));<br />
&nbsp;&nbsp;&nbsp; return $line;<br />
}</p>
<p>&nbsp;</p>
<p>but as far as i can tell the recalculating of the feed with or without deleting the target feed (done by the script) does not seem to solve the problem, it fixes the feed up until you recalculated but new data just have a dip again</p>
<p>&nbsp;</p>
<p>oh don&#39;t forget to change the variables to reflect your feeds and installation and be prepared to wait a long time, the more data you have the longer recalculation takes. i&#39;ve only been using emoncms for like 2 weeks and it took about one minute to recalculate each feed and this was on a intel nuc with an i5 processor it will probably take a lot longer on a raspberry pi, possibly hour(s) depending on how much data you have</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35341"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Sun, 25/10/2015 - 17:30.</div>
    <div class="content">
     <p>I&#39;ve decoded the phpfiwa&nbsp;feed to see if there is something in there which could influence the script and subsequent phpfina feed, and all looks well.</p>
<p>1am 25/10/2015&nbsp;GMT =&nbsp;1445734800 UNIX time</p>
<p>1445734710 46<br />
1445734720 46<br />
1445734730 47<br />
1445734740 46<br />
1445734750 47<br />
1445734760 46<br />
1445734770 46<br />
1445734780 47<br />
1445734790 46<br />
1445734800 47<br />
1445734810 47<br />
1445734820 46<br />
1445734830 NAN<br />
1445734840 47<br />
1445734850 46<br />
1445734860 46<br />
1445734870 46<br />
1445734880 47<br />
1445734890 48<br />
1445734900 47</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35342"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Sun, 25/10/2015 - 18:04.</div>
    <div class="content">
     <p>the problem is not the script, it recalculates everything fine, the problem however is that if you start posting data again the power to KWH feed (phpfina) feed gets negative values:</p>
<p>&nbsp;</p>
<p>this is from an export to csv of the power to kwh feed it&nbsp; 1445784985 =&nbsp; time zone: &lrm;25&lrm;/&lrm;10&lrm;/&lrm;2015&lrm; &lrm;15&lrm;:&lrm;56&lrm;:&lrm;25 GMT+1:00 this is the time i last recalculated the power to kwh feed using the script as you can see negative values appear in it right after the recalculations when i start posting data again</p>
<p>1445784970,2.53<br />
1445784975,2.53<br />
1445784980,2.53<br />
1445784985,2.53<br />
1445784990,2.31<br />
1445784995,2.10<br />
1445785000,1.88<br />
1445785005,1.67<br />
1445785010,1.45<br />
1445785015,1.24<br />
1445785020,1.02<br />
1445785025,0.81<br />
1445785030,0.59<br />
1445785035,0.38<br />
1445785040,0.16<br />
1445785045,-0.06<br />
1445785050,-0.27<br />
1445785055,-0.49<br />
1445785060,-0.70<br />
1445785065,-0.92<br />
1445785070,-1.13<br />
1445785075,-1.35<br />
1445785080,-1.56<br />
1445785085,-1.78<br />
1445785090,-2.00<br />
1445785095,-2.21<br />
1445785100,-2.43<br />
1445785105,-2.64<br />
1445785110,-2.86<br />
1445785115,-3.07<br />
1445785120,-3.29</p>
<p>it goes all the way up to this</p>
<p>1445785565,-6.31<br />
1445785570,-6.31<br />
1445785575,-6.31<br />
1445785580,-6.31<br />
1445785585,-6.31<br />
1445785590,-6.31<br />
1445785595,-6.31<br />
1445785600,-6.31<br />
1445785605,-6.31<br />
1445785610,-6.30<br />
1445785615,-6.30<br />
1445785620,-6.30<br />
1445785625,-6.30<br />
1445785630,-6.30<br />
1445785635,-6.30<br />
1445785640,-6.30<br />
1445785645,-6.30<br />
1445785650,-6.30<br />
1445785655,-6.30<br />
1445785660,-6.30<br />
1445785665,-6.30<br />
1445785670,-6.30<br />
1445785675,-6.30<br />
1445785680,-6.30<br />
1445785685,-6.30<br />
1445785690,-6.30<br />
1445785695,-6.30<br />
1445785700,-6.30<br />
1445785705,-6.30<br />
1445785710,-6.30</p>
<p>&nbsp;</p>
<p>and then it starts going down again</p>
<p>if i stop sending data and recalculate using the script, the data is correct but as soon as i post new data it goes haywire again, i&#39;ll check immediatly to confirm it</p>
<p>edit: just recalculated using the script again at 18:56 GMT + 1 (europe brussels time) this is what i get now in the power feed after recalculation and posting a few data:</p>
<p>1445795465 = GMT: Sun, 25 Oct 2015 17:51:05 GMT&nbsp;my time zone is : &lrm;25&lrm;/&lrm;10&lrm;/&lrm;2015&lrm; &lrm;18&lrm;:&lrm;51&lrm;:&lrm;05 GMT+1:00 (so not sure which 1445795465&nbsp; related to, i used <a href="http://www.epochconverter.com/" title="http://www.epochconverter.com/">http://www.epochconverter.com/</a>)</p>
<p>1445795450,2.63<br />
1445795455,2.63<br />
1445795460,2.63<br />
1445795465,2.00<br />
1445795470,1.37<br />
1445795475,0.74<br />
1445795480,0.10<br />
1445795485,-0.53<br />
1445795490,-1.16<br />
1445795495,-1.79<br />
1445795500,-2.42<br />
1445795505,-3.05<br />
1445795510,-3.68<br />
1445795515,-4.31<br />
1445795520,-4.94<br />
1445795525,-5.57<br />
1445795530,-6.20<br />
1445795535,-6.20<br />
1445795540,-6.20<br />
1445795545,-6.20<br />
1445795550,-6.20<br />
1445795555,-6.20<br />
1445795560,-6.20<br />
1445795565,-6.20<br />
1445795570,-6.20<br />
1445795575,-6.20<br />
1445795580,-6.20<br />
1445795585,-6.20<br />
1445795590,-6.20<br />
1445795595,-6.20<br />
1445795600,-6.20</p>
<p>same problem occurs but the problem only seems to happen on a later datetime stamp (after i ran the script) so i think the script itselve works fine and calculates everything fine but as soon as i post new data i&#39;m having the problem again. i tested this by disabling my program that sends data, let the script recalculate and look at raw data graph feed, all looks ok, i thin started the program again to submit data and then i get the huge (negative) dip</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35346"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Sun, 25/10/2015 - 18:40.</div>
    <div class="content">
     <p>i noticed something, emoncms, according to timestamps in the log seems to be thinking it&#39;s hour earlier:</p>
<p>my logs are posted at 19:33 but emoncms displays 18:33 in the log entry. could this be the problem that emoncms somehow thinks it&#39;s running one hour behind real time ?</p>
<p><img alt="" src="http://www.willemssoft.be/misc/log.JPG" style="width: 720px; height: 163px;" /></p>
<p>look at the last log entry and the date time in my system tray</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35347"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Sun, 25/10/2015 - 19:01.</div>
    <div class="content">
     <p>My log time &amp; system time are identical.</p>
<p>Is your <strong>Setup &gt; My Account &gt; Timezone</strong>&nbsp;set correctly?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35349"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Sun, 25/10/2015 - 19:19.</div>
    <div class="content">
     <p>yes i have it set to europe/brussels as i live in belgium</p>
<p>hmm it seems that&#39;s not the problem, the log writes utc time so the hour diffrence is correct (i looked at the sources)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35372"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Mon, 26/10/2015 - 20:49.</div>
    <div class="content">
     <p>WARNING do this at your own rish or make backups, i noticed this trick only fixed the kwh feed looking at real time data, but if i use this feed in a bargraph feed to display kwh/d or wh/d the bargraph does not seem to correctly display data. This might be a bug with the bargraph and daylight saving time or it might be a problem with the way i &quot;fixed&quot; my kwh feeds</p>
<p>i found a way to fix the kwh feeds:</p>
<p>this is what i did :</p>
<p>1) stop sending data to emoncms</p>
<p>2) use the script to recalculate the kwh feed based on a power feed</p>
<p>3) start sending data again (wait 1 - 2 minutes)</p>
<p>5) use visualisation Editrealtime and select the kwh feed. You&#39;ll notice the recalculation went perfect but you get a dip at the end of the graph now (after calculation) like in this screenshot:</p>
<p><img alt="" src="http://www.willemssoft.be/misc/rawdata.JPG" style="width: 489px; height: 561px;" /></p>
<p>6) zoom in enough at the end of the graph so you can see the dip, select the last datapoint at the peak, were data was still valid, copy its value to clipboard</p>
<p>7) select a datapoint from the dip (lowest point) edit it&#39;s value so by pasting the value from step 6</p>
<p>8) wait a few minutes and show the editrealtime feed again. You&#39; should notice that the kwh feed is back on track even after posting data but that you still see the dip in graph&nbsp; like this screenshot:</p>
<p><img alt="" src="http://www.willemssoft.be/misc/power%20to%20kwh3.JPG" style="width: 542px; height: 403px;" /></p>
<p>9) if you see the effect above after zooming in enough on the correct position stop sending data</p>
<p>10) use the script again to recalc the data</p>
<p>11) start sending data again, the feed is now fixed. There might however be a very tiny dip but not a huge one like before and this dip can be ignored</p>
<p>&nbsp;</p>
<p>This is a workaround for the problems caused by daylight saving time but i do hope that there&#39;ll be a fix before the next daylight saving time. I don&#39;t want to do this every 6 months. At the moment it did not take long since i had not much data but the longer i&#39;ll be using emoncms the more data i&#39;ll have and the more time it would take to recalculate the feed. So a fix for this should really be made</p>
<p>&nbsp;</p>
<p>to make the script work: i repalced the all reference to logging with echo statements and remove the require statement. also make sure that the target phpfina feed gets deleted before calculation by default the script only does this if your source feed is phpfina (which was not the case with me) just change that if check with whatever source engine you were using (for example phpfiwa)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Mon, 26/10/2015 - 19:58.</div>
    <div class="content">
     <p>this is another bug which happend due to daylight saving :</p>
<p>the kwhd feeds are somehow messed up as well at least i think it is cause the graph is showing oct 25th 2 times instead of oct 25th &amp; oct 26th on the x asis. However if you hoover over the day it&#39;s displayed as 26th correctly so only the labels on the x axis are wrong</p>
<p>&nbsp;</p>
<p><img alt="" src="http://www.willemssoft.be/misc/kwhd.jpg" style="width: 700px; height: 531px;" /></p>
<p>I don&#39;t know how to fix this but i&#39;m going to convert my bargraphs which use kwhd feeds to kwh feeds with the delta option</p>
<p>&nbsp;</p>
<p>edit:</p>
<p>using kwh feeds with delta option = 1 gives the problem on the x asis and for some reason the next day (26th is empty) so maybe my kwh feeds are not completly fixed or there are other problems due to daylight saving time:</p>
<p><img alt="" src="http://www.willemssoft.be/misc/kwh2.jpg" style="width: 700px; height: 481px;" /></p>
<p>if i disable this option to automatically adjust the time to the daylightsaving time the xaxis thing is fixed if i enable it again i see two times oct 25, how can this setting have an impact on what you see in the bargraphs ?? this means that the client where your viewing the emoncms website from has an impact on how the graphs are displayed</p>
<p>however the bargraph still does not show any data for oct 26 (today) as in the screenshot above when using my &quot;fixed&quot; kwh feed with delta = 1</p>
<p><img alt="" src="http://www.willemssoft.be/misc/timezonesetting.jpg" style="width: 700px; height: 540px;" /></p>
<p>the same problem with the option above happens in firefox also (if you restart it after changing the setting in windows) It hapens on a windows 10 as well as on a windows 7. I had a look at the flot javascript library and noticed all graphs are set to timezone browser, so it&#39;s using the client&#39;s timezone shouldn&#39;t this use the timezone from user account settings which is selected there instead of the timezone of computer visiting emoncms ? i noticed there is an option for datejs if timezone in the graph options is not set maybe that should be used to fix the x - axis problem with this setting not sure though it&#39;s just a guess</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35391"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3695" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3695" title="View user profile.">chaveiro</a> on Mon, 26/10/2015 - 20:58.</div>
    <div class="content">
     <p>Can you show the input process list that writes to that feed, and the Admin/Server Information tab.</p>
<p>Also it only happen on phpfina? And are you using redis ?</p>
<p>Do you still have the logs close to 25/10/2015 01:59 to 01:00 when the clock reverted? Post a few minutes before and after.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35394"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Mon, 26/10/2015 - 22:12.</div>
    <div class="content">
     <p>this is my setup:</p>
<p>i have 4 smart plugs and i edited a program that can read the data from the plugs so it can now send the data to emoncms. I&#39;m doing this using the input api like so : <a href="http://127.0.0.1:8083/emoncmsnew/input/post.json?node=3&amp;apikey=myapikey&amp;csv=0.38,44.20,4.35,225.65">http://127.0.0.1:8083/emoncmsnew/input/post.json?node=3&amp;apikey=myapikey&amp;csv=0.38,44.20,4.35,225.65</a> for example using one node for each plug, each with 4 inputs: amp, watt, volt and kwh. This last input kwh is the elapsed kwh as calculated by the&nbsp;smart plugs, but i don&#39;t use this since it has a limit of 1000kwh and these are not the feeds i&#39;m having problems with.</p>
<p>as far&nbsp;as i can remeber&nbsp;it is indeed the phpfina feed that has a problem although my kwh/d feed also had a problem on the day itselve.</p>
<p>also do note i don&#39;t see any negative values anymore since i had tried to fix my &quot;calculated&quot; kwh&nbsp;feed (not the kwh input) the calculated kwh feed does not show any errors anymore however the when displayed in a bargraph using delta = 1 they don&#39;t show info for today while my kwh/d feed still does (i had usuage today). so it could be the kwhd feeds have a problem as well (not really serieous since if the kwh feed&nbsp; / bargraphs&nbsp;are completely fixed&nbsp;i can switch to those and remove the kwhd feeds).</p>
<p>my timezone is europe brussels and i had set this in&nbsp;apache, php.ini and on my user page</p>
<p>here are the screenshots of the data you requested. I&#39;m not 100% certain if this is the information you need. if you need more info please let me know what. emoncms runs on a intel nuc (x86 hardware) on windows 7 with timezone in windows set to europe / brussels using wamp</p>
<p><a href="http://www.willemssoft.be/misc/serverinfo.jpg" title="http://www.willemssoft.be/misc/serverinfo.jpg">http://www.willemssoft.be/misc/serverinfo.jpg</a></p>
<p><a href="http://www.willemssoft.be/misc/process1.jpg" title="http://www.willemssoft.be/misc/process1.jpg">http://www.willemssoft.be/misc/process1.jpg</a></p>
<p><a href="http://www.willemssoft.be/misc/process2.jpg" title="http://www.willemssoft.be/misc/process2.jpg">http://www.willemssoft.be/misc/process2.jpg</a></p>
<p>unfortunatly i had disabled logging so i have no logs anymore, the reason i disabled logs was because it was growing too big, on one day it had&nbsp;grown 180 mb so i decided to disable logging. maybe paul might still have logs ?</p>
<p>edit:</p>
<p>when i ran the script to recalculate the power to kwh feeds it was logging warnings about datetimestamps starting before feed creation time might this be an indicator ?</p>
<p>the recalculation of the power to kwh feed worked but as i soon as i posted new data i had negative values again in the feed. I fixed this using a method described above, by editing one of the negative values to the last known correct positive value, this somehow made the phpfina feed (power to kwh) go back on track. i then recalculated again to remove the negative values so i believe my power to kwh feed is now showing correctly but it&#39;s the bargraph that&#39;s acting up if you use it with (this/) power to kwh feed. (it shows no data on today or depending on a windows setting for the 2nd october 25th) also the initial problem started on the night daylight saving time happend, the shift in dates is because i had recalculated / tried to fix my kwh feed a few times</p>
<p>the double days thing can be fixed by chaning&nbsp; a setting in windows (since the graphs use the timezone of the browser) i just don&#39;t understand why that setting has an impact, it&#39;s only a display bug i think for the x axis.</p>
<p>i don&#39;t think i&#39;m using redis, (don&#39;t even know what that is) just using the input api the post data from an application that can read the data from the smart plugs : <a href="https://github.com/joyrider3774/plugctl">https://github.com/joyrider3774/plugctl</a> )</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Mon, 26/10/2015 - 22:36.</div>
    <div class="content">
     <p>Hi Chaviero.</p>
<p>My input process is:<br />
Log to feed - Grid (Feed 13 - PHPFIWA)<br />
Allow Positive<br />
Log to feed - Power Imported (Feed 14 - PHPFIWA)<br />
Power to kWh&nbsp;(Feed 41 -&nbsp;PHPFINA)<br />
Reset to zero&nbsp;</p>
<p>Redis&nbsp;is not enabled</p>
<p>Emoncms&nbsp;Timezone&nbsp;is set Europe/London (the same as my Raspberry Pi).<br />
&nbsp;</p>
<p>I&#39;ve only experienced the problem&nbsp;on PHPFINA</p>
<p>I&#39;ve attached my emoncms&nbsp;log (extract)<br />
&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35397"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Mon, 26/10/2015 - 23:02.</div>
    <div class="content">
     <p>in this video (which i made for a github issue i created) you can see that the double day on the x axis is fixed if you change a setting dealing with daylight saving time: (skip to the end as the first part of the video shows a problem where all graphs are using the browser&#39;s timezone instead of the timezone from the user settings page) <a href="https://youtu.be/Go-R1315tpU" title="https://youtu.be/Go-R1315tpU">https://youtu.be/Go-R1315tpU</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35404"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3695" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3695" title="View user profile.">chaveiro</a> on Tue, 27/10/2015 - 01:25.</div>
    <div class="content">
     <p>Thanks,</p>
<p>Paul can you post a detailed printscreen of your feed 41 graph from 23h to 3h of 25oct to better see the minutes/seconds when the value goes down an then start going up.</p>
<p>When you say you only had problem with phpfina is because you only have this engine saving kwh data, so cant confirm kwh data withother engines, right?</p>
<p>I was able to replicate on paper that strange values from the log, it seems last feed time is offset by -3600s only during the hour before the dst change.</p>
<p>Bad time value comes from feed_model.php get_timevalue method.<br />
It seems related to the way input last time is saved on DB, in text format. The error must be from conversion with strtotime($row[&#39;time&#39;]).</p>
<p>Redis is caching that time in linux format so i would not expect the issue with redis. Can anyone confirm?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35406"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3" title="View user profile.">TrystanLea</a> on Tue, 27/10/2015 - 06:48.</div>
    <div class="content">
     <p>O dear. Il start with the usefulscripts issue.</p>
<p>Id be interested to know which systems show the readline error using the process script:</p>
<p>PHP Fatal error: &nbsp;Call to undefined function readline() in /home/pi/usefulscripts/process/power_to_kwh.php on line 12</p>
<p>I tested that here on PHP 5.5.9 and it worked fine. Towards the end of the power_to_kwh.php script it forces a reload of the redis feed data for the feed:</p>
<p>&nbsp;&nbsp; // force a reload of the feeds table<br />
&nbsp;&nbsp;&nbsp; if ($redis &amp;&amp; $redis-&gt;exists(&quot;user:feeds:$userid&quot;)) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $redis-&gt;del(&quot;user:feeds:$userid&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $redis-&gt;del(&quot;feed:lastvalue:$target&quot;);<br />
&nbsp;&nbsp;&nbsp; }</p>
<p>This should stop the error where the corrected data just starts negative from the point of last reprocessing.</p>
<p>A more manual step process would be:</p>
<p>1. stop emonhub, emoncms-nodes-service and feedwriter<br />
2. run the processor script.<br />
3. clear redis $ redis-cli &quot;flushall&quot;<br />
4. start emonhub, emoncms-nodes-service and feedwriter</p>
<p>But it would be really great to get the usefulscripts/process/power_to_kwh.php script working consistently for everyone.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35408"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Tue, 27/10/2015 - 08:30.</div>
    <div class="content">
     <p>Hi trystan, I had that problem as well on my intel nuc running windows 7 64 bit, using wamp. Here you can see the server info from the administration page:http://www.willemssoft.be/misc/serverinfo.jpg I could fix the readline error by adding a function that reads from stdin, which i had found on stackoverflow. However this was not the only problem i had, at a certain point the script tries to read the interval from the feed and displays, you could then choose that existing interval or change it. The problem i had was that it displayed array instead of an interval number. I can give you the line nr as soon as im at work. Thats where i stopped and focussed on the manual script which i could get working. Also for some reason it had problems with require statement of the emonlogger, i did not fully look into this, i just replaced writing to log to echo statements. It could very well be i had placed the scripts in a wrong directory Cheers davy</p>
<p>&nbsp;</p>
<p>edit: forgot to mention there is another bug in the script at least i believe so:</p>
<p>if you look at this section : <a href="https://github.com/emoncms/usefulscripts/blob/master/process/power_to_kwh.php#L100" title="https://github.com/emoncms/usefulscripts/blob/master/process/power_to_kwh.php#L100">https://github.com/emoncms/usefulscripts/blob/master/process/power_to_kw...</a></p>
<p>there&#39;s a missing $row = $result-&gt;fetch_array(); $row is still pointing to the source feed not the target feed with that call. unless the source feed has to be PHPFINA which is not the case with me it&#39;s PHPFIWA. If this check needs to check the target feed the fetch array statement is needed. (i&#39;m guessing the target power to kwh&nbsp;feed needs to be phpfina but not the source feed)</p>
<p>the line number where i had gotten array displayed is this one <a href="https://github.com/emoncms/usefulscripts/blob/master/process/power_to_kwh.php#L121" title="https://github.com/emoncms/usefulscripts/blob/master/process/power_to_kwh.php#L121">https://github.com/emoncms/usefulscripts/blob/master/process/power_to_kw...</a></p>
<p>don&#39;t know why though</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35412"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Tue, 27/10/2015 - 09:18.</div>
    <div class="content">
     <p>@Chaveiro.</p>
<p>Graph attached.<br />
I do have another &#39;Power to kWh&#39; PHPFINA feed (21) which records &#39;solar&#39; power generation from feed 20. This feed did not drop and appears unaffected,&nbsp;however as it&#39;s a solar feed, there would be no increments during the affected time - as it was nightime = no power (could this be the reason why it&#39;s OK??)</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35413"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Tue, 27/10/2015 - 09:30.</div>
    <div class="content">
     <p>@Trystan</p>
<p>Attached screenshot of my system, which is a Raspberry Pi v2 running Raspbian Wheezy with php v5.4.44. I&#39;ve also attached a screenshot of the error.</p>
<p>Paul</p>
<p>EDIT.<br />
running $ sudo apt-get update &amp;&amp; sudo apt-get upgrade brings me to php v5.4.45 and the script still errors as above.<br />
&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35418"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3" title="View user profile.">TrystanLea</a> on Tue, 27/10/2015 - 10:38.</div>
    <div class="content">
     <p>thanks @joyrider3774, I&#39;ve fixed the power_to_kwh.php script with the stdin function, the fetch_array call and the interval print output where the source engine is phpfiwa. Let me know if it works ok now.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35421"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Tue, 27/10/2015 - 12:04.</div>
    <div class="content">
     <p>Still errors after git pull.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35425"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Tue, 27/10/2015 - 12:38.</div>
    <div class="content">
     <p>The location from emonlogger has changed to lib/emonlogger.php instead of modules/log/emonlogger.php Im also not certain if it is required to place the script in the root dir of emoncsms www dir after that change.</p>
<p>&nbsp;</p>
<p>i&#39;m also not able to test the script until i get home tonight, for some reason i can&#39;t reach my intel nuc from work today</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35427"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3" title="View user profile.">TrystanLea</a> on Tue, 27/10/2015 - 16:53.</div>
    <div class="content">
     <p>Thanks Paul, could you try again now?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35430"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Tue, 27/10/2015 - 18:18.</div>
    <div class="content">
     <p>@Trystan</p>
<p>Git pulled latest and script ran OK, no errors and looking at the resultant kwh feed before restarting emonhub it looked good, showing a steady daily increase. However, I took the precaution of flushing redis, and&nbsp;as soon as I started emonhub, the kwh feed added 79kwh&nbsp;to the feed!</p>
<p>Tried it again, same result, so ran a third time, started emonhub and stopped it again after 15 seconds. Then using Visualisation &gt; EditRealTime, I edited the +79kwh datapoints&nbsp;back to correct value, and restarted emonhub again.</p>
<p>This time, the resultant graph is OK! -&nbsp;<em>got there in the end!!</em></p>
<p>Paul</p>
<p><img alt="" src="http://openenergymonitor.org/emon/sites/default/files/file (3).png" style="width: 720px; height: 259px;" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35431"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Tue, 27/10/2015 - 18:32.</div>
    <div class="content">
     <p>the scripts are running fine with me also except for one windows related thing. The exec(chown) stuff does not work nor is it needed on windows machines, it spits out a warning that it can&#39;t find chown. However i think the script executed further on or at least i think so. i&#39;m still in the process of recalculating everything and will test the bargraphs again afterwards to see if they still have problems</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35432"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Tue, 27/10/2015 - 20:25.</div>
    <div class="content">
     <p>the bargraphs still display wrong even after recalculating. this picture is with default windows settings based on a kwh feed (that i just recalculated), as you can see it displays 2x oct 25th on the xaxis and no data for today</p>
<p><img alt="" src="http://www.willemssoft.be/misc/kwhbargraph.jpg" style="width: 700px; height: 955px;" /></p>
<p>&nbsp;</p>
<p>changing this windows setting (translated autoadjust time to daylight saving time): fixes the x axis display bug but does not fix the no data display on the current day:</p>
<p><img alt="" src="http://www.willemssoft.be/misc/kwhbargraph2.jpg" style="width: 700px; height: 955px;" /></p>
<p>&nbsp;</p>
<p>however i believe&nbsp;this might all be&nbsp;related to to using &quot;timezone: browser&quot; on the graph settings (it isn&#39;t using timezone from user settings page from emoncms for the graphs in javascript) otherwise the windows setting change whould have no impact.&nbsp; however i&#39;m not sure if the no data on current day is related to this, but the double days on the x axis probably is (why would changing windows settings otherwise have an impact)</p>
<p>paul could you create a bargraph with same settings and see if this has the same effect with you ? if you don&#39;t mind testing</p>
<p>EDIT:</p>
<p>just downloaded <a href="https://github.com/mde/timezone-js">https://github.com/mde/timezone-js</a> and the timezone files as per the readme, i added date.js to the bargraph.php and changed timezone:browser to europe/london and europe/brussels for testing so that timezone-js is used in combination with the specified timezone (libflot has support for this)&nbsp;it does not fix the double day display&nbsp;bug nor the no data. so i guess i was wrong that timezone: browser is the culprit, it is not as far as i tested and windows settings still affect graphs (like the setting described above).&nbsp;setting another timezone like nort america as a graph option (instead of browser) only shifted the x axis days a bit (they were not aligned anymore with the graph). so using timezone.js does not seem to fix it sorry for misleading</p>
<p>i just changed the windows setting to fix the x axis thing for now and am still using kwhd graphs (instead of kwh with delta = 1) so i can see the usuage on the current day as well</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35446"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3695" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3695" title="View user profile.">chaveiro</a> on Wed, 28/10/2015 - 19:43.</div>
    <div class="content">
     <p>The duplicated day on the graph is something wrong with the graph javascript.</p>
<p>It&#39;s an old bug of flot lib, see : <a href="https://code.google.com/p/flot/issues/detail?id=141" title="https://code.google.com/p/flot/issues/detail?id=141">https://code.google.com/p/flot/issues/detail?id=141</a></p>
<p>A quick test with &#39;useLocalTime: true&#39; seem to work, but i&#39;d like to do further tests to understand how it works.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35450"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Wed, 28/10/2015 - 18:58.</div>
    <div class="content">
     <p>adding &#39;useLocalTime: true&#39;&nbsp; and not deleting &#39;timezone:browser&#39; has no impact with me. However removing &#39;timezone:browser&#39; completely and not adding &#39;useLocalTime: true&#39;&nbsp;fixes it with me. not adding&nbsp;&#39;timezone:browser&#39; and only adding &#39;useLocalTime: true&#39;&nbsp; fixes it also but i don&#39;t see a diffrence with just leaving out timezone:browser.</p>
<p>i checked jquery.flot.time.min.js and if you set timezone:browser it returns new Date(ts) where ts is the timestamp if you do not specify timezone it&#39;s returning makeUtcWrapper(new Date(ts)) where ts is the timestamp. i placed 2 alert statements in the if statements to know which one it was using.</p>
<p>Did you omit timezone:browser as well or did you specify timezone:browser along with uselocaltime:true cause that last one did not fix it with me. ps i only tested with bargraphs, i&#39;ll have a quick look on realtime graphs to see if the hour offsets or not</p>
<p>leaving out timezone option altogheter makes it use utc time on a daily bargraph it fixes the x axis display however a realtime graph my hour is off by one since i&#39;m utc + 1 it&#39;s probably using utc, it can also be seen in the if statements in that jqeury.flot.time.min.js file. there&#39;s one other option that i tried yesterday and that&#39;s using timezoneJS if you add the library download the timezone files, initialize the library and write the actual timezone as timezone option for the xaxis but that did not fix it either with me</p>
<p>&nbsp;</p>
<p>edit: crap i probably have to apply the patch from the google code link first cause as far as i can see a grep statement on all libflot files for uselocaltime does not return any info. I&#39;ll try to apply the patch if it still works and see what it does</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35453"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3695" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3695" title="View user profile.">chaveiro</a> on Wed, 28/10/2015 - 20:28.</div>
    <div class="content">
     <p>Yes i omit &#39;timezone:browser&#39; so it&#39;s using makeUtcWrapper, right.</p>
<p>The server time cames always in utc format but my current local time is also utc, so i&#39;m not sure if removing it gives fixes because of that.</p>
<p>Need to dig further. If you look at \flot\examples\axes-time-zones there is some helpfull information.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35454"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Wed, 28/10/2015 - 21:12.</div>
    <div class="content">
     <p>thats what i tried yesterday but i notice the tz directory contains diffrent files as when i was testing it yesterday so maybe it did not work because of that. It makes use of <a href="https://github.com/mde/timezone-js">https://github.com/mde/timezone-js</a>&nbsp;. i&#39;ll try again but this time with the tz directory from the examples</p>
<p>edit tried with date.js and tz files from examples directory and setted timezone to europe/brussels it does not fix the double days thing, however the windows setting has no effect anymore on the x axis labels so it&#39;s probably a bug in the flot lib somewhere.</p>
<p>maybe timezone-js can&nbsp;be used to lock the x axis time bar to the time zone that is used in the emoncms user settings page but without windows settings having an impact on it</p>
<p>i also noticed flot lib is not being developped anymore last commit was somewhere in 2014 and i could not find a fork that might have continued work (github won&#39;t display the fork&nbsp;graph)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35504"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3695" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3695" title="View user profile.">chaveiro</a> on Fri, 30/10/2015 - 01:26.</div>
    <div class="content">
     <p>Check EmonCMS 9.1 | 2015.10.30. See if its ok.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35514"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Fri, 30/10/2015 - 11:08.</div>
    <div class="content">
     <p>seems to be fixed with me and does not seem to have any impact on other graphs where realtime data is displayed. As far as i can tell, this fixes it</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35562"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Sun, 01/11/2015 - 13:52.</div>
    <div class="content">
     <p>@tristan i noticed something today. While looking at my kwh feed i still noticed a small drop so today i recalculated the feed again and when i start sending data again the drop occurs again.</p>
<p>You said in an earlier post that this</p>
<p>&nbsp; // force a reload of the feeds table<br />
&nbsp;&nbsp;&nbsp; if ($redis &amp;&amp; $redis-&gt;exists(&quot;user:feeds:$userid&quot;)) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $redis-&gt;del(&quot;user:feeds:$userid&quot;);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $redis-&gt;del(&quot;feed:lastvalue:$target&quot;);<br />
&nbsp;&nbsp;&nbsp; }</p>
<p>should stop the error where the corrected data just starts negative from the point of last reprocessing but acutally i&#39;m not using redis&nbsp;so those lines of code are not executed with me.</p>
<p>Could this be why i still see a (very) small drop in de kwh feed data after recalculating ? I also tried fixing it manually again by editing one value&nbsp;of the drop to the last known correct value to&nbsp;counteract the drop. I had done this with all my previous kwh feeds as well so i&#39;m not certain if the script fixed it or my manual messing about with node values actually fixed the drop since the code above is never executed with me. So maybe the script did not fix my drop after recalculating but me messing with the node values in editrealtime visulisation:</p>
<p>it&#39;s only a 0.05 drop though so i can safely ignore it but i was still wondering if the script actually fixed it or not and if it&#39;s normal that i still see a small dip while this normally should never happen with a power to kwh feed ?</p>
<p>Also i&#39;m using 9.1 from 30.10.2015 but not sure if that matters</p>
<p><img alt="" src="http://www.willemssoft.be/misc/kwhrecalculated.jpg" style="width: 700px; height: 407px;" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35564"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Sun, 01/11/2015 - 13:54.</div>
    <div class="content">
     <p>It shouldn&#39;t happen, and I found the same, but <a href="http://openenergymonitor.org/emon/node/11473#comment-35430">got around it as described&nbsp;here</a>.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35565"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Sun, 01/11/2015 - 13:59.</div>
    <div class="content">
     <p>ah yes so also editing the data points, i&#39;m guessing i&#39;m seeing this small 0.05 because i had selected the wrong datapoint to counteract this behaviour i&#39;ll try to fix them manually again</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35568"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/238" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/238" title="View user profile.">Paul Reed</a> on Sun, 01/11/2015 - 14:07.</div>
    <div class="content">
     <p>If you rebuild your feed again, start emonhub&nbsp;and stop it again a few seconds later, you should only have a few datapoints to edit (that&#39;s what I found anyway!)</p>
<p>You may find that without rebuilding it again, you&#39;ll have 3 million datapoints to edit!</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35649"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Thu, 05/11/2015 - 07:59.</div>
    <div class="content">
     <p abp="697">@tristan,</p>
<p abp="698">i think i figured out why the feeds keep dropping after recalculating. I had a problem with one my kwh feeds to day and had to recalculate again, and i had the drop problem again. Even after editing the nodes as paul suggested i still had problems with the feed, the editing of the values did not work with me.</p>
<p abp="699">the problem, i think, is that the value column of the target feed in mysql is never updated. If i add</p>
<p abp="700">$mysqli-&gt;query(&quot;update feeds set value= &#39;&quot;.$kwh.&quot;&#39; WHERE id=&#39;&quot;.$target.&quot;&#39;&quot;); at the end of the script (after the redis stuff) the drop never happens after i start sending data again. So my guess is the script, at the moment is incomplete because it does not update the value colum of the target feed in mysql. At least with me this seems to stop the drops from happening</p>
<p abp="700">edit: this is probably only needed if mysql is used to get the last kwh value for doing the increment calculation to write the new value. which is the case with me since i&#39;m not using MQTT nor redis</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35764"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/3" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/3" title="View user profile.">TrystanLea</a> on Mon, 09/11/2015 - 17:39.</div>
    <div class="content">
     <p>Thanks @joyrider3774, I have added this line to the bottom of the script. latest commit info is here: <a href="https://github.com/emoncms/usefulscripts/commit/7a395d042517470adaa7f4dd376e02fea74ae71b" title="https://github.com/emoncms/usefulscripts/commit/7a395d042517470adaa7f4dd376e02fea74ae71b">https://github.com/emoncms/usefulscripts/commit/7a395d042517470adaa7f4dd...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35768"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/8839" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="joyrider3774&#039;s picture" title="joyrider3774&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: V9.0 RC2 Daylight saving time bug</h3>

    <div class="submitted">Submitted by <a href="/emon/user/8839" title="View user profile.">joyrider3774</a> on Mon, 09/11/2015 - 18:24.</div>
    <div class="content">
     <p abp="1698">&nbsp;@trystanlea no problem. It might be this only fixes it if one isn&#39;t using redis. the power_to_kwh calculation&nbsp;requests the last value using the get_timevalue function and this function first checks if redis is available and if so takes the value from there if redis is not availible it takes the value from mysql since i was not using redis it got the value from mysql feeds table with me. So it fixes it in this circumstance but i&#39;m not certain if it would fix it if someone would be using redis. Unless the deletion of the last value on redis (last part of the script)&nbsp;had already solved it. I could not test that since i&#39;m not using redis</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/11473"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-d9ZqPA2Yvm5woAwLVedhN8_3U9KjJzcs2qV7ICks7n0" value="form-d9ZqPA2Yvm5woAwLVedhN8_3U9KjJzcs2qV7ICks7n0"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
