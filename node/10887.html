<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10887 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:56:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emoncms: installation on a shared host linux | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emoncms: installation on a shared host linux</h3>
        <span class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Tue, 23/06/2015 - 10:59</span>
        <div class="content"><p>Hello&nbsp;</p>
<p>After running OpenEnergyMonitor from emoncms.org for a couple of weeks, I decided to &quot;try&quot; a shared host running linux.</p>
<p>I downloaded the v8.5mergeXT branch from GitHub.<br />
I updated the settings.php file and disabled redis (not supported on that server), and fixed a couple of bugs as I moved along. So far so good.</p>
<p>I have one problem with the TimeZone. I know it&#39;s not new in this forum.<br />
The message:</p>
<pre>
Call to a member function setTimezone() on a non-object
in MyHOME_HERE/emoncms/Modules/input/process_model.php on line 669</pre><p>I set the Timezone on Emoncms account and in the PHP Settings of that server (date.timezone=&quot;Europe/Zurich&quot;).<br />
Obviously, I don&#39;t have access to the php.ini file directly but I can do it through the web interface of the provider.</p>
<p>My problem:<br />
As soon as I add the PHPTIMESERIES engine to any of the feeds, I get the above message and there is no update anymore.</p>
<p>In the Feeds column &quot;Updated&quot;, there is a &quot;NaNs ago&quot; string but this has always been like that for any feeds until now. It&#39;s fine on&nbsp;the Inputs page.</p>
<p>Can someone help?</p>
<p>Thanks for your support</p>
<p>Walter</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11173.html" class="topic-previous" title="Go to previous forum topic">‹ Adding extra analog inputs</a>
              <a href="5740.html" class="topic-next" title="Go to next forum topic">RaspB+ and SD card Extend ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31666"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7723.jpg" alt="daturach&#039;s picture" title="daturach&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Wed, 24/06/2015 - 16:10.</div>
    <div class="content">
     <p>I think I have to live with that for the time being</p>
<p>I am a bit puzzled with the redis server. I read in this forum that we have to install it while other members say we don&#39;t have.</p>
<p>What are the consequences of not having it?&nbsp;</p>
<p>Thanks</p>
<p>Walter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31727"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7723.jpg" alt="daturach&#039;s picture" title="daturach&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Fri, 26/06/2015 - 12:43.</div>
    <div class="content">
     <p>In the meantime, I found out the Chaveiro&#39;s&nbsp;sources (v8.5.1 XT) on Github and just installed them.</p>
<p>The &quot;NaNs ago&quot; disappeared and have been replaced by numbers.&nbsp;&nbsp;Good</p>
<p>It still remains the message about the setTimezone() error when PHPTIMESERIES are defined.</p>
<p>Thanks</p>
<p>Walter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31728"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Fri, 26/06/2015 - 13:00.</div>
    <div class="content">
     <p>Hi,</p>
<p>In the meantime, I experienced exactly the issue on my shared host linux (OVH). Also solved by installing the 8.5.1 XT branch.</p>
<p>I also can&#39;t install redis and that&#39;s problematic because some processes can&#39;t work without it. In particular &quot;wh accumulator&quot; and &quot;kwh_to_power&quot;.&nbsp; As I really need these processes, I&#39;m modifying some files to make them work.</p>
<p>I will submit these modifications when fully tested.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32537"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8471.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ChrisBirkett&#039;s picture" title="ChrisBirkett&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/8471.html" title="View user profile.">ChrisBirkett</a> on Thu, 23/07/2015 - 20:49.</div>
    <div class="content">
     <p>Hey Eric, I&#39;m facing the same thing here. Did you submit your patch?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32558"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Thu, 23/07/2015 - 22:04.</div>
    <div class="content">
     <p>Last stable version is 8.5.2, try that:</p>
<p><a href="https://github.com/emoncms/emoncms/archive/8.5.2.zip" title="https://github.com/emoncms/emoncms/archive/8.5.2.zip">https://github.com/emoncms/emoncms/archive/8.5.2.zip</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33616"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 26/08/2015 - 06:33.</div>
    <div class="content">
     <p>Hello,</p>
<p>Sorry for the late answer. Just back from long holidays.</p>
<p>Chris, do you still need my modified files to make &quot;wh accumulator&quot; and &quot;kwh_to_power&quot; work without Redis ? It works fine but it breaks the way process list is working, so it&#39;s not very clean.</p>
<p>Chaveiro, will Redis be required with the last emonCMS version ?</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33627"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8471.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ChrisBirkett&#039;s picture" title="ChrisBirkett&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/8471.html" title="View user profile.">ChrisBirkett</a> on Wed, 26/08/2015 - 11:47.</div>
    <div class="content">
     <p>Cheers&nbsp;for the reply Eric - I&#39;d be interested to see the changes but did end up installing Redis.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33633"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Wed, 26/08/2015 - 14:28.</div>
    <div class="content">
     <p>Hi,</p>
<p>Before updating an input value/time, I store the old value/time in mySql. In that way, I can calculate the difference between to consecutive input to make Wh_acc and Kwh_to_power works .&nbsp;</p>
<p>The code is dirty but it works ... Some pieces of code bellow.</p>
<p>How did you manage to install redis on a share host linux ?</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;public function wh_accumulator($feedid, $time, $value)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//WARNING : DOES NOT WORK AS OTHERS PROCESS.<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//$value is not used, only the input values and time are used<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// --&gt; other processes before that one are not taken into account<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (except the calibration process &#39;x&#39;)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//make sure the input is Wh and not kWh or anything else<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//this assumes that wh are always increasing or decreasing</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;global $session;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $usercampagneid = $session[&#39;userid&#39;];<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$abo = 36;</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// identiying the input id<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$result = $this-&gt;mysqli-&gt;query(&quot;SELECT * FROM input WHERE processList LIKE &#39;%34:$feedid%&#39;&quot;);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$row = $result-&gt;fetch_array();<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$inputid = $row[&#39;id&#39;];&nbsp; // check needed ? (that one and only one row exists)</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//setting max_power<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if ($row[&#39;description&#39;]==&quot;Wh1&quot; || $row[&#39;description&#39;]==&quot;Wh2&quot;&nbsp; || $row[&#39;description&#39;]==&quot;Wh3&quot; )<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$max_power = 23500000*1.25; //allow 25% more<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else if ($row[&#39;description&#39;]==&quot;Wh4&quot;)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$max_power = 4500*1.25; //allow 25% more<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$max_power = $abo*1000*1.25; //allow 25% more<br />
&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// getting the calibration factor<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$processes = explode(&quot;,&quot;,$row[&#39;processList&#39;]);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$firstprocess = explode(&quot;:&quot;,$processes[0]);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if ($firstprocess[0]==2)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$calibfactor = $firstprocess[1];<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$calibfactor = 1;</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$totalwh = $this-&gt;feed-&gt;get_timevalue($feedid)[&#39;value&#39;];</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$Whinc = $calibfactor*($this-&gt;input-&gt;get_last_value($inputid)-$this-&gt;input-&gt;get_old_value($inputid));<br />
&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$timeelapsed = $this-&gt;input-&gt;get_last_Utime($inputid)-$this-&gt;input-&gt;get_old_Utime($inputid);</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//if Wh increments and time elapsed &gt; 0 and power &lt; max_power then<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if ( (($Whinc&gt;0&nbsp; &amp;&amp; $totalwh&gt;=0) || ($Whinc&lt;0&nbsp; &amp;&amp; $totalwh&lt;=0)) &amp;&amp; $timeelapsed&gt;0 ){<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$abspower = abs($Whinc * 3600 / $timeelapsed);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if ($abspower&lt;$max_power)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$totalwh +=&nbsp; $Whinc;</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />
&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$padding_mode = &quot;join&quot;;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$this-&gt;feed-&gt;insert_data_padding_mode($feedid, $time, $time, $totalwh, $padding_mode);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return $totalwh;<br />
&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>public function kwh_to_power($feedid,$time,$value)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//WARNING : DOES NOT WORK AS OTHERS PROCESS.<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//$value is not used, only the input values and time are used<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// --&gt; other processes before that one are not taken into account<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (except the calibration process &#39;x&#39;)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//make sure the input is Wh and not kWh or anything else<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//This assumes that Wh are increasing (because coming from a pulse sensor)</p>
<p>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;global $session;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $usercampagneid = $session[&#39;userid&#39;];&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$abo = 36;</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$max_power = $abo*1000*1.25; //allow 25% more<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$maxtime=120; //2min</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// identiying the input id<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$result = $this-&gt;mysqli-&gt;query(&quot;SELECT * FROM input WHERE processList LIKE &#39;%21:$feedid%&#39;&quot;);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$row = $result-&gt;fetch_array();<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$inputid = $row[&#39;id&#39;];&nbsp; // check needed ? (that one and only one row exists)</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// getting the calibration factor<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$processes = explode(&quot;,&quot;,$row[&#39;processList&#39;]);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$firstprocess = explode(&quot;:&quot;,$processes[0]);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if ($firstprocess[0]==2)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$calibfactor = $firstprocess[1];<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$calibfactor = 1;<br />
&nbsp;&nbsp; &nbsp;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$Whinc = $calibfactor*($this-&gt;input-&gt;get_last_value($inputid)-$this-&gt;input-&gt;get_old_value($inputid));<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$timeelapsed = $this-&gt;input-&gt;get_last_Utime($inputid)-$this-&gt;input-&gt;get_old_Utime($inputid);</p>
<p>
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;//if Wh increment is positive and 0 &lt; time elapsed &lt; maxtime, update the power feed<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if ($Whinc&gt;=0 &amp;&amp; $timeelapsed&gt;0 &amp;&amp; $timeelapsed&lt;$maxtime){<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$power =&nbsp; $Whinc * 3600 / $timeelapsed;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if ($power&lt;$max_power)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$this-&gt;feed-&gt;insert_data($feedid, $time, $time, $power);<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$power = null;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;}<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;else<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;$power = null;</p>
<p>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return $power;<br />
&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33634"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8471.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ChrisBirkett&#039;s picture" title="ChrisBirkett&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/8471.html" title="View user profile.">ChrisBirkett</a> on Wed, 26/08/2015 - 15:07.</div>
    <div class="content">
     <p>Nice one. It&#39;s my own VPS actually but it was&nbsp;under-spec&#39;d&nbsp;and I was keen to avoid installing yet another service. I did cough up for an extra 512MB RAM in the end&nbsp;but may revert back once I&#39;ve looked through&nbsp;the changes in detail. Thanks a lot!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33640"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7723.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7723.jpg" alt="daturach&#039;s picture" title="daturach&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/7723.html" title="View user profile.">daturach</a> on Wed, 26/08/2015 - 22:10.</div>
    <div class="content">
     <p>Thanks for the script.</p>
<p>I was doing a few tests with emoncms.org, passing data through URLs as described in&nbsp;http://emoncms.org/input/api</p>
<p>Something caught my attention. The server is running on PHP 5.3.10 (X-Powered-By: &nbsp;PHP/5.3.10-1ubuntu3.16).</p>
<p>A few days ago, my Linux Host provider informed me they will move to PHP 5.6, &nbsp;sometimes next year.</p>
<p>Is EmonCMS&nbsp;9.0 ready for this version?</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33647"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5027.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms: installation on a shared host linux</h3>

    <div class="submitted">Submitted by <a href="../user/5027.html" title="View user profile.">Eric_AMANN</a> on Thu, 27/08/2015 - 07:59.</div>
    <div class="content">
     <p>Chris,</p>
<p>The piece of code above is just an example to show how I implemented Wh_accumulator and Kwh_to_power without reddis.</p>
<p>To make these processes work on your server, you must modify many files (input_contoller.php, input_model.php, process_model.php, ...) and you must also create some columns in MySQL.</p>
<p>I&#39;m not sure it&#39;s a good idea to make those modifications because it will be difficult to maintain your server in the future. I made it on my own server because I had an urgent need. Anyway, let me know if you need a complete guide.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10887"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-zsllpUgYSN1b0-PFshHDP4WX3DK4zZcYeGr7HK3Dbjs" value="form-zsllpUgYSN1b0-PFshHDP4WX3DK4zZcYeGr7HK3Dbjs"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
