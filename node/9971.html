<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/9971 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:11:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Noise in volt readings | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Noise in volt readings</h3>
        <span class="submitted">Submitted by <a href="../user/7524.html" title="View user profile.">peterhum</a> on Thu, 08/01/2015 - 01:53</span>
        <div class="content"><p>I&#39;m in the early stages of a DIY monitor using Arduino and the emonLib.</p>
<p>So far I&#39;ve got the AC source set up on a protoboard. I&#39;m using this transformer:</p>
<p><a href="http://au.element14.com/myrra/44086/transformer-1-5va-9v/dp/1689048?Ntt=44086" title="http://au.element14.com/myrra/44086/transformer-1-5va-9v/dp/1689048?Ntt=44086">http://au.element14.com/myrra/44086/transformer-1-5va-9v/dp/1689048?Ntt=...</a></p>
<p>And a 33ohm load with the standard divider and offset. I&#39;m using a 10uF electrolytic for the cap.</p>
<p>I&#39;m getting a lot of variability in the voltage readings compared to a Watts power monitor that I&#39;m trying to calibrate to. I&#39;m using 200 half cycles in the call to calcVI. The calculated voltage tends to jump around 2 to 3 volts regularly and sometimes more. At the same time the Watts monitor wil be varying by something in the order of 0.3V.</p>
<p>Looking at the raw readAnalog values I notice that they sit at a max level of around&nbsp;920&nbsp;(for 246 Vrms) but then every now and again will pop sharply&nbsp;up to 1023 and then resume per normal in the next cycle.</p>
<p>Is this normal? Might it improve when the components are more permanently mounted?</p>
<p>Any help greatly appreciated.</p>
<p>Cheers</p>
<p>Peter</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>
&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10009.html" class="topic-previous" title="Go to previous forum topic">‹ Monitoring Temp and Humidty of my Humidor - those the right parts ?</a>
              <a href="9990.html" class="topic-next" title="Go to next forum topic">Basic CT circuit queries ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26548"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 08/01/2015 - 05:39.</div>
    <div class="content">
     <p>It does sound like it could be noise, or possibly a loose connection. &nbsp;What R value are you using to construct your mid-rail? &nbsp;Is it a 3.3V system, or a 5V system? &nbsp;Does a DC multimeter on the mid-rail show up a nice steady voltage? &nbsp; &nbsp;I assume the spike is too brief to catch on a multimeter? &nbsp;You mentioned a 33R, where does that fit into things? &nbsp;And with the transformer switched off, how steady are the readings on just the mid-rail?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26549"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7524.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="peterhum&#039;s picture" title="peterhum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/7524.html" title="View user profile.">peterhum</a> on Thu, 08/01/2015 - 05:54.</div>
    <div class="content">
     <p>Hi - thanks for the reply.</p>
<p>Sorry - 33 ohm is on the current sensor. I&#39;m getting myself confused.</p>
<p>It&#39;s 5V. Not sure what mid rail is. Is that the 2.5V offset? In which case I&#39;m using 200k resistors cause that&#39;s what I had on hand. And &#39;5V&#39; supply measures 4.82V on the multimeter and the 2.4V on the offset looks good on the multimeter.</p>
<p>Will check the readings with transformer switched off this evening.</p>
<p>Thanks</p>
<p>Peter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26555"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 08/01/2015 - 11:41.</div>
    <div class="content">
     <p>Note that, contrary to intuition, a high value pair of resistors in the voltage divider that produces the bias/mid-rail/offset does not increase the overall noise. Reducing the resistors decreases the noise voltage but increases the bandwidth to compensate exactly! </p>
<p>My guess is it is noise spikes getting through the transformer, so a physical low-pass filter (but with a corner frequency high enough to not give an appreciable phase shift at mains frequency) might help.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26560"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 08/01/2015 - 12:36.</div>
    <div class="content">
     <p>One common technique to help with the phase shift is to always put the exact same filter on all your V and I input channels.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26577"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7524.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="peterhum&#039;s picture" title="peterhum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/7524.html" title="View user profile.">peterhum</a> on Thu, 08/01/2015 - 23:34.</div>
    <div class="content">
     <p>Thanks very much for the help, really appreciate it.</p>
<p>I&#39;m thinking that the first thing I&#39;ll do is&nbsp;solder all the components to some vero board to eliminate contributions from dodgy connections. I&#39;ll stick with the high resistor values I&#39;m using. And I&#39;ll do some research on a &#39;physical low pass filter&#39;. All new to me but interesting.</p>
<p>Cheers</p>
<p>Peter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26578"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 09/01/2015 - 00:29.</div>
    <div class="content">
     <p>"physical low pass filter" - by that I meant not a software filter. Try here for a start: <a href="http://en.wikipedia.org/wiki/Low-pass_filter" title="http://en.wikipedia.org/wiki/Low-pass_filter">http://en.wikipedia.org/wiki/Low-pass_filter</a>. If you look at the simple RC filter, you already have a 9.2 k&Omega; resistor (approx.) in the form of your 10:1 voltage divider, so a capacitor of 3.3 nF from the voltage ADC input to 0 V will give you about 0.6 &deg; phase shift at 50 Hz, and a corner frequency of about 5 kHz. You can probably live with that phase shift, though you'll need to compensate for it in the software with PHASECAL.</p>
<p>But first, you definitely need to eliminate bad connections, and make sure you have a good 0 V connection to your power supply negative. Also, keep the connection to the analogue input as short as reasonably possible.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26589"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Fri, 09/01/2015 - 09:56.</div>
    <div class="content">
     <p>And if you want to see a scope picture of such a filter in action, you can find it in this thread:</p>
<p><a href="9956.html">http://openenergymonitor.org/emon/node/9956</a></p>
<p>That signal is a current signal, rather than a voltage signal, but the principle is the same. &nbsp;If you want to read up on why you want to keep that high frequency junk out of your ADC conversions, include &quot;anti-aliasing&nbsp;filter&quot; in your searching. &nbsp; A low pass filter connected to an ADC input is often referred to as an anti-aliasing filter to highlight its purpose.</p>
<p>If you do have joy with the filter on V, &nbsp;for the trivial price of a few more components and a bit more soldering, you might want to also consider replicating it on all your current inputs. &nbsp;You may well then give a shop-bought monitor a run for its money with regards noise. &nbsp;As far as I can tell, they don&#39;t seem to do any filtering on their analog inputs.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26678"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7524.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="peterhum&#039;s picture" title="peterhum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/7524.html" title="View user profile.">peterhum</a> on Mon, 12/01/2015 - 00:45.</div>
    <div class="content">
     <p>Thanks very much Robert, dbc.</p>
<p>I haven&#39;t done anything with the low pass filter as yet, but was interested in reading up on them. The thing that worked for me was to use an external analog reference on the Arduino. As soon as I did that the readings all settled down. I don&#39;t understand why that should be at all. I was previously using the +5V line from the Arduino across the voltage divider that provided the 2.5V offset, and then using the internal Aref, the Arduino being powered&nbsp;off the USB.</p>
<p>I switched to an external 9v supply and used 5v from a 7805 regulator for the offset and the Arduino external aref, and all the inconsistencies fell away. This was prompted by this guy&#39;s post:</p>
<p><a href="http://technobabble.prithvitech.com/stabilizing-the-arduino-analogread/" title="http://technobabble.prithvitech.com/stabilizing-the-arduino-analogread/">http://technobabble.prithvitech.com/stabilizing-the-arduino-analogread/</a></p>
<p>Is this something that everyone knows about and does as normal practice?</p>
<p>I&#39;ll come back to the low pass filter if I may.</p>
<p>Cheers</p>
<p>Peter</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26697"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 12/01/2015 - 14:48.</div>
    <div class="content">
     <p>I've deleted your near-duplicate post. Please check that posts are not held for moderation before duplicating your posts.</p>
<p>We've long suspected that noise from the digital side is getting into the ADC, and that Arduino boards are worse than the emonTx (and especially worse than the emonTx V3.4), so it's very good (in a way!) to hear how you solved your problem. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26731"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Noise in volt readings</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 13/01/2015 - 00:06.</div>
    <div class="content">
     <p>I&#39;m glad you found a solution that solves your problems. &nbsp;I suspect there are quite a few variables contributing here, including&nbsp;but probably not limited to:</p>
<p>. cleanliness of your USB supply</p>
<p>. does your Arduino have a decoupling cap on AREF&nbsp;(some do, some don&#39;t)</p>
<p>. does your Arduino&nbsp;connect AVCC to VCC via an inductor (some do, some don&#39;t)</p>
<p>. layout and design of your Arduino</p>
<p>As it happens&nbsp;I recently did a very similar experiment to the one in your pointer, and got much cleaner results than he did, and you can see from the photo​&nbsp;I&#39;ve made no attempt to keep signals short or prevent&nbsp;noise. &nbsp;If anything, they look like antennas:&nbsp;<a href="6196-2.html">http://openenergymonitor.org/emon/node/6196.</a></p>
<p>Of course my experiment (and the one in your pointer) is a much simpler environment than yours... no 50Hz AC signals bouncing around mid-rails... just straight DC measurements.</p>
<p>If you do decide to also investigate the low-pass filter, the relevant bit in the AVR datasheets says:</p>
<p><em>Signal components higher than the Nyquist frequency (fADC/2) should not be present for either<br />
kind of channels, to avoid distortion from unpredictable signal convolution. The user is advised<br />
to remove high frequency components with a low-pass filter before applying the signals as<br />
inputs to the ADC.</em></p>
<p>And you&#39;ll find pretty similar text in the datasheet for any ADC from any manufacturer (and any text book about ADC conversions).</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/9971"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-NCoJMz3tpVnxyjbS0r94SiaR3H6AL9ET-PbPBwJlFCc" value="form-NCoJMz3tpVnxyjbS0r94SiaR3H6AL9ET-PbPBwJlFCc"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/9971 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:11:02 GMT -->
</html>
