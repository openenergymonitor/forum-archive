<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/737 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:53:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>kWh/d input processing and export values | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">kWh/d input processing and export values</h3>
        <span class="submitted">Submitted by Guest on Tue, 12/06/2012 - 20:19</span>
        <div class="content"><p>How does the kWh/d input processing handle negative values (ie exporting to the grid)? Does it ignore them, or does it <em>decrease</em> the total for each day?</p>
<p>I&#39;ve noticed that my total energy use (grid import/export + SolarPV, logged to kWh/d) always equals my grid import/export kWh/d + SolarPV kWh/d. Even on sunny days when I&#39;ve been exporting solidly for several hours.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="1209.html" class="topic-previous" title="Go to previous forum topic">‹ kWh to kWh/d</a>
              <a href="945.html" class="topic-next" title="Go to next forum topic">SOLVED - Cms3 - Cannot create dashboard ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-4825"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by vworp (not verified) on Fri, 15/06/2012 - 15:42.</div>
    <div class="content">
     <p>Do we need two alternative kWh/d feed processes to correctly track import and export?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4827"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 16/06/2012 - 09:51.</div>
    <div class="content">
     <p>It should decrease and eventually go negative if net is exported.</p>
<p>It calculates the kwh&nbsp;increment from from the last measurement by multiplying the power by the time at that power. So if the power is negative the kwh increment will be negative and will subtract from the kwh figure stored up to that point.</p>
<p>Do your kwhd bars decrease at all when the sun is out and your consumption is less than gen?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4845"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by vworp (not verified) on Sun, 17/06/2012 - 10:50.</div>
    <div class="content">
     <p>Yes, I have several days graphed with kWh as negative values (generation was indeed higher than consumption). I don&#39;t find this terribly intuitive as it doesn&#39;t tell me what my import and export values were.</p>
<p>Can we track grid import and export separately with emoncms?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sun, 17/06/2012 - 14:41.</div>
    <div class="content">
     <p>Do you have an input for solar PV gen and an input for grid import/export?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4862"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by vworp (not verified) on Mon, 18/06/2012 - 17:43.</div>
    <div class="content">
     <p>Yes, Power1 is grid import/export, Power2 is SolarPV gen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4866"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 18/06/2012 - 22:31.</div>
    <div class="content">
     <p>Great, ok just written a section here to go through the input processing setup steps:&nbsp;<a href="../applications/solarpv/emoncms.html">http://openenergymonitor.org/emon/applications/solarpv/emoncms</a>&nbsp;Let me know if I can clarify further.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4869"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by vworp (not verified) on Tue, 19/06/2012 - 07:12.</div>
    <div class="content">
     <p>Yeah, that&#39;s pretty much identical to how I have it set up. But, it doesn&#39;t log my import and export values for the day.</p>
<p>If I generate 15kWh from solar PV, and use 13kWh over a day, this will report my consumption as -2kWh, This doesn&#39;t account for anything I&#39;ve imported at night, when the solar PV isn&#39;t generating. What I want is to track what I&#39;ve imported and exported, perhaps a kWh/d process that only increments on negative values and another kWh/d that only increments on positive values.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4942"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rechena&#039;s picture" title="rechena&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by rechena (not verified) on Thu, 21/06/2012 - 15:02.</div>
    <div class="content">
     <p>Maybe this is off topic, but is there a way to &quot;reset&quot; the total kWH value?</p>
<p>Meaning, starting over?</p>
<p>&nbsp;</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4943"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 21/06/2012 - 16:32.</div>
    <div class="content">
     <p>&nbsp;vworp: ah ok yes that would need a new input processor. I will see if I can implement it.</p>
<p>rechena: do you mean resetting the daily kwh or the result of the power to kwh processor?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4957"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="rechena&#039;s picture" title="rechena&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by rechena (not verified) on Fri, 22/06/2012 - 09:33.</div>
    <div class="content">
     <p>Trystan: Power to kWh a new fresh start :)</p>
<p></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6035"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joseffh&#039;s picture" title="joseffh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by joseffh (not verified) on Mon, 03/09/2012 - 16:21.</div>
    <div class="content">
     <p>&nbsp;I have been trying to do the same as vworp (show import and export totals separately for a period) and came to the conclusion that it is not currently possible or there was something wrong with my algebra skills, so I was wondering if you had made any progress on the new input processor - I know you are busy.</p>
<p>As an alternative I was going to modify the code that is in the emonglcd that determines the showing of the text importing/exporting, put this on the emontx or emonbase and create two extra inputs for emoncms.</p>
<p>The grid figure would be passed to two inputs for emoncms, named as 'import' and 'export', each having a value assigned for each sending of the data. If the grid figure is negative, then the value, unsigned would be passed to the export input for emoncms and the import input passed would be set at zero. If the grid figure is positive then the value would be passed to the import input for emoncms, and the export input passed would be set at zero. Within emoncms the input processing would then be straight forward.</p>
<p>Any comments on the viability of this approach would be welcome in case I have missed something in my logic.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6182"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by vworp (not verified) on Sat, 15/09/2012 - 12:37.</div>
    <div class="content">
     <p>Trystan,</p>
<p>I&#39;ve revisited this in the last week or so, and tried to add import and export values to my history page on the GLCD. It doesn&#39;t work for some reason, just makes the GLCD hang.</p>
<p>I&#39;ve manually pasted my alterations to <a href="https://github.com/vworp/EmonGLCD" title="https://github.com/vworp/EmonGLCD">https://github.com/vworp/EmonGLCD</a> (git utterly refuses to work on my machine at the moment).</p>
<p>Rough gist, I&#39;ve added calculations for wh_import and wh_export to power_calculations() (filling the array is currently commented out) and an extra column to draw_history(). With everything commented out apart from the wh calculations, my GLCD hangs. I&#39;m not sure what&#39;s going wrong here, any chance you can have a look see if anything stands out?</p>
<p>Any movement on the new input processor for emoncms?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6184"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joseffh&#039;s picture" title="joseffh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by joseffh (not verified) on Sat, 15/09/2012 - 17:49.</div>
    <div class="content">
     <p>I&#39;ve added the code to my&nbsp;emonbase&nbsp;sketch following the descrtiption in my earlier post. Posted to emoncms as powerexport and powerimport. Using &#39;power&#39; in the name means autoconfigure inputs works on emoncms. If you would like to see the result please go to my dashboard emoncms.org/joseffh. I&#39;ll post the code snippet later.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6190"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 16/09/2012 - 14:46.</div>
    <div class="content">
     <p><a href="../user/1071.html" title="View user profile.">vworp,</a></p>
<p>I know your (old) code is using nearly all the available memory, is the stack overflowing? I&#39;m not well conversed with the details so you need to research and check.</p>
<p>(Note: by writing the history within a loop and calculating the screen positions rather than hard coding each, you can save a few hundred bytes which should help).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6205"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="joseffh&#039;s picture" title="joseffh&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by joseffh (not verified) on Mon, 17/09/2012 - 18:25.</div>
    <div class="content">
     <p>OK, here is the little bit of code I have added to the emonbase sketch to calculate a separate power import and powerexport value to send to emoncms. Code is adapted from that used in the emonGLCD sketch.</p>
<p>first before the &#39;SETUP section</p>
<p><strong>double consuming, gen, grid;<br />
	int powerexport, powerimport;</strong></p>
<p>then the On RF receive section has an addition</p>
<p>&nbsp; //-----------------------------------------------------------------------------------------------------------------<br />
	&nbsp; // 1) On RF recieve<br />
	&nbsp; //-----------------------------------------------------------------------------------------------------------------<br />
	&nbsp; if (rf12_recvDone()){&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (rf12_crc == 0 &amp;&amp; (rf12_hdr &amp; RF12_HDR_CTL) == 0)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int node_id = (rf12_hdr &amp; 0x1F);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (node_id == 10)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // EMONTX<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; emontx = *(PayloadTX*) rf12_data;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // get emontx data<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // print emontx data to serial<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;emonTx data rx&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; last_rf = millis();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // reset lastRF timer<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay(50);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // make sure serial printing finished<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>//import or export calculation<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; gen = emontx.power2;&nbsp;&nbsp; if (gen&lt;15) gen=0;&nbsp;&nbsp;&nbsp;&nbsp; // set minimum threshold for generation to be recorded &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; consuming=gen + emontx.power1; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; grid=emontx.power1; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (gen &gt; consuming)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // if more is being generated than consumed then there must be an export<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; grid= grid*-1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // changes the export to a positive value<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; powerimport=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // as power is being exported power being imported must be zero<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; powerexport=grid; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; powerexport=0;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; powerimport=grid;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</strong></p>
<p>And finally in the JSON creation</p>
<p>str.print(&quot;,power2:&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(gen);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Add power reading<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(&quot;,power3:&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(emontx.power3);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Add power reading<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>str.print(&quot;,powerexport:&quot;);&nbsp;&nbsp;&nbsp; str.print(powerexport);</strong><br />
	&nbsp;&nbsp;&nbsp;&nbsp;<strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(&quot;,powerimport:&quot;);&nbsp;&nbsp;&nbsp; str.print(powerimport); </strong></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6304"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by vworp (not verified) on Sun, 23/09/2012 - 13:13.</div>
    <div class="content">
     <p>I was going to give this mod a go, but I&#39;m having problems with the current NanodeRF sketch.</p>
<p><a href="1079.html">http://openenergymonitor.org/emon/node/1079</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6787"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by vworp (not verified) on Fri, 19/10/2012 - 15:57.</div>
    <div class="content">
     <p>Now that the dhcp issues have been resolved and I have a working Nanode again, I&#39;ve had a go at this patch. It works great with the minor niggle that it seems to break the JSON string when a temperature reading from the GLCD is present. I&#39;m thinking that the extra import and export values are pushing the str.print over length. I&#39;ll have a look later and see what can be done.</p>
<p>If anyone else wants to try this fork, it&#39;s pretty up to date with the master branch:-</p>
<p><a href="https://github.com/vworp/NanodeRF" title="https://github.com/vworp/NanodeRF">https://github.com/vworp/NanodeRF</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6791"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: kWh/d input processing and export values</h3>

    <div class="submitted">Submitted by vworp (not verified) on Sat, 20/10/2012 - 12:26.</div>
    <div class="content">
     <p>I&#39;ve tweaked my fork so the JSON string isn&#39;t truncated when the GLCD temperature is added to it.</p>
<p>Question for Trystan and Glyn:- I like the idea of having import and export calculated on a base unit rather than in emoncms. If the multinode sketch is the way forward, might it be better to add this calculation to emonTX?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/737"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-3itCKWfKggUfWC45T0mYYwICg3FhdWYrYC_ExJHVmqY" value="form-3itCKWfKggUfWC45T0mYYwICg3FhdWYrYC_ExJHVmqY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/737 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:53:13 GMT -->
</html>
