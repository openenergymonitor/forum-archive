<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5993 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:40:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Too high voltage measurement compared to mains voltage (uno + emonTX Shield) | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Too high voltage measurement compared to mains voltage (uno + emonTX Shield)</h3>
        <span class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Sat, 25/10/2014 - 21:25</span>
        <div class="content"><p>Hi all,</p>
<p>I have an arduino uno with a emonTX shield purchased recently, along with a AC-AC adapter (77DE-06-09)&nbsp;with a euro plug.</p>
<p>I&#39;m using the standard sketch from here:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxShield/Shield_CT1234_Voltage " title="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxShield/Shield_CT1234_Voltage ">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxSh...</a></p>
<p>However, I&#39;m getting readings around 275-285&nbsp;V on the mains voltage... This seems much too high... I also checked with a standard energy meter that plugs into the power outlet, this showed 230 V (as would be expected).</p>
<p>I didn&#39;t change the calibration factors yet -- just seems strange the measurement is so far off, when I got the AC-AC adapter from the shop&nbsp;?</p>
<p>The calibration factor in the sketch is 300.6 as shown in this code line</p>
<p>if (CT1) ct1.voltage(0, 300.6, 1.7); // ct.voltageTX(ADC input, calibration, phase_shift).</p>
<p>However, the calibration page only makes reference to the factors 220.0 and 260.0, if I read the page correctly. (<a href="https://learn.openenergymonitor.org/?redirect=calibration" title="http://openenergymonitor.org/emon/buildingblocks/calibration">http://openenergymonitor.org/emon/buildingblocks/calibration</a>).</p>
<p>Can someone confirm the 300.6 figure for the emonTX&nbsp;shield?</p>
<p>&nbsp;</p>
<p>Since I have the energymeter I can adjust my calibration figure to make the output correct. Shall I&nbsp;just do that, or should I be concerned something else is wrong?</p>
<p>&nbsp;</p>
<p>Attached picture of setup (the arduino was powered by a USB-PC cable). The green cable is to set the DS18B20 to dig4 on the uno, by the way...</p>
<p>&nbsp;</p>
<p>Many thanks for your kind input</p>
<p>Lasse</p>
<p>​</p>
<p>ps: additional question popped up: when I power the arduino from an external power supply (not the PC), I can&#39;t get my sketch to run before I hit the &quot;reset&quot; button on the arduino... When powering from the PC this is done upon uploading the sketch and when hitting the &quot;serial monitor&quot; command...</p>
<p>However, when the emonTX shield is on top of of the UNO, its not easy to actually reach the RESET button on the UNO PCB since its underneath the shield... Am I doing something wrong - should the sketch start without hitting reset? I tried adding a 3s delay in the setup(), read&nbsp;somewhere that that may be a good idea so the RFM12B would have time to startup... But still the sketch doesn&#39;t start unless I physically hit the RESET button.</p>
<p><span style="line-height:1.6">The power adapter should be fine: 9V and &gt;</span>500mA<span style="line-height:1.6"> (</span>650mA<span style="line-height:1.6"> I think),</span></p>
<p>--------------------&nbsp;</p>
<p>&nbsp; delay(3000);<br />
&nbsp;&nbsp;rf12_set_cs(5); //set RFM&nbsp;SS pin 5, according to option 2 <a href="http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield%c2%a0" title="http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield ">http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield </a><br />
&nbsp;&nbsp;rf12_initialize(nodeID,&nbsp;RF_freq,&nbsp;networkGroup); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// initialize&nbsp;RFM12B<br />
&nbsp;&nbsp;rf12_sleep(RF12_SLEEP);&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5989.html" class="topic-previous" title="Go to previous forum topic">‹ Emoncms stopped logging data</a>
              <a href="5928.html" class="topic-next" title="Go to next forum topic">emontx shield V2 with RFM12b on Arduino UNO R2 can&#039;t get signals to raspberry pi ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-24791"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Too high voltage measurement compared to mains voltage (uno + emonTX Shield)</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Sat, 25/10/2014 - 21:27.</div>
    <div class="content">
     <p>Don&#39;t think the picture uploaded - trying again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24792"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Too high voltage measurement compared to mains voltage (uno + emonTX Shield)</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Sat, 25/10/2014 - 21:32.</div>
    <div class="content">
     <p>hmmm file upload is not really working for me.</p>
<p>Anyway, I&#39;ll upload it to the web in stead.&nbsp;</p>
<p><strong>Picture is here:</strong>&nbsp;http://www.lassetobiasen.dk/images/2014-10-23_uno%20setup.jpg&nbsp;</p>
<p><strong>Sketch is here:</strong>&nbsp;http://www.lassetobiasen.dk/images/Shield_CT1234_Voltage_Temp_LST.ino&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24793"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Too high voltage measurement compared to mains voltage (uno + emonTX Shield)</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 25/10/2014 - 22:00.</div>
    <div class="content">
     <p>If you look at the circuit diagram on Solderpad, the voltage divider is 120 k&Omega; and 10 k&Omega;, so plugging those numbers into the formula<br />
   voltage constant = 230 × 13 ÷ 11.5 = 260<br />
("13" is the inverse of the voltage divider ratio, "11.5" is the Euro adapter output voltage from the data sheet for 230 V in). There are component tolerances of course, 5% on the adapter voltage and 1% on each resistor, so if those have all gone the wrong way you might well see a very high voltage. The purpose of calibration is to correct for those. I suggest you start with a calibration constant of 260, and adjust it so that you get the same voltage as your energy meter (but check its claimed accuracy first).</p>
<p>(I suspect the example sketch hasn't been corrected for the newer adapters and the changed divider ratio, it was 11 on the earlier shield.)</p>
<p>Sorry I can't help with the reset problem.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24794"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Too high voltage measurement compared to mains voltage (uno + emonTX Shield)</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 25/10/2014 - 22:33.</div>
    <div class="content">
     <p>The coefficients for the Shield are in the table - now! I don't quite know why they were missed off. They are the same as the emonTx V3, as the divider ratio is the same for both. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24795"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Too high voltage measurement compared to mains voltage (uno + emonTX Shield)</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sun, 26/10/2014 - 01:28.</div>
    <div class="content">
     <p>In the case where it doesn&#39;t run without a manual reset, does the Uno&#39;s&nbsp;LED flash briefly, or does the LED remain completely dark? &nbsp;</p>
<p>If the LED flashes and then goes off, that suggests it&#39;s coming out reset ok and probably jumping to the system image ok. &nbsp;Most bootloaders turn the LED off just before they jump to the system image. &nbsp;You could then add some code right at the beginning of setup() to turn the LED on, and see if that runs. &nbsp; Check the Blink example if you&#39;re unsure of how to do that, but basically you need to make pin 13 an output and set it high. &nbsp;Assuming that works, i.e. you&#39;ve now got a hung system with the LED on, then move that LED-on code further south until it doesn&#39;t come on, and you&#39;ll be able to narrow down where it&#39;s hanging.</p>
<p>If the LED remains completely dark then that suggests not even the bootloader is able to run, which would suggest a voltage issue, but given it &quot;recovers&quot; with a manual press of the RESET button that seems unlikely. &nbsp;The BOD is pretty good at bringing the CPU out of reset after the voltage has stabilised, so my money is on a firmware hang.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24814"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Too high voltage measurement compared to mains voltage (uno + emonTX Shield)</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Sun, 26/10/2014 - 17:55.</div>
    <div class="content">
     <p>@ Robert:</p>
<p>Thank you for your reply, that makes more sense. As you may remember I was getting watt readings slightly too high (+20%) but this was due to the voltage having an incorrect calibration figure. So this all seems to come together.</p>
<p>@dBC:</p>
<p>The UNO POWER LED goes green, and remains green (I don&#39;t think the other LEDs on the uno flash though). And the emonTX&nbsp;shield red LED doesn&#39;t flash at all -- I have it set for 2&nbsp;seconds on in my sketch, this doesn&#39;t happen unless I hit the manual reset on the UNO (kind of fiddly with the shield in the way!)</p>
<p>I am away on business for a few days (Ahh France) but I&#39;ll take your advice on moving some LED-on code around to see where it hangs!</p>
<p>Previously I have had some mishaps due to my own bad soldering, hopefully this is not again an issue ;-)</p>
<p>Thanks both for replying!</p>
<p>Kind regards,</p>
<p>Lasse</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5993"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-82MkhB0KMToxsBhGncsFJnxGTM9BonPuHdOh6kcCT3g" value="form-82MkhB0KMToxsBhGncsFJnxGTM9BonPuHdOh6kcCT3g"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/5993 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:40:40 GMT -->
</html>
