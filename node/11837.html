<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11837 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:49:23 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonhub warnings and exceptions | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonhub warnings and exceptions</h3>
        <span class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 20/12/2015 - 11:02</span>
        <div class="content"><p>Hi,</p>
<p>I&#39;ve been trying to get another system running in parallel with my current emonbase system and in checking the emonhub log file found some strange entries.</p>
<p>Firstly, I&#39;m getting a lot of Warnings about connecting to emoncms as follows:</p>
<p>2015-12-19 01:03:49,086 WARNING emonCMS couldn&#39;t send to server, URLError: [Errno -2] Name or service not known<br />
2015-12-19 01:03:49,088 WARNING emonCMS send failure: wanted &#39;ok&#39; but got &#39;&#39;<br />
2015-12-19 01:04:09,270 WARNING emonCMS couldn&#39;t send to server, URLError: [Errno -2] Name or service not known<br />
2015-12-19 01:04:09,273 WARNING emonCMS send failure: wanted &#39;ok&#39; but got &#39;&#39;<br />
2015-12-19 01:05:19,490 WARNING emonCMS couldn&#39;t send to server, URLError: timed out<br />
2015-12-19 01:05:19,493 WARNING emonCMS send failure: wanted &#39;ok&#39; but got &#39;&#39;<br />
2015-12-19 01:05:39,666 WARNING emonCMS couldn&#39;t send to server, URLError: [Errno -2] Name or service not known<br />
2015-12-19 01:05:39,669 WARNING emonCMS send failure: wanted &#39;ok&#39; but got &#39;&#39;</p>
<p>Also just after this I got:</p>
<p>2015-12-19 01:07:06,080 WARNING emonCMS couldn&#39;t send to server, Exception: Traceback (most recent call last):<br />
&nbsp; File &quot;/home/pi/emonhub/src/emonhub_reporter.py&quot;, line 227, in _send_post<br />
&nbsp; &nbsp; response = urllib2.urlopen(request, timeout=60)<br />
&nbsp; File &quot;/usr/lib/python2.7/urllib2.py&quot;, line 154, in urlopen<br />
&nbsp; &nbsp; return opener.open(url, data, timeout)<br />
&nbsp; File &quot;/usr/lib/python2.7/urllib2.py&quot;, line 431, in open<br />
&nbsp; &nbsp; response = self._open(req, data)<br />
&nbsp; File &quot;/usr/lib/python2.7/urllib2.py&quot;, line 449, in _open<br />
&nbsp; &nbsp; &#39;_open&#39;, req)<br />
&nbsp; File &quot;/usr/lib/python2.7/urllib2.py&quot;, line 409, in _call_chain<br />
&nbsp; &nbsp; result = func(*args)<br />
&nbsp; File &quot;/usr/lib/python2.7/urllib2.py&quot;, line 1227, in http_open<br />
&nbsp; &nbsp; return self.do_open(httplib.HTTPConnection, req)<br />
&nbsp; File &quot;/usr/lib/python2.7/urllib2.py&quot;, line 1200, in do_open<br />
&nbsp; &nbsp; r = h.getresponse(buffering=True)<br />
&nbsp; File &quot;/usr/lib/python2.7/httplib.py&quot;, line 1073, in getresponse<br />
&nbsp; &nbsp; response.begin()<br />
&nbsp; File &quot;/usr/lib/python2.7/httplib.py&quot;, line 415, in begin<br />
&nbsp; &nbsp; version, status, reason = self._read_status()<br />
&nbsp; File &quot;/usr/lib/python2.7/httplib.py&quot;, line 371, in _read_status<br />
&nbsp; &nbsp; line = self.fp.readline(_MAXLINE + 1)<br />
&nbsp; File &quot;/usr/lib/python2.7/socket.py&quot;, line 476, in readline<br />
&nbsp; &nbsp; data = self._sock.recv(self._rbufsize)<br />
timeout: timed out</p>
<p>and some time later after I rebooted I got a lot of warnings about my local emoncms</p>
<p>2015-12-19 13:56:48,663 INFO EmonHub Pre-Release Development Version (rc1.2)<br />
2015-12-19 13:56:48,705 INFO Opening hub...<br />
2015-12-19 13:56:56,200 WARNING emonCMSlocal send failure: wanted &#39;ok&#39; but got &#39;Can&#39;t connect to database, please verify credentials/configuration in settings.php&lt;br /&gt;Error message: &lt;b&gt;Can&#39;t connect to local MySQL server through socket &#39;/var/run/mysqld/mysqld.sock&#39; (2)&lt;/b&gt;&#39;<br />
2015-12-19 13:56:56,396 WARNING emonCMSlocal send failure: wanted &#39;ok&#39; but got &#39;Can&#39;t connect to database, please verify credentials/configuration in settings.php&lt;br /&gt;Error message: &lt;b&gt;Can&#39;t connect to local MySQL server through socket &#39;/var/run/mysqld/mysqld.sock&#39; (2)&lt;/b&gt;&#39;</p>
<p>which did clear after a second or two and then it started up with the intermittent errors about the connection to emoncms.org</p>
<p>Any ideas what the issue could be. I&#39;m guessing the ones after reboot are due to the local system getting up and running?</p>
<p>Simon</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11850.html" class="topic-previous" title="Go to previous forum topic">‹ Calibration 3-phase</a>
              <a href="11849.html" class="topic-next" title="Go to next forum topic">&quot;My Electric&quot; app shows wrong day of week ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-37276"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 20/12/2015 - 12:07.</div>
    <div class="content">
     <p>What image/software are you running? I see the log says emonhub&nbsp;v1.2 was this installed manually&nbsp;or included in an&nbsp;image?&nbsp;</p>
<p>Is it a new install or just a new problem?</p>
<p>the initial&nbsp;fault reported by emonhub is that there is a DNS problem, either in the OS, router or ISP etc. the latter warning it relays the response from emoncms, so emoncms was having some connection issue of it&#39;s own with the local mySQL server.</p>
<p>Thr traceback in&nbsp;between those issues is also a network type&nbsp;issue although I am unsure what and emonhub should have handled it better, if we find out what was causing the network issues I may be able to improve the error handling.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37283"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 20/12/2015 - 13:56.</div>
    <div class="content">
     <p>Hi Paul, it&#39;s a brand new installation on a Pi 2&nbsp;with the full Jessie image. All done according to your installation guide. No errors on the way, or finger trouble on my behalf. The rfm is a new rfm69.&nbsp;</p>
<p>I&#39;m struggling at the moment to get a stable system, the other one I&#39;m working on is a PiB&nbsp;with rfm12&nbsp;with Jessie which&nbsp;was my old system and worked forever without a hitch but is now not seeing the inputs. I&#39;m getting the non numeric error -&nbsp;WARNING 19 Discarded RX frame &#39;non-numerical content&#39;. Which I think is because the rfm doesn&#39;t get initialised properly. I get all the -&nbsp;WARNING 1 Discarded RX frame &#39;non-numerical content&#39; : [&#39;Available&#39;, &#39;commands:&#39;] followed by all the commands the rfm understands. I&#39;m a bit lothe to update the firmware on this one as it&#39;s run fine in the past.</p>
<p>Getting to the stage where it&#39;ll all be going out the window before long &nbsp;:-)</p>
<p>Thanks in advance for any suggestions you might have.</p>
<p>Simon&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37286"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 20/12/2015 - 15:08.</div>
    <div class="content">
     <p>Hi Simon. So the current system is a Pi 2 running &quot;stock&quot; ie not read-only,&nbsp;Raspbian Jessie, with emonhub&nbsp;v1.2 and emoncms, I&#39;m assuming v9.2, is it &quot;low-write&quot;, SD or HDD, stable or master, are there any emoncms modules installed? have you installed anything else or made any other changes? for example the wi-fi or are you using ethernet?</p>
<p>The install guides are by Paul Reed not myself so I am not overly familiar with them but it is a great help to know exactly what you have and linking or quoting the guides is a good start.</p>
<p>For the record I have had some stability issues with Jessie, I have not got to the bottom off it and I do not use Jessie for my own live system. On my dev Pi&#39;s it seems to be pot luck whether they even boot, sometimes I have to power cycle half a dozen times before a successful boot and that is just fresh Jessie, no changes, no software installed, so I&#39;m aware it&#39;s not perfect. I know many users report no problems at all but I can only report&nbsp;what I see.&nbsp;&nbsp;The latest revision of Jessie now includes a &quot;wait for internet connection&nbsp;on boot&quot;&nbsp;<em>option,&nbsp;</em>I&#39;m unsure if it previously waited or not but now it&#39;s optional, this may be related to the boot issue I have if Jessie is &quot;waiting&quot; for an internet connection, but since I always boot with a known good wired internet connection, it would suggest Jessie cannot see the internet connection and therefore I wonder if there are &quot;network&quot; issues in Jessie, Again I can only call it as I see it, I&#39;m sure there are many that will want to defend Jessie, but none are more eager than me to use Jessie.</p>
<p>Are you still getting the errors on the current system?</p>
<p>On your older system the non-numerical content response&nbsp;to the help text is expected from emonhub if the help text is triggered. The help text is only printed once at startup and following any unrecognised&nbsp;commands from the&nbsp;serial&nbsp;port. Assuming your rfm12 isn&#39;t resetting for some reason the likelyhood is something is being passed to the rfm2pi from the Pi, emonhub should have exclusive access to serial port and if that is the case the commands maybe coming from emonhub. is it v1.2 or the &quot;emon-pi&quot; variant, if the latter is the &quot;usa&quot; option removed from emonhub.conf? If the rogue command did come from emonhub it will be in the log just before the errors if you have &quot;loglevel = DEBUG&quot; set in the conf.&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37288"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 20/12/2015 - 16:44.</div>
    <div class="content">
     <p>Paul,</p>
<p>I&#39;ve copied the Admin page below which gives all the various versions etc. After the Jessie install I used the Setup to extend the partition, change the host name and password and also checked the locale etc. I also configured wifi&nbsp;and then set it to boot to CLI.</p>
<p>After installing emoncms, emonhub and configuring things for my api keys etc. I also followed the HDD guide and loaded the apps. Can&#39;t remember if I did this before or after the HDD step but it doesn&#39;t matter too much as I&#39;m running from the HDD anyway. I&#39;m pretty sure I loaded MQTT on this one as well and enabled it. But I didn&#39;t set it to low write or disable the logs.</p>
<p>It&#39;s interesting that you have had issues with Jessie. I haven&#39;t had any problems with booting but I did notice a strange lack of response from the system when sshing in with MobaXterm. Sometimes takes an age for the Pi to respond when letters are typed. No idea what that is about.</p>
<p>On the old system it&#39;s the same build effectively although I haven&#39;t done the HDD step or installed the Apps. I was trying to get myself a clean Jessie based system on the old Pi.</p>
<p>Will check to se if I still have errors but emonhub seems to have stopped logging for some reason. I&#39;ll make sure debug is off and reboot. EDIT: Debug was off and it&#39;s still not logging after a reboot..... &nbsp;Odd.</p>
<p>Emoncms Version 9.2 | 2015.11.27<br />
Server OS Linux 4.1.13+<br />
Host Homepi Homepi (127.0.1.1)<br />
Date 2015-12-20 15:53:29 UTC<br />
Uptime 15:53:29 up 2:13, 2 users, load average: 0.27, 0.15, 0.15<br />
HTTP Server Apache/2.4.10 (Raspbian) HTTP/1.1 CGI/1.1 80<br />
Database Version MySQL 5.5.44-0+deb8u1<br />
Host localhost (127.0.0.1)<br />
Date 2015-12-20 15:53:29 (UTC 00:00&zwnj;​)<br />
Stats Uptime: 8036 Threads: 2 Questions: 71821 Slow queries: 0 Opens: 59 Flush tables: 1 Open tables: 52 Queries per second avg: 8.937<br />
MQTT Version n/a<br />
Host 192.168.0.11 (192.168.0.11)<br />
PHP Version 5.6.14-0+deb8u1 (Zend Version 2.6.0)<br />
Modules Core &nbsp; date &nbsp; ereg &nbsp; libxml &nbsp; openssl &nbsp; pcre &nbsp; zlib &nbsp; bcmath &nbsp; bz2 &nbsp; calendar &nbsp; ctype &nbsp; dba &nbsp; dom &nbsp; hash &nbsp; fileinfo &nbsp; filter &nbsp; ftp &nbsp; gettext &nbsp; SPL &nbsp; iconv &nbsp; mbstring &nbsp; session &nbsp; posix &nbsp; Reflection &nbsp; standard &nbsp; shmop &nbsp; SimpleXML &nbsp; soap &nbsp; sockets &nbsp; Phar &nbsp; exif &nbsp; sysvmsg &nbsp; sysvsem &nbsp; sysvshm &nbsp; tokenizer &nbsp; wddx &nbsp; xml &nbsp; xmlreader &nbsp; xmlwriter &nbsp; zip &nbsp; apache2handler &nbsp; PDO &nbsp; curl &nbsp; dio &nbsp; json &nbsp; mcrypt &nbsp; mysql &nbsp; mysqli &nbsp; pdo_mysql &nbsp; readline &nbsp; redis &nbsp; mhash &nbsp; Zend OPcache &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37292"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 20/12/2015 - 17:35.</div>
    <div class="content">
     <p>I have noticed the SSH latency as well, sometimes when typing the console just stops printing and I have found I can actually open another SSH window log in and fully type the &quot;stuck&quot; command or text before the first console eventually finishes displaying what I typed.&nbsp;</p>
<p>I find that odd as the 2nd instance proves everything currently works and there was no apparent reason for it.</p>
<p>Anyway I haven&#39;t looked deeply into the info you&#39;ve given yet but I did notice some anomalies in the print above. the hostname appears duplicated, then the IP address in brackets after it is 127.0.1.1 presumably &quot;localhost&quot; and yet further on &quot;Host&nbsp;localhost is 127.0.0.1&quot; (which I believe&nbsp;to be&nbsp;the more accurate) and then under MQTT&nbsp;there is a &quot;assigned&quot; IP intended for the MQTT&nbsp;broker I know but probally a fixed IP for the same machine so there are at least 5 ways of &quot;addressing itself&quot;, not a problem if they all work all the time but since we have a possible DNS issue this may not help.</p>
<p>You say your old system worked &quot;forever&quot; so there is a strong possibility it&#39;s debian&nbsp;Jessie not Raspian Jessie as it took ages to &nbsp;port to Raspbian&nbsp;so may have differences.</p>
<p>What did &quot;configured wifi&quot; consist of? just using the in-built gui to add ssid and password&nbsp;or did you edit things to try and keep wifi alive?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37299"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 20/12/2015 - 20:34.</div>
    <div class="content">
     <p>Configured wifi was just using the gui - top right.</p>
<p>The MQTT address is the dynamic address assigned by my router to the Pi. Everything works fine there and the 127.0.0.1 is something I&#39;ve asked about before. Seems to be the local host address assigned during the installs.</p>
<p>Interesting you also see the stop/start on SSH windows - not sure I&#39;ve seen anything about this elsewhere but then I&#39;ve not been looking. Anyone else seen this?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37314"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Mon, 21/12/2015 - 07:55.</div>
    <div class="content">
     <p>Paul,</p>
<p>You didn&#39;t mention anything about the start up issue with the MySQL type errors as follows:</p>
<p>After reboot the log reads as follows...</p>
<p>2015-12-20 16:14:33,909 INFO EmonHub Pre-Release Development Version (rc1.2)<br />
2015-12-20 16:14:33,969 INFO Opening hub...<br />
2015-12-20 16:14:41,807 WARNING emonCMSlocal send failure: wanted &#39;ok&#39; but got &#39;Can&#39;t connect to database, please verify credentials/configuration in settings.php&lt;br /&gt;Error message: &lt;b&gt;Can&#39;t connect to local MySQL server through socket &#39;/var/run/mysqld/mysqld.sock&#39; (2)&lt;/b&gt;&#39;<br />
.......<br />
2015-12-20 16:14:46,399 WARNING emonCMSlocal send failure: wanted &#39;ok&#39; but got &#39;Can&#39;t connect to database, please verify credentials/configuration in settings.php&lt;br /&gt;Error message: &lt;b&gt;Can&#39;t connect to local MySQL server through socket &#39;/var/run/mysqld/mysqld.sock&#39; (2)&lt;/b&gt;&#39;</p>
<p>end of log and system functioning OK. This is on the Jessie system as above, so installed through the Raspi installation instructions.</p>
<p>It looks as though on startup emonhub&nbsp;can&#39;t get through to the database as it is taking time to start up. Should emonhub not wait for some time, say 10 seconds, before trying to connect to the database, or maybe after an initial send failure wait for 5 seconds and try again etc.</p>
<p>Also, why does it say EmonHun Pre-release Development Version (rc1.2) when this is the production version. Might be an idea to fix that.</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37343"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 21/12/2015 - 18:21.</div>
    <div class="content">
     <p>127.0.0.1 is a&nbsp;usual &quot;localhost&quot; reference, I was wondering&nbsp;where the 127.0.<strong>1.</strong>1 crept in.</p>
<p>setting the MQTT&nbsp;server&nbsp;to the&nbsp;DCHP assigned IP may cause trouble at some point, most routers do seem to be consistent with ip assignment but it&#39;s not guaranteed, if a new ip is assigned by your&nbsp;router the defined&nbsp;MQTT&nbsp;setting will not follow suit. The Pi&#39;s ip address should be fixed or preferably use a &quot;localhost&quot;&nbsp;address for MQTT&nbsp;eg try&nbsp;using 127.0.0.1.</p>
<p>I see where you are coming from with making emonhub&nbsp;wait at start up but the reality is that emoncms can spit out exceptions and warnings anytime so yes a delay may fix some of the problem some of the time but when ever emoncms&nbsp;restarts or just has an issue it outputs a message, in fact v9 encourages this behavior more than v8 and there is even a setting to increase&nbsp;the action in settings.php (this should be &quot;false&quot; to work better with emonhub, but even that doesn&#39;t totally prevent the error messages).</p>
<p>If you are running emonhub&nbsp;v1.2 it isn&#39;t so much of&nbsp;an issue as emonhub just logs the warnings and keeps retrying&nbsp;to post the data, the &quot;emon-pi&quot; variant doesn&#39;t react to the messages and just assumes the data was accepted, discards&nbsp;the data and moves on.</p>
<p>Emoncms should really use return codes to indicate a successful post or an error and I would be happy to collaborate with emoncms devs&nbsp;and make&nbsp;emonhub work with those codes if that approach was adopted.</p>
<p>I&#39;m thinking it&#39;s probally better not to start changing the name now as that may suggest the code has changed and cause confusion with the &quot;emon-pi&quot; variant. There have been no real changes to that &quot;release candidate&quot; for over a year. It did not make &quot;production status&quot; despite it&#39;s prolonged and reliable&nbsp;stability&nbsp;as there were many feature changes&nbsp;proposed in the experimental branch for a second release candidate that required a significant change to the core of emonhub, due to lack of peer interest development stalled until the &quot;emon-pi&quot; variant was released based on that experimental proof of concept&nbsp;code. Hopefully in the new year I will be able to return to that code and we can work towards getting v2 out and subject to testing worthy of a proper &quot;released&quot; status.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37360"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Tue, 22/12/2015 - 09:22.</div>
    <div class="content">
     <p>Ah, I get it Paul, sorry hadn&#39;t really twigged to your point about the difference in the localhost addresses.</p>
<p>MySQL seems to have it right and I&#39;ve noticed this in the past when installing the system. It would look like the 127.0.1.1 is from emoncms. <s>I wonder if there isn&#39;t a typo in the code somewhere. I guess this could be searched for.&nbsp;</s>&nbsp;&nbsp; EDIT: A quick search on emoncms in github&nbsp;shows 127.0.1.1 isn&#39;t in the code, so no idea where it&#39;s coming from.</p>
<p>On the MQTT address, I think this is how you would want it, because to access the system from outside your router you have to reserve the ip address for the emoncms&nbsp;system, so this is a fixed address as such inside your firewall even though it is dynamically allocated. In fact it might be an idea to add a section to the installation guide on accessing systems externally and using DuckDNS for example.</p>
<p>And thanks for the background on emonhub, my thoughts were really about trying to make sure any warnings etc. were &#39;real&#39; and not just due to normal startup, so that anyone looking at the logs would only see information in there which was relevant and not get sidetracked. Similarly&nbsp;for the name, if anyone starts delving they&#39;ll think that they haven&#39;t&nbsp;got the latest and greatest. But if you are going to start on V2 in the New Year then this I&#39;m sure will get sorted then.</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37365"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 22/12/2015 - 11:18.</div>
    <div class="content">
     <p>Using DuckDNS&nbsp;and accessing from outside the LAN is a whole&nbsp;other thing and not really relevant&nbsp;to this. If you were accessing MQTT&nbsp;from outside the LAN then the router would port&nbsp;forward&nbsp;any traffic pointed at the nominated port of the external (router) ip to the IP of the machine hosting the MQTT broker, regardless of whether the IP was dynamically assigned or fixed.</p>
<p>I don&#39;t recall you saying the Pi has a fixed address so please forgive me if I&#39;ve missed or forgotten something. Just for clarification the points I&#39;m making are not for or against the use of fixed ip addresses, they are about whether you have or you haven&#39;t without taking a stance whether you should or you shouldn&#39;t.</p>
<p>Setting the MQTT&#39;s IP address in emoncms&nbsp;only tells <u>emoncms </u>where the broker is, In this instance it is on the same machine but you are effectively&nbsp;telling it &quot;the fixed ip address that the mqtt broker is at currently and will always be located at is 192.168.0.11 because that is the&nbsp;dynamically assigned ip assigned by the router (and could&nbsp;be prone to change)&quot; which is misleading. the using a localhost&nbsp;reference would&nbsp;tell emoncms&nbsp;&quot;it&#39;s on the same machine no matter what the machines IP is&quot;.</p>
<p>Defining the &quot;fixed&quot; ip of the MQTT broker is fine IF it is actually a&nbsp;fixed IP, which unless you fix the machine&#39;s IP address it isn&#39;t.</p>
<p>Anyhow, the MQTT ip address is&nbsp;unlikely&nbsp;to be the cause of the issue you&#39;ve had and it may never present a problem if the dynamically assigned ip never changes, but it could cause unnecessary confusion for absolutely no gain. I only mentioned it since there is possibly&nbsp;a DNS / DCHP issue at large.</p>
<p>Regards the warnings in emonhub, they are not standard start up messages, they are both&nbsp;valid and informative , you are right they shouldn&#39;t be there. but pointing the finger at emonhub is shooting the messenger, emonhub has brought you good info that you may not of found elsewhere,&nbsp;delaying emonhub starting is the coding equivalent of us sticking our heads in the sand and hoping the problem just goes away.</p>
<p>There was a problem that effected emoncms, emoncms&nbsp;broadcast that event and emonhub logged it. If we don&#39;t want emonhub to know, we should stop emoncms&nbsp;sharing the problem and if we don&#39;t want emoncms&nbsp;to have a problem we need to fix the issue. Delaying emonhub starting is a bit like not switching your phone on in the morning incase someone rings to warn you of a problem you really should know about.</p>
<p>Going back to the log in your&nbsp;original post &quot;<em>couldn&#39;t send to server, URLError: [Errno -2] Name or service not known</em>&quot; is a very specific warning pointing to a problem resolving a name or IP, this combined with&nbsp;a relayed warning from emoncms indicating a problem accessing mySQL&nbsp;strongly&nbsp;suggests a dns/dchp/routing issue was present at that time, I can&#39;t say why that occurred but papering over the cracks and hiding the issue so the logs &quot;appear&quot; to be correct is not a direction I want to take&nbsp;emonhub&nbsp;in.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37370"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Tue, 22/12/2015 - 14:20.</div>
    <div class="content">
     <p><em>but pointing the finger at emonhub is shooting the messenger</em>&nbsp;&nbsp; Paul, I had no intention of doing that and if it came across as that sincere apologies. Like many on the forum, I&#39;m amazed at what has been achieved with the software and I couldn&#39;t be anywhere near having such a sophisticated system without the efforts of everyone involved.</p>
<p>My comments about waiting etc. was simply an observation that as with many systems, sometimes things take time to &#39;settle&#39; down and various services to become ready. So I guess the proper question I should have&nbsp;asked is whether this is normal behavior at startup, in terms of emoncms not being able to access the mySQL server and there being a problem resolving a name or IP.</p>
<p>If that is the case then surely each of the parts should wait until the services they need are ready before going into normal mode. Obviously not a clue how one would go about this &nbsp;but I&#39;m sure folks like yourself who are au fait with Linux would know how to do this.</p>
<p>If it&#39;s not the case, then given I&#39;ve followed the installation instructions to a T then has anyone any idea of what could be causing this. Do other users see this, do you see it in your logs after a complete refresh, Jessie + emoncms and emonhub?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37373"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 22/12/2015 - 15:09.</div>
    <div class="content">
     <p>No need for any apologies at all, I see your prospective and didn&#39;t take any offense at all, I wasn&#39;t so much defending emonhub as making sure you were on the right path.</p>
<p>No that isn&#39;t &quot;normal&quot; start up and yes things should be fixed, done probably or catered for, As I previously said I don&#39;t know why it happened, therefore&nbsp;I don&#39;t know how to fix it. I was trying to point out some observations re the fixed/dynamic ip and the double host name in hope that might nudge someone or something but no, at the moment if forced to make a wild guess (which is always a bad idea) I would say something is not 100% in Jessie as we have both seen other issues, but I&#39;m not in a position to make that call.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37377"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonhub warnings and exceptions</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Tue, 22/12/2015 - 17:28.</div>
    <div class="content">
     <p>Paul,</p>
<p>Here&#39;s a link to some info on 127.0.1.1. &nbsp; Seems it&#39;s all quite normal.....</p>
<p>&nbsp;</p>
<p><a href="http://serverfault.com/questions/363095/why-does-my-hostname-appear-with-the-address-127-0-1-1-rather-than-127-0-0-1-in" title="http://serverfault.com/questions/363095/why-does-my-hostname-appear-with-the-address-127-0-1-1-rather-than-127-0-0-1-in">http://serverfault.com/questions/363095/why-does-my-hostname-appear-with...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11837"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-5nY2ndhc-2U2tkTYMqSjXrt4re4RCCj1N3dtRazfV3E" value="form-5nY2ndhc-2U2tkTYMqSjXrt4re4RCCj1N3dtRazfV3E"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
