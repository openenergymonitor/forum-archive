<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/4357 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:24:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emoncms v8.03 debian with emontxV3 continuous kwhtotals noeeprom.ino issues | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emoncms v8.03 debian with emontxV3 continuous kwhtotals noeeprom.ino issues</h3>
        <span class="submitted">Submitted by <a href="../user/3824.html" title="View user profile.">ngbod</a> on Wed, 26/03/2014 - 12:45</span>
        <div class="content"><p>I am &nbsp;having &nbsp;some &nbsp;issues getting the &nbsp;continuous kWh totals noeeprom &nbsp;sketch &nbsp;setup with emoncms v8.03 deb as follows:</p>
<p>The emontx &nbsp;sketch says it&#39;s &nbsp; for 2 phase on header text , has&nbsp; sketch&nbsp; been&nbsp; changed&nbsp; to&nbsp; single phase?</p>
<p>The grid kWh input &nbsp;goes down/&nbsp; backwards when PV starts exporting.</p>
<p>
	Emoncms nodes page not working. &nbsp;Feeds can &nbsp;be created &nbsp;but they &nbsp;don&#39;t update, yet they do update &nbsp;if created&nbsp; from inputs page.<br />
	emoncms/node/set.json?nodeid=10&amp;data=20,20,20,20&nbsp;&nbsp;&nbsp;&nbsp; gives......<br />
	Notice: Undefined offset: 11 in /usr/share/emoncms/www/Modules/node/node_model.php on line 148</p>
<p>Notice: Undefined offset: 12 in /usr/share/emoncms/www/Modules/node/node_model.php on line 157</p>
<p>kWh to&nbsp; kWh/d &nbsp;feed only updates at midnight. Is&nbsp; it possible&nbsp; to&nbsp; have feed constantly updating throughout&nbsp; day the same &nbsp;as the kWh &nbsp;input from the &nbsp;emontx does?</p>
<p>Is &nbsp;there &nbsp;an &nbsp;option&nbsp; to choose&nbsp; realtime graph as well&nbsp; as&nbsp; bar&nbsp; graph&nbsp; for kWh/d. It&#39;s useful&nbsp; for pv&nbsp; to show&nbsp; daily energy production&nbsp; in&nbsp; relation&nbsp; to&nbsp; seasonal calculated &nbsp;expected &nbsp;daily output.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="4649.html" class="topic-previous" title="Go to previous forum topic">‹ API Query</a>
              <a href="4437.html" class="topic-next" title="Go to next forum topic">Realtime graph problem in emoncms v8 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-19862"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms v8.03 debian with emontxV3 continuous kwhtotals noeeprom.ino issues</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 26/03/2014 - 22:39.</div>
    <div class="content">
     <p>great to hear your trying it, yes its been changed to single phase, adapted from Robin&#39;s 2 phase sketch. I made it possible for the kwh to go down if the direction of energy flow changed, thinking that this could be useful. I guess another option would be to record, imported exported wh total separately.. wouldnt be too hard to do.</p>
<p>Which decoder did you add to nodeid&amp;data=20,20,20,20? Each csv value is a byte value, which can be combined to produce ints (2 bytes) or longs (4 bytes) It may be that you selected a decoder that is larger than the number of byte values your posting?</p>
<p>kwh to kwh/d - need to look into that.</p>
<p>realtime graphs, although technically possible it may need some coding to enable this.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19894"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ngbod&#039;s picture" title="ngbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms v8.03 debian with emontxV3 continuous kwhtotals noeeprom.ino issues</h3>

    <div class="submitted">Submitted by <a href="../user/3824.html" title="View user profile.">ngbod</a> on Thu, 27/03/2014 - 13:21.</div>
    <div class="content">
     <p>Recording the imported and exported Wh totals separately would be great. At present I can&#39;t see a use for the grid&nbsp;Wh&nbsp;input figure if you have a grid connected PV system. &nbsp;On Tuesday when I first started using the sketch I produced about 20 kWh of PV electric but still imported about 8 kWh from the grid for the day. The emontX recorded -12 kWh of grid&nbsp;useage for the day.</p>
<p>The decoder I have used is EmontxV3 (continuous sampling with Wh&nbsp;totals). The decoder has the Wh values as &#39;unsigned long&#39; but the sketch has them as &#39;long&#39; in the typedef struct&nbsp;section. Would this be a problem?</p>
<p>kWh to kWh/d is behaving very strangely. I set up kWh to kWh/d on CT2&nbsp;PV and CT3&nbsp;immersion diverter this morning and they are incrementing fine. I then went back to CT1 grid, which has sat frozen since midnight, and deleted it. I then set it up again the same as I did for CT2 and 3 but it still doesn&#39;t work. It&#39;s sat frozen on 0.00 now.</p>
<p>Edit: recreating the Ct1&nbsp;kWh to kWh/d feed now seems to have worked. It&#39;s now incrementing properly though probably decreases when exporting which I can&#39;t check just yet due to lack of sun.</p>
<p>I thought the realtime&nbsp;graphs for kWh/d might be an easy mod. I was hoping it would be as simple as changing &#39;DataType::DAILY&#39; to &#39;DataType::REALTIME&#39; for the kWh/d feed in process_model.php.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20011"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ngbod&#039;s picture" title="ngbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms v8.03 debian with emontxV3 continuous kwhtotals noeeprom.ino issues</h3>

    <div class="submitted">Submitted by <a href="../user/3824.html" title="View user profile.">ngbod</a> on Fri, 28/03/2014 - 21:28.</div>
    <div class="content">
     <p>Thanks, for the comments Trystan.</p>
<p>I&#39;ve had a go at splitting the import and export &nbsp;Wh for CT1&nbsp;grid and CT2&nbsp;PV in the emontx v3 sketch. This should stop the Wh&#39;s see-sawing up and down and allow me to calculate on the emontx&nbsp;grid import, PV produced, PV exported and PV used in house.&nbsp;</p>
<p>The sketch seems to be working ok so far but I&#39;m not sure I&#39;ve got the calculation part right. This is a Wh calculation part of the sketch, does it look ok?</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;joules_CT2 += tx_data.realPower_CT2 * 2;&nbsp; // Joules elapsed in 100 cycles @ 50Hz is power J.s x 2 seconds &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (joules_CT2&gt;=0) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.expwh_CT2 += joules_CT2 / 3600;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joules_CT2 = joules_CT2 % 3600;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (joules_CT2&lt;0) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.impwh_CT2 += joules_CT2 / 3600;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joules_CT2 = joules_CT2 % 3600;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } &nbsp;&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20113"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ngbod&#039;s picture" title="ngbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emoncms v8.03 debian with emontxV3 continuous kwhtotals noeeprom.ino issues</h3>

    <div class="submitted">Submitted by <a href="../user/3824.html" title="View user profile.">ngbod</a> on Sat, 29/03/2014 - 09:47.</div>
    <div class="content">
     <p>After leaving the code above run over night it looks as though the&nbsp;Wh figures are double what they should be so now I&#39;m trying the following code which I&#39;ve adapted from the current emonTxV3_continuous_kwhtotals_eeprom.ino &nbsp;sketch.</p>
<p>joules_CT2 += tx_data.realPower_CT2 * 2;&nbsp; // Joules elapsed in 100 cycles @ 50Hz is power J.s x 2 seconds<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (joules_CT2&gt;=3600) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.expwh_CT2 ++;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joules_CT2 = joules_CT2 - 3600;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (joules_CT2&lt;=-3600) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.impwh_CT2 --;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; joules_CT2 = joules_CT2 + 3600;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>Time will tell if this produces valid readings.</p>
<p>Are the &gt;=3600 and &lt;=-3600 parts designed to give a +-1 Wh dead band around zero to account for noise or am I interpreting this wrong?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/4357"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-R--lorHGMD_VsUrYfXmbxB0XWIw7LZp5hPXHHxd6MFY" value="form-R--lorHGMD_VsUrYfXmbxB0XWIw7LZp5hPXHHxd6MFY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/4357 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:24:31 GMT -->
</html>
