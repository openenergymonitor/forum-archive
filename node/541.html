<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/541 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:32:32 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>GLCD -Type 2 SOLAR PV help. | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">GLCD -Type 2 SOLAR PV help.</h3>
        <span class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Wed, 28/03/2012 - 16:05</span>
        <div class="content"><p>After sorting the teething problems of the base station I&#39;m now having problems on the GLCD side..</p>
<p>I&#39;m seeing&nbsp;rf&nbsp;fail&nbsp;on the LCD under the export / import section.<a href="http://vis.openenergymonitor.org/emoncms3/Vis/realtime.php?apikey=1b8c1818f5dd89fe5f74c6d36bc81ef8&amp;feedid=481%22"> link to graph.</a></p>
<p>This is from the base station and all seems fine this side.. Although i do see spikes in the data sent to&nbsp;</p>
<pre>
1 emontx packet rx2 {rf_fail:0,power1:1825,power2:831,power3:0,voltage:24741}
3 ok | Date: Wed, 28 Mar 2012 15:38:12 GMT

4 emonbase sent
5 emonglcd: 2256


1 emontx packet rx2 {rf_fail:0,power1:1820,power2:829,power3:0,voltage:24753,temperature:22.56}
3 ok | Date: Wed, 28 Mar 2012 15:38:18 GMT

4 emonbase sent
5 emonglcd: 2256

1 emontx packet rx2 {rf_fail:0,power1:1830,power2:835,power3:0,voltage:24745,temperature:22.56}
3 ok | Date: Wed, 28 Mar 2012 15:38:23 GMT

4 emonbase sent
5 emonglcd: 2262

{SNIP}

1 emontx packet rx2 {rf_fail:0,power1:402,power2:807,power3:0,voltage:24852,temperature:22.87}</pre><div>
<pre>
3 ok | Date: Wed, 28 Mar 2012 15:43:39 GMT

4 emonbase sent
5 emonglcd: 2287</pre></div>
<p>Pictures here of the GLCD with error</p>
<p><a href="../sites/default/files/IMG_0386.JPG%20(2).jpg">http://openenergymonitor.org/emon/sites/default/files/IMG_0386.JPG (2).JPG</a></p>
<p>&nbsp;</p>
<p>Im also not sure iv edited the code correctly for type 2 solar.. The header in the emonGLCD_SolarPV says to</p>
<p>&nbsp;</p>
<pre>
// this sketch is currently setup for type 1 solar PV monitoring where CT&#39;s monitor generation and consumption separately
// to use this sketch for type 2 solar PV monitoring where CT&#39;s monitor consumption and grid import/export using an AC-AC adapter to detect current flow direction 
//    -change line 69-70, 160-164 - see comments in on specific lines. See Solar PV documentation for explination </pre><div>
	&nbsp;</div>
<div>
	Well 69-70 is a comment &quot;\\-------------------------&quot;</div>
<div>
	and 160-164 &quot;Serial.println(&quot;3 emonglcd sent&quot;);&quot;</div>
<p>&nbsp;</p>
<p>The only section i can see that you need to edit is in the&nbsp;void power_calculations() area and the code for type 2 does not work..</p>
<pre>
  grid=emontx.grid; <span class="Apple-tab-span" style="white-space: pre; "> </span>         <span class="Apple-tab-span" style="white-space: pre; "> </span>// for type 2 solar PV monitoring                     
  consuming=gen + emontx.grid; </pre><p>&nbsp;</p>
<div>
	Compiles with the following error...</div>
<div>
	&nbsp;</div>
<div>
	emonGLCD_SolarPV.cpp: In function &#39;void power_calculations()&#39;:</div>
<div>
	emonGLCD_SolarPV:219: error: &#39;struct PayloadTX&#39; has no member named &#39;grid&#39;</div>
<div>
	emonGLCD_SolarPV:220: error: &#39;struct PayloadTX&#39; has no member named &#39;grid&#39;</div>
<div>
	&nbsp;</div>
<div>
	I have changed it to this and it seems to be ok.. but im&nbsp;not convinced its correct..</div>
<div>
	&nbsp;</div>
<div>
	&nbsp; grid = emontx.power1; <span class="Apple-tab-span" style="white-space: pre; "> </span> &nbsp; &nbsp; &nbsp; &nbsp; <span class="Apple-tab-span" style="white-space: pre; "> </span>// for type 2 solar PV monitoring &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</div>
<div>
<div>
		&nbsp; consuming = gen + emontx.power1;&nbsp;</div>
<div>
		&nbsp;</div>
<div>
		So over to you guys.</div>
<div>
		Thanks Rob</div>
<div>
		&nbsp;</div>
</div>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="755.html" class="topic-previous" title="Go to previous forum topic">‹ emonGLCD - my feedback</a>
              <a href="744.html" class="topic-next" title="Go to next forum topic">share interrupt concept for pulse counting more then two.... ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-3573"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 29/03/2012 - 16:07.</div>
    <div class="content">
     <p>Hi Rob,&nbsp;</p>
<p>Good work assembling this units. Sorry about the confusing comments in the emonGLCD sketch, they dated back to before we recently updated the sketch. I&#39;ve corrected them now, the new version is up on github.&nbsp;</p>
<p>Your correct you should use the lines:</p>
<p>&nbsp;</p>
<pre style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
grid = emontx.power1; <span class="Apple-tab-span" style="white-space: pre; "> </span>         <span class="Apple-tab-span" style="white-space: pre; "> </span>// for type 2 solar PV monitoring                     </pre><div style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 17px; text-align: left; ">
<div>
		consuming = gen + emontx.power1;&nbsp;<span class="Apple-tab-span"> </span>// for type 2 solar PV monitoring &nbsp;&nbsp;</div>
<div>
		&nbsp;</div>
<div>
		and comment out</div>
<div>
		&nbsp;</div>
<div>
<pre>
consuming = emontx.power1; <span class="Apple-tab-span" style="white-space:pre"> </span>        // for type 1 solar PV monitoring

grid = consuming - gen;<span class="Apple-tab-span" style="white-space:pre"> </span>        // for type 1 solar PV monitoring</pre></div>
</div>
<p>The sketch assumes that emontx.power1 is consumption (type 1) or grid (type 2) and emontx.power2 is solar PV gen. Make sure you double check this is the case.&nbsp;</p>
<p>The RF fail on the emonGLCD is a general RF fail for all the values not just the grid import exporting. Try moving the units closer together.</p>
<p>The serial values you have posted above look correct, although the emonTx voltage looks rather high (24V!), this can&#39;t be right since this would damage the emonTx. How are you powering it?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3589"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 30/03/2012 - 08:25.</div>
    <div class="content">
     <p>Hi Glyn&nbsp;</p>
<p>	No worries on the sketch problems. Its great to see a product that works even if it does require a little playing around with..</p>
<p>	I will upload the code again to it tonight and report back..</p>
<p>	I&#39;m&nbsp;not sure why I&#39;m getting RF fails as the units are with in 10 meters of each other ..<br />
	Am i right in thinking the TX reports to the base and the base reports to the GLCD or is that wrong..<br />
	Could this be why im getting these weird spikes in the CMS system as im not seeing this at all on the display or in the output from the base. See picture<br />
	<a href="../sites/default/files/CMS1.jpg">http://openenergymonitor.org/emon/sites/default/files/CMS1.jpg</a></p>
<p>The TX is being powered off of a USB phone charger that has a 5v output but 1A&nbsp;so should not be outputting 24V. Nothing seems to be getting hot so i think this is duff info or see below.<br />
	I thought the line below reads this</p>
<p>&nbsp;</p>
<pre style="width: 700px; padding-top: 0.75em; padding-right: 1.5em; padding-bottom: 0.75em; padding-left: 1.5em; font-size: 14px; border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-top-style: solid; border-right-style: solid; border-bottom-style: solid; border-left-style: solid; border-top-color: rgb(221, 221, 221); border-right-color: rgb(221, 221, 221); border-bottom-color: rgb(221, 221, 221); border-left-color: rgb(221, 221, 221); border-image: initial; color: rgb(0, 0, 0); line-height: 17px; text-align: left; ">
1 emontx packet rx2 {rf_fail:0,power1:402,power2:807,power3:0,voltage:24852,temperature:22.87}</pre><p>&nbsp;</p>
<p>Power1 : import / export<br />
	Power2 : PV<br />
	Power3 : N/A<br />
	Voltage : Grid voltage as in 248.52V<br />
	Temp : from GLCD.<br />
	&nbsp;</p>
<p>That leads me on to the next problem is that the Grid voltage is reporting a bit high.. (well if i understand the above) its showing as 248.52 and im reading it at 244.61v from a powermeter and a Digital Voltmeter well with in (0.5Volts).. Iv tried the calibration section in&nbsp;<span style="font-size:12px;"><span style="color: rgb(153, 153, 153); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25px; ">&quot;</span><strong class="final-path" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; font-weight: bold; color: rgb(0, 0, 0); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25px; ">emonTx_CT123_Voltage.ino&quot;&nbsp;</strong></span>but it seems to make it worse and it reports 0 from the PV even though the PV is still producing around 100watts. (the generation meter is still ticking so must still be producing)<br />
	im changing the following in&nbsp;<strong class="final-path" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; font-weight: bold; color: rgb(0, 0, 0); font-family: Helvetica, arial, freesans, clean, sans-serif; line-height: 25px; ">emonTx_CT123_Voltage.ino</strong><br />
	From</p>
<p>&nbsp;</p>
<pre style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; font-family: 'Bitstream Vera Sans Mono', 'Courier New', monospace; line-height: 1.4; color: rgb(51, 51, 51); ">
</pre><div class="line" id="LC40" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">
	&nbsp;&nbsp;<span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">ct1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">.</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">voltageTX</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">(</span><span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(0, 153, 153); ">234.6</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">,</span> <span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(0, 153, 153); ">1.7</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">);</span> <span class="c1" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(153, 153, 136); font-style: italic; ">// Voltage: calibration, phase_shift</span></div>
<div class="line" id="LC41" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">
	&nbsp;&nbsp;<span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">ct1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">.</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">currentTX</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">(</span><span class="mi" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(0, 153, 153); ">1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">,</span> <span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(0, 153, 153); ">113.4</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">);</span> <span class="c1" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(153, 153, 136); font-style: italic; ">// Setup emonTX CT channel (channel, calibration)</span></div>
<p>&nbsp;</p>
<p>To as iv got the Strontronics power adapter.<br />
	&nbsp;</p>
<pre style="margin-top: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; font-family: 'Bitstream Vera Sans Mono', 'Courier New', monospace; line-height: 1.4; color: rgb(51, 51, 51); ">
</pre><div class="line" id="LC40" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">
	&nbsp;&nbsp;<span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">ct1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">.</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">voltageTX</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">(</span><span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(0, 153, 153); ">238.56</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">,</span> <span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(0, 153, 153); ">1.7</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">);</span> <span class="c1" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(153, 153, 136); font-style: italic; ">// Voltage: calibration, phase_shift</span></div>
<div class="line" id="LC41" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">
	&nbsp;&nbsp;<span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">ct1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">.</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">currentTX</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">(</span><span class="mi" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(0, 153, 153); ">1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">,</span> <span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(0, 153, 153); ">113.4</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; ">);</span> <span class="c1" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font-size: 12px; font: inherit; color: rgb(153, 153, 136); font-style: italic; ">// Setup emonTX CT channel (channel, calibration)</span></div>
<p>&nbsp;</p>
<p>Iv not changed the lower number as iv got no idea on the Burden resistor used.&nbsp;</p>
<p>	Anyway thanks again.. Will let you see the blog once its all up and running as im doing some write up for our local paper after they saw my blog and interview with Google for the powermeter (no defunct) <a href="http://www.youtube.com/watch?feature=player_embedded&amp;v=6OusyGl4gF4">Video here</a></p>
<p>Rob.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3591"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 30/03/2012 - 09:46.</div>
    <div class="content">
     <p>Hi just tried to add this and keep getting hit by the spam filter..</p>
<p>Iv not changed the lower number as iv got no idea on the Burden resistor used. But i think i should be using 138.8 instead of 113.4&nbsp;eg&nbsp;from here.&nbsp;<a href="https://learn.openenergymonitor.org/?redirect=different-acac-power-adapters">http://openenergymonitor.org/emon/buildingblocks/different-acac-power-adapters</a>&nbsp;but when i do things start to go weird.&nbsp;Eg&nbsp;showing&nbsp;im&nbsp;useing&nbsp;loads more power than i am&nbsp;eg&nbsp;from&nbsp;400watts&nbsp;to 600+watts.</p>
<p>	Anyway thanks again.. Will let you see the blog once its all up and running as&nbsp;im&nbsp;doing some write up for our local paper after they saw my blog and interview with Google for the&nbsp;powermeter&nbsp;(no defunct)&nbsp;<a href="http://www.youtube.com/watch?feature=player_embedded&amp;v=6OusyGl4gF4">Video here</a></p>
<p>Rob.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3595"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 30/03/2012 - 13:33.</div>
    <div class="content">
     <p>Nice blog, and video! Hope the little one is well.&nbsp;</p>
<p>Sorry, my mistake I got confused with &#39;voltage&#39;. Your correct that&#39;s the RMS AC mains voltage, not the emonTx supply voltage! The emonTx_CT123 (non- AC-AC adapter) transmits the emonTx supply voltage while the emonTx_CT123_voltage transmits&nbsp; the AC RMS&nbsp;mains voltage.&nbsp;</p>
<p>You will have the 18 ohm burden resistor. Therefore if your using the Strontronics AC-AC adapter you should be using:&nbsp;</p>
<p>&nbsp;</p>
<div class="line" id="LC40" style="color: rgb(0, 0, 0); text-align: left; background-color: rgb(238, 238, 238); margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">
	&nbsp;&nbsp;<span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">ct1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">.</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">voltageTX</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">(</span><span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; color: rgb(0, 153, 153); ">238.56</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">,</span>&nbsp;<span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; color: rgb(0, 153, 153); ">1.7</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">);</span>&nbsp;<span class="c1" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; color: rgb(153, 153, 136); font-style: italic; ">// Voltage: calibration, phase_shift</span></div>
<div class="line" id="LC41" style="color: rgb(0, 0, 0); text-align: left; background-color: rgb(238, 238, 238); margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 1em; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">
	&nbsp;&nbsp;<span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">ct1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">.</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">currentTX</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">(</span><span class="mi" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; color: rgb(0, 153, 153); ">1</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">,</span>&nbsp;<span class="mf" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; color: rgb(0, 153, 153); ">115.6</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">);</span>&nbsp;<span class="c1" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; color: rgb(153, 153, 136); font-style: italic; ">// Setup emonTX CT channel (channel, calibration)</span></div>
<p>I&#39;ll try and double check this when I&#39;m in the lab over the weekend. Remember to repeated this for each channel. I will update the code on github to make this the default calibration, so it should be correct out of the box.&nbsp;</p>
<p>emoncms&nbsp;graph does not look right at all. Which feed is that? Are you other feeds ok? If your posting to vis.openenergymonitor.org I might be able to logon and take a look, I&#39;ll have to talk to Trystan who administers the server. What&#39;s your username?&nbsp;</p>
<p>The emonTx transmits power data to both the emonGLCD and the emonBase. The emonBase transmits&nbsp;the current server time to the emonGLCD and the emonGLCD&nbsp;replies to the emonBase&nbsp;with the current temperature from the on-board sensor.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3596"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 30/03/2012 - 13:57.</div>
    <div class="content">
     <p>Hi Glyn..</p>
<p>Yes were all doing well now.. She was a bit of a hand full for the first 6 months but is so much fun now.. Glad you liked the video. We never made it to the website but the write up did.. Shame i thought it was a great idea..</p>
<p>I was changing it for all three cts&nbsp;so im not really sure why.. Will have another pop at the weekend..</p>
<p>	Yes for the mo im using the vis.openenergymonitor.org site.. &nbsp;username is rob+energy[at]walkers[dot]gb[dot]com<br />
	The graph is for the import / export feed and to be honest im not really sure on how to set it up as i would like to show graphs for the import/export as well as PV, voltage etc maybe even swing dials but this is still a learning experience at the mo.. im still trying to get the other feeds to register correctly. they show up in inputs but not in the feeds section.. If you could have a look that would be great.</p>
<p>Thanks that makes sence.. The emonTX is the furthest away but is only through a partition wall the base and the GLCD are both powered off of a USB hub so are in spitting distance. Will see if i can move the base slightly closer to see if it find</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3597"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 30/03/2012 - 15:11.</div>
    <div class="content">
     <p>Right have updated the tx to the right calibration&nbsp;values</p>
<p>&nbsp;</p>
<pre>
  ct1.voltageTX(238.56, 1.7);                // Voltage: calibration, phase_shift
  ct1.currentTX(1, 115.6);                   // Setup emonTX CT channel (channel, calibration)
  
  ct2.voltageTX(238.56, 1.7);
  ct2.currentTX(2, 115.6);

  ct3.voltageTX(238.56, 1.7);
  ct3.currentTX(3, 115.6);</pre><div>
	but im seeing high voltage readings.. and im not sure the power readings are correct.</div>
<div>
	&nbsp;</div>
<div>
<pre>
1 emontx packet rx2 {rf_fail:0,power1:-689,power2:1027,power3:0,voltage:25469,temperature:22.06}</pre><div>
		&nbsp;</div>
<div>
		im reading the voltage at 248.0v currently. so im not sure why its showing 254.69v &nbsp;does this mean i need to change the 115.6 to&nbsp;<strong>​</strong>109.1154 as per these instructions?&nbsp;​<a href="../modules/emontx/firmware/calibration%20.html">http://openenergymonitor.org/emon/modules/emontx/firmware/calibration%20</a></div>
</div>
<div>
	&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	Thanks again.</div>
<div>
	Rob</div>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3653"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Wed, 04/04/2012 - 08:14.</div>
    <div class="content">
     <p>Glyn</p>
<p>&nbsp;</p>
<p>Did you get a chance to look at he calibration issues? or the huge spikes in the CMS system?</p>
<p>Iv had a play around with the CMS system and it seems to only show it on the import / export section the PV is fine as is the temps so iv got no idea why its showing..</p>
<p>&nbsp;</p>
<p>Thanks</p>
<p>Rob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3659"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 04/04/2012 - 12:08.</div>
    <div class="content">
     <p>Hi Rob,</p>
<p>Sorry I have been away for a couple of days. We plan to build a more advanced test rig to enable us to better test the accuracy of the monitor over the full current range.&nbsp;</p>
<p>Based on some testing we had recently had carried out w<span style="background-color: rgba(255, 255, 255, 0.917969); font-family: Arial, sans-serif; font-size: 13px; ">e can expect the CT secondary winding to be accurate to a few turns, so the error in the ratio should be no more than 0.5%. The CT burden resistor is a 1% tolerance component, so the total error should less than 1.5%</span></p>
<p>&nbsp;</p>
<p style="font-family: arial, sans-serif; font-size: 13px; background-color: rgba(255, 255, 255, 0.917969); margin-bottom: 0cm; "><font face="Arial, sans-serif"><b>so for an 18 Ohms burden resistor:&nbsp;</b></font><span style="font-family: Arial, sans-serif; ">111.11 is the calculated calibration coefficient value, add in 1.5% error would give a range of: 109.5 - 112.8.</span></p>
<p style="font-family: arial, sans-serif; font-size: 13px; background-color: rgba(255, 255, 255, 0.917969); margin-bottom: 0cm; "><span style="font-family: Arial, sans-serif; ">These calibration&nbsp;values are bit lower than the ones we have been using so we wanted to double check them before issuing any recommendations, but they did come from a reliable source. Sorry for the confusion on this issue. We we be able to talk with more confidence once we undertake some further testing of our own.&nbsp;</span></p>
<p style="font-family: arial, sans-serif; font-size: 13px; background-color: rgba(255, 255, 255, 0.917969); margin-bottom: 0cm; ">&nbsp;</p>
<p style="font-family: arial, sans-serif; font-size: 13px; background-color: rgba(255, 255, 255, 0.917969); margin-bottom: 0cm; ">As for the spikes in the data on emoncms I have no idea what could be causing them. If the data looks correct as it comes from the emonTx then the spikes could be caused during the wireless transmission. Another device or another emonTx on the same wireless frequency and network?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3735"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Mon, 09/04/2012 - 19:34.</div>
    <div class="content">
     <p>Glyn</p>
<p>Thanks for this no worries I understand your busy and even more that you need some time off now and then.</p>
<p>Iv sorted out the CMS problem.. It was my fault and should of spotted it sooner but also should of been picked up in the system..</p>
<p>In the inputs section i had added Grid Voltage to the import / export section ( i did not know / under stand this ) so both were being logged to a feed called Grid.. Iv not changed this to Grid voltage and Import - export and all is working correctly.&nbsp;<br />
	&nbsp;</p>
<p>Iv still not looked into the voltage / calibration&nbsp;stuff yet. On my list todo as is 100 other things.. Will do it asap as i really need to get this blog post up.</p>
<p>Also iv edited the my copy of the &quot;emonGLCD_SolarPV&quot; and think it may be useful for others but im not confident of changing the master (even if i can). Is there a way i can get someone to look over it as im OK at changing code but im no programmer..</p>
<p>Quick summery of things done. Some are minor some are new</p>
<ul>
<li>
		Moved the importing or exporting &nbsp;text on the LCD up to match the same line as Room opposite.&nbsp;</li>
<li>
		Moved the importing or exporting value up to match the temp opposite.&nbsp;</li>
<li>
		Added current time under the importing / exporting value (now room as its been moved up. (since we dont have buttons :-) )</li>
<li>
		Added new bug ( when displaying RF&nbsp;Failed now overwrites the time, I cant work out how to blank the time just to show RF Failed Im sure an easy fix.)</li>
<li>
		Changed the lights on the top from a digital to an analog so its possible to PWM&nbsp;them.</li>
<li>
		Looking at using the unused LDR&nbsp;to change the display and led&#39;s on the top. Place holder for more code later.</li>
<li>
		Changed the line that resets recorded import / generated values (not sure this works yet but the current code does not work at all)</li>
</ul>
<p>Things i would like to add but dont have the know how.</p>
<ul>
<li>
		Record the LDR output to the CMS system.</li>
<li>
		Record the number of RF Fails to the CMS system.</li>
<li>
		If posible&nbsp;get the LEDs on the top to display orange (50%&nbsp;green 50% red) say +/- 10 Watts of equal between import / export.</li>
</ul>
<p>Anyway if iv over stepped the mark please let me know..</p>
<p>Rob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3747"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Tue, 10/04/2012 - 14:48.</div>
    <div class="content">
     <p>Iv added the code here&nbsp;<a href="https://github.com/rob-walker/EmonGLCD/tree/master/emonGLCD_SolarPV">https://github.com/rob-walker/EmonGLCD/tree/master/emonGLCD_SolarPV</a>&nbsp;Hope this is ok&nbsp;</p>
<p>The clearing of the usage and pv&nbsp;totals still dont clear. Still looking into this.</p>
<p>new look here&nbsp;</p>
<p><img alt="" src="../sites/default/files/photo%20(1).jpg" style="width: 300px; height: 225px; " /></p>
<p>Old&nbsp;</p>
<p><img alt="" src="../sites/default/files/photo%20(2).jpg" style="width: 300px; height: 255px; " /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3768"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 11/04/2012 - 12:52.</div>
    <div class="content">
     <p>Hi Rob,</p>
<p>Glad you managed to fix the emoncms problem. Some sort of visulisation to show what inpus are mapped to which feeds would be a useful feature. I imagine your not the only one to have had made that mistake!</p>
<p>Please don&#39;t think that you have over stepped the line, there is not line! This is a collaborative project, it&#39;s user contributions that really help to move things forward. The emonGLCD&nbsp;improvements looks great, thanks a lot. I&#39;ll have a got at testing them this afternoon and report back. Do you think you could send the openenergymonitor github a git pull request? This will allow me to merge your changes into the master.&nbsp;</p>
<p>I like the time on the font page and the alignment of the temperature and importing/exporting. I&#39;ll look into how the time could be replaced with RF fail. If this is too tricky, maybe RF fail could be displayed as &#39;!RF&#39; in the top left or right hand corner. Maybe this is too subtle!&nbsp;</p>
<p>&nbsp;</p>
<p>PWM&#39;ing the LED&#39;s is something I always had in mind when designing the emonGLCD, but never got round to implementing! Both LED&#39;s (red and green) are on digital channel which support hardware PWM&#39;ing. The line&nbsp;analogWrite(greenLED, 0-255) &nbsp;were 0 is off an 255 is full brightness should be able to adjust the brightness of the LED. Turning on both the green and red LED&#39;s at the same time should give orange. It would be great if you could investigate the possibility&nbsp;of the LED&#39;s smoothly transitioning from green to red depending on the amount of energy being imported. I.e bright green = lots of export (happy days), dull green = just about exporting, orange = about 50/50 import-export. And then various shades of red depending on export level.&nbsp;</p>
<p>It might also be cool to have a play about with PWM heart beat effect Apple Mac book style, maybe the speed of the beat could be proportional to the amount of energy being using/generated.</p>
<p>It might be the case that these PWM LED effects are not desirable, often people don&#39;t like flashing LED&#39;s in their living space!&nbsp;</p>
<p>&nbsp;</p>
<p>Adding sending the LDR value to emoncms would be possible. It would require adding another variable to the emonGLCD packet structure (call it &#39;ldr&#39;) on the both the emonGLCD (line 64) and on the NanodeRF_Power_RTCrelay_GLCDtemp (line 48). Then add the line emonglcd.ldr=analogeRead(LDRpin); where LDRpin=4. in the &#39;things to do every 10&#39;s section&#39; in the emonGLCD sketch</p>
<p>Finally you will need to add&nbsp;<span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">str</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">.</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">print</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">(</span><span class="s" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; color: rgb(221, 17, 68); ">&quot;,ldr:&quot;</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">);&nbsp;</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">str</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">.</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">print</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">(</span><span class="n" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">emonglcd</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">.ldr</span><span class="p" style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; border-top-width: 0px; border-right-width: 0px; border-bottom-width: 0px; border-left-width: 0px; border-style: initial; border-color: initial; border-image: initial; font: inherit; ">); to send the ldr value to emoncsm on line 222 of&nbsp;</span>NanodeRF_Power_RTCrelay_GLCDtemp sketch.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3769"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="panman1111&#039;s picture" title="panman1111&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by panman1111 (not verified) on Wed, 11/04/2012 - 17:50.</div>
    <div class="content">
     <p>Good&nbsp;work&nbsp;Rob,</p>
<p>I have&nbsp;been thinking&nbsp;of&nbsp;putting the time&nbsp;on, and I have&nbsp;made the red&nbsp;LED&#39;s flash (much&nbsp;to the wife&#39;s&nbsp;displeasure) but&nbsp;I think she&nbsp;will like your&nbsp;method better, I&#39;ll try it out&nbsp;tomorrow.</p>
<p>Steve</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3770"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Wed, 11/04/2012 - 19:16.</div>
    <div class="content">
     <p>Glyn. You should have a request now.. Hope you get it if not let me know..&nbsp;</p>
<p>I&#39;m Happy to look at the PWMimg of the leds and see if i can come up with some thing. Also see if its possible to move the settings for say Type 1 or Type 2 Solar to a variable so people (like my parents) would only have to update one area of the sketch. Will look at adding the LDR&nbsp;info also. Think it would be good to capture it now and then work out if we need it / or what we can do with it..</p>
<p>Steve. Please if your going to use this take it as beta. I&#39;m very rusty at programming and i could well of introduced more errors or bugs. But im glad you like it.. I maybe rusty at programing but hope i know what info people would like to see.</p>
<ul>
<li>
		is the resetting of the usage and PV totals.. They dont.. they never have for me either iv done some more changes but im not sure this will make it work..&nbsp;</li>
<li>
		LDR value needs to be commented out in the display (line 77-79)</li>
</ul>
<p>Should of added the number in the bottom left next to the time in my version is the LDR value (661in the pic) Its really just for me to work out what ranges i expect to see eg&nbsp;0-300 Dark room 301-500 lights on. 501-800 sunny 801 -1024? In the SUN..</p>
<p>Maybe we can use this to PWM the back light? in the aim of having a battery powered display. (still thinking about this.)</p>
<p>Rob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3773"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 12/04/2012 - 00:11.</div>
    <div class="content">
     <p>Switches can be made to work in software! See&nbsp;<a href="https://github.com/openenergymonitor/EmonGLCD/tree/master/emonGLCD_tester">https://github.com/openenergymonitor/EmonGLCD/tree/master/emonGLCD_tester</a>. Atmega has internal pull-up resistors&nbsp;which can be enabled. This solves the problem. We will be offering switches to anyone who has bought an emonGLCD through the shop next week. I&#39;m planning a blog about this soon.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3788"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="panman1111&#039;s picture" title="panman1111&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by panman1111 (not verified) on Thu, 12/04/2012 - 15:08.</div>
    <div class="content">
     <p>Rob.</p>
<p>No problem with it being &quot;Beta&quot; most of the code here has to be taken &#39;as seen&#39; like you I&#39;m o/k at altering the existing code, but not so good at writing from scratch!</p>
<p>I have been looking into the code for the Tri-color&nbsp;LED&#39;s to make them go from Green to Red although being updated every 10 seconds makes it a bit &#39;jumpy&#39; I wondered if calling it every 200mS, rather than every 10 second &nbsp;would create a too big overhead ??</p>
<p>I will post my bit of code when I get it to work properly</p>
<p>Regards Steve&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3790"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 12/04/2012 - 17:24.</div>
    <div class="content">
     <p>Shouldn&#39;t be a problem calling it every loop. The RFM12 is interrupt based so won&#39;t be effected by other things going on in the loop.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3791"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 12/04/2012 - 17:29.</div>
    <div class="content">
     <p>In case you haven&#39;t seen it here&#39;s a blog post on the emonGLCD switch fix:&nbsp;<a href="http://openenergymonitor.blogspot.com/2012/04/emonglcd-v13-switches-fix.html">http://openenergymonitor.blogspot.com/2012/04/emonglcd-v13-switches-fix.html</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3793"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Thu, 12/04/2012 - 18:14.</div>
    <div class="content">
     <p>Glyn I have seen that.. My order has been placed and im looking forward to getting the switches. Lets hope they are easy to fit once the LCD is in?</p>
<p>Once the buttons are in mine i will update my code to use them..&nbsp;</p>
<p>Did you get the Github request? Not checking you have looked at the code more in that iv sent it correctly.</p>
<p>Thanks</p>
<p>Rob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3831"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 15/04/2012 - 07:33.</div>
    <div class="content">
     <p>Switches added to both board and code and all seem to OK ish..</p>
<p>The display seems to stop working now after a while.. Anything 1 min to 30 mins..&nbsp;</p>
<p>The emonGLCD still works as the leds change colour&nbsp;but the display just goes blank..&nbsp;</p>
<p>Will try to go back to the code before.. adding the switches to the code.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3834"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="panman1111&#039;s picture" title="panman1111&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by panman1111 (not verified) on Sun, 15/04/2012 - 08:18.</div>
    <div class="content">
     <p>Hi Rob.</p>
<p>I had the same sort of problem. I was using the USB power supply from my Kindle to power the GLCD&nbsp;until I bought some more ( from Ebay) I had to go back to the Kindle PSU and its been alright since.</p>
<p>Also</p>
<p>could it be the backlight issue that Glyn&nbsp;has commented out in the sketch&nbsp;</p>
<p>backlight_control(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //- issue when emonGLCD does not receive correct time from base station display switches off - disable auto switch off at night as a precaution</p>
<div>
	I&#39;m still working on the fading from Red to Green, it didn&#39;t work as I thought, and now my head has gone to a point !!</div>
<div>
	Regards Steve&nbsp;</div>
<div>
	&nbsp; &nbsp; &nbsp; &nbsp;</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3835"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="wiz2003&#039;s picture" title="wiz2003&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by wiz2003 (not verified) on Sun, 15/04/2012 - 09:06.</div>
    <div class="content">
     <p>Hi all,</p>
<p>I have all 3 nodes working nearly OK... I have &nbsp;modified the sketch so that</p>
<p>a) the temp display on the glcd alternates between the internal and the external every 10 seconds.</p>
<p>b) The temp includes a min and max for both.</p>
<p>c) The leds&nbsp;go out when the ambient light level is low</p>
<p>d) The backlight intensity varies according to the ambient light level.</p>
<p>e) I have attached a battery pack comprising 4 x aaa nimh cells and attached them to the glcd via the 6 pin connection. It does not charge the nimh cells properly, but it does make the unit portable for at least 5 minutes...</p>
<p>f) I have ordered a solid state relay and am hoping to attach that to my immersion heater to use any slack power......</p>
<p>g) I have placed a small length of heatshrink tubing around the LED so that it is not affected by the light of the leds.</p>
<p>h) Have ordered the switches for the glcd....</p>
<p>i) Recalibrated the Solar CT to correspond with the inverter.</p>
<p>I have the following issues/questions</p>
<p>1) The nanode ethernet&nbsp;issue is a pain and, because of it and before the posting here, I purchased an additional nanode.</p>
<p>2) Emoncms3&nbsp;sends back the time as GMT, this is not what I want on the GLCD;-</p>
<p>2.1) I have looked at converting GMT to BST in the nanode, but decided that I did not want to get into writing code to convert a three char month to the month number so that the real time could be calculated based on the date.</p>
<p>3) I would like to modify the returned vale from the emoncms3</p>
<p>3.1) So that the time was GMT or BST as appropriate.</p>
<p>3.2) So that the returned datra&nbsp;included not just the date, but other info such as total usage and total generated.</p>
<p>4) From time to time the display blanks for no apparent reason - to be fair I have not looked hard yet.</p>
<p>5) The payload between the units seems to be declared as int in some sketches and double in others. I have now settled on double.</p>
<p>6) Have noticed that the CT value monitoring usage is affected by by the solar CT. If you disconnect the solar CT by removing the CT from the cable, the usage CT goes up. (this is a type 2)</p>
<p>Well chuffed.. SWMBO&nbsp;thinks I am mad........</p>
<p>Once stabilised I may be be building some more for others......</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3836"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 15/04/2012 - 09:00.</div>
    <div class="content">
     <p>Hi Steve..</p>
<p>Its powered right off of the computer and has been fine before. Its just when PWMing the LCD backlight it seems this is when it goes wrong.. Well changing it on the fly. The backlight still works so does the rest but the screen gets corruption on it and then just dies to a blank screen.</p>
<p>If i disable the LCD PWM and use a fixed value all seems ok. Maybe its a speed thing now with the switches attached as it was fine before the switches were added.</p>
<p>The LEDs seem fine however, Still testing this so this maybe wrong</p>
<p>Maybe we should try to put our heads together then to get the LEDs&nbsp;to change correctly. &nbsp;</p>
<p>Rob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3842"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 15/04/2012 - 13:29.</div>
    <div class="content">
     <p>Ok adding code to it again seems to break it all the time now.. If you PWM&nbsp;in real time the LEDs or LCD-LED.&nbsp;</p>
<pre>

    int LDR=analogRead(LDRpin);                    // Get LDR Value
    int PWMSetting = map(LDR, 0, 1023, 10, 150);   // Map the data from the LDR from 0-1023 (Max seen 1000) to var LEDsbrightness min/max 
    PWMSetting = constrain(PWMSetting, 0, 255);    // Make sure its a Valid PWM value 0-255
</pre><p>This causes a crash</p>
<p>But just setting &nbsp;&quot;int PWMSetting = 200;&quot; Seems to be ok.</p>
<p>This is after adding the code for the Switches. So I wonder if something is being dragged lower than it should?&nbsp;</p>
<pre>
    pinMode(enterswitchpin, INPUT); pinMode(upswitchpin, INPUT); pinMode(downswitchpin, INPUT); 
    digitalWrite(enterswitchpin, HIGH); digitalWrite(upswitchpin, HIGH); digitalWrite(downswitchpin, HIGH); //enable Atmega328 10K internal pullup resistors </pre><div>
	If you comment this out all is fine again. Weird.</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3855"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="panman1111&#039;s picture" title="panman1111&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by panman1111 (not verified) on Mon, 16/04/2012 - 13:22.</div>
    <div class="content">
     <p>&nbsp;</p>
<div>
	Rob</div>
<div>
	This is my attempt at fading&nbsp;the LED&#39;s from Red to Green, I think you are using a type 2 system, so you may have to change the&nbsp;test for gen&gt;consumption ( 4th&nbsp;and 11th line of code to suit.)</div>
<div>
	If I get time later I will load your LDR and push switch code, to see what happens, ( I don&#39;t have any switches fitted)</div>
<div>
	Regards Steve</div>
<div>
	&nbsp;</div>
<div>
	//--------------------------------------------------------------------</div>
<div>
	//Change color of LED on top of emonGLCD, red if consumption exceeds gen by 500 watts or more, green if gen exceeds consumption</div>
<div>
	//by more than 500 watts. and shades of orange in-between. This may not work as expected with type 2 setup.</div>
<div>
	//--------------------------------------------------------------------&nbsp;</div>
<div>
	void led_control()</div>
<div>
	&nbsp; &nbsp; {</div>
<div>
	&nbsp; &nbsp; if ((gen&gt;0) &amp;&amp; (night==0))&nbsp;</div>
<div>
	&nbsp; &nbsp; if (emontx.power2&gt;emontx.power1) &nbsp; &nbsp; &nbsp; &nbsp; //test for gen&gt;consumption &nbsp;</div>
<div>
	&nbsp; &nbsp; {</div>
<div>
	&nbsp; &nbsp; LEDlevel= (emontx.power2-emontx.power1) / 3.92156863; &nbsp;//SK This makes 500W = 127.5 &nbsp; (500/12.5)</div>
<div>
	&nbsp; &nbsp; LEDlevel=constrain (LEDlevel,0,127.5); &nbsp; // SK makes sure LEDlevel doesen&#39;t go over 127.5 or negative</div>
<div>
	&nbsp; &nbsp; analogWrite(greenLED,(LEDlevel+127.5)); &nbsp;// SK at parrity both LED&#39;s get 127.5 each</div>
<div>
	&nbsp; &nbsp; analogWrite(redLED,(LEDlevel-127.5)); &nbsp; &nbsp;// SK at 500W Gen &amp; no Load green LED gets 255 &amp; Red gets 0&nbsp;</div>
<div>
	&nbsp; &nbsp; }&nbsp;</div>
<div>
	&nbsp; &nbsp; else &nbsp;//red if consumption&gt;gen</div>
<div>
	&nbsp; &nbsp; {</div>
<div>
	&nbsp; &nbsp; LEDlevel= (emontx.power1-emontx.power2) / 3.92156863; &nbsp;//LED full on at 500w</div>
<div>
	&nbsp; &nbsp; LEDlevel=constrain (LEDlevel,0,127.5);</div>
<div>
	&nbsp; &nbsp; analogWrite(greenLED, (LEDlevel-127.5)); &nbsp; &nbsp; &nbsp; &nbsp; // SK as above, but opposite way round</div>
<div>
	&nbsp; &nbsp; analogWrite(redLED, (LEDlevel+127.5));</div>
<div>
	&nbsp; &nbsp; }&nbsp;</div>
<div>
	&nbsp; &nbsp; else</div>
<div>
	&nbsp; &nbsp; { &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Led&#39;s off at night and when solar PV is not generating</div>
<div>
	&nbsp; &nbsp; digitalWrite(redLED, LOW);</div>
<div>
	&nbsp; &nbsp; digitalWrite(greenLED, LOW);</div>
<div>
	&nbsp; &nbsp; } }</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3858"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 16/04/2012 - 14:48.</div>
    <div class="content">
     <p>Hi Rob,</p>
<p>Thanks a lot for the GitPull request. I didn&#39;t merge it automatically in the end but I did mirror most of your changes in update I just made. Thanks a lot.&nbsp;</p>
<p>List of changes to solar PV:</p>
<ul>
<li>
		Improved text layout&nbsp;</li>
<li>
		Improve RF notifications: it now notifies if there is an emonTx or emonBase failure&nbsp;</li>
<li>
		Time in now displayed on front page when there is no RF failure&nbsp;</li>
<li>
		Time display bug is fixed, zero now displays correctly&nbsp;</li>
<li>
		LED&#39;s controlled with&nbsp;analog write, for PWM</li>
<li>
		Switch control has been re-enabled</li>
</ul>
<p>Many of the changes have been mirrored to Home Energy Monitor emonGLCD example.&nbsp;</p>
<p>Check out the updates here:&nbsp;<a href="https://github.com/openenergymonitor/emonGLCD">https://github.com/openenergymonitor/emonGLCD</a>. You can use git pull to update your code. It works very well and will keep any slight notifications you have made. Check out&nbsp;<a href="http://jeelabs.org/2011/12/27/the-convenience-of-git/">http://jeelabs.org/2011/12/27/the-convenience-of-git</a>/.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3893"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Wed, 18/04/2012 - 19:09.</div>
    <div class="content">
     <p>Glyn</p>
<p>No worries glad some of it was of use..</p>
<p>Could the Type 1 or Type 2 Solar a constant variable? Just it maybe easier&nbsp;for people with not much programming experience to looks for all the things they should change in one place. I understand at the mo&nbsp;most people are going to be experienced at this. Iv set up a test and could share if your interested. &nbsp;Im not sure if this adds more over head to the code and if its worth the bother though.</p>
<p>Im&nbsp;now looking at getting the buttons to display more detail Eg Total Import / Total Export to go along with the total PV and total usage. Any ideas? of what varables i should be looking at as im not 100% sure how you work out the import or export&nbsp;</p>
<p>Should i start a new thread as this seems to of changed from the original question?</p>
<p>Rob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4094"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 29/04/2012 - 16:31.</div>
    <div class="content">
     <p>Total export Kwh would be a good figure to display. It would simply by generated Kwh - consumed Kwh, it would be go negative if consumption &gt; generation for that day.&nbsp;</p>
<p>Yes I&#39;ve been thinking about how to simplify the solar PV setup. A flag variable at the beginning of the sketch to set what type of system is in use would make things much easier. I&#39;ll take a look, and let you know when I&#39;ve made the changes. Maybe you could test out the code for me, since I&#39;ll be traveling for the next week and not have a solar PV system to hand!&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4111"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Mon, 30/04/2012 - 07:26.</div>
    <div class="content">
     <p>Glyn</p>
<p>No worries on being a tester at all. Email me or post here</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4130"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 30/04/2012 - 17:24.</div>
    <div class="content">
     <p>Attached is some beta emonGLCD firmware with the option at the top of the sketch to set type 1 or type 2 solar PV system at top of the sketch. This has the potential to simplify setup for first time users. Please give it test since I don&#39;t have a PV system to hand right now.</p>
<p>I&#39;ve set default to be type 1.&nbsp;</p>
<p>Also please check the notes in the comments are consistent.</p>
<p>Cheers,&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4150"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Tue, 01/05/2012 - 19:08.</div>
    <div class="content">
     <p>Glyn</p>
<p>Seems to work fine for me.. I&#39;v changed it to type 2 as thats&nbsp;the system iv got,&nbsp;Button(s) work as does the time etc.. I cant seem to notice any difference from the normal one so thats good.</p>
<p>Any reason the noise offset is so large? (line 239) iv got mine set to 5 watts and thats&nbsp;fine maybe different inverters have different noise though. (Sunnyboy 1700 in my case.)</p>
<p>im&nbsp;still looking at the PWM of the LED and Backlight even more now iv got mine on a lipo battery. So i guess that this maybe of some interest&nbsp;to you.</p>
<p>Rob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4227"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sat, 05/05/2012 - 08:15.</div>
    <div class="content">
     <p>Great, good to hear. Thanks for testing it out.&nbsp;</p>
<p>Yeah, we have been paying it safe by setting quite a high minimum generation threshold. We have found some inverters register a higher consumption at night. We would like to investigate this further, I think it can differ if the inverter is a transformer or transformer less inverter and depending on if the user is using an AC-AC adapter to monitor&nbsp;real power.&nbsp;</p>
<p>I will lower the default minimum threshold to 50W and post the new code up to github.&nbsp;</p>
<p>Yeah, I&#39;m very interested to hear how you get on with LED PWM&#39;ing.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4393"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sat, 12/05/2012 - 21:37.</div>
    <div class="content">
     <p>Glyn</p>
<p>The PWM&#39;ing is not going well..</p>
<p>It seems there is a bug in it.. It works but after a while the screen just goes blank.. Not sure if its a hardware or software thing.. Seems as soon as you PWM&nbsp;either the backlight or LEDs at some point the screen gets corruption and then dies. The program still runs as the leds change as per the import / export.</p>
<p>&nbsp;</p>
<p>Am addring this to the display file</p>
<p><span style="font-size: 10px; ">void </span>LEDs_control<span style="font-size: 10px; ">()</span></p>
<pre>
<span style="font-size:10px;">{
   int LDR = analogRead(LDRpin);                    // Read the LDR Value so we can work out the light level in the room.
                                                      // GLCD settings
   int LDRbacklight = map(LDR, 0, 1023, 50, 250);    // Map the data from the LDR from 0-1023 (Max seen 1000) to var GLCDbrightness min/max
   LDRbacklight = constrain(LDRbacklight, 0, 255);   // Constrain the value to make sure its a PWM value 0-255

                                                     // LED&#39;s settings LED are brighter than the back light and can be dimmer
   int LDRleds = map(LDR, 0, 1023, 50, 150);     // Map the data from the LDR from 0-1023 (Max seen 1000) to var LEDs min/max
   LDRleds = constrain(LDRleds, 0, 255);             // Constrain the value to make sure its a PWM value 0-255

  //--------------------------------------------------------------------
  // Turn off backlight and indicator LED&#39;s between 12pm and 6am
  //-------------------------------------------------------------------- 
  DateTime now = RTC.now();
  int hour = now.hour();                  //get hour digit in 24hr from software RTC
 
  if ((hour &gt; 21) ||  (hour &lt; 5)) {       // changed as we go to bed early and get up early + its GMT+1 now.
    night=1; 
    glcd.backLight(0);
  } else {
    night=0; 
    glcd.backLight(LDRbacklight);  
  }

//--------------------------------------------------------------------
//Change color of LED on top of emonGLCD, red if consumption exceeds gen or green if gen is greater than consumption 
//-------------------------------------------------------------------- 

  if ((gen&gt;0) &amp;&amp; (night==0)) {
    if (gen &gt; consuming) {                //show green LED when gen&gt;consumption   
      analogWrite(greenLED, LDRleds);    
      analogWrite(redLED, 0); 
    } else {                              //red if consumption&gt;gen
      analogWrite(redLED, LDRleds);   
      analogWrite(greenLED, 0);    
    }
  } else{                                 //Led&#39;s off at night and when solar PV is not generating
    analogWrite(redLED, 0);
    analogWrite(greenLED, 0);
  }
}
</span>
and changeing this in the emonGLCD_SolarPV&nbsp;file

<span style="font-size:10px;">// Control led&#39;s

       //led_control();
       //backlight_control(); //- issue when emonGLCD does not receive correct time from base station display switches off - disable auto switch off at night as a precution 
       LEDs_control();
</span><span style="font-size: 10px; ">
</span></pre><p>&nbsp;</p>
<p>It works just that the at some point the screen goes blank.. This can be 5 mins or 1 hr.. so if you could have a look / or try it out that would be great..</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4401"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 13/05/2012 - 10:07.</div>
    <div class="content">
     <p>I&#39;m running it now, seems to be working ok. I&#39;ll update you with how it gets on. We have found that using a particular type of USB adapter can cause the LCD screen to go blank. Maybe you could try another sort?</p>
<p>The backlight and LED intensity changing is working well, it&#39;s quite subtle but I think it will do the trick. No one wasn&#39;t their emonGLCD illuminating the room when their trying to watch a film! It&#39;s just a case of tuning it, maybe the backlight and LED&#39;s could be dimmed further when it&#39;s really dak.</p>
<p>I had in the back of my mind that the LED intensity could reflect the power levels i.e when lots more power is being produced than is being consumed the green LED&#39;s would be very bright, when only slightly more power is being produced than used then would glow green dimly. Same for consumption, bright red at times of high consumption.&nbsp;</p>
<p>What do you think?&nbsp;</p>
<p>I think it would be a good idea to use the emonGLCD&nbsp;tester/demo sketch as a place to demo these PWM&#39;ing techniques.&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4403"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 13/05/2012 - 10:39.</div>
    <div class="content">
     <p>Im running this currently straight from the computers USB but have also tried several different USB power supplies. (Apple, HTC, Motorola) even a LIPO battery and always get the same after a while..<br />
	Will have ago again though may be iv got a duff voltage reg some where (like the blog post) and when changing the PWM settings its browning out the LCD as thats&nbsp;5V not 3.3V?.. Maybe it not fully bad, I dont know just a guess,</p>
<p>Yea i wanted it to be subtle as if its too noticeable you will be glancing at it all the time and that could get annoying.</p>
<p>Had thought about the leds reflecting the power usage eg&nbsp;dim green when exporting a bit to full green when exporting allot, But this would require the user to input the PV size as different people have different sizes so one persons export of 100w is great when the others is not. &nbsp;But this could be done.. The other reason for keeping them dim is that i want to make it portable so having the led at full pelt would drain the battery quickly. But i guess this may be just my goal.<br />
	Was even thinking of them changing from red to orange to green as you get close to 0 import / export but thought the simple green / red would be better</p>
<p>I agree the setting could be tweaked even more when dark. i did have them as user vars at the start of the sketch as then the user could decide. Although the LEDs would be off when dark the GLCD&nbsp;could be even darker.</p>
<p>Thats fine if you want to use the TEST/demo sketch.. it was more of a trial for me even though its not that successful at the mo.</p>
<p>As a thought could the GLCD backlight in the next version be a RGB back light as then you would not need the top leds.</p>
<p>anyway will report back in a bit.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4404"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 13/05/2012 - 10:45.</div>
    <div class="content">
     <p>Also think out loud</p>
<p>At the mo the sketch does not dim the GLCD backlight incase it gets the wrong time / or does not.. &nbsp;</p>
<p>could the following line work.</p>
<p>&nbsp;</p>
<pre>
  DateTime now = RTC.now();
  int hour = now.hour();                  //get hour digit in 24hr from software RTC

<strong>if ((hour &gt; 21) || (hour &lt; 5) &amp;&amp; ((millis()-last_emonbase)&lt;20000))) {</strong> 
    night=1; 
    glcd.backLight(0);
  } else {
    night=0; 
    glcd.backLight(LDRbacklight);  
  }</pre><p>this way if the GLCD does not get a response from the base it leaves the backlight on?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4405"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 13/05/2012 - 11:56.</div>
    <div class="content">
     <p>Sketch is still running fine for me.&nbsp;</p>
<p>Good idea adding the line to check for recent updates from emonBase. I have also added a line to only set the time from the emonBase when hour&gt;0, since the old versions of the emonBase code can return 0 (midnight) when the server returns null response.&nbsp;</p>
<p>You have a good point that people have different sized PV&#39;s. For now people can just set the size in the sketch, we can assume that in the UK the average array is between 2-4Kw. I have just added PWM control to the indicator LED&#39;s to indicate amount of power being used. See video:</p>
<p><iframe allowfullscreen="" frameborder="0" height="315" src="http://www.youtube.com/embed/H7EXHPc-lU8" width="560"></iframe></p>
<p>I&#39;ve committed&nbsp;these updates and your backlight light level control to the current emonGLCD examples of github. Thanks a lot for your help.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4406"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 13/05/2012 - 14:07.</div>
    <div class="content">
     <p>It&#39;s been blogged:<a href="http://openenergymonitor.blogspot.com/2012/05/emonglcd-solarpv-led-proportional.html">&nbsp;http://openenergymonitor.blogspot.com/2012/05/emonglcd-solarpv-led-proportional.html</a></p>
<p>It&#39;s not perfect but it&#39;s an improvement on just switching the LED&#39;s. Thanks again for your help. &nbsp;</p>
<p>Please test and feedback.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4407"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 13/05/2012 - 15:14.</div>
    <div class="content">
     <p>Right i think iv got to the bottom of my display crashing (not working) every now and then..</p>
<p>It seems that If i set the led to green and then turn off the red it sometimes crashes . If i always set the current led on to off and then the off one to on it works fine.. WEIRD..</p>
<p>Iv changed the following so it works for me.. Still don&#39;t know why this effects me.</p>
<p>&nbsp;</p>
<pre>
 if ((gen&gt;0) &amp;&amp; (night==0)) {
    if (gen &gt; consuming) {                //show green LED when gen&gt;consumption   </pre><p>&nbsp;</p>
<pre>
      analogWrite(redLED, 0);
      analogWrite(greenLED, LDRleds);    
    } else {                              //red if consumption&gt;gen
      analogWrite(greenLED, 0);
      analogWrite(redLED, LDRleds);   
    }
  } else{                                 //Led&#39;s off at night and when solar PV is not generating
    analogWrite(redLED, 0);
    analogWrite(greenLED, 0);
  }
}</pre><p>&nbsp;</p>
<p>Thats great Glyn.. will test out the code now.. &nbsp;Its great to see it in the wild.</p>
<p>You nearly had me.. Changing the RF12&nbsp;frequency from 433.. &nbsp;</p>
<p>You don&#39;t need line 117 in the display file (comment that no longer matters.)<br />
	And 134 - 136 or 139-141 Dup comment.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4410"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by vworp (not verified) on Sun, 13/05/2012 - 17:54.</div>
    <div class="content">
     <p>I&#39;m also finding that the lcd screen randomly goes blank. I&#39;m using the standard emonGLCD_SolarPV sketch on a type 2 system, powered by a usb adaptor from the open energy monitor shop.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4412"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 13/05/2012 - 18:21.</div>
    <div class="content">
     <p>That&#39;s an interesting find Rob. Very strange. I&#39;ve committed your change to the github, since it should not matter which way round the analog writes are, will be interesting to see if it fixed the problem for anyone else.</p>
<p>Good spot with the RFM12B&nbsp;frequency, thanks, that was a mistake! I try and keep the default to be 433Mhz, I was using an 868Mhz her e for testing, forgot to change it back.</p>
<p>Vworp: are you using the version with the LED and backlight PWM dimming code committed today? Has your emonGLCD been working fine in the past?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4413"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by vworp (not verified) on Sun, 13/05/2012 - 18:53.</div>
    <div class="content">
     <p>No PWM dimming code yet, I&#39;m using a sketch downloaded last weekend. The emonGLCD was assembled and tested earlier in the week, but only pressed into full time service yesterday afternoon.</p>
<p>So far, the lcd has blanked three times at 5-10 hour intervals. Not sure if the emonGLCD was still working other than the display being off, the LEDs were all lit green and it never occured to me to test if that was accurate.</p>
<p>Next time, I&#39;ll try drawing additional load from the grid, see the LEDs change to red, and also check the temperature feed on emoncms</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4414"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 13/05/2012 - 18:57.</div>
    <div class="content">
     <p>Ah that&#39;s interesting, so that indicates that maybe it&#39;s not the PWM code we have just introduced that is causing the problems.&nbsp;</p>
<p>I have had the same problem with the display going blank but only with one type of usb power supply. How are you powering the emonGLCD? Have you go a different USB PSU you can use? It might be something do to with switching frequency noise.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4415"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="vworp&#039;s picture" title="vworp&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by vworp (not verified) on Sun, 13/05/2012 - 19:09.</div>
    <div class="content">
     <p>I&#39;ve got three of the usb adaptors from the openenergymonitor shop. What I&#39;ll do, the next time it fails, is rotate the adaptors, swap the GLCD one for the emonTX or nanode one.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4417"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 13/05/2012 - 22:40.</div>
    <div class="content">
     <p>I think I&#39;ve found the problem, and possible solution&nbsp;<a href="679.html">http://openenergymonitor.org/emon/node/679</a>. Please let me know if it works for you.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4419"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Mon, 14/05/2012 - 07:16.</div>
    <div class="content">
     <p>Will try this tonight.. iv got some 200ohm resistors i could try. Do i take it we can use the PWR and GND&nbsp;holes near the USB port?</p>
<p>Great to see im&nbsp;not going mad..&nbsp;</p>
<p>This does seem to be the problem when using the LiPo&nbsp;packas well, charging it its fine but as soon as the battery has finished charging it crashes. output goes from 5 volts to 5.2v&nbsp;</p>
<p>Could the LCD be modded in ver 1.3 to be supplied from 3.3v instead? eg cutting a trace and using a fly lead to connect to 3.3v</p>
<p>as in cut the lcd&nbsp;track pin 14-15 from PWR line and connect to the JeePort&nbsp;3.3v or would that put too much strain on the 3.3v regulator?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4420"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 14/05/2012 - 07:39.</div>
    <div class="content">
     <p>Yup, that would work and is actually a better fix, less wasteful of power. Let me know how you get on, maybe this could be a better fix to recommend if it&#39;s not too difficult.&nbsp;</p>
<p>Board design and schematics are up here:&nbsp;<a href="http://solderpad.com/openenergymon/emonglcd/">http://solderpad.com/openenergymon/emonglcd/</a>.</p>
<p>I would recommend&nbsp;doing the voltage regulator fix as you describe to plower the LCD from 3.3V if you plan to use a lipo that had got a fully charge o/p of greater than 5V.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4430"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sat, 19/05/2012 - 09:16.</div>
    <div class="content">
     <p>Well connected the glcd to the 3.3v rail now and all good so far.. All works think the display needs slightly more contrast&nbsp;but will sort this out soon.</p>
<p>Could not cut the track as the track is under the LCD do had to snip the Pins 14 - 15 but its fine as the PCB does not come all the way to the edge so you can easily get a fly wire to it.. If you were to do the mod before the LCD in place i would expect it would be alot quicker.</p>
<p><a href="../sites/default/files/photo%202%20(2).jpg" target="_blank"><img alt="" src="../sites/default/files/photo%202%20(2).jpg" style="width: 300px; height: 225px; " /></a></p>
<p><a href="../sites/default/files/photo%201%20(2).jpg" target="_blank"><img alt="" src="../sites/default/files/photo%201%20(2).jpg" style="width: 300px; height: 225px; " /></a></p>
<p><a href="../sites/default/files/photo%203%20(1).jpg" target="_blank"><img alt="" src="../sites/default/files/photo%203%20(1).jpg" style="width: 300px; height: 225px; " /></a></p>
<p><a href="../sites/default/files/photo%204.jpg" target="_blank"><img alt="" src="../sites/default/files/photo%204.jpg" style="width: 300px; height: 225px; " /></a></p>
<p>Showing the LiPo&nbsp;solar charging circuit and a DC-DC step-up from 3.7V to 5V. Now could be replaced with a 3.3v regulator but may need a boost circuit&nbsp;for when the battery is lower than 3.0v&nbsp;<br />
	This board is over sized as i was going to try to hide the LCD back light but in the end gave up as the switches would also be hidden.</p>
<p><a href="../sites/default/files/photo%201%20(3).jpg" target="_blank"><img alt="" src="../sites/default/files/photo%201%20(3).jpg" style="width: 300px; height: 225px; " /></a></p>
<p>LiPo sandwich. LiPo is Velcro to the normal back and the extra plate mounted to the two extra stand offs for the angled display. LiPo is a 2700mha and have had 2days so far not seen it exhausted yet.</p>
<p><a href="../sites/default/files/photo%202%20(3).jpg" target="_blank"><img alt="" src="../sites/default/files/photo%202%20(3).jpg" style="width: 300px; height: 225px; " /></a></p>
<p>Edit.. The pictures show now expand to a full size for easy of looking.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4431"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 14/05/2012 - 22:41.</div>
    <div class="content">
     <p>Nice! Tidy job.&nbsp;</p>
<p>I would be interested to hear how long the LiPo lasts. Are you running it with the backlight and LED&#39;s?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4434"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Tue, 15/05/2012 - 06:58.</div>
    <div class="content">
     <p>Thanks..</p>
<p>Seems that this solves the problem for me at least as the LiPo&nbsp;fully charged under solar lastnight and the display did not crash..</p>
<p>Will let you know.. was charged last night at 8PM&nbsp;then disconnected from the mains then. has run all night and was still ok this morning. Should get 2 -3 days easy out of it..</p>
<p>Yes the LiPo&nbsp;runs every thing on it.. LED LCD fully. Was the reason i was trying to get the LDR so it could dim the LEDs&nbsp;to save power..</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4509"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sat, 19/05/2012 - 09:27.</div>
    <div class="content">
     <p>Update....</p>
<p>Battery lasted from Tues 20:00 to Fri 23:05.</p>
<p>So that&#39;s 3 days and 3 Hrs Completely off of mains power or 75Hrs.<br />
	Its been running the &nbsp;LCD, LCD backlight ( <u><em><strong>if ((hour &gt; 22) || &nbsp;(hour &lt; 5))</strong></em></u> ) Color Leds. All LED&#39;s are PWM in some way (running Glyn&nbsp;latest code)</p>
<p>The battery is 2700mA / 75hrs&nbsp;= 36mAh&nbsp;so the average power draw for my GLCD is 36mA That&#39;s not too bad is it? Wonder how much the 5V step up converter is using and how i can lower it.</p>
<p>Also wonder how long it takes the 6V 2W&nbsp;solar panel to charge the battery now.&nbsp;</p>
<p>As a side not the display has looked fine for the 3 days but when going to bed last night it was starting to look a little streaky. But that was around 10.30 and it only lasted another 35 mins after that.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4515"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sat, 19/05/2012 - 20:43.</div>
    <div class="content">
     <p>Thanks for the info Rob, its really good to have some real world battery life data. After work in the emonTx SMT is complete I plan to re-design the emonGLCD as with SMT&nbsp;electronics to enable it to be easily pre-assembled. Including the option of a battery back is high on the list of new features to add. I wonder how long it will last with no backlight or LED&#39;s?&nbsp;</p>
<p>You could power the emonGLCD directly from the 3.7V battery. Just connect it straight into the 3.3V power line to bypass the voltage regulator. 3.7V is not high enough to damage the RFM12B. The datasheet states an absolute maximum voltage of 6V and a working voltage of 3.3V. I&#39;ve ran and RFM12B at 5V&nbsp;for quite some time and it seemed to work just fine. I think their just playing it safe. It will be interesting to see if this does result in a longer battery life. The boost converter actually could be helping you as it will drain the battery lower than would otherwise be possible, although it will also have a power loss associated with it.&nbsp;</p>
<p>According to JeeLabs the backlight should use 6mA.</p>
<p>Atmega328 and RFM12B will be using quite a bit of power since they are working at full power all the time about 7mA when the RFM12B is not transmitting and about 14mA when it is.&nbsp;</p>
<p>On the emonTx we put the ATmega328 and RFM12B&nbsp;to &#39;sleep&#39; in between readings, this brings down consumption to about &nbsp;0.1mA. Although this is more complicated on emonGLCD since it needs to be &#39;awake&#39; to listen for data packets from the emonTx. Maybe some sort of timing algorithm could be implemented to put the emonGLCD to sleep for a defined period in between emonTx and emonBase&nbsp;RF e.g:&nbsp;</p>
<ol>
<li>
		emonTx&nbsp;transmit&nbsp;power reading to emonGLCD and emonBase, emonGLCD&nbsp;records the time the reading is received, emonGLCD&nbsp;knows (since it measured the first transmission) that reading from the emonTx&nbsp;occur every 10&#39;s</li>
<li>
		emonBase post power reading online and receive current time from server</li>
<li>
		emonGLCD receive current time from emonBase &gt; emonGLCD&nbsp;send room temperature reading back to emonBase - the time the emonBase sends the current time via RF to the emonGLCD can vary depending on speed of server responce.&nbsp;</li>
<li>
		emonGLCD calculates time between receiving emonTx reading and receiving emonBase time update</li>
<li>
		emonGLCD sleeps for the remaining time (10s- time delay for emonBase to send data) before the next emonTx transmission.&nbsp;</li>
<li>
		emonGLCD wakes up in time to receive the next packet from the emonRx</li>
<li>
		Repeat</li>
</ol>
<p>Take a look in the emonTx lib to see how the sleep code is implemented:&nbsp;<a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_CT123/emontx_lib.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTx_CT123/emontx_lib.ino</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4517"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 20/05/2012 - 06:55.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Do you want me to run it without the LCD-LED and other LEDS? Would give an idea then of power usage for just the main parts of the board.</p>
<p>Im not sure I can power the emonGLCD from the Battery as when its fully charged it&rsquo;s more like 4.2v and when its being charged and its either 5V (USB) or 6.2V (Solar cell) when charging, I know its over 5.11V as the LCD used to crash when it had finished charging so don&rsquo;t think i should connect it to the 3.3V line by its self.</p>
<p>You can get a schematic for the solar charger im using from here <a href="http://ladyada.net/products/usbdcsolarlipo/download.html">http://ladyada.net/products/usbdcsolarlipo/download.html</a></p>
<p>Its a shame it does not have a fuel gauge on this board as that would be very useful.</p>
<p>It also looks like a 6v 2W solar panel is not big enough to get enough charge in it as it die again last night after having a day of sun on it (well ish)</p>
<p>That idea looks great&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4519"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 20/05/2012 - 08:29.</div>
    <div class="content">
     <p>Ah ok, 5.11V is quite high. You make your own fuel gauge by putting the PWR input through a voltage divider to scale it to 3.3V max then putting the result into a free analog pin. A 330K ohm and top and a 560K ohm on the bottom should do the trick.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4520"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 20/05/2012 - 08:30.</div>
    <div class="content">
     <p>I know how much the RFM12B and Atmega use, I&#39;ve done quite a bit of measuring of the emonTx. It would be interesting if you could run the emonGLCD with the LCD on but backlight and LED&#39;s off.&nbsp;</p>
<p>Thanks for this.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4521"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 20/05/2012 - 09:17.</div>
    <div class="content">
     <p><span style="font-size:12px;">Ok just charging the battery again and have altered the code to make sure no LEDs&nbsp;are on .. EG backlight and top leds are off..</span></p>
<p><span style="font-size:12px;">Will have a look at making a fuel gauge.. im not great at electronics. I can hack them around but working out what resistors etc to use im pretty poor at..</span></p>
<p><span style="font-size:12px;">Do you know what the input limits are for the&nbsp;MCP1702 as the whole of my GLCD is now 3.3V going through this (well i think it is)&nbsp;im wondering if this would limit the output voltage from the solar / battery for me or is this too high a voltage for it..</span></p>
<p><span style="font-size:12px;">​It looks like it should be ok to 13.2V&nbsp;</span><a href="http://shop.moderndevice.com/products/mcp1702-jeenode-regulator">http://shop.moderndevice.com/products/mcp1702-jeenode-regulator</a>&nbsp;and&nbsp;<span style="font-family: arial, sans-serif; line-height: 15px; "><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/21983A.pdf">ww1.microchip.com/downloads/en/DeviceDoc/21983A.pdf</a> seem to say its ok, But want to check.</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4545"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 22/05/2012 - 08:39.</div>
    <div class="content">
     <p>Ah great. Hope it&#39;s still going strong.</p>
<p>Yes, 13V&nbsp;250mA are the limits for the MCP1702. I don&#39;t imagine you will be getting close to this.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4586"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 25/05/2012 - 19:14.</div>
    <div class="content">
     <p>&nbsp;</p>
<div>
	<span style="font-size:12px;">Right the&nbsp;GLCD&nbsp;died this&nbsp;morning.</span></div>
<div>
	&nbsp;</div>
<div>
	<span style="font-size:12px;"><span style="color: rgb(0, 0, 0); font-family: arial; ">Start : Sunday&nbsp;20/5/2012 15:15</span></span></div>
<div style="color: rgb(0, 0, 0); font-family: arial; font-size: small; ">
	<span style="font-size:12px;">End : Friday&nbsp;25/5/2012 02:12</span></div>
<div style="color: rgb(0, 0, 0); font-family: arial; font-size: small; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: arial; font-size: small; ">
	<span style="font-size:12px;">So&nbsp;thats&nbsp;4 Days&nbsp;10Hrs&nbsp;57Mins&nbsp;on a&nbsp;2700mHa&nbsp;battey. With just the LCD (3.3V mod) /&nbsp;<span style="font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">ATmega328&nbsp;and&nbsp;RFM12B&nbsp;No Top leds or LCD backlight.</span></span></div>
<div style="color: rgb(0, 0, 0); font-family: arial; font-size: small; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: arial; font-size: small; ">
	<span style="font-size:12px;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">​So&nbsp;thats 107hrs / 2700mha&nbsp;= 25.2 ma to run the above. Down from the 36ma for the leds as well..</span></span></div>
<div style="color: rgb(0, 0, 0); font-family: arial; font-size: small; ">
	&nbsp;</div>
<div style="color: rgb(0, 0, 0); font-family: arial; font-size: small; ">
	<span style="font-size:12px;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">​Will try again with out the 5v Step up converter on so it will be running from what ever the battery is putting out and letting the&nbsp;MCP1702 sort it all out to a usable voltage..</span></span></div>
<div style="text-align: -webkit-auto; color: rgb(0, 0, 0); font-size: small; ">
	&nbsp;</div>
<div style="text-align: -webkit-auto; color: rgb(0, 0, 0); font-size: small; ">
	<span style="font-size:12px;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">Hope all of this is of some use.</span></span></div>
<div style="text-align: -webkit-auto; color: rgb(0, 0, 0); font-size: small; ">
	&nbsp;</div>
<div style="text-align: -webkit-auto; color: rgb(0, 0, 0); font-size: small; ">
	<span style="font-size:12px;"><span style="font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">​I dont think that that is too bad.</span></span></div>
<div style="color: rgb(0, 0, 0); font-family: arial; font-size: small; ">
	&nbsp;</div>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4590"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 25/05/2012 - 22:18.</div>
    <div class="content">
     <p>Thanks for the update. Thank&#39;s promising. But I know it can be improved quite a bit if the ATmega sleep code as implemented. I&#39;ll see if I can hack together a little test in the next few days.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4595"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sat, 26/05/2012 - 08:48.</div>
    <div class="content">
     <p>OK trying again with out the step up converter.. Have noticed i need to increase the contrast to 0x20&nbsp;from 0x18&nbsp;as it just looks washed out now its running from 3.3v</p>
<p>Ok Glyn&nbsp;would be nice to see if we can do better..&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4599"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sat, 26/05/2012 - 20:07.</div>
    <div class="content">
     <p>Implementing the sleep code is a bit more involved than I thought. There are a number of things that need the Atmega not to be sleeping to work: PWM&#39;ing the backlight and LED&#39;s and the real time clock. Looks like our best bet at the moment is to just power optimize the current sketch (as you have done).&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4609"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Sun, 27/05/2012 - 14:39.</div>
    <div class="content">
     <p>Ok Glyn&nbsp;thats a shame been looking my self and there are a few options i guess but non easy that i can see..</p>
<p>It could sleep then wake using the watchdog timer (not very accurate) this should not matter as the GLCD gets the time from the internet?</p>
<p>Could the RFM12B wake it when receiving&nbsp;data?</p>
<p>Are the following pins free</p>
<p>Digital 3,4,5,7</p>
<p>Analog 0,1,3</p>
<p>Could the addition of a RTC like the DS1307 be used to help this?</p>
<p>Sorry for all the questions, im not a hardware expert (well not like this am fine with computers).</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4613"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 27/05/2012 - 22:02.</div>
    <div class="content">
     <p>See below for my emonGLCD port map, it should highlight what ports are free.&nbsp;</p>
<p>Only Dig 8 is free on V1.3.&nbsp;</p>
<p>I also had the idea of the RFM12B waking up the ATmega. I know it&#39;s possible to wake up the ATmega using one of the interrupt ports (Dig 2 and Dig3), the RFM12B&nbsp;is already connected to Dig2. The driver for the RFM12B is interrupt based, lots of information about this on the <a href="http://jeelabs.org/">JeeLabs.org</a> website.&nbsp;</p>
<p>I&#39;ve not heard of anyone using the RFM12B to wake up the ATmega&nbsp;when a packet is received. My guess is that the RFM12B requires the ATmega to be awake to enable it to receive packets. Maybe a post on the JeeLabs&nbsp;forum would clear this up?</p>
<p><img alt="" src="../sites/default/files/emonGLCD_portMap_0.png" style="width: 700px; height: 319px; " /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4648"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 01/06/2012 - 13:45.</div>
    <div class="content">
     <p>Update..</p>
<p>The GLCD lasted 5 Days 20Hrs&nbsp;and 41 mins this time with out the 5V step up converter. So just using the MCP1702&nbsp; to sort out the voltage from the LiPo pack. LCD 3.3v mod, LCD using PWM and LEDs&nbsp;PWM as per import / export value.</p>
<p>so thats 141 Hrs (rounded 41Mins to 1 Hr)<br />
	141 Hrs / 2700mha = 19.15mAh LCD on 3.3V all the rest standard as per current firmware for GLCD.</p>
<p>against</p>
<p>107hrs / 2700mha&nbsp;= 25.2 mAh for 3.3v Mod but still with 5v Step up.</p>
<p>75Hrs / 2700mha = 36mAh&nbsp;LCD 5v and 5v step up.</p>
<p>Really not sure what else could be done to increase the time now with out putting the unit to sleep? Maybe at night when the LCD light is off?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4649"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 01/06/2012 - 14:59.</div>
    <div class="content">
     <p>Correction its still going ignore above. It had either crashed or one of the other units had as it was displaying 0 but still on. Rebooted them all and is still going.. Will update when it finally dies again..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4652"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 01/06/2012 - 19:42.</div>
    <div class="content">
     <p>Ignore again.. 10 mins after resetting it all and it went blank. No idea if at 9.40 am it really did die (when i thought it had or just 10 mins after i got home....)</p>
<p>Have it on charge again and will think about what i can do to reduce the power draw.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4727"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Fri, 08/06/2012 - 19:02.</div>
    <div class="content">
     <p>Right a re run of above. Seems it was correct..</p>
<p>2/6/12 Sat 0910 Starts</p>
<p>8/6/12 Fri &nbsp;0810 Stops reporting temp to CMS 1847 before screen goes blank.</p>
<p>So<br />
	5 Days 23 Hrs &nbsp;&nbsp;(2700mAh / 143Hrs = &nbsp;18.88mAh) If you count when it stopped reporting the temp to CMS or</p>
<p>6 Days 9&nbsp;Hrs&nbsp;37 (2700mAh / 153.5Hrs = 17.59mAh) if you count when it dies a death.</p>
<p>Recap. This is running a 3.3V screen, LiPo 2700mAh battery running straight to the 3.3v regulator.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4769"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Mon, 11/06/2012 - 09:02.</div>
    <div class="content">
     <p>Right in a bid to cut power iv implemented&nbsp;some sleep code.. I mean iv used other peoples code as its too advanced for me but i get its gist and know what it does, Most of it anyway..</p>
<p>Its using the watchdog timer.</p>
<p>All works fine, apart from the LEDs on the top they flash, Strange the LCD backlight does not do the same? (any ideas.)</p>
<p>See video for flashing. <a href="http://youtu.be/UQHpKuh1BA4" target="_blank">0.5second sleep.</a>&nbsp; <a href="http://youtu.be/gxi93I5mgPA" target="_blank">16ms sleep</a></p>
<p>the flashing only happens when using analogWrite,&nbsp;digitalWrite is uneffected.</p>
<p>Code can be seen here&nbsp;<a href="https://github.com/rob-walker/EmonGLCD/tree/master/emonGLCD_SolarPV">https://github.com/rob-walker/EmonGLCD/tree/master/emonGLCD_SolarPV</a></p>
<p>All seems to work as expected.. You do need to add a delay after it wakes up as it has a tendency to crash the display / not update it, This delay needs to be bigger the more you sleep.</p>
<p>so sleeping for 32ms only needs 10ms delay.but sleeping for 1second need 200ms delay.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4781"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Tue, 12/06/2012 - 12:29.</div>
    <div class="content">
     <p>Ok so i did not think this through correctly..&nbsp;<br />
	It all works. Except the totals for pv and usage. They seem to be roughly 50% down on what they should.. I guess i should of worked that out..</p>
<p>so it sleeps for 32ms&nbsp;but is 50% down on expected.</p>
<p>The flickering i think iv worked it out but iv not got a fix.. The backlight for the LCD is on a Interupt pin, I have a theory that these pins dont&nbsp;get powered down where the LEDs on top are on normal pins and do there for flicker but i could be well off.. &nbsp;</p>
<p>Anyway i think im at my limmit of programming on this.. Will keep the code running and see how long it lasts on battery.. But will be going back to the normal code after as the flashing is really distracting.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4882"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: GLCD -Type 2 SOLAR PV help.</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Tue, 19/06/2012 - 19:17.</div>
    <div class="content">
     <p>Another update on the sleep code..</p>
<p>the EmonGLCD was set to sleep for 32ms&nbsp;this has increased the time now to 7 days almost to the dot.</p>
<p><span style="color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; background-color: rgb(238, 238, 238); ">7 Days (2700mAh / 168Hrs = 16.07mAh) With 32ms Sleep code. (does have annoying&nbsp;flashing leds but not backlight)</span></p>
<p><span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">6</span><span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; "> Days 9&nbsp;Hrs&nbsp;37 (2700mAh / 153.5Hrs = 17.59mAh) 3.3v GLCD mod.</span></p>
<p><span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 1.1em; line-height: 15px; text-align: left; ">(2700mha&nbsp;/&nbsp;</span><span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13px; line-height: 15px; text-align: left; ">107hrs</span><span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 1.1em; line-height: 15px; text-align: left; ">&nbsp;= 25.2 mAh) for 3.3v Mod but still with </span>5v<span style="background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 1.1em; line-height: 15px; text-align: left; "> Step up.</span></p>
<p style="font-size: 1.1em; margin-top: 0.5em; margin-bottom: 0.9em; color: rgb(0, 0, 0); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; background-color: rgb(238, 238, 238); ">(2700mha / 75Hrs = 36mAh)&nbsp;LCD 5v and 5v step up. NO PWM.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/541"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-VZxciZA0Th2Dp-OWA91O2Jcd_49Ri8A2bqbq-vyZkig" value="form-VZxciZA0Th2Dp-OWA91O2Jcd_49Ri8A2bqbq-vyZkig"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/541 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:33:02 GMT -->
</html>
