<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5163 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:08:12 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Hello - Advice on implementation of control applications | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Hello - Advice on implementation of control applications</h3>
        <span class="submitted">Submitted by <a href="../user/6309.html" title="View user profile.">Paul Morris</a> on Mon, 12/05/2014 - 00:12</span>
        <div class="content"><p>First post here, so Hello!</p>
<p>I have the EmonTx&nbsp;and associated bits &amp; pieces on order, but I hope to be able to extend the project to control one of my own prototypes. &nbsp;Just wondering where is the best place in the architecture to implement control logic.</p>
<p>In a similar fashion to the solar diverter projects I want to trigger when solar generation is greater than consumption by set amounts, then send a signal to a ATMega8 microcontroller that will signal an electric car charging station to begin charging. &nbsp;It will be possible to vary the charge rates from trickle charge right up to normal charge rates,&nbsp;approx&nbsp;1.4kW to ~2.5kW. &nbsp;As more surplus power is available a signal will be sent to the controller to step up charge rate. &nbsp;Likewise if surplus reduces a step-down, or stop signal will be sent to the charging station. &nbsp;No high current mains switching is required as the micro will provide a DC&nbsp;5V &#39;input current&#39; signal to a commercial charge controller that will negotiate with the car to step down rate of charge, or stop.</p>
<p>I also want to have my cake and eat it. &nbsp;I considered adapting the solar PV router, but I actually want emoncms&nbsp;functionality as well for general energy &amp; Solar PV monitoring. &nbsp;If I&#39;m correct, Robins PV router uses its own firmware on EmonTx and doesn&#39;t talk to emoncms. &nbsp;Is there a way to have both emoncms support and solar PV routing &amp; extend the logic for my application?</p>
<p>From what I&#39;ve read so far it seems there are a few options to play with when the kit arrives:</p>
<p>- implement control trigger logic in emoncms, but control what? &nbsp;I&#39;d rather not RF enable my charge controller. &nbsp;Ideally the RPi would send a signal back to the&nbsp;emonTx&nbsp;board which would toggle an output or send a serial command that would be picked up by my micro. &nbsp;The charge controller will be close enough to the eMonTx to have a wired connection. &nbsp;The logic triggers would need to be smart enough to send step up/down signals and preferably implement protection against the outputs toggling too quickly - though I could implement that downstream.</p>
<p>- modify the emonTx&nbsp;code to implement the necessary logic locally based on a delta from the solar PV router code and repurpose a PIN or PINs for the external triggering whilst trying to keep emoncms&nbsp;support. &nbsp;[is this hard work?]</p>
<p>- bite the bullet and implement a RF&micro;328 with RFM12B&nbsp;in my charge controller. &nbsp;I wanted to keep overall cost, size &amp; power consumption (&lt;100mA) down as space is tight, but this might have some neat advantages like removing the wired connection which could make a portable unit possible when using just a &#39;dumb&#39; 13A power socket if the protocol is reliable enough.</p>
<p>What do you think? &nbsp;Any other implementation options to consider?</p>
<p>&nbsp;</p>
<p>Thanks, Paul</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2164.html" class="topic-previous" title="Go to previous forum topic">‹ Battery powered emonTX</a>
              <a href="5149.html" class="topic-next" title="Go to next forum topic">Sending data from Arduino to Emoncms ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-21341"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello - Advice on implementation of control applications</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 12/05/2014 - 11:43.</div>
    <div class="content">
     <p>You might not have noticed that Robin has done a design for a second radio remote load, which seems to go some way to meeting your objectives, but it doesn&#39;t interface with emonCMS.&nbsp; His Mk2i_PV_Router_rev6 does have the code to report to emonCMS, but not the radio-controlled remote load.</p>
<p>An alternative is MartinR&#39;s PLL diverter, which has the reporting capability, but you would need to extend the software to allow it to control your car charger.</p>
<p>It ought to be possible to add control to emonCMS&nbsp; - it&#39;s something that is being looked at, but I&#39;m a bit lost as for the reason why - is it that you want manual remote control? If your car charger is the first priority load, it will accept the excess energy while it can (and you adjust your algorithm to signal it so that it exactly balances the surplus energy available); then when it can&#39;t accept any more, your immersion heater load will take over completely automatically.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-21360"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6309.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Paul Morris&#039;s picture" title="Paul Morris&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Hello - Advice on implementation of control applications</h3>

    <div class="submitted">Submitted by <a href="../user/6309.html" title="View user profile.">Paul Morris</a> on Tue, 13/05/2014 - 23:56.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Thanks for the reply. &nbsp;I saw Robin had started to implement logic for a second load. &nbsp;Modifying that could be an option, but I don&#39;t want to lose emonCMS monitoring and reporting.</p>
<p>I had looked at MartinsR&#39;s&nbsp;solution, but couldn&#39;t tell what the material difference was. &nbsp;What are the pros/cons of the two approaches to PV diversion?</p>
<p>I initially thought of trying to implement as much logic in emonCMS to avoid making a fork from the standard arduino&nbsp;sketches. &nbsp;It would be nice if there was a output pin or serial port on emonTx that emonCMS can control. &nbsp;That way, almost everything can remain standard, and I only need to implement custom hardware in the car charger to recieve/send data and signal the charge protocol controller accordingly. &nbsp;Manual override control or semi-automatic scheduling from the internet/smartphone might actually be nice if you need the car fully charged asap, or set a schedule such that if the car has not charged sufficiently by 14:00 ignore PV generation and override into 32A rapid charge to ensure its fully charged before the school run. &nbsp;I&#39;m still waiting for the kit to arrive to have a play, but it feels like these types of scenario suit the emonCMS&nbsp;logic better.</p>
<p>I really want to keep PV diversion to cater for situations where either the car is not plugged in, or it has entered the trickle charge or battery conditioning stage where it draws much lower currents. &nbsp;Does this make sense?</p>
<p>&nbsp;</p>
<p>Kind regards,</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5163"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-D3TaN7LtAJXM87-xWOXYnJmVGHToJGom9EJ4DONeKCY" value="form-D3TaN7LtAJXM87-xWOXYnJmVGHToJGom9EJ4DONeKCY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
