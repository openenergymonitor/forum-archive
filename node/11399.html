<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11399 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:14:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Flashing optiboot bootloader to rfm12pi | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Flashing optiboot bootloader to rfm12pi</h3>
        <span class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 14/10/2015 - 07:45</span>
        <div class="content"><p>Hi all,</p>
<p>I am building a rfm12pi&nbsp;from the bare pcb, I have soldered everything but when I connect my usbasp programmer and try to comunicate&nbsp;with the board i get a target doesn&#39;t answer response, what could be the possible mistakes I am doing? I have to flash the bootloader&nbsp;before soldering the rfm12b module? could it be that the chip needs to be connected to a 16mhz&nbsp;external oscillator to be programmed the first time?</p>
<p>I bought this atmega</p>
<p>​http://it.farnell.com/atmel/atmega328p-aur/mcu-8bit-atmega-20mhz-tqfp-32/dp/2425124</p>
<p>so I think it&#39;s an empty chip.</p>
<p>I have searched around but it seems that no&nbsp;one&nbsp;built the rfm12pi from the board and there are no guides about this process.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11503.html" class="topic-previous" title="Go to previous forum topic">‹ ATMEL ICE + EmonTx V3.4</a>
              <a href="11488.html" class="topic-next" title="Go to next forum topic">4 CT&#039;s on emontx v2 ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-34912"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Wed, 14/10/2015 - 08:58.</div>
    <div class="content">
     <p>You should be able to flash the bootloader&nbsp;with the&nbsp;rfm12b module in place, provided&nbsp;you have an external pull-up on the&nbsp;rfm12b&#39;s&nbsp;/CS signal. &nbsp;More on the reason for that here: &nbsp;<a href="5345.html">http://openenergymonitor.org/emon/node/5345</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34913"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 14/10/2015 - 09:16.</div>
    <div class="content">
     <p>ok, so I have to connect a 10k or 100k&nbsp;resistor between the CS (stands for&nbsp;chip select right? ) and the vcc pins and then try to flash the bootloader?</p>
<p>I will try when I get back home.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34914"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Wed, 14/10/2015 - 09:43.</div>
    <div class="content">
     <p>Yep, it&#39;s often written as /CS because it&#39;s active low. &nbsp;By pulling it high you&#39;re ensuring it&#39;s not active while you&#39;re trying to flash the bootloader.&nbsp; &nbsp;Once the system image is up and running you can rely on the internal s/w controlled pull-ups but until you&#39;ve got some s/w down there to enable them, you&#39;re kinda&#39; stuck.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34921"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 14/10/2015 - 16:25.</div>
    <div class="content">
     <p>mmm tried again with the resistor but still nothing...</p>
<p>sudo avrdude -v -p atmega328p -c usbasp -P usb -B10</p>
<p>avrdude: Version 5.10, compiled on Jun 27 2010 at 00:21:42<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Copyright (c) 2000-2005 Brian Dean, <a href="http://www.bdmicro.com/" title="http://www.bdmicro.com/">http://www.bdmicro.com/</a><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Copyright (c) 2007-2009 Joerg Wunsch</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;System wide configuration file is &quot;/etc/avrdude.conf&quot;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;User configuration file is &quot;/root/.avrduderc&quot;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;User configuration file does not exist or is not a regular file, skipping</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Using Port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: usb<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Using Programmer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: usbasp<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Setting bit clk period &nbsp; &nbsp; &nbsp; &nbsp;: 10.0<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AVR Part &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: ATMEGA328P<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Chip Erase delay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 9000 us<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PAGEL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : PD7<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;BS2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : PC2<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RESET disposition &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : dedicated<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RETRY pulse &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : SCK<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;serial program mode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : yes<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;parallel program mode &nbsp; &nbsp; &nbsp; &nbsp; : yes<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Timeout &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 200<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;StabDelay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 100<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CmdexeDelay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 25<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SyncLoops &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 32<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ByteDelay &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 0<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PollIndex &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 3<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PollValue &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 0x53<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Memory Detail &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Block Poll &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Page &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Polled<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Memory Type Mode Delay Size &nbsp;Indx Paged &nbsp;Size &nbsp; Size #Pages MinW &nbsp;MaxW &nbsp; ReadBack<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;----------- ---- ----- ----- ---- ------ ------ ---- ------ ----- ----- ---------<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;eeprom &nbsp; &nbsp; &nbsp; &nbsp;65 &nbsp; &nbsp; 5 &nbsp; &nbsp; 4 &nbsp; &nbsp;0 no &nbsp; &nbsp; &nbsp; 1024 &nbsp; &nbsp;4 &nbsp; &nbsp; &nbsp;0 &nbsp;3600 &nbsp;3600 0xff 0xff<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;flash &nbsp; &nbsp; &nbsp; &nbsp; 65 &nbsp; &nbsp; 6 &nbsp; 128 &nbsp; &nbsp;0 yes &nbsp; &nbsp; 32768 &nbsp;128 &nbsp; &nbsp;256 &nbsp;4500 &nbsp;4500 0xff 0xff<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lfuse &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp;0 no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp;4500 &nbsp;4500 0x00 0x00<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hfuse &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp;0 no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp;4500 &nbsp;4500 0x00 0x00<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;efuse &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp;0 no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp;4500 &nbsp;4500 0x00 0x00<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lock &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp;0 no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp;4500 &nbsp;4500 0x00 0x00<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;calibration &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp;0 no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 0x00 0x00<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;signature &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 &nbsp; &nbsp;0 no &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3 &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;0 &nbsp; &nbsp; 0 &nbsp; &nbsp; 0 0x00 0x00</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Programmer Type : usbasp<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Description &nbsp; &nbsp; : USBasp, <a href="http://www.fischl.de/usbasp/" title="http://www.fischl.de/usbasp/">http://www.fischl.de/usbasp/</a></p>
<p>avrdude: set SCK frequency to 93750 Hz<br />
avrdude: error: programm enable: target doesn&#39;t answer. 1&nbsp;<br />
avrdude: initialization failed, rc=-1<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Double check connections and try again, or use -F to override<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;this check.</p>
<p>
avrdude done. &nbsp;Thank you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34932"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 15/10/2015 - 09:54.</div>
    <div class="content">
     <p>How are you powering the rfm2pi during programming? Are you programming at 5v or 3.3v?&nbsp;</p>
<p>There is only one power rail on the rfm2pi&nbsp;which is normally 3.3v as the rfm is not 5v tolerant. that same rail is connectect&nbsp;to the ISCP&nbsp;header so you must&#39;nt&nbsp;inject 5v if rfm fitted.&nbsp;I don&#39;t know the programmer you have can it operate at&nbsp;3.3v?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34935"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Thu, 15/10/2015 - 10:07.</div>
    <div class="content">
     <p>I think the programmer could operate only at 5v, but it has a jumper to disable the power from the programmer to the target, so I am programming the board mounted on the raspberry to power it. in the vcc pin on the rfm I read 3.3v so I think it&#39;s ok.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34936"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 15/10/2015 - 10:28.</div>
    <div class="content">
     <p>At least the rfm is safe, I do not know the answers to these 2 questions offf-hand but I wonder</p>
<p>Is the rfm2pi&nbsp;avr @3.3v able to communicate with the programmer@5v and vice versa?</p>
<p>Is the reset line free to be controlled by the programmer or&nbsp;is it being influenced by the Pi&#39;s gpio settings?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34937"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Thu, 15/10/2015 - 10:39.</div>
    <div class="content">
     <p>I don&#39;t know the response to the first question, I hope&nbsp;someone more expert could provide the answer</p>
<p>for the second question here&nbsp;http://wiki.openenergymonitor.org/index.php?title=RFM12Pi_V2#Flashing_the_Bootloader</p>
<p>is written:<br />
To avoid accidental connection to 5V, the VCC pin on the ISP header is by default, disconnected. A jumper connection between the two adjacent pads must be made to connect the ISP VCC to the board VCC. On some ISP programmers, (such as the AVR MKII that I use) the VCC pin needs to be connected to initialise the programmer even though the programmer itself does not power the board. An easy way to power the board with 3.3V for programming, is to connect it onto the Pi&#39;s GPIO</p>
<p>so I think there should be no problems to program the bootloader&nbsp;with the gpio connected.</p>
<p>Of the reported part I don&#39;t understand the&nbsp;<br />
On some ISP programmers, (such as the AVR&nbsp;MKII&nbsp;that I use) the VCC pin needs to be connected to&nbsp;initialise&nbsp;the programmer even though the programmer itself does not power the board.<br />
I don&#39;t have an avr mkii&nbsp;but could it be the same problem?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34941"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 15/10/2015 - 11:30.</div>
    <div class="content">
     <p>If you&#39;re powering the AVR at 3.3V it&#39;s important that your programmer drives&nbsp;the SPI pins at 3.3V. &nbsp;I would imagine the same is also true for the RFM module (which is also sitting on the SPI bus during all of this). &nbsp;Ditto for the /RESET line, both for the AVR and the Pi&#39;s GPIO signals. &nbsp;You really don&#39;t want 5V near any of it.</p>
<p>Hopefully your programmer is sensing the 3.3V on pin 2 of the 6-pin header and using that voltage to drive all the other pins. &nbsp;That&#39;s what Atmel&#39;s programmers do. &nbsp;Assuming that&#39;s the case (so you&#39;re not over-volting anything) then Paul&#39;s suggestion about a conflict on the /RESET line is a good one. &nbsp;You probably want to make that Pi GPIO signal an input during the programming process so that the programmer can control it unconflicted.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34943"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 15/10/2015 - 12:02.</div>
    <div class="content">
     <p>I just noticed&nbsp;the link in the avrdude output to the programmer webpage and from there a link to the Readme.txt revealed this&nbsp;</p>
<blockquote><p><em>&quot;LIMITATIONS </em></p>
<p><em>Hardware:</em></p>
<p><em>This package includes a circuit diagram. This circuit can only be used for programming 5V target systems. For other systems a level converter is needed.&quot;</em></p>
</blockquote>
<p>Paul</p>
<p>EDIT - this will apply to&nbsp;that programmer, if using a derivative then it may not be relevant of course.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34945"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Thu, 15/10/2015 - 12:18.</div>
    <div class="content">
     <p>ok, so I think that even if there are some usbasp&nbsp;with a voltage selector jumper mine is too much simple to do it, so it could be time to replace it for something better?</p>
<p>if yes, do you have a suggestion for a decent programmer without spending a lot of money? I don&#39;t use it so much to spend a lot on it.</p>
<p>Do you think that with the 5v programmer I have damaged the rf? the datasheet says&nbsp;it has maximum absolute vdd of 6V.</p>
<p>To avoid the possible issues with the gpio&nbsp;could I power the board directly with a 3.3 external power source?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34962"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 15/10/2015 - 21:42.</div>
    <div class="content">
     <p>I&#39;ve had lots of joy with Atmel&#39;s own AVRISP mkII. &nbsp;It&#39;s very safe when it comes to voltages. &nbsp;It never powers the target but rather requires you to, and then it senses what voltage you&#39;ve powered your target at&nbsp;and uses that voltage for the programming.</p>
<p>It&#39;s not so much max absolute Vdd that&#39;s of concern here, but max absolute voltage on a pin... that&#39;s typically Vdd+0.5V, in other words 3.8V if you were powering the board with 3.3V. &nbsp;Even the AVR (which will run happily at 5V)&nbsp;can&#39;t cope with any pin higher than 3.8V when you&#39;re running it at 3.3V. &nbsp;The GPIO pin on your RPi that drives the /RESET signal was also potentially exposed.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34965"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 15/10/2015 - 23:07.</div>
    <div class="content">
     <p>Or if you have some F-F breadboard link wires (6x) and you are willing to make some changes to avrdude, you could use the Pi as a ICSP programmer without any further expense, although not as easy as ordering a new programmer and plugging it into your existing setup but it&#39;s possible, that&#39;s what I&#39;ve used in the past.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34984"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Fri, 16/10/2015 - 08:09.</div>
    <div class="content">
     <p>ok, in the meantime I have assembled another rfm12pi&nbsp;without mounting the rfm module and I have successfully uploaded the bootloader.</p>
<p>How can I check that it&#39;s all ok before soldering the rfm module?&nbsp;</p>
<p>I have installed the low write version of emoncms on the raspberry but I had no time to open it yet.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35019"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Sat, 17/10/2015 - 14:40.</div>
    <div class="content">
     <p>ok, I connected the new rfm12pi to the pi and it seems to be alive, but in the emonhub&nbsp;I have the following log:<br />
MainThread Opening hub...<br />
2015-10-17 14:34:14,774 INFO &nbsp; &nbsp; MainThread Logging level set to DEBUG<br />
2015-10-17 14:34:14,776 INFO &nbsp; &nbsp; MainThread Creating EmonHubJeeInterfacer &#39;RFM2Pi&#39;&nbsp;<br />
2015-10-17 14:34:14,782 DEBUG &nbsp; &nbsp;MainThread Opening serial port: /dev/ttyAMA0 @ 9600 bits/s<br />
2015-10-17 14:34:16,790 INFO &nbsp; &nbsp; MainThread RFM2Pi device firmware version: [RFM2Pi]<br />
2015-10-17 14:34:16,793 INFO &nbsp; &nbsp; MainThread RFM2Pi device current settings:&nbsp;<br />
2015-10-17 14:34:16,795 INFO &nbsp; &nbsp; MainThread Setting RFM2Pi frequency: 433 (4b)<br />
2015-10-17 14:34:17,799 INFO &nbsp; &nbsp; MainThread Setting RFM2Pi group: 210 (210g)<br />
2015-10-17 14:34:18,802 INFO &nbsp; &nbsp; MainThread Setting RFM2Pi quiet: 0 (0q)<br />
2015-10-17 14:34:19,806 INFO &nbsp; &nbsp; MainThread Setting RFM2Pi baseid: 5 (5i)<br />
2015-10-17 14:34:20,810 INFO &nbsp; &nbsp; MainThread Setting RFM2Pi calibration: 230V (1p)<br />
2015-10-17 14:34:21,814 DEBUG &nbsp; &nbsp;MainThread Setting RFM2Pi subchannels: [&#39;ToRFM12&#39;]<br />
2015-10-17 14:34:21,817 DEBUG &nbsp; &nbsp;MainThread Interfacer: Subscribed to channel&#39; : ToRFM12<br />
2015-10-17 14:34:21,820 DEBUG &nbsp; &nbsp;MainThread Setting RFM2Pi pubchannels: [&#39;ToEmonCMS&#39;]<br />
2015-10-17 14:34:21,823 DEBUG &nbsp; &nbsp;MainThread Interfacer: Subscribed to channel&#39; : ToRFM12<br />
2015-10-17 14:34:21,827 INFO &nbsp; &nbsp; MainThread Creating EmonHubMqttInterfacer &#39;MQTT&#39;&nbsp;<br />
2015-10-17 14:34:21,831 INFO &nbsp; &nbsp; MainThread MQTT Init mqtt_host=127.0.0.1 mqtt_port=1883<br />
2015-10-17 14:34:21,844 DEBUG &nbsp; &nbsp;MainThread MQTT Subscribed to channel&#39; : ToEmonCMS<br />
2015-10-17 14:34:21,848 INFO &nbsp; &nbsp; MainThread Creating EmonHubEmoncmsHTTPInterfacer &#39;emoncmsorg&#39;&nbsp;<br />
2015-10-17 14:34:21,853 DEBUG &nbsp; &nbsp;MainThread emoncmsorg Subscribed to channel&#39; : ToEmonCMS<br />
2015-10-17 14:34:21,957 INFO &nbsp; &nbsp; MQTT &nbsp; &nbsp; &nbsp; Connecting to MQTT Server<br />
2015-10-17 14:34:21,967 INFO &nbsp; &nbsp; MQTT &nbsp; &nbsp; &nbsp; connection status: Connection successful<br />
2015-10-17 14:34:21,970 DEBUG &nbsp; &nbsp;MQTT &nbsp; &nbsp; &nbsp; CONACK =&gt; Return code: 0<br />
2015-10-17 14:34:22,075 INFO &nbsp; &nbsp; MQTT &nbsp; &nbsp; &nbsp; on_subscribe<br />
2015-10-17 14:34:23,092 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;nn&gt; i &nbsp; &nbsp; - set node ID (standard node ids are 1..26)<br />
2015-10-17 14:34:23,214 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;n&gt; b &nbsp; &nbsp; &nbsp;- set MHz band (4 = 433, 8 = 868, 9 = 915)<br />
2015-10-17 14:34:23,332 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;nnn&gt; g &nbsp; &nbsp;- set network group (RFM12 only allows 212, 0 = any)<br />
2015-10-17 14:34:23,455 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;n&gt; c &nbsp; &nbsp; &nbsp;- set collect mode (advanced, normally 0)<br />
2015-10-17 14:34:23,570 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: ...,&lt;nn&gt; a - send data packet to node &lt;nn&gt;, with ack<br />
2015-10-17 14:34:23,685 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: ...,&lt;nn&gt; s - send data packet to node &lt;nn&gt;, no ack<br />
2015-10-17 14:34:23,800 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;n&gt; l &nbsp; &nbsp; &nbsp;- turn activity LED on DIG8 on or off<br />
2015-10-17 14:34:24,017 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; device settings updated: 65 i1 g210 @ 868 MHz &nbsp;Lock: 1</p>
<p>it seems that the &quot;Setting&nbsp;RFM2Pi&nbsp;frequency: 433 (4b)&quot; is not working, as at the end it shows&nbsp;868 MHz.</p>
<p>Even if I have not yet soldered the rf unit on the board it should work and set the right frequency I think.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35064"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 18/10/2015 - 11:35.</div>
    <div class="content">
     <p>Without looking closly at the sketch and JeeLib I can&#39;t recall what would be the expected behaviour&nbsp;without the rfm device. The settings may not get persisted if some sort of response is required from the RFM to <em>verify </em>the settings.</p>
<p>The &quot;acknowledged command&quot; labelled&nbsp;logs are the help text being printed to serial by the RFM2Pi as it doesn&#39;t understand a command given, hopefully it is the &quot;Setting RFM2Pi calibration: 230V (1p)&quot; it is objecting to as this is not used outside of the emonPi and can therefore be deleted from the emonhub.conf. However as is see no&nbsp;responses to the first 4 settings it isn&#39;t clear if there is no response to the first 4 and then objecting to the 5th or if it is objecting to the 1st until you amend the emonhub.conf.</p>
<p>It maybe easier to use a serial console and give it non-rfm commands to test it like turning the led on/off etc</p>
<p>Having said that, I&#39;m not sure how much more you can test, it is clearly communicating over serial so vcc, gnd, rx and tx lines seem fine, as must the reset line as you have flashed the firmware, the only stuff left can only really&nbsp;be tested by installing the rfm, maybe you could use some short link wires to temporarily&nbsp;&quot;tack&quot; the rfm in circuit if you are nervous.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35065"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 18/10/2015 - 12:02.</div>
    <div class="content">
     <p><i>"maybe you could use some short link wires to temporarily "tack" the rfm in circuit if you are nervous."</i><br />
Robin's energy diverter PCBs are laid out so that short wires are necessary to connect to the RFM module. It makes later removal very easy.</p>
<p><img width="450" src="../../../www.mk2pvrouter.co.uk/mediac/450_0/media/f38a139f4c26bb68ffff8007d4355564.jpg" height="337" border="0" alt="" /></p>
<p>(Picture from <a href="http://www.mk2pvrouter.co.uk/" title="http://www.mk2pvrouter.co.uk/">http://www.mk2pvrouter.co.uk/</a>)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35069"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Mon, 19/10/2015 - 08:08.</div>
    <div class="content">
     <p>ok, so it seems that the best thing to do is to solder the rf module in a temporary way to see if with the rf it works.</p>
<p>I will remove th&nbsp;&nbsp;230V (1p) line too from the emonhub config.</p>
<p>with the minicom serial console it seems that no commands are recognized, every key I press I receive back the help text.&nbsp;<br />
reading the sketch for the rfm12pi here</p>
<p><a href="https://github.com/mharizanov/RFM2Pi/blob/master/firmware/RF12_Demo_atmega328/RF12_Demo_atmega328.ino" title="https://github.com/mharizanov/RFM2Pi/blob/master/firmware/RF12_Demo_atmega328/RF12_Demo_atmega328.ino">https://github.com/mharizanov/RFM2Pi/blob/master/firmware/RF12_Demo_atme...</a></p>
<p>it seems that the&nbsp;handleInput (char c) prints the help if it receives a char that is not a number, a letter or a comma or if the letter is not a recognized command (default:&nbsp;showHelp();) so if I send only a number I should expect nothing back (the sketch sets the value and wait for another number or a command) but I get the help string.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35115"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 20/10/2015 - 06:29.</div>
    <div class="content">
     <p>ok, after an upload of the new version pf the rfm12pi sketch and some soldering it seems that the second board is now working with the rf soldered in a temporary way.<br />
Now I need to verify if it&#39;s receiving something, but my emontx&nbsp;v2 seems to have some problems too.<br />
The emontx&nbsp;v2 build guide states that the atmega328&nbsp;sold with the kit are shipped with&nbsp;the&nbsp;optiboot 4.4 bootloader, but I bought only the pcb from openenergymonitor shop as I had some atmega&nbsp;at home but they have the standard bootloader, I have to use the optiboot or I can keep the standard one?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35117"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 20/10/2015 - 06:57.</div>
    <div class="content">
     <p>What do you mean by the &quot;standard bootloader&quot;? &nbsp;What is it, and how did you flash it? &nbsp;As far as I can tell, optiboot&nbsp;4.4 is the standard bootloader&nbsp;if you&#39;re flashing it with&nbsp;the Arduino IDE.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35124"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 20/10/2015 - 07:30.</div>
    <div class="content">
     <p>ok, I didn&#39;t know this, so I have the right bootloader!</p>
<p>So now I have to figure out why it&#39;s not working!</p>
<p>From where I can start to make some throubleshooting? yesterday I tried to put the atmega on an arduino, I flashed the blink sketch and put the atmega on the board but I just figured out that the arduino&nbsp;sketch have the led on the pin 13 and the emontx&nbsp;on the pin 9, so the led was not flashing because it was not connected to the right pin.</p>
<p>I will probably try to edit the sketch and try again in the evening to check at least if the chip is well powered and if it&#39;s executing the sketches on the board.</p>
<p>I verified the crystal too and it seems that it&#39;s working well.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35126"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 20/10/2015 - 08:43.</div>
    <div class="content">
     <p>What are the symptoms again? &nbsp;I&#39;ve lost track of which hardware is working and which isn&#39;t. &nbsp;I take it when the atmega was on the Arduino board it was flashing the LED ok?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35127"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 20/10/2015 - 09:00.</div>
    <div class="content">
     <p>yes, the atmega&nbsp;on the arduino&nbsp;flashes the led, so it seems that the chip is working.</p>
<p>when I upload the&nbsp;emonTx_CT123_Voltage sketch, put the atmega on the emontx&nbsp;and power the board nothing happens, I expect it to at least power up the led as in the setup() there&#39;s&nbsp;digitalWrite(LEDpin, HIGH);</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35132"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Tue, 20/10/2015 - 09:57.</div>
    <div class="content">
     <p>I&#39;m not particularly familiar with those sketches or the radio module, but it looks like it doesn&#39;t set the LED high until after it&#39;s returned from&nbsp;rf12_initialize(). &nbsp;I think your idea of running the blink LED sketch (after you&#39;ve fixed the LED pin) on your emontx&nbsp;is a good one. &nbsp; &nbsp;Provided that works, you can focus on&nbsp;why emonTx_CT123_Voltage is&nbsp;hanging before it gets around to turning on the LED.</p>
<p>If your blink LED sketch doesn&#39;t work, then look at Vcc, the crystal and the /RESET signal. &nbsp;Sounds like you&#39;ve already checked the first two, so maybe /RESET is being asserted (held low).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35134"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 20/10/2015 - 10:41.</div>
    <div class="content">
     <p>When referring to a sketch it sometimes helps if you include a link (or location) as there are many similar named sketches, this allows the sketch to be confirmed as &quot;the right one&quot; and ensures all are commenting about the same sketch.</p>
<p>Not getting an initial flash from a RFM enabled board usually means the RF initialization&nbsp;has failed, this <em>can</em> be due to a faulty rfm or soldering etc, but the most common cause (with many sketches)&nbsp;is the &quot;#define RF69_COMPAT&quot; incorrectly set before compilation. Does the emonTx&nbsp;v2 have a rfm12 or rfm69 fitted?&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35138"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 20/10/2015 - 11:08.</div>
    <div class="content">
     <p>hi,</p>
<p>I have #define RF69_COMPAT 0 in the sketch and a rfm12 fitted</p>
<p>this is the sketch:<br />
<a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/emonTx_CT123_Voltage/emonTx_CT123_Voltage.ino" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/emonTx_CT123_Voltage/emonTx_CT123_Voltage.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2...</a><br />
&nbsp;</p>
<p>Can I try, after the simple blink sketch is working, to upload a modified version of the sketch with the two rf initialization lines commented out so I can see if the rf initialization is the problem?<br />
I hope that the rf is not the problem, as removing it is a pain but I think that probably I will have to remove it</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35140"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 20/10/2015 - 11:16.</div>
    <div class="content">
     <p>I believe if you comment out <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/emonTx_CT123_Voltage/emonTx_CT123_Voltage.ino#L92-L93">Lines 92 &amp; 93</a>&nbsp;and <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV2/emonTx_CT123_Voltage/emonTx_CT123_Voltage.ino#L130">line 130</a>&nbsp;it should run, but I&#39;ve not tested that theory :-)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35142"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 20/10/2015 - 12:01.</div>
    <div class="content">
     <p>ok, so commenting out the three lines I should expect to see the led flashing at boot and the flash every a couple of seconds right?</p>
<p>Valerio</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35143"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 20/10/2015 - 13:08.</div>
    <div class="content">
     <p>The LED will come on after it has initialised the radio module (or skipped that if commented out) and then go out after the first sample has been or would have been sent. Then the LED should flash every 5.2 s approximately (= 5 s sleep time  + the sample duration).</p>
<p>You will need an ac voltage input, otherwise calcVI( ) will not run properly as it will not have an ac wave to time itself with. Therefore, your voltage input pin must be correct.</p>
<p>It will not affect your problem, but with the latest emonLib, you no longer need "settled" and the wait for the filters to settle.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35144"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 20/10/2015 - 13:20.</div>
    <div class="content">
     <p>ok, I will remember to connect the ac voltage input!</p>
<p>eventually there&#39;s a simple way to desolder the rf unit?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35155"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 20/10/2015 - 16:28.</div>
    <div class="content">
     <p>I have done all the tests above and the board seems to hang&nbsp;on&nbsp;</p>
<p>rf12_initialize(nodeID, RF_freq, networkGroup);</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35158"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Tue, 20/10/2015 - 17:16.</div>
    <div class="content">
     <p>I would not advise de-soldering the RF Module without a hot air gun - it is tricky to get off without lifting a pad or two in the process.</p>
<p>There is <a href="http://jeelabs.net/boards/6/topics/1672?r=1735#message-1735">more debugging</a> of the module <em>in situ</em> that can be done if you have access to a scope.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35186"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 20/10/2015 - 23:16.</div>
    <div class="content">
     <p>If you have a multi-meter you could check the vdd and grounds to the rfm and check for any shorts to neighboring pins etc (assuming nothing can be seen with a magnifying glass eg whiskers of solderetc)</p>
<p>Also is the rfm board orientated correctly? may seem daft but unfortunately&nbsp;it wouldn&#39;t be the first time one has been fitted 180&deg; out!&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35194"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 21/10/2015 - 07:17.</div>
    <div class="content">
     <p>I checked the shorts on the&nbsp;neighbor&nbsp; pins immediately after soldering the rfm and are ok, I checked ground and vdd pins (the two near the antenna pin) when I made the power check as written on the building guide and the rfm&nbsp;is correctly receiving 3.3v. I checked the module orientation too following the datasheet and the building guide so I think those issues could be excluded, anyway I will make all the checks again just to be sure.&nbsp;<br />
<a href="../emontx/make/assemble/buildguide22.html" title="http://openenergymonitor.org/emon/emontx/make/assemble/buildguide22">http://openenergymonitor.org/emon/emontx/make/assemble/buildguide22</a></p>
<p>I have a scope but I am not so familiar with this instrument, so I will try the debugging in&nbsp;emjay&#39;s&nbsp;post and use this as a learning experience on how to use the scope.</p>
<p>I attached a photo of the mounted module so you can check the orientation too</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35195"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 21/10/2015 - 07:27.</div>
    <div class="content">
     <p>And just for fun and documentation here is a picture of the temporary soldered rfm on the rfm12pi&nbsp;to test everything some days ago.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35199"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 21/10/2015 - 10:31.</div>
    <div class="content">
     <p>the only thing I don&#39;t understand well in this post<br />
<a href="http://jeelabs.net/boards/6/topics/1672?r=1735#message-1735" title="http://jeelabs.net/boards/6/topics/1672?r=1735#message-1735">http://jeelabs.net/boards/6/topics/1672?r=1735#message-1735</a><br />
is where I have to put the &quot;magic button&quot;. Now I am powering the board from the batt&nbsp;pins with a 3.3v regulated source so as far as I know I am not using the internal voltage regulator (is that what in the post is called LDO right?) so I can avoid using the button and simply plug and unplug the power to the board?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35204"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Fri, 23/10/2015 - 12:02.</div>
    <div class="content">
     <p>Sorry, that part of the debug instructions is aimed at a JeeNode (a similar design and layout).&nbsp; This has an 3.3V LDO in the supply for both MPU and RFM that has current foldover protection. The &quot;magic button&quot; is a way to get glitchless control of this supply rail.</p>
<p>You really need a similar &quot;clean&quot; way to apply power to get the Power-on-Reset function of both chips to run successfully - there are restrictions on minimum rate of change of the voltage ramp. Simple plug/unplug is generally too &quot;noisy&quot; a method.</p>
<p>Perhaps some more detail on what is happening.&nbsp; If the RFM gets through its internal Power-on-Reset function, it generates a clock output (CLK pin)&nbsp;preset to 1 MHz, derived from the onboard crystal, . This does not require <strong>any</strong> external set up through the SPI.&nbsp; Getting this clock is a good sign of RFM health, it&#39;s absence suggests either very basic wiring errors (which you have eliminated) or a fried RFM.</p>
<p>Once the rf12 driver initialisation code is allowed to run, as part of the general register set configuration, <s>the CLK frequency is changed to 1.67 MHz</s>.&nbsp; This requires SPI transactions to succeed - which is where you look stuck at.</p>
<p>Later, to save power since CLK is not used, the CLK pin output is disabled.</p>
<p><em>Edited: the frequency change is now done after the CLK pin is disabled, so no longer visible on the scope. The controlled disappearance of the CLK signal is still a good indicator that SPI transactions to the module are succeeding.</em></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35207"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 21/10/2015 - 14:35.</div>
    <div class="content">
     <p>so given that I have a variable power source, could I start from minimum power (probably not enough to power the board) and progressively increase the voltage up to 3.3V so the rf module will power up when it will have enough power?<br />
or could I wire the &quot;magic button&quot; between the gnd and v+ of the supply?</p>
<p>I have one of these cheap power supplies:&nbsp;https://www.youtube.com/watch?v=4H6iwiPIaJI (not specifically the same but something similar)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35210"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 21/10/2015 - 16:07.</div>
    <div class="content">
     <p>I uploaded a modified version of the sketch with a delay(10000) before the&nbsp;rf12_initialize(nodeID, RF_freq, networkGroup); to have some time to read the CLK before the initialization.</p>
<p>when I power up the board (raising the current limitation on the power source) I get the 1Mhz&nbsp;square on the CLK pin (the attached&nbsp;pic) but then when I get to the rf_initialize the CLK returns to 0 and remains there... what I have to check now? in the post linked it says:</p>
<p>No CLK change to 1.66MHz&nbsp;implies the RFM12B has failed software set up.</p>
<p>Suspect the SPI bus (connections and loading from other attached devices), any code that manipulates directly or indirectly the SPI bus.</p>
<p>but I don&#39;t know what to do... :(</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35246"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Thu, 22/10/2015 - 17:06.</div>
    <div class="content">
     <p>Well the good news is your RF module is responding to SPI commands. I&#39;ve scanned the current driver code and the CLK disable is now done before the change to 1.67MHz (which of course will no longer be visible). But at least the CLK disable was done, so nothing much wrong with SPI transactions.</p>
<p>I&#39;m afraid at this stage it will take stepping through the driver code to see where the hang occurs.&nbsp; Since the driver is a mix of base level and interrupt level code, it is not advisable to use the standard printf() tracing.&nbsp; You can do direct writes to spare I/O pins though for tell-tale LED&#39;s.</p>
<p>Anything odd about the IRQ/INT line?&nbsp; The driver can&#39;t get very far without the RF Module free to pull this down.</p>
<p>&nbsp;</p>
<p>
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Fri, 23/10/2015 - 08:08.</div>
    <div class="content">
     <p>Yes, at least it&#39;s not completely dead!<br />
I checked all the connections from the rf and the atmega, and all the rf used pins (SEL, SCK, SDI, SDO, IRQ) are connected to the right atmega&#39;s&nbsp;pins and there are no adjacent rf lines shorted together, so IRQ line seems ok.<br />
I can check the IRQ line behaviour with the scope next time, what I should expect it to do?</p>
<p>If the IRQ line is not the problem how could I proceed? I know that it&#39;s a 5&euro; component and that&nbsp;could be cheaper to replace it with a new one but I&#39;m here to learn, so if someone could help me I&#39;m happy to proceed with some more debugging.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35267"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Fri, 23/10/2015 - 12:49.</div>
    <div class="content">
     <p>Ok, time to take the covers off the driver code. Pull down the most recent version of the source and look for the rf12_initialize() entry. You know you are getting past&nbsp; the SPI call that turns off CLK from the scope evidence.</p>
<p>As I mentioned above, direct writes to spare I/O pins with tell-tale LED&#39;s are best to mark your progress through the code. Some hints <a href="http://jeelabs.org/2010/08/27/flippin’-bits/">here</a>.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35270"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Fri, 23/10/2015 - 14:16.</div>
    <div class="content">
     <p>could I use the emontx&nbsp;internal led?<br />
I can put in RF12.cpp&nbsp;a code block like&nbsp;</p>
<p>digitalWrite(9, 1);<br />
delay(200);<br />
digitalWrite(9, 0);<br />
delay(200);</p>
<p>every a couple instructions on&nbsp;rf12_initialize and count the flashes before it gets stuck, then I can isolate a narrower set of instructions (from the first after the last blink to the one before the next blink) and move the blinks between these instructions to drill down to the one that is blocking the driver?<br />
Or the delay instructions could affect in some way the execution?</p>
<p>to modify the code I have only to modify the RF12.cpp file in the lib and it will be automatically uploaded when I upload the sketch to the atmega?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35274"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 23/10/2015 - 15:25.</div>
    <div class="content">
     <p><i>"to modify the code I have only to modify the RF12.cpp file in the lib and it will be automatically uploaded when I upload the sketch to the atmega?"</i></p>
<p>No, that is not enough. The IDE loads and keeps the library in memory. You must close <u>ALL</u> instances and windows of the IDE, and then restart it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35276"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Fri, 23/10/2015 - 15:28.</div>
    <div class="content">
     <p>ok, I will try and report here what I discovered! thanks for the hints</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35283"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Fri, 23/10/2015 - 21:19.</div>
    <div class="content">
     <p>Unless you put them to sleep (which is fairly hard to do accidentally) these AVR processors never really hang... they&#39;ll always be executing something. &nbsp;The SPI bus has no concept of acknowledgement&nbsp;so even if a SPI device is totally unresponsive, the CPU won&#39;t hang... it&#39;ll just get back garbage (usually the pull-ups) from any SPI reads and SPI writes will be silently ignored.</p>
<p>So when looking for hangs, you&#39;re almost always looking for software loops that don&#39;t terminate &nbsp;(or maybe&nbsp;IRQs that won&#39;t clear). A very quick perusal of&nbsp;rf12_initialize() here: &nbsp;<a href="https://github.com/jcw/jeelib/blob/master/RF12.cpp#L622">https://github.com/jcw/jeelib/blob/master/RF12.cpp#L622</a>&nbsp;makes me think there&#39;s only one opportunity for that routine to never return and that&#39;s this loop:</p>
<pre>
&nbsp; &nbsp; while (digitalRead(RFM_IRQ) == 0)
&nbsp; &nbsp; &nbsp; &nbsp; rf12_xfer(0x0000);</pre><p>So putting your scope on the RFM_IRQ pin would probably be a good starting point. &nbsp;If it remains permanently low, then that loop will run forever.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35315"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Sat, 24/10/2015 - 15:51.</div>
    <div class="content">
     <p>ok, I made some experiments and now more or less magically the initialization works, but now I have problems later on the&nbsp;<br />
rf12_sendWait(2)</p>
<p>I modified the codein this way:</p>
<p>void rf12_sendWait (uint8_t mode) {<br />
&nbsp; &nbsp; // wait for packet to actually finish sending<br />
&nbsp; &nbsp; // go into low power mode, as interrupts are going to come in very soon<br />
digitalWrite(9, 1); delay(1000); digitalWrite(9, 0);delay(100);<br />
&nbsp; &nbsp; while (rxstate != TXIDLE)<br />
digitalWrite(9, 1); delay(1000); digitalWrite(9, 0);delay(200);<br />
&nbsp; &nbsp; &nbsp; &nbsp; if (mode) {<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // power down mode is only possible if the fuses are set to start<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // up in 258 clock cycles, i.e. approx 4 us - else must use standby!<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // modes 2 and higher may lose a few clock timer ticks<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set_sleep_mode(mode == 3 ? SLEEP_MODE_PWR_DOWN :<br />
#ifdef SLEEP_MODE_STANDBY<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mode == 2 ? SLEEP_MODE_STANDBY :<br />
#endif<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SLEEP_MODE_IDLE);<br />
digitalWrite(9, HIGH);&nbsp;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sleep_mode();<br />
&nbsp; &nbsp; &nbsp; &nbsp; }<br />
digitalWrite(9, LOW);<br />
delay(200);<br />
}</p>
<p>and I have another led blink on emontx_lib just after&nbsp;rf12_sendWait(2);<br />
I can see that while executing the sleep_mode(); line the led is on for about 5-6 seconds, the the led goes off and the program stops responding (the led doesn&#39;t blink&nbsp;&nbsp;as written in the emontx_lib and to upload a new sketch I have to disconnect the power).<br />
At this point I really don&#39;t know where the execution goes, it doesn&#39;t continue to cycle as it doesn&#39;t execute the 1000ms blink at the start of the cycle, and it doesn&#39;t exits from the sendWait function as the next blink after the call to this function is not esecuted. The only point where it could be it&#39;s the&nbsp;rxstate&nbsp;!=&nbsp;TXIDLE&nbsp;check, am I right? it makes the check the first time, enters in the loop, completes it in about 5 seconds, then it tests the while condition&nbsp;rxstate&nbsp;!=&nbsp;TXIDLE&nbsp;for the second time and gets blocked there?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35319"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Sat, 24/10/2015 - 20:19.</div>
    <div class="content">
     <p>I think you&#39;re going to need some more curly brackets. &nbsp;The code used to do something like:</p>
<pre>
while (rxstate != TXIDLE)
  if (mode) {
    do some stuff
  }</pre><p>but you&#39;ve changed it to:</p>
<pre>
while (rxstate != TXIDLE)
  digitalWrite(9, 1);

delay(1000);
digitalWrite(9, 0);
delay(200);
if (mode) {
  do some stuff
}</pre><p>&nbsp;</p>
<p>But even after you&#39;ve fixed that error, judging by the comments in the original code, I&#39;d guess your delays are going to significantly change the behaviour of the code.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35360"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Mon, 26/10/2015 - 08:08.</div>
    <div class="content">
     <p>yes, you&#39;re right, I missed the brackets, probably because I program for work and me and my team as a best practice always include the brackets even if, like in this case, them are not so needed.</p>
<p>I agree that the delays could change the behaviour&nbsp;of the code, so I will try to avoid them in some way, I don&#39;t yet know how, but I will think to something to avoid delays at least in the while loop.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35387"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Mon, 26/10/2015 - 20:09.</div>
    <div class="content">
     <p>ok, everything now seems ok, I removed the delays and all the led flashing I added to the code, so now I have the led flashing every 5 seconds, the problems now is that the rfm12pi&nbsp;doesn&#39;t seem to receive any data... i should get the data in the emonhub logs right?</p>
<p>how could I try to know if the rf are working properly?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35390"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Mon, 26/10/2015 - 20:33.</div>
    <div class="content">
     <p>I updated the rfm12pi&nbsp;firmware to the last with git pull and the command&nbsp;update-RFM12&nbsp;in the RFM2PI&nbsp;directory of my pi but it didn&#39;t resolved. is that the right firmware for my setup?</p>
<p>at startup in my emonhub.log I have a lot of these:<br />
2015-10-26 20:24:02,893 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 1 NEW FRAME : OK 0<br />
2015-10-26 20:24:02,894 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 1 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-26 20:24:02,905 INFO &nbsp; &nbsp; MQTT &nbsp; &nbsp; &nbsp; on_subscribe<br />
2015-10-26 20:24:02,995 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 2 NEW FRAME : OK 0<br />
2015-10-26 20:24:02,996 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 2 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-26 20:24:03,097 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 3 NEW FRAME : OK 0<br />
2015-10-26 20:24:03,098 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 3 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-26 20:24:03,199 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 4 NEW FRAME : OK 0<br />
2015-10-26 20:24:03,200 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 4 Discarded RX frame &#39;string too short&#39; : []</p>
<p>and then nothing else from the RFM2PI</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35399"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 26/10/2015 - 23:11.</div>
    <div class="content">
     <p>Does the led on the rfm2pi flash when the emonTx led flashes to indicate receipt?</p>
<p>Is the emonTx and rfm2pi&nbsp;in the same group (usually 210 by default) ?</p>
<p>Is the emonhub loglevel set to debug? can you post the log entries for the&nbsp;rfm2pi&nbsp;interfacer setting&nbsp;up? it may be easier to resatrt emonhub&nbsp;using&nbsp;sudo&nbsp;service&nbsp;emonhub restart&nbsp;<span style="line-height: 20.8px;">rather than scanning the file,</span><span style="line-height: 20.8px;">&nbsp;</span></p>
<p><span style="line-height: 20.8px;">Paul</span></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35405"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Tue, 27/10/2015 - 06:45.</div>
    <div class="content">
     <p>no, the rfm2pi led is off, it flashes only a couple of times during the emonhub initialization<br />
emontx and rfm2pi are on the same group (210 as default)<br />
the log level is set to debug as you can see in the startup log.<br />
&nbsp;</p>
<p>here is the startup from the log file:</p>
<p>2015-10-27 06:39:38,682 INFO &nbsp; &nbsp; MainThread EmonHub Pre-Release Development Version (rc2.0?)<br />
2015-10-27 06:39:38,683 INFO &nbsp; &nbsp; MainThread Opening hub...<br />
2015-10-27 06:39:38,684 INFO &nbsp; &nbsp; MainThread Logging level set to DEBUG<br />
2015-10-27 06:39:38,685 INFO &nbsp; &nbsp; MainThread Creating EmonHubJeeInterfacer &#39;RFM2Pi&#39;&nbsp;<br />
2015-10-27 06:39:38,688 DEBUG &nbsp; &nbsp;MainThread Opening serial port: /dev/ttyAMA0 @ 38400 bits/s<br />
2015-10-27 06:39:40,694 INFO &nbsp; &nbsp; MainThread RFM2Pi device firmware version: [RF12demo.12]<br />
2015-10-27 06:39:40,695 INFO &nbsp; &nbsp; MainThread RFM2Pi device current settings: &nbsp;E i5 g210 @ 433 MHz<br />
2015-10-27 06:39:40,696 INFO &nbsp; &nbsp; MainThread Setting RFM2Pi quiet: 0 (0q)<br />
2015-10-27 06:39:41,699 INFO &nbsp; &nbsp; MainThread Setting RFM2Pi calibration: 230V (1p)<br />
2015-10-27 06:39:42,701 DEBUG &nbsp; &nbsp;MainThread Setting RFM2Pi subchannels: [&#39;ToRFM12&#39;]<br />
2015-10-27 06:39:42,703 DEBUG &nbsp; &nbsp;MainThread Interfacer: Subscribed to channel&#39; : ToRFM12<br />
2015-10-27 06:39:42,705 DEBUG &nbsp; &nbsp;MainThread Setting RFM2Pi pubchannels: [&#39;ToEmonCMS&#39;]<br />
2015-10-27 06:39:42,707 DEBUG &nbsp; &nbsp;MainThread Interfacer: Subscribed to channel&#39; : ToRFM12<br />
2015-10-27 06:39:42,712 INFO &nbsp; &nbsp; MainThread Creating EmonHubMqttInterfacer &#39;MQTT&#39;&nbsp;<br />
2015-10-27 06:39:42,714 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &gt; 0q<br />
2015-10-27 06:39:42,717 INFO &nbsp; &nbsp; MainThread MQTT Init mqtt_host=127.0.0.1 mqtt_port=1883<br />
2015-10-27 06:39:42,724 DEBUG &nbsp; &nbsp;MainThread MQTT Subscribed to channel&#39; : ToEmonCMS<br />
2015-10-27 06:39:42,726 INFO &nbsp; &nbsp; MainThread Creating EmonHubEmoncmsHTTPInterfacer &#39;emoncmsorg&#39;&nbsp;<br />
2015-10-27 06:39:42,729 DEBUG &nbsp; &nbsp;MainThread emoncmsorg Subscribed to channel&#39; : ToEmonCMS<br />
2015-10-27 06:39:42,821 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; device settings updated: E i5 g210 @ 433 MHz<br />
2015-10-27 06:39:42,827 INFO &nbsp; &nbsp; MQTT &nbsp; &nbsp; &nbsp; Connecting to MQTT Server<br />
2015-10-27 06:39:42,832 INFO &nbsp; &nbsp; MQTT &nbsp; &nbsp; &nbsp; connection status: Connection successful<br />
2015-10-27 06:39:42,834 DEBUG &nbsp; &nbsp;MQTT &nbsp; &nbsp; &nbsp; CONACK =&gt; Return code: 0<br />
2015-10-27 06:39:42,923 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 1 NEW FRAME : OK 0<br />
2015-10-27 06:39:42,924 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 1 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:42,936 INFO &nbsp; &nbsp; MQTT &nbsp; &nbsp; &nbsp; on_subscribe<br />
2015-10-27 06:39:43,025 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 2 NEW FRAME : OK 0<br />
2015-10-27 06:39:43,026 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 2 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:43,128 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 3 NEW FRAME : OK 0<br />
2015-10-27 06:39:43,129 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 3 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:43,231 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 4 NEW FRAME : OK 0<br />
2015-10-27 06:39:43,232 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 4 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:43,333 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 5 NEW FRAME : OK 0<br />
2015-10-27 06:39:43,334 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 5 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:43,436 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 6 NEW FRAME : OK 0<br />
2015-10-27 06:39:43,437 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 6 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:43,539 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 7 NEW FRAME : OK 0<br />
2015-10-27 06:39:43,540 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 7 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:43,663 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 8 NEW FRAME : OK 0<br />
2015-10-27 06:39:43,664 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 8 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:43,765 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &gt; 1p<br />
2015-10-27 06:39:44,118 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;nn&gt; i &nbsp; &nbsp; - set node ID (standard node ids are 1..30)<br />
2015-10-27 06:39:44,224 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;n&gt; b &nbsp; &nbsp; &nbsp;- set MHz band (4 = 433, 8 = 868, 9 = 915)<br />
2015-10-27 06:39:44,344 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;nnnn&gt; o &nbsp; - change frequency offset within the band (default 1600)<br />
2015-10-27 06:39:44,571 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;nnn&gt; g &nbsp; &nbsp;- set network group (RFM12 only allows 212, 0 = any)<br />
2015-10-27 06:39:44,676 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;n&gt; c &nbsp; &nbsp; &nbsp;- set collect mode (advanced, normally 0)<br />
2015-10-27 06:39:44,901 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: ...,&lt;nn&gt; a - send data packet to node &lt;nn&gt;, request ack<br />
2015-10-27 06:39:45,022 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: ...,&lt;nn&gt; s - send data packet to node &lt;nn&gt;, no ack<br />
2015-10-27 06:39:45,128 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;n&gt; q &nbsp; &nbsp; &nbsp;- set quiet mode (1 = don&#39;t report bad packets)<br />
2015-10-27 06:39:45,249 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;n&gt; x &nbsp; &nbsp; &nbsp;- set reporting format (0: decimal, 1: hex, 2: hex+ascii)<br />
2015-10-27 06:39:45,577 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;hchi&gt;,&lt;hclo&gt;,&lt;addr&gt;,&lt;cmd&gt; f &nbsp; &nbsp; - FS20 command (868 MHz)<br />
2015-10-27 06:39:45,700 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; acknowledged command: &lt;addr&gt;,&lt;dev&gt;,&lt;on&gt; k &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- KAKU command (433 MHz)<br />
2015-10-27 06:39:45,924 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; device settings updated: E i5 g210 @ 433 MHz<br />
2015-10-27 06:39:46,026 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 15 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,026 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 15 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:46,148 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 16 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,149 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 16 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:46,251 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 17 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,252 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 17 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:46,375 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 18 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,376 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 18 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:46,478 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 19 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,479 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 19 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:46,601 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 20 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,603 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 20 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:46,704 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 21 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,705 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 21 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:46,828 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 22 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,829 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 22 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:46,931 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 23 NEW FRAME : OK 0<br />
2015-10-27 06:39:46,932 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 23 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:39:47,055 DEBUG &nbsp; &nbsp;RFM2Pi &nbsp; &nbsp; 24 NEW FRAME : OK 0<br />
2015-10-27 06:39:47,056 WARNING &nbsp;RFM2Pi &nbsp; &nbsp; 24 Discarded RX frame &#39;string too short&#39; : []<br />
2015-10-27 06:40:12,788 INFO &nbsp; &nbsp; emoncmsorg sending: http://emoncms.org/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[]&amp;sentat=1445928012<br />
2015-10-27 06:40:12,924 DEBUG &nbsp; &nbsp;emoncmsorg acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
2015-10-27 06:40:42,729 INFO &nbsp; &nbsp; emoncmsorg sending: <a href="http://emoncms.org/myip/set.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y" title="http://emoncms.org/myip/set.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y">http://emoncms.org/myip/set.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y</a><br />
2015-10-27 06:40:42,944 INFO &nbsp; &nbsp; emoncmsorg sending: http://emoncms.org/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[]&amp;sentat=1445928042<br />
2015-10-27 06:40:43,098 DEBUG &nbsp; &nbsp;emoncmsorg acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a></p>
<p>and then it follows sending empty data to emoncms.org every 30 seconds</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35436"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 28/10/2015 - 08:13.</div>
    <div class="content">
     <p>another consideration:</p>
<p>I made the antennas from an old ethernet cable with solid cores, and the antenna length is 165mm&nbsp;as I am using 433mhz&nbsp;modules, is this correct?</p>
<p>I&#39;m also looking for a better avr programmer (for this and for future projects) but I found out that the avrisp mkII&nbsp;suggested by dbc some days ago seems to be no longer produced by atmel, could it be one of these clones a valid alternative? are them real clones of the original one with the same circuits and the same behaviour?<br />
<a href="http://www.ebay.it/itm/Atmel-AT-AVRISP-AVR-ISP-mkII-In-System-Programmer-ATAVRISP2-AVRISPmkII-compliant-/251058215634?hash=item3a743c5ad2:m:m-_wSE5SA5xyQpZFg8lComg" title="http://www.ebay.it/itm/Atmel-AT-AVRISP-AVR-ISP-mkII-In-System-Programmer-ATAVRISP2-AVRISPmkII-compliant-/251058215634?hash=item3a743c5ad2:m:m-_wSE5SA5xyQpZFg8lComg">http://www.ebay.it/itm/Atmel-AT-AVRISP-AVR-ISP-mkII-In-System-Programmer...</a><br />
It seems that atmel&nbsp;is now producing the atmel ice as a replacement of&nbsp;the avrisp&nbsp;mkII:<br />
<a href="http://www.ebay.it/itm/ATATMEL-ICE-PCBA-debuger-Atmel-Ice-/111807273158" title="http://www.ebay.it/itm/ATATMEL-ICE-PCBA-debuger-Atmel-Ice-/111807273158">http://www.ebay.it/itm/ATATMEL-ICE-PCBA-debuger-Atmel-Ice-/111807273158</a>?<br />
I should go for the rock solid avrisp mkII&nbsp;(even if a chinese clone if the design is the same it seems a good programmer) or&nbsp;the new genuine atmel ice? the price for the two listings seems almost the same( some &euro; more the ice)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35441"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 28/10/2015 - 11:33.</div>
    <div class="content">
     <p>I don&#39;t think the antenna should&nbsp;be a problem, a single solid core ~165mm&nbsp;sounds ok and I would presume during this debugging stage you would be testing the devices side by side, so it would need to be very &quot;wrong&quot; for a packet not to make it.</p>
<p>Can you use a serial console to check the actual serial traffic, there appears to be good comms between emonhub and the rfm2pi firmware since emonhub has displayed the firmware version and settings, unfortunatly&nbsp;almost all the firmwares have the same version so it doesn&#39;t confirm which firmware you are using.</p>
<p>It&#39;s unusual for empty packets to be processed,at all, without a received packet the rfm2pi shouldn&#39;t send anything, so I&#39;m inclined to think it may be emonhub&nbsp;mis-parsing the data but I&#39;m not familiar enough with the emon-pi version to be sure either way and the lack of an led flash on the rfm2pi &nbsp;contradicts that,&nbsp;&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-35442"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8830.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="valerio.a&#039;s picture" title="valerio.a&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Flashing optiboot bootloader to rfm12pi</h3>

    <div class="submitted">Submitted by <a href="../user/8830.html" title="View user profile.">valerio.a</a> on Wed, 28/10/2015 - 11:52.</div>
    <div class="content">
     <p>yes the pi and frm2pi&nbsp;are talking, as with minicom I can talk with the module, but it&#39;s not showing incoming packets when the emontx&nbsp;transmits, I tried to modify the group to 0 but nothing.<br />
the&nbsp;Discarded RX frame &#39;string too short&#39; : [] logs are displayed only at emonhub startup, then nothing except the&nbsp;emoncmsorg sending: <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a>... logs every 30 seconds.</p>
<p>The firmware I am using is the one that gets selected with the&nbsp;update-RFM12&nbsp;script in the RFM2PI&nbsp;directory of the sdCard image so it should be the following (I Haven&#39;t the raspberry here to check that the repository is the right one)<br />
<a href="https://github.com/openenergymonitor/RFM2Pi/tree/master/firmware/RFM69CW_RF_Demo_ATmega328" title="https://github.com/openenergymonitor/RFM2Pi/tree/master/firmware/RFM69CW_RF_Demo_ATmega328">https://github.com/openenergymonitor/RFM2Pi/tree/master/firmware/RFM69CW...</a><br />
and the hex loaded by the script is the&nbsp;RFM12_Demo_ATmega328.cpp.hex</p>
<p>the station&nbsp;and base are on the same room&nbsp;at about&nbsp;1 meter, I tried to put the rasp on the near room but it&#39;s the same.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11399"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-I_HG2o3FsNxObjNttZrxEups2GF9gplU07SjAIhxgFs" value="form-I_HG2o3FsNxObjNttZrxEups2GF9gplU07SjAIhxgFs"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
