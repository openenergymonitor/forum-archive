<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/467 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:34:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonTX New Code based on Interrupts | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonTX New Code based on Interrupts</h3>
        <span class="submitted">Submitted by Guest on Fri, 02/03/2012 - 21:03</span>
        <div class="content"><p>&nbsp;Hi there, (sorry for my poor english)</p>
<p>I&acute;ve been working form some nights now in developing a more precise (but more power expensive) EmonTX firmware based on interrputs, ind i&acute;ve made some great progress that i wish to colaborate to the project.</p>
<p>I&acute;m almost ready to post my first release of the code, as soon as i deal with the 3-phase shift. i&acute;m working in a software solution to extrapolate all the 3-phase data based on only one voltage source (to make it possible with emontx original hardware).</p>
<p>In my code i&acute;m dealing with configurable 1,2 or 3-phase systems with &nbsp;0, 1,2 or 3 voltage transformers (2 and 3 voltage sources breaks emonTX hardware compatibility)</p>
<p>In my approach, every cycle is computed and analized in the metering interrupt service routine, similar to the AVR example on the atmel&acute;s website.</p>
<p>Now there are some questions:</p>
<p>Where can i post the code? is there a page availiable for &quot;non-official&quot; firmwares? Shoud i post the code here in the forum?</p>
<p>Thanks</p>
<p>Paulo Cunha</p>
  <div class="forum-topic-navigation clear-block">
          <a href="915.html" class="topic-previous" title="Go to previous forum topic">‹ Errors at low currents with SSR</a>
              <a href="888.html" class="topic-next" title="Go to next forum topic">Iconic presentation of information on EmonGLCD ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-3307"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Amin Zayani&#039;s picture" title="Amin Zayani&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Amin Zayani (not verified) on Fri, 02/03/2012 - 21:56.</div>
    <div class="content">
     <p>&nbsp;Hi Paulo,</p>
<p>you can post the code on the forum, or better, on GitHub if you have an account.</p>
<p>looking forward to see your code.</p>
<p>regards</p>
<p>amin</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3309"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sat, 03/03/2012 - 14:37.</div>
    <div class="content">
     <p>&nbsp;Hi Paulo,</p>
<p>This sounds interesting. We have an OpenEnergyMonitor git hub:&nbsp;<a href="http://github.com/openenergymonitor">http://github.com/openenergymonitor</a>. Feel free to post to this account. Let me know if I need to make a new repo in the emonTx firmware for you.&nbsp;</p>
<p>All the best,&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3324"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Mon, 05/03/2012 - 20:55.</div>
    <div class="content">
     <p>Thanks&nbsp;<a href="../user/10.html" style="text-decoration: none; color: rgb(51, 102, 153); font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 9px; text-align: left; background-color: rgb(238, 238, 238); " title="View user profile.">glyn</a>,</p>
<p>I&#39;m new with github. i&#39;ll create an account today to see how it works.</p>
<p>I&#39;m testing and resolving some bugs that i found yesterday, and i&#39;m not finished the 3-phase calculations. Im stuck in a mathematical problem that our language barrier keeps me from explaining it to you.</p>
<p>i need to put a desk in front of my energy panel to test and debug the code...</p>
<p>i think in 2 more days i&#39;ll have a stable beta.</p>
<p>Regards,</p>
<p>Paulo</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3332"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Wed, 07/03/2012 - 15:33.</div>
    <div class="content">
     <p>The code is <strong>not ready</strong>, not <strong>Fully commented</strong>, and <strong>not properly cleaned</strong>, but it&acute;s working and it&acute;s beta1.</p>
<div>
	It has no Wireless transmission YET ( i have no access to a RFM...) and it has no power saving at all.</div>
<div>
	&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	&nbsp;</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4003"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Tue, 24/04/2012 - 14:01.</div>
    <div class="content">
     <p>Hey guys,</p>
<p>The <strong>base code</strong> (not the one i posted) was updated and was running rock solid form more then 1 month monitoring the 3 phases with a great accuracy, so my home server (a linux freeagent goflex) flash disk crashed and i lost all my emoncms history. I &nbsp;then decided to continue with the development.</p>
<p>I&acute;m now implementing the RFM code, eeprom config with remote adjustment of calibration values, pool period and RFM &nbsp;ids.</p>
<p>Trying to implement incremental kw&nbsp;storage i &acute;m thinking in a remote calibration mode to help with the calibration.</p>
<p><strong>Any ideas?</strong> My base ideia is to control all the calibration parameters remotely using the Gmonlcd and nanode. I&#39;m thinking in a calibration mode that you see the data near real time, and imputing an predefined resistive load to it it automatically adjusts itself to the load.</p>
<p>Future TODO&acute;s, will include gemonlcd menus to control the Emontx. that way i think will be possible to deploy and calibrate emontx&nbsp;and gemonlcd&nbsp;without the need of a computer for a full working solution.</p>
<p>Sorry if i&acute;m going in the opposite direction of the &quot;Keep it simple&quot;. i&acute;m going towards &nbsp;the &quot;Keep it easy to maintain&quot;...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4096"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 29/04/2012 - 16:36.</div>
    <div class="content">
     <p>This Looks interesting, it would be great if you could put the code in the git repository, this would make it easier for others to look at and post changes as well as a bit more explanation as to how it works. I&#39;ve had a quick look at the code, it looks pretty involved!&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4157"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Wed, 02/05/2012 - 00:19.</div>
    <div class="content">
     <p>1st public release of the code is on Github at:&nbsp;<a href="https://github.com/pcunha-lab/emonTxFirmware/tree/master/emonTx_Interrupts">https://github.com/pcunha-lab/emonTxFirmware/tree/master/emonTx_Interrupts</a></p>
<p>This code is stable and running for 1 week. without watchdog.</p>
<p>I&acute;ve just adapted the GLCD&nbsp;code to use the new payload format and i&acute;m working on the nanode&nbsp;firmware to be able to control the config variables by a remote pc using a webserver.</p>
<p>Soon i&acute;ll put the other codes too.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5245"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Mon, 16/07/2012 - 19:42.</div>
    <div class="content">
     <p>Hi all,&nbsp;</p>
<p>This new code is running rock solid for 3 months now.&nbsp;</p>
<p>I am now moving forward to create a configurarion menu for glcd and a new firmware to emonbase to handle the new protocol. and other device types ( acting lile a proxy to a emoncmd or similar soluton)</p>
<p>Looks i'm moving into a not too simple solution, but a more &quot;user friendly&quot;. i don't know if that's the objective of the project.</p>
<p>My goal this year is to implement more sensors that will integrate into the rfm network uning the protocol to comunicate via emonbase. That sensors will include an HVAC thermostat, a lamp dimmer switch, a wireless weather station, an aquarium controller &nbsp;and some other ideas for my home...</p>
<p>will this project be a good place to discuss that projects? since i'll be using all the basic concept of emontx, glcd and base? and they will be the heart of the system?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5329"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Mon, 23/07/2012 - 01:19.</div>
    <div class="content">
     <p>Hi Pcunha,</p>
<p>i was just starting to write my own three phase monitoring code with nearly the same ideas like you when I found this post. This is just excellent! Very much the same what I wanted to do and ready to use<img alt="" src="../sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/regular_smile.html" />.&nbsp;</p>
<p>The only thing that puzzled me a bit is the very high prozessor loading in the ADC ISR. I had only very few us per cycle left and quite a lot of&nbsp; jitter because some calculations seem to take even more time than available. This does not seem to harm accuracy as far as I can say, but is not really nice.</p>
<p>I found a very simple way to shorten the calculation by ~8-9us per interrupt:</p>
<p>- declare New and Previous in CurrentSampleS and VoltageSampleS as int (instead of float).</p>
<p>- calculate the .Filtered value as follows</p>
<p>&nbsp; xxxSample.Filtered&nbsp; = 0.996 *<strong> </strong>( xxxSample.PreviousFiltered + <strong>(</strong>xxxSample.New - xxxSample.Previous<strong>)</strong> );</p>
<p>With this modification, (xxxSample.New-xxxSample.Previous) is calculated using integer math and this seems to make the difference.</p>
<p>Please try and comment.</p>
<p>Big Thanks again for your fantatstic code!!!</p>
<p>&nbsp;</p>
<p>BR, J&ouml;rg.</p>
<p>&nbsp;</p>
<p>PS: is there a way to change the optimization of the compiler from -Os for size to -O2 or -O3 for speed?
</p>
<p>PPS: another 5 us per interrupt (and some memory space) can be saved by declaring ADC_V_BUFFER as int.&nbsp; &nbsp; </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5364"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 24/07/2012 - 08:51.</div>
    <div class="content">
     <p>I forgot to mention that I had to make one important change to get everything running:</p>
<p>-&nbsp; set bit 0x40 in ADMUX to select 'AVcc with external cap at AREF pin'</p>
<p>This was missing in Pcunhas code, maybe he is using a different hardware?</p>
<p>In this context I have one question: Is there a decent (eagle?) schematic and board file for the emontx available somewhere?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5481"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 01/08/2012 - 19:44.</div>
    <div class="content">
     <p><span class="Apple-style-span" style="font-family: Verdana, Arial, Helvetica, sans-serif; ">Wow! I have just spent the afternoon studying your firmware, its really great work, very impressive! I will get back to you with some further thoughts soon</span></p>
<p>Trystan</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5484"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Wed, 01/08/2012 - 21:12.</div>
    <div class="content">
     <p>There are some small 'bugs' in the code which should be removed first. I have taken Pcunhas code as a starting point, done some modifications and have tested the code with a 1+3 (1 wall transformer + 3CTs) sensor arrangement for real three phase measurement. Accuracy is quite good. Compared it to a professinal mains analyzer tool the power readings and accumulated energy were within +/-3%.This is much better than my 'official' energy meter, which is up to +10% off!</p>
<p>If I am allowed to, I would attach my code (or I can send it as PN if someone is interested). There is for sure room for improvements and the code still has some deficiencies.</p>
<p>Regards, J&ouml;rg.</p>
<p>&nbsp;PS: forgot to mention that my version is more or less fixed for the abovementioned 1+3 arrangement because I removed a lot of the conditional defines from the original code <img src="../sites/all/modules/fckeditor/fckeditor/editor/images/smiley/msn/confused_smile.html" alt="" />.&nbsp; </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5485"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Wed, 01/08/2012 - 21:16.</div>
    <div class="content">
     <p>Thats clever use of the free-running mode of the ADC on the Arduino chip.&nbsp; Got me thinking about other uses now.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5487"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Amin Zayani&#039;s picture" title="Amin Zayani&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Amin Zayani (not verified) on Wed, 01/08/2012 - 21:27.</div>
    <div class="content">
     <p>&nbsp;You're not the only ones! I also had to read a lot about ADC interrupts to understand it all (I'm not sure I do now :D)</p>
<p>But definitely inspiring for other projects!</p>
<p>This needs to be documented in the wiki in a decent way</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5488"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Wed, 01/08/2012 - 21:35.</div>
    <div class="content">
     <p>There can be one small problem with using the free running ADC interupt like in Pcunhas code. The code in the ISR has to take less cycles than the ADC conversion (in this case 104us) otherwise the sampling will be jittering (or even delayed). </p>
<p>If the calculations can not be done in a shorter time then using a Timer interrupt (with periode &gt;104us) starting the ADC is the better and more flexible solution.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5489"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 01/08/2012 - 21:46.</div>
    <div class="content">
     <p>In going through the code I pulled out the core part of the interrupt code and the circular buffer used for delaying the voltage waveform so that I could test their workings in isolation, I've put them up here:</p>
<p><a href="https://github.com/openenergymonitor/FirmwareDev/blob/c25cd9d4868c5b9104aa93b5c1c08cc07b946c2d/components/InterruptSampler/InterruptSampler.ino">Interrupt Sampling</a></p>
<p><a href="https://github.com/openenergymonitor/FirmwareDev/blob/c25cd9d4868c5b9104aa93b5c1c08cc07b946c2d/components/CircularBuffer/CircularBuffer.ino">Circular Buffer</a>, both <a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_CT123_3Phase_Voltage">Robert Wall's 3 phase code</a> and Pcunha's code use a circular buffer to delay the waveform.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5490"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 01/08/2012 - 21:56.</div>
    <div class="content">
     <p>&nbsp;Another part which was interesting to learn about was the ability to detect what kind of reset happened:</p>
<pre>
  if (MCUSR &amp; 1) // Power-on Reset
  {
    // put POR handler here, if required
  }
  else if (MCUSR &amp; 2) // External Reset
  {
    // put external reset handler here, if required
  }
  else if (MCUSR &amp; 4) // Brown-Out Reset
  {
    // put BOR handler here, if required
  }
  else // Watchdog Reset
  {
    // put watchdog reset handler here, if required
  };
</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5491"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Wed, 01/08/2012 - 22:21.</div>
    <div class="content">
     <pre><em><span class="n">ADMUX</span> <span class="o">=</span> <span class="p">(</span><strong><span class="mh">0x02</span> <span class="o">&amp;</span> <span class="mh">0x07</span></strong><span class="p">);</span> <span class="c1">// Set ADC reference to external VFREF and first defined port</span></em></pre><p>Is this correct? According to the schematic of the emontx on solderpad (isn't&nbsp; there a better one?) the emontx&nbsp; uses AVcc as reference with external capacitor on the AVref pin. This was one of the problems I had with the original code. I am using now:</p>
<pre><em><span class="n">ADMUX</span> <span class="o">=</span> <strong>0x40|</strong><span class="p">(</span><span class="mh">0x02</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span> <span class="c1">// Set ADC reference to external VFREF and first defined port</span></em></pre><p>&nbsp;</p>
<p>EDIT: Now I'm a bit puzzled.... do you really get correct ADC readings with your (== the original) code?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5493"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 01/08/2012 - 22:18.</div>
    <div class="content">
     <p>JBecker: Are you asking me? I havent tested the full sketch in action only studied it, I havent quite got as far as doing an analog read with the IntterruptSampler extract example, only as far as counting the number of samples that are taken in a second.. ?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5494"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Wed, 01/08/2012 - 22:26.</div>
    <div class="content">
     <p>Trystan,</p>
<p>sorry, I did not manage to address you correctly...(is there a possibility to quote?)</p>
<p>It would have been strange if you got correct results. Can you confirm that my assumption about the adc reference is correct?</p>
<p>This really puzzled me with the original code. It is very well done but has some real nasty bugs and I cannot believe that it worked as posted. This is why I made some comments in this thread.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5495"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 02/08/2012 - 07:37.</div>
    <div class="content">
     <p>Trystan,</p>
<div class="content">
<p><em>&nbsp;Another part which was interesting to learn about was the ability to detect what kind of reset happened:</em></p>
<pre><em>if (MCUSR &amp; 1) // Power-on Reset   ...... </em></pre></div>
<p><em>&raquo; </em></p>
<p>this is also directly copied from the application note AVAR465, as is the complete basic code discussed in this thread including interrupts by free running adc. Paulo 'just' added the three-phase capability and the <strike>configuration</strike> calibration via RF. It is a bit surprising that nobody seems to know the AVR465 code although the hardware clearly follows this app note and the app note is sometimes even given as a reference.</p>
<p>&nbsp; &nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5499"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 02/08/2012 - 08:59.</div>
    <div class="content">
     <p>Your quite right JBecker,&nbsp;ADMUX = 0x40 |&nbsp;(pin&nbsp;&amp; 0x07) is correct, this is the same as the default setting set in&nbsp;Arduino-1.0/hardware/arduino/cores/wiring_analog.c, it is&nbsp;AVcc as reference with external capacitor on the AVref pin that should be selected.</p>
<p>Interesting stuff, I had never really tried to understand this low-level stuff, I've just read up about it will write a short blog post for people interested.</p>
<p>EDIT: here's the blog post:&nbsp;<a href="http://openenergymonitor.blogspot.co.uk/2012/08/low-level-adc-control-admux.html">http://openenergymonitor.blogspot.co.uk/2012/08/low-level-adc-control-admux.html</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5501"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Thu, 02/08/2012 - 12:45.</div>
    <div class="content">
     <p>&nbsp;Hi eberybody,&nbsp;</p>
<p>Im very glad that the code was useful to you!</p>
<p>First of all, how we quote text from others? is there a quote button? I'll &nbsp;indent it then.</p>
<p>Let-me explain some points here. For some reasom i'm not receiving notifications from the forum, so i just watched the thread after a personal e-mail.</p>
<p><strong>JBecker:</strong></p>
<p class="rteindent1">I found a very simple way to shorten the calculation by ~8-9us per interrupt:</p>
<p class="rteindent1">- declare New and Previous in CurrentSampleS and VoltageSampleS as int (instead of float).</p>
<p class="rteindent1">- calculate the .Filtered value as follows</p>
<p class="rteindent1">&nbsp; xxxSample.Filtered&nbsp; = 0.996 *&nbsp;( xxxSample.PreviousFiltered +&nbsp;(xxxSample.New - xxxSample.Previous)&nbsp;);</p>
<p class="rteindent1">With this modification, (xxxSample.New-xxxSample.Previous) is calculated using integer math and this seems to make the difference.</p>
<p class="rteindent1">PPS: another 5 us per interrupt (and some memory space) can be saved by declaring ADC_V_BUFFER as int.&nbsp;&nbsp;</p>
<p>First you are right. Im pushing the avr at its edge. there are ways to optimize the code! i did'nt had enouth time.</p>
<p>your ideas are great! I'll implement that and see what it happens. How did you have measured the interrupt times? I've counted the lines in the assemble compiled version. Do you know if this is ok?</p>
<p>In the AVR document that i was inspired, all tha math is in integer. I did'nt had enouth brain processing power to understand that, so i've proceeded with part emontx code part avr doc code.</p>
<p class="rteindent1"><strong><span style="background-color: rgb(238, 238, 238); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">set bit 0x40 in ADMUX to select 'AVcc with external cap at AREF pin'</span></strong></p>
<p>That's absolutely correct and i'll add this to the docs.<strong> Im using my own hardware, based on EmonTX,</strong> with some minor modifications. The analog reference i'm using is from an external source provided by a variable resistor. so i can precisely calibrate the exact middle of the 3.3v source. The 3.3v Source i'm using is from an very precise dc-dc converter.</p>
<p>I have done several tests to came with this hardware. I wanted a configurarion that allows-me to go in a infinite loop, reading the ADC and only get 512 as a result with no load on the CT, without any noise. And the results i achived are 9.999 512 values per 10.000 samples! Thats very good result. I 'll take some pictures of the circuit later.</p>
<p class="rteindent1">If I am allowed to, I would attach my code (or I can send it as PN if someone is interested). There is for sure room for improvements and the code still has some deficiencies.</p>
<p>Please send it to me, so i can merge your modifications in the git! I Like condicional defines because, as a global project, everyone can use the same source code.&nbsp;</p>
<p>&nbsp;</p>
<blockquote><p>There can be one small problem with using the free running ADC interupt like in Pcunhas code. The code in the ISR has to take less cycles than the ADC conversion (in this case 104us) otherwise the sampling will be jittering (or even delayed).</p>
</blockquote>
<p>Yes. You shoud be careful with that. The way i found to debug the code and see if it is performing well is to set a volatile variable at the start of the interrupt and unset it at the end, If in the main loop, the variable is still set, i increment a second variable to count the interrupts that did'nt reached the end. It workd in a weird way. I 've also found that you can still debug the code from the serial line, but you need to use the fastest speed your uart can provide. Im using 115200 for debug.</p>
<p><strong>Thystan Lea:</strong></p>
<blockquote><p><span style="background-color: rgb(238, 238, 238); font-family: Verdana, Arial, Helvetica, sans-serif; line-height: 15px; text-align: left; ">JBecker: Are you asking me? I havent tested the full sketch in action only studied it, I havent quite got as far as doing an analog read with the IntterruptSampler extract example, only as far as counting the number of samples that are taken in a second.. ?&nbsp;</span></p>
</blockquote>
<p>Have you read my read-me?&nbsp;Im using a 20mhz crystal. The calculations of the number of samples per second are (from the manual):</p>
<p><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; line-height: 16px; white-space: pre; ">For 16mhz Crystal: 16000000 / 128 / 13 = 9615 Samples Per Second</span></p>
<p>128 is the ACD prescaler</p>
<p>13 is the total number of cycles used by the adc circuit do give you an reading</p>
<p>16000000, well, the frequency...</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5502"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 02/08/2012 - 13:48.</div>
    <div class="content">
     <p>Hi Paulo, very nice to hear from you!</p>
<p>To make it short, I have found three major 'problems' in your code:</p>
<p>- setting of the external reference as explained above (OR 0x40 to ADMUX), <strong>solved! </strong></p>
<p>- you put the 'Voltage.PhaseShifted' value into the ADC buffer. This is not so nice as this is already shifted by the phaseshift value for the first CT. Depending on the configuration, this might not be optimal (at least not for the 1+3 configuration). I would store the filtered voltage sample instead. And do the phase shifting when calculating the currents and depending power values. This means some more calculations after taking the current samples which will again need more processing time (see next item)</p>
<p>- runtime of the code. I found that the original code (run @16MHz !) jitters (= ISR is not entered at fixed 104us intervals), because some of the calculation just take too much time. The calculation time depends on the individual values and is not constant. So, sometimes the code jitters more and sometimes less. I made some improvements which help, but even in my code processing time is 'at or over the edge'. I would prefer to do all calculations in integer (as it is in the original AVR465 code. And, I never use float as it 'costs'). This can give big improvements. Float math is easy to do but <strong>can</strong> have a severe speed (and code size!) penalty. And it does not give more accurate results as some people seem to think!</p>
<p>&nbsp;</p>
<p>Debugging, measuring runtime of code:</p>
<p>I measure processing times by setting and resetting an unused digital output before and after the critical code section (or at the beginning and at the end of the ISR). Off course, you will need a scope for that.</p>
<p>That's it for now, hope we can find ways to improve the code so that it becomes even more useful.</p>
<p>Regards, J&ouml;rg.</p>
<p>&nbsp;</p>
<p>PS:  <em>.......count the interrupts that did'nt reached the end.</em></p>
<p>This assumption is not correct. Every ISR will reach the end and clear the volatile before returning to main.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5505"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Thu, 02/08/2012 - 14:50.</div>
    <div class="content">
     <p>JBecker,</p>
<p>As i don't have a scope, you will need to help-me with that.</p>
<p>I'll begin studyng integer math to optimize the code. I Think it is possible.</p>
<p>I'll work on this weekend.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5507"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 02/08/2012 - 15:04.</div>
    <div class="content">
     <p>Paulo,</p>
<p>I think I will also have some time on saturday and maybe sunday. My Emontx is at the moment 'permanently installed' in my distribution, but I will put it back on my desktop for this.&nbsp;</p>
<p>I have also made some tests already with conversion to integer calculations, but i had no time to finish it and then just wanted to have the system running.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5574"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Tue, 07/08/2012 - 12:46.</div>
    <div class="content">
     <p>Hi Jbecker,</p>
<p>Thank you for the explanation on the other topic.&nbsp;</p>
<p>I didnt know where the 0.996 came from. i was trying to figure it out all the last weekend :)</p>
<p>I had made some minor improvements and corrections on the code that saved about 50 cycles per interrupt, with the same math code. and your suggestion. Its not much but it is something. (counted at avr studio)</p>
<p>The calculations are being done when the adc index is 0, but it shoud be when its (num_cts + num_voltage_Sensors), because we are geting one more voltage sample.</p>
<p>I had worked 2 days and i did'nt solved it. Can i leave that part to you? i think you got the 0.996 math better than me. If yes, i'll work on my idea of auto calibration routine.</p>
<p>As soon as im able to connect to my Github account again, i'll upload the code.</p>
<p>Thanks,</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5575"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX New Code based on Interrupts</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Tue, 07/08/2012 - 13:00.</div>
    <div class="content">
     <p>Hi Paulo,</p>
<p>I just found out that my SSD is defect. First I will have to setup my computer again. I have copied the last (?) sketch that I did before the PC was wrecked and will try to append it here.</p>
<p>This sketch hast just the voltage measurement implemented correctly. The current measurement is not ok yet. But I think you can get the idea.</p>
<p>Cheers, J&ouml;rg.</p>
<p>PS: it is not allowed to attach .ino files? And .pde is ok? </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/467"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-KCLmzKYu03f2XosZtwpxbb6D2tIksO5k9nc_IBezi6o" value="form-KCLmzKYu03f2XosZtwpxbb6D2tIksO5k9nc_IBezi6o"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
