<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/1615 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:37:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>RESOLVED - EmonGLCD not restarting via USB power | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">RESOLVED - EmonGLCD not restarting via USB power</h3>
        <span class="submitted">Submitted by <a href="../user/1189.html" title="View user profile.">Avontech</a> on Sun, 09/12/2012 - 17:06</span>
        <div class="content"><p>An odd one this!</p>
<p>If I restart the emonGLCD by unplugging / turning off the USB power of restart it doesn&#39;t receive / display any data., the screen comes up OK with Zeros for the &#39;received&#39; data, and only the startup temperature, i.e. the screen isn&#39;t being refreshed.</p>
<p>As soon as I plug in the USB to serial UART connector, (FDTi euivalent), it reboots and starts displaying data</p>
<p>I&#39;ve tried it with different scripts and get the same result - they load up fine, and run fine only after rebooting by plugging the cable in.</p>
<p>Interestingly I&#39;ve just tried it without the connector connected to the PC, and that also reboots it and it starts displaying data...</p>
<p>It sounds as though the script isn;t loading correctly (or I need a reboot button)</p>
<p>Any ideas where to start?</p>
<p>As an aside I did have the screen contrast problem which eventually resolved it self after being left on (capacitors wrong way round)</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2313.html" class="topic-previous" title="Go to previous forum topic">‹ Which way to turn the programmer?</a>
              <a href="1585.html" class="topic-next" title="Go to next forum topic">Wireless Pulse Module ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-8071"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1399.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1399.jpg" alt="Series530&#039;s picture" title="Series530&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by <a href="../user/1399.html" title="View user profile.">Series530</a> on Sun, 09/12/2012 - 18:17.</div>
    <div class="content">
     <p>I&#39;ve seen with mine that the choice of external power supply can be critical. In fact, I&#39;m even of the opinion that a poor USB supply was responsible for frying one of my programmers.</p>
<p>Some USB chargers, for example, for phones are built to a very poor standard while USB ports on PC&#39;s have to meet the USB power source and sync specifications.</p>
<p>Try a different external supply and see what happens.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8072"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1189.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Avontech&#039;s picture" title="Avontech&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by <a href="../user/1189.html" title="View user profile.">Avontech</a> on Sun, 09/12/2012 - 18:38.</div>
    <div class="content">
     <p>I&#39;ve tried it with numerous supplies, even directly connected to the PC, - because we have more than one or two Pi&#39;s about here we are very aware of power supply variances :)</p>
<p>It&#39;s the action of plugging the UART adapter in to the programming header - and it makes no difference whether or not the adapter is connected to the pc that causes a reboot of the GLCD and hence kickstarts the script...</p>
<p>The script is definitely hung as the the on-screen timer isn&#39;t refreshed either</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11690"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1189.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Avontech&#039;s picture" title="Avontech&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by <a href="../user/1189.html" title="View user profile.">Avontech</a> on Sun, 28/04/2013 - 22:51.</div>
    <div class="content">
     <p>Bump to retrigger this thread, As it is still unresolved, (I kept quiet whilst the Jeelib challenges were fixed :) )</p>
<p>I can plug the USB to serial UART connector direct into the power supply that I am using, and it will boot up properly, just not when powered by the USB cable...</p>
<p>The script doesn&#39;t&nbsp; look like it&#39;s hung, as the timer runs (the TX resolved that) however it isn&#39;t receiving / processing and data from the emonTx&#39;s or it&#39;s on board temperature sensor.</p>
<p>It has been suggested elsewhere that this behaviour, may be:</p>
<blockquote><p><em>Avontech - your problem sounds like a reset issue since the reset line is connected to the header but not the USB socket. It may be that the fuses in the ATmega328 aren&#39;t programmed correctly for the internal reset.</em></p>
</blockquote>
<p>Is this likely to be the cause?</p>
<p>If so, how do I go about viewing and configuring the fuses?</p>
<p>TIA</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11698"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="teepbee&#039;s picture" title="teepbee&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by teepbee (not verified) on Mon, 29/04/2013 - 13:16.</div>
    <div class="content">
     <p>Avontech I have had the same problem. After quite a bit of time investigating I seem to have struck on a solution or at least I haven&#39;t had a reoccurrence since implementing it.</p>
<p>Of course as the emonGLCD is now operating as expected I have only restarted on a small number of occasions generally as I have developed the code for my purpose, but it has fired up fine on each occasion using the same power supply (obtained from the shop) as when it used to hang.</p>
<p>As I write I don&#39;t have access to the sketch so I will endeavor to post the relevant code later but the change I made that has made all the difference in my case was during setup(). I decided to initialize the RFM12B last after the calls to the glcd methods and the temperature sensor. I also placed a short delay before and after the call to rf12_initialize. My reasoning was to allow the other components to have started-up/reset etc for the first time and then initialize the RFM12B module also giving it some time to settle down. Notwithstanding I recall the the rf12_initialize code does a check to see if the device is ready.</p>
<p>Avontech maybe if you make a similar change in the setup() method this will work for you also. &nbsp;</p>
<p>Whilst I was trying to troubleshoot this issue I also noted that much much rarely the emonGLCD would exhibit the same behavior when started via the programming header.</p>
<p>Apart from real basics the electronics side of this is outside my domain so I pursued trying to work out what what was happening via the code after all the emonGLCD did update the screen and display a temperature at least once.</p>
<p>I eventually determined that the RFM12B code was putting the processor into sleep mode from which it never resumed. This was when the emonGLCD was attempting to send the first temperature reading. The state machine indicated that it was attempting to send the first PRE bytes and nothing further happened. Eventually I concluded that no interrupts were being raised rather than an issue with the unit resuming once an interrupt was raised.</p>
<p>In the case when all worked correctly by the time the code tried to send this first reading there had normally been many RFM12B interrupts. I have a number of temperature nodes, emonTX and nanodeRF already deployed. In the case where it hung there were no interrupts.&nbsp;</p>
<p>After reading about the differing quality of USB power supplies I tried a branded supply which came with an iPad and yes the emonGLCD worked. However this only raised a false hope as whilst it improved the chance of the emonGLCD working&nbsp; it did still on occasion hang.</p>
<p>This did however make me wonder if the problem concerned the various components powering-up plus my choice of USB power supply which led me to make the change described above.</p>
<p>As noted it has worked for me. So much so I am about to build my second emonGLCD.</p>
<p>During this process I have tried various sketches but the latest HomeEnergyMonitor sketch on GitHub was used in my recent effort to understand what was going on and is the basis of what I have deployed at the moment. I first had this problem about the time the updated jeelib was issued for a previous issue with the RFM12B and have used the updated library since it was made available.</p>
<p>More than happy for someone to &#39;put me right&#39; regards my conclusion but I hope this helps.</p>
<p>Tim</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11705"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1189.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Avontech&#039;s picture" title="Avontech&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by <a href="../user/1189.html" title="View user profile.">Avontech</a> on Mon, 29/04/2013 - 20:23.</div>
    <div class="content">
     <p>Hi Tim, thanks for those pointers, I&#39;m running a custom written sketch as I have 2 emontx&#39;s each with 3 CT&#39;s to monitor 3 pv systems and the house, and display all that info on the screen.</p>
<p>Because of the other emonGLCD issues with the jeelib library I had disabled all the transmit options of the RFM12B module, though of course it is (or isn&#39;t :) ) still receiving.</p>
<p>If in the meantime you get access to your sketch please post :)</p>
<p>Many Thanks, Gordon</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11706"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1189.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Avontech&#039;s picture" title="Avontech&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by <a href="../user/1189.html" title="View user profile.">Avontech</a> on Mon, 29/04/2013 - 20:55.</div>
    <div class="content">
     <p>That works!</p>
<p>I changed the sketch by the moving the rf12 command to the end of the setup section and added delays;</p>
<blockquote><p>delay(1000)&nbsp;<br />
		&nbsp; rf12_initialize(MYNODE, freq,group);<br />
		delay(1000)&nbsp;</p>
</blockquote>
<p>..</p>
<p>Many thanks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11709"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 29/04/2013 - 21:24.</div>
    <div class="content">
     <p>Thanks for the fix, I&#39;ve added it into the github&nbsp;examples in case this also effects other people. I&#39;ve never had this issue but the only side effect is a second or so longer boot up...we can live with that!&nbsp;</p>
<p>Cheers,</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11714"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="teepbee&#039;s picture" title="teepbee&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by teepbee (not verified) on Mon, 29/04/2013 - 23:12.</div>
    <div class="content">
     <p>Gordon that was exactly the change I made to the sketch so glad to see it improved matters for you also.&nbsp;</p>
<p>Would have replied earlier but I have been having fun with the nanodeRF_multinode_bulksend&nbsp;where a small(!) change has made it misbehave. :-(</p>
<p>Tim</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11724"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Tue, 30/04/2013 - 08:11.</div>
    <div class="content">
     <p><em>Thanks for the fix, I&#39;ve added it into the github examples in case this also effects other people. I&#39;ve never had this issue but the only side effect is a second or so longer boot up...we can live with that!</em></p>
<p>Oh dear, I was hoping we&rsquo;d all learned something from the &ldquo;emonGLCD &ndash; Not responding&rdquo; thread. This really isn&rsquo;t the way to fix problems. It&rsquo;s one thing to try something to get some more information about a problem but then you really need to find the root cause before incorporating the change as a permanent solution.</p>
<p>It may only be a couple of seconds delay now but if you apply this philosophy to all your problem solving you end up with slow, bloated code that nobody can improve because nobody really understands what it is doing in the first place.</p>
<p>OK, I&rsquo;ll get off my soapbox now :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-11735"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - EmonGLCD not restarting via USB power</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 30/04/2013 - 10:43.</div>
    <div class="content">
     <p>Can I join you - <strong>on</strong> the soapbox?&nbsp; Putting a delay in is fine if the <em>cause</em> of the problem is something not completing and there&#39;s no means of determining when it has, otherwise as you say it&#39;s messy and given time it will enter tribal memory and no-one will know the reason why it&#39;s there - and it will be retained even if the cause of the original problem is found and cured.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/1615"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-b7qhI9cmnNYLdvk-Qu6wOFy3KrbjvmNpblC4PEWuO0M" value="form-b7qhI9cmnNYLdvk-Qu6wOFy3KrbjvmNpblC4PEWuO0M"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/1615 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:37:33 GMT -->
</html>
