<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10162 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:49:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Feeding Hive data to emoncms | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Feeding Hive data to emoncms</h3>
        <span class="submitted">Submitted by <a href="../user/7530.html" title="View user profile.">MikeF</a> on Fri, 13/02/2015 - 09:00</span>
        <div class="content"><p>Hi,</p>
<p>I have a BG Hive Heating system, and I have a Python script (courtesy of davetaz on <a href="http://britishgashive.freeforums.org/automated-json-feed-retrieval-t7-10.html" title="http://britishgashive.freeforums.org/automated-json-feed-retrieval-t7-10.html">http://britishgashive.freeforums.org/automated-json-feed-retrieval-t7-10...</a>) which reads data from the Hive server and outputs it in JSON format to a daily file every 5 minutes (frequency is determined by cron, so can be made to run more often).</p>
<p>The feed consists of temperature data (inside, outside, target CH temperature), hot water schedule (on / off), and each entry is time-stamped.</p>
<p>I run this on my Mac, but as it&#39;s written in Python, it should also run on my Raspberry Pi which I use as my emonbase. I currently load each day&#39;s file (as a .csv) into Excel, and graph the above values.</p>
<p>Instead of writing data to a file, can the data be extracted as a live feed, and input to emoncms? If so, how?</p>
<p>Any help appreciated.</p>
<p>Mike</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10197.html" class="topic-previous" title="Go to previous forum topic">‹ Open Energy Monitor solution for radio support: Smart.</a>
              <a href="10187.html" class="topic-next" title="Go to next forum topic">Power monitor trouble-shooting ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-27665"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Feeding Hive data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 13/02/2015 - 11:43.</div>
    <div class="content">
     <p>This shouldn&#39;t be too difficult to implement. Are you running emonHub&nbsp;on the&nbsp;Pi?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27667"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7530.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MikeF&#039;s picture" title="MikeF&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Feeding Hive data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/7530.html" title="View user profile.">MikeF</a> on Fri, 13/02/2015 - 12:27.</div>
    <div class="content">
     <p>Paul,</p>
<p>Yes.</p>
<p>Mike</p>
<p><i>[Multiple copies of several posts have been deleted. Please observe the message when your post is held for moderation and be patient. Moderator (RW)]</i> </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27688"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Feeding Hive data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 13/02/2015 - 21:23.</div>
    <div class="content">
     <p>In-time a custom &quot;hive&quot; interfacer maybe possible but initially, I would recommend a little bridging script along similar lines to the script by davetaz and a couple of others I&nbsp;found.&nbsp;</p>
<p>By using a socket interfacer emonhub can open a port and listen for incoming data, this is recently discussed in a thread about&nbsp;<a href="10159.html">creating a custom script (for test purposes)&nbsp;</a>which references an earlier thread on <a href="6100.html">creating and&nbsp;using an&nbsp;EmonHubSocketInterfacer</a>&nbsp;</p>
<p>In emonhub.conf the [interfacers]&nbsp;section&nbsp;would require some settings like this added</p>
<p>[[Hive]]</p>
<p>&nbsp; &nbsp; Type = EmonHubSocketInterfacer</p>
<p>&nbsp; &nbsp; [[[init_settings]]]</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; port_nb = 50013 &nbsp; # for example</p>
<p>&nbsp; &nbsp; [[[runtimesettings]]]&nbsp;</p>
<p>and then a python script running on the same Pi could fetch the data every n&nbsp;secs and forward it to port 50013.</p>
<p>The benefits of using a separate script are mainly to keep the experimental dev away from the main emonhub&nbsp;service (at least until it&#39;s stable) and currently emonhub&#39;s interfacers all run in the main thread which means if the hive interfacer was integral to emonhub&nbsp;and the network or hive site was down,&nbsp;emonhub would get bogged down waiting and retrying to contact hive rather than getting on with other stuff (like normal running)&nbsp;</p>
<p>Can you post an example of your current csv output file?&nbsp;</p>
<p>I do not have access to a hive account but If you are willing to be a&nbsp;guinea pig and test my attempts I can try and&nbsp;something together for you should you need it, even if it just gets you started.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27692"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7530.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MikeF&#039;s picture" title="MikeF&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Feeding Hive data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/7530.html" title="View user profile.">MikeF</a> on Fri, 13/02/2015 - 23:41.</div>
    <div class="content">
     <p>Thanks, Paul, I&#39;ll take a look at those threads.</p>
<p>I recently came across this thread: <a href="1418.html">SOLVED: CurrentCost Monitor feed to EmonCMS</a>, where the Perl script appears to be inserting data into a feed by using the following code:</p>
<p>my $emon_ua = LWP::UserAgent-&gt;new;<br />
my $emon_url = &quot;http://localhost/emoncms3/api/post?apikey=$key\&amp;json={power:$watts,temp:$temp}&quot;;<br />
my $emon_response = $emon_ua-&gt;get($emon_url);</p>
<p>Would this work (with the 2nd line suitably amended)?</p>
<p>I&#39;ve attached a copy of a sample file (saved as xls, as csv attachments not allowed). Rows were added to this file by cron firing the python script every 30 minutes (this can obviously be done more frequently - every n secs). The columns I&#39;m interested in are target, inside and outside (temperatures); you&#39;ll see there&#39;s other stuff which I&#39;m not bothered with.</p>
<p>I&#39;ll be happy to test your attempts.</p>
<p>Mike</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27805"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Feeding Hive data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 17/02/2015 - 01:17.</div>
    <div class="content">
     <p>Sorry for a slow reply, I&#39;m not familiar enough to comment on the code you quote and linked, but having seen the data (i assume the original file is just text csv, can the file be saved as .txt?)</p>
<p>The values should be easy(ish) to pick out and put into a string for a&nbsp;socket listener.</p>
<p>I will have a closer look over the next couple of days.</p>
<p>I have started a <a href="10176.html">&quot;emonhub modules &quot;sandbox&quot;&quot;</a>&nbsp;thread to pull together some ideas on this type of thing, that you might find&nbsp;useful</p>
<p>Paul.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27830"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7530.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MikeF&#039;s picture" title="MikeF&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Feeding Hive data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/7530.html" title="View user profile.">MikeF</a> on Tue, 17/02/2015 - 17:57.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>I&#39;ve achieved what I wanted to, by following the emoncms API documentation.</p>
<p>I modified the python program that I identified in my original post<br />
- I use the Hive JSON feeds to obtain the data I&#39;m interested in: inside, outside and target (heating) temperatures<br />
- instead of writing these to a file, I post them to emoncms.org using the csv format, as follows:</p>
<p><a href="http://emoncms.org/input/post.json?node=10&amp;apikey=XXXXXXXXXXXXXX&amp;csv=18.5,7.5,20" title="http://emoncms.org/input/post.json?node=10&amp;apikey=XXXXXXXXXXXXXX&amp;csv=18.5,7.5,20">http://emoncms.org/input/post.json?node=10&amp;apikey=XXXXXXXXXXXXXX&amp;csv=18....</a></p>
<p>I now need to create feeds for these inputs, and set up a cron timer to run the python program every 60 secs.</p>
<p>I can post the python program if it would be useful to other people.</p>
<p>Thanks for your help.</p>
<p>Mike</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-27927"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7530.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MikeF&#039;s picture" title="MikeF&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Feeding Hive data to emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/7530.html" title="View user profile.">MikeF</a> on Thu, 19/02/2015 - 12:12.</div>
    <div class="content">
     <p>A bit more info on getting data from the Hive Active Heating system to emoncms:</p>
<p>There are a number of URLs available with Hive, which provide JSON feeds of heating and weather data. For example, this URL: <a href="https://my.hivehome.com/weather" title="https://my.hivehome.com/weather">https://my.hivehome.com/weather</a> returns the following at my location:</p>
<p>{&quot;inside&quot;:16.3,&quot;outside&quot;:8,&quot;weather&quot;:&quot;cloudy_with_light_rain&quot;,&quot;city&quot;:&quot;Princes Risborough&quot;,&quot;date&quot;:&quot;19/02/15 11:07&quot;,&quot;datetime&quot;:&quot;2015-02-19T11:07:08+0000&quot;}</p>
<p>(You have to be authenticated first to do this). More information on the JSON feeds is here:</p>
<p><a href="http://britishgashive.freeforums.org/automated-json-feed-retrieval-t7.html" title="http://britishgashive.freeforums.org/automated-json-feed-retrieval-t7.html">http://britishgashive.freeforums.org/automated-json-feed-retrieval-t7.html</a></p>
<p>I&#39;ve taken the python program produced by davetaz from the above thread, and modified it so that instead of saving data to a file per day every 5 minutes, it posts the data to emoncms via the emoncms API. I&#39;m sending inside, outside and target (heating) temperatures.</p>
<p>I&#39;ve attached the python program and a JSON config file<br />
- you need to enter your Hive username, password and emoncms API key in the config file<br />
- and enter the path to the config file towards the beginning of the python program.</p>
<p>I&#39;ve set up a cron job to run the python program every 60 seconds, and the data appears under node 10 on Inputs.</p>
<p>Please let me know if you have any queries with this.</p>
<p>Mike</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10162"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-51TqK9PpQgZVrsJjfWzTMx5H8h6xwMtvE3Rss9TFrSo" value="form-51TqK9PpQgZVrsJjfWzTMx5H8h6xwMtvE3Rss9TFrSo"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
