<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/567 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:34:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Strange network issue | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Strange network issue</h3>
        <span class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Fri, 06/04/2012 - 14:56</span>
        <div class="content"><p>I&#39;ve been posting data from my NanodeRF to emoncms for about a week now. &nbsp;Most of the time it seems to go great, but over the past couple of days the data update rate seemed to be slowing down. Finally found time to hook up to the PC and see the serial output this morning, and the data post was only succeeding&nbsp;once every 10 attempts. So I tried numerous things - added extra diagnostic output, changed to posting to a local server I have complete control over, added a few random delays - but nothing improved the situation. Nothing had changed, so what was going on? &nbsp;Internet and the site I was posting to was responsive, nothing looked wrong. However, the only thing I had not rebooted was my router. Doing so, the problem went away immediately. &nbsp;Data updates every 10 seconds. &nbsp; If my web browsing was slow, or I&#39;d seen other issues, then I&#39;d understand it, but everything else was fine.</p>
<p>I think one to look out for in the future and try and diagnose if it happens again.</p>
<p>(For the record, Netgear DG834GT running&nbsp;V1.03.22 - <a href="http://www.dgteam.tk/" target="_blank">DGTeam Rev. 1018</a>)</p>
<p>Lloyd</p>
  <div class="forum-topic-navigation clear-block">
          <a href="576.html" class="topic-previous" title="Go to previous forum topic">‹ Solar PV Monitoring System</a>
              <a href="577.html" class="topic-next" title="Go to next forum topic">CT Wire Size... ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-3724"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Mon, 09/04/2012 - 15:00.</div>
    <div class="content">
     <p>OK so this is definitely an issue for me. &nbsp;Have been doing a number of controlled experiments today including rebooting and changing power source on EmonBase, but the only thing that returned service to normal was rebooting the router. &nbsp;I have been capturing and graphing in emoncms the ethernet_request counter, and this clearly shows the system going into periods of unresponsiveness, in a very regular pattern. &nbsp;I had thought power could have been an issue, but I don;t think this is the case now - swapping over from usb to FTDI and the failure pattern continues.</p>
<p>I guess there is a chance that the change in my external ip has had an impact, but I don&#39;t think this is the case. &nbsp;If I do a manual data post from my PC whilst the emonbase is struggling, it responds with an OK immediately. &nbsp;</p>
<p>Not sure where to go next. &nbsp;I may try a wireshark capture if I can obtain a hub, but doubt that will be until Wednesday evening.</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3733"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/905.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="robw&#039;s picture" title="robw&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/905.html" title="View user profile.">robw</a> on Mon, 09/04/2012 - 18:53.</div>
    <div class="content">
     <p>Have you got any stats from the router..&nbsp;</p>
<p>It sounds like its keeping open all the connections from the NanodeRF and not closing them.</p>
<p>Im using dd-wrt on my router and am showing 21 open connections from the base to CMS system its been running now for over a week and not showing any problems. Iv seem problems with home routers in the past with the number of connections they can keep open before they just grind to a halt so this sounds right. See if your router has an option to show &quot;number of active connections&quot; or something similar sorry im not up to date on your firmware and it looks like the dd-wrt does not work on yours.</p>
<p>This may all be a wild goose chase but i would look at the router.</p>
<p>Rob</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3743"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="wiz2003&#039;s picture" title="wiz2003&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by wiz2003 (not verified) on Tue, 10/04/2012 - 07:48.</div>
    <div class="content">
     <p>I had terrible problems initially and even ordered a complete nanode kit...</p>
<p>Have replaced Virgin SuperHub&nbsp;with a Netgear&nbsp;WNDR3800 and the situation is MUCH improved....</p>
<p>But, the nanode regularly loses connectivity, resets and resets and then magically starts working again....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3754"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Tue, 10/04/2012 - 17:55.</div>
    <div class="content">
     <p>I thought I may have stumbled across something in the ethercard library. &nbsp;A change was made in December that the author was unsure of, so provided instructions on how to reverse it. &nbsp;Unfortunately, this actually made matters worse. &nbsp;So there&#39;s another theory down the drain.</p>
<p>What was interesting was the way the serial output differed when running the different versions of the library, which I didn&#39;t expect. &nbsp;Normally I see multiple lines returned for each post (as in attached image). With the modified library (ie with the suspect change reversed), I only see one line, the one with date/time on.</p>
<p>Can someone who uses a fairly standard emoncms post their serial output?</p>
<p>Thanks</p>
<p>Lloyd&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3767"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Wed, 11/04/2012 - 12:26.</div>
    <div class="content">
     <p><a href="http://forum.jeelabs.net/node/987">Here </a>is an interesting post form the&nbsp;jeelabs.net&nbsp;forum (<strong>Consecutive calls to ethercard.browseUrl corrupt&nbsp;previous calls?).&nbsp;&nbsp;</strong>May&nbsp;not be the issue here&nbsp;(who knows at the moment), but certainly&nbsp;worth being aware of.</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3771"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 11/04/2012 - 21:52.</div>
    <div class="content">
     <p>You can stop emoncms sending full multi line theme html by adding .json to the api call:</p>
<p>http://vis.openenergymonitor.org/emoncms3/api/post<strong>.json</strong>?apikey=0489a48f8498db5798fdd66842785a95&amp;json={power:252.4,temperature:15.4}</p>
<p>I will add that to the emoncms account page.</p>
<p>Interesting detective work on the routers, I have been logging the number of failed requests and watchdog resets that I get over the last &nbsp;month and a half. About 6500 failed requests where it managed to reconnect without a reset and 500 resets, a reset is forced if it fails to connect after 10 attempts so this could be another 5000 requests in 42 days = 11-22 failed requests an hour. I post once every 5 seconds so that&#39;s 12 out of 720 posts an hour that fail a 1.7% failure rate.&nbsp;</p>
<p><a href="../sites/default/files/reqrstplot.png"><img alt="" src="../sites/default/files/reqrstplot.png" style="width: 300px; height: 163px; " /></a></p>
<p>When i started logging request failures and resets I noticed that the steeper gradients related to times when I had more than the usual 2 nanodeRF&#39;s connected, I haven&#39;t&nbsp;been looking at it in detail recently, Id like to do more tests to confirm that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3772"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Wed, 11/04/2012 - 22:07.</div>
    <div class="content">
     <p>Thanks for the info on the http call. I had noticed both options in use, and had wondered what the difference was. Will make a change tomorrow and see what impact that has.</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3792"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Thu, 12/04/2012 - 17:31.</div>
    <div class="content">
     <p>A quick update as time is rather short tonight.</p>
<p>I&#39;ve run with .json added to the api call today, and strangely, it is a lot less reliable. Not what I expected at all. &nbsp;The positive news is that I have a number of wireshark captures that occur at the precise moment of failure. &nbsp;The correlation is very high (one to one) between a failed transmit and wireshark complaining about the tcp packets. &nbsp;I don&#39;t have time now, but will analyse&nbsp;more over the next day or two and post my findings.</p>
<p>I&#39;m now running without the .json, to try and capture some problems there. &nbsp;At the moment I&#39;m not seeing the errors in the data that I was seeing with .json in the call, bit it may be a matter of time. (I reset my router when making the change so the test is fair).</p>
<p>&nbsp;</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3796"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 12/04/2012 - 20:34.</div>
    <div class="content">
     <p>Wow that&#39;s interesting, would be really good to know why that is happening, not what I expected either!&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3798"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Thu, 12/04/2012 - 21:33.</div>
    <div class="content">
     <p>for interest, here is a graph that shows how marked the difference is. &nbsp;At the first indicated point on the graph I changed the call to include .json, and then removed it at the second. &nbsp;At each point I also rebooted the router. (To exaggerate&nbsp;the issue I display -1 if the value is zero.)</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3808"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 13/04/2012 - 11:36.</div>
    <div class="content">
     <p>That is quite a difference, I will do some tests here to see if I can replicate the effects.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3809"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Fri, 13/04/2012 - 12:46.</div>
    <div class="content">
     <p>Here is some&nbsp;output form&nbsp;Wireshark.&nbsp;&nbsp;The&nbsp;top half of the page is a good&nbsp;request, the lower half a bad one.&nbsp;&nbsp; The issue would appear to be the data packet being sent (or at least received)&nbsp;out of sequence, which I believe is a&nbsp;fairly standard thing and so should be handled.&nbsp;Is the ethercard&nbsp;library not handling this&nbsp;out of sequence packet in the correct&nbsp;way?&nbsp;&nbsp;&nbsp;I&#39;m not a TCP&nbsp;expert, so if anyone else would&nbsp;care to comment....</p>
<p>&nbsp;Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3819"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="wiz2003&#039;s picture" title="wiz2003&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by wiz2003 (not verified) on Sat, 14/04/2012 - 12:47.</div>
    <div class="content">
     <p>Packets arriving out of sequence is common and should be catered for in any tcpip stack...</p>
<p>My nanode is fairly stable - I have changed the timeout to 5 attempts..</p>
<p>I will use a packet sniffer when i get a mo - I was concentrating on changing the time from emoncms3 to the nanode, which is in GMT....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3820"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/783.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-783.gif" alt="Lloyd&#039;s picture" title="Lloyd&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Strange network issue</h3>

    <div class="submitted">Submitted by <a href="../user/783.html" title="View user profile.">Lloyd</a> on Sat, 14/04/2012 - 09:17.</div>
    <div class="content">
     <p>I think I&#39;ll post this on the jeelabs forums.</p>
<p>Lloyd</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/567"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-O2vVnI7WWKW4q5N5XnnfGMwsUKMNE1KCCZ5wsASxxdo" value="form-O2vVnI7WWKW4q5N5XnnfGMwsUKMNE1KCCZ5wsASxxdo"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
