<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3154 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:06:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Dual Solar PV Diverter - With Completed Write-up | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Dual Solar PV Diverter - With Completed Write-up</h3>
        <span class="submitted">Submitted by Guest on Fri, 08/11/2013 - 21:41</span>
        <div class="content"><p>I installed 4kW&nbsp;PV two years back with another 3kW being installed next week. Until now I have used a 1-2 kW fan heater to &#39;sweep up&#39; spare generation, hardly ideal.</p>
<p>A couple of weeks back I looked for commercial offerings for diverting &#39;spare&#39; generation into the hot water cylinder and/or electric heating - at the same time if sun comes out. What I wanted was a fully automatic, dual-proportional diverter to heat water and heating with the option to &#39;bypass&#39; the unit (automatically) to top-up overnight on Economy 7 if needed. Above all it has to look after itself and get on with the job on its own.</p>
<p>Obviously there are commercial options out there, but exactly what I&#39;m looking for? Not sure. Thinking I could get out the test kit (see profile picture) and put something together, someone will have built something... Welcome to the&nbsp;OpenEnergyMonitor Forum!</p>
<p>I have an ancient Electricity Council metering CT - many years ago I built an electronic integrating meter with clockwork Economy&nbsp;7 timer long before electronic meters became the norm. Unfortunately I have just the one CT though it designed for and ideal for purpose. Calypso_Rae&#39;s design appealed; its simplicity, focus on diverting power rather than gismos and gadgets, and what an opportunity to get back into writing some code too. Thanks Robin - your guidance and articles are the foundations upon which I have built my Dual Diverter.</p>
<p>The diverter is designed and built to handle up to 6-7kW so as to match the new PV. It offers two independent proportionally controlled outputs one each for hot water and heating. The heating can deliver the total generation of 6-7kW&nbsp;if needed. The diverter benefits from a front panel switch to select water or heating priority, the theory being overnight water heating at 6p / kWh is cheaper than burning heating oil when the sun is out at about 7p&nbsp;/kWh equivalent. The diverter switches to &#39;bypass&#39; to water only from an external clock, the input being a logical true/false, 5/0V. A suite of LEDs&nbsp;display diverter status: Healthy, Net Import, Net Export (PV Surplus), Heating, Water, Bypass/fault, Heating Priority. A test push-button completes the front panel.</p>
<p>The circuit is based on Robin&#39;s design (thanks again Robin!) although I have used a resistor divider with isolation capacitors for mains voltage monitoring. The output from capacitors drives the second half of the voltage reference (Vref) op-amp, a surface-mount TS912 soldered on to legs plugged into an 8-pin dual IC socket - needs must. Power for the Arduino and op-amp is derived from an old RS 6V 6VA miniature transformer with just a 1A bridge rectifier and decoupled 4700uF at 10V&nbsp;electrolytic. Two separate opto isolators interface the Arduino digital outputs with the gates on the triacs. The optos are mounted on a separate piece of Veroboard mounted inside the box away from the main electronics, and my fingers!</p>
<p>The diverter is supplied by 4mm&nbsp;twin and earth fed from a dedicated 32A MCB in the consumer unit. The mains voltage monitor, although currently connected within the diverter box, can be fed from a remote monitoring point within the consumer unit. I have built a simple terminal box mounted adjacent to the consumer unit to terminate the CT and remote voltage monitoring, it includes a CT short such the diverter can be disconnected safely should the need arise without removing the CT (solid core, by the way). I pulled in a couple of miniature twin mains cables along side the 4mm twin.</p>
<p>The diverter is (will be tomorrow) mounted beneath a 45A cooker isolator switch in the airing cupboard, about 4m electrically from the consumer unit. A socket next to diverter supports the immersion heater, a dual socket on the other side of the airing cupboard wall in the lounge, the heating.</p>
<p>Two pieces of code are the mainstays of the diverter. The &#39;Analogue Input Calibrator&#39; is essential for calibrating the voltage reference (Vref), the main voltage (MainsV) and mains current balance in the feed from the supply meter into the consumer unit (MainsI). Mean and RMS calculations are included for all (4-off) analogue inputs.The forth analogue input monitors the bypass control input.</p>
<p>The &#39;PV Freerun DualRouter&#39; is the body of code running the diverter. In summary it samples as per Robin&#39;s code on the positive half cycle, a while loop ensure as many measurements as possible are taken throughout every positive half-cycle. Tests show consistent measurement rates of 38-40 samples per half-cycle, should be enough. No power factor correction has been included as I could measure no perceivable phase shift on the scope when monitoring the mains voltage and current samples into the Arduino analogue inputs. Four integrators are employed to measure accumulated energy for triggering the water and heating triacs, plus to light the net import and export leds. A fifth integrator is effectively a total export integrator from which, in principal, the three export integrators are loaded and flushed out. All peripheral activities such as integrator logic, front panel switch monitoring and processing, led and triac firing, etc, etc is handled within the negative half-cycle, and to date I believe there is plenty more processor capacity to support future updates.</p>
<p>I have tested extensively (on the dining table for the past 8 days) using a 18V 32A transformer (yes, it&#39;s heavy!) fed be a Variac into a couple of good old-fashioned AVOs, a couple 3.5 digit Fluke hand-helds, a 6.5 digit Philips DVM&nbsp;with True RMS capability, a 4.5 digit hand-held with True RMS capability, the Tektronix scope, and 3 ancient very high current reostats - but hey, they work brilliantly and get very hot. A rheostat mimics each of domestic load, PV generation, and diverter load. Once I was happy the unit was working as expected, I have tested with 60 &amp;&nbsp;100W lamp bulbs - again with multiple&nbsp;turns on the CT to mimic heavier loads - a toaster rated at about 1500W, and a kettle at 2500-3000W. I had thought of using a second kettle, but then the 13A&nbsp;extension would likely catch fire.</p>
<p>I will write up more detail on the circuit design, build, and code in the next few days, I&#39;ll take and upload some photos too. I wonder how much interest there is in my design and if it may prove helpful for others? I&#39;ve ideas for future enhancements and am particularly keen to implement &#39;anti-flicker&#39;, and if practical, accurate metering. I have a couple of 40:5A CTs (not ideal, but workable) for monitoring the water and heating feeds, from which one can derive generation with three of the four connections into the diverter being monitored.</p>
<p>And finally, most everything but the Arduino board, opto-isolatos and triacs was taken from a pile of bits and pieces in the loft, so a cost-effective and fun project, albeit I have been fulltime day (and night) on the case the past week.</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3232.html" class="topic-previous" title="Go to previous forum topic">‹ V3 pre assembled shop query</a>
              <a href="3236.html" class="topic-next" title="Go to next forum topic">EmonTX: Understanding inputs and outputs ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-16250"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Dual Solar PV Diverter - With Completed Write-up</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 10/11/2013 - 16:57.</div>
    <div class="content">
     <p>Sounds complicated, glad to hear that the Mk2 design has been of use.</p>
<p>Let me know if you need any <a href="2857.html">heatsinks</a> :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16252"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andrewcee&#039;s picture" title="Andrewcee&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Dual Solar PV Diverter - With Completed Write-up</h3>

    <div class="submitted">Submitted by Andrewcee (not verified) on Sun, 10/11/2013 - 22:28.</div>
    <div class="content">
     <p>Hi Robin, All built, tested &amp; installed working perfectly. Am fitting another 3.5kW solar next couple days but will write up my design &amp; publish for anyone interested. Will be a big money saver for sure. Production release as installed has testing built in, power factor / phase correction, anti-flicker which is excellent, self-checking of reference voltage, heating and water priority selection, automatic Economy 7 water heating bypass - think that&#39;s it! Burnt no oil today... Thanks for posting all your work, perfect for getting me started.</p>
<p>Project reminded me of my time calibrating induction disk meters, acceptance testing of power station plant, although perhaps my biggest claim to fame was testing and commissioning all the control panel metering, AC tariff metering &amp; DC metering at the French DC Link at Sellindge, Kent.</p>
<p>Got my dining table back today.</p>
<p>Cheers, Andrew</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16261"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4067.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4067.jpg" alt="stevenma&#039;s picture" title="stevenma&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Dual Solar PV Diverter - With Completed Write-up</h3>

    <div class="submitted">Submitted by <a href="../user/4067.html" title="View user profile.">stevenma</a> on Mon, 11/11/2013 - 13:47.</div>
    <div class="content">
     <p>Hello Andrew,</p>
<p>I am looking forward to seeing your project&#39;s code and hardware details.</p>
<p>I have very recently installed 21.84kWp of PV at our office building in the North West. &nbsp;It comprises 24 ~south facing&nbsp;260W panels with an 8kW&nbsp;SolarMax 8MT2 inverter and 60 ~west facing 260W panels with a 15MT2 inverter. &nbsp;Currently we are using everything we generate during weekdays but export a little at weekends. &nbsp;My plan is to use that spare energy to heat one or both of our two 6kW&nbsp;Heatrae type water heaters used for toilet hand washing. &nbsp;They seem to be quite well insulated so even if the hot water isn&#39;t used over the weekend at least it&#39;s pre-heated for Monday. &nbsp;At the moment I&#39;ve set the BMS timer to turn these on at the weekend&nbsp;to help use the spare energy. &nbsp;I&#39;ve also considered turning on a heater to pre-heat one of the colder offices at the weekend.</p>
<p>We consume 180 - 260kWhrs&nbsp;each 24hr weekday, around 60kWhrs&nbsp;on each weekend day and have a lower overnight (Economy 7) tariff which I currently use to turn the water heaters on for 30mins then off until the business day starts.</p>
<p>Our base load of up to 3.3kWhrs is quite high and work constantly to get this down but in addition to alarm &amp; CCTV systems, BMS, IT equipment there are probably a lot of PCs, printers, phone chargers and the like on standby.</p>
<p>A Belgian friend of mine has, in his new build, high-spec home, an &#39;All-Off&#39; switch by the back door which turns of everything except the essentials; exit / entrance lighting, security, fridge, freezer, TV set top box, clocks etc. &nbsp;It would be good to see that implemented in new home and office builds more generally here.</p>
<p>I also have a 4kW system Sanyo panel and SMA system installed at home and am in the process of implementing emoncms&nbsp;there too. &nbsp;I currently upload the SMA inverter stats to pvoutput.org using a Raspberry Pi.</p>
<p>I look forward to seeing the details of your system in due course.</p>
<p>Regards,</p>
<p>Steve</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16335"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andrewcee&#039;s picture" title="Andrewcee&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Dual Solar PV Diverter - With Completed Write-up</h3>

    <div class="submitted">Submitted by Andrewcee (not verified) on Fri, 15/11/2013 - 21:24.</div>
    <div class="content">
     <p>Hello Steve, Not forgotten, been unwell, although hope to get back to it next week. I&#39;ve attached my latest code releases however, for calibrating the analogue inputs and the PV Diverter. All have been extensively tested, although there may be one or two little funnies still to unravel. Any comments re improvements, eg. implementing a real-time clock, much appreciated.</p>
<p>Cheers, Andrew</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16356"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andrewcee&#039;s picture" title="Andrewcee&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Dual Solar PV Diverter - With Completed Write-up</h3>

    <div class="submitted">Submitted by Andrewcee (not verified) on Mon, 18/11/2013 - 14:40.</div>
    <div class="content">
     <p>Write-up on the way, improved code ....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16401"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andrewcee&#039;s picture" title="Andrewcee&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Dual Solar PV Diverter - With Completed Write-up</h3>

    <div class="submitted">Submitted by Andrewcee (not verified) on Thu, 21/11/2013 - 22:42.</div>
    <div class="content">
     <p>First Draft of write-up. Pictures and circuit diagram to follow .....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16507"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Andrewcee&#039;s picture" title="Andrewcee&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Dual Solar PV Diverter - With Completed Write-up</h3>

    <div class="submitted">Submitted by Andrewcee (not verified) on Fri, 29/11/2013 - 15:48.</div>
    <div class="content">
     <p>Write-up complete... !!!!</p>
<p>Includes pictures and circuit diagram.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3154"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-SG4g0pwl8EDZHRcXTfHADIoiZJXVIwFuhWzYZxah8mA" value="form-SG4g0pwl8EDZHRcXTfHADIoiZJXVIwFuhWzYZxah8mA"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
