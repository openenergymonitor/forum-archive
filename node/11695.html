<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11695 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:43:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Low-write mode - your thoughts please | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Low-write mode - your thoughts please</h3>
        <span class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Fri, 27/11/2015 - 17:43</span>
        <div class="content"><p>The OEM team have been discussing the v9 low-write mode, and trying to decide how best to protect SD cards from fatigue and early failure.</p>
<p>To put this in perspective, a v9 standard installation with 7 or 8 feeds produces a SD card data &#39;write&#39; figure of about 9kB/s, whilst if &#39;low-write&#39; mode is activated with default settings this drops to less than 6kB/s. By stopping Redis, emoncms&nbsp;&amp; apache&nbsp;logging, plus increasing the write buffer to 600 seconds (instead of 60) the&nbsp;SD card data &#39;write&#39; figure drops dramatically down to about 500 B/s.</p>
<p>In the previous version of emoncms, the low-write version <a href="https://github.com/emoncms/emoncms/blob/low-write/docs/install.md">made further changes</a> to protect the SD card, by not only switching off the logs, redirecting other less intrusive logs to a tmpfs&nbsp;(held in RAM), and also further partitioned the SD card putting the operating system in &#39;read only&#39;.<br />
Advantages to applying the same protection in v9 are that it provides the best possible option to long term protect SD cards from fatigue and unexpected power failure corruption, and has been proven to work well in the previous version.</p>
<p>However, the downside is that it&nbsp;would add significantly to the build guide and introduce opportunities for mistakes to be made during installation, or deter people due to the added complexities. Also, especially now as IoT expands, people are using complementary software such as node-red, Mosquitto, MQTTwarn&nbsp;etc, alongside emoncms, and just question how they would co-exist in a read only environment.</p>
<p>We would value your thoughts on this please.</p>
<p>Paul</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11859.html" class="topic-previous" title="Go to previous forum topic">‹ New Nodes module / what do I do wrong</a>
              <a href="11850.html" class="topic-next" title="Go to next forum topic">Calibration 3-phase ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-36387"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Fri, 27/11/2015 - 20:19.</div>
    <div class="content">
     <p>I abandoned low-write long ago in favour&nbsp;of a HDD solution with the extra flexibility that brings, I also use the MySQL engine for all my feeds, again for the extra facilities that allows. I&nbsp;have experienced a number of SD card corruption events but only 1 whilst using a HDD based Emoncms which was due to a power outage that incidentally also took out 2 windows PCs and their HDDs.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36396"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sat, 28/11/2015 - 07:50.</div>
    <div class="content">
     <p>Another HDD user. Never had an SD card corruption but then I&#39;ve always used an HDD.</p>
<p>Of course it&#39;s a bit more expensive as a solution both in terms of hardware and power requirements but for me a theoretically more stable solution. I say theoretically because I&#39;ve just switched from an old pi with rfm12 to a pi2 with rfm69 and it&#39;s much flakier. While we were away recently the system just stopped receiving data from my emonTX. It was still receiving data from an esp8266 via WiFi though. And I&#39;ve noticed that if I reboot the router that the pi doesn&#39;t reconnect. So will have to track down what&#39;s going on. I&#39;m on V9 rc2 and its not a power issue as I have purchased a recommended USB hub.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36397"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sat, 28/11/2015 - 08:20.</div>
    <div class="content">
     <p>I switched to an HD when my first SD card died (after only 3 months). I use a Toshiba 320GB 2.5 inch drive that draws 0.8W at idle, 2.5W max at spin up, and 1.5W during r/w ops. (drive is powered from a hub) I run it 24/7 and it&#39;s been rock solid for almost 3 years. As Paul mentioned in a post a couple of years ago (if memory serves!), one of the added bennies is a file server to store stuff on.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36398"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 28/11/2015 - 09:10.</div>
    <div class="content">
     <p>I think that we are all agreed that running emoncms on a HDD is the best solution, but we still have to cater for users who wish to run emoncms&nbsp;on a SD card in low-write mode.</p>
<p>I&#39;m trying to establish the pros &amp; cons of making the OS read only, and balancing the obvious benefits against the points described in the first post above.</p>
<p>When power is unexpectedly removed we know that disk corruption occurs only when the OS is writing to the disk, so if we can reduce disk writing to a absolute minimum, is there then any need to make it read only? If nothing is being written, would there be any benefits?</p>
<p>It could be considered &#39;belt &amp; braces&#39; but I&#39;m trying to balance that against the points made in my first post.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36425"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sun, 29/11/2015 - 05:09.</div>
    <div class="content">
     <p><em>so if we can reduce disk writing to a absolute minimum, is there then any need to make it read only?</em></p>
<p>There might be. Unless we know for <em>certain</em> there are no writes to the drive, i.e. we&#39;re in r/o mode, the OS will make occasional writes to take care of routine things like file and dir atime, inode table maintenance, etc. Granted, the frequency of those writes will likely be quite low, but the chance for data corruption still exists. Reads and writes from/to the drive can be monitored with: cat /proc/diskstats.&nbsp; <strong><em><u><a href="https://tipstricks.itmatrix.eu/procdiskstats-line-format/">Here&#39;s</a></u></em></strong> how the 11 columns break down.</p>
<p><em>It could be considered &#39;belt &amp; braces&#39; </em></p>
<p>Nothing wrong with that. Given some users have systems located in remote, or distant locations, erring on the safe side would be the prudent thing to do.</p>
<p><em>node-red, Mosquitto, MQTTwarn&nbsp;etc, alongside emoncms, and just question how they would co-exist in a read </em><em>only environment.</em></p>
<p>It would seem the current method of switching from r/o to r/w, and back, would be the easiest solution, provided those apps can exist in a read-only environment once configured.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36436"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sun, 29/11/2015 - 11:34.</div>
    <div class="content">
     <p>I agree with most of that Bill, but it still leaves the two main issue which I raised; the added complexity for users building the system (creating partitions etc), and compatibility with other software. And trying to &#39;balance&#39; those two issues against creating a &#39;belt &amp; braces&#39; stable system.</p>
<p>I was hoping to find a compromise by leaving the system in RW and taking disk writes to an absolute minimum&nbsp;by directing&nbsp;the /var/log &amp; /tmp&nbsp;to&nbsp;tmpfs, so any log/housekeeping writes are held in RAM, but I&#39;m struggling with the Ext4&nbsp;jbd2 journal, which every few seconds writes a chunk of about 7kB to disk.<br />
I&#39;m in the process&nbsp;of&nbsp;trying to&nbsp;disable the root journal using the tune2fs&nbsp;&#39;has_journal&#39; function, and am almost there.</p>
<p>If this could be achieved, I believe that the &#39;balance&#39; would shift towards leaving the OS in RW.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36447"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Sun, 29/11/2015 - 18:56.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Here&#39;s some insight on running ext4 with a minimum of idle disk writes:</p>
<p><a href="http://unix.stackexchange.com/questions/96517/minimizing-idle-writes-on-a-file-system">unix.stackexchange.com/questions/96517/minimizing-idle-writes-on-a-file-system</a></p>
<p><a href="http://fenidik.blogspot.com/2010/03/ext4-disable-journal.html">fenidik.blogspot.com/2010/03/ext4-disable-journal.html</a></p>
<p>All else failing, you could use ext2.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36448"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sun, 29/11/2015 - 19:02.</div>
    <div class="content">
     <p>Cheers Bill, I&#39;ve now disabled the journal which has made a big difference.<br />
The only other thing I&#39;ve got writing to disk, albeit every 15 - 30 seconds or so is;</p>
<p><img alt="" src="../sites/default/files/rsz_565b344addb52.png" style="width: 673px; height: 115px;" /></p>
<p>The command is apache2 -k start, which writes about 3 kB. Stopping apache does stop the disk writes.</p>
<p>If I follow the PID id number, it points to&nbsp;/usr/lib/apache2/mpm-prefork/apache2</p>
<p>Any ideas?</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36465"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8729.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Peter Galbavy&#039;s picture" title="Peter Galbavy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/8729.html" title="View user profile.">Peter Galbavy</a> on Mon, 30/11/2015 - 12:07.</div>
    <div class="content">
     <p>Would a compromise of recommending a USB flash key a storage help? The benefits of an externally exchangeable data-store, no writes to the internal OS SD card and cheap as chips to procure and to replace and maybe recommend keeping the old one as a data backup?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36466"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 30/11/2015 - 12:27.</div>
    <div class="content">
     <p>Thanks Peter, however the data writes aren't that much of an issue, as we can control that by increasing the feed write time in emoncms. It's the disk writes from the OS, apache, redis etc. that we need to control.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36468"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 30/11/2015 - 13:02.</div>
    <div class="content">
     <p>Thanks Paul for starting this thread. Both Glyn and I use SD cards for all our logging Im happy now with their reliability and the added benefit of a cheaper and neater install, plus small reduction in power consumption is nice.</p>
<p>On the subject of filesystem types, the ext2 filesystem with a blocksize of 1024 bytes rather than 4096 bytes is currently used on the SD cards for the data partition. I wrote this note at the time:</p>
<p><a href="https://github.com/emoncms/emoncms/blob/low-write/docs/install.md" title="https://github.com/emoncms/emoncms/blob/low-write/docs/install.md">https://github.com/emoncms/emoncms/blob/low-write/docs/install.md</a></p>
<p><em>&quot;We create here an ext2 filesystem with a blocksize of 1024 bytes instead of the default 4096 bytes. A lower block size results in significant write load reduction when using an application like emoncms that only makes small but frequent and across many files updates to disk. Ext2 is choosen because it supports multiple linux user ownership options which are needed for the mysql data folder. Ext2 is non-journaling which reduces the write load a little although it may make data recovery harder vs Ext4, The data disk size is small however and the downtime from running fsck is perhaps less critical.&quot;</em></p>
<p>The write load investigation I did here compared a 512 byte block vFAT filesystem with a 4096 byte block ext4 system. <a href="https://github.com/openenergymonitor/documentation/blob/master/BuildingBlocks/TimeSeries/writeloadinvestigation.md" title="https://github.com/openenergymonitor/documentation/blob/master/BuildingBlocks/TimeSeries/writeloadinvestigation.md">https://github.com/openenergymonitor/documentation/blob/master/BuildingB...</a>. The ext4 filesystem had a write load of around 8x the vFAT load. Every 4 byte datapoint write results in two blocks of write load one block for the inode and one for the data. A 512 byte block filesystem results in 1024 bytes per update where the data size to be updated is less than 512 bytes (even if its 4 bytes). A 4096 byte block filesystem results in 8192 bytes being written even if the update is only 4 bytes.</p>
<p>Buffering brings the data size to be written to disk closer to the block size. But even 10 minutes of 10s data (per feed file) is only 240 bytes, ~23% of 1024, 5.8% of 4096. So using the smaller block size can still provide a large contribution to reducing write load.</p>
<p>Im quite keen to err on the safe side in terms of keeping a read-only image for the operating system but I am open to the fully writable partition option if we feel the benefits are marginal.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36471"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/450.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="stuart&#039;s picture" title="stuart&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/450.html" title="View user profile.">stuart</a> on Mon, 30/11/2015 - 13:59.</div>
    <div class="content">
     <p>I also use the low write SD card version and also like the read&nbsp;only file system.</p>
<p>Even if the card does have bad blocks, the file system will still boot and the system recovered.</p>
<p>I replicate the data into a cloud backup, so if the card goes bad, I swap it and restore (not happened yet).</p>
<p>I also like there are no moving parts - although SSD&#39;s are very cheap now.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36472"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Mon, 30/11/2015 - 15:29.</div>
    <div class="content">
     <p>Trystan, I thought SDs have 4KB erase block size, meaning if you use 1KB size it will write a SD block 4 times in worst case, where it would only need to write one if partition block size is correct.</p>
<p>Then I saw this link <a href="https://wiki.linaro.org/WorkingGroups/KernelArchived/Projects/FlashCardSurvey" title="https://wiki.linaro.org/WorkingGroups/KernelArchived/Projects/FlashCardSurvey">https://wiki.linaro.org/WorkingGroups/KernelArchived/Projects/FlashCardS...</a> that says block size can be different for different memories sizes and brands. Many diferences now a day.</p>
<p>Also check: <a href="https://wiki.gentoo.org/wiki/SDCard">https://wiki.gentoo.org/wiki/SDCard</a></p>
<p>Dont forget partition should be aligned to SD blocks boundaries.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36473"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Mon, 30/11/2015 - 14:26.</div>
    <div class="content">
     <p><em>If I follow the PID id number, it points to&nbsp;/usr/lib/apache2/mpm-prefork/apache2</em></p>
<p><em>Any ideas?</em></p>
<p>Paul,</p>
<p>I&#39;m still looking to see if there&#39;s a way to redirect those writes to a tmpfs mounted directory.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36477"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 30/11/2015 - 15:43.</div>
    <div class="content">
     <p>Thankyou Chaveiro, I was not aware of that. I will have a good read of the articles, it sounds like I was mistaken.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36483"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 30/11/2015 - 18:19.</div>
    <div class="content">
     <p>I&#39;ve <a href="https://youtu.be/8j0cbmvhAZo">done a video update</a> so that you can see the amount of data that emoncms&nbsp;in low-write mode actually writes to disk.<br />
It&#39;s a standard v9 installation with the following changes which are very easy to implement;</p>
<ul>
<li>Run in low-write mode</li>
<li>Error &amp; user logs disabled</li>
<li>Ext4&nbsp;journal disabled</li>
<li>2 directories moved&nbsp;into&nbsp;tmpfs&nbsp;(RAM)</li>
</ul>
<p>​The filesystem&nbsp;is still in RW, which allows companion software to run (although this should be discouraged), and also from a&nbsp;user perspective, there is no requirement to shrink/create&nbsp;volumes, etc during installation - keeping it simple.</p>
<p>Of the frequency that&nbsp;data that is written to disk, you would be very unlucky to have a power failure at that precise time, and cause a disk corruption, also the amount of data written is unlikely to cause disk fatigue.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36484"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Mon, 30/11/2015 - 18:25.</div>
    <div class="content">
     <p><em>The command is apache2 -k start, which writes about 3 kB. Stopping apache does stop the disk writes.</em></p>
<p>The only thing I have been able to find about the -k switch says:<br />
&quot;The -k option is used to run Apache as a service on Windows and takes a command as an argument.&quot;<br />
(I got curious as to <em>why</em> -k wasn&#39;t listed as an option on the Apache man page)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36485"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 30/11/2015 - 20:32.</div>
    <div class="content">
     <p>Thanks Bill, I suppose this raises another question, presumably apache&nbsp;is writing this data for a reason, if so, and the OS is mounted RO, what is the detrimental effect of not being able to write&nbsp;it?&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36486"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Mon, 30/11/2015 - 20:35.</div>
    <div class="content">
     <p>I run the EMONPI&nbsp;image on a Pi2 alongside Openhab and appreciate the reliability the mainly read only file system brings as well as the ability to pull the SD card and switch to another in the rare event I&#39;m trying something out. I&#39;ve kept away from adding&nbsp;a hard disk as I don&#39;t want to add in an extra enclosure or layer of complication. I run a 32GB&nbsp;Sandisk Extreme SSD with plenty of free space as I&#39;m relying on wear leveling to keep my 42 feeds alive for many months to come.</p>
<p>Having a large portion of the OS read only has meant everything came back OK after&nbsp;a couple of unexpected power cuts. Unfortunately a combination of largely overhead power lines, big trees and large storms makes my installation vulnerable to sudden power loss, and I&#39;d rather not spend the morning after frantically googling to see whether it can be brought back to life by swapping the card into one of my&nbsp;Windows Machines</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36490"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Mon, 30/11/2015 - 23:45.</div>
    <div class="content">
     <p>Hi Kevin, you may recall that historically, &#39;emoncms&#39; had a number of variants, which over the past 6 months has distilled to a single version, with options in the &#39;settings&#39; to change the way emoncms&nbsp;functions; low-write/full write, MQTT, etc. but all variants now start with a standard install, which&nbsp;can be changed at a later time.<br />
For example; as a new starter to emoncms, you install v9 emoncms&nbsp;with the low-write option (as the&nbsp;OS is on a SD card), but later buy a USB HDD and change to full-write, add MQTT, Node-red,&nbsp;maybe a blog, media server, etc. you are able to&nbsp;upgrade/degrade without making major changes. Other advantages are that one version is much easier to maintain, develop &amp; support, and combining functionality&nbsp;is&nbsp;more energy efficient.&nbsp;</p>
<p>There will always be disk-writes to the SD card, as the emoncms data needs to be stored, but what is the difference between a filesystem&nbsp;that does not write data to disk, and a system which is RO?</p>
<p>In my example in the post above, there are some disk writes, but compared with a standard install, they are minute, so maybe it&#39;s worth the compromise to have just one&nbsp;system which is easy to install (not everyone has the same competence!), have options to add other software, and be free to upgrade/downgrade at will.</p>
<p>This is just my personal&nbsp;opinion,&nbsp;T &amp; G will have the final say, but good to hear that RO works for you.</p>
<p>Paul.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36496"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Tue, 01/12/2015 - 03:40.</div>
    <div class="content">
     <p><em>Thanks Bill, I suppose this raises another question, presumably apache&nbsp;is writing this data for a reason, if so, and the OS is mounted RO, what is the detrimental effect of not being able to write&nbsp;it?&nbsp;</em></p>
<p>Turns out the -k switch <em>is</em> valid under Linux. Took me awhile to find the answer.</p>
<p>Now to try and determine the answer to the question above.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36497"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Tue, 01/12/2015 - 04:46.</div>
    <div class="content">
     <p>Paul,</p>
<p>Thanks for the reply, having one single branch that is then modified based upon usage&nbsp;makes sense.</p>
<p>Most operating systems have a RW file system which at the least should be checked after an outage, and is vulnerable to corruption by incomplete writes as the power goes down or the system crashes. As I understand it mounting the OS partition RO means no&nbsp;checks are&nbsp;necessary after a problem as nothing could have changed or become corrupted by incomplete writes to the card / disk. I&#39;m not sure how often you get corruption from power loss or just generally from things going wrong with a Pi, but on mine with V8.5 V Low Write the powers gone unexpectedly about 4 times so far with no problems that I know of. This is a great result for a computer, but also the expected behaviour of a domestic appliance.</p>
<p>My suggestion is&nbsp;a system similar to the shipped image?&nbsp;with a&nbsp;RO OS Partition, the option to put all logging in RAM or perhaps on a memory stick, and a general RW area for programs that need it. I&#39;m assuming the logs auto limit their sizes?&nbsp;</p>
<p>Modern file systems are way better than the file allocation tables&nbsp;of old, but an unexpected power cut can cause bad problems&nbsp;regardless of whether a SD Card is used or&nbsp;a hard disk. Indeed I recently had a loose SSD power cable in my desktop that killed Windows 10 beyond what it could recover from.</p>
<p>Having delayed, consolidated disk writes is a great idea for both SD card longevity and performance,&nbsp;as long as it doesn&#39;t leave anything partially written and&nbsp;that the system can work with all the data whether written or not.</p>
<p>Problems arise&nbsp;when someone needs to install software that insists on having RW access to the whole file system&nbsp;so perhaps a script can be provided to permanently switch between modes?</p>
<p>Getting Openhab to work involved giving it a separate partition mounted in /home/pi that it can play in, even though the bits it writes to are very small now&nbsp;I&#39;ve managed to get it to log to the temp directory.</p>
<p>Just my 10 penneth - hope its useful!</p>
<p>Kevin</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36513"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Tue, 01/12/2015 - 10:29.</div>
    <div class="content">
     <p>I&#39;d suggest starting from a different point - who is the target audience.</p>
<p>If the EmonPi is aimed at the wider population that just want something that works, then a minimal install image that prolongs the SD card life is the prime driver. However it is then configured (perhaps minimal local logging - use emoncms.org) this then comes with a warning that the life of the card cannot be guaranteed in any other configuration.&nbsp; I&#39;d suggest this is not a Raspbian image but an absolute minimum (keeps size of card low as well).</p>
<p>If you want to provide for the more &#39;hobbyist&#39; client then a more complicated instruction set should not be an issue (they will be happy to ask questions).&nbsp; The majority of these hobbyists may be using a HDD already so the effort in supporting a low write SD image may not be the best use of scarce resources.&nbsp; I note that the install instruction now have a set of instructions to move an SD card setup to an HDD which is really great (not tried it though).</p>
<p>Personally, I use one Pi for lots of different things and moved to a HDD a while ago (after a card failure).&nbsp; I have just done a new minimal install (direct to HDD) from the raspbian-ua-netinst on github and then installed emoncms and emonhub.&nbsp; I&#39;ll be moving the other stuff across soon.</p>
<p>I think it is partly a decision on where the overall product line is being aimed at.</p>
<p>$0.01 worth.</p>
<p>Brian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36515"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Tue, 01/12/2015 - 10:58.</div>
    <div class="content">
     <p><em>@borpin123 -&nbsp;who is the target audience?</em></p>
<p>This is foremost in my mind, and of course not all users have the same competence/confidence, therefore we need to structure the installation process to be achievable&nbsp;for the wider majority. Having just read sheppy&#39;s&nbsp;post (above yours) it&#39;s clear that he is fairly knowledgeable and confident about&nbsp;creating/resizing&nbsp;partitions, even adding yet another partition for other software, but many users would find it difficult to do, or be put off by the size&nbsp;of the guide.<br />
I&#39;m not enthusiastic about creating a second (more complicated) guide, as that would deprive the less competent users of those features, and also make support more difficult as we would then have 2 quite different systems.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36516"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Tue, 01/12/2015 - 11:36.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Not suggesting different systems as such, just that the starting points are different.&nbsp; The ready to go is just that. A simple system, pre-installed, that is not designed to be fiddled with, but for it to just work and be reliable.&nbsp; It (should) provide a web interface for configuration and adding modules etc.&nbsp; No specialist knowledge needed.&nbsp; It may even not immediately provide for any local logging but assume that emoncms.org will be used.</p>
<p>If the user subsequently wants more, as with any Linux system, the world is your oyster and TIMTOWTDI.&nbsp; The trick then is to get good clear coherent documentation to support this desire.&nbsp; Unfortunately, as is usually the way, the documentation is lagging.</p>
<p>The current basic install instructions are very good.&nbsp; I did not try a low-write system but I&#39;m hoping if I had, that would have worked well as well.&nbsp; The bit perhaps that is missing is explaining to a new user, the different configurations they may want and why they may want them up front.</p>
<p>I have then fallen over a lack of clear instruction on converting inputs to suitable feeds and (now) how to install modules.</p>
<p>I think the premise of a single system is right and, as long as it remains possible, the other types of install can be done by those with some knowledge or ready to learn.</p>
<p>Cheers,&nbsp; Brian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36528"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 01/12/2015 - 15:21.</div>
    <div class="content">
     <p>Hi guys,</p>
<p>Thanks a lot for lots of good opinions on this topic. I&#39;ve been enjoying reading over past few days</p>
<p>borpin123&nbsp;has hit the nail on the head thinking about the target user. My feeling is to be on the cautious side and make the SD card image we ship with the emonPi as bulletproof as possible. Yes, it will be trickier to setup but once up and running, it should result in a more stable resilient setup. We are now well into our 2nd&nbsp;1K PCS production&nbsp;run of emonPi&#39;. Many of these&nbsp;users just use the unit &#39;as is&#39; therefore won&#39;t be inconvenienced by the hassles of running a RO file system.</p>
<p>We have started building and testing a new SD card image, I&#39;ve posted the latest feature set list there so that this thread doesn&#39;t go too much off topic&nbsp;(<a href="11407.html">http://openenergymonitor.org/emon/node/11407</a>). As my post on the build thread mentions, we are considering having nodeRED and openHAB pre-installed and configured with a skeleton&nbsp;setup to pull in data from emonhub&nbsp;MQTT. IMO, the read-only file system is even more important when adding other services as it&#39;s a safety net against the possibility of a service going to town on file writes behind the scenes&nbsp;without us realising&nbsp;and reducing the life of an SD card.&nbsp;</p>
<p>We are keen to have a standardised installation procedure across the ready-to-go SD card and install guides with the idea that it will be easier to maintain as most systems will be generally running the same thing. We&nbsp;are open to a non read-only OS if there was broad support, but feel that it&#39;s probably better to err on the side of a cautious, read only approach.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36535"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4638.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="borpin123&#039;s picture" title="borpin123&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/4638.html" title="View user profile.">borpin123</a> on Tue, 01/12/2015 - 16:23.</div>
    <div class="content">
     <p>Trystan,</p>
<p>I think you are right for the EmonPi (KISS principle), but a RW OS is needed.&nbsp; You could assume that these will all be HDD based and produce an HDD image like you did before.&nbsp; Having said that, I used the rasbian-ua-install (which I suspect is much the same as the Minibian) partly as it would install directly onto a HDD and a 256Mb Micro SD and followed the emoncms install instructions without any great hassle.</p>
<p>What I do need to work out is how to install modules :)</p>
<p>Key I think is maintaining the documentation and helping folks upgrade (take them with you).&nbsp; for instance, you mention Emonhub MQTT; is that different to the older emonhub?</p>
<p>I&#39;m looking forward to playing with node-red and openhab though I&#39;m not yet clear in my mind how they interact.</p>
<p>Cheers.&nbsp; Brian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37088"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4207.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Vster&#039;s picture" title="Vster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/4207.html" title="View user profile.">Vster</a> on Wed, 16/12/2015 - 15:53.</div>
    <div class="content">
     <p>Hi Chaps,</p>
<p>I&#39;ve only just noticed this thread, sorry for reviving a zombie!</p>
<p>This problem was fixed years ago by others, I dug all the info up nearly four years ago for My Little Server (tm) :)<br />
Some background - I run an Asus EEE 701 (the original netbook) as my server at home (cheap, low power usage, enough horsepower), it only has 4GB of SSD/Flash for the OS which wasn&#39;t big enough. Wanting to use it without spinning disks 24/7, I used the SD card slot to extend the storage. Clearly this would have the same issues as the RaspPi, hence my investigation into minimising writes to SD card. My server runs home automation software which writes to the SD card every 60 secs for it&#39;s main log, and several times every 5-10 secs for many other logs. It also runs a full mail&nbsp;server, webmail, Apache, FTP, NFS/Samba shares, weather station software (SQL db) and all the logging that goes with them. So this solution really works and has done for nearly four years on the same 8GB Sandisk SD card.</p>
<p>Basically the OS (Ubuntu Server - similar to Debian used on the Pi) was installed on the 4GB internal flash on the EEE, then the /OPT and /VAR where moved to the SD card - This is of course different to the Pi&#39;s situation but the principle is the same. My notes from the install are a bit chaotic but here goes...</p>
<p>1) Aligning the SD Card<br />
SD cards aren&#39;t like harddrives, SD cards erase/write 128KB blocks of storage at a time, which means even if one byte&nbsp;of data in a block changes, the whole block is erased and rewritten. If the file&nbsp;systems blocks are mis-aligned to the SD card hardware blocks, that one byte&nbsp;change to the FS block will actually erase/rewrite two SD blocks, slowing everything by a factor of two and also causing twice the wear on the SD card. Not optimal.</p>
<p>&nbsp;sudo fdisk -u -l /dev/sda</p>
<p>Will show you something like -</p>
<p>Device &nbsp; &nbsp;Boot &nbsp; &nbsp; &nbsp;Start &nbsp; &nbsp; &nbsp; &nbsp; End &nbsp; &nbsp; &nbsp;Blocks &nbsp; Id &nbsp;System<br />
/dev/sda1 &nbsp; * &nbsp; &nbsp; &nbsp; &nbsp;2048 &nbsp; &nbsp; 7813119 &nbsp; &nbsp; 3905536 &nbsp; 83 &nbsp;Linux</p>
<p>That start block is 2048 and is a multiple of 128, so it&#39;s aligned with the SD hardware block, which is correct.<br />
Start blocks like 63 are common&nbsp;but anything not a multiple of 128 is mis-aligned and must be fixed before moving on. DD the partition&nbsp;off the SD card, FDISK the SD card to move the partition to the correct boundary and DD the patition&nbsp;back.</p>
<p>2) Add noatime and commit on your FSTAB / mount.<br />
This makes the OS not track read access (modified date/time) to files and buffers the writes to the card for longer.&nbsp;</p>
<p>edit /etc/fstab</p>
<p>UUID=your_uuid &nbsp;/ &nbsp;ext4 &nbsp;defaults,noatime,errors=remount-ro,commit=180 0 1</p>
<p>
3) You can set up a RAMdrive to hold temp files - depends on your free RAM&nbsp;</p>
<p>&nbsp;# mount a RAM disk in FSTAB<br />
&nbsp;tmpfs /tmp tmpfs defaults,noatime,size=128M 0 0</p>
<p>There are many examples which use nosuid,nodev,noexec,mode=1777 but I found this caused problems with APT updates. YMMV.</p>
<p>
4) Tune the system for SSD usage<br />
Now to the real magic. These settings basically turn down the OS&#39;s urge to swap stuff out of RAM to SD swap space (if you have some), turn on laptop mode to minimise disk writes and then really tune the &#39;dirty write&#39; settings.&nbsp;</p>
<p>These settings control flushing unwritten data in RAM back to permanent storage. Normally this is about every 4 seconds. These settings crank that up to three minutes. With sequential writes, which log files are and I suspect that the EmonCMS database writes are, the write will now sit in the file buffers in RAM&nbsp;and be added to every few seconds (in RAM) until they are flushed by the dirty write. Meaning that normally the blocks should be pretty full actually minimising rewrites of the same block as well as writing them less often.</p>
<p>Now I admit this can cause issues in the event of a power cut, in theory you could lose three mins of data, statistically more like 90&nbsp;seconds. BUT is that really an issue? How many power cuts do you *really* get? In reality it will more likely lessen data corruption as power is far less likely to go out *during* a write.</p>
<p>&nbsp;edit /etc/sysctl.conf</p>
<p>&nbsp;# specific tuning for flash drive<br />
&nbsp;vm.swappiness = 0<br />
&nbsp;vm.laptop_mode = 0<br />
&nbsp;vm.dirty_writeback_centisecs = 18000<br />
&nbsp;vm.dirty_expire_centisecs = 18000<br />
&nbsp;vm.dirty_ratio = 10<br />
&nbsp;vm.dirty_background_ratio = 1</p>
<p>
5a) Change the kernel I/O scheduler<br />
I see from various places then everyone seems to use the DEADLINE elevator on the Pi, for the workload of my server (which would seem similar to the EmonPi) NOOP didn&#39;t cause any slower I/O but did reduce CPU workload. Given the small CPU on the Pi, this would seem a better fit.&nbsp;</p>
<p>&nbsp;edit /boot/cmdline.txt &nbsp; and&nbsp;change</p>
<p>elevator=deadline &nbsp;&nbsp;to&nbsp; &nbsp; &nbsp;elevator=noop</p>
<p>&nbsp;After a reboot - check it has stuck<br />
&nbsp;cat /sys/block/sda/queue/scheduler</p>
<p>5b) For some machines grub editing doesn&#39;t seem to work properly, in that case try this -</p>
<p>&nbsp;edit&nbsp;/etc/rc.local</p>
<p>&nbsp;echo noop &gt; /sys/block/sda/queue/scheduler</p>
<p>&nbsp;Put this line before the exit 0</p>
<p>&nbsp;After a reboot - check it has stuck<br />
&nbsp;cat /sys/block/sda/queue/scheduler</p>
<p>
All these setting overlap to some extent, but have been working for a long time.&nbsp;<br />
Sorry for the epic post - hope it helps,<br />
V.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37091"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Wed, 16/12/2015 - 14:53.</div>
    <div class="content">
     <p><em>How many power cuts do you *really* get?</em></p>
<p>Hi Mark,</p>
<p>Here in rural Oklahoma, USA, the power can be <em>very </em>flaky. I&#39;ve seen it go off-line 3 times in the span of an hour<em>. </em>I&#39;ve lived here for three years, and have yet to see a stretch of more than a few months without power loss. There&#39;s a few posts on the forum from users in rural UK that have made similar comments about power that&#39;s not very reliable.</p>
<p><em>edit /etc/default/grub</em></p>
<p>The Pi doesn&#39;t use the Grub bootloader. The I/O scheduler is specified in /boot/cmdline.txt</p>
<p><em>I see from various places then everyone seems to use the DEADLINE elevator on the Pi</em></p>
<p>Regarding the I/O scheduler, <u><a href="https://www.raspberrypi.org/forums/viewtopic.php?f=9&amp;t=850">this</a></u> post says Noop is appropriate only for true SSDs, and that Deadline incorporates the elevator algorithm which groups spatially near disk accesses when possible.</p>
<p>Regards,</p>
<p>Bill</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37098"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4207.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Vster&#039;s picture" title="Vster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/4207.html" title="View user profile.">Vster</a> on Wed, 16/12/2015 - 15:51.</div>
    <div class="content">
     <p>Hi Bill,</p>
<p>OK you got me! :) &nbsp;I&#39;m thinking primarily of the UK, we get power cuts&nbsp;but very rarely.&nbsp;</p>
<p>That said, the rest of it still stands, there will still probably be less chance of FS corruption during a power cut. Have you had any SD card corruption from your frequent power outs?</p>
<p>As to grub, I stand corrected, I don&#39;t use a Pi for EmonCMS, so I&#39;ve not done this stuff on a Pi. I&#39;ve updated the post above to keep it accurate and in one place.</p>
<p>I read about Deadline at the time, I&#39;m not sure it makes that much difference in my use&nbsp;case (or EmonCMS on a Pi using the same set up). The writes are so infrequent that the lower CPU usage was more important to me. That said, perhaps if the only thing running on the Pi is EmonCMS&nbsp;and you have the CPU headroom, the tradeoff in SD longevity is worth the CPU usage?&nbsp;</p>
<p>V</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37105"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Wed, 16/12/2015 - 17:15.</div>
    <div class="content">
     <p><em>Have you had any SD card corruption from your frequent power outs?</em></p>
<p>I switched to a USB HDD about two years ago. (My 8GB SD card died after ~3 months) So far, the ext4 filesystem has been able to recover from power hits via the journal.</p>
<p>Good info in your post, nonetheless.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37113"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 16/12/2015 - 20:15.</div>
    <div class="content">
     <p>Thanks Vster, lots of interesting stuff there. I&#39;ll review our image build with your notes in mind</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37138"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 17/12/2015 - 16:04.</div>
    <div class="content">
     <p>Hi Vster:</p>
<p><strong>Taking a look at your point 1.) &nbsp;:</strong></p>
<p>sudo fdisk&nbsp;returns:</p>
<pre>
Device         Boot   Start     End Sectors  Size Id Type
/dev/mmcblk0p1           16  125055  125040 61.1M  b W95 FAT32
/dev/mmcblk0p2       125056 6676479 6551424  3.1G 83 Linux
/dev/mmcblk0p3      6676480 7698431 1021952  499M 83 Linux</pre><p>and:</p>
<pre>
pi@emonpi:~$ df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/root       3.1G  1.5G  1.5G  51% /
devtmpfs        483M     0  483M   0% /dev
tmpfs           487M     0  487M   0% /dev/shm
tmpfs           487M  6.5M  481M   2% /run
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           487M     0  487M   0% /sys/fs/cgroup
tmpfs            40M  6.5M   34M  17% /var/lib/openhab
tmpfs           1.0M  4.0K 1020K   1% /var/lib/dhcp
tmpfs            50M  3.2M   47M   7% /var/log
tmpfs            30M   32K   30M   1% /tmp
/dev/mmcblk0p1   61M   20M   42M  32% /boot
/dev/mmcblk0p3  484M   32M  427M   7% /home/pi/data</pre><p>&nbsp;</p>
<p>As the /boot partition starts at 16 am I correct that this is not aligned, as it&#39;s&nbsp;not a multiple? How can I correct this? Will this need to be done on the same SD card at we indeed to ship with? Will this vary between SD cards?&nbsp;</p>
<p>&nbsp;</p>
<p><strong>Point 2.) &amp; 3.)</strong></p>
<p>Yup, we already mount with noatime</p>
<p>Yes we mount&nbsp;/var/log to tmpfs using:&nbsp;nodev,nosuid,size=30M,mode=1777. We have not had any problems with this. I notice you use&nbsp;tmpfs /tmp tmpfs defaults,noatime,size=128M 0 0</p>
<p>The fstab is as follows :</p>
<pre>
tmpfs           /tmp             tmpfs  nodev,nosuid,size=30M,mode=1777       0 0
tmpfs           /var/log         tmpfs  nodev,nosuid,size=50M,mode=1777       0 0
tmpfs           /var/lib/dhcp    tmpfs  nodev,nosuid,size=1M,mode=1777        0 0
tmpfs           /var/lib/openhab tmpfs  nodev,nosuid,size=40M,mode=1777       0 0
proc            /proc            proc   defaults                              0 0
/dev/mmcblk0p1  /boot            vfat   defaults                              0 2
/dev/mmcblk0p2  /                ext4   defaults,ro,noatime,errors=remount-ro 0 1
/dev/mmcblk0p3  /home/pi/data    ext2   defaults,rw,noatime                   0 2</pre><p><strong>Point 4.)&nbsp;</strong></p>
<p>I think I will leave this one out.&nbsp;The emonPi could be unplugged / lose power at any moment. Even though we recommend users to shut down properly, I&#39;m not sure how often this happens in practice! We also ship to many countries where power is not always the best quality and blackouts are common. Even in the UK (in rural N.Wales) we get power cuts often in the winter months.&nbsp;</p>
<p><strong>Point 5a.)</strong></p>
<p><strong>Elevator&nbsp;</strong></p>
<p>Changing elevator from&nbsp;deadline to&nbsp;noop sounds like a good idea. Also recommended in this article:&nbsp;</p>
<p><a href="https://fiasko-nw.net/~thomas/projects/rpi/writeless.html.en">https://fiasko-nw.net/~thomas/projects/rpi/writeless.html.en</a>.</p>
<p>I made &nbsp;the change then checked using&nbsp;</p>
<p>pi@emonpi:~/emonpi$ &nbsp;cat /sys/block/mmcblk0/queue/scheduler&nbsp;<br />
[noop] deadline cfq&nbsp;</p>
<p>therefore no rc.local edit is required&nbsp;</p>
<p>&nbsp;</p>
<p>Copies if fstab, rc.local and cmdline.txt are in the emonPi git repo:&nbsp;<a href="https://github.com/openenergymonitor/emonpi">https://github.com/openenergymonitor/emonpi</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37143"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Thu, 17/12/2015 - 17:00.</div>
    <div class="content">
     <p>Glyn,</p>
<p>Here&#39;s another system logging option. <em><strong>busybox-syslogd</strong></em> puts the system logs in a circular ram buffer. (the size is configurable) Log contents are read via the logread command. (part of the package) Here&#39;s a synopsis:</p>
<pre>
syslogd [OPTIONS]

Options:

-n Run in foreground
-O FILE Log to given file (default:/var/log/messages)
-l n Set local log level
-S Smaller logging output
-s SIZE Max size (KB) before rotate (default:200KB, 0=off)
-b NUM Number of rotated logs to keep (default:1, max=99, 0=purge)
-R HOST[:PORT] Log to IP or hostname on PORT (default PORT=514/UDP)
-L Log locally and via network (default is network only if -R)
-D Drop duplicates
-C[size(KiB)] Log to shared mem buffer (read it using logread)</pre><p>With a circular buffer, there&#39;s no &quot;out of ram&quot; issue. Log rotation is built in.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37146"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 17/12/2015 - 18:34.</div>
    <div class="content">
     <p>Thanks Bill, that looks interesting. However I&#39;m happy with&nbsp;logrotate&nbsp;at the moment</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37172"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4207.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Vster&#039;s picture" title="Vster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/4207.html" title="View user profile.">Vster</a> on Fri, 18/12/2015 - 11:19.</div>
    <div class="content">
     <p>Hi Trystan,</p>
<p>1) You are correct in that the logical/physical blocks are mis-aligned and therefore causing twice the wear on the SD card.&nbsp;</p>
<p>I&#39;m a Linux guy so I&#39;d use DD and Fdisk to move the partitions data off the SD to HD, redo the partitions then move the data back. But it&#39;s probably easier just to use GPARTED, it&#39;s part of the Ubuntu desktop (which I think&nbsp;you use) or can be booted off CD and used as a live OS. GPARTED is graphical tool to create/move/delete partitions around. Move the P3 up a bit, then P2, then P1. Leaving P1 aligned on say 2048, will correct the issue.</p>
<p>I assume you just copy a file image to the SD cards that you ship? If that&#39;s the case just create a new image from the updated SD card (it will just have a bit of wasted space at the beginning but otherwise be identical).</p>
<p>No, it won&#39;t&nbsp;matter between SD cards, only the length/size matters (some SD cards are slightly smaller/larger than others for a given size), as this image os only 3.6GB that&#39;s not an issue.</p>
<p>2/3) Interesting, it may be an Ubuntu vs Debian thing. &nbsp;There is a commit= line in there you may have missed.</p>
<p>4) I understand your concern, but this&nbsp;is the real magic. It cuts writes by orders of magnitude. As I&nbsp;mentioned, I suspect it may actually prevent&nbsp; corruption by minimising&nbsp;writes, because as well as writing less often (once every three mins) it writes once instead of say 100 times (one block of 100 rows, rather than 100 blocks of one&nbsp;row). It may be worth running a few tests, yanking the power out and seeing which gets corrupted first with/without the patch. I&#39;ve been running it for nearly four years&nbsp;and never suffered any loss of data/corruption, there have been several hard power&nbsp;downs due to electrical work/bad coding/bad wiring.</p>
<p>5) Interesting page, I&#39;ve taken NTP logging off my server too. He also use&nbsp;the dirty.write fixes. May be worth reaching out to him to get his experience of running it on a Pi?</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37322"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 21/12/2015 - 10:25.</div>
    <div class="content">
     <p>Thanks for your help,. It was easy to use gparted to align the partition. There was an align to cylinder option. Also added commit=180 to fstab</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37349"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4207.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Vster&#039;s picture" title="Vster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/4207.html" title="View user profile.">Vster</a> on Mon, 21/12/2015 - 22:54.</div>
    <div class="content">
     <p>Hi Trystan,</p>
<p>The commit=300 will help, but it&#39;s only doing half the job. Commit specifies a maximum write&nbsp;commit timeframe that the OS uses, programs can still call fsync&nbsp;to flush the file buffers, sidestepping the OS commit timeframe. More importantly I forgot to mention (sorry!) commit only works for EXT4 partitions, if you&#39;re storing data in the third EXT2 partition, the commit parameter will be ignored.&nbsp;</p>
<p>I can&#39;t think of a way to test the benefit of the just using the commit (without the dirty.writes) &nbsp;other than to plug in USB hard drive, move the OS to it, and then watch the HDD LED, it should&nbsp;only flash every three mins in normal use (I suspect). Or perhaps someone who is using a HDD can add the commit temporarily to test it?&nbsp;</p>
<p>Hope that helps.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37359"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Tue, 22/12/2015 - 01:36.</div>
    <div class="content">
     <p><em>It was easy to use gparted to align the partition. There was an align to cylinder option. Also added commit=180 to fstab</em></p>
<p>Hi Glyn,</p>
<p>Did you use align to cylinder, or align to MiB?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37364"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 22/12/2015 - 11:06.</div>
    <div class="content">
     <p>@Vster&nbsp;Ah, we do use ext2 for our data partition therefore, commit will have no effect.</p>
<p>@Bill I used &quot;align to cylinder&quot; option in Gparted. Is this correct?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Tue, 22/12/2015 - 18:27.</div>
    <div class="content">
     <p><em>I used &quot;align to cylinder&quot; option in Gparted. Is this correct?&nbsp;</em></p>
<p>Unfortunately, no. You want the MiB option.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37411"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Low-write mode - your thoughts please</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 23/12/2015 - 17:20.</div>
    <div class="content">
     <p>Ah, ok. I&#39;ve done some reading up on the Gparted&nbsp;manual and your totally correct. However looking at the effect of the alignment operation:</p>
<p><strong>Before</strong></p>
<pre>
Device         Boot   Start     End Sectors  Size Id Type
/dev/mmcblk0p1           16  125055  125040 61.1M  b W95 FAT32
/dev/mmcblk0p2       125056 6676479 6551424  3.1G 83 Linux
/dev/mmcblk0p3      6676480 7698431 1021952  499M 83 Linux</pre><p><strong>After</strong></p>
<pre>
Device    Boot      Start         End      Blocks   Id  System
/dev/sdb1            4096      129023       62464    b  W95 FAT32
/dev/sdb2          129024     6680575     3275776   83  Linux
/dev/sdb3         6680576     7688191      503808   83  Linux </pre><p>The first partition now starts at 4096, since this is a multiple of 128 am I correct in thinking that this is now aligned to the SD card 128KB blocks?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11695"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-6pnO5FTIT7jxtqTiv6SEih4XAjuC27VBq5piy6io10c" value="form-6pnO5FTIT7jxtqTiv6SEih4XAjuC27VBq5piy6io10c"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
