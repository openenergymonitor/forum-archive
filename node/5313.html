<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonCMS : high availability | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/5">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonCMS : high availability</h3>
        <span class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Wed, 18/06/2014 - 08:52</span>
        <div class="content"><p>Hi all,</p>
<p>My need : I want to monitor a building which is far away from my home for six month. Its internet connection is not very reliable and the main power can be down for few times. Off course, I do not want to loose any measured data. Well, it is not for a critical application but I want to choose the best solution (if there is one)</p>
<p>I&#39;m wondering what is the best EmonCMS architecture to get the highest availability knowing that I can&#39;t&nbsp; access to the building in case of any problem...</p>
<p>First solution : install a local EmonCMS on a RPI+hdd (powered by an inverter) + forward the data on a remote server.<br />
	Advantages : the internet connection can be down for few times. No data will be lost as it is duplicated on the hdd.<br />
	Drawback : if the hdd fails (possible if the inverter is suddenly out of battery ?) or if the USB hub fails, there is no way to provide remote troubleshooting ... Data will be lost until I can access to the building...</p>
<p>Second solution : use the oem gateway forwarder on a RPI (powered by an inverter) .<br />
	Advantages : more solid software stack on the RPI ?<br />
	Drowback : if the internet connection is down, some data will be lost</p>
<p>Third solution : do both ! One RPI with a hdd running a local EmonCMS server + one RPI only forwarding data on a remote EmonCMS</p>
<p>Please let me know what you think.</p>
<p>Regarding the choice of the inverter, can you help me to choose it knowing that :<br />
	- I do not need a lot of power (one or two RPI + one HDD powered by a USB hub)<br />
	- I would like to be able to run the inverter on the battery as long as possible<br />
	- I can&#39;t afford an expensive inverter</p>
<p>Any advice regarding the choice of the SD card and the hdd is welcome.</p>
<p>Thank&#39;s for your help,</p>
<p>Eric</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/4036" class="topic-previous" title="Go to previous forum topic">‹ Updating the OEM Rock Solid Gateway image</a>
              <a href="/emon/node/5344" class="topic-next" title="Go to next forum topic">My wife consumes too much energy!! ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-22023"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Wed, 18/06/2014 - 09:57.</div>
    <div class="content">
     <p>Hi Eric,</p>
<p>Interesting question and a tough decision :-)</p>
<p>Firstly I would say definitely use oem&nbsp;gateway / emonhub&nbsp;which ever option you take as there are no benefits to not using it and it does provide data buffering so short network outages will not be a problem.</p>
<p>The read-only sd card option is also more robust and quicker to boot if power outages are frequent, it also draws less current if a long power outage is encountered.&nbsp;</p>
<p>During power outages will the network automatically be down or is the network connection power independent?</p>
<p>How frequent are the power outages? If the power cycles rapidly this is more likely to cause hdd failures and if hdd&nbsp;does fail then no further data can be collected as the pi won&#39;t boot. also all previous data including periods that were unable to send to emoncms.org may be lost.</p>
<p>The obvious downfall of the oem gateway / emonhub&nbsp;option is any longer periods of network / power outages will result in some lost data as the data is held in RAM so when the back-up power supply fails the buffered data is lost and also the RAM can only buffers so much data.</p>
<p>The buffer size can be altered so you could experiment with increasing the allocated size and also keep data sizes and sample intervals to the minimum needed.</p>
<p>Overall I think the oem gateway / emonhub option could be the better option unless very prolonged network outages with minimal power interruptions is more likely than a prolonged power outage or random short outages of both/either.</p>
<p>Food for thought...</p>
<p>Paul&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22030"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Wed, 18/06/2014 - 12:46.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Thank&#39;s for your reply.&nbsp; It gives me some good clues.</p>
<p>I guess the network connection is power independent.&nbsp; Power outages&nbsp;should be quite rare as the building is connected to the grid which is reliable in France.</p>
<p>Did you notice that I&#39;m planning to use a power inverter ? (only for the RPI and the hdd, not for the network)</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22031"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5417" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-5417.jpg" alt="Hertog&#039;s picture" title="Hertog&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5417" title="View user profile.">Hertog</a> on Wed, 18/06/2014 - 13:11.</div>
    <div class="content">
     <p>Also a possibility is to add a UPS to the equation. I imagine a cheap-ish UPS can keep a Pi running for quite a while. And in the event of a real long outage, software like apcups can shutdown (and powerup) the Pi gracefully. My BackUPS&nbsp;CS 350 cost somewhere around 80 Euro&#39;s and is fully monitorable via USB.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22032"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Wed, 18/06/2014 - 13:37.</div>
    <div class="content">
     <p>I had noticed but was unclear as to why. A &quot;power inverter&quot; suggests you are intending to produce high voltage AC from a DC source, presumably a battery in this instance. That AC will then need to be reduced and rectified to supply the pi &amp; hdd.</p>
<p>A UPS is a better &quot;out of the box&quot; solution but you are still outputing&nbsp;higher voltage AC and then reducing and rectifying to 5v DC.</p>
<p>If you are just wanting a reliable power supply for the pi &amp; hdd, why not just run them direct from a battery (using a DC voltage dropper if required) and charge that battery with an intelligent charger continuously or when suitable ie&nbsp;when power is up, off-peak only or when solar PV available. This would eliminated the need for any &quot;power outage switchover&quot; and smooth any power fluctuations giving an ideal solution for running the hdd.</p>
<p>what are you measuring and with what? emontx&nbsp;may need a supply, also is there any data worth reporting during a power outage? How will the node(s) connect to pi?&nbsp;rf uses more power but direct connection limits the number.</p>
<p>emontx v3 can be powered via ac-ac adapter but will stop functioning when power is down, not really a major problem unless v3 is also measuring something that needs reporting during a power outage. v3 can be powered via 5v&nbsp;or battery but will still need ac adapter for accurate power/voltage reporting. The power inverter wouldn&#39;t help here either as you want to measure the buildings supply not the inverter output.</p>
<p>What type of network connection are you using? again wifi will require more power as will a mobile modem device.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22041"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Wed, 18/06/2014 - 19:04.</div>
    <div class="content">
     <p>I would like to measure :</p>
<p>&nbsp;&nbsp; - 16 electrical powers with 4 EmonTX V3, each one powered by an AC/AC adapter. If the main power is off, they have nothing to measure.</p>
<p>&nbsp;&nbsp; - 4 temperatures using 2 EmonTH. These records can be lost for a moment.</p>
<p>All nodes will send data to the Emonbase using RFM12B. The EMonbase will be connected to internet through a LAN (Ethernet).</p>
<p>&nbsp;</p>
<p>Sorry for my english. By &quot;inverter&quot;, I mean what you call an UPS, a device that can provide emergy power when the main power fails.&nbsp; With an UPS, the RPI+hdd solution seems appropriate if power outages are short which is probably the case.</p>
<p>But, if I can&#39;t get an UPS, the OEM gateway option seems better. Some additional questions about that solution :</p>
<p>&nbsp;&nbsp; - Is it possible to forward data simultaneously to two different remote EmonCMS server ?</p>
<p>&nbsp;&nbsp; - Is there a maximum recommended buffer size ? How long it will&nbsp; approximately last with 20 record every ten seconds ? What happens when the buffer is full ?</p>
<p>Regards,</p>
<p>&nbsp;</p>
<p>Eric</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22044"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Wed, 18/06/2014 - 20:20.</div>
    <div class="content">
     <p>Emonhub&nbsp;(or oem gateway) can send to multiple emoncms instances. I have had a test set up with 2 remote and 2 local instances all being fed simultaneously.&nbsp;</p>
<p>the default size is 1000 frames of data so 6 nodes (4 emontx&#39;s &amp; 2 emontx&#39;s) producing 6 frames a minute is 36 a minute or 2160 an hour. you would need to run some tests but the default should be good for around 1/2 an hour or try increasing the value and check RAM usage. the number of frames doesn&#39;t consider the size and number of values in a frame but remember though the memory is limited on a Pi and if you are posting to 2 CMS&#39;s there are 2 buffers.</p>
<p>this calc is theory so i would recommend testing before relying on it.</p>
<p>Can you use the temp sensor inputs on the v3&#39;s&nbsp;each of the 4 v3&#39;s could record a temp without extra nodes, less expense, less rf trafffic (collisions), less power used and less frames of data. the additional headroom required for the node id and time stamp would increase the potential buffer size as well.</p>
<p>When the buffers limit is reached it will start replacing the oldest data first so the buffers always retain the latest data.&nbsp;</p>
<p>I notice your original post says pi+hdd&nbsp;or pi+gateway or both (2 pi&#39;s) emoncms and emonhub (oem gateway) will work together on same pi no problem, so you can have local hdd and buffered remote from 1 pi.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22053"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Thu, 19/06/2014 - 08:39.</div>
    <div class="content">
     <p>Hi,</p>
<p>Thank&#39;s again for your information.&nbsp; Very instructive !&nbsp; I will test to increase the buffer size and tell how it affects the RAM.</p>
<p>You said :<em> emoncms and emonhub (oem gateway) will work together on same pi no problem, so you can have local hdd and buffered remote from 1 pi. &nbsp;&nbsp; </em>According to my understanding (correct me if I am wrong), if the hdd fails, no further data can be forwarded as the pi won&#39;t boot. That why I was thinking using two Pi:</p>
<p>&nbsp;&nbsp;&nbsp; - One Pi with a hdd running a local EmonCMS&nbsp; (it can work during internet outages but can fail after a power outage)</p>
<p>&nbsp;&nbsp;&nbsp; - A second Pi&nbsp; running a rock-solid-gateway that will forward data to a remote server (it shouldn&#39;t fail after a power outage because it&nbsp; uses a read-only file system but it need an internet connection)</p>
<p>Is it possible to have both approach on the same Pi ?</p>
<p>Regards,</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22058"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Thu, 19/06/2014 - 12:29.</div>
    <div class="content">
     <p>If emonhub&nbsp;is installed to hdd with emoncms, the pi will indeed fail to boot following a hdd failure. that advantage of using emonhub with emoncms is the option to post locally and have a buffer for remote posting to reduce loss of data during short network outages.</p>
<p>The issue with running 2 pi&#39;s and hdd from a UPS is that you are massively reducing the length of time the UPS will last, which actually could increase the possibility of failure.</p>
<p>If there is nothing or very little to report during power outages, maybe the read-only solution without a UPS is sufficient. the only data loss potential is if the network goes down for longer than the buffers can cover. Only the data produced at the beginning&nbsp;of the outage up to the earliest retained record is at risk ( eg&nbsp;if buffer can hold 4hrs and network is down 5hrs&nbsp;only the 1st hour is lost)</p>
<p>the ups, hdd, possible 2nd pi etc will only extend the data retention&nbsp;during prolonged network outages but could be prone to failure during prolonged power outages and if you are really unlucky the hdd may fail and no further data will be collected. in this instance the primary objective of the ups is only to reduce the chance of hdd failure as there still won&#39;t be data to send.&nbsp;</p>
<p>Either method has holes, either some data loss during prolonged network outages or a possible hdd failure during prolonged power outages. The first is more likely to happen but the damage is limited to a small amount of data where as the later is unlikely to happen but if it does it&#39;s curtains until you can replace the hdd.</p>
<p>I guess if it&#39;s important enough you could run 2 pi&#39;s, you could have 1 pi&amp;hdd&nbsp;on a ups and the&nbsp;2nd&nbsp;ro&nbsp;pi direct from the mains, that would ensure after a prolonged power outage the&nbsp;ro&nbsp;pi would still boot up if the&nbsp;hdd&nbsp;has failed, without imposing a load on the ups or just get a bigger ups:-).</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22061"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Thu, 19/06/2014 - 13:29.</div>
    <div class="content">
     <p>Paul, your last message is a great summary ! Thank&#39;s.</p>
<p>Somewhere, it shows that there is lack of reliability in the EmonHub/EmonCMS architecture. On one side, we need a reliable power source and on the other side we need a reliable internet connection ... According to me, the coming developments should be focused on this subject rather than adding new features. When monitoring buildings, there is nothing worse than loosing data ...</p>
<p>Regarding my project, I think I will do what you suggest in your last paragraph.</p>
<p>Bye,</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22091"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Sat, 21/06/2014 - 07:50.</div>
    <div class="content">
     <p>Hi,</p>
<p>For my local EmonCMS, I&#39;m using the recommended image (2014-02-23-emoncmsraspberrypihdd_stack) found <a href="http://emoncms.org/site/docs/raspberrypihdd">here</a>.</p>
<p>I made some tests <u>without UPS</u> regarding the power outages. I unplugged then re-plugged the power of my USB hub to simulate a power outage. EmonCMS restarted without any problem. No data lost. I made that test several times and everything&#39;s seems OK. No hdd failure ! Maybe, it&#39;s because&nbsp;I&#39;am using a recent USB hdd ?</p>
<p>On that image, one can post data to one remote EmonCMS server but there is no buffer in case of network outage.</p>
<p>&nbsp;&nbsp; - How to to activate a buffer on that image ?</p>
<p>&nbsp;&nbsp; - How to send data to two remote server ?</p>
<p>Bye,</p>
<p>Eric</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22096"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Sat, 21/06/2014 - 12:34.</div>
    <div class="content">
     <p>Hi Eric</p>
<p>The likely hood of hdd failure is very small, power failures can increase the chance but it&#39;s still relatively unlikely, almost an acceptable risk. It&#39;s the impact IF the unlikely should happen that is usually unacceptable.</p>
<p>i wouldn&#39;t use that image because both the raspbian and emoncms&nbsp;softwares have been updated a fair few times since that image was prepared and it has the raspberrypi module installed which if you want to send to 2 remote severs and have a buffer you will want to install oem gateway/emonhub instead.</p>
<p>I would use this guide to install <a href="http://openenergymonitor.org/emon/node/5092">emoncms&nbsp;to hdd&nbsp;on fresh raspbian</a> and where it says</p>
<blockquote><p>sudo apt-get -y --force-yes install emoncms emoncms-module-event emoncms-module-rfm12pi</p>
<p>(if you do not need or want the event module or rfm2pi module delete them from that last line to suit)</p>
</blockquote>
<p>only install emoncms</p>
<blockquote><p>sudo apt-get -y --force-yes install emoncms</p>
</blockquote>
<p>Then install the <a href="https://github.com/Jerome-github/oem_gateway">old&nbsp;oem gateway</a> or the later&nbsp;<a href="http://openenergymonitor.org/emon/node/5289">emonhub </a>to give you the buffering and multiple CMS&#39;s etc</p>
<p>Emonhub&nbsp;is still in development stages but it&#39;s still as reliable, only the feature set and module structure is being experimented with.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22155"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Tue, 24/06/2014 - 11:26.</div>
    <div class="content">
     <p>In your other thread &nbsp;<a href="http://openenergymonitor.org/emon/node/5326">read-only oem gateway</a>&nbsp;you mention you will not be able to access physically or by ssh. If you are unable to access by ssh&nbsp;is that because of not having a fixed IP ? if so does that mean the emonCMS/hdd install in not accessible either?</p>
<p>The hdd and full emoncms&nbsp;install seems like a big solution just as a back-up to fall back on for missing data after the monitoring period has closed. Maybe if RO&nbsp;emonhub was also able to post each frame to a data stick mounted RW as a text file this would give you a full set of data in csv to fall back on for missing data and save you the cost of the 2nd pi, hdd and ups.</p>
<p>Just a thought :-)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22180"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Wed, 25/06/2014 - 08:41.</div>
    <div class="content">
     <blockquote><p><em>In your other thread&nbsp; read-only oem gateway you mention you will not be able to access physically or by ssh. If you are unable to access by ssh is that because of not having a fixed IP ? if so does that mean the emonCMS/hdd install in not accessible either?</em></p>
</blockquote>
<p>&gt;&gt;&gt; The building I&#39;m going to monitor has one fixed Internet IP adress delivered by its ISP. The Raspberry Pi will be connected to a LAN managed by a router. For the moment, I haven&#39;t permission to modify the configuration of that router to set static IP adressing and port forwarding. So, I will have no access to the RPI (nor ssh,neither hhtp, ...)</p>
<blockquote><p><em>The hdd and full emoncms install seems like a big solution just as a back-up to fall back on for missing data after the monitoring period has closed.</em></p>
</blockquote>
<p>&gt;&gt;&gt; I agree with you. Now, I have no other solution to make the monitoring as reliable as possible. So, here is my plan : I have installed Emonhub+EmonCMS a RPI+HDD. Data will also be sent to a remote EmonCMS server. The HDD failure is clearly a high consequence low probability event. So I will give to the building occupants a second SD card. On that card, I have only installed Emonhub in RO. If the HDD failure happened, I will ask them by phone to put the second SD card in the RPI and then to re-power it.</p>
<p>Paul, I congratulate you for having developed straightforward installation procedure&nbsp; (<a href="http://openenergymonitor.org/emon/node/5289">EmonHub</a>, <a href="http://openenergymonitor.org/emon/node/5331">switch Raspbian to RO</a>, and <a href="http://openenergymonitor.org/emon/node/5092">EmonCMS on a RPI+HDD</a>). They all worked very well for me. Great job !</p>
<blockquote><p>
		<em>Maybe if RO emonhub was also able to post each frame to a data stick mounted RW as a text file this would give you a full set of data in csv to fall back on for missing data and save you the cost of the 2nd pi, hdd and ups.</em></p>
</blockquote>
<p>&gt;&gt;&gt; I really like this idea.&nbsp; : small, simple, and cheap ! No port forwarding needed, no hd failure risk, no internet outage risk.</p>
<p>EDIT : it may be not necessary to post each frame to a data stick but only the one going out of the buffer when it&#39;s full. Then these frames will be reposted later using a separate phpp script.</p>
<p>&nbsp;</p>
<p>Regarding the buffer size in Emonhub, I made some tests with the following configuration :<br />
	&nbsp;&nbsp; - 3 EmonTX sending data every 10s<br />
	&nbsp;&nbsp; - 3 EmonTH sending data every minute<br />
	&nbsp;&nbsp; - Emonhub (dev version) installed on a RPI in read-only. Data forwaded to emoncms.org and a local EmonCMS (not on the RPI). No change to the default config (bufferMethod = memory, bufferSize = 1000)</p>
<p>I simulated two network outages (RPI&#39;s LAN cable unplugged then re-plugged):<br />
	First outage :<br />
	- duration 20 min<br />
	- data lost : no<br />
	- time to get back all data : 10 min<br />
	Second outage :<br />
	- duration 60 min<br />
	- data lost : yes, the one collected during the first 10 minutes<br />
	- time to get back all data : 30 min</p>
<p>Note that the RAM used increases after each internet outage. (see attached)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22199"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Thu, 26/06/2014 - 16:12.</div>
    <div class="content">
     <p>Hi,</p>
<p>I made some tests with another configuration :<br />
	&nbsp;&nbsp; - 3 EmonTX sending data every 10s<br />
	&nbsp;&nbsp; - 3 EmonTH sending data every minute<br />
	&nbsp;&nbsp; - Emonhub (dev version)&nbsp; and EmonCMS (last apt version) installed on a RPI+HDD.</p>
<p>Emonhub forwards data to a local EmonCMS (on the HDD) and also to EmonCMS.org.&nbsp; No other changes to the default config (bufferMethod = memory, bufferSize = 1000)</p>
<p>In order to simulate a network outages, I unplugged the RPI&#39;s LAN cable and then I re-plugged it 10 minutes later. No data lost on the local EmonCMS server but ... I have no data on EmonCMS.org during the time of the network outage.</p>
<p>Any explanation ? Something to configure in Emonhub ?</p>
<p>Many thank&#39;s !</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22204"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Fri, 27/06/2014 - 10:12.</div>
    <div class="content">
     <p>Glad the guides help!</p>
<p>The text file idea came from wanting to be able to see the data being posted by emonhub&nbsp;without all the other log messages or multiple entries&nbsp;for one frame of data, in a consistent&nbsp;layout so you can scan down the columns for rogue values.</p>
<p>Following this discussion it occurred&nbsp;to me that this could work as a simple back-up solution as well as a tool for diagnosing data. I think the overspill idea is good for your need but that would mean building it as an extension to existing dispatchers and would require some functioning logic which makes is less simple and possibly open to error, something that&#39;s&nbsp;less desirable for a back-up. a dedicated test/back-up dispatcher could also (in theory) cope with the usb stick being pulled out and the data file copied, queried, deleted or renamed etc and as long as it is plugged back-in before the buffer is filled, pick up where it left off. I did start hashing something together the other night but I&#39;m unlikely to get back to it just yet.</p>
<p>There is a plan to add persistent buffering to emonhub&nbsp;at a later date which will expand the buffer size to the limit of the available storage but that may well need to be hdd only depending on disc&nbsp;activity level etc.</p>
<p>The initial test results sound good. (3tx * 6frame/min) + (3tx *1frame/min) = 21frame/min, a buffersize of 1000/21 = 47.7 mins, so 50 mins&nbsp;(60min outage - 10min&nbsp;data loss) sounds about right.</p>
<p>The logfile is also located in the &nbsp;RAM on the RO version and that will steadily increase in size up to a <a href="https://github.com/emonhub/emonhub/blob/master/src/emonhub.py#L189-L191">max limit of 10mb&nbsp;(I believe)</a></p>
<p>Regards the loss of data in the second test, no I&#39;m not sure why that would happen, did the data resume posting after the outage? was any clues in the logfile? The logic is that the if emonCMS confirms receipt of data then that data is deleted from buffer and the next batch is created or if no receipt confirmed then the dispatcher will keep trying until there is a confirmed receipt.</p>
<p>Could you try again but this time ssh in and change url from emoncms.org to something else eg <strong>x</strong>emoncms.org in the conf file, while the system is live, without restarting. that way you can see the logfile while it is unable to post. you should see the same line repeatedly tried and then when you redit&nbsp;the emonhub.conf back to emoncms.org see that same line result is a successful&nbsp;post.</p>
<p>Thanks for feeding back your findings it&#39;s most helpful.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22210"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Fri, 27/06/2014 - 12:40.</div>
    <div class="content">
     <p><em>Regards the loss of data in the second test, no I&#39;m not sure why that would happen, did the data resume posting after the outage? </em></p>
<p>Yes</p>
<p><em>was any clues in the logfile?</em></p>
<p>No because logging is working only 10 seconds after Emonhub startup (I&#39;m talking about /var/log/emonhub.log)</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>On the second configuration (RPI+HDD running EMonhub sending data to EmonCMS.org and a local EmonCMS on the Pi), I have some strange behaviour.</p>
<p>&nbsp;&nbsp; - When restarting the Emonhub service, I have some bad input in EmonCMS because some frame a cut in two. As an example the frame 6 0 23 25 is seen as 0 23 25. So it logs data to node zero instaed of node 6. I have to restart the rfm12Pi service to make it work as expected.</p>
<p>&nbsp;&nbsp; - In Emonhub&#39;s config file (home/pi/emonhub/conf/emonhub.conf), when I comment out the lines that defines the dispatcher that send data to the local EmonCMS, it has o effect after a reboot. Data are still send to the local EmonCMS.</p>
<p>&nbsp;&nbsp; - Emonhub logging stops after 10 seconds.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22212"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Fri, 27/06/2014 - 13:29.</div>
    <div class="content">
     <p>The rfm2pi&nbsp;service shouldn&#39;t be installed (see my earlier post Sat, 21/06/2014 - 13:34), emonhub&nbsp;and emoncms cannot successfully access the Pi&#39;s serial port at the same time. If you installed rfm2pi using the apt-get method run</p>
<blockquote><p><strong>sudo apt-get remove emoncms-module-rfm12pi</strong></p>
</blockquote>
<p>This could cause erratic serial port data in emonhub&nbsp;and it will bypass emonhub with data from rfm2pi direct to emoncms, which means no data to emoncms.org. This is why posting to local emonCMS still happens when emonHub&nbsp;doesn&#39;t have a dispatcher configured for local emoncms.</p>
<p>Not sure why logging stops after 10 secs, can you post the 10 secs so I can see what&#39;s there or missing ? what is the logging level set to in emonhub.conf ?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22213"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/4440" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/4440" title="View user profile.">pb66</a> on Fri, 27/06/2014 - 13:38.</div>
    <div class="content">
     <p>In fact emonhub&nbsp;may not have anything to log if it cannot access serial port which in turn, maybe the reason the logging stops. This may not be obvious because the data is still arriving at local emoncms&nbsp; directly from rfm2pi, so it looks like emonhub&nbsp;is still functioning.</p>
<p>Retry the logging after removing the rfm12pi module.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22233"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/5027" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Eric_AMANN&#039;s picture" title="Eric_AMANN&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonCMS : high availability</h3>

    <div class="submitted">Submitted by <a href="/emon/user/5027" title="View user profile.">Eric_AMANN</a> on Sat, 28/06/2014 - 12:28.</div>
    <div class="content">
     <p>Hi,</p>
<p>Great !</p>
<p>After running <strong>sudo apt-get remove emoncms-module-rfm12pi, </strong>everything seems to work fine !</p>
<p>Logging is working more than 10s and data are well buffered during network outages.</p>
<p>I will give further feedbacks later.</p>
<p>Eric</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/5313"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-D3L4MnA3jGeR8QoMFGMJ_LxdAaQNJmTK4oqsblMuu6E" value="form-D3L4MnA3jGeR8QoMFGMJ_LxdAaQNJmTK4oqsblMuu6E"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
