<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11252 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:58:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonTxV3 3-phase monitor stops reporting after 20hours??? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonTxV3 3-phase monitor stops reporting after 20hours???</h3>
        <span class="submitted">Submitted by <a href="../user/8701.html" title="View user profile.">Gerry</a> on Mon, 14/09/2015 - 04:16</span>
        <div class="content"><p>Hi,</p>
<p>i have loaded the emonTxV3_4_3Phase sketch on my emonTxV3 and after a period of 19-22hours after a reset&nbsp;it just stops reporting values to the Raspberry Pi. Transmission is done via RFM69CW.</p>
<p>While monitoring is running before it &quot;hangs&quot; its all just fine. effective&nbsp;power values in line with kWh readings, regular reportings are transmitted and logged to emoncms.org.</p>
<p>&nbsp;</p>
<p>CT1,2,3 deployed, no CT4 used, so the CT4 commented out in the code and the corresponding adaptations as proposed in the code done for usage without CT4&nbsp;(Samplesdelay, Phasecal)</p>
<p>&nbsp;</p>
<p>Having tried now pretty all of the recommendations applied due to power instability of the grid&nbsp;here in Indonesia(reducing transmit power of radio module to -10dBm, supplying additional 5V DC power and removing jumper J2) but the result is always the same. Are there still any memory issues?</p>
<p>Setup is as follows:</p>
<p>emonTx V3.4</p>
<p>RFM69CW at 433MHz</p>
<p>9V AC power supply european type</p>
<p>sketch from:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_3Phase_Voltage" title="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_3Phase_Voltage">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3...</a></p>
<p>raspberry Pi 2</p>
<p>Thanks for any suggestions or similar experience?</p>
<p>Gerry</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10182.html" class="topic-previous" title="Go to previous forum topic">‹ Couldn&#039;t send to server, URLError: [Errno -2] Name or service not known</a>
              <a href="11333.html" class="topic-next" title="Go to next forum topic">Why has the local emonCms server (with ready-to-use disk images) guide been removed? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-34137"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6518.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="JD&#039;s picture" title="JD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/6518.html" title="View user profile.">JD</a> on Mon, 14/09/2015 - 13:37.</div>
    <div class="content">
     <p>I have been running the previous sketch (<em>emonTxV3_3Phase_Voltage_4CTs_Temp</em>, no longer on GitHub) on an emonTXV3.3 for about 6 months without problems.</p>
<p>JD</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34139"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Mon, 14/09/2015 - 14:12.</div>
    <div class="content">
     <p>@Gerry,</p>
<p>Do you have a &quot;spare&quot; device you can monitor the RF world with?&nbsp; It will help to distinguish if the TX side has stopped sending or (more likely) the Rx side has stopped listening...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34155"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8701.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8701.jpg" alt="Gerry&#039;s picture" title="Gerry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/8701.html" title="View user profile.">Gerry</a> on Tue, 15/09/2015 - 00:20.</div>
    <div class="content">
     <p>Hi JD,</p>
<p>still can find the sketch on github.</p>
<p>will give it a try the next days and let you know if this works better.</p>
<p>thanks</p>
<p>Gerry</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34156"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8701.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8701.jpg" alt="Gerry&#039;s picture" title="Gerry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/8701.html" title="View user profile.">Gerry</a> on Tue, 15/09/2015 - 00:23.</div>
    <div class="content">
     <p>Hi emjay,</p>
<p>thanks for your comment.</p>
<p>trouble is on the sending side because the raspberry PI receiving the data does not need to be reset.</p>
<p>it resumes receiving after the emontx was reset.</p>
<p>cheers gerry</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34177"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 15/09/2015 - 23:17.</div>
    <div class="content">
     <p>How accurate is your "19-22 hours"? Has it never failed below 19 hours and has it never run for more than 22?  Do you always restart it at about the same time of day? Does it always fail at about the same time of day?</p>
<p>I've been running a copy now for nearly 23 hours and so far it's fine. Mine has a 868MHz RFM69CW but it's working at 433 MHz.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34183"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8701.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8701.jpg" alt="Gerry&#039;s picture" title="Gerry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/8701.html" title="View user profile.">Gerry</a> on Wed, 16/09/2015 - 07:54.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>it could also be less than 19 hours. Often after a reset the monitoring keeps going for a few minutes only.</p>
<p>Attached file shows the reporting over the last week.</p>
<p>Yesterday, after another hang, I connected to the serial port of emontx and it was still writing the measured values regularly. So I conclude it&#39;s in the rfm69 transmission&nbsp;part where the problem seems to be lcoated.</p>
<p>Also I&nbsp;enabled the&nbsp;anti crash (restart) watchdog ( wdt_enable(WDTO_8S) ) in the code and uploaded it the UNO.</p>
<p>Let&#39;s see if that helps to&nbsp;keep it&nbsp;running.</p>
<p>Gerry</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34189"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 16/09/2015 - 12:18.</div>
    <div class="content">
     <p>What I immediately notice is, mostly it seems to stop between 4:45 and 5 am on 8 successive days (as best as I can estimate). Can that really be a coincidence? It makes me think there could be an external influence that's provoking it.</p>
<p>The transmit code was lifted straight out of JeeLib (minus the receive part) and simplified only in that a few levels of subroutine nesting were no longer necessary. So it shouldn't be any different to transmit-only sketches using JeeLib, except that the transmit power setting is readily accessible.</p>
<p>I only noticed yesterday that I hadn't put the watchdog back in, but if it is the transmit code that's not behaving but not hanging, that won't help.</p>
<p>And mine is still running after 36 hours now.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34191"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 16/09/2015 - 13:09.</div>
    <div class="content">
     <p>Gerry, How have you determined it&#39;s &quot;hanging&quot;. Is that confirmed or based just on the data seen in emonCMS?</p>
<p>You have found the emonTx is still running by connecting the programmer (although be wary there of what order you do things since most OS&#39;s seem to issue a reset on connection of the programmer, so you maybe reseting&nbsp;it during connection).</p>
<p>You have proved it&#39;s not the receiver as restarting it has no effect.</p>
<p>Restarting the emonTx seems to reset things so you conclude it&#39;s the rfm69. That maybe the case but unless you are sure no packets are sent you cannot be 100% and unless you have another receiver if difficult to test.</p>
<p>But you can do a couple of simple checks eg is the rfm2pi&nbsp;LED continuing to flash while the emonTx is &quot;hung&quot; or&nbsp;are there any clues in the emonhub.log during or immediately before the time it&nbsp;&quot;hung&quot;.</p>
<p>There have been one or two&nbsp;cases with devices (usually rfm2pi which have a different set up) losing settings and a reset resets the settings eg node id group id frequency etc.could&nbsp;the emonTx still be sending packet&nbsp;but they not recognized&nbsp;as valid&nbsp;?</p>
<p>There is also a chance of different size intervals slowly rotating at different times so that every n mins/hours/days they block each other, do you have other devices transmitting? (maybe not on same network)</p>
<p>What type of feed are you using in emoncms? if it&#39;s a&nbsp;fixed interval it could be a similar effect to the interval rotation&nbsp;above ie emonTx sending every 15s and fixed interval feed saving every 10 secs, some datapoints will have no data, this may not be obvious if it&#39;s the case as there only needs a couple of seconds difference to occur, this can be tested for by adding a phptimeseries&nbsp;feed in front of the &quot;suspect&quot; feed to check the arrival times etc</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34193"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 16/09/2015 - 13:34.</div>
    <div class="content">
     <p>Though both are specified down to 1.8 V, I did wonder whether there's a supply brown-out at around 5 am when something big switches on that's going down just enough to make the RFM69 lose its marbles but which is not enough to cause the Atmel 328 to reset?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34224"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 17/09/2015 - 08:10.</div>
    <div class="content">
     <p><em>Though both are specified down to 1.8 V... &nbsp;supply brown-out...&nbsp;which is not enough to cause the Atmel 328 to reset?</em></p>
<p>The BOD on those AVR processors is pretty effective. &nbsp;Hopefully the OEM production line doesn&#39;t disable it or set it low. &nbsp;If they used the standard Arduino Uno board settings when flashing the bootloader, it should be set to 2.7V nominal (2.5V worst case). &nbsp;That means the processor will be held in reset whenever the voltage drops below 2.7V and won&#39;t come out of reset until after it&#39;s above 2.7V. &nbsp;You can check the contents of extended fuse bits to see what yours has actually been set to.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34225"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 17/09/2015 - 09:32.</div>
    <div class="content">
     <p>If Gerry is right and it is the radio that's locking up, then as long as the processor stops and resets at a higher voltage than the radio, it <i>should</i> recover and do a full reset - shouldn't it? That I suppose could depend on what happens to the reset line, but the radio will get the required registers set by the sketch at start-up. What we don't know is whether any default values get corrupted.</p>
<p>Mine has now been running for close to 60 hours non-stop, as far as I know (I'm not logging the output). It's certainly not locked up so far.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34226"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 17/09/2015 - 10:09.</div>
    <div class="content">
     <p>I&#39;m not at all familiar with the radio module, but there&#39;ll be no indication on the /RESET line to say the BOD has reset&nbsp;the CPU... that line is only an input to the CPU, never an output. &nbsp;</p>
<p>I always use a RESET_EXTERNAL_DEVICES signal that can be asserted by software to make sure that when the CPU resets (WDOG, BOD or power-up)&nbsp;it can also ensure all peripherals are in a known state. &nbsp; This is particularly important in the case of watchdog resets. &nbsp;A common cause of watchdog resets is a wedged peripheral device, so when the CPU resets it really needs a way to ensure all external hardware is also reset.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34232"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 17/09/2015 - 19:05.</div>
    <div class="content">
     <p><em>&quot;but there&#39;ll be no indication on the /RESET line&quot;</em></p>
<p>Because&nbsp;the reset line is pulled up by V<sub>CC, </sub>I&#39;d have expected it to go down as V<sub>CC</sub> collapsed, and I was wondering how quickly it came back up.&nbsp;But I&#39;ve just realised there&#39;s no reset to the RFM69, so I was barking up the wrong tree there. &nbsp;It does have a reset pin, but it&#39;s the wrong sense and needs to be pulled high for 100&nbsp;&mu;s to work. Always assuming that it is a brown-out and it can be shown that the RFM is entering an unknown state as a result,&nbsp;<em>&quot;when the CPU resets it really needs a way to ensure all external hardware is also reset.&quot;&nbsp;</em>would presumably mean driving the RFM69&#39;s&nbsp;reset from a AT328 output pin; or maybe it would be enough to program &nbsp;<em>every </em>unchanged register to the default value&nbsp;in setup( ).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34235"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Thu, 17/09/2015 - 23:28.</div>
    <div class="content">
     <p>A very quick glance of the&nbsp;RFM69 datasheet reveals it has lots of BOD and glitch detection itself. &nbsp;I&#39;ve come unstuck with multiple BODs running in the one design... either the CPU gets reset and the peripheral IC doesn&#39;t, or the peripheral IC gets reset and the CPU still thinks it&#39;s set up just right. &nbsp;Both are a bit messy to sort out in software, so I always use just the AVR BOD, and make sure the AVR is capable of yanking on RESET off all the external devices.</p>
<p>But I guess it&#39;s a bit late for that review now. &nbsp;It looks like the&nbsp;RFM69 has a sensitive and insensitive setting for its BOD stuff, so playing around with that might reveal more clues. &nbsp;And we still don&#39;t know what the AVR BOD is set to. &nbsp;I&#39;m &nbsp;assuming 2.7V, but it may be set to 1.8V or even disabled. &nbsp; &nbsp;Barring input from whoever flashed the bootloader, you could dump out the extended fuse bits to see which setting they chose.</p>
<p>If you&#39;re really keen you can monitor, count and store the AVR reset reasons which is what I ended up doing (see panel below), but I had to tweak the stk500&nbsp;bootloader to support that. &nbsp;I&#39;ve not looked at optiboot.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34236"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 18/09/2015 - 01:56.</div>
    <div class="content">
     <p>We'll have to wait and see how Gerry responds to all this. At the moment, we're guessing. All I know is what is ostensibly the same sketch has been running here for 3 days now, so until there's some evidence to the contrary, it looks like the sketch is not the problem. Clearly I can't check anything on my emonTx until I stop it, and we've no proof that it's the same as his anyway.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34238"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7218.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="emjay&#039;s picture" title="emjay&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/7218.html" title="View user profile.">emjay</a> on Fri, 18/09/2015 - 09:29.</div>
    <div class="content">
     <p>@dBC,</p>
<p>Which datasheet are you referring to?&nbsp; The RFM69CW-V1.1.pdf does not mention any BOD functionality.</p>
<p>It <em>is</em> present on a <em>variant</em> of the RF chip e.g. RegLowBat (0x0C), but AFAIK that does not match the RFM69CW.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34255"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3016.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dBC&#039;s picture" title="dBC&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/3016.html" title="View user profile.">dBC</a> on Fri, 18/09/2015 - 22:09.</div>
    <div class="content">
     <p>oops, my bad. &nbsp;I didn&#39;t stop to consider the possibility of variants and clicked on the first one I found. &nbsp;Unfortunately I can&#39;t even find that now, but it did have quite a detailed description of the power-on reset process, plus a Vcc glitch detector. &nbsp;There was also a bit in a register that would let you choose between one of two threshold voltages. &nbsp;But it&#39;s all for nought if it&#39;s not the device in use.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34260"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8701.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8701.jpg" alt="Gerry&#039;s picture" title="Gerry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/8701.html" title="View user profile.">Gerry</a> on Sat, 19/09/2015 - 15:00.</div>
    <div class="content">
     <p>Hi</p>
<p>my apologies for not responding earlier to your posts.</p>
<p>A quick update:</p>
<p>after activating the watchdog it keeps reporting continuously. However a look at the serial port reveals that the setup loop is activated after every second regular loop report. So not an elegant solution and but an effective way to keep it running.</p>
<p>@Robert: Grid stability is an issue here and I have recorded minimum voltage drop to 183V. Attached a screenshot recording the voltage over the last week. However I use a DC power supply so I would assume it smoothens these drops out and furthermore I have seen the emontx going through voltage dips of 183V without any issue.</p>
<p>@Paul:&nbsp;I can rule out that interference due to another emontx is the cause or low RSSI values.</p>
<p>When connecting the emonTX to the serial port I don&#39;t think it resets the unit. I am using arduino 1.6.5 software and I&nbsp;have practiced this several times. If it was resetting the unit it would run through the setup function and print out the&nbsp;messages. So when connecting the serial port I haven&#39;t noticed the setup functions but directly the reporting in the loop().</p>
<p>Reporting is done for 5 seconds and on the emonCMS the feeds are averaged over 10sec period. So far I haven&#39;t had the time to look at the logfiles in emoncms. The unit is at my&nbsp;friends place, unfortunately&nbsp;I don&#39;t have a remote access. I will try to get some clues the next day.</p>
<p>So far for today. If you have further suggestions I would be happy to check these out.</p>
<p>Best regards</p>
<p>Gerry</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34261"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 19/09/2015 - 16:44.</div>
    <div class="content">
     <p><i>"I use a DC power supply so I would assume it smoothens these drops out..."</i></p>
<p>A dangerous assumption! It depends on the current drawn and how long the reservoir capacitor in the dc power supply holds the voltage up.</p>
<p>Where in the sketch have you put the watchdog reset? Remember that the maximum setting for the watchdog is 8 s, and the main loop sleeps for 10, therefore you can't put the watchdog reset directly in the main loop - you need to do something with</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;delay(TIME_BETWEEN_READINGS*1000);</p>
<p>e.g. make it into a 'for' loop and reset the watchdog every 1000 ms.</p>
<p>Mine has run for 90 hours now, without a watchdog timer.</p>
<p>[Edit]<br />
If you're using the shop 5 V USB adapter, the label says it will work down to 100 V. Powering a V3.2 emonTX, one I have here worked down to an impressive 29 V.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34280"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8701.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8701.jpg" alt="Gerry&#039;s picture" title="Gerry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/8701.html" title="View user profile.">Gerry</a> on Sun, 20/09/2015 - 10:34.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>thanks for your valuable comments.</p>
<p>Watchdog is at the end of the setup, not in the loop.</p>
<p>TIME_BETWEEN_READINGS I set to 5, so it sleeps for only 5 seconds.</p>
<p>Yes I use the DC power supply from the shop (EU type) so I conclude from from your statement that the power dips won&#39;t effect the power supply to RFM69 and emontx, right?</p>
<p>Cheers</p>
<p>gerry</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34285"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 20/09/2015 - 14:19.</div>
    <div class="content">
     <p><i>"the power dips won't effect the power supply to RFM69 and emontx, right"</i></p>
<p>Right - but only if they are dips, and not complete disappearances. I've no idea for how long that PSU will hold up in the complete absence of mains, but it's looking as if in all probability it would carry through all but the worst dip.</p>
<p>You initiate the watchdog ("wdt_enable(WDTO_8S);") in setup( ). You reset the watchdog ("wdt_reset();") in loop( ). If you're not resetting it, no wonder it's firing and restarting the sketch every 8 s. That's what it's supposed to do.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34319"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8701.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8701.jpg" alt="Gerry&#039;s picture" title="Gerry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/8701.html" title="View user profile.">Gerry</a> on Mon, 21/09/2015 - 09:36.</div>
    <div class="content">
     <p>Thanks Robert for the hint on resetting the watchdog. That explains the behavior. As&nbsp;I wasn&#39;t sure how that watchdog actual works, I wasn&#39;t aware of resetting it.</p>
<p>I came&nbsp;across&nbsp;the wdt_enable from another program and there isn&#39;t&nbsp;any reset made either.</p>
<p>best wishes</p>
<p>Gerry</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34321"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 21/09/2015 - 10:49.</div>
    <div class="content">
     <p><i>"I came across the wdt_enable from another program and there isn't any reset made either."</i></p>
<p>An old engineering axiom: "If you're going to steal an idea, make sure it's a good one."</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34680"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 04/10/2015 - 11:12.</div>
    <div class="content">
     <p>I have had the sketch on soak test for a week or so both without and with the watchdog timer, and there's no evidence of it stopping. So until there's some more data, and bearing in mind that the failures happened at about the same time of day each day, I think I'm blaming something in the local environment.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-34710"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8701.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8701.jpg" alt="Gerry&#039;s picture" title="Gerry&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonTxV3 3-phase monitor stops reporting after 20hours???</h3>

    <div class="submitted">Submitted by <a href="../user/8701.html" title="View user profile.">Gerry</a> on Tue, 06/10/2015 - 02:05.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>as said the environment is anything but consistent and stable here. Even the sockets where the power supply is plugged in are shaky. just last morning the system stopped reporting because the power supply went off.</p>
<p>The day before i realized that all values were negative. after checking on site i realized that someone must have disconnected and reconnected the 9V AC supply but in reverse polarity hence the negative reporting.</p>
<p>So as you can see i cannot rule out someone is fiddling around as well and the system setup&nbsp;might suffer from this.</p>
<p>A good day to all here in the community.</p>
<p>Cheers</p>
<p>Gerry</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11252"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-jhrx_GsXjXthM_zMn4iD4dTIIO9kMhfdcYUXgx5xs6Y" value="form-jhrx_GsXjXthM_zMn4iD4dTIIO9kMhfdcYUXgx5xs6Y"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
