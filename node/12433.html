<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12433 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:45:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Some Thoughts on Separating Visualizations, Data Definitions &amp; Calculation | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Some Thoughts on Separating Visualizations, Data Definitions &amp; Calculation</h3>
        <span class="submitted">Submitted by <a href="../user/8370.html" title="View user profile.">blaal02</a> on Wed, 30/03/2016 - 21:35</span>
        <div class="content"><p abp="728">I&#39;m seeing quite a number of updates &amp; requests on the forums to do with looking at derived values based on data in feeds and presented different ways (Max, Min, Average temp and kWh Delta are the ones that come to mind first). Then on the other side, &#39;Delta&#39; added to some (but not all) of the individual visualizations.<br abp="729" /><br />
I&#39;m wondering if there&#39;s a nice way we can separate and generalize some of these features.</p>
<p abp="730">The Virtual Feeds concept seems like it might be applicable; if we could define a virtual feed that would do these calculations, then we could look at them using any of the existing visualizations.<br abp="731" /><br />
So, for example, we&#39;d want something that would compute a delta, given starting point and a period of time. So a kWh/d virtual feed would use the kWh feed, starting at midnight (hopefully I can specify local or UTC...), for 24 hour periods. Or I might want a weekly one, starting on Monday midnight CET, for a 7 day period. And the same for daily (or weekly, or annual) mean (or max or min) temperatures (or min/max/avg W).<br abp="732" /><br />
Then, in the background, we could choose to optimze and/or cache the calculations. Delta may be OK to calculate real time (we are just read 2 numbers &amp; subtracting), but max/min/avg might need the sampling process. Or we could allow even a virtual feed to have a storage mechanism that would cache results. E.g. daily max temp for today needs calculated by reading all the data points. But outside the current &#39;period&#39; the value isn&#39;t ever going to change, so could be calculated once properly (using all data points) and cached. Calculating an annual mean could take a while - but if the annual mean was instead described as the yearly mean of another virual feed that was the daily mean, it would only be looking at 364 cached data points, plus all the data points for the current day.<br abp="733" /><br />
As another generalization, if we could add &#39;export&#39; as a &#39;visualization&#39;, then that could be applied to any of the virtual feeds. We could think about text or Excel as well as CSV.</p>
<p abp="734">Opinions?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12478.html" class="topic-previous" title="Go to previous forum topic">‹ emoncms.org - password reset not working?</a>
              <a href="12466.html" class="topic-next" title="Go to next forum topic">Problem while upgrade with git. ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-40748"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some Thoughts on Separating Visualizations, Data Definitions & Calculation</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 30/03/2016 - 23:52.</div>
    <div class="content">
     <p>Hello blaal02, Im currently writing a post processing module for emoncms which will be able to be used initially for calculating kWh data from historic power data. But could be easily extended in the way you describe to calculate other more complicated processed outputs such as monthly averages (correct for timezones) or histograms, min, max etc.</p>
<p>The big advantage over input processing is that you dont have to setup everything at the start and by carrying this kind of thing out as a post processing step it significantly reduces write load as data can be written to disk in large blocks (rather than millions of small writes) - it may not even need to be written to disk as you point out such a processed output could be cached in memory as it can be rebuilt from base data at any time.</p>
<p>Here&#39;s the progress I&#39;ve made so far, while it works provisionally, it needs a service script and full installation and use documentation: It can calculate cumulative kwh data from power data, solar export data from solar and consumption input feeds and trim the start of a feed to delete old data.</p>
<p><a href="http://github.com/emoncms/postprocess" title="http://github.com/emoncms/postprocess">http://github.com/emoncms/postprocess</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40768"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8370.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="blaal02&#039;s picture" title="blaal02&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some Thoughts on Separating Visualizations, Data Definitions & Calculation</h3>

    <div class="submitted">Submitted by <a href="../user/8370.html" title="View user profile.">blaal02</a> on Thu, 31/03/2016 - 16:05.</div>
    <div class="content">
     <p abp="712">Hi Trystan,</p>
<p abp="713">Post-processing may be the way to go. So long as the processing is run at least as often as the shortest &#39;period&#39; that&#39;s being calculated over, then the only difference will be the final data point (or maybe two)&nbsp;that represents the current, not yet complete period, and perhaps the prior one that&#39;s complete but the process hasn&#39;t quite run for it yet.</p>
<p abp="714">As I read this, the results of the post-processing is just another feed that can be used by any of the visualizations?</p>
<p abp="715">Post-processing &amp; virtual feeds seem to&nbsp;be rather similar, in the sense that both can be added &quot;after the fact&quot;, and both create additional feeds that pass to normal visualizations.</p>
<p abp="716">So, thoughts&nbsp;about the user interface... 2 UIs describing the same kind of result (differing just in the back end way of getting there) seems a little weird. Maybe rename Virtual Feeds to Calculated? Or Derived? Then have a flag to indicate whether it&#39;s dynamically calculated, or post-processed? Or even decide automatically what the &quot;best&quot; implementation of a particular feed is?</p>
<p abp="717">The &quot;caching&quot; I&#39;d been thinking about was actually storing (on &quot;disk&quot;) the results of anything that wasn&#39;t going to change next time it was requested - which would basically be exactly the same as your post-processing results.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40777"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some Thoughts on Separating Visualizations, Data Definitions & Calculation</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 31/03/2016 - 19:45.</div>
    <div class="content">
     <p>Hello blaal02, from what I understand virtual feeds would not be able to do the kind of calculations required to convert things like power data to kWh data, from what chaveiro describes here <a href="10977.html" title="https://openenergymonitor.org/emon/node/10977">https://openenergymonitor.org/emon/node/10977</a> it can do a sampled approach to averaging that might be quite close to the actual average but its not quite the same as running a process through the entire source feed. Although it does look like it might be sufficient for summing, subtracting feeds, Il admit I havent really used this feature. In my mind it was something else - so perhaps it can do some of the things the post processing module might do but not others.</p>
<p>Perhaps there is an opportunity to combine it in some way, maybe chaveiro can add to the discussion on this.</p>
<p>From my perspective both looking at my current requirements and also taking a longer view the main outputs I want are the ability to</p>
<ul>
<li>calculate export power from solar generation and consumption</li>
<li>isolate export from import/export</li>
<li>isolate consumption from solar + import/export</li>
<li>calculate cumulative kWh feeds as a post process &#39;after the fact&#39; - primarily for this transition period away from kWh per day daily data to cumulative kWh</li>
<li>daily, weekly and monthly averages</li>
<li>histograms such as the amount of power used by a heatpump over a request period for each hour of the day in order to show the typical heating profile.</li>
<li>histograms of energy used at different power&#39;s.</li>
</ul>
<p>Im working on updating the apps module and documentation for home energy monitoring and the solar pv monitor and Id like to make it as easy as possible for people with a lot of existing data to convert their data over to the new feeds, and standardised engines required for these app modules. Trying to develop the app modules to support every feed engine and kwh cumulative or daily data results in endless bugs and support difficulty - so trying to sort that out is my main focus at the moment and the reason Im developing the post processing module.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40780"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some Thoughts on Separating Visualizations, Data Definitions & Calculation</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 31/03/2016 - 19:58.</div>
    <div class="content">
     <p>Once a feed is converted using the post processing module you could either chose to keep running the post processor before you want to view the data which would be a write efficient appraoch for systems running of SD cards but perhaps more likely is that you use the post processor to build the processed feeds you need from historic source data and then once built you connect those feeds back to the source inputs with standard input processing so that they continue to update as new data comes in - which I think addresses your first point &quot; So long as the processing is run at least as often as the shortest &#39;period&#39; that&#39;s being calculated over&quot;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40784"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8370.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="blaal02&#039;s picture" title="blaal02&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some Thoughts on Separating Visualizations, Data Definitions & Calculation</h3>

    <div class="submitted">Submitted by <a href="../user/8370.html" title="View user profile.">blaal02</a> on Thu, 31/03/2016 - 21:22.</div>
    <div class="content">
     <p abp="845">Hi Trystan, I&#39;m with you, I&#39;ve used Virtual Feeds for simple things like adding my 2 split phases (US) to get a total supply. And C to F calculations. But I&#39;ve seen references in there to &#39;Schedules&#39;, and I was wondering if that could be used (or abused!) to be the user interface for those &#39;periods&#39; that we are wanting things delta&#39;d, min&#39;d, max&#39;d, mean&#39;d over - I don&#39;t think it can do that now, but could maybe be &#39;adapted&#39;.</p>
<p abp="845">From an user perspective, I&#39;m thinking this could be how they&#39;d describe what they want to see. Internally, I guess the &#39;ideal&#39; would be all of the things we&#39;ve been talking about! When the feed is used (at &#39;visualization&#39; time), it would look at all the&nbsp;historical data that had been saved by the post-processing, and calculate anything that was beyond that. Depending on what calculation was needed, this could be the sampling process, just for that display. Or it could be a &#39;proper&#39; process using all the data - and that could be added to the stored data (at least for the &#39;completed&#39; periods), or perhaps it could dynamically run&nbsp;your post-processing procedures to get everything current, then show it. Or for some simple calculations, even keep it totally virtual, read original base data every time.</p>
<p abp="845">But, as principles go, I&#39;m again with you - log the basic &quot;raw&quot; data from the sensors. Then separately (perhaps much later, and with several iterations)&nbsp;define what we&#39;d like to actually see on the graphs, but have these all go back historically. Also, it will be good if we can come up with general tools/calculations that can be used to come up with everything you need - but can be (hopefully) be used for other things too.</p>
<p abp="845">For kWh/d processing, going forward you are thinking that we&#39;d log cumulative kWh, then calculate the periodic deltas at display time? But for people that didn&#39;t log cumulative kWh originally, you want the post-processing to be able to back into this from kWh/d data that they did log?</p>
<p abp="845">Thanks, Sandy</p>
<p abp="845">&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40927"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some Thoughts on Separating Visualizations, Data Definitions & Calculation</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Tue, 05/04/2016 - 23:01.</div>
    <div class="content">
     <p>I&#39;ve just read this topic...</p>
<p>Trystan i think what you are describing as post processing&nbsp; is in reality off-line processing of historical data.</p>
<p>Virtual feeds do post processing in realtime.<br />
It has 2 ways of calculating data: sampling or absolute, default config is to be absolute that is slower, but precise.</p>
<p>The concept of virtual feeds is to be used for data visualization, so they are feeds (virtual) that can be inquired via a graphic widget. When you move around the graph, the data is calculated just for that time window you are viewing.</p>
<p>The engine behind supports being called from other code besides graphics and can be used for other purposes. Say for example, you want to make a manual job where the user sets a processlist, defines a start and end time and output the result to a new feed. 90% of the work is already coded in virtual feeds logic.</p>
<p>Post processing in realtime can&#39;t be used to read a large time range of data because it can mean MBs of information and it&#39;s slow.</p>
<p>Off-line post processing can, because you don&#39;t need to wait for it to be ready. You use the data after conversion ends.</p>
<p>Some of the use cases can be done already with virtual feeds realtime post processing.</p>
<p>Yes:</p>
<ul>
<li>calculate export power from solar generation and consumption</li>
<li>isolate export from import/export</li>
<li>isolate consumption from solar + import/export</li>
</ul>
<p>Yes, with a dedicated processor and on a limited time range (or it becomes very slow):</p>
<ul>
<li>daily, weekly and monthly averages</li>
<li>histograms of energy used at different power&#39;s.</li>
<li>histograms such as the amount of power used by a heatpump over a request period for each hour of the day in order to show the typical heating profile</li>
</ul>
<p>No, because of the need to read full source feed data, and it&#39;s slow:</p>
<ul>
<li>calculate cumulative kWh feeds as a post process &#39;after the fact&#39; - primarily for this transition period away from kWh per day daily data to cumulative kWh</li>
</ul>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12433"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-avbqO9_NDBcJZhsDJAl1aOXBujA5y0v4EtXnVonloxo" value="form-avbqO9_NDBcJZhsDJAl1aOXBujA5y0v4EtXnVonloxo"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
