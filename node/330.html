<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/330 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:35:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonTX Firmware Questions | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonTX Firmware Questions</h3>
        <span class="submitted">Submitted by Guest on Tue, 03/01/2012 - 17:50</span>
        <div class="content"><div class="content">
<p>Hi All,</p>
<p>Ive recently completed a build of the EmonTX (previously using Mains Non-Invasive V3).</p>
<p>After looking through the various firmware options I've been using the following firmware <a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_1CT_Voltage"><font color="#3399cc">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTx_1CT_Voltage</font></a></p>
<p>as I wish to monitor both voltage and current (one CT). To do this im using a 9v transformer to measure mains voltage. However, my values are off by quite a bit.....for example the EmonTX output monitored via its serial port (real, apparent, VRMS, IRMS, supplyV)</p>
<p>7.59 82.53 343.41 0.24 3164</p>
<p>In relation to the firmware above - could anybody explain the numbers in the calibration code here...</p>
<p>emon1.calibration(357.6,126.5,0); <br />
&nbsp; emon1.calc(20,2000,vcc );</p>
<p>I think I need to substitute these for my own. Im also confused as the previous V3 firmware had declarations for the number of CT turns, burden resistor value etc. to calculate the scaling factor - none of these are mentioned in the firmware above. Thus, where my mains voltage is 240V (238V at present) the EmonTX is returning 343.41.</p>
<p>In addition, I have the CT connected at present to channel 1 (changed code to reflect this), however there is no wire through it at present so it cannot be reading any current. Yet however, Im showing an apparent and real power measurement. Obviously this would introduce errors into the system at times whereby voltage is being measured byt current consumption is zero or practically zero. Indeed with the above example the current consumption is nearly 0 at 0.24a but still the power calculations are off.</p>
<p>I am using an SCT-013-000 CT&nbsp; - it came with the EmonTX kit. Anybody know how many turns is on this CT?</p>
<p>Thanks in advance for your time - hopefully somebody can shed some light on this - or explain how I can calibrate the EmonTX properly.</p>
<p>&nbsp;</p>
<p>Kind regards</p>
<p>Gerard Gallagher</p>
</div>
  <div class="forum-topic-navigation clear-block">
          <a href="368.html" class="topic-previous" title="Go to previous forum topic">‹ Open Energy Monitor Logo ?</a>
              <a href="343.html" class="topic-next" title="Go to next forum topic">Frustrating subscription alerts! ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-2648"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX Firmware Questions</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 06/01/2012 - 23:24.</div>
    <div class="content">
     <p>Hi Gerard,</p>
<p>Sorry for the slow reply, I've got round to doing some lab testing today to investigate the problem.&nbsp;</p>
<p>The problem was caused by a new batch of AC-AC adapters we are using (new adapters are better, the don't have a +2V offset see: <a href="http://openenergymonitor.blogspot.com/2011/12/ac-ac-adapters.html">http://openenergymonitor.blogspot.com/2011/12/ac-ac-adapters.html</a>), the calibration in the code was not updated to reflect the change.&nbsp;</p>
<p>The new code is as follows:</p>
<p>The voltage examples on github have been updated and the Single CT Voltage example has been made to work with Arduino 1.0</p>
<pre>
emon1.setPins(2,0);                    //emonTX AC-AC voltage (ADC2), current pin (CT2 - ADC0)
emon1.calibration(234.89,126.5,1.7);   //voltage calibration , current calibration, power factor calibration
emon1.calc(20,2000,vcc );              //No.of wavelengths, time-out , emonTx supply voltage 

<br type="_moz" /></pre><p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2663"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gg339&#039;s picture" title="gg339&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX Firmware Questions</h3>

    <div class="submitted">Submitted by gg339 (not verified) on Sun, 08/01/2012 - 12:35.</div>
    <div class="content">
     <p>&nbsp;Hi Glyn,</p>
<p>Thanks for the reply. &nbsp;I'll give that a go.&nbsp;</p>
<p>However I'm not using one if your tx's- rather one I had lying around</p>
<p>Would you mind at your convenience just explaining How you arrive at the calibration figures so I can recalibrate for my tx if necessary.&nbsp;</p>
<p>Kind regards</p>
<p>Gerard</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2664"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX Firmware Questions</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 08/01/2012 - 13:31.</div>
    <div class="content">
     <p>&nbsp;I came up with the calibration values be comparing the power reading, voltage reading and PF reading with a plug-in energy monitor and a bit of ittrative trail and error. Basicly just change the calibration values untill the energy monitor readings match what the plug-in monitor reads.&nbsp;</p>
<p>I calibrated the voltage first, then current then PF.&nbsp;</p>
<p>New calibration value = (Old value/ new value) * current calibration coefficient&nbsp;</p>
<p>emon1.calibration(voltage cal , current cal ,PF cal);&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2673"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gb095666&#039;s picture" title="gb095666&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX Firmware Questions</h3>

    <div class="submitted">Submitted by gb095666 (not verified) on Mon, 09/01/2012 - 01:05.</div>
    <div class="content">
     <p>The way I calculated the calibration figures was to first of all change the defaults to emon1.calibration(100.00,100.00,1.0); and took note of the figures coming out of the serial monitor, at the same time used a plug in energy monitor to obtain the actual figures being used.</p>
<p>Take for example a Hair Dryer I&nbsp;had, the figures coming out from the serial monitor was VMRS&nbsp;= 105.89, IRMS = 6.89, the plug in monitor gave me Volts = 241 and Amps = 8.42, using that I can calculate the calibration figures.</p>
<p>(&nbsp;Volts * 100)&nbsp;/ VRMS = Calibration figure , which is&nbsp; ( 241 * 100) / 105.89 = 227.59</p>
<p>(&nbsp;Amps *&nbsp;100)&nbsp;/ IRMS = Calibration figure , (8.42 *&nbsp;100) / 6.89 = 122.20</p>
<p>The reason I was 100.00 as the initial figure and not 1.0 was is gave me better precision in my calculation.</p>
<p>In order to calculate the Power Factor you need to add &quot;powerFactor1 = emontx.real1 / apparent1;&quot; in the Measure from CT1 section and print out the variable in the serial_ouput section using &quot;Serial.print(powerFactor1);&quot;</p>
<p>If you then do the same for other household items such as Vacum Cleaner, Iron, Heater, Fridge etc you get a range of figures but all should be roughly in the same ballpark, my voltage figures were between 227.59 to 230.55, all I did was take the average to get the figure I went with.</p>
<p>As Glyn says there is a bit of trail and error involved, but you can get pretty accurate, for instance my setup is within 5 watts of what my solar inverter is saying its generating.</p>
<p>Hope that helps</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2700"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="gg339&#039;s picture" title="gg339&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonTX Firmware Questions</h3>

    <div class="submitted">Submitted by gg339 (not verified) on Thu, 12/01/2012 - 14:56.</div>
    <div class="content">
     <p>Hi all,</p>
<p>&nbsp;</p>
<p>Thanks again for your comments - Ive followed the procedure as above and found that the device is now calibrated to the correct readings. A little trial and error was indeed required.</p>
<p>Thanks again for your time</p>
<p>&nbsp;</p>
<p>Regards</p>
<p>Gerard</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/330"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-i3fVLkF2E73Cla3AxJe3ng3DFdznVNszRNPI8rhXYL8" value="form-i3fVLkF2E73Cla3AxJe3ng3DFdznVNszRNPI8rhXYL8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
