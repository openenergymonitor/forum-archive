<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6135 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:30:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>EmonGLCD 3-phase: Power Now only showing CT1 | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">EmonGLCD 3-phase: Power Now only showing CT1</h3>
        <span class="submitted">Submitted by <a href="../user/6969.html" title="View user profile.">ajscheid</a> on Sun, 16/11/2014 - 06:43</span>
        <div class="content"><p>Hi there,</p>
<p>I managed to built my emonglcd&nbsp;yesterday, tested it successfully and even managed to get the Home Energy Monitoring sketch to run.</p>
<p>First problem was the time&nbsp;zone issue, which I managed to sort out with the help of the forum.</p>
<p>Now my problem is the following:</p>
<p>I have a domestic 3 phase system here (South Africa). It seems the sketch is only fetching the POWER NOW value of CT1.</p>
<p>I would require to display the total watts as sum of CT1, CT2 and CT3 on the emonGLCD but I don&#39;t have a clue how to get started and where to find the correct place to implement this.&nbsp;</p>
<p>The second thing I realized is that the backlight is constantly on during day time. Is that normal?</p>
<p>And the third but obviously not the last question; even though I tested the buttons successfully they don&#39;t do anything with this example sketch. Is that supposed to be like that?</p>
<p>Is there any place I can learn how to customize the data displayed on the emonglcd and use its full potential.&nbsp;I have CT4 connected to my Geyser, which I would like to be displayed on another page using the up/down buttons on the emonGLCD. Possible?</p>
<p>Thanks a lot for your time spent to answer this kind of nooby questions.........</p>
<p>&nbsp;</p>
<p>Cheers,</p>
<p>Antonius</p>
  <div class="forum-topic-navigation clear-block">
          <a href="6154.html" class="topic-previous" title="Go to previous forum topic">‹ Mk2 pv router with arduino for 240v, testing issues</a>
              <a href="6116.html" class="topic-next" title="Go to next forum topic">Controling remote power switches with RFM12Pi ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-25164"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 16/11/2014 - 13:37.</div>
    <div class="content">
     <p>I think you need to look at the sketches that you have running - both in your emonTx and your GLCD, take a look at the Building Blocks article on how the data is transferred (<a href="https://learn.openenergymonitor.org/?redirect=rfm12b2">RFM12B - Part 2</a>) because you'll need to modify one or both sketches. Which one(s) depends also on what you want to send to emonCMS (assuming you will at some point in the future, though you don't mention it now).</p>
<p>Your problem is that there's very little spare memory for additional code in the emonGLCD, so the less you add in there, the better.</p>
<p>First, the total power. If you <b>don't</b> want the individual power on each phase displayed, the sensible place to add them is in the emonTx. If you look at that sketch, you'll find the 3 powers are assigned to 3 variables in the <i>emontx</i> struct, like this: "emontx.power1=ct1.realPower;"<br />
You simply need to remove the 3 individual variables from that struct and replace them with totalPower (say) then, at the end of the loop when you've calculated the 3rd power, add all 3 and assign the total: "totalPower = ct1.realPower + ct2.realPower + ct3.realPower;"<br />
Then in the GLCD, you need to make the emontx struct exactly the same as in the emonTx, and then you'll need to write totalPower to the display somehow.</p>
<p>If you want the 3 individual powers, then instead you add them in the GLCD, then use the total and write it to the display.</p>
<p>The backlight: It turns off overnight, according to the internal clock that's set by a message from the emonCMS server. In daytime, the brightness varies according to the ambient light.</p>
<p>You can find an explanation of the SolarPV sketch <a href="https://github.com/openenergymonitor/EmonGLCD/blob/master/SolarPV/SolarPV_code_explanation.md">here</a> <i>[and it took me a while to find that! ! !] </i><br />
That sketch uses the buttons to change pages. They're not used in your sketch.<br />
That article should show you how to write different data to and edit the display. As always, ask again if you're stuck.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25166"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6518.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="JD&#039;s picture" title="JD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/6518.html" title="View user profile.">JD</a> on Sun, 16/11/2014 - 15:22.</div>
    <div class="content">
     <p>I made that change to my GLCD. &nbsp;In fact, I needed to add all 4 CT&#39;s together to get total power in my case. &nbsp;I had to change 3 lines in the &quot;emon_GLCD_HomeEnergyMonitor&quot; sketch:</p>
<p>&nbsp;</p>
<p>Payload line change:</p>
<p>from&nbsp;</p>
<pre>
typedef struct { int power1, power2, power3, Vrms; } PayloadTX;         // neat way of packaging data for RF comms</pre><p>​to</p>
<pre>
typedef struct { int power1, power2, power3, power4, Vrms, temp; } PayloadTX;        </pre><p>&nbsp;</p>
<p>and to do the calculation adding all 4 CT&#39;s:</p>
<p>from:</p>
<pre>
    usekwh += (emontx.power1 * 0.2) / 3600000;

    cval_use = cval_use + (emontx.power1 - cval_use)*0.50;        //smooth transitions

<span class="rangySelectionBoundary" id="selectionBoundary_1416150868713_9514902967493981" style="display:none; line-height:0">﻿</span>to:

 usekwh += (((emontx.power1 + emontx.power2 + emontx.power3 + emontx.power4)*.5) * 0.2) / 3600000;                    

    cval_use = cval_use + (((emontx.power1 + emontx.power2 + emontx.power3 + emontx.power4)*.5) - cval_use)*0.50;        // sum all sensors smooth transitions

</pre><p>I&#39;m pretty new to this, so my code may be crude! &nbsp;But it does get the correct results on the LCD.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25168"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 16/11/2014 - 16:09.</div>
    <div class="content">
     <p>Yes, that's because the sketch was written when the emonTx V3 did not exist, and the V2 has only 3 current inputs! </p>
<p>Rather than repeated adding of all 4 powers, you could invent a variable for total power as I suggested - it can be local to the GLCD and not shared with the emonTx via the struct.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25171"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6518.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="JD&#039;s picture" title="JD&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/6518.html" title="View user profile.">JD</a> on Sun, 16/11/2014 - 16:53.</div>
    <div class="content">
     <p>I always appreciate learning from you Robert, thank you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25174"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 16/11/2014 - 17:29.</div>
    <div class="content">
     <p>I have developed a 3-phase PCB which has three voltage sensors and can monitor real power on each of the phases.&nbsp; Data transmissions are similar to those from an emonTx.&nbsp; The software is very similar to the &quot;CM&quot; code for emonTx - because I wrote them both!</p>
<p>This board is intended to divert surplus power using &quot;Mk2 Router&quot; principles in a 3-phase setting, but it can also be used for monitoring too.&nbsp; More details at <a href="http://mk2pvrouter.co.uk/61101.html">http://mk2pvrouter.co.uk/61101.html</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25188"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6969.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ajscheid&#039;s picture" title="ajscheid&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/6969.html" title="View user profile.">ajscheid</a> on Mon, 17/11/2014 - 13:43.</div>
    <div class="content">
     <p>Thanks Robert,</p>
<p>&nbsp;</p>
<p>that is exactly the information I needed. Being new to that whole stuff it can become quite overwhelming with all these different sketches, structs, variables and you name it. Clearly I have to up my&nbsp;basics to understand this whole topic.</p>
<p>I actually didn&#39;t know that I have a sophisticated 4-wire 3-phase system when I ordered the components.</p>
<p>I will give it a try later today.</p>
<p>Playing around with the equipment yesterday I discovered various things which seems to make my home grid look a bit faulty wired up:</p>
<p>I installed the 3 way sketch on the emontx measuring the voltage on phase 1 (CT1). On that phase I get proper readings using my toaster as purely resistive load. I verified the data from the emontx against my efergy appliance meter.</p>
<p>The second phase also behaves mor or less correct attaching the same resistive load.</p>
<p>But the third one behaves strange;&nbsp;the emontx delivers negative values, around -15 Watts with no load. If I switch on the lights (LED) emontx delivers the correct difference (like 60 Watt bulb - 15 Watts = 45 Watts). But if I use a wall plug which is on the phase 3 and connect my resistive load I receive negative values which dont correspond to my resistive load, i. e. erfergy meter. In addition it seems like the data from the other 2 phases get influenced by the load on the phase 3..... Could it be that the wall plug is wired up the wrong way?</p>
<p>I will give more details later whenn I checked carefully.</p>
<p>&nbsp;</p>
<p>My first question now (I know, I am jumping all over the place here):&nbsp;</p>
<p>How do I calibrate the phase 3 so it doesn&#39;t show the negative value; assuming that single wall plug I used is&nbsp;the only one behaving funny (didn&#39;t test the others). I tried to understand the calibration method but wasn&#39;t able to follow. What I assume I understood correctly is that all the correction factors relate only to the CT&#39;s and&nbsp;AC-AC adaptor used for the system. Is that correct? If so, how do I change the&nbsp;sketch to get zero reading on my 3rd phase with no load?</p>
<p>Back to topic: The back light of the emonGLCD doesn&#39;t turn off during night with the example sketch. Settings on the emoncms server are correct and the time in the display is also correct. Still have to look into that also.....&nbsp;&nbsp;&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25193"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 17/11/2014 - 16:00.</div>
    <div class="content">
     <p>When you write <i>"I installed the 3 way sketch..."</i>, do you in fact mean the <a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/Examples/emonTxV3_3Phase_Voltage">EmonTx V3 3-phase sketch from GitHub</a>? (Just to be sure we're talking about the same thing.)</p>
<p>If you connect your ac adapter to the socket on phase 3, and plug the CT into CT1, does it read correctly? If it gives negative power then, reverse the CT on its cable. (Do the same with Phase 2). Then, if you cannot calibrate phases 2 &amp; 3, it may mean that they are swapped over.</p>
<p>The sketch also assumes you are measuring voltage line - neutral, and that the voltages remain symmetrical (the same amplitude) so the voltages and currents in the 2nd &amp; 3rd lines (with a resistive load of course) are 120&deg; approx displaced from line 1. As you say you have a 4-wire system (the 4th wire being neutral, not earth!) then that should be OK. The only way that I can think of, for the data to interact, is if your neutral is not solid and the line-neutral voltages are not symmetrical and change dramatically with load changes. If that's the case, I'm afraid there is no solution other than 2 more emonTx's, one per phase.</p>
<p>What country are you in?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25197"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6969.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ajscheid&#039;s picture" title="ajscheid&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/6969.html" title="View user profile.">ajscheid</a> on Mon, 17/11/2014 - 19:35.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>first of all thank you so much for your response!</p>
<p>I am in South Africa. And yes, that&#39;s the sketch I installed but will verify that again tomorrow.&nbsp;I played around with the system tonight. It seems at least 2 out of three phases are calculated more or less correctly.&nbsp;</p>
<p>in South Africa the phases are color coded as red, blue, white and black (neutral). I assume it is the same as in the UK?</p>
<p>i call the red phase my phase 1 where I red the voltage on. All the measurements are accurate on this phase.</p>
<p>Phase 2 &nbsp;(blue) is the phase showing a negative value of -15 without load. For testing purposes I added a constant of +15 int the emoncms and log the corrected value to a feed. I found out that the ground floor lights are connected to this phase and the values under load seem are corresponding.</p>
<p>i couldn&#39;t test phase 3 (white) as the wife is home and I would have to kill everything to find out what appliances are actually running of that phase.</p>
<p>my plan is, once wifey&nbsp;and kids are out of the house to draw up table of all plugs in the house and then switch off all the circuit brakers&nbsp;except for one to find out which plugs are on which phase. At the moment it is more or less unclear as there are more than 40 outlets, around 50 light outlets, pool pump, geyser, electric gate, electric garage door, cctv and you name it.</p>
<p>The initial purpose of the whole exercise was to reduce our consumption as I am sitting on an average of 28 kWh/d.</p>
<p>Let&#39;s see if I can get there.</p>
<p>I already thought about the alternative of 2 more emontx and maybe some DIN rail outlets so I can hook up the AC adaptors directly at the switch board. Haven&#39;t found anything adequate though up to now.</p>
<p>will make some pictures of my setup which I will post for clarification.</p>
<p>&nbsp;</p>
<p>Cheers,</p>
<p>Antonius</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25199"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 17/11/2014 - 22:23.</div>
    <div class="content">
     <p>You might like to look at a little DIN-rail meter that J&ouml;rg Becker posted about a couple of months ago: <a href="5743.html" title="http://openenergymonitor.org/emon/node/5743">http://openenergymonitor.org/emon/node/5743</a><br />
Obviously you've got to break into the circuit to fit it, which might have regulatory issues apart from the safety aspect (which is why we always use CTs), so it might be a non-starter for you.</p>
<p>And yes, I understand Red, Yellow/White and Blue as phase colours although the UK has now "harmonized" with Europe with Brown, Black and Grey and a Blue neutral. So everyone with an older house now has a sticker that warns that there are two different standards in use. Or as I've seen written: "That's the beauty of standards, there are so many to choose from!"</p>
<p>Note the White phase is the <b>second</b> phase so that should be on CT2 input, and blue on CT3. If you have 2 &amp; 3 crossed over, that's the source of wrong readings.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25202"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6969.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ajscheid&#039;s picture" title="ajscheid&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/6969.html" title="View user profile.">ajscheid</a> on Tue, 18/11/2014 - 08:56.</div>
    <div class="content">
     <p>That&#39;s great info; the whole time I had the question of which is phase one, two and three! Just forgot to ask...;-)</p>
<p>Just for my understanding:</p>
<p>Red = Phase 1</p>
<p>White = Phase 2</p>
<p>Blue = Phase 3</p>
<p>Correct?</p>
<p>&nbsp;</p>
<p>Next question is related to the calibration of the system; The calibration values of the sketch are as follows:</p>
<p>&nbsp;</p>
<p>78 #define PHASE2 8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; Number of samples delay for L2<br />
79 #define PHASE3 18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp; Number&nbsp; of samples delay for L3, also size of array<br />
80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; These can be adjusted if the phase correction is not adequate<br />
81&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; Suggested starting values for 4 ct&#39;s:<br />
82&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; PHASE2&nbsp; 6<br />
83&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; PHASE3 15<br />
84&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;//&nbsp;&nbsp;&nbsp; Phasecal2 = 0.57<br />
85&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp;&nbsp; Phasecal3 = 0.97<br />
86</p>
<p>I will use CT4 on my Geyser. So according to above I should set the sample delay at&nbsp;#define PHASE2 to 6 and PHASE 3 to 18 for a starting point. The phasecal2 and 3 values are then to be changed to 0.57 and 0.97. What exactly does the sample delay?<br />
&nbsp;</p>
<p>
108 //Calibration coefficients<br />
109 //These need to be set in order to obtain accurate results<br />
110 double Vcal = 276.9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for voltage input<br />
111 double Ical1 = 90.9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for current transformer 1<br />
112 double Ical2 = 90.9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for current transformer 2<br />
113 double Ical3 = 90.9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for current transformer 3<br />
114 double Ical4 = 16.6;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for current transformer 4</p>
<p>Question: Do I have to change the Vcal value in that way that emoncms reads exactly the voltage which I measure on my&nbsp;Phase 1. In my case the Vcal value would then be set to 243.6 to get a reading of 239 as shown on my multimeter. Or am I on the wrong path? I believe the Ical values I don&#39;t have to touch as I am using the CT&#39;s&nbsp;which I&nbsp;purchased together with the emontx?<br />
&nbsp;<br />
116 double Phasecal1 = 1.00;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for phase shift L1<br />
117 double Phasecal2 = 1.35;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for phase shift L2<br />
118 double Phasecal3 = 1.37;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for phase shift L3<br />
119 double Phasecal4 = 1.00;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calibration constant for phase shift CT 4</p>
<p>Question: In case I use CT4 I have to change the Phasecal as per information further up. In case I don&#39;t use CT4 I leave them as is? Is this the place where I adjust the final readings if they are completely off?</p>
<p>Sorry for this real beginner questions but up to know I didn&#39;t get my head around that stuf...;-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25220"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 18/11/2014 - 13:44.</div>
    <div class="content">
     <p><b>PLEASE CHECK THAT YOUR COMMENT HAS HOT BEEN HELD FOR MODERATION BEFORE YOU POST MULTIPLE COPIES</b></p>
<p>You should see a message that tells you if your post has gone into the moderation queue. It takes time and effort to weed out copies that I'm sure you'll agree is better served answering questions and helping people like you.</p>
<p>The 'phase rotation' <i>should</i> be as you state. There's no absolute guarantee, but it's unlikely that your electricity supplier will have got it wrong.</p>
<p>As there are 4 CT inputs and only three phases, and CT 4 is rated differently, it is "spare". The Phase 1 voltage is delayed in the array so as to line up with the second and third phases. Adding the extra CT reading takes time, so the time between successive samples is longer, hence there will be less of them by the time the next phase comes around.  However, the choice of the array element with PHASE2 and PHASE3 is only a coarse adjustment. PHASECAL provides a fine adjustment. If you cannot read a power factor of 1 by adjusting PHASECAL over the range 0 - 2 (or better still 0 - 1) then you need to change PHASE2 and/or PHASE3 until you can. You can read how PHASECAL works in Building Blocks.</p>
<p>The "standard" calibration values are starting points. Component tolerances mean they can never be exact, so if possible you should adjust them to give you the correct values (assuming your meter is accurate). You can read in Building Blocks how the tolerances affect accuracy.</p>
<p>You must do the calibration exactly in the order that I say in the comments at the beginning of the sketch, as the values are inter-dependant.</p>
<p>To get the correct real power with CT 4, you need to use the correct delayed voltage. If your Geyser is on Phase 1 as specified, then the sketch as-is is OK. If it is on one of the other phases, you need to change line 395: sumP4 += phaseShiftedV1 * filteredI4; to use the appropriate voltage.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-25226"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6969.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ajscheid&#039;s picture" title="ajscheid&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: EmonGLCD 3-phase: Power Now only showing CT1</h3>

    <div class="submitted">Submitted by <a href="../user/6969.html" title="View user profile.">ajscheid</a> on Tue, 18/11/2014 - 17:43.</div>
    <div class="content">
     <p>Sorry Robert,&nbsp;</p>
<p>I didn&#39;t want to waist your time. Indeed the massage came up that the post is queued but unfortunately I only realized it after posting the 3rd or 4 th time.... My apologies.</p>
<p>i will now go back and study the building blocks once again. Eventually I will get there.</p>
<p>Thank you for you assistance, highly appreciated!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6135"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-z-qC3SIsUwioGkmtP1jnd_w3kEkd7sTHPcXyRe8HH5E" value="form-z-qC3SIsUwioGkmtP1jnd_w3kEkd7sTHPcXyRe8HH5E"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
