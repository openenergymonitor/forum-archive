<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11722 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:15:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Continuous Sampling EmonPi and EmonTx v3.4 examples | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>
        <span class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Tue, 01/12/2015 - 16:37</span>
        <div class="content"><p><strong>Update&nbsp;</strong></p>
<p>continuous&nbsp;sampling&nbsp;firmware for the emonPi&nbsp;is currently in beta testing:</p>
<p><a href="https://github.com/openenergymonitor/emonpi/tree/master/firmware" title="https://github.com/openenergymonitor/emonpi/tree/master/firmware">https://github.com/openenergymonitor/emonpi/tree/master/firmware</a></p>
<p><strong>Latest version:&nbsp;V3.2 (31/01/15) </strong></p>
<p><a href="https://github.com/openenergymonitor/emonpi/blob/master/firmware/CHANGE LOG.md " title="https://github.com/openenergymonitor/emonpi/blob/master/firmware/CHANGE%20LOG.md ">https://github.com/openenergymonitor/emonpi/blob/master/firmware/CHANGE%...</a></p>
<p>To update the ATmega328 on your emonpi you need to edit the file ~/emonpi/emonpiupdate and comment out the discrete sampling fimrware and un-comment the&nbsp;continuous sampling firmware. Then run admin &gt; update emonpi&nbsp;e.g.:</p>
<pre style="font-size:80%">
# Discrete Sampling 
#echo &quot;Discrete Sampling:&quot;
#echo &quot;avrdude -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 115200 -U
#flash:w:/home/pi/emonpi/Atmega328/emonPi_RFM69CW_RF12Demo_DiscreteSampling/compiled
 /emonPi_latest.hex&quot;
#avrdude -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 115200 -U
#flash:w:/home/pi/emonpi/Atmega328/emonPi_RFM69CW_RF12Demo_DiscreteSampling/compiled
 /emonPi_latest.hex

# Continuous Sampling
echo &quot;Continuous Sampling:&quot;
echo &quot;avrdude -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 115200 -U
 flash:w:/home/pi/emonpi/firmware/compiled/latest.hex&quot;
avrdude -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 115200 -U
 flash:w:/home/pi/emonpi/firmware/compiled/latest.hex</pre><p><a href="https://github.com/openenergymonitor/emonpi/blob/master/emonpiupdate" title="https://github.com/openenergymonitor/emonpi/blob/master/emonpiupdate">https://github.com/openenergymonitor/emonpi/blob/master/emonpiupdate</a></p>
<p><b>Known Issues</b></p>
<p>Issues with receiving data from other RF nodes stopping working after about 24hrs, require a reset, power cycle or change of settings to restore operation.&nbsp;</p>
<p>&nbsp;</p>
<p>--------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Earlier last year, Robin Emley built a continuous sampling example for general OpenEnergyMonitor emontx v3.4 use. Due to work on other things at the time, I couldn&#39;t do the final integration work needed to replace the existing discrete sampling approach that we are using in our standard emonpi and emontx v3.4 firmware.</p>
<p>Over the last couple of weeks, I have spent some time on this again and have now created an example for both the emontx v3.4 and emonpi that uses Robin&#39;s continuous sampling code while also supporting all the other requirements.</p>
<p>One of the requirements of the emontx v3.4 is the ability to run in both battery powered mode where it sleeps between discrete readings, and powered mode where it can be on all the time. I adapted Robin&#39;s code to be able to be stopped and started again so that the emontx v3.4 can be in continuous sampling mode when powered from the ACAC adapter and USB, but can also switch to discrete sampling mode when being powered by batteries.</p>
<p>I&#39;ve wrapped the code up into an Arduino library to make the main firmware examples neater, which can be found here:</p>
<p><a href="https://github.com/openenergymonitor/EmonLibCM">https://github.com/openenergymonitor/EmonLibCM</a></p>
<p>Here&#39;s a code example using the library for an idea of what it looks like:</p>
<pre>
#include &lt;Arduino.h&gt;
#include &quot;EmonLibCM.h&quot;

#include &lt;JeeLib.h&gt;
ISR(WDT_vect) { Sleepy::watchdogEvent(); }

void setup()
{  
  Serial.begin(9600);
  Serial.println(&quot;EmonTx v3.4 EmonLibCM Continuous Monitoring Tester&quot;);
 
  EmonLibCM_number_of_channels(4);       // number of current channels
  EmonLibCM_cycles_per_second(50);       // frequency 50Hz, 60Hz
  EmonLibCM_datalog_period(10);          // period of readings in seconds
 
  // number of cycles to let ADC run before starting first actual measurement
  // larger value improves stability if operated in stop-&gt;sleep-&gt;start mode
  EmonLibCM_min_startup_cycles(10);      
                                         

  EmonLibCM_voltageCal(0.84);            // 260.4 * (3.3/1023)
 
  EmonLibCM_currentCal(0,90.9*(3.3/1023));  // 2000 turns / 22 Ohms burden resistor
  EmonLibCM_currentCal(1,90.9*(3.3/1023));  // 2000 turns / 22 Ohms burden resistor
  EmonLibCM_currentCal(2,90.9*(3.3/1023));  // 2000 turns / 22 Ohms burden resistor
  EmonLibCM_currentCal(3,16.6*(3.3/1023));  // 2000 turns / 120 Ohms burden resistor

  EmonLibCM_phaseCal(0,0.22);
  EmonLibCM_phaseCal(1,0.41);
  EmonLibCM_phaseCal(2,0.60);
  EmonLibCM_phaseCal(3,1.25);
 
  EmonLibCM_Init();
}

void loop()             
{
  if (EmonLibCM_Ready())   
  {
    Serial.print(EmonLibCM_getRealPower(0)); Serial.print(&#39;:&#39;);
    Serial.print(EmonLibCM_getWattHour(0)); Serial.print(&#39;,&#39;);
    Serial.print(EmonLibCM_getRealPower(1)); Serial.print(&#39;:&#39;);
    Serial.print(EmonLibCM_getWattHour(1)); Serial.print(&#39;,&#39;);
    Serial.print(EmonLibCM_getRealPower(2)); Serial.print(&#39;:&#39;);
    Serial.print(EmonLibCM_getWattHour(2)); Serial.print(&#39;,&#39;);
    Serial.print(EmonLibCM_getRealPower(3)); Serial.print(&#39;:&#39;);
    Serial.print(EmonLibCM_getWattHour(3)); Serial.print(&#39;,&#39;);
    Serial.print(VrmsTimes100);
    Serial.println();
    
    // UNCOMMENT TO TEST STOP/START SLEEP OPERATION
    // EmonLibCM_Stop();
    // delay(50);
    // Sleepy::loseSomeTime(10000);
    // EmonLibCM_Start();
  }
}</pre><p>Crucially, Robin&#39;s code runs in the &#39;background&#39; on an ISR (interrupt service routine) and so is compatible with other code running in the main loop including temperature sensing and RFM12/69 radio operation.</p>
<p>I&#39;ve put together a EmonPi and EmonTx v3.4 example here, these include temperature sensing, pulse counting and rfm12/69 radio operation and all the other bits and pieces in the standard firmware. I&#39;m currently running tests on these and early results look good.</p>
<p><strong>EmonPi continuous sampling example</strong></p>
<p><a href="https://github.com/openenergymonitor/emonpi/tree/master/Atmega328/emonPi_RFM69CW_RF12Demo_ContinuousSampling">https://github.com/openenergymonitor/emonpi/tree/master/Atmega328/emonPi_RFM69CW_RF12Demo_ContinuousSampling</a></p>
<p><strong>EmonTx v3.4 continuous sampling example</strong></p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_Continuous_Beta">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_Continuous_Beta</a></p>
<p>My last test with the emontx v3.4 code showed a small amount of power consumption when there was nothing physically connected - about 0.3 kWh over 5 days which I need to check. I also added in radio ACK&#39;s to the emontx v3.4 code and watt hour calculation on the emontx. I&#39;m still testing the reliability of the radio comms with this much longer data packet.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12538.html" class="topic-previous" title="Go to previous forum topic">‹ Send message to Emonhub</a>
              <a href="12310.html" class="topic-next" title="Go to next forum topic">Emoncms.org development: next steps ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-36582"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 02/12/2015 - 14:12.</div>
    <div class="content">
     <p>The small amount of power consumption measured with nothing connected is around 2.5W on average and is present to a similar extent with the discreet sampling firmware on some of the channels on the emontx that I&#39;m testing with.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36587"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 02/12/2015 - 14:55.</div>
    <div class="content">
     <p>I&#39;m happy now that the EmonPi Continuous Sampling example is ready for final testing. Would anyone perhaps with a MK2 or other triac based PV diverter and an EmonPi be interested in testing? Or anyone who can do parallel testing with a utility meter. We will keep testing here over the next week and aim to move over to it as the standard firmware on the emonPi if all goes well in a week&#39;s time.</p>
<p>The steps to upload the emonpi continuous sampling code are:</p>
<p>ssh in to the emonpi<br />
cd emonpi<br />
git pull<br />
sudo service emonhub stop</p>
<p>avrdude -v -c arduino -p ATMEGA328P -P /dev/ttyAMA0 -b 115200 -U flash:w:/home/pi/emonpi/Atmega328/emonPi_RFM69CW_RF12Demo_ContinuousSampling/compiled/emonPi_RFM69CW_RF12Demo_ContinuousSampling.cpp.hex</p>
<p>sudo service emonhub start</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36607"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Thu, 03/12/2015 - 07:24.</div>
    <div class="content">
     <p>This sounds like a great improvement. Do you end up with the same calibration values with the new firmware compared to the old? I spent a long time calibrating one of my EMONTX&#39;s&nbsp;and redoing it will be physically&nbsp;difficult&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36639"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9006.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9006.png" alt="alexg&#039;s picture" title="alexg&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9006.html" title="View user profile.">alexg</a> on Thu, 03/12/2015 - 18:48.</div>
    <div class="content">
     <p>can this work on an emontx 3.2 &nbsp;for 3 phase monitoring?</p>
<p>cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36709"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 04/12/2015 - 15:44.</div>
    <div class="content">
     <p>Probably not, without a lot of work. You would need to take the basic 'continuous' sketch, graft in the array that's needed to delay the voltage samples to synchronise them with phases 2 &amp; 3 currents, and deal with timing issues. My approach - when I can find the time - will be a phase-locked loop, and that should completely negate the problems with timing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36717"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9006.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9006.png" alt="alexg&#039;s picture" title="alexg&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9006.html" title="View user profile.">alexg</a> on Fri, 04/12/2015 - 16:33.</div>
    <div class="content">
     <p>thanks Robert,&nbsp;</p>
<p>I take it there&#39;s no continuous sketch for 3 phase for the 3.2 that is currently availalbe?</p>
<p>Cheers,</p>
<p>Alex</p>
<p>/edit: i have had a nightmare of trying to calibrate my emontx, i assume because of the timings you mentioned, and i don t think it s right still..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36899"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 10/12/2015 - 15:31.</div>
    <div class="content">
     <p>The testing I&#39;ve performed this week with the emonpi continuous sampling code is showing a slightly more noisy reading with a standard deviation of ~5W at around 150W instead of 2-3W that was typical with the discreet sampling code on the same emonpi at similar power levels. I would have expected it to be less than the discreet sampling as the power values should be averaged over a longer time. Testing continues..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36900"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Thu, 10/12/2015 - 17:37.</div>
    <div class="content">
     <p>Trystan, from my tests while coding EmonlibPro some months ago i could get 0-0.01W if CT was not attached to cable and 0-0.2W readings when the live measured power cable was unloaded.</p>
<p>Assumed residual W&#39;s due to rf noise picked up from the environment as electric cable acts as an antenna. Long term test shown that noise was lower during night.</p>
<p>If you&#39;re not getting such low values check power supply noise, etc. Or try to use my lib as a test.</p>
<p>Found that post:</p>
<p><a href="10111.html" title="http://openenergymonitor.org/emon/node/10111">http://openenergymonitor.org/emon/node/10111</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36906"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 11/12/2015 - 00:55.</div>
    <div class="content">
     <p>alexg:<br />
<i>"I take it there's no continuous sketch for 3 phase for the 3.2 that is currently availalbe?"</i></p>
<p>That's true at the moment, but I'm working on it. It's based on MartinR's PLL, which <i>should</i> negate a lot of the timing problems.</p>
<p>As it stands, your 3-phase sketch depends on the mains frequency being stable. If it drifts, it will introduce phase errors - all details are in the comments (I think!).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9006.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9006.png" alt="alexg&#039;s picture" title="alexg&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9006.html" title="View user profile.">alexg</a> on Fri, 11/12/2015 - 06:29.</div>
    <div class="content">
     <p>thanks robert, eagerly awaiting :D</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36922"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 11/12/2015 - 12:49.</div>
    <div class="content">
     <p>Thanks Chaveiro, I was referring to the standard deviation on a 150W night time level rather than the zero power level, but your 0-0.2W sounds really nice and low compared with the 2.5W I read above. Yes might be a power supply or other issue will do some more testing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36939"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 11/12/2015 - 22:11.</div>
    <div class="content">
     <p>Sometimes, I find an idle channel that displays a drift of zero.&nbsp; A while later, the same hardware channel can display a positive drift of maybe half a watt.&nbsp; Occasionally, I&#39;ve seen a negative drift.</p>
<p>When full scale is set for several kW, I think these minute drifts are more to do with quantisation effects than with any genuine errors in the measurement system.</p>
<p>Reducing the range over which the measurement system operates should help to minimise these effects.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37082"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 16/12/2015 - 12:18.</div>
    <div class="content">
     <p>Thanks Robin, Testing again now with an emontx v3 and Im getting better results than the discrete sampling code.</p>
<p>Standard deviation @ 52Watts direct sampling code 1.2<br />
Standard deviation @ 2335Watts direct sampling code 2.5</p>
<p>Standard deviation @ 30Watts continuous sampling code 0.4<br />
Standard deviation @ 2335Watts continuous sampling code 1.9</p>
<p>kWh calculated on the emonpi with the power to kwh accumulator:</p>
<p>Continuous sampling: 14.38<br />
Discrete sampling: 14.83<br />
A100C billing grade meter: 6109.9 &rarr; 6124.5 14.6</p>
<p>Voltage calibration was set to 260.4 on both continuous sampling and discreet sampling code and current calibration was also the same 90.9. Continuous sampling is 1.5% below and Discreet is 1.5% above which is within the range of possible error. That&#39;s without individual calibration to take into account the voltage reference and component tolerances: <a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory" title="http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor-installation-and-calibration-theory">http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37087"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 16/12/2015 - 13:10.</div>
    <div class="content">
     <p>Latest emonTx v3.4 continuous sampling code: <a href="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_Continuous_Beta/emonTxV3_4_Continuous_Beta.ino" title="https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3/RFM/emonTxV3.4/emonTxV3_4_Continuous_Beta/emonTxV3_4_Continuous_Beta.ino">https://github.com/openenergymonitor/emonTxFirmware/blob/master/emonTxV3...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37089"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 16/12/2015 - 13:54.</div>
    <div class="content">
     <p>The emonhub decoder for this example is:</p>
<p>[[10]]<br />
&nbsp;&nbsp;&nbsp; nodename = emonTx_CM<br />
&nbsp;&nbsp;&nbsp; firmware = emonTxV3_4_Continuous_Beta_0_2<br />
&nbsp;&nbsp;&nbsp; hardware = emonTx_(NodeID_DIP_Switch1:OFF)<br />
&nbsp;&nbsp;&nbsp; [[[rx]]]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; names = msg,power1, power2, power3, power4, Vrms, T1, T2, T3, T4,pulse,fail<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scales = 1,1,1,1,1,0.01,0.1,0.1,0.1,0.1,1,1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; datacodes = L,h,h,h,h,h,h,h,h,h,L,L<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; units = n,W,W,W,W,V,C,C,C,C,n,n</p>
<p>I&#39;ve missed out the sending of the accumulating watt hours in this example for now as the power consumption in sending the longer packet alongside all the temperature values causes the emontx to reset.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38172"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Tue, 12/01/2016 - 04:04.</div>
    <div class="content">
     <p>I&#39;ve just given this a try and it appears as node 42 in EMONCMS v8.5 lowwrite, despite the code suggesting it should be node 10 which it is with the discrete sampling firmware.</p>
<p>EMONHUB (EMONPI Version) says&nbsp;</p>
<p>MQTT INFO Received mqtt message: emonhub/rx/42/values 39,0,801,540,1,2,23200,380,655,663,3000,0,0,38,0</p>
<p>the debug window says&nbsp;data: 809 540 1 1 23200 0 378 655 663 , 4477ms</p>
<p>The received data appears to be</p>
<p>msg, ???, power1, power2, power3, power4, Vrms, T1,T2,T3, ???, 0,0,??,0</p>
<p>Which is different to the EMONHUB settings&nbsp;above which I entered into my node10 config section.</p>
<p>I have 4 x CT, Mains, 3 x 1Wire&#39;s connected to the EMONTXV3.4</p>
<p>What am I missing?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38178"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 12/01/2016 - 12:21.</div>
    <div class="content">
     <p>In JeeLib&nbsp;a &quot;node id&quot;&nbsp;bettween&nbsp;32 and 64 is basically a node between 0 and 31 with the &quot;ack&nbsp;bit&quot; set,&nbsp;I suspect you might be&nbsp;using an&nbsp;rfm12 or early rfm69 type RFM2Pi, there was a firmware issue that didn&#39;t mask the first 3 bits of the&nbsp;byte to only pass the remaining 5 bits as a node id.&nbsp;</p>
<p>This is not &nbsp;usually a problem if you do not use ack&#39;s. Trystan was working on this at the same time as researching the reliability of the rfm network so I suspect this sketch had the acks enabled and the &quot;fail&quot; count at the end.&nbsp;Updating the firmware in the RFM2Pi should fix this issue properly although you could also edit the emonTx sketch to not require acks.</p>
<p>The other problem with the value count and payload format is due to the use of Longs in the emonTx payload so the first 2 ints are actually&nbsp;1 long and the same for the last 4 ints being 2 Longs</p>
<p><strong>msg, ???</strong>, power1, power2, power3, power4, Vrms, T1,T2,T3, ???, <strong>0,0,??,0</strong></p>
<p>[[[rx]]]<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; names = <strong>msg</strong>,power1, power2, power3, power4, Vrms, T1, T2, T3, T4,<strong>pulse,fail</strong><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; scales = 1,1,1,1,1,0.01,0.1,0.1,0.1,0.1,1,1<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; datacodes = <strong>L</strong>,h,h,h,h,h,h,h,h,h,<strong>L,L</strong><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; units = n,W,W,W,W,V,C,C,C,C,n,n</p>
<p>There are also 4 temperture sensor values, the 3 you have populated and the 4th is automatically set to an &quot;out of scope&quot; value of 300 so it is obviously not a temperture rather than being 0 which could be interpreted as a temperture and if there are several zeros it could cause a &quot;bitslip&quot; issue and packets get dropped.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38392"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9309.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PBudmark&#039;s picture" title="PBudmark&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9309.html" title="View user profile.">PBudmark</a> on Sun, 17/01/2016 - 18:33.</div>
    <div class="content">
     <p>While trying to understand the fine details in EmonLibCM (and also EmonLib) I have spotted what I think is an error in EmonLibCM (as of Latest commit 84993d5 on Nov 25, 2015) dealing with phaseCal</p>
<p>​In function EmonLibCM_interrupt(), when processing a voltage sample (sample_index=0) the (static) variable sampleV_minusDC_long is calculated, and later copied into the (global) variable lastSampleV_minusDC_long. Also in function EmonLibCM_interrupt(), when processing a current samples (sample_index &gt;=1), a calculation is done:</p>
<p>phaseShiftedSampleV_minusDC_long = lastSampleV_minusDC_long + (((sampleV_minusDC_long - lastSampleV_minusDC_long)*phaseCal_int_CT[sample_index-1])&gt;&gt;8);</p>
<p>To my understanding, the part (sampleV_minusDC_long - lastSampleV_minusDC_long) will always result in zero, effectively zeroing the effect of phaseCal.</p>
<p>The assignment:<br />
​lastSampleV_minusDC_long = sampleV_minusDC_long; // required for phaseCal algorithm<br />
has to be moved upwards (first in section), before the new value of sampleV_minusDC_long is calculated.</p>
<p>In EmonLib, the corresponding processing works, as the old value is saved first in processing (lastFilteredV = filteredV;) then the current value is calculated. Later the new and the old value is (correctly) used in the phaseShift calculation:</p>
<p>phaseShiftedV = lastFilteredV + PHASECAL * (filteredV - lastFilteredV);</p>
<p>Per-Ake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38405"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 17/01/2016 - 21:33.</div>
    <div class="content">
     <p>Certainly, I get a power factor of 1.00 irrespective of the value I put for phasecal (even stupid values). And that isn&#39;t right. In Robin&#39;s original diverter sketches, from which this is derived, the assignment &nbsp;&nbsp;lastSampleV =&nbsp;&nbsp;SampleV was at the end of &nbsp;allGeneralProcessing(&nbsp;) and that&nbsp;appears to have been missed in the conversion.</p>
<p>Also a question for Trystan: why is the voltage returned as an integer? Clearly, there was an intention to return it as Voltage * 100, for compatibility with emonCMS one presumes,&nbsp;as that&#39;s what is in the example sketch - and which doesn&#39;t work because it doesn&#39;t exist!</p>
<p>I&#39;ve flagged this to Trystan.</p>
<p>[Edit]</p>
<p><s>I agree.&nbsp;Moving the line&nbsp;<br />
&nbsp; &nbsp; &nbsp;lastSampleV_minusDC_long = sampleV_minusDC_long; &nbsp;// required for phaseCal algorithm</s></p>
<p><s>to just above<br />
&nbsp; &nbsp; &nbsp;&nbsp;sampleV_minusDC_long = ((long)rawSample&lt;&lt;8) -&nbsp;DCoffset_V_long;</s></p>
<p><s>seems to be what is required. &nbsp;This&nbsp;position is equivalent to where&nbsp;Robin had it (after the first voltage sample had been processed). I can&#39;t see any side effects as yet.</s></p>
<p>I&#39;ve spotted the real problem. In Robin&#39;s version, &nbsp;lastSampleV_minusDC_long&nbsp;&nbsp;was declared as &quot;static&quot;. Changing the declaration to &nbsp;<strong>static </strong>long lastSampleV_minusDC_long; to make it persist between calls to the ISR is the correct solution to keep the versions aligned as far as possible.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38567"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9309.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PBudmark&#039;s picture" title="PBudmark&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9309.html" title="View user profile.">PBudmark</a> on Wed, 20/01/2016 - 23:20.</div>
    <div class="content">
     <p>To my understanding, as the current declaration of the variable is done in the global space, it behaves the same as static in the aspect of keeping the value between interactions, so only changing to static long doesn&#39;t solve the issue.</p>
<p>The sequencing is still the problem as these variables are intended to hold values from two separate (adjacent) voltage samples, not one single.</p>
<p>/Per-Ake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38574"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 21/01/2016 - 12:32.</div>
    <div class="content">
     <p>The phaseCal algorithm synthesizes a time-shifted version of the voltage stream which can serve to offset any phase error in the measurement equipment.&nbsp; For each such calculation, the latest and previous filtered voltage values are needed.&nbsp; With this latest library code, phaseCal calculations for individual CT channels are done during separate visits to the ISR, so both of these values must persist from one visit to the next.&nbsp; Whether these two variables are defined as globals or static will not affect the behaviour of the code, only its readability</p>
<p>As I understand it, the basis for these latest routines in EmonLib is the &quot;continuous&quot; code that I supplied for using the emonTx V3.2 as a Mk2 Router.&nbsp; This code can be found at at <a href="10171.html">http://openenergymonitor.org/emon/node/10171</a></p>
<p>In that code, the filtered values of the latest and previous voltage samples are stored as globals.&nbsp; These two variables are <em>sampleVminusDC_long</em> and <em>lastSampleV_minusDC_long</em>.&nbsp; Because these variables are only used in <em>ISR()</em>, it would be tidier for them to be defined as static within that routine.&nbsp; But they will work equally well as globals.</p>
<p>At the top of <em>ISR()</em> is an unhelpful declaration for <em>static long sampleV_minusDC_long</em>.&nbsp; This variable is never used so is serving no purpose other than to cause confusion.&nbsp; Sorry about that, I should have removed it.</p>
<p>In previous versions of my &quot;continuous&quot; code, a complete set of ADC samples was dealt with during each visit to the processing routine so only one voltage value (for the previous filtered voltage sample) had to persist from one loop to the next.&nbsp; But with this latest version, where all of the time-critical processing takes place within the ISR, two persistent values are needed.&nbsp; This alternative scheme was devised to prevent slow activities such as temperature sensing from disrupting the underlying sampling process.</p>
<p>In previous versions, the latest value for filtered voltage was calculated at the top of the processing routine, then repeatedly used for each of the current streams, and finally stored as &#39;previous&#39; at the end.&nbsp; With the new arrangement, I now agree with Per-Ake that the &#39;previous&#39; value needs to be stored <u>before </u>the new value is assigned rather than afterwards as occurs at present.&nbsp; Given the way that my code is currently structured, none of the subsequent phaseCal calculations will have any effect.&nbsp; For this error I can only apologise.</p>
<p>Phase-shift and phaseCal have minimal effect on calculations for real power which is my main area of interest, hence I have never needed to use this aspect of the code myself. &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38585"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 21/01/2016 - 14:44.</div>
    <div class="content">
     <p>Thanks Robert, Robin, Per-Ake, Is this the correct change: <a href="https://github.com/openenergymonitor/EmonLibCM/commit/2e5a74e727db4127586599c9d84a8c9b7edc491d" title="https://github.com/openenergymonitor/EmonLibCM/commit/2e5a74e727db4127586599c9d84a8c9b7edc491d">https://github.com/openenergymonitor/EmonLibCM/commit/2e5a74e727db412758...</a> I havent had a chance to test this yet.</p>
<p>We&#39;re getting some stability problems on the EmonPi with the continuous sampling code which I need to look into. Arduino does show a &quot;Low memory available, stability problems may occur.&quot; error at compilation.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38597"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 21/01/2016 - 17:24.</div>
    <div class="content">
     <p>Trystan, I don&#39;t see any need to change the declaration of any variables.&nbsp; The only change that&#39;s needed is as described by Per-Ake a few posts ago, i.e.</p>
<p>The assignment:<br />
​lastSampleV_minusDC_long = sampleV_minusDC_long; // required for phaseCal algorithm<br />
has to be moved upwards (first in section), before the new value of sampleV_minusDC_long is calculated.</p>
<p>RE</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38644"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 23/01/2016 - 14:36.</div>
    <div class="content">
     <p>Robert has highlighted a couple of issues with EmonLibCM and has kindly offered to help debug. For anyone thinking of trying the code, it may be best to wait for now until these issues are resolved. Robert or I will post up once we are happy its ready for further testing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38725"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Mon, 25/01/2016 - 18:33.</div>
    <div class="content">
     <p>Paul,</p>
<p>Thanks for the reply,&nbsp;can you point me to instructions how to update the RFM2Pi&nbsp;please - didn&#39;t know the modules were updatable. It&#39;s an RFM69 type shipped April / May last year</p>
<p>thanks</p>
<p>Kevin</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38726"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9309.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PBudmark&#039;s picture" title="PBudmark&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9309.html" title="View user profile.">PBudmark</a> on Mon, 25/01/2016 - 18:53.</div>
    <div class="content">
     <p>Sheppy,<br />
Hi, Per-Ake jumping in.</p>
<p>The article&nbsp;<br />
<a href="http://wiki.openenergymonitor.org/index.php/RFM69Pi_V3" title="http://wiki.openenergymonitor.org/index.php/RFM69Pi_V3">http://wiki.openenergymonitor.org/index.php/RFM69Pi_V3</a><br />
describes setup and maintenance of the RFM69Pi_V3-module</p>
<p>Per-Ake</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38727"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Mon, 25/01/2016 - 19:25.</div>
    <div class="content">
     <p>Thanks very much, will get onto that later, although I&#39;ll keep away from this sketch until it&#39;s ready for testing again</p>
<p>cheers</p>
<p>​Kevin</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38728"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Mon, 25/01/2016 - 20:36.</div>
    <div class="content">
     <p>OK, just tried that and I don&#39;t think it went that well. When I issued the AVRDude command I got the following back - does anyone have an idea what&#39;s wrong? I&#39;ve tried it with an earlier sketch before I installed Openhab&nbsp;with the same results</p>
<p>avrdude: Version 6.1, compiled on Jul &nbsp;7 2015 at 13:18:47<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Copyright (c) 2000-2005 Brian Dean, <a href="http://www.bdmicro.com/" title="http://www.bdmicro.com/">http://www.bdmicro.com/</a><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Copyright (c) 2007-2014 Joerg Wunsch</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;System wide configuration file is &quot;/etc/avrdude.conf&quot;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;User configuration file is &quot;/home/pi/.avrduderc&quot;<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;User configuration file does not exist or is not a regular file, skipping</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Using Port &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: /dev/ttyAMA0<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Using Programmer &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: arduino<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Overriding Baud Rate &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 38400<br />
avrdude: stk500_getsync() attempt 1 of 10: not in sync: resp=0x4f<br />
avrdude: stk500_getsync() attempt 2 of 10: not in sync: resp=0x4b<br />
avrdude: stk500_getsync() attempt 3 of 10: not in sync: resp=0x20<br />
avrdude: stk500_getsync() attempt 4 of 10: not in sync: resp=0x39<br />
avrdude: stk500_getsync() attempt 5 of 10: not in sync: resp=0x20<br />
avrdude: stk500_getsync() attempt 6 of 10: not in sync: resp=0x36<br />
avrdude: stk500_getsync() attempt 7 of 10: not in sync: resp=0x32<br />
avrdude: stk500_getsync() attempt 8 of 10: not in sync: resp=0x20<br />
avrdude: stk500_getsync() attempt 9 of 10: not in sync: resp=0x31<br />
avrdude: stk500_getsync() attempt 10 of 10: not in sync: resp=0x20</p>
<p>avrdude done. &nbsp;Thank you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38729"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Mon, 25/01/2016 - 20:53.</div>
    <div class="content">
     <p>After an extensive spot of searching the forum&nbsp;I found this</p>
<p><a href="http://wiki.openenergymonitor.org/index.php/RFM12Pi_V2#Upgrading_RFM12Pi_Firmware_Direct_from_the_Pi" title="http://wiki.openenergymonitor.org/index.php/RFM12Pi_V2#Upgrading_RFM12Pi_Firmware_Direct_from_the_Pi">http://wiki.openenergymonitor.org/index.php/RFM12Pi_V2#Upgrading_RFM12Pi...</a></p>
<p>once I followed that I got a successful flash and then flashed it with the correct RFM69 version. Hopefully that will have me ready for testing the continuous sketch when its ready.</p>
<p>Thanks for your help!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38730"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9309.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="PBudmark&#039;s picture" title="PBudmark&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9309.html" title="View user profile.">PBudmark</a> on Mon, 25/01/2016 - 21:04.</div>
    <div class="content">
     <p>By running the the git clone-command specified in the RFM69Pi_V3&nbsp;article above, the original&nbsp;avrdude&nbsp;is renamed to&nbsp;avrdude-original&nbsp;and&nbsp;a wrapper is installed replacing the name avrdude. This wrapper manipulates the DTR-line and invokes avrdude-original.</p>
<p>Correct invokation&nbsp;of the wrapper and the wrapper invoking avrdude-original&nbsp;results in the following start of messages:<br />
avrdude-original: Version 6.1, compiled on Jul 7 2015 at 13:18:47</p>
<p>It seems that your installation is not correct.</p>
<p>/Per-Ake</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39452"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 15/02/2016 - 23:18.</div>
    <div class="content">
     <p>Is anyone running the continuous sampling code on emonPi?</p>
<p>See the top post for update instructions and latest version info.&nbsp;</p>
<p>I have noticed an issue&nbsp;with received data from other RF nodes not working after about 24hrs. Requires a reset, power cycle, or change of settings to restore operation. Has anyone else notice this?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40254"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9397.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Xino&#039;s picture" title="Xino&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9397.html" title="View user profile.">Xino</a> on Fri, 11/03/2016 - 10:51.</div>
    <div class="content">
     <p>I&#39;ve just installed this code on an emonpi as per update instructions on first post. No&nbsp;RF nodes at the moment so not really helpful for the requested test but I just wanted to say that this code seems to be more accurate and generates smoother graphs. Attached is a screenshot of the before and after code deployment at 09:13.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40256"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 11/03/2016 - 12:17.</div>
    <div class="content">
     <p>Great, good to hear. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9397.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Xino&#039;s picture" title="Xino&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9397.html" title="View user profile.">Xino</a> on Fri, 11/03/2016 - 12:54.</div>
    <div class="content">
     <p>Quick question...</p>
<p>Does this code auto detect temp sensors connected to the RJ45?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40259"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 11/03/2016 - 13:01.</div>
    <div class="content">
     <p>Yes, it should. Please let us know if it does not</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40276"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9397.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Xino&#039;s picture" title="Xino&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9397.html" title="View user profile.">Xino</a> on Sat, 12/03/2016 - 14:05.</div>
    <div class="content">
     <p>The temperature sensor is detected but readings jump from actual temperature to 25.5&ordm;C&nbsp;every once in awhile. I tested with the discrete sampling code and that does no happen.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40277"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 12/03/2016 - 15:03.</div>
    <div class="content">
     <p>Following&nbsp;a&nbsp;previous post here, further investigations revealed&nbsp;major flaws in&nbsp;the initial version of emonLibCM, leading to&nbsp;inaccurate results in at least two areas: reporting the value of current and accumulating the energy&nbsp;measured. This should be borne in mind when calibrating and testing. I think the voltage and real power readings are credible, current and energy readings - any anything derived from either -&nbsp;are not.&nbsp;I think these problems will not directly affect the temperature measurements, but a further timing problem might well be the cause.</p>
<p>And for anyone waiting for the three-phase sketch, I&#39;m afraid work has stopped pending resolution of this.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40281"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6366.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="nrgbod&#039;s picture" title="nrgbod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/6366.html" title="View user profile.">nrgbod</a> on Sat, 12/03/2016 - 19:10.</div>
    <div class="content">
     <p><strong><em>Is anyone running the continuous sampling code on emonPi?</em></strong></p>
<p><strong><em>See the top post for update instructions and latest version info.&nbsp;</em></strong></p>
<p><strong><em>I have noticed an issue&nbsp;with received data from other RF nodes not working after about 24hrs. Requires a reset, power cycle, or change of settings to restore operation. Has anyone else notice this?&nbsp;</em></strong></p>
<p>Glynn, this is&nbsp;the behaviour&nbsp;I was seeing when I had a Jessie image created from the December instructions&nbsp;on my Rpi with a&nbsp;continuous sampling sketch on my emontx. The Rpi ceased receiving rf nodes after 24hrs and only a reboot would start it receiving again. When I rebuilt the Rpi using Minibian from January instructions this locking out of RF nodes ceased and everything has ran fine since.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40283"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Sat, 12/03/2016 - 21:24.</div>
    <div class="content">
     <p>@Robert wall</p>
<p>is the inaccuracy fault still present?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40284"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 12/03/2016 - 22:31.</div>
    <div class="content">
     <p>The library is still a work in progress. I&#39;ve no intention of releasing an update until I am sure it works correctly and&nbsp;accurately. I&#39;m not aware of anything that&#39;s happening to the emonPi version, but Trystan &amp; Glyn&nbsp;know that I&#39;m working on this, so it&#39;s unlikely that they will duplicate the effort.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40285"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Sat, 12/03/2016 - 22:34.</div>
    <div class="content">
     <p>Thanks for the clarification, do you have a rough eta for the new version?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40288"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 13/03/2016 - 00:21.</div>
    <div class="content">
     <p>I don&#39;t have. I&#39;m trying to get it done as quickly as I can, but I won&#39;t be making any promises.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40290"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Sun, 13/03/2016 - 02:11.</div>
    <div class="content">
     <p>All good, no point in releasing it before it&#39;s sorted.</p>
<p>my system needs recalibrating&nbsp;as there is a discrepancy between the meter and EMONCMS. So&nbsp;I&#39;ll insert a calibration value and&nbsp;wait until the continuous firmware is perfected before I do it properly</p>
<p>cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40294"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 13/03/2016 - 11:24.</div>
    <div class="content">
     <p>If it&#39;s the kWh accumulator, I found an integer multiplication where a floating point was needed - that&#39;s what was making the accumulated energy wrong. Here&#39;s my note:</p>
<pre>
Wh accumulating error: Forced fp calc in
&nbsp; residualEnergy_CT[i] = energyNow - (wattHoursRecent * 3600.0);&nbsp;
&nbsp; __________________________________________________________^^
</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40299"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Sun, 13/03/2016 - 21:28.</div>
    <div class="content">
     <p>@RobertWall&nbsp;I&#39;m currently on the discrete firmware and my plan is to move to continuous sampling when its ready and recalibrate&nbsp;everything&nbsp;when I do. I use EMONCMS&nbsp;itself&nbsp;to calculate accumulating energy. My biggest problem is with PV Exported which EMONCMS reports to be around double what it is in reality which I think is caused by my phase angle power diverters causing an incorrect value at low export readings on the grid CT, and higher readings on the water heater receiving the divert.&nbsp;I&#39;m hoping the continuous firmware will be more accurate for my setup</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40301"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 13/03/2016 - 22:45.</div>
    <div class="content">
     <p>Kevin - a continuous monitoring sketch will indeed be far more accurate but it may not resolve the discrepancy you are seeing&nbsp;in accumulated import and/or export numbers, when using a diverter the principle of oscillating in the &quot;sweet zone&quot; means you are switching between export and import and the greater the accuracy of your monitor the more likely you are to record a fair chunk of diverted energy in both the imported and exported totals despite having done neither.</p>
<p>e.g. 1hour of 50% phase angle diverting a 3kW will probably&nbsp;rack up both 3kW of export and 3kW of import</p>
<p>I regularly see this happen. I have a set up that simply doesn&#39;t export except on the hottest summer days. This is confirmed by the grid CT power flow and the permanently lit led on the meter, and yet my accumulated export continues to grow, I have also confirmed my import is over&nbsp;by the same amount and the numbers are&nbsp;that accurate that I can get a pretty&nbsp;accurate &quot;meter reading&quot; from emonCMS by subtracting my phantom export from my import.&nbsp;This all goes out the window during the summer as I produce too much to use and as soon as actual export occurs there is no way to differentiate real from phantom export.&nbsp;</p>
<p>The phantom export is a direct indication&nbsp;of how well the oscillating&nbsp;part of the diverter is functioning so as annoying as the discrepancy is, the greater it is the better. This has been brought up before and some code in the firmware to ignore import/export whilst in the &quot;sweet zone&quot; is needed.</p>
<p>(I&#39;m currently&nbsp;using &quot;MartinR&#39;s PLL&quot; based firmware not CS)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40303"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Sun, 13/03/2016 - 23:07.</div>
    <div class="content">
     <p>Paul,</p>
<p>thanks for the reply, I too am setup to avoid exporting. I&#39;m not seeing the same discrepancy as you, in fact right now I&#39;m showing 26 watts of import, 2147 watts of solar, 896 into the spa pool and 67 into the HWC. Usually the grid according to EMONCMS&nbsp;sits somewhere between -120 &amp; +120Watts, but in reality the export according to the meter is about half what it shows and the import is higher.</p>
<p>Take a look at the attached - is this as good as it&#39;ll get?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40379"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9397.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Xino&#039;s picture" title="Xino&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9397.html" title="View user profile.">Xino</a> on Wed, 16/03/2016 - 19:05.</div>
    <div class="content">
     <p>Been running this code for 4 days. All OK except&nbsp;temperature sensor readings jump from actual temperature to 25.5&ordm;C&nbsp;every once in awhile. I tested with the discrete sampling code and that does no happen.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40416"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8729.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Peter Galbavy&#039;s picture" title="Peter Galbavy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/8729.html" title="View user profile.">Peter Galbavy</a> on Fri, 18/03/2016 - 15:41.</div>
    <div class="content">
     <p>Is there any value in me trying the emonTX beta firmware and sketch at this point - all my CTs are on one emonTX and not the Pi - or has there been enough feedback and it&#39;s easier to wait for another release?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40420"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 18/03/2016 - 22:09.</div>
    <div class="content">
     <p>See my answer to Sheppy above. I&#39;m still working on it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40483"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9662.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MikeSims&#039;s picture" title="MikeSims&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9662.html" title="View user profile.">MikeSims</a> on Mon, 21/03/2016 - 10:57.</div>
    <div class="content">
     <p>Just for interest, I recently bought the emonTXShield for my Arduino Uno, and I have it now running a slightly tweaked version of the current emonPi Continuous Sampling firmware, and connected via UART serial to an adjacent Raspberry Pi 2 running the Feb2016 SD image.&nbsp; The tweaks to firmware.ino were just amending the calibration factors for a 5Vcc Arduino Uno, as opposed to the 3.3V emonPi, and dealing with the lack of LCD and RF hardware on the shield.</p>
<p>I had some bother with the CS firmware steadfastly not reporting any data even though the startup phase showed credible Vrms, and CT1 detected, etc, and after putting in some diagnostic lines in it to display a couple of variables, it seemed clear that while credible voltages actually were seen, no current was apparent, so no power, and even with the perceived voltages, the structured data output never reported any of it, all I ever got was an unremitting stream of zeros after the OK and 5, terminated with (-0).</p>
<p>So I set about testing various other serial inos all of which reported credible volts and amps, but the CS versions would report nothing. I was beginning to suspect that some hardware difference was getting in the way, but could not see why.</p>
<p>By the fourth day I (yesterday) tried the EmonTXV34CM.ino, and it worked perfectly, reporting CT1 power,and Vrms even via the structured output! And when I returned to my tweaked emonpi firmware.ino that also worked perfectly, even though nothing had changed in it since the last time it had been run without result. I know that the EmonTXV34CM.ino was an early version, but it worked right away. I suspect it did something to the ADC or Interrupt which the firmware version hadn&#39;t, but was retained in the Arduino when I resent the firmware.ino, allowing it to run correctly.</p>
<p>I would love to know what that could have been!</p>
<p>I am running the emoncms app on a cheap Android tablet, and the reported power matches pretty well with a commercial energy monitor unit I bought from Maplin, usually within a Watt or two. The Maplin unit claims accuracy of +/- 1.5%, and updates its display every second, while emoncms updates much more slowly so comparisons are going to be inexact for a varying power usage anyway.</p>
<p>&nbsp;</p>
<p>I am delighted with the result and will be migrating the kit from the test bed onto the house feed in the next day or so.&nbsp;</p>
<p>Mike</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40484"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9662.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MikeSims&#039;s picture" title="MikeSims&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9662.html" title="View user profile.">MikeSims</a> on Mon, 21/03/2016 - 11:05.</div>
    <div class="content">
     <p>Apologies, it was the emonTxV3_continuous.ino that worked the miracle, not the EmonTXV34CM.ino. The emonTxV3_continuous.ino did not use the EmonLibCM, and applied its own ADC configs.</p>
<p>Mike</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40485"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9662.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MikeSims&#039;s picture" title="MikeSims&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9662.html" title="View user profile.">MikeSims</a> on Mon, 21/03/2016 - 11:20.</div>
    <div class="content">
     <p>Hmmm... I think something else worked the miracle, the ADC settings for the emonTxV3_continuous.ino are identical to the settings in EmonLibCM. A mystery.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40487"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 21/03/2016 - 11:33.</div>
    <div class="content">
     <p>As I have repeatedly written, there are serious problems with the emonLibCM&nbsp;library. I am working on it. Unless you are really, really desperate, there is no point in duplicating what I am doing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40490"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9662.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MikeSims&#039;s picture" title="MikeSims&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9662.html" title="View user profile.">MikeSims</a> on Mon, 21/03/2016 - 12:16.</div>
    <div class="content">
     <p>Hi, Robert, I was not attempting to step on anyone&#39;s toes, and no, I am not at all desperate, I was merely mentioning that I had got something working, because it was something I was interested in doing.</p>
<p>I haven&#39;t the slightest intention of duplicating your work because my level of understanding in these matters is pretty shallow, and I fully expect to use any future release you come up with that I can make work with my TxShield, and I shall do so with real gratitude for your sterling efforts, and for that of any others who can and do make significant contributions for this or indeed any other aspects of this project.</p>
<p>I do not consider myself to be one of them, so rest easy. If you feel that I was adding to the pressure on you then let me apologise for that, it was certainly not my intention to do that.</p>
<p>Mike</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41022"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9272.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ulli&#039;s picture" title="Ulli&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9272.html" title="View user profile.">Ulli</a> on Sat, 09/04/2016 - 18:05.</div>
    <div class="content">
     <p>I am currently looking for an option not measure the power consumption without blocking other functionalities built in the Atmega328.</p>
<p>Therefore a continuous sampling is mandatory.</p>
<p>I am a little bit confused that the above descried library is not working correct. Based on that I was looking for alternatives. I found the following library:</p>
<p><a href="https://github.com/chaveiro/EmonLibPro" title="https://github.com/chaveiro/EmonLibPro">https://github.com/chaveiro/EmonLibPro</a></p>
<p>Does anybody know this Lib or already tried it? Maybe it could also help you finding the issue?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41028"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Sat, 09/04/2016 - 23:09.</div>
    <div class="content">
     <p>I made emonlibpro and use it on a few instalations for some years now. Other people use it also.<br />
Its precise and let you run other code on the atmel. I have an Ethernet shield uploading data directly to emoncms.<br />
Give it a try you wont regret it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41569"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9397.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Xino&#039;s picture" title="Xino&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Continuous Sampling EmonPi and EmonTx v3.4 examples</h3>

    <div class="submitted">Submitted by <a href="../user/9397.html" title="View user profile.">Xino</a> on Wed, 04/05/2016 - 19:04.</div>
    <div class="content">
     <p>Is the continuous sampling&nbsp;now not available on the emonSD-03May16 Release?</p>
<p>I see it&#39;s not an option to comment/uncomment&nbsp;in&nbsp;~/emonpi/emonpiupdate&nbsp;and discrete sampling hex is now in&nbsp;<br />
/home/pi/emonpi/firmware/compiled/latest.hex where previously&nbsp;the continuous sampling hex used to live.</p>
<p>BR</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11722"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-p5muOL2I337RCEEcwemzGyOnnAJmmqWxM0YahkXBjZw" value="form-p5muOL2I337RCEEcwemzGyOnnAJmmqWxM0YahkXBjZw"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
