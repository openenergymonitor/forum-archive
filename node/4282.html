<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/4282 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:57:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Arduino energy monitor - measuring  current | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Arduino energy monitor - measuring  current</h3>
        <span class="submitted">Submitted by <a href="../user/5735.html" title="View user profile.">lolita</a> on Fri, 21/03/2014 - 17:44</span>
        <div class="content"><p>Hi,</p>
<p>I followed the tutorial of this&nbsp;http://openenergymonitor.org/emon/buildingblocks/how-to-build-an-arduino-energy-monitor</p>
<p>I am trying to measure only the current but, I cannot understand the output data</p>
<p>which is like following:</p>
<p>&nbsp;</p>
<p>Irms*230.0 &nbsp; &nbsp;Irms</p>
<p>--------------------------</p>
<p>0.95 &nbsp; &nbsp; &nbsp; &nbsp;0.00<br />
	0.95 &nbsp; &nbsp; &nbsp; &nbsp;0.00<br />
	0.95 &nbsp; &nbsp; &nbsp; &nbsp;0.00<br />
	4.66 &nbsp; &nbsp; &nbsp; &nbsp;0.02<br />
	0.95 &nbsp; &nbsp; &nbsp; &nbsp;0.00<br />
	6.52 &nbsp; &nbsp; &nbsp; &nbsp;0.03<br />
	3.36 &nbsp; &nbsp; &nbsp; &nbsp;0.01<br />
	3.36 &nbsp; &nbsp; &nbsp; &nbsp;0.01<br />
	5.67 &nbsp; &nbsp; &nbsp; 0.02<br />
	6.52 &nbsp; &nbsp; &nbsp; 0.03</p>
<p>&nbsp;</p>
<p>I cannot understand what is meaning of these output from the CT sensor, the sensor is&nbsp;connected to the some devise wire, but even the sensor not connected it still &nbsp;print the same kind of &nbsp;value to the output,</p>
<p>I am using arduino&nbsp;2009</p>
<p>&nbsp;</p>
<p>thanks</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="2403.html" class="topic-previous" title="Go to previous forum topic">‹ Smoothie chart displays no data from feed</a>
              <a href="5010.html" class="topic-next" title="Go to next forum topic">Emonlib variable instead analog pin ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-19582"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 21/03/2014 - 19:20.</div>
    <div class="content">
     <p>If you look at your sketch, you have at the bottom:</p>
<p>void loop()<br />
	{<br />
	&nbsp; double Irms = emon1.calcIrms(1480);&nbsp; // Calculate Irms only<br />
	&nbsp;<br />
	&nbsp; Serial.print(Irms*230.0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Apparent power<br />
	&nbsp; Serial.print(&quot; &quot;);<br />
	&nbsp; Serial.println(Irms);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Irms<br />
	}</p>
<p>The line &quot;double Irms = .....&quot;&nbsp; is a call to a method in the emonLib library that reads the analogue port and calculates the average current.</p>
<p>The next line prints this value multiplied by 230. That assumes your mains voltage is 230 V and the number printed is the apparent power in Watts. The last line prints the current in Amperes.</p>
<p>So what I think you are seeing is a very small load of around 5 Watts.&nbsp; I do not know what load you were expecting to see, but experience tells me that you normally see numbers like that even when there is no current flowing.</p>
<p>A common mistake is to put the current transformer over a two core or three core cable that has two wires carrying current in opposite directions. A current transformer works on the magnetic field surrounding a wire, and if you have two wires carrying current in opposite directions, the magnetic fields cancel and you will read nothing. You must clip the current transformer onto one wire only, either Line or Neutral.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19616"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5735.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="lolita&#039;s picture" title="lolita&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/5735.html" title="View user profile.">lolita</a> on Sat, 22/03/2014 - 15:02.</div>
    <div class="content">
     <p>Thank you very much&nbsp;Robert Wall for your detailed responce,</p>
<p>In fact I clipped CT sensor to the PC cable, &nbsp;so I got always noise like you said.</p>
<p>Thanks a lot!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20645"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6151.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="João Almeida&#039;s picture" title="João Almeida&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/6151.html" title="View user profile.">João Almeida</a> on Wed, 09/04/2014 - 17:55.</div>
    <div class="content">
     <p>Hey guys, I&#39;m new to the forum, and I hvae the same problem as @lolita, meaning I was only testing the &quot;current_only&quot; exemple provided by the emonLib&nbsp;library, and even with the CT sensor disconnected, I read values similar&nbsp;to the ones on this thread, same thing happends&nbsp;when I connect the CT sensor to my laptop cable, or rather yet, the values seem to change a lillte, but they are kept in the same range as if I had the CT sensor disconnected.</p>
<p>	I&#39;ve read your answer Robert, but I&#39;m not quite sure&nbsp;I understand it. What you mean is I can&#39;t connect the CT sensor to a normal cable, say something like a computer power source cable, because they have neutral and&nbsp;fase (line), or other ordinary house hold items. But if I connect it to say, a power source cable, or an electrical board cable I should have no problems?</p>
<p>	Forgive me if my question sound stupid, but like I said, i&#39;m new to these things :D</p>
<p>	Things in advance for any help you can provide,</p>
<p>	John.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20649"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 09/04/2014 - 18:55.</div>
    <div class="content">
     <p>Jo&atilde;o, You are correct. If you want to measure a computer, or a vacuum cleaner, or something that you plug in at a socket on the wall, then you must make up an extension plug and socket where the wires are separate and not collected together inside one sheath. You must clip the c.t. over only the line cable or over only the neutral cable.</p>
<p><a href="../sites/default/files/PVCT.jpg" title="http://openenergymonitor.org/emon/sites/default/files/PVCT.JPG">http://openenergymonitor.org/emon/sites/default/files/PVCT.JPG</a></p>
<p>and</p>
<p><a href="../emontx/accuracy.html" title="http://openenergymonitor.org/emon/emontx/accuracy">http://openenergymonitor.org/emon/emontx/accuracy</a></p>
<p>Be <strong>VERY</strong> careful when handling mains electricity.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20659"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6151.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="João Almeida&#039;s picture" title="João Almeida&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/6151.html" title="View user profile.">João Almeida</a> on Wed, 09/04/2014 - 20:23.</div>
    <div class="content">
     <p>Thanks for the prompt response Robert.</p>
<p>	I&#39;ll try to use the CT sensor the correct way now xD.</p>
<p>
	Thanks again,</p>
<p>	Jo&atilde;o&nbsp;Almeida.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20821"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6151.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="João Almeida&#039;s picture" title="João Almeida&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/6151.html" title="View user profile.">João Almeida</a> on Thu, 17/04/2014 - 16:33.</div>
    <div class="content">
     <p>Good afternoon Robert. I&#39;m sorry for not replying to your previous answer, but I&#39;ve been kind of busy with my work.</p>
<p>	So summing up, I&#39;ve took your advices into consideration and I&#39;ve tested the shield, noticed everything&#39;s working as expected.&nbsp;</p>
<p>	Now I have a new problem xD. For my work, I&#39;ll have to use an real time clock (RTC) to keep track of the time of the readings I&#39;ll have to do. the problem is almost every RTC&nbsp;uses I2C, meaning that I&#39;ll have to use pin4 of my arduino (I use an arduino&nbsp;ETHERNET) to do readings of the shield and also readings of the RTC. This poses a conflict between the RTC and the shield, and after I searched for a while, I discovered that I can remap&nbsp;pin4 of the emonTX to say pin0, as neither the emonTX and RTC&nbsp;use that pin. For that I was thinking of using an go-between shield for the easy remap.</p>
<p>	My problem now is that I would also need to alter the library code to change pin4 to pin0, and I just can&#39;t find any reference in the emonLIB&nbsp;library to pin4. I just find references to channels 1 to 3, and pins 1 to 3 also.</p>
<p>
	Don&#39;t know if I made my problem clear xD<br />
	&nbsp;</p>
<p>Best regards, Jo&atilde;o Almeida.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20823"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 17/04/2014 - 17:00.</div>
    <div class="content">
     <p>I know nothing about the Arduino PCBs, and I don&#39;t understand your question. You want to move the signal on pin 4 to pin 0 - what is the name of that signal?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20825"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6151.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="João Almeida&#039;s picture" title="João Almeida&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/6151.html" title="View user profile.">João Almeida</a> on Thu, 17/04/2014 - 17:47.</div>
    <div class="content">
     <p>The thing is the emonTX uses pins A1 to A4 from the arduino to do the readings. And the RTC&nbsp;uses pins A4 and A5 witch causes a conflict of communitcations because the pins A4 and A5 are used as I2C on the arduino.</p>
<p>	The solution I found is to remap the pin A4 of the emonTX to the pin A0 as you said &nbsp;but that would imply changing the library code to, I think. My problem is that I can&#39;t find references in the library code to pin A4.</p>
<p>
	I don&#39;t think it would be so simple as to change the pin in the code. For instance, change the example&nbsp;for two CT&#39;s from:<br />
	-----------------------------------------------------------------------------------------------------------------------------------------------#include &quot;EmonLib.h&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Include Emon Library<br />
	EnergyMonitor emon1, emon2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Create an instance</p>
<p>void setup()<br />
	{&nbsp;<br />
	&nbsp; Serial.begin(9600);<br />
	&nbsp;<br />
	&nbsp; emon1.current(1, 111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>&nbsp;&nbsp;emon2.current(2, 111.1); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Current: input pin, calibration.</p>
<p>}</p>
<p>void loop()<br />
	{<br />
	&nbsp; double Irms = emon1.calcIrms(1480);&nbsp; // Calculate Irms only</p>
<p>&nbsp;double Irms = emon2.calcIrms(1480);&nbsp; // Calculate Irms only<br />
	&nbsp;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br />
	}</p>
<p>-----------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>	to:<br />
	-------------------------------------<br />
	void setup()<br />
	{<br />
	&nbsp; Serial.begin(9600);</p>
<p>	&nbsp; emon1.current(1, 111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration.</p>
<p>&nbsp; emon2.current(0, 111.1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Current: input pin, calibration. &nbsp; &lt;----------------------------CHANGE-------------------</p>
<p>}</p>
<p>-------------------------------------</p>
<p>
	Best regards, Jo&atilde;o Almeida.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20832"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Arduino energy monitor - measuring  current</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 17/04/2014 - 18:55.</div>
    <div class="content">
     <p>If you look at EmonLib.cpp, EnergyMonitor::current( ) &amp; EnergyMonitor::voltage( ) use the input pin directly. In other words, the pin you give it when you call current(0, 111.1) assigns the value 0 to inpinI and that is the pin used when it reads the analogue port with analogRead(inPinI). The same happens with the voltage input.</p>
<p>But if you do not use pin 4 for measurement, EmonLib will do nothing with it. So I think you can move the pins around without the need to change anything in EmonLib.</p>
<p>That is not true if you use currentTX or voltageTX, these use &quot;channel number&quot; instead of Pin number. The pin mappings start at line 41 in EmonLib.cpp. If you use these, then you MUST change the library.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/4282"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-ODp6-7jl6SlES3NgIgk7QxTizCFVMM5QEHHwyvMXS00" value="form-ODp6-7jl6SlES3NgIgk7QxTizCFVMM5QEHHwyvMXS00"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
