<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10925 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:57:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Second arduino posting to emonhub ??? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Second arduino posting to emonhub ???</h3>
        <span class="submitted">Submitted by <a href="../user/8241.html" title="View user profile.">Thumperup</a> on Thu, 02/07/2015 - 04:38</span>
        <div class="content"><p>I've been looking for an answer but can't find it. I have an emonpi setup and working great. Emonpi is sending data to emoncms.org<br />
I have another arduino reading data from something else and reporting to emoncms.org and that is also working. </p>
<p>But what I really want is maybe the arduino to send data to the emonpi and the emonpi reports to emoncms.org. I want to do this to cut down on open internet connections. </p>
<p>How do I do this ? Do I create a node in emonhub ??? </p>
  <div class="forum-topic-navigation clear-block">
          <a href="10954.html" class="topic-previous" title="Go to previous forum topic">‹ Is the Event Module compatible with the latest VLow Write Image?</a>
              <a href="10957.html" class="topic-next" title="Go to next forum topic">Is the solar app  broken ATM ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31841"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Second arduino posting to emonhub ???</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 02/07/2015 - 08:48.</div>
    <div class="content">
     <p>What you&#39;re proposing is the preferred&nbsp;method as emonHub can collate data from several sources and forward to several servers local and remote, it also offers some pre-send qualification/filtering so a bad packet can be stopped (or fixed) before being sent unnecessarily to multiple servers, plus there is the buffering of data if the remote servers down or network out.</p>
<p>However emonHub isn&#39;t (yet) set up to receive&nbsp;emonCMS formatted urls&nbsp;so you would need to rework the sketch in your 2nd arduino to either send via the existing hardware to a socket interfacer&nbsp;you can create&nbsp;in emonHub on the emonPi OR to send via RFM if you remove the Ethernet/WiFi and add a RFM69&nbsp;board.</p>
<p>I only mention the second option as there will be more info readily available for editing the sketch for RFM than Sockets and the Interfacer is already there on the Pi.</p>
<p>If you search this site for socket interfacer you should get some info or i can help you further, but you will basically need your 2nd arduino to be able to send data formatted as &#39;nodeid val1 val2 val3&#39;&nbsp;etc to the emon-pi via a lan ip or address with the port number opened for it eg 192.168.0.123:50011 or emonpi:50011 etc</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31842"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8241.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Thumperup&#039;s picture" title="Thumperup&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Second arduino posting to emonhub ???</h3>

    <div class="submitted">Submitted by <a href="../user/8241.html" title="View user profile.">Thumperup</a> on Thu, 02/07/2015 - 08:59.</div>
    <div class="content">
     <p>I would like to know more info on data formatting, I need to send via IP. I am much more familiar with networking with the arduino just don't know how the emonpi accepts it and what formatting. </p>
<p>Thank you</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31846"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Second arduino posting to emonhub ???</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 02/07/2015 - 10:01.</div>
    <div class="content">
     <p>Unfortunately I&#39;m not that familiar with arduino networking so can only point you in the right direction.</p>
<p>I would suggest creating a socketinterfacer&nbsp;in emonhub&nbsp;as discussed in several threads and also use a simple test script, examples of which can be found in those threads to get a socket interfacer working (from the test script) with a format and address you are confident you can implement&nbsp;in the arduino sketch.</p>
<p>I theory you should have minimal down time as the route will be tried and tested and the new sketch written to suit before taking the 2nd arduino off line to upload the replacement sketch.</p>
<p>see&nbsp;<a href="10159.html">How to simulate data sent from EmonTx to EmonHub in order to debug a reporter?</a>&nbsp;to start with and if you need some specific help I&#39;ll assist you.</p>
<p>Set loglevel = DEBUG in emonhub.conf before you start and have a separate ssh window open and run&nbsp;&quot;<strong>tail -f /var/log/emonhub/emonhub.log</strong>&quot; to see verbose log entries in real time, you should se the socketinterfacer being created when you save emonhub.conf after adding the configuration, confirmation&nbsp;of settings&nbsp;and any data from your test script being processed. It is a huge help.</p>
<p>I expect you will also need an additional line in the socket interfacers&nbsp;[[[runtimesettings]]] <strong>pubchannels = ToEmonCMS&nbsp;</strong>as you are using the emon-pi variant of emonhub.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31945"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8241.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Thumperup&#039;s picture" title="Thumperup&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Second arduino posting to emonhub ???</h3>

    <div class="submitted">Submitted by <a href="../user/8241.html" title="View user profile.">Thumperup</a> on Sun, 05/07/2015 - 13:52.</div>
    <div class="content">
     <p>I have attached an&nbsp;Arduino sketch. Ignore the volts, amps, and power, data being past though. This is just a test sketch used without a sensor. I need help changing the formatting on the&nbsp;sendData() method. The changing the client IP and port number is easy enough. Does the emonhub&nbsp;accept the same formatting ??? what do I have to change ??? I have changed the emonhub</p>
<p>[interfacers]</p>
<p>[[solar]]<br />
&nbsp; &nbsp; Type = EmonHubSocketInterfacer<br />
&nbsp; &nbsp; [[[init_settings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; port_nb = 50011<br />
&nbsp; &nbsp; [[[runtimesettings]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pubchannels = ToEmonCMS,</p>
<p>[nodes]</p>
<p>[[1]]<br />
&nbsp; &nbsp; nodename = solar<br />
&nbsp; &nbsp; [[[rx]]]<br />
&nbsp; &nbsp; &nbsp; &nbsp; names = volts, amps, power<br />
&nbsp; &nbsp; &nbsp; &nbsp; datacodes = h, h, h<br />
&nbsp; &nbsp; &nbsp; &nbsp; scales = 0.1,0.1,0.1<br />
&nbsp; &nbsp; &nbsp; &nbsp; units = V,W,W</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31959"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Second arduino posting to emonhub ???</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 05/07/2015 - 22:41.</div>
    <div class="content">
     <p>I hope someone can help you with the sketch as I&#39;m not really able to.</p>
<p>The emonhub.conf settings look ok except the data will not be passed as byte pair ints so the datacodes won&#39;t suit. Previously in emonHub you had the option to omit the datacodes&nbsp;and the default for the SocketInterfacer was datacode 0 (defines no datacodes used) so real numbers could be passed.</p>
<p>You could try omitting the datacodes line, using datacode = 0 or&nbsp;datacodes&nbsp;= 0, 0, 0 to be more specific.</p>
<p>The string you need to send to <a href="http://192.168.10.31:50011/" title="http://192.168.10.31:50011">http://192.168.10.31:50011</a> (<span style="line-height: 20.7999992370605px;">ip:port)</span><span style="line-height: 20.7999992370605px;">&nbsp;</span><span style="line-height: 1.6;">is </span><em style="line-height: 1.6;">node&nbsp;voltValue&nbsp;ampValue&nbsp;wattValue,&nbsp;</em><span style="line-height: 1.6;">Just four numbers </span>seperated<span style="line-height: 1.6;"> by a space, no labels, brackets or commas etc</span></p>
<p><span style="line-height: 1.6;">and don&#39;t forget to allow 50011 in the UFW firewall.</span></p>
<p><span style="line-height: 1.6;">Paul</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32007"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8241.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Thumperup&#039;s picture" title="Thumperup&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Second arduino posting to emonhub ???</h3>

    <div class="submitted">Submitted by <a href="../user/8241.html" title="View user profile.">Thumperup</a> on Tue, 07/07/2015 - 14:48.</div>
    <div class="content">
     <p>Before trying to code this in arduino,&nbsp;is there a way you know of to throw a http post at emonhub as a test. I am not familiar&nbsp;with sending http posts. I know the json&nbsp;commands.&nbsp;</p>
<p>&nbsp;</p>
<p>Can i send this in the address bar like the json requests ? I&#39;ve tried researching POST requests and coding into arduino&nbsp;but still nothing shows up&nbsp;</p>
<p>When trying to connect to emonhub&nbsp;I get connection failed&nbsp;</p>
<p>if (client.connect(server, 50011)) {</p>
<p>some code&nbsp;</p>
<p>else {<br />
&nbsp; &nbsp; // if you couldn&#39;t make a connection:<br />
&nbsp; &nbsp; Serial.println(&quot;Connection failed&quot;);<br />
&nbsp; &nbsp; Serial.println(&quot;Disconnecting...&quot;);<br />
&nbsp; &nbsp; client.stop();<br />
&nbsp; }</p>
<p>Maybe this is my first problem it skips past the code and fails. How does emonhub&nbsp;handle the connection ? I guess it doesn&#39;t like emoncms.org</p>
<p>I need to know how to test the POST before figuring out my connection woes.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32009"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8241.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Thumperup&#039;s picture" title="Thumperup&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Second arduino posting to emonhub ???</h3>

    <div class="submitted">Submitted by <a href="../user/8241.html" title="View user profile.">Thumperup</a> on Tue, 07/07/2015 - 15:15.</div>
    <div class="content">
     <p>I noticed this found at&nbsp;http://openenergymonitor.org/emon/modules/emonpi&nbsp;</p>
<p>To send a packet a HTTP POST request needs to be sent to the nodes API of the form:</p>
<blockquote><p>request method: POST</p>
<p>request url: /nodes/1/tx/values</p>
<p>request body: 18.5,0.5</p>
</blockquote>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32028"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Second arduino posting to emonhub ???</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 07/07/2015 - 21:24.</div>
    <div class="content">
     <p>I&#39;m afraid I&#39;m not familiar with the arduino side either, nor am I sure about the new emoncms api&#39;s you&#39;ve found in the emonpi&nbsp;guide.&nbsp;</p>
<p>I can only really&nbsp;help you with &quot;posting to emonhub&quot; which isn&#39;t quite the same thing as posting to emoncms.</p>
<p>The correct method (IMO) is to send to emonhub and let emonhub post to both emoncms&#39;s, local and remote, but that is done via a websocket&nbsp;not via POST&nbsp;requests.</p>
<p>I have done this from python and bash, but not from an arduino,&nbsp;</p>
<p>​Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10925"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-6rfkMbFDHN6NQADpVvN-q9jsRyfoaLtTbXrAUSLaHPg" value="form-6rfkMbFDHN6NQADpVvN-q9jsRyfoaLtTbXrAUSLaHPg"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
