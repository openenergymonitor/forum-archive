<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12359 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:55:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Bulk updates on existing inputs | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Bulk updates on existing inputs</h3>
        <span class="submitted">Submitted by <a href="../user/8066.html" title="View user profile.">firefox7518</a> on Wed, 16/03/2016 - 23:11</span>
        <div class="content"><p>Hi all</p>
<p>I now have over 1000 Solar inverters sending me data. When I started I used the approach to create an input and name the values nicely so that a normal human beeing&nbsp;is able to read the data. I use EmonCMS for monitoring micro inverters of Enecsys.</p>
<p>The input will look like this:</p>
<p><img alt="" src="../sites/default/files/input%20view.jpg" style="width: 700px; height: 347px;" />Because of the success of using EmonCMS I now have thousands of feeds running&nbsp;&nbsp;and as said over 1000 inverters and hundreds of other data like house consumption etc. sending data to the system. I have good Hardware which at the moment does not suffer from performance issues but I want to be prepared for the future as there is maybe a bigger Solar plant with an additional 270 inverters waiting.</p>
<p>Is there a way to use the bulk update on the exisiting inputs? So that I can use one hit for multiple node id updates? Looking at the manual on how to use bulk it just says that you can use it in this format:&nbsp;</p>
<p>/input/bulk.json?data=[[0,16,1137],[2,17,1437,3164],[4,19,1412,3077]]</p>
<p>Using this of course creates just new keys instead of using the existing ones. &nbsp;A lot of my users are using the input page for checking non important data like Net Voltage or Net Frequency and do not want to log it. So for them, of course, a nice readable user friendly output would be desired.&nbsp;</p>
<p>If not possible where do I have to change it? Is it in the input_controller.php or is there more I need to change?</p>
<p>Thanks a lot in advance for all your help!</p>
<p>Andreas</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12342.html" class="topic-previous" title="Go to previous forum topic">‹ Resolved: EmonPi purchase questions.</a>
              <a href="12358.html" class="topic-next" title="Go to next forum topic">[Solved] Pre-built SD card / first login / not possible to register ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-40397"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bulk updates on existing inputs</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 17/03/2016 - 16:21.</div>
    <div class="content">
     <p>Hello Andreas, what do your current API calls look like? It looks like you must be sending using the JSON-like format with input key:value {key1:123} you can post to multiple inputs by extending it like this:</p>
<p>{key1: 123, key2: 123, key3: 123, ...}</p>
<p>There are things that you can do for performance if you need it, such as putting the input requests straight into queues so the connection is released as fast as possible, then running input queue processors to do the processing. Its not something that&#39;s really documented, but the components are there:</p>
<p>replace the existing input controller with this:<br />
<a href="https://github.com/emoncms/emoncms/blob/master/Modules/input/que_input_controller.php" title="https://github.com/emoncms/emoncms/blob/master/Modules/input/que_input_controller.php">https://github.com/emoncms/emoncms/blob/master/Modules/input/que_input_c...</a></p>
<p>then run the queue processor here:<br />
<a href="https://github.com/emoncms/emoncms/blob/master/scripts/input_queue_processor.php" title="https://github.com/emoncms/emoncms/blob/master/scripts/input_queue_processor.php">https://github.com/emoncms/emoncms/blob/master/scripts/input_queue_proce...</a></p>
<p>You need to keep an eye on all of that though, as they can fail, and then you&#39;d have to restart the processor etc. Using Redis and SSD drives makes a big difference too. I imagine your doing that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-40406"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8066.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="firefox7518&#039;s picture" title="firefox7518&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Bulk updates on existing inputs</h3>

    <div class="submitted">Submitted by <a href="../user/8066.html" title="View user profile.">firefox7518</a> on Thu, 17/03/2016 - 18:48.</div>
    <div class="content">
     <p>Hi Trystan</p>
<p>Yes, you&#39;re right. I use the JSON like format:</p>
<p>/input/post.json?node=200017088&amp;json={AC_Output:165,DC_Input:174,Net_Frequency:60,Net_Voltage:250,Inverter_temp:40,Lifetime_Output:505,Alarm_state:0,Status:0}&amp;apikey=xxxxx</p>
<p>So my question really is on how to send multiple nodes in the same JSON. The Bulk does it but I&#39;m not able to use the KEY variable and it therefore always creates new ones.</p>
<p>I receive one big JSON string from the gateway with all the inverter data from multiple inverters and it would be really nice to also send it like this to emoncms. I could imagine that this would also be something from big use for others not just me.</p>
<p>An Example of how many inputs it could be is a view like this:</p>
<p><img alt="" src="../sites/default/files/input%20view_0.jpg" style="width: 135px; height: 768px;" /></p>
<p>They all then send data as posted above as keys. I now have over 1000 doing that. My 24 Core Windows Server handles that load of course without any sweat but I expect to come more every day. Normally 2-3 users will come daily and bring an additional 10-40 inverters to the system :-)</p>
<p>I love how EmonCMS works and handles the stuff but this mass update thing is the most missing part for me at the moment. Having 30-50hits a second is not uncommon but I do not prefer it. Our windows servers in the office were handling hundreds of hits a second but I like it efficient :-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12359"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-S-AhISy36KB9Bqn7mt2XgG-gRXakYgm5piVhzb7wKv8" value="form-S-AhISy36KB9Bqn7mt2XgG-gRXakYgm5piVhzb7wKv8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
