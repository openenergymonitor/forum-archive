<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12532 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:16:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Manipulating Week or Month Data | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Manipulating Week or Month Data</h3>
        <span class="submitted">Submitted by <a href="../user/8797.html" title="View user profile.">M0n0wall</a> on Wed, 20/04/2016 - 20:07</span>
        <div class="content"><p>Hi all</p>
<p>Is there a way to manipulate logged data and display it as week and month data as a raw feed?</p>
<p>Regards</p>
<p>Dave</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12554.html" class="topic-previous" title="Go to previous forum topic">‹ Emoncms daily, weekly, monthly kWh and averaging</a>
              <a href="12212.html" class="topic-next" title="Go to next forum topic">(Release Candidate #1 ): emonSD-20Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-41289"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Wed, 20/04/2016 - 21:20.</div>
    <div class="content">
     <p>There is if you use MySQL to store your feed data</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41290"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8797.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="M0n0wall&#039;s picture" title="M0n0wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/8797.html" title="View user profile.">M0n0wall</a> on Wed, 20/04/2016 - 21:30.</div>
    <div class="content">
     <p>Hi</p>
<p>Am I correct in believing that there has been a move away from using MySQL due to the database sizes?</p>
<p>Regards</p>
<p>Dave</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41291"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Wed, 20/04/2016 - 21:36.</div>
    <div class="content">
     <p>Depends whether your talking about Emoncms.org hosting or your own on a Raspberry Pi for example</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41292"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8797.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="M0n0wall&#039;s picture" title="M0n0wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/8797.html" title="View user profile.">M0n0wall</a> on Wed, 20/04/2016 - 21:38.</div>
    <div class="content">
     <p>I currently use my pi for the emonCMS and SQL but theres no reason why I couldn&#39;t utilize an Ubuntu server for hosting the sql and emoncms.</p>
<p>&nbsp;</p>
<p>Regards</p>
<p>Dave</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41293"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Wed, 20/04/2016 - 21:57.</div>
    <div class="content">
     <p>Mine's on a Pi with a USB hard drive and I use MySQL as the storage engine for all my feeds if you're interested I can show you how I implement hourly, daily and monthly feeds. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41294"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8797.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="M0n0wall&#039;s picture" title="M0n0wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/8797.html" title="View user profile.">M0n0wall</a> on Wed, 20/04/2016 - 22:11.</div>
    <div class="content">
     <p>Please, that would be fantastic.</p>
<p>Regards<br />
Dave</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41295"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Wed, 20/04/2016 - 22:30.</div>
    <div class="content">
     <p>Bra1n,</p>
<p>I&#39;m interested in that too.</p>
<p>Thanks,</p>
<p>Bill</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41297"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8298.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-8298.jpg" alt="Jon&#039;s picture" title="Jon&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/8298.html" title="View user profile.">Jon</a> on Thu, 21/04/2016 - 01:38.</div>
    <div class="content">
     <p>+1. &nbsp;Me too!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41303"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Thu, 21/04/2016 - 06:21.</div>
    <div class="content">
     <p>OK just woke up I&#39;ll get something up later today. I use phpmyadmin to manage mysql and as I said earlier your source data needs to be stored in mysql.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41306"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Thu, 21/04/2016 - 09:18.</div>
    <div class="content">
     <p>There are other ways of doing this, but my method uses database Views which behave as a sort of virtual table but are actually evaluated whenever the View is accessed. The data is not stored separately.&nbsp;<br />
Because this method uses SQL &#39;group by&#39; functions you have to limit the timescale of the data that is evaluated. Otherwise, the sums will be wrong. For example, the Daily feed only evaluates the latest 28 days to avoid the same day in 2 different months being summed together. Similarly, the hourly feed only evaluates the previous 24 hours.</p>
<p>In my examples below, feed 1 is Hourly, feed 2 is Daily and feed 3 is Monthly. Obviously you need to substitute your own feed numbers in the SQL statements, using feed numbers that are not currently in use. Feed 9 in my example contains the source data, which in my case, is rainfall data from a tipping bucket rain gauge, usually recorded once per minute.</p>
<p>I run the SQL statements in PhpMyAdmin by selecting the SQL Tab and pasting in the SQL and pressing &#39;GO&#39;, you could also do it from the console once logged into MySQL</p>
<p>Hourly Rainfall View :-</p>
<p>*****************<br />
DROP VIEW IF EXISTS emoncms.feed_1;<br />
CREATE VIEW `feed_1` AS select unix_timestamp(cast(from_unixtime(`feed_9`.`time`) as datetime)) AS `time`,sum(`feed_9`.`data`) AS `data` from `feed_9` where ((unix_timestamp(now()) - `feed_9`.`time`) &lt; 86400) group by hour(from_unixtime(`feed_9`.`time`)) order by `feed_9`.`time`;<br />
*****************</p>
<p>Daily Rainfall View :-</p>
<p>*****************<br />
DROP VIEW IF EXISTS emoncms.feed_2;<br />
CREATE VIEW `feed_2` AS select unix_timestamp(cast(from_unixtime(`feed_9`.`time`) as datetime)) AS `time`,sum(`feed_9`.`data`) AS `data` from `feed_9` where ((unix_timestamp(now()) - `feed_9`.`time`) &lt; 2419200) group by dayofmonth(from_unixtime(`feed_9`.`time`)) order by `feed_9`.`time`;<br />
*****************</p>
<p>Monthly Rainfall View :-</p>
<p>*****************<br />
DROP VIEW IF EXISTS emoncms.feed_3;<br />
CREATE VIEW `feed_3` AS select unix_timestamp(cast(from_unixtime(`feed_9`.`time`) as datetime)) AS `time`,sum(`feed_9`.`data`) AS `data` from `feed_9` where ((unix_timestamp(now()) - `feed_9`.`time`) &lt; 31536000) group by month(from_unixtime(`feed_9`.`time`)) order by `feed_9`.`time`;<br />
*****************</p>
<p>In order to do something with these new feeds, you need to add entries to the feeds table, again using your own corresponding feed ids and labels etc.</p>
<p>e.g:-</p>
<p>*****************<br />
INSERT INTO `emoncms.feeds`(`id`, `name`, `userid`, `tag`, &#39;public&#39;) VALUES (1,&#39;Hourly Rainfall&#39;,1,&#39;Weather Station&#39;,0)<br />
INSERT INTO `emoncms.feeds`(`id`, `name`, `userid`, `tag`, &#39;public&#39;) VALUES (2,&#39;Daily Rainfall&#39;,1,&#39;Weather Station&#39;,0)<br />
INSERT INTO `emoncms.feeds`(`id`, `name`, `userid`, `tag`, &#39;public&#39;) VALUES (3,&#39;Monthly Rainfall&#39;,1,&#39;Weather Station&#39;,0)&nbsp;<br />
*****************</p>
<p>You could leave it at this and would be able to plot the graphs but if you also want to display the current values (which are currently null in the feeds table for these 3 new feeds) you need a process to update those numbers.</p>
<p>This is bit more complicated as first you need to enable the MySQL Event Scheduler which is disabled by default :</p>
<p><a href="http://dev.mysql.com/doc/refman/5.5/en/events.html" title="http://dev.mysql.com/doc/refman/5.5/en/events.html">http://dev.mysql.com/doc/refman/5.5/en/events.html</a></p>
<p>The following SQL turns on the event scheduler as long as the database user has permissions to enable it :-</p>
<p>****************<br />
SET GLOBAL event_scheduler = ON;<br />
****************</p>
<p>The event table in the mysql database is where events are triggered from and their current status can be viewed there (last run time etc). Be aware no errors will be reported if the event fails for any reason and as it is a global operation in the database, the SQL it runs needs to infer which database it needs to run on.<br />
I update the values every 10 minutes but that is up to the user to decide what&#39;s appropriate for their data.</p>
<p>e.g. :-</p>
<p>***************<br />
delimiter |</p>
<p>CREATE EVENT hourly_rainfall<br />
&nbsp; &nbsp; ON SCHEDULE<br />
&nbsp; &nbsp; &nbsp; EVERY 10 MINUTE<br />
&nbsp; &nbsp; COMMENT &#39;Checks current hourly, daily and monthly rainfall in views feed_1, feed_2 and feed_3 then updates corresponding feed in feeds table&#39;<br />
&nbsp; &nbsp; DO<br />
&nbsp;&nbsp; &nbsp;BEGIN<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;UPDATE emoncms.feeds SET `time`=NOW(),`value`= (SELECT CASE WHEN (SELECT `data` FROM emoncms.feed_1 WHERE(UNIX_TIMESTAMP(NOW())-`time`)&lt;3600) IS NULL THEN 0 ELSE (SELECT `data` FROM emoncms.feed_1 WHERE(UNIX_TIMESTAMP(NOW())-`time`)&lt;3600) END)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;&nbsp; &nbsp;WHERE `id` = 1;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;UPDATE emoncms.feeds SET `time`=NOW(),`value`= (SELECT CASE WHEN (SELECT `data` FROM emoncms.feed_2 WHERE(UNIX_TIMESTAMP(NOW())-`time`)&lt;86400) IS NULL THEN 0 ELSE (SELECT `data` FROM emoncms.feed_2 WHERE(UNIX_TIMESTAMP(NOW())-`time`)&lt;86400) END)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;WHERE `id` = 2;<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;UPDATE emoncms.feeds SET `time`=NOW(),`value`= (SELECT CASE WHEN (SELECT `data` FROM emoncms.feed_3 WHERE(UNIX_TIMESTAMP(NOW())-`time`)&lt;31536000 order by `time` desc limit 1) IS NULL THEN 0 ELSE (SELECT `data` FROM emoncms.feed_3 WHERE(UNIX_TIMESTAMP(NOW())-`time`)&lt;31536000 order by `time` desc limit 1) END)<br />
&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;WHERE `id` = 3;<br />
&nbsp;&nbsp; &nbsp;END |</p>
<p>delimiter ;<br />
***************</p>
<p>I&#39;ve used &#39;***************&#39; to delimit &amp; indicate the SQL statements that would be copied &amp; pasted into MySQL (obviously don&#39;t include these asterisks when copying &amp; pasting)</p>
<p>The way the SQL statements are constructed means you won&#39;t see the data until the time period is completed. So for example, you won&#39;t see data in the hourly view for say 09:00 to 10:00 until after 10:00. This could probably be changed, but suits my purposes as it currently stands.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41309"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3426.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3426.jpg" alt="Bill Thomson&#039;s picture" title="Bill Thomson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3426.html" title="View user profile.">Bill Thomson</a> on Thu, 21/04/2016 - 12:30.</div>
    <div class="content">
     <p>Thanks for the info, Bra1n!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41312"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Thu, 21/04/2016 - 14:42.</div>
    <div class="content">
     <p>I will write documentation for doing this with phpfina feeds for local and emoncms.org. I&#39;ll update back here soon.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41313"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Thu, 21/04/2016 - 14:46.</div>
    <div class="content">
     <p>Sounds like an excellent idea Trystan, I look forward to trying it on emoncms.org</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41316"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8797.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="M0n0wall&#039;s picture" title="M0n0wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/8797.html" title="View user profile.">M0n0wall</a> on Thu, 21/04/2016 - 16:15.</div>
    <div class="content">
     <p>Thank you very much Bra1n, for posting the SQL code. Going forward, is there much benefit on setting up a CMS server hosted on a proper server and utilize MySQL rather than using the standard setup on the emonpi?</p>
<p>Regards</p>
<p>Dave</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41317"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Thu, 21/04/2016 - 16:23.</div>
    <div class="content">
     <p>I don&#39;t know which version of emoncms&nbsp;you are using but as far as I&#39;m aware the more&nbsp;recent versions have SQL as a storage engine option certainly the&nbsp;9 RC2 | 2015.09.15 version I&#39;m using does and that is by no means the latest. It may be worth upgrading your existing setup if you&#39;re on an earlier version. It runs well on my Pi2 setup and did on my previous Pi1 both utiising&nbsp;external USB HDDs.&nbsp;I have also run the same version from SD Card but a power outage killed that&nbsp;SD Card eventually.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-41407"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3464.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3464.jpg" alt="Bra1n&#039;s picture" title="Bra1n&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Manipulating Week or Month Data</h3>

    <div class="submitted">Submitted by <a href="../user/3464.html" title="View user profile.">Bra1n</a> on Tue, 26/04/2016 - 10:20.</div>
    <div class="content">
     <p>A slight correction to the Daily Rainfall View as I realised that since the clocks went forward the daily rainfall was showing for the previous day so I&#39;ve added an hour to the data in the view definition, hopefully this will still be ok when the clocks go back ;)</p>
<p>Daily Rainfall View :-</p>
<p>*****************<br />
DROP VIEW IF EXISTS emoncms.feed_2;<br />
CREATE VIEW `feed_2` AS select unix_timestamp(cast(from_unixtime(`feed_9`.`time`) as datetime) + INTERVAL 1 HOUR) AS `time`,sum(`feed_9`.`data`) AS `data` from `feed_9` where ((unix_timestamp(now()) - `feed_9`.`time`) &lt; 2419200) group by dayofmonth(from_unixtime(`feed_9`.`time`)) order by `feed_9`.`time`;<br />
*****************</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12532"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-aPrWyr0DlnUHD_c41B99YcKqh9c-rd_Tq-2vGQmdblI" value="form-aPrWyr0DlnUHD_c41B99YcKqh9c-rd_Tq-2vGQmdblI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/12532 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:16:11 GMT -->
</html>
