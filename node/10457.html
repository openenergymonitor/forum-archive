<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10457 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:24:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emonSD-13-03-15.img read-only root partition | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emonSD-13-03-15.img read-only root partition</h3>
        <span class="submitted">Submitted by <a href="../user/4704.html" title="View user profile.">BraileTrail</a> on Mon, 13/04/2015 - 10:23</span>
        <div class="content"><p>Hi,</p>
<p>I have a Pi 2 booting from a hard disk drive and running emonSD-13-03-15.img. Everything seems to be fine except that something seems to switch the root partition back to read-only after a period of about an hour. Does anybody have an idea how to stop this?</p>
<p>I understood from this post in the forums: <a href="5331_.html" title="http://openenergymonitor.org/emon/node/5331:">http://openenergymonitor.org/emon/node/5331:</a></p>
<p>&quot;Remember to use &ldquo; rpi-rw &ldquo; before making any changes and then to use &ldquo; rpi-ro &ldquo; afterwards to lock the filesystem down again.&quot;</p>
<p>That after running rpi-rw the partition would stay read-write until I ran rpi-ro or a reboot. that doesn&#39;t seem to be the case, I can login using MobaXTerm and execute rpi-rw (executing mount confirms that the root partition is read-write), leave the system logged in for about an hour and execute mount again where I find that the root partition is again read-only.</p>
<p>Thanks,</p>
<p>Brailetrail</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10459.html" class="topic-previous" title="Go to previous forum topic">‹ emonhub limited to 32 nodes</a>
              <a href="10450.html" class="topic-next" title="Go to next forum topic">RFM2pi data not appearing in Inputs list ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-29580"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonSD-13-03-15.img read-only root partition</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 13/04/2015 - 12:51.</div>
    <div class="content">
     <p>This &quot;feature&quot; was a welcome side effect of the <a href="https://github.com/emonhub/ntp-backup">ntp-backup</a>&nbsp;solution for the read only time issues on the sd card. Basically to save the current time it must &quot;unlock&quot; the read-only file&nbsp;system and then &quot;lock&quot; it again as read only. This does happen every hour from first boot.</p>
<p>As the read-only file&nbsp;sytem is intended to be left in a read-only state this side effect served the purpose of locking a file&nbsp;system accidently left unlocked by the user&nbsp;using rpi-rw&nbsp;(as you have discovered)</p>
<p>Forcing a file-system modified to run read-only to permanently&nbsp;override it&#39;s read-only status seems less than ideal and permanently reverting the read only changes may be worth concidering but if you wish to over ride the &quot;auto-lock&quot; then commenting out the <a href="https://github.com/emonhub/ntp-backup/blob/master/ntp-backup.init#L44">&quot;mount -t ext4 -o remount,ro /dev/mmcblk0p2 /&quot; line</a> in <strong>/etc/init.d/ntp-backup&nbsp;</strong>should do the trick, but be aware the intended outcome will then be reversed as each hour the file sytem will be opened to write the file and not locked afterwards so this will result in the file system never&nbsp;being read only for longer than 1 hour even if you use rpi-ro.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29585"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4704.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="BraileTrail&#039;s picture" title="BraileTrail&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonSD-13-03-15.img read-only root partition</h3>

    <div class="submitted">Submitted by <a href="../user/4704.html" title="View user profile.">BraileTrail</a> on Mon, 13/04/2015 - 13:49.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Thanks for the quick response. I have commented out that line and will see what happens in an hour. One thing I don&#39;t understand is that the line is as follows:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mount -t ext4 -o remount,ro /dev/mmcblk0p2&nbsp; /</p>
<p>
&nbsp;But my root file system is now the hard drive on /dev/sda1 so how is the above affecting that? I am pretty positive I am booting to the hard drive but will have a look around.</p>
<p>Can I also comment out the line that sets it rw mode as the file system should always be rw from now on? Or is it best to leave it there to avoid the failure of ntp-backup?</p>
<p>Finally, my understanding is that the rpi-rw / rpi-ro files are there to lock down and SD card&nbsp; in the low-write scenario and so should be unnecessary when running from a hard drive using the full emoncms from git (which I forgot to mention, sorry!)</p>
<p>Thanks again,</p>
<p>BraileTrail</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29588"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonSD-13-03-15.img read-only root partition</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 13/04/2015 - 14:34.</div>
    <div class="content">
     <p>You have highlighted a potential issue with the ntp-backup as the root partition is indeed hardcoded to mmcblk0p2&nbsp;which at the time didn&#39;t seem to be an issue as the read only modifications creating the need for this to be installed would only occur on a SD card, or so I believed at the time.</p>
<p>I will be interested in the outcome of your test too, as if you are running from hdd this file should have zero effect.</p>
<p>I struggle a little to understand why you have a read-only file system designed for use on an SD card especially when using the low-write version of emoncms whilst you are using a full version of emoncms on a hdd.</p>
<p>there are so many ways to configure things it&#39;s difficult to know what is important and easiest for you. i assume you want full emoncms and therefore a hdd, so you couls either install standard raspian without read-only modifications and install emoncms&nbsp;to that, or you could USE&nbsp;the read only raspbian&nbsp;os by putting&nbsp;all the files that need write access in a partition on the hdd as is done on the SD card image (ie mySQL and data feeds) so that the OS can be read-only as intended.</p>
<p>I think the key&nbsp;is to have the right tool for the job, read-only or not. There is a good argument for having a read only file system on the hdd to protect against accidents etc but it isn&#39;t as essential as with an SD card.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29595"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4704.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="BraileTrail&#039;s picture" title="BraileTrail&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonSD-13-03-15.img read-only root partition</h3>

    <div class="submitted">Submitted by <a href="../user/4704.html" title="View user profile.">BraileTrail</a> on Mon, 13/04/2015 - 15:35.</div>
    <div class="content">
     <p>Paul,</p>
<blockquote><p>I will be interested in the outcome of your test too, as if you are running from hdd this file should have zero effect.</p>
</blockquote>
<p>Well it&#39;s been running for over an hour now with the change in place and the root file system is still read-write so it looks like it was successful from my point of view. I&#39;ll keep checking for a while and let you know if it does swap back to read-only. At some point I&#39;ll try a reboot too. But I too am confused as to exactly how the ntp-backup was working and affecting /dev/sda1.</p>
<p>&nbsp;</p>
<blockquote><p>I struggle a little to understand why you have a read-only file system designed for use on an SD card especially when using the low-write version of emoncms whilst you are using a full version of emoncms on a hdd.</p>
<p>&nbsp;</p>
</blockquote>
<p>Well...</p>
<p>I started out with my Pi2 booting to plain old Rasbian on the hard drive and I followed some instructions somewhere on the OEM site and installed a pre-packaged local emoncms using apt-get which all went well until I tried to upgrade it to full emoncms. The package installed with apt-get does not contain git repository data so I couldn&#39;t get any further that way.</p>
<p>I browsed the forum about installing full emoncms from scratch and that seemed &quot;too hard&quot;&trade; getting all the prerequisites in place. I then found the instructions here about installing the low-write image and upgrading that and away I went:</p>
<p><a href="https://github.com/emoncms/emoncms/blob/bufferedwrite/readme.md" title="https://github.com/emoncms/emoncms/blob/bufferedwrite/readme.md">https://github.com/emoncms/emoncms/blob/bufferedwrite/readme.md</a></p>
<p>However I was having trouble keeping my WiFi card up, so I used a modified version of the WiFi_Check script from another post in the forums to try to keep the connection alive and to log the results to a file, what I found was that the cron output in the file stopped after about an hour and here we are.</p>
<p>I understand the safe-guards that having a read-only root file system can give but would still prefer not to have to enter rpi-rw each time I want to edit a file.</p>
<p>I may look at doing everything from scratch and putting more partitions in place so that I can keep the important bits of root safe but at the moment I&#39;d rather get my system logging data.</p>
<p>Regards,</p>
<p>BraileTrail</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29596"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4704.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="BraileTrail&#039;s picture" title="BraileTrail&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonSD-13-03-15.img read-only root partition</h3>

    <div class="submitted">Submitted by <a href="../user/4704.html" title="View user profile.">BraileTrail</a> on Mon, 13/04/2015 - 17:07.</div>
    <div class="content">
     <p>Paul,</p>
<p>The root file system was back to rear-only after a reboot so I think I will bite the bullet and install from scratch.</p>
<p>From here&nbsp;https://github.com/emoncms/emoncms/blob/master/docs/LinuxInstall.md installing full emoncms from scratch looks long winded but doable but don&#39;t mention Raspberry Pi specifically.</p>
<p>But I also need to install and configure emonhub I believe and the instruction here <a href="https://github.com/emonhub/dev-emonhub" title="https://github.com/emonhub/dev-emonhub">https://github.com/emonhub/dev-emonhub</a> are less encouraging in that it is for a development version:</p>
<p>&nbsp;</p>
<p>Thanks,</p>
<p>BraileTrail</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29597"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonSD-13-03-15.img read-only root partition</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 13/04/2015 - 19:20.</div>
    <div class="content">
     <p>What is returned when you run &quot;&nbsp;<strong>lsblk</strong>&nbsp;&quot; at the command line ?</p>
<p>A read only file system will reboot to read-only the hack was only&nbsp;to prevent ntp-time reverting your use of rpi-rw.</p>
<blockquote><p><em>I understand the safe-guards that having a read-only root file system can give but would still prefer not to have to enter rpi-rw each time I want to edit a file.</em></p>
</blockquote>
<p>You can have a balance of both depending on what files you are editing. If you do not want any write restrictions ever, then you clearly don&#39;t want read only at all, I previously mentioned&nbsp;the&nbsp;emoncms&nbsp;data files on a write enabled partition, the same can be done for user docs or media etc. Protecting the system files doesn&#39;t mean everything needs to be read only, likewise being able to save a file to the users desktop doesn&#39;t mean&nbsp;leaving everything accessible.</p>
<p>Don&#39;t be put off by the term &quot;development&quot; with&nbsp;emonHub, that is the only version and the &quot;dev&quot;in &quot;dev-emonhub&quot;&nbsp;actually refers to the install&nbsp;locations and symlinking used to keep the files accessible IF you want to develop, dev-emonhub is the installer&nbsp;script I used during the development of emonhub and it hasn&#39;t been replaced yet.. You cannot get much simpler than copy, paste and run one line of code to install.</p>
<p>I have been working on a similar one line installer for emoncms but it&#39;s not yet complete and currently on the back boiler while I&#39;m working on emonHub.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-29598"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4704.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="BraileTrail&#039;s picture" title="BraileTrail&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emonSD-13-03-15.img read-only root partition</h3>

    <div class="submitted">Submitted by <a href="../user/4704.html" title="View user profile.">BraileTrail</a> on Mon, 13/04/2015 - 20:14.</div>
    <div class="content">
     <p>Paul,</p>
<p>Thanks for spending the time on this.</p>
<p>lsblk says:</p>
<p>root@emonbase:/home/pi# lsblk<br />
NAME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MAJ:MIN RM&nbsp;&nbsp; SIZE RO TYPE MOUNTPOINT<br />
sda&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8:0&nbsp;&nbsp;&nbsp; 0 232.9G&nbsp; 0 disk<br />
&acirc;&acirc;sda1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8:1&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 16G&nbsp; 0 part /<br />
&acirc;&acirc;sda2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8:2&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp;&nbsp; 2G&nbsp; 0 part [SWAP]<br />
&acirc;&acirc;sda3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 8:3&nbsp;&nbsp;&nbsp; 0 214.9G&nbsp; 0 part /home/pi/data<br />
mmcblk0&nbsp;&nbsp;&nbsp;&nbsp; 179:0&nbsp;&nbsp;&nbsp; 0&nbsp; 14.9G&nbsp; 0 disk<br />
&acirc;&acirc;mmcblk0p1 179:1&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp;&nbsp; 56M&nbsp; 0 part /boot<br />
&acirc;&acirc;mmcblk0p2 179:2&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 2.8G&nbsp; 0 part<br />
&acirc;&acirc;mmcblk0p3 179:3&nbsp;&nbsp;&nbsp; 0&nbsp;&nbsp; 779M&nbsp; 0 part</p>
<p>I was a bit worried about the accented characters but a quick Google convinced me it was trying to draw lines to show sub-directory relationships.</p>
<blockquote><p>You cannot get much simpler than copy, paste and run one line of code to install.</p>
</blockquote>
<p>I think, strangely, that was the worry, there was so little to do compared with emoncms.</p>
<p>Thanks,</p>
<p>BraileTrail</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10457"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-N-ciFY7Gye_d62MaC7x_uKLYga2ZJS4xYwXrzSpcVt4" value="form-N-ciFY7Gye_d62MaC7x_uKLYga2ZJS4xYwXrzSpcVt4"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/10457 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:24:27 GMT -->
</html>
