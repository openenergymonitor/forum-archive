<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3930 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:21:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>if (Serial) debug = 1; else debug=0; line in emonTH code - does it work? | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>
        <span class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Tue, 25/02/2014 - 23:24</span>
        <div class="content"><p>I&#39;m customising the code in emonTH and trying to better understand a few parts of it. Line 111 from the <a href="https://github.com/openenergymonitor/emonTH/blob/master/emonTH_DHT22_DS18B20/emonTH_DHT22_DS18B20.ino">current code</a> caught my eye:</p>
<blockquote><p>if (Serial) debug = 1; else debug=0;</p>
</blockquote>
<p>I&#39;d never seen this used before, so looked into it and couldn&#39;t see how it worked, so I wrote a sketch to try it out. Indeed, it doesn&#39;t seem to work - it always returns true it seems.</p>
<p>Am I missing something?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3894.html" class="topic-previous" title="Go to previous forum topic">‹ Arduino MEGA 2560 + ethernet Shield + emonTxShield+I2C-LCD</a>
              <a href="3936.html" class="topic-next" title="Go to next forum topic">single core mains wire ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-18785"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 25/02/2014 - 23:39.</div>
    <div class="content">
     <p>How are you testing this?</p>
<p>I think I know how it <em>should</em> work, and what you&#39;re missing is no serial monitor. According to the language: &quot;boolean : returns true if the specified serial port is available.&quot;. So it should prevent writing debug information to the serial port if the serial port is not available. But if you&#39;re monitoring on the serial port....</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18787"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Wed, 26/02/2014 - 00:23.</div>
    <div class="content">
     <p>I&#39;m monitoring a pin that I am toggling.</p>
<blockquote><p>boolean debug;</p>
<p>const int toggle = 6;</p>
<p>void setup()<br />
		{<br />
		&nbsp; if (Serial) debug = 1; else debug = 0;<br />
		&nbsp;<br />
		&nbsp; pinMode(toggle, OUTPUT);<br />
		&nbsp; digitalWrite(toggle, LOW);<br />
		&nbsp;<br />
		&nbsp; if (debug)<br />
		&nbsp; {<br />
		&nbsp;&nbsp;&nbsp; Serial.begin(9600);<br />
		&nbsp;&nbsp;&nbsp; Serial.println(&quot;Setup&quot;);<br />
		&nbsp;&nbsp;&nbsp; digitalWrite(toggle, HIGH);<br />
		&nbsp;&nbsp;&nbsp; delay(1000);<br />
		&nbsp;&nbsp;&nbsp; digitalWrite(toggle, LOW);<br />
		&nbsp; }<br />
		}</p>
<p>void loop()<br />
		{<br />
		&nbsp; if (debug)<br />
		&nbsp; {<br />
		&nbsp;&nbsp;&nbsp; Serial.println(&quot;Loop&quot;);<br />
		&nbsp;&nbsp;&nbsp; digitalWrite(toggle, HIGH);<br />
		&nbsp;&nbsp;&nbsp; delay(1000);<br />
		&nbsp;&nbsp;&nbsp; digitalWrite(toggle, LOW);<br />
		&nbsp;&nbsp;&nbsp; delay(1000);<br />
		&nbsp; }<br />
		}</p>
</blockquote>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18788"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Wed, 26/02/2014 - 07:07.</div>
    <div class="content">
     <p>I think the short answer is that it doesn&#39;t seem to work.</p>
<p>Each time it sends data, it outputs ~50 characters to Serial, which in turn means that 50*8/9600 = 0.04s is spent sending the data.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18792"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5190.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-5190.jpg" alt="Schism&#039;s picture" title="Schism&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/5190.html" title="View user profile.">Schism</a> on Wed, 26/02/2014 - 08:41.</div>
    <div class="content">
     <p>It doesn&#39;t work on my emonTH units. I discovered this because I wrap my LED pulses in if(debug) statements... then noticed it would still flash away happily when I plugged the batteries in!</p>
<p>&nbsp;</p>
<p>IOW, if(Serial) is always true, whether or not anything is plugged into the serial pins.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18794"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Wed, 26/02/2014 - 08:56.</div>
    <div class="content">
     <p>Yes, if you look in HardwareSerial.h:</p>
<blockquote><p>#if defined(UBRRH) || defined(UBRR0H)<br />
		&nbsp; extern HardwareSerial Serial;<br />
		#elif defined(USBCON)<br />
		&nbsp; #include &quot;USBAPI.h&quot;<br />
		//&nbsp; extern HardwareSerial Serial_;&nbsp;<br />
		#endif<br />
		#if defined(UBRR1H)<br />
		&nbsp; extern HardwareSerial Serial1;<br />
		#endif<br />
		#if defined(UBRR2H)<br />
		&nbsp; extern HardwareSerial Serial2;<br />
		#endif<br />
		#if defined(UBRR3H)<br />
		&nbsp; extern HardwareSerial Serial3;<br />
		#endif</p>
</blockquote>
<p>I think that all that it will do is either exist or not-exist i.e. if the hardware didn&#39;t support Serial it might not compile.</p>
<p>I think this might have a significant impact on battery usage.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18795"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Wed, 26/02/2014 - 09:26.</div>
    <div class="content">
     <p>As you found, if(Serial) is just a test if a serial port is available on that hardware (and this will never change on a given hardware). How should it work instead? It would be necessary to test communication with an external host to know that &#39;something&#39; is connected to the serial port externally.</p>
<p>I have always removed all this &#39;serial&#39; stuff from low power code. Why not simply use a define like _UseSerial or directly #define debug?</p>
<p>PS: this might be different on a Leonardo, where an existing&nbsp; USB connection can be clearly detected.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18797"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Wed, 26/02/2014 - 10:03.</div>
    <div class="content">
     <p>It&#39;s an odd way to detect the hardware though, as it will produced a compile time error if the hardware isn&#39;t present i.e. the debug = 1/0 will never actually be used.</p>
<p>How should it work? For most of my projects I wait a few seconds at startup and if I detect any serial input, I switch debug output on.</p>
<p>It&#39;s not my code, so I was curious about this construct I had never seen before.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18802"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Wed, 26/02/2014 - 14:00.</div>
    <div class="content">
     <p>Good point regarding the serial printing.&nbsp;</p>
<p>I have updated the code on GitHub to have debug turned off by default. The .hex file has also been updated. All the emonTH&nbsp;sold through the shop will have debug turned off by default to improve battery life.</p>
<p><a href="https://github.com/openenergymonitor/emonTH/tree/master/emonTH_DHT22_DS18B20" title="https://github.com/openenergymonitor/emonTH/tree/master/emonTH_DHT22_DS18B20">https://github.com/openenergymonitor/emonTH/tree/master/emonTH_DHT22_DS1...</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18829"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Thu, 27/02/2014 - 10:12.</div>
    <div class="content">
     <p>Glyn - on a lot of my sketches (well, code, I&#39;m only really getting into Arduino&nbsp;vs AVR now), I check to see if serial is available for the first 10s of operation, and if so, turn debug output on, otherwise continue.</p>
<p>I can put an example on github later.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18832"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 27/02/2014 - 11:04.</div>
    <div class="content">
     <p>I believe&nbsp;it&#39;s not possible to detect if a USB to UART cable is connected, as Jbecker mentioned above the check for Serial checks to see if the serial hardware is available (which is always is on the ATmega328). Things are different on the 32u4 used on the Leonardo.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18837"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Thu, 27/02/2014 - 13:10.</div>
    <div class="content">
     <p>I think he means</p>
<p>From the emonTH perspective, listen on the USB port for any input, and if there is something, assume someone is on the other side listening.</p>
<p>From user perspective, when switching on, send anything on UART to have debug activated.</p>
<p>But I may be wrong.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18838"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1332.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1332.jpg" alt="JBecker&#039;s picture" title="JBecker&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/1332.html" title="View user profile.">JBecker</a> on Thu, 27/02/2014 - 13:18.</div>
    <div class="content">
     <p>But if you check for a serial input from an external node, then the UART is already enabled (drawing a little bit of additional current too). Then you can also enable and disable debug output by a command from the external node and it is not necessary to have it enabled all the time. &nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18841"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Thu, 27/02/2014 - 14:12.</div>
    <div class="content">
     <p>Would some code like this do the trick of checking at startup to see if anything is received on serial and if so turning on debug. Obviously a serial string would have to be sent during the two seconds it waits with with UART switching on. If no serial is received the UART can then be turned off to save battery</p>
<p>&nbsp;</p>
<pre>
void setup() {
        Serial.begin(9600);     // opens serial port, sets data rate to 9600 bps
        delay(2000);            // wait two seconds
        if (Serial.available() &gt; 0) //if serial is received
          debug==1;
        else {
        debug==0;
        Serial.end();
        }</pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-18850"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/5022.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="cybergibbons&#039;s picture" title="cybergibbons&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: if (Serial) debug = 1; else debug=0; line in emonTH code - does it work?</h3>

    <div class="submitted">Submitted by <a href="../user/5022.html" title="View user profile.">cybergibbons</a> on Fri, 28/02/2014 - 09:00.</div>
    <div class="content">
     <p>Yes, sorry, I wasn&#39;t clear. If you call Serial.available after waiting a short period, then use that to set debug. A lot of routers and other embedded devices do similar.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3930"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-gMQy--E4-8XcLgXI8AL7wXxrxx2vJu4SgFGSE2RjKR8" value="form-gMQy--E4-8XcLgXI8AL7wXxrxx2vJu4SgFGSE2RjKR8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/3930 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:21:16 GMT -->
</html>
