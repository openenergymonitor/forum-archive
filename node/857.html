<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Digital Supply Meters for PV | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="/emon/sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="/emon/modules/node/node.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/defaults.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/system/system-menus.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/user/user.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/mollom/mollom.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/forum/forum.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/modules/views/css/views.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/modules/comment/comment.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="/emon/sites/all/themes/emon3/style.css?r" />
<style type="text/css" media="all">@import "/emon/sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="/emon/" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="/emon/">Home</a> » <a href="/emon/forum">Forums</a> » <a href="/emon/forum/3">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Digital Supply Meters for PV</h3>
        <span class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 17/07/2012 - 19:37</span>
        <div class="content"><p><a href="http://openenergymonitor.org/emon/sites/default/files/IMGP9714.JPG"><img width="300" height="225" alt="" src="http://openenergymonitor.org/emon/sites/default/files/IMGP9714.JPG" /></a></p>
<p>When diverting surplus PV power for local use, it is important to know that you're doing the job as well as is possible.&nbsp; While the supply meter's LED is 'on', then you're presumably not being charged, but some of your precious energy may be getting away.&nbsp; While the LED is off, then it is possible that the occasional pulse may be getting through for which you will be charged.&nbsp; Adding a safety margin is a poor solution to this dilemma.&nbsp; We could really do with some way of synchronising our virtual meter with the physical box on the wall.</p>
<p>Monitoring the meter's LED seems like a good place to start, but how long is each pulse?&nbsp; Is it 1 ms, or ten mS, who knows - I rather hoped it would turn out to be 42 ...</p>
<p>Here is a simple sketch which measures the period that the LED is on for.&nbsp; The hardware is just three components as shown at the top of the sketch.&nbsp; The LDR that I used came from eBay in a pack of three for around &pound;1.&nbsp; In total darkness, its resistance is just over 1MegOhm, but when held in front of the meter's LED this drops to around 600 Ohms.&nbsp; When testing the sketch using a push-button, I got terrible switch-bounce which was more or less cured by adding the small capacitor.&nbsp; This may not be necessary when the LDR is used with an LED but could help to prevent spurious readings.</p>
<p>Also attached is a small file of results which was copied straight from the Serial window.&nbsp; The LED was already on when I started up the sketch, and it apparently took me 12.7 seconds to get it to go off.&nbsp; I then stopped drawing power and the LED duly came back on some seconds later.&nbsp; Again, I proceeded to draw some power but this time it took me even longer before the LED went out - a whole 13 seconds.&nbsp; Next time, I determined to be more on the ball, and managed to extinguish the glow in an impressive 3 seconds!&nbsp; </p>
<p>Then it was time to measure the 0.001kWh pulse duration while drawing power as demonstrated on the following 11 lines.&nbsp; Having found that the answer to my ultimate question was not actually 42, but 36, it took me some time to recover; 408 seconds to be precise.&nbsp; At which point I whacked on the 2kW heater and the LED finally went out.&nbsp; Good job I'd declared <em>noOfReadings</em> as a <em>long</em>! </p>
<p>It would be most interesting for this test to be repeated elsewhere.&nbsp; Our supply meter is a Landis + Gyr 5235 which seems to be a commonly supplied unit.&nbsp; I found no need to seal the LDR up against the meter, as per photo, but this may be necessary in sunlit conditions.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="/emon/node/1243" class="topic-previous" title="Go to previous forum topic">‹ utility meter response to triac control</a>
              <a href="/emon/node/1201" class="topic-next" title="Go to next forum topic">S0-Interface ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-5257"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 18/07/2012 - 14:09.</div>
    <div class="content">
     <p>The code that I posted yesterday can reveal the length of the LED's pulse.&nbsp; The next stage is to capture what's going on with the LED while also recording energy flow through the meter.&nbsp; That's what today's offering does.</p>
<p>MeterAnaylysisTool checks the state of the LED once every mains cycle.&nbsp; If the LED has just turned on, a flag is set.&nbsp; If it goes off again within 50mS, then it must have been a pulse in which case the flag is cleared and **LED_PULSE** is sent to the Serial Output.&nbsp; If 50mS goes by with the LED still being on, then a **LED_ON** event is declared; and&nbsp; similarly for **LED_OFF**.&nbsp; I did start to use an interrupt for this but found that it didn't help.&nbsp; With LED pulses being around 35mS in duration, polling every 20mS should allow all relevant data to be collected.&nbsp; </p>
<p>The tool also displays energy flow through the meter each second, along with a timestamp.&nbsp; No limits are set, it just winds its way up and down an endless line of Joules.&nbsp; When importing power using a well calibrated system, one would expect to see the LED pulse every 3600J.&nbsp;&nbsp; Using a faster serial rate would be a worthwhile improvement.&nbsp; </p>
<p>Also attached are two sets or results when the PV was active and our consumption was moving to and fro across the interesting zone.&nbsp; Both generation and consumption was changing during these periods, but that's surely all to the good.&nbsp; Somewhere in the data there will hopefully be examples of most types of operation; importing or exporting at small and large rates, and changes of direction etc.&nbsp; In stable conditions, a more objective schedule of tests may be possible. Maybe someone would like to port this data into a spreadsheet and tell me what it all means&nbsp; ;)</p>
<p>Each of my power-routing systems appear to be biassed towards the <em>exporting</em> of power.&nbsp; When the system is operational, the meter's LED is nearly always on. &nbsp; With a safety margin of 0W, I've never understood why this is happening.&nbsp; I wonder how other systems behave in this regard?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5591"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Wed, 08/08/2012 - 11:37.</div>
    <div class="content">
     <p><em>Each of my power-routing systems appear to be biassed towards the <em>exporting</em>  of power.&nbsp; When the system is operational, the meter's LED is nearly  always on. &nbsp; With a safety margin of 0W, I've never understood why this  is happening.&nbsp; I wonder how other systems behave in this regard?</em></p>
<p>I now think this is the anti-creep mechanism cutting in, so no problem.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6442"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 30/09/2012 - 08:15.</div>
    <div class="content">
     <p>To help with our understanding of how digital meters work, here is a virtual one.&nbsp; Just load it onto an Arduino and follow the instructions on the screen.&nbsp; I think it matches the basic operations of inport and export for our Landis 5235A meter OK, but the anti-creep mode may need a bit of tweaking.</p>
<p>Do give it a try, and feel free to make any changes that may be appropriate.&nbsp;</p>
<p>Sketch attached, plus an output file.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6537"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1399" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1399.jpg" alt="Series530&#039;s picture" title="Series530&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1399" title="View user profile.">Series530</a> on Sun, 07/10/2012 - 08:12.</div>
    <div class="content">
     <p>Out of interest Robin, do you have a feel for how easy it would be and how the accuracy may be affected were this code to be integrated within the MK2 sketch?&nbsp;</p>
<p>&nbsp;</p>
<p>I ask because, with my system I have the MK2 sketch running but with the additional transmission of energy consumption calculated and then correlated against the enviR/Optismart&nbsp;(which does the same thing as your sketch).</p>
<p>&nbsp;</p>
<p>While the enviR is the most accurate reference when the LED on the meter is flashing it is hopeless when the LED is constant (during export). It would be interesting to know if a pulse reader could be incorporated with the MK2&nbsp;and the pulse reader over rides the CT/VT when the system is importing from the grid and the CT/VT over rides when the system is in export mode.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6545"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Sun, 07/10/2012 - 18:03.</div>
    <div class="content">
     <p>Ian, I don&#39;t see how this simulation could be usefully incorporated into a working PV power router.&nbsp; As written, its sole purpose was to get people thinking about how their meters work, and talking the same language.&nbsp; In particular, it allows the anti-creep mode to be investigated, the manuals are not at all helpful about how this feature works.</p>
<p>My Mk2 code (the mini version) can already detect and categorise LED events.&nbsp; All LED events, most of which are chargeable, are displayed to the Serial Monitor but the algorithm doesn&#39;t currently make use of that information.&nbsp; Tweaking the value of <em>safetyMargin_watts</em> may allow a bit of additional power to be gleaned out of the grid - monitoring the LED&#39;s behaviour would show whether any charge was being incurred.</p>
<p>When the house is importing power, Mk2 effectively switches off, so I don&#39;t understand why you would want the normal V &amp; I sensors to be over-ridden.&nbsp; If a &quot;chargeable event&quot; were to be seen while Mk2 is busy diverting surplus power, that means there has been a drift between the two measurement systems.&nbsp; In that situation, I think it would be better for the diversion algorithm to be throttled back a bit, possibly by increasing the safety margin&#39;s value.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6549"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1399" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1399.jpg" alt="Series530&#039;s picture" title="Series530&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1399" title="View user profile.">Series530</a> on Mon, 08/10/2012 - 04:48.</div>
    <div class="content">
     <p>I wasn&#39;t thinking of the simulator version - just the fully operational one.</p>
<p>&nbsp;</p>
<p>The way that my system works, which uses your core, has three general operating areas. The first is import (when the PV is insufficient to provide any surplus dump). The second is dump (when there is sufficient PV to drive the dump and, provided the system is properly tuned, there is little or no export). Thirdly, there is pure export (when the PV dump has been fully charged and there is no place to send the surplus power aside from back to the grid).</p>
<p>In the first operating area it is possible to correlate the enviR&nbsp;with my version of the energy monitor because both with generate a reading (the enviR&nbsp;timing pulses from the meter). In the second area it doesn&#39;t really matter as the surplus power is being sent to the immersion heater and the export should be very near zero (ignoring the safety margin). In the third region my enviR &nbsp;cannot measure anything because the LED&#39;s on the meters stay on permanently. My sketch can measure though, albeit within the accuracy that the hardware will allow.</p>
<p>The point of my question was to understand if you have made any measurements to see how long it takes for the microcontroller to check the static state of the IO pins which are linked to the LDR&#39;s and if, by having them embedded within the MK2 sketch (I hadn&#39;t noticed them set to read mode in the version that I used) they had any effect upon the operation of the original sketch (error, drift, etc).</p>
<p>The thought that I had with regard to my hardware was to incorporate capability within it which would read the light pulses when the system is working in mode one while in modes two and three it would use the current and voltage transformers instead. I may then consider sending an extended set of data up to Pachube&nbsp;as an extended project with emonbase which incorporates a lot more information than I am currently sending via enviR.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6550"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1165" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="richmc&#039;s picture" title="richmc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1165" title="View user profile.">richmc</a> on Mon, 08/10/2012 - 08:21.</div>
    <div class="content">
     <p>What you have Robin is the basis for a truly accurate energy monitor, I&#39;ve been disappointed in the way a number of the commercial monitors work&nbsp;have a look at-</p>
<p><a href="http://www.talkingsolar.co.uk/index.php/forum/7-arduino-circuit-discussions/750-robins-mk2-and-the-meter">http://www.talkingsolar.co.uk/index.php/forum/7-arduino-circuit-discussions/750-robins-mk2-and-the-meter</a></p>
<p>This shows how the Eco Eye Smart PV sees the power being used, unfortunately instead of averaging the power like the supply meter does it records the peaks as being import. Now my thoughts are. If the Mk2 CT input could be used to separately measure the averaged power like the meter does, and generate a signal that mimics the CT but with a signal that follows what the meter is responding to i.e. no peaks and dips, then this could be used to feed whatever monitor is in use via a separate output. As my Arduino skills are about at the fading LED stage I&#39;m going to throw this idea to the mercy of those who know better. I&#39;m also thinking this would by applying the low pass filter be able to clean up the CT signal at low levels.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6555"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 08/10/2012 - 13:39.</div>
    <div class="content">
     <p>Ian, just to recap, the sole purpose of my Mk2 router is to divert surplus power to a dump load.&nbsp; This is achieved by rapidly switching the load on and off using a simple algorithm.&nbsp; To my mind, one of the great benefits of the Mk2 is that it needs no calibration.&nbsp; Using only a single point of measurement, the algorithm serves to balance import and export so that there is no net flow through the utility meter.&nbsp; Hence there is no charge to the user, and no energy is lost to the grid.&nbsp; The router just sits there 24/7 waiting for surplus power to appear.&nbsp; Sorted.</p>
<p>Your system, however, is more ambitious.&nbsp; Having arranged to dump surplus power as above, you also require accurate stats to be available at all times.&nbsp; This may imply the need for accurate calibration - but not necessarily. &nbsp; At all stages of the day/night, the most accurate indication of your expenditure is that provided by the supply meter via its LED.&nbsp; If you want to use that source of data for stats purposes, rather than equivalent data from the V&amp;I sensors, then that would seem a perfectly reasonable thing to do.&nbsp; The cut-down version of my sketch already includes code for categorising LED events so it would be an easy matter to obtain an accurate tally of chargeable events, each one worth 0.001kWh of expenditure.&nbsp; Because the system would just be relaying events from the meter, there would still be no need for any calibration.</p>
<p>While surplus power is being actively diverted, there is bound to be some degree of drift between the Arduino&#39;s assessment of energy flow and that of the utility meter - both nominally zero.&nbsp; When using a digital meter, this drift may lie within the anti-creep parameters, in which case no import pulses would be seen.&nbsp; But if there were any drift towards export, that effect would be undetectable using a standard digital supply meter.&nbsp; Hence my interest in having a disc-style meter in series with the existing one so that the amount of drift can be accurately monitored throughout the entire range of operation (0 - 3kW of surplus power).</p>
<p>I will soon have a couple of additional meters to play with: a used 5235 from eBay, and a disc-style unit kindly donated by noah.&nbsp; Over the next couple of weeks, these will be connected up so that the behaviour of my Mk2 setup can be better&nbsp; understood while in its operating mode.&nbsp; Once the amount of surplus power falls below zero, I have little interest in monitoring the imported power - the only thing that matters to me is that the triac and load are firmly off.&nbsp; That&#39;s another good feature of Mk2.&nbsp; The immersion goes off within around 30mS of the kettle going on.&nbsp; I&#39;ve yet to see a phase-angle controller which can deliver that kind of performance!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6556"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Mon, 08/10/2012 - 14:24.</div>
    <div class="content">
     <p><em>richmc: What you have Robin is the basis for a truly accurate energy monitor,&nbsp; </em></p>
<p>Thanks for those kind words, Rich, but I think such praise is undeserved, and may possibly be misleading to some.&nbsp; For a start, my system of measurement was copied directly from that used by the standard OEM V&amp;I sketch in the Building Blocks page.&nbsp; The original code can be found in the eMonLib library function, calcVI().</p>
<p>My system is actually <u><em>less</em></u> accurate than the original on two counts.&nbsp; Firstly, my sketch never checks the voltage of the reference supply.&nbsp; Secondly, the hardware setup - for good reason - is essentially uncalibrated.&nbsp; Having recently fitted a less-sensitive CT to my rig in the garage, I have never bothered to amend POWERCAL because I genuinely believe there is no need to do so.&nbsp; Mk2&#39;s ability to divert surplus power does not depend on its calibration.</p>
<p>The best way to measure imported power using a digital meter is undoubtedly to monitor the meter&#39;s LED activity, which the cut-down Mk2 code can already do.&nbsp; Similarly, the best way to measure exported power would undoubtedly be to install a second digital meter in the opposite direction and then monitor its LED activity.&nbsp; An &quot;energy monitor&quot; of this type would record the passage of every WattHour&#39;s worth of flow in either direction with total accuracy.&nbsp;</p>
<p>Unfortunately, for the purpose of diverting surplus power, monitoring LEDs is always just too late hence my alternative approach :D&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6559"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Mon, 08/10/2012 - 16:10.</div>
    <div class="content">
     <p>Just adding to Robin&#39;s reply: In essence, his rig is controlling <em><strong>towards zero</strong></em>, therefore symmetry of the calibration about zero is the important property and the scale factor of the calibration has little effect on the overall result. If you measure 55 J each way instead of 50, it makes no difference - you are still back to where you started from. And that&#39;s how it works.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6560"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 09/10/2012 - 08:55.</div>
    <div class="content">
     <p>Thanks Robert.&nbsp; Yes, it is <strong><em>the flow of energy through the supply meter</em></strong> which my rig is controlling towards zero.&nbsp; It does this by keeping the level in the accumulator (energy bucket) close to a constant value.&nbsp; This value happens to be 1800J, but the number itself is not important, nor is the absolute calibration.&nbsp;</p>
<p>The only aspect of importance is the system&#39;s linearity, i.e. <strong><em>the consistency of its calibration across the +/- 3kW range.</em></strong>&nbsp; Why plus and minus?&nbsp; Well, when minimal surplus PV is available, the instantaneous rate of import during those (infrequent) cycles for which the triac is &#39;on&#39; could be up to 3kW.&nbsp; Similarly, when plenty of surplus PV is available, the instantaneous rate of export during those (infrequent) cycles when the triac is &#39;off&#39; could again be up to 3kW.&nbsp; During all other cycles while the router is active, the current flow at the supply point will be somewhere between these two extremes.&nbsp;</p>
<p>If the measurement system is truly linear, then the symmetry of the calibration either side of zero Watts will be perfect.&nbsp; With some of the strange waveform profiles that have been posted, I&#39;m amazed how well Mk2 actually works!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6566"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1165" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="richmc&#039;s picture" title="richmc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1165" title="View user profile.">richmc</a> on Tue, 09/10/2012 - 08:51.</div>
    <div class="content">
     <p>Thats what I&#39;m getting at Robin.</p>
<p>As you say the waveforms are weird, but thats what&#39;s happening to the power in &quot;real life&quot; what I would like to see is the waveform as the supply meter sees it, after all&nbsp;thats the important one as thats what we are charged on, so a &quot;simulated&quot; CT output that could be fed into any energy monitor that actually reflects what the supply meter is doing would be of more use than the false (although accurate) thats being used to calculate usage.</p>
<p>Now as I said I would have no idea how to go about this, I&#39;m guessing some code inserted into the sketch like your meter simulation, outputting to an opamp with gain adjustment for calibration(dirty word, but relates to energy monitors). The idea of adding another meter seems over the top if the Arduino can be called to do the same job with a simulated meter?</p>
<p>And I stand by my &quot;kind words&quot; what I meant was the idea of simulating the meter could be the basis of an accurate energy monitor. As we&#39;ve said all along your Mk2 design doesn&#39;t depend on accurate measurement but good response to the feedback loop.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6572"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 09/10/2012 - 11:51.</div>
    <div class="content">
     <p>&quot;the waveforms are weird, but that&#39;s what&#39;s happening to the power in &quot;real life&quot; what I would like to see is the waveform as the supply meter sees it, after all&nbsp;that&#39;s the important one as that&#39;s what we are charged on, so a &quot;simulated&quot; CT output that could be fed into any energy monitor that actually reflects what the supply meter is doing would be of more use than the false (although accurate) that&#39;s being used to calculate usage.&quot;</p>
<p>I don&#39;t understand what you&#39;re trying to get at here. If the supply meter and the c.t. are on the same cable, they both see the same current. Within the limitations of the sampling rate of each, they will surely measure the same quantity. The same goes for the voltage.</p>
<p>Are you trying to say that because Robin&#39;s algorithm doesn&#39;t calibrate voltage and current independently, the absolute power calculation is wrong? If so, you&#39;re probably correct. The easy answer will be to remove Robin&#39;s POWERCAL and revert to separately calibrating the current and voltage, as in the demo sketches, at which point the power calibration should be correct and should agree with other measurements. I believe Robin did it this way to reduce the complication and number of calculations.</p>
<p>What is totally confusing me is the notion of an op-amp output. What quantity are you intending to transmit and to where and for what purpose?</p>
<p>I&#39;m also confused by &quot;simulating&quot; the meter to accurately measure consumption. Don&#39;t you mean &quot;emulate&quot;?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6576"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1165" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="richmc&#039;s picture" title="richmc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1165" title="View user profile.">richmc</a> on Tue, 09/10/2012 - 13:04.</div>
    <div class="content">
     <p>We are at crossed purposes here, what I&#39;m trying to say is the monitor systems I&#39;ve come across like the Eco Eye et al see literally what is produced by the CT, a waveform that exceeds and dips across the mean, they ignore the dips as they are considered as export but count all the peaks as import so giving an inaccurate report on energy costs as recognized by the consumer meter. Robin has already shown it&#39;s possible to simulate or emulate the action of the meter.</p>
<p>&quot;If the supply meter and the c.t. are on the same cable, they both see the same current.&quot;</p>
<p>They may. But the supply meter responds in a completely different way, to put it crudely it seems to average out the power consumption, I have graphs from the Eco Eye Trax software showing when the diverter is working I&#39;m importing power when my supply meter says not, that&#39;s how the system works. What I&#39;m after is a way of measuring the power in the same way the meter does, not to use it to influence how the diverter works that&#39;s perfect, but to allow me to monitor power usage the same way as the supply meter. My thoughts are that the Arduino should be able to handle a routine to mimic the supply meter and give an output&nbsp; so that&nbsp;it can be used to show the actual power as the meter sees it.</p>
<p>The idea of a buffered opamp output&nbsp; is to have a &quot;cleaned up&quot; signal that does not show the burst fire signal but shows a signal the same as the supply meter would interpret it. The quantity of the signal would be the same as the signal the CT is seeing but without the burst fire, that seems to confuse a lot of measuring devices. Where and what purpose is to give a realistic signal for any measuring device to use. I only see the opamp output as a way to fine tune the signal level to match the measuring device.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6579"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Tue, 09/10/2012 - 17:23.</div>
    <div class="content">
     <p>The sole purpose of my Mk2 arrangement is to maintain zero net flow of energy at the supply point.&nbsp; It does this by pulsing power to the dump load using a simple on/off algorithm.</p>
<p>With only one thing to do, Mk2 thankfully seems to perform its task pretty well.&nbsp; So, whenever it is actively diverting power, the net flow of current through the meter can reasonably be assumed to be zero, whatever any other piece of clip-on kit may be saying.</p>
<p>OK, but when is the algorithm &quot;actively diverting power&quot;?&nbsp; I would suggest having a range of energy bucket values, within which the algorithm is deemed to be active, and beyond which it isn&#39;t.&nbsp; How about, say 1300 - 2300J?&nbsp; The numbers are really not important, just so long as they are not too restrictive.&nbsp; Mk2 does need some headroom within which to operate.&nbsp; While surplus power is being actively diverted, the energy bucket&#39;s level should always be within a couple of hundred watts of the 1800J threshold.&nbsp;</p>
<p>If you do go down this route, you may wish to ensure that your system is calibrated a bit better than mine :D</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6590"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/924" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/924" title="View user profile.">Robert Wall</a> on Tue, 09/10/2012 - 22:25.</div>
    <div class="content">
     <p><a href="http://openenergymonitor.org/emon/user/1165" title="View user profile.">richmc</a></p>
<p>Ah, I think I understand a bit better now - you mean the <strong><em>envelope</em></strong> of the current waveform (taking direction into account), not the current waveform itself. And you&#39;re interested in getting the same readings as your tariff meter (whether or not that is truly accurate, in other words ignoring power that is below the creep threshold, etc.).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6867"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 26/10/2012 - 13:12.</div>
    <div class="content">
     <p>While my PV Router is diverting surplus power, it has always been unclear to me what the supply meter is doing.&nbsp; Sometimes the &#39;export&#39; LED is on and sometimes it&#39;s not.</p>
<p>	To satisfy my curiosity, I&#39;ve bought a digital meter (an Ampy 5196) which appears to operate in a similar manner to our Landis 5235A.&nbsp; When connected in series, their pulse rates match to around 1 part in 400.</p>
<p>	I needed to pass current through my new meter in both directions.&nbsp; This was achieved using a pair of 2-pole switches as shown in the attached diagram and photo.&nbsp;</p>
<p>	To measure the current that was flowing, I constructed a sketch which emulates the operation of the meter.&nbsp; This uses a standard CT and voltage sensor and monitors the energy flow adjacent to the meter.&nbsp; By sneaking an extra wire through the CT only, the emulator could be advanced relative to the meter using the current drawn by a 60W light bulb.&nbsp; This allowed the two LEDs to be synchronised.&nbsp;</p>
<p>	With the sketch as attached and POWERCAL correctly set, the operation of my emulator appears to closely match that of the digital meter.&nbsp; Their LEDs operate nicely in tandem as current flows in either direction.&nbsp; To understand how the upper and lower limits for the meter&#39;s accumulator (aka energy bucket) operate, please consult the sketch.</p>
<p>	The attached set of results record the situation when different periods of export were interspersed with import.&nbsp; Unlike the real meter, the sketch displays how much energy has flowed between each consecutive pair of charge-points.&nbsp; Any loss of energy can therefore be detected.&nbsp;</p>
<p>	The rest of this post can be summarised as &quot;Mk2 works fine just as it is&quot;, but if you want the more complete account, please read on ...</p>
<p>	Turns out that the meter&#39;s operation is even simpler than I&#39;d previously thought.&nbsp; Having bought some energy from the grid (seen as a pulse at the meter&#39;s LED), the next 3600J&#39;s worth of space (headroom?) is then available for energy to be freely moved back and forth.&nbsp; This &#39;no-penalty&#39; zone starts precisely where you were when the last pulse occurred, and ends when the next pulse is due.&nbsp;</p>
<p>	Say that the kettle goes off just before the next pulse is due.&nbsp; If any surplus PV is available, Mk2&#39;s energy bucket starts to fill.&nbsp; After 1800J of export, Mk2 starts to allocate power to the dump load.&nbsp; At no stage has the meter&#39;s &#39;export&#39; light come on because we&#39;re still located within its &#39;no-penalty&#39; window.</p>
<p>	OK, but what if the kettle goes off just after a pulse has occurred?&nbsp; What happens then is that the action of filling Mk2&#39;s energy bucket causes the &#39;export&#39; LED to appear at the meter.&nbsp; While export continues, some of the energy that you&#39;ve just paid for is being lost to the grid.&nbsp; Without doing anything differently, you have inadvertently strayed outside the &#39;no-penalty&#39; zone and are paying the (very small) penalty for so doing.</p>
<p>	So wouldn&#39;t it be better to operate Mk2&#39;s energy bucket at a lower level?&nbsp; The short answer is yes, *** BUT *** you&#39;d have to be certain that your system would never encroach the lower limit (0J) during normal operation.&nbsp; Retaining the 1800J threshold provides a huge margin of tolerance for poorly calibrated Mk2 systems.&nbsp;</p>
<p>	Although technically a good move, the financial benefit that could be obtained by lowering the operating threshold is tiny.&nbsp; Each time that surplus PV becomes available, the &#39;phase&#39; (correlation?) relative to the meter&#39;s internal thresholds will essentially be random.&nbsp; Some start-up events will be nicely aligned with the meter&#39;s internal thresholds (hence no loss of energy), but others will incur some loss as Mk2&#39;s energy bucket fills.&nbsp; On average, let&#39;s say we lose half of the bucket&#39;s threshold capacity each time, i.e. 900J.&nbsp;</p>
<p>	If we were to use a lower threshold, say 200J, then we would lose on average only 100J per startup, that&#39;s a benefit of 800J each time that surplus power becomes available.&nbsp; If periods of surplus power were to be interspersed with periods of power consumption at a rate of once per minute over a period of six hours, that&#39;s a potential saving of 0.288MJ.&nbsp; One kWh is 3.6MJ, so the potential saving per day is around one penny.&nbsp;</p>
<p>	The scenario that I&#39;ve outlined here is clearly an extreme case.&nbsp; On most days, there would be far fewer startups than I&#39;ve suggested, hence even less benefit for reducing the threshold value.</p>
<p>	With less than around 17W of forward current, the Ampy&#39;s anti-creep mode cuts in after about 4 minutes.&nbsp; While in this state, the internal register is not updated so no charge is applied.&nbsp; Nice to know but tedious to test!&nbsp;<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6869"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/1774" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-1774.jpg" alt="PaulOckenden&#039;s picture" title="PaulOckenden&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/1774" title="View user profile.">PaulOckenden</a> on Fri, 26/10/2012 - 13:51.</div>
    <div class="content">
     <p>There&#39;s a law of diminishing returns here. Any import is probably only micro-pence. Even if it was a penny or two it would take a long time to pay for any tinkering time and especially for any hardware changes.</p>
<p>I think what I&#39;m trying to say is, it works bloody well already!</p>
<p>P.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6878"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="/emon/user/956" title="View user profile."><img src="http://openenergymonitor.org/emon/sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Digital Supply Meters for PV</h3>

    <div class="submitted">Submitted by <a href="/emon/user/956" title="View user profile.">calypso_rae</a> on Fri, 26/10/2012 - 17:50.</div>
    <div class="content">
     <p>Sure, Paul, I quite agree.&nbsp; Glad you approve!!</p>
<p>As the originator of this baby (beast?), I want to make sure that it&#39;s working as well as possible.&nbsp;&nbsp; For anyone who&#39;s not started to build their system already, it&#39;s good for them to have the best guidance that&#39;s available.</p>
<p>The original Mk2 design does indeed work fine, as demonstrated by another tank of DHW for us today :D&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="/emon/node/857"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-cEMGfimjk_Cpipt5A12kXrPp2pSIp7UcD9OKkZngpas" value="form-cEMGfimjk_Cpipt5A12kXrPp2pSIp7UcD9OKkZngpas"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org">https://community.openenergymonitor.org</a></p>
   
</div>

<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
