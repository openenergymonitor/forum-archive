<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5928 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:40:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>emontx shield V2 with RFM12b on Arduino UNO R2 can&#039;t get signals to raspberry pi | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">emontx shield V2 with RFM12b on Arduino UNO R2 can&#039;t get signals to raspberry pi</h3>
        <span class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Tue, 14/10/2014 - 12:14</span>
        <div class="content"><p>Hi all,</p>
<p>&nbsp;</p>
<p>I already have a raspberry pi and an&nbsp;emonTH&nbsp;working just fine, logging temperature and humidity on the emoncms.org site.</p>
<p>&nbsp;</p>
<p>I am now trying to set up a&nbsp;emontx shield V2 with RFM12b on an existing&nbsp;Arduino UNO R2, I&#39;ve run the&nbsp;Shield_CT1234 sketch (among others).... which compiles fine and outputs OK to serial (i pick that up via usb on my PC).</p>
<p>&nbsp;</p>
<p>The red LED on pin 9 is also blinking every 2 seconds... so that seems OK too...</p>
<p>&nbsp;</p>
<p>However, I am not getting any readings on the raspberry pi, that is, nothing is showing up on the &quot;inputs&quot; of emoncms.org, except the emonTH inputs that were already working....</p>
<p>&nbsp;</p>
<p>So : something is not working with the wireless transmitting...</p>
<p>&nbsp;</p>
<p>I&#39;m pretty bad at soldering, perhaps I did a rubbish job and something is not connected correctly on the&nbsp;RFM12b ? It was a lot smaller and more fiddly than I thought it would be!</p>
<p>&nbsp;</p>
<p>I have not yet tried the basic &quot;Tx_SimpleRFM12B_demo&quot; sketch, not sure if that will help....</p>
<p>&nbsp;</p>
<p>note: I accidentally soldered the&nbsp;CT jack sockets THE WRONG SIDE UP (yes I&#39;m an ass), but I&#39;m guessing/hoping this should not influence the RFM12b&nbsp;wireless transmissions.... and hopefully the WATT readings can just be multiplied by -1 on emoncms (if they ever get through...)&nbsp;</p>
<p>&nbsp;</p>
<p>I hope someone has some input, thanks.&nbsp;</p>
<p>&nbsp;</p>
<p>Regards</p>
<p>Lasse, Denmark</p>
<p>&nbsp;</p>
<p>picture of shield on ardunio uno:</p>
<p><a href="../../../www.lassetobiasen.dk/images/DSC03933%20-%20shield%20on%20uno.jpg">http://www.lassetobiasen.dk/images/DSC03933%20-%20shield%20on%20uno.JPG&nbsp;</a></p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5993.html" class="topic-previous" title="Go to previous forum topic">‹ Too high voltage measurement compared to mains voltage (uno + emonTX Shield)</a>
              <a href="4306.html" class="topic-next" title="Go to next forum topic">Using an emonTx V3 as a Mk2 PV Router ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-24550"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 14/10/2014 - 15:29.</div>
    <div class="content">
     <p>Some of the soldering on one side isn&#39;t all it could be, and the other side is out of focus! However, as the sketch is running and it appears to be transmitting (it is not hanging), then we must check other things first.</p>
<p>Is it the sketch the correct frequency and group for your existing set-up? Is the RFM12B the correct frequency? (See <a href="https://learn.openenergymonitor.org/?redirect=rfm12b-wireless" title="http://openenergymonitor.org/emon/buildingblocks/rfm12b-wireless">http://openenergymonitor.org/emon/buildingblocks/rfm12b-wireless</a>)</p>
<p>If all those are correct, then a careful look at the RFM12B connections with a magnifying lens would be the next move.</p>
<p>To solve your CT problem, if I read the drawings correctly, all you need to do is move one wire in the plug from the tip to the ring.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24556"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Tue, 14/10/2014 - 19:51.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>&nbsp;</p>
<p>Thank you for your kind input. I have tried to look at the solders on the RFM12 and this they seem ok but not great..</p>
<p>Yes, the RFM12B&nbsp;is at the correct frequency (433) and network (210)...</p>
<p>I tried running the &quot;Tx_SimpleRFM12B_demo&quot; sketch to try and further dig into the problem....</p>
<p>(<a href="https://raw.githubusercontent.com/openenergymonitor/RFM12B_Simple/master/Tx_SimpleRFM12B_demo/Tx_SimpleRFM12B_demo.ino" title="https://raw.githubusercontent.com/openenergymonitor/RFM12B_Simple/master/Tx_SimpleRFM12B_demo/Tx_SimpleRFM12B_demo.ino">https://raw.githubusercontent.com/openenergymonitor/RFM12B_Simple/master...</a>)</p>
<p>I found this sketch to stop (hang) at the command.</p>
<p><em>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rf12_sendNow(0, &amp;emontx, sizeof emontx); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
	&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rf12_sendWait(2);</em></p>
<p>It works fine with these two lines commented out (although obviously nothing is sent via the RFM12B).</p>
<p>Is the &quot;hang&quot; useful in any way? Asides to hint that it&#39;s a hardware problem?</p>
<p>Maybe I should go through all the solders.... or perhaps a incorrect jumper setting on the UNO ? &nbsp;</p>
<p>Kind regards</p>
<p>Lasse</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>code:</strong></p>
<p>//Simple RFM12B wireless demo - transimtter - no ack<br />
	//Glyn Hudson openenergymonitor.org GNU GPL V3 7/7/11<br />
	//Credit to JCW from Jeelabs.org for RFM12<br />
	#define RF69_COMPAT 0&nbsp; // define this to use the RF69 driver i.s.o. RF12<br />
	#include &lt;JeeLib.h&gt;&nbsp; //from jeelabs.org</p>
<p>#define myNodeID 10&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //node ID of tx (range 0-30)<br />
	#define network&nbsp;&nbsp;&nbsp;&nbsp; 210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //network group (can be in the range 1-250).<br />
	#define RF_freq RF12_433MHZ&nbsp;&nbsp;&nbsp;&nbsp; //Freq of RF12B can be RF12_433MHZ, RF12_868MHZ or RF12_915MHZ. Match freq to module</p>
<p>
	typedef struct { int power1, power2, power3, battery; } PayloadTX;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // create structure - a neat way of packaging data for RF comms<br />
	PayloadTX emontx;&nbsp;</p>
<p>const int LED = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //emonTx Shield<br />
	void setup() {</p>
<p>&nbsp; rf12_initialize(myNodeID,RF_freq,network);&nbsp;&nbsp; //Initialize RFM12 with settings defined above&nbsp;</p>
<p>Serial.begin(9600);<br />
	Serial.println(&quot;RFM12B Transmitter - Simple demo&quot;);</p>
<p>Serial.print(&quot;Node: &quot;);<br />
	Serial.print(myNodeID);<br />
	Serial.print(&quot; Freq: &quot;);<br />
	if (RF_freq == RF12_433MHZ) Serial.print(&quot;433Mhz&quot;);<br />
	if (RF_freq == RF12_868MHZ) Serial.print(&quot;868Mhz&quot;);<br />
	if (RF_freq == RF12_915MHZ) Serial.print(&quot;915Mhz&quot;);<br />
	Serial.print(&quot; Network: &quot;);<br />
	Serial.println(network);</p>
<p>pinMode(LED, OUTPUT);<br />
	//blink 2s to show we are starting<br />
	digitalWrite(LED, HIGH); delay(2000); digitalWrite(LED, LOW);&nbsp;&nbsp;<br />
	}</p>
<p>void loop() {<br />
	&nbsp; emontx.power1=emontx.power1+1;<br />
	&nbsp; emontx.power2=emontx.power2+2;<br />
	&nbsp; emontx.power3=emontx.power3+3;<br />
	&nbsp; emontx.battery=emontx.battery+4;<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; rf12_sendNow(0, &amp;emontx, sizeof emontx);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; rf12_sendWait(2);<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp; Serial.print(&quot;power1: &quot;); Serial.println(emontx.power1);<br />
	&nbsp; Serial.print(&quot;power2: &quot;); Serial.println(emontx.power2);<br />
	&nbsp; Serial.print(&quot;power3: &quot;); Serial.println(emontx.power3);<br />
	&nbsp; Serial.print(&quot;battery: &quot;); Serial.println(emontx.battery);<br />
	&nbsp; Serial.println(&quot;&nbsp; &quot;);<br />
	&nbsp;<br />
	&nbsp; digitalWrite(LED, HIGH); delay(500); digitalWrite(LED, LOW);&nbsp;&nbsp;<br />
	&nbsp; delay(2000);<br />
	}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24559"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 14/10/2014 - 22:00.</div>
    <div class="content">
     <p>A &#39;hang&#39; is a good indication that the RFM12B is not responding to the library and the function is not returning. Check your jumper settings and your soldering. Failing that, it might be a faulty RFM12B but most problems with it have turned out to be soldering (look for whiskers as well as bad joints). It might also be a repeat of the problem we saw a few days ago where it needed the interrupt changing in both hardware and software to work (see <a href="5908.html" title="http://openenergymonitor.org/emon/node/5908">http://openenergymonitor.org/emon/node/5908</a>). If everything else looks good, try that.</p>
<p>(Not all the pads on the RFM12B are used - check the Wiki and the Eagle CAD files to see which you need to pay attention to.)&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24581"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Wed, 15/10/2014 - 20:11.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>I&#39;ve re-checked the solders (getting slightly better at it now) and also -- like the fellow in node 5908 -- changed the SS to pin 5, with the option 2 (as per&nbsp;http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield if anyone else is reading)</p>
<p>That seemed to solve the problem and the RFM12B is now transmitter to my base, and on to emoncms. (I&#39;m quite surprised how much the soldering quality makes a difference!).</p>
<p>in any case thank you for your help :-)</p>
<p>Now I&#39;ll try and solve my CT problem, moving the wire in the plug as you suggest.</p>
<p>Kind regards</p>
<p>Lasse</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24604"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 17/10/2014 - 11:11.</div>
    <div class="content">
     <p>@lassetobiasen, did you need to make the change to RF12.cpp too? It looks like dig 10 does not work on my UNO here either, not sure how I missed that. It worked for me with set_cs set to 5 + the modification to RF12.cpp.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24606"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 17/10/2014 - 11:35.</div>
    <div class="content">
     <p>Sorry, not sure what I did there, it is working fine for me now on dig 10 with no modifications to RF12.cpp and standard firmware.</p>
<p>I have the jumper on Dig10 as so:</p>
<p><a href="../sites/default/files/IMG_20141017_123634390.jpg"><img alt="" src="../sites/default/files/IMG_20141017_123634390.jpg" style="width: 600px; height: 337px;" /></a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24611"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Fri, 17/10/2014 - 14:59.</div>
    <div class="content">
     <p>Trystan,</p>
<p>Thanks for replying: yes, I made the RF12.cpp changes when using dig 5... that made it work!</p>
<p>That being said, my soldering is generally not up to scratch which may be the reason dig 10 was not working.....</p>
<p>Now Im&nbsp;trying&nbsp;to make the CT connector work: I soldered the socket wrong way up.... :-(</p>
<p>&nbsp;</p>
<p style="display: inline !important; ">I&#39;ll post some details on that later; Robert suggested I made changes to the plug....</p>
<p>Kind regards from rainy Denmark</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24649"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Sat, 18/10/2014 - 18:54.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>Not sure if you are still reading this thread - I am having some problems with the CT connectors soldered &quot;upside down&quot; as i wrote earlier.</p>
<p>(see <a href="../../../www.lassetobiasen.dk/images/DSC03933%20-%20shield%20on%20uno.jpg" title="http://www.lassetobiasen.dk/images/DSC03933%20-%20shield%20on%20uno.JPG">http://www.lassetobiasen.dk/images/DSC03933%20-%20shield%20on%20uno.JPG</a>)</p>
<p>You mentioned that I could try and switch the tip and ring wires (white and red), i have done this - result can be seen on this picture:</p>
<p><a href="http://www.lassetobiasen.dk/images/2014_10_16_plug_wire_change.JPG " title="http://www.lassetobiasen.dk/images/2014_10_16_plug_wire_change.JPG ">http://www.lassetobiasen.dk/images/2014_10_16_plug_wire_change.JPG </a></p>
<p>However, my power readings when connecting to the uno+emonTX sheild do not seem right... I definitely get a reading (checked all 4 connectors, all give the same type of readings)... The approximate power consumption is about 200-300W (a playstation, a small TV and two lamps)... but the reading from the CT is only 0-20 Watts...</p>
<p>The CT is connected around only one lead (the phase line) not both, so I think that part is OK. I am also getting fine voltage readings: about 280V</p>
<p>Are the readings from the CT actually in tens of watts (so I multiply the reading by 10) ? That would give a roughly correct reading...</p>
<p>Or perhaps something else is wrong?</p>
<p>Thank you for your input, and your time - that&#39;s really great you&#39;re helping. I may also try to post this separately</p>
<p>Kind regards from Denmark<br />
Lasse</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Sketch used : Shield_CT1234_Voltage<br />
------------------------------------<br />
/*<br />
emonTx Shield 4 x CT + Voltage example</p>
<p>An example sketch for the emontx Arduino shield module for<br />
CT and AC voltage sample electricity monitoring. Enables real power and Vrms calculations.</p>
<p>Part of the openenergymonitor.org project<br />
Licence: GNU GPL V3</p>
<p>Authors: Glyn Hudson, Trystan Lea<br />
Builds upon JeeLabs RF12 library and Arduino</p>
<p>emonTx documentation: <a href="../modules/emontxshield/index.html" title="http://openenergymonitor.org/emon/modules/emontxshield/">http://openenergymonitor.org/emon/modules/emontxshield/</a><br />
emonTx firmware code explination: <a href="../modules/emontx/firmware.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware">http://openenergymonitor.org/emon/modules/emontx/firmware</a><br />
emonTx calibration instructions: <a href="../modules/emontx/firmware/calibration.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware/calibration">http://openenergymonitor.org/emon/modules/emontx/firmware/calibration</a></p>
<p>THIS SKETCH REQUIRES:</p>
<p>Libraries in the standard arduino libraries folder:<br />
- JeeLib <a href="https://github.com/jcw/jeelib" title="https://github.com/jcw/jeelib">https://github.com/jcw/jeelib</a><br />
- EmonLib <a href="https://github.com/openenergymonitor/EmonLib.git" title="https://github.com/openenergymonitor/EmonLib.git">https://github.com/openenergymonitor/EmonLib.git</a></p>
<p>Other files in project directory (should appear in the arduino tabs above)<br />
- emontx_lib.ino</p>
<p>*/</p>
<p>/*Recommended node ID allocation<br />
------------------------------------------------------------------------------------------------------------<br />
-ID- -Node Type-<br />
0 - Special allocation in JeeLib RFM12 driver - reserved for OOK use<br />
1-4 - Control nodes<br />
5-10 - Energy monitoring nodes<br />
11-14 --Un-assigned --<br />
15-16 - Base Station &amp; logging nodes<br />
17-30 - Environmental sensing nodes (temperature humidity etc.)<br />
31 - Special allocation in JeeLib RFM12 driver - Node31 can communicate with nodes on any network group<br />
-------------------------------------------------------------------------------------------------------------<br />
*/</p>
<p>#define FILTERSETTLETIME 5000 // Time (ms) to allow the filters to settle before sending data</p>
<p>const int CT1 = 1;<br />
const int CT2 = 1; // Set to 0 to disable<br />
const int CT3 = 1;<br />
const int CT4 = 1;</p>
<p>
#define RF_freq RF12_433MHZ // Frequency of RF12B module can be RF12_433MHZ, RF12_868MHZ or RF12_915MHZ. You should use the one matching the module you have.<br />
const int nodeID = 10; // emonTx RFM12B node ID<br />
const int networkGroup = 210; // emonTx RFM12B wireless network group - needs to be same as emonBase and emonGLCD</p>
<p>#define RF69_COMPAT 0 // set to 1 to use RFM69CW<br />
#include // make sure V12 (latest) is used if using RFM69CW<br />
#include &quot;EmonLib.h&quot;<br />
EnergyMonitor ct1,ct2,ct3, ct4; // Create instances for each CT channel</p>
<p>typedef struct { int power1, power2, power3, power4, Vrms;} PayloadTX; // create structure - a neat way of packaging data for RF comms<br />
PayloadTX emontx;</p>
<p>const int LEDpin = 9; // On-board emonTx LED</p>
<p>boolean settled = false;</p>
<p>void setup()<br />
{<br />
Serial.begin(9600);<br />
//while (!Serial) {<br />
; // wait for serial port to connect. Needed for Leonardo only</p>
<p>Serial.println(&quot;emonTX Shield CT123 Voltage example&quot;);<br />
Serial.println(&quot;OpenEnergyMonitor.org&quot;);<br />
Serial.print(&quot;Node: &quot;);<br />
Serial.print(nodeID);<br />
Serial.print(&quot; Freq: &quot;);<br />
if (RF_freq == RF12_433MHZ) Serial.print(&quot;433Mhz&quot;);<br />
if (RF_freq == RF12_868MHZ) Serial.print(&quot;868Mhz&quot;);<br />
if (RF_freq == RF12_915MHZ) Serial.print(&quot;915Mhz&quot;);<br />
Serial.print(&quot; Network: &quot;);<br />
Serial.println(networkGroup);<br />
// }</p>
<p>if (CT1) ct1.current(1, 60.606); // Setup emonTX CT channel (ADC input, calibration)<br />
if (CT2) ct2.current(2, 60.606); // Calibration factor = CT ratio / burden resistance<br />
if (CT3) ct3.current(3, 60.606); // emonTx Shield Calibration factor = (100A / 0.05A) / 33 Ohms<br />
if (CT4) ct4.current(4, 60.606);</p>
<p>if (CT1) ct1.voltage(0, 300.6, 1.7); // ct.voltageTX(ADC input, calibration, phase_shift) - make sure to select correct calibration for AC-AC adapter <a href="../modules/emontx/firmware/calibration.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware/calibration">http://openenergymonitor.org/emon/modules/emontx/firmware/calibration</a>. Default set for Ideal Power adapter<br />
if (CT2) ct2.voltage(0, 300.6, 1.7);<br />
if (CT3) ct3.voltage(0, 300.6, 1.7);<br />
if (CT4) ct4.voltage(0, 300.6, 1.7);</p>
<p>rf12_set_cs(5); //set RFM SS pin 5, according to option 2 <a href="http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield" title="http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield">http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield</a><br />
rf12_initialize(nodeID, RF_freq, networkGroup); // initialize RFM12B<br />
rf12_sleep(RF12_SLEEP);</p>
<p>pinMode(LEDpin, OUTPUT); // Setup indicator LED<br />
digitalWrite(LEDpin, HIGH);</p>
<p>
}</p>
<p>void loop()<br />
{<br />
if (CT1) {<br />
ct1.calcVI(20,2000); // Calculate all. No.of crossings, time-out<br />
emontx.power1 = ct1.realPower;<br />
Serial.print(emontx.power1);<br />
}</p>
<p>emontx.Vrms = ct1.Vrms*100; // AC Mains rms voltage</p>
<p>if (CT2) {<br />
ct2.calcVI(20,2000); // Calculate all. No.of crossings, time-out<br />
emontx.power2 = ct2.realPower;<br />
Serial.print(&quot; &quot;); Serial.print(emontx.power2);<br />
}</p>
<p>if (CT3) {<br />
ct3.calcVI(20,2000); // Calculate all. No.of crossings, time-out<br />
emontx.power3 = ct3.realPower;<br />
Serial.print(&quot; &quot;); Serial.print(emontx.power3);<br />
}</p>
<p>if (CT4) {<br />
ct4.calcVI(20,2000); // Calculate all. No.of crossings, time-out<br />
emontx.power4 = ct4.realPower;<br />
Serial.print(&quot; &quot;); Serial.print(emontx.power4);<br />
}</p>
<p>Serial.print(&quot; &quot;); Serial.print(ct1.Vrms);</p>
<p>Serial.println(); delay(100);</p>
<p>// because millis() returns to zero after 50 days !<br />
if (!settled &amp;&amp; millis() &gt; FILTERSETTLETIME) settled = true;</p>
<p>if (settled) // send data only after filters have settled<br />
{<br />
send_rf_data(); // *SEND RF DATA* - see emontx_lib<br />
digitalWrite(LEDpin, HIGH); delay(2); digitalWrite(LEDpin, LOW); // flash LED<br />
delay(2000); // delay between readings in ms<br />
}<br />
}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24651"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 19/10/2014 - 00:23.</div>
    <div class="content">
     <p>Yes, I'm still here (at 00:49 local time!).<br />
Looking at the PCB layout and circuit diagram on Solderpad, it looked to me as if the jack socket was symmetrical, the sleeve connection in the middle (the axis of symmetry), the tip and ring connections on the outside and the 'break' connections for those on the inside. Therefore, if the socket is in the wrong side of the PCB, you should be able to swap tip and ring inside the plug and have a connection. But you need to check with a multimeter. With a plug in, the sleeve should go to the ADC connector on the Arduino, and the ring (now) - to the +ve end of the capacitor. The CT resistance is about 100 Ohms in parallel with the burden resistor (33 Ohms). The 'break' contact is earthed with the plug out so that the sketch can detect the presence of a plug, although it doesn't actually do that.</p>
<p>Your sketch looks OK, the numbers look correct. The output values are Watts, not tens. So maybe there is something else that you need to find. Your post and your picture tell me what is wrong: you have mis-identified the connections in the plug. You still have the CT connected to tip and sleeve! Look here <a href="https://learn.openenergymonitor.org/?redirect=DS18B20-temperature-sensing" title="http://openenergymonitor.org/emon/buildingblocks/DS18B20-temperature-sensing">http://openenergymonitor.org/emon/buildingblocks/DS18B20-temperature-sen...</a> for a picture with the connections labelled. The red and white wires need to connect to ring and sleeve - move the red wire onto the unused tag. When you do that, (if I'm right) it should come good.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24683"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Mon, 20/10/2014 - 21:14.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>OK - thanks for getting me up to speed on the jack socket (I feel like a school kid again ;-)&nbsp;), I re-did the soldering and moved the the red wire... now I&#39;m getting pretty good watt readings off the CT... They are not great (off by 20-40%) but I think this will get better once update the calibration figures... A 41W LED was reading about 60W and a 11W bulb was reading about 18W... So error seems to be proportional to the reading... My voltage reading was 280V, this should be more like 240V, that would also mislead the W measurement I guess...</p>
<p>Anyway, Robert, a new problem has turned up!&nbsp; I also attached a DS18B20 sensor to move ahead with temperature measurement (I did a fair bit of monitoring of radiator water temperatures in my old house, so know the&nbsp;DS18B20&nbsp;relatively well).</p>
<p>However, the sketch can&#39;t seem to find my sensor....&nbsp;</p>
<p>Do you have any ideas what I am doing wrong? I have run the sketch with no other plugs in the sheild (see picture) just to make sure there were no interferences...</p>
<p>Perhaps I should check the soldering on PIN4, and check the voltage on the&nbsp;DS18B20&nbsp;VDD ?</p>
<p>Many regards,</p>
<p>Lasse</p>
<p>&nbsp;</p>
<p><u><strong>Serial output:</strong></u></p>
<p>emonTX Shield CT123 Voltage example<br />
OpenEnergyMonitor.org<br />
Node: 10 Freq: 433Mhz Network: 210<br />
Locating devices...Found 0 devices.<br />
Parasite power is: OFF<span class="rangySelectionBoundary" id="selectionBoundary_1413838839282_7059052067343146" style="display:none; line-height:0">﻿</span></p>
<p>(and so on...)</p>
<p><u><strong>Sketch - now with added temperature measurement:</strong></u></p>
<p>#define FILTERSETTLETIME 5000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // &nbsp;Time (ms) to allow the filters to settle before sending data</p>
<p>const int CT1 = 1;&nbsp;<br />
const int CT2 = 1; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Set to 0 to disable&nbsp;<br />
const int CT3 = 1;<br />
const int CT4 = 1;</p>
<p>
#define RF_freq RF12_433MHZ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Frequency of RF12B module can be RF12_433MHZ, RF12_868MHZ or RF12_915MHZ. You should use the one matching the module you have.<br />
const int nodeID = 10; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// emonTx RFM12B node ID<br />
const int networkGroup = 210; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // emonTx RFM12B wireless network group - needs to be same as emonBase and emonGLCD &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p>
<p>#define RF69_COMPAT 0 // set to 1 to use RFM69CW&nbsp;<br />
#include &lt;JeeLib.h&gt; &nbsp; // make sure V12 (latest) is used if using RFM69CW<br />
#include &quot;EmonLib.h&quot;<br />
EnergyMonitor ct1,ct2,ct3, ct4; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Create &nbsp;instances for each CT channel</p>
<p>//------- temperature stuff --------------<br />
#include &lt;OneWire.h&gt;<br />
#include &lt;DallasTemperature.h&gt;<br />
#define ONE_WIRE_BUS 4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Data wire&nbsp;<br />
OneWire oneWire(ONE_WIRE_BUS); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Setup a oneWire instance to communicate with any OneWire devices (not just Maxim/Dallas temperature ICs)<br />
DallasTemperature sensors(&amp;oneWire); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Pass our oneWire reference to Dallas Temperature.<br />
DeviceAddress address_T1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //The DS address is not needed, on startup it will detect the first sensor<br />
int numberOfDevices=0;<br />
//-----------------------------------------</p>
<p>typedef struct { int power1, power2, power3, power4, Vrms, T1;} PayloadTX; &nbsp; &nbsp; &nbsp;// create structure - a neat way of packaging data for RF comms<br />
PayloadTX emontx; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p>
<p>const int LEDpin = 9; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // On-board emonTx LED&nbsp;</p>
<p>boolean settled = false;</p>
<p>void setup()&nbsp;<br />
{<br />
&nbsp; Serial.begin(9600);<br />
&nbsp; &nbsp;//while (!Serial) {<br />
&nbsp; &nbsp; ; // wait for serial port to connect. Needed for Leonardo only<br />
&nbsp;&nbsp;<br />
&nbsp; Serial.println(&quot;emonTX Shield CT123 Voltage example&quot;);&nbsp;<br />
&nbsp; Serial.println(&quot;OpenEnergyMonitor.org&quot;);<br />
&nbsp; Serial.print(&quot;Node: &quot;);&nbsp;<br />
&nbsp; Serial.print(nodeID);&nbsp;<br />
&nbsp; Serial.print(&quot; Freq: &quot;);&nbsp;<br />
&nbsp; if (RF_freq == RF12_433MHZ) Serial.print(&quot;433Mhz&quot;);<br />
&nbsp; if (RF_freq == RF12_868MHZ) Serial.print(&quot;868Mhz&quot;);<br />
&nbsp; if (RF_freq == RF12_915MHZ) Serial.print(&quot;915Mhz&quot;);&nbsp;<br />
&nbsp;Serial.print(&quot; Network: &quot;);&nbsp;<br />
&nbsp; Serial.println(networkGroup);<br />
&nbsp; // }<br />
&nbsp; &nbsp;<br />
&nbsp; if (CT1) ct1.current(1, 60.606); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Setup emonTX CT channel (ADC input, calibration)<br />
&nbsp; if (CT2) ct2.current(2, 60.606); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; // Calibration factor = CT ratio / burden resistance<br />
&nbsp; if (CT3) ct3.current(3, 60.606); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;// emonTx Shield Calibration factor = (100A / 0.05A) / 33 Ohms<br />
&nbsp; if (CT4) ct4.current(4, 60.606);&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp; if (CT1) ct1.voltage(0, 300.6, 1.7); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// ct.voltageTX(ADC input, calibration, phase_shift) - make sure to select correct calibration for AC-AC adapter &nbsp;http://openenergymonitor.org/emon/modules/emontx/firmware/calibration. Default set for Ideal Power adapter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />
&nbsp; if (CT2) ct2.voltage(0, 300.6, 1.7); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />
&nbsp; if (CT3) ct3.voltage(0, 300.6, 1.7);<br />
&nbsp; if (CT4) ct4.voltage(0, 300.6, 1.7);<br />
&nbsp;<br />
&nbsp; rf12_set_cs(5); //set RFM SS pin 5, according to option 2 <a href="http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield%c2%a0" title="http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield ">http://wiki.openenergymonitor.org/index.php?title=EmonTx_Arduino_Shield </a><br />
&nbsp; rf12_initialize(nodeID, RF_freq, networkGroup); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// initialize RFM12B<br />
&nbsp; rf12_sleep(RF12_SLEEP);</p>
<p>&nbsp; pinMode(LEDpin, OUTPUT); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Setup indicator LED<br />
&nbsp; digitalWrite(LEDpin, HIGH);<br />
&nbsp;&nbsp;<br />
&nbsp; //setup temperature<br />
&nbsp; sensors.begin();&nbsp;&nbsp; &nbsp; &nbsp;//temperature init<br />
&nbsp; delay(200);<br />
&nbsp;&nbsp;<br />
&nbsp; //obtain #1 sensor<br />
&nbsp; numberOfDevices = sensors.getDeviceCount();<br />
&nbsp; if (numberOfDevices != 0){<br />
&nbsp;&nbsp; &nbsp;sensors.getAddress(address_T1, 0); &nbsp; &nbsp;//get the address of the first detected sensor<br />
&nbsp; }</p>
<p>&nbsp; // locate devices on the bus<br />
&nbsp; Serial.print(&quot;Locating devices...&quot;);<br />
&nbsp; Serial.print(&quot;Found &quot;);<br />
&nbsp; Serial.print(numberOfDevices, DEC);<br />
&nbsp; Serial.println(&quot; devices.&quot;);<br />
&nbsp; // report parasite power requirements</p>
<p>&nbsp; Serial.print(&quot;Parasite power is: &quot;);&nbsp;<br />
&nbsp; if (sensors.isParasitePowerMode()) Serial.println(&quot;ON&quot;);<br />
&nbsp; else Serial.println(&quot;OFF&quot;);&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp;&nbsp;<br />
}</p>
<p>void loop()&nbsp;<br />
{&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp; if (CT1) {<br />
&nbsp; &nbsp; ct1.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Calculate all. No.of crossings, time-out&nbsp;<br />
&nbsp; &nbsp; emontx.power1 = ct1.realPower;<br />
&nbsp; &nbsp; Serial.print(emontx.power1); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br />
&nbsp; }<br />
&nbsp;&nbsp;<br />
&nbsp; emontx.Vrms = ct1.Vrms*100; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// AC Mains rms voltage&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp; if (CT2) {<br />
&nbsp; &nbsp; ct2.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Calculate all. No.of crossings, time-out&nbsp;<br />
&nbsp; &nbsp; emontx.power2 = ct2.realPower;<br />
&nbsp; &nbsp; Serial.print(&quot; &quot;); Serial.print(emontx.power2);<br />
&nbsp; }&nbsp;</p>
<p>&nbsp; if (CT3) {<br />
&nbsp; &nbsp; ct3.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Calculate all. No.of crossings, time-out&nbsp;<br />
&nbsp; &nbsp; emontx.power3 = ct3.realPower;<br />
&nbsp; &nbsp; Serial.print(&quot; &quot;); Serial.print(emontx.power3);<br />
&nbsp; }&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp; &nbsp;if (CT4) {<br />
&nbsp; &nbsp; &nbsp;ct4.calcVI(20,2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Calculate all. No.of crossings, time-out&nbsp;<br />
&nbsp; &nbsp; emontx.power4 = ct4.realPower;<br />
&nbsp; &nbsp; Serial.print(&quot; &quot;); Serial.print(emontx.power4);<br />
&nbsp; }&nbsp;<br />
&nbsp;&nbsp;<br />
&nbsp; Serial.print(&quot; &quot;); Serial.print(ct1.Vrms);<br />
&nbsp;&nbsp;<br />
&nbsp; if (numberOfDevices != 0){<br />
&nbsp;&nbsp; &nbsp; &nbsp;emontx.T1 = (sensors.getTempC(address_T1) * 100);&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;// Temperature on Celcius multiplied by 100<br />
&nbsp;&nbsp; &nbsp; &nbsp;Serial.print(&quot; &quot;); Serial.print(emontx.T1);<br />
&nbsp; } else {<br />
&nbsp; &nbsp; emontx.T1 = -99.0 * 100;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;// Temperature -99 on error<br />
&nbsp; }<br />
&nbsp; Serial.print(&quot; &quot;); Serial.print(emontx.T1);</p>
<p>&nbsp; Serial.println(); delay(100);</p>
<p>&nbsp; // because millis() returns to zero after 50 days !&nbsp;<br />
&nbsp; if (!settled &amp;&amp; millis() &gt; FILTERSETTLETIME) settled = true;</p>
<p>&nbsp; if (settled) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// send data only after filters have settled<br />
&nbsp; {&nbsp;<br />
&nbsp; &nbsp; send_rf_data(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // *SEND RF DATA* - see emontx_lib<br />
&nbsp; &nbsp; digitalWrite(LEDpin, HIGH); delay(2); digitalWrite(LEDpin, LOW); &nbsp; &nbsp; &nbsp;// flash LED<br />
&nbsp; &nbsp; delay(2000); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// delay between readings in ms<br />
&nbsp; }<br />
}</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24686"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 20/10/2014 - 22:12.</div>
    <div class="content">
     <p>The easy one first: you do need to adjust the voltage calibration. It should not be that far out if you are using the recommended ac adapter, but if you are using something else, then calibration is necessary.</p>
<p>Second, the current input is good to 100 A, that's 24 kW, so you must not expect accurate values below about 1% (1 A, 240 W). There's a page in Building Blocks about what happens at very low currents.</p>
<p>I don't have an Arduino or a shield, so you have to follow basic principles. Are the actual legs on the DS18B20 getting +5 V &amp; GND? If you have an oscilloscope, can you see anything on the bus? (Even a multimeter might show if something is happening.) Is DIO 4 used for anything else on your Arduino?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-24789"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7048.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7048.jpg" alt="lassetobiasen&#039;s picture" title="lassetobiasen&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: emontx shield V2 with RFM12b on Arduino UNO R2 can't get signals to raspberry pi</h3>

    <div class="submitted">Submitted by <a href="../user/7048.html" title="View user profile.">lassetobiasen</a> on Sat, 25/10/2014 - 20:52.</div>
    <div class="content">
     <p>The issue with the DS18B20 has been solved, I had apparently forgotten the &quot;sensors.requestTemperatures();&quot; command in my sketch.... (sorry, stupid mistake! Perhaps it would be help if there was a CT1234_Voltage_temp sketch also for the emonTX shield?&nbsp;https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxShield).&nbsp;</p>
<p>To test the hardware setup I detached the shield from the uno in a simple setup as shown on the picture below - this made it possible to reuse some old temperature sketches I had, and at the end of the day solve the problem.</p>
<p>Thanks for your input.</p>
<p>Kind regards</p>
<p>Lasse</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5928"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-tXf9OCUELEFFqSdFkQzv1vSsIPugETsl8Ttarahm-JE" value="form-tXf9OCUELEFFqSdFkQzv1vSsIPugETsl8Ttarahm-JE"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
