<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/916 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:35:04 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>RESOLVED - Emon Base - problems uploading to the server | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">RESOLVED - Emon Base - problems uploading to the server</h3>
        <span class="submitted">Submitted by Guest on Sun, 05/08/2012 - 12:12</span>
        <div class="content"><p>Ladies &amp; Gents,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; I have now assembled my EmonBase, EmonGLCD and EmonTx &amp; all appear to be passing data between each other happily. Unfortunately, I can&#39;t get any data up to the web. The ethernet lights are on, the EmonBase picks up a DHCP&nbsp;address &amp; resolves &amp; displays the server IP address. Unfortunately, no data arrives at the web server.</p>
<p>Thinking my slightly tempermental O2 wireless router may be to blame, I followed the excellent instructions &amp; set up an XAMPP emoncms server inside my home network - alas with the same result. To either server, clicking on the API links with a web broser sends test data quite happily. Unfortunately, the EmonBase data does not seem to arrive at either and does not receive a response from the server. Below (forgive the long windedness) is the code currently running - I have messed around with it a lot, but now gone back to standard for a sanity check.</p>
<p>Owing to a build error (my fault, I put the radio module on upside down the first time) I have a &#39;spare&#39; EmonBase, so I have tried swapping the ethernet ICs. No effect, the problem is exactly the same.</p>
<p>The system is set up as type2 and the metered values are credible.</p>
<p>Running this code, please find below a sample from the serial port monitoring.</p>
<p>Any ideas what is wrong?</p>
<p>Thanks in advance</p>
<p>Matt</p>
<p>P.S. GLCD&nbsp;works fine, with both units receiving data from the EmonTx. On the one or two fleeting occasions the EmonBase has posted something to the web &amp; received a response, the time on the EmonGLCD has updated properly - however that has only ever worked once or twice, usually straight after a reset.</p>
<p>&nbsp;</p>
<p>/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | |&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; ___ _ __ ___&nbsp;&nbsp; ___&nbsp; _ __ | |__&nbsp;&nbsp; __ _ ___&nbsp; ___&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _ __&nbsp;&nbsp; __ _ _ __&nbsp;&nbsp; ___&nbsp;&nbsp; __| | ___<br />
	&nbsp;/ _ \ &#39;_ ` _ \ / _ \| &#39;_ \| &#39;_ \ / _` / __|/ _ \&nbsp;&nbsp;&nbsp;&nbsp; | &#39;_ \ / _` | &#39;_ \ / _ \ / _` |/ _ \<br />
	|&nbsp; __/ | | | | | (_) | | | | |_) | (_| \__ \&nbsp; __/&nbsp; _&nbsp; | | | | (_| | | | | (_) | (_| |&nbsp; __/<br />
	&nbsp;\___|_| |_| |_|\___/|_| |_|_.__/ \__,_|___/\___| (_) |_| |_|\__,_|_| |_|\___/ \__,_|\___|<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	*/<br />
	//--------------------------------------------------------------------------------------<br />
	// Relay&#39;s data recieved by emontx up to emoncms<br />
	// Relay&#39;s data recieved by emonglcd up to emoncms<br />
	// Decodes reply from server to set software real time clock<br />
	// Relay&#39;s time data to emonglcd - and any other listening nodes.<br />
	// Looks for &#39;ok&#39; reply from http request to verify data reached emoncms</p>
<p>	// emonBase Documentation: <a href="../emonbase.html" title="http://openenergymonitor.org/emon/emonbase">http://openenergymonitor.org/emon/emonbase</a></p>
<p>	// Authors: Trystan Lea and Glyn Hudson<br />
	// Part of the: openenergymonitor.org project<br />
	// Licenced under GNU GPL V3<br />
	//http://openenergymonitor.org/emon/license</p>
<p>	// EtherCard Library by Jean-Claude Wippler and Andrew Lindsay<br />
	// JeeLib Library by Jean-Claude Wippler<br />
	//<br />
	// THIS SKETCH REQUIRES:<br />
	//<br />
	// Libraries in the standard arduino libraries folder:<br />
	//&nbsp;&nbsp;&nbsp; - JeeLib&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <a href="https://github.com/jcw/jeelib" title="https://github.com/jcw/jeelib">https://github.com/jcw/jeelib</a><br />
	//&nbsp;&nbsp;&nbsp; - EtherCard&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <a href="https://github.com/jcw/ethercard/" title="https://github.com/jcw/ethercard/">https://github.com/jcw/ethercard/</a><br />
	//<br />
	// Other files in project directory (should appear in the arduino tabs above)<br />
	//&nbsp;&nbsp;&nbsp; - decode_reply.ino<br />
	//&nbsp;&nbsp;&nbsp; - dhcp_dns.ino<br />
	//--------------------------------------------------------------------------------------</p>
<p>	#define DEBUG&nbsp;&nbsp;&nbsp;&nbsp; //comment out to disable serial printing to increase long term stability<br />
	#define UNO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //anti crash wachdog reset only works with Uno (optiboot) bootloader, comment out the line if using delianuova</p>
<p>	#include &lt;JeeLib.h&gt;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp; //https://github.com/jcw/jeelib<br />
	#include &lt;avr/wdt.h&gt;</p>
<p>	#define MYNODE 15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	#define freq RF12_868MHZ&nbsp;&nbsp;&nbsp;&nbsp; // frequency<br />
	#define group 210&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // network group</p>
<p>	//---------------------------------------------------<br />
	// Data structures for transfering data between units<br />
	//---------------------------------------------------</p>
<p>	typedef struct { int power1, power2, power3, voltage; } PayloadTX;<br />
	PayloadTX emontx;</p>
<p>	typedef struct { int temperature; } PayloadGLCD;<br />
	PayloadGLCD emonglcd;</p>
<p>	typedef struct { int hour, mins;} PayloadBase;<br />
	PayloadBase emonbase;<br />
	//---------------------------------------------------</p>
<p>	//---------------------------------------------------------------------<br />
	// The PacketBuffer class is used to generate the json string that is send via ethernet - JeeLabs<br />
	//---------------------------------------------------------------------<br />
	class PacketBuffer : public Print {<br />
	public:<br />
	&nbsp;&nbsp;&nbsp; PacketBuffer () : fill (0) {}<br />
	&nbsp;&nbsp;&nbsp; const char* buffer() { return buf; }<br />
	&nbsp;&nbsp;&nbsp; byte length() { return fill; }<br />
	&nbsp;&nbsp;&nbsp; void reset()<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; memset(buf,NULL,sizeof(buf));<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fill = 0;<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; virtual size_t write (uint8_t ch)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { if (fill &lt; sizeof buf) buf[fill++] = ch; }<br />
	&nbsp;&nbsp;&nbsp; byte fill;<br />
	&nbsp;&nbsp;&nbsp; char buf[150];<br />
	&nbsp;&nbsp;&nbsp; private:<br />
	};<br />
	PacketBuffer str;</p>
<p>	//--------------------------------------------------------------------------<br />
	// Ethernet<br />
	//--------------------------------------------------------------------------<br />
	#include &lt;EtherCard.h&gt;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; //https://github.com/jcw/ethercard</p>
<p>	// ethernet interface mac address, must be unique on the LAN<br />
	static byte mymac[] = { 0x42,0x31,0x42,0x21,0x30,0x31 };</p>
<p>	//IP address of remote sever, only needed when posting to a server that has not got a dns domain name (staticIP e.g local server)<br />
	byte Ethernet::buffer[700];<br />
	static uint32_t timer;</p>
<p>	//Domain name of remote webserver - leave blank if posting to IP address<br />
	char website[] PROGMEM = &quot;vis.openenergymonitor.org&quot;;<br />
	//static byte hisip[] = { 213,138,101,177 };&nbsp;&nbsp;&nbsp; // un-comment for posting to static IP server (no domain name)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>	const int redLED = 6;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // NanodeRF RED indicator LED<br />
	const int greenLED = 5;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // NanodeRF GREEN indicator LED</p>
<p>	int ethernet_error = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Etherent (controller/DHCP) error flag<br />
	int rf_error = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // RF error flag - high when no data received<br />
	int ethernet_requests = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // count ethernet requests without reply&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>	int dhcp_status = 0;<br />
	int dns_status = 0;<br />
	int emonglcd_rx = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Used to indicate that emonglcd data is available<br />
	int data_ready=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Used to signal that emontx data is ready to be sent<br />
	unsigned long last_rf;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Used to check for regular emontx data - otherwise error</p>
<p>	char line_buf[50];&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Used to store line of http reply header</p>
<p>	//**********************************************************************************************************************<br />
	// SETUP<br />
	//**********************************************************************************************************************<br />
	void setup () {<br />
	&nbsp;<br />
	&nbsp; //Nanode RF LED indictor&nbsp; setup - green flashing means good - red on for a long time means bad!<br />
	&nbsp; //High means off since NanodeRF tri-state buffer inverts signal<br />
	&nbsp; pinMode(redLED, OUTPUT); digitalWrite(redLED,LOW);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; pinMode(greenLED, OUTPUT); digitalWrite(greenLED,LOW);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; delay(100); digitalWrite(redLED,HIGH);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // turn off redLED<br />
	&nbsp;<br />
	&nbsp; Serial.begin(9600);<br />
	&nbsp; Serial.println(&quot;\n[webClient]&quot;);</p>
<p>	&nbsp; if (ether.begin(sizeof Ethernet::buffer, mymac) == 0) {<br />
	&nbsp;&nbsp;&nbsp; Serial.println( &quot;Failed to access Ethernet controller&quot;);<br />
	&nbsp;&nbsp;&nbsp; ethernet_error = 1;&nbsp;<br />
	&nbsp; }</p>
<p>	&nbsp; dhcp_status = 0;<br />
	&nbsp; dns_status = 0;<br />
	&nbsp; ethernet_requests = 0;<br />
	&nbsp; ethernet_error=0;<br />
	&nbsp; rf_error=0;<br />
	&nbsp;<br />
	&nbsp; rf12_initialize(MYNODE, freq,group);<br />
	&nbsp; last_rf = millis()-40000;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // setting lastRF back 40s is useful as it forces the ethernet code to run straight away<br />
	&nbsp;&nbsp;<br />
	&nbsp; digitalWrite(greenLED,HIGH);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Green LED off - indicate that setup has finished<br />
	&nbsp;<br />
	&nbsp; #ifdef UNO<br />
	&nbsp; wdt_enable(WDTO_8S);<br />
	&nbsp; #endif;<br />
	}</p>
<p>	//**********************************************************************************************************************<br />
	// LOOP<br />
	//**********************************************************************************************************************<br />
	void loop () {<br />
	&nbsp;<br />
	&nbsp; #ifdef UNO<br />
	&nbsp; wdt_reset();<br />
	&nbsp; #endif</p>
<p>	&nbsp; dhcp_dns();&nbsp;&nbsp; // handle dhcp and dns setup - see dhcp_dns tab<br />
	&nbsp;<br />
	&nbsp; // Display error states on status LED<br />
	&nbsp; if (ethernet_error==1 || rf_error==1 || ethernet_requests &gt; 0) digitalWrite(redLED,LOW);<br />
	&nbsp;&nbsp;&nbsp; else digitalWrite(redLED,HIGH);</p>
<p>	&nbsp; //-----------------------------------------------------------------------------------------------------------------<br />
	&nbsp; // 1) On RF recieve<br />
	&nbsp; //-----------------------------------------------------------------------------------------------------------------<br />
	&nbsp; if (rf12_recvDone()){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (rf12_crc == 0 &amp;&amp; (rf12_hdr &amp; RF12_HDR_CTL) == 0)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int node_id = (rf12_hdr &amp; 0x1F);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (node_id == 10)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // EMONTX<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; emontx = *(PayloadTX*) rf12_data;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // get emontx data<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // print emontx data to serial<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;emonTx data rx&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; last_rf = millis();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // reset lastRF timer<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay(50);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // make sure serial printing finished<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // JSON creation: JSON sent are of the format: {key1:value1,key2:value2} and so on<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.reset();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Reset json string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(&quot;{rf_fail:0&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // RF recieved so no failure<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(&quot;,power1:&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(emontx.power1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Add power reading<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(&quot;,voltage:&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(emontx.voltage);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Add emontx battery voltage reading<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_ready = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // data is ready<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rf_error = 0;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (node_id == 20)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // EMONGLCD<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; emonglcd = *(PayloadGLCD*) rf12_data;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // get emonglcd data<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;emonGLCD temp recv: &quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // print output<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(emonglcd.temperature);&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; emonglcd_rx = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; }</p>
<p>	&nbsp; //-----------------------------------------------------------------------------------------------------------------<br />
	&nbsp; // 2) If no data is recieved from rf12 module the server is updated every 30s with RFfail = 1 indicator for debugging<br />
	&nbsp; //-----------------------------------------------------------------------------------------------------------------<br />
	&nbsp; if ((millis()-last_rf)&gt;30000)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; last_rf = millis();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // reset lastRF timer<br />
	&nbsp;&nbsp;&nbsp; str.reset();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // reset json string<br />
	&nbsp;&nbsp;&nbsp; str.print(&quot;{rf_fail:1&quot;);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // No RF received in 30 seconds so send failure<br />
	&nbsp;&nbsp;&nbsp; data_ready = 1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Ok, data is ready<br />
	&nbsp;&nbsp;&nbsp; rf_error=1;<br />
	&nbsp; }</p>
<p>
	&nbsp; //-----------------------------------------------------------------------------------------------------------------<br />
	&nbsp; // 3) Send data via ethernet<br />
	&nbsp; //-----------------------------------------------------------------------------------------------------------------<br />
	&nbsp; ether.packetLoop(ether.packetReceive());<br />
	&nbsp;<br />
	&nbsp; if (data_ready) {<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; // include temperature data from emonglcd if it has been recieved<br />
	&nbsp;&nbsp;&nbsp; if (emonglcd_rx) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(&quot;,temperature:&quot;);&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; str.print(emonglcd.temperature/100.0);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; emonglcd_rx = 0;<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; str.print(&quot;}\0&quot;);&nbsp; //&nbsp; End of json string<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;2 &quot;); Serial.println(str.buf); // print to serial json string</p>
<p>	&nbsp;&nbsp;&nbsp; // Example of posting to emoncms v3 demo account goto <a href="http://vis.openenergymonitor.org/emoncms3" title="http://vis.openenergymonitor.org/emoncms3">http://vis.openenergymonitor.org/emoncms3</a><br />
	&nbsp;&nbsp;&nbsp; // and login with sandbox:sandbox<br />
	&nbsp;&nbsp;&nbsp; // To point to your account just enter your WRITE APIKEY<br />
	&nbsp;&nbsp;&nbsp; ethernet_requests ++;<br />
	&nbsp;&nbsp;&nbsp; ether.browseUrl(PSTR(&quot;/emoncms3/api/post.json?apikey=0888d6e4b3dcd51b45a1941f1c8b40aa&amp;json=&quot;),str.buf, website, my_callback);<br />
	&nbsp;&nbsp;&nbsp; data_ready =0;<br />
	&nbsp; }<br />
	&nbsp;<br />
	&nbsp; if (ethernet_requests &gt; 10) delay(10000); // Reset the nanode if more than 10 request attempts have been tried without a reply</p>
<p>	}<br />
	//**********************************************************************************************************************</p>
<p>	//-----------------------------------------------------------------------------------<br />
	// Ethernet callback<br />
	// recieve reply and decode<br />
	//-----------------------------------------------------------------------------------<br />
	static void my_callback (byte status, word off, word len) {<br />
	&nbsp;<br />
	&nbsp; get_header_line(2,off);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Get the date and time from the header<br />
	&nbsp; Serial.print(&quot;ok recv from server | &quot;);&nbsp;&nbsp;&nbsp; // Print out the date and time<br />
	&nbsp; Serial.println(line_buf);&nbsp;&nbsp;&nbsp; // Print out the date and time<br />
	&nbsp;<br />
	&nbsp; // Decode date time string to get integers for hour, min, sec, day<br />
	&nbsp; // We just search for the characters and hope they are in the right place<br />
	&nbsp; char val[1];<br />
	&nbsp; val[0] = line_buf[23]; val[1] = line_buf[24];<br />
	&nbsp; int hour = atoi(val);<br />
	&nbsp; val[0] = line_buf[26]; val[1] = line_buf[27];<br />
	&nbsp; int mins = atoi(val);<br />
	&nbsp; val[0] = line_buf[29]; val[1] = line_buf[30];<br />
	&nbsp; int sec = atoi(val);<br />
	&nbsp; val[0] = line_buf[11]; val[1] = line_buf[12];<br />
	&nbsp; int day = atoi(val);<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp; if (hour&gt;0 || mins&gt;0 || sec&gt;0) {&nbsp; //don&#39;t send all zeros, happens when server failes to returns reponce to avoide GLCD getting mistakenly set to midnight<br />
	&nbsp;&nbsp;&nbsp; emonbase.hour = hour;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //add current date and time to payload ready to be sent to emonGLCD<br />
	&nbsp; &nbsp;&nbsp;&nbsp; emonbase.mins = mins;<br />
	&nbsp; }<br />
	&nbsp; //-----------------------------------------------------------------------------<br />
	&nbsp;<br />
	&nbsp; delay(100);<br />
	&nbsp;<br />
	&nbsp; // Send time data<br />
	&nbsp; int i = 0; while (!rf12_canSend() &amp;&amp; i&lt;10) {rf12_recvDone(); i++;}&nbsp;&nbsp;&nbsp; // if can send - exit if it gets stuck, as it seems too<br />
	&nbsp; rf12_sendStart(0, &amp;emonbase, sizeof emonbase);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // send payload<br />
	&nbsp; rf12_sendWait(0);<br />
	&nbsp;<br />
	&nbsp; Serial.println(&quot;time sent to emonGLCD&quot;);<br />
	&nbsp;<br />
	&nbsp; get_reply_data(off);<br />
	&nbsp; if (strcmp(line_buf,&quot;ok&quot;)) {ethernet_requests = 0; ethernet_error = 0;}&nbsp; // check for ok reply from emoncms to verify data post request</p>
<p>&nbsp;</p>
<p>And the serial monitoring....</p>
<p>[webClient]<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.95<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	DNS status: 1<br />
	SRV: 213.138.101.177<br />
	2 {rf_fail:1}<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.95<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8</p>
<p>	emonTx data rx2 {rf_fail:0,power1:-3012,voltage:23672}<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.95<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.96<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	2 {rf_fail:1}<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.96<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.96<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	2 {rf_fail:1}<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.96<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8</p>
<p>	emonTx data rx2 {rf_fail:0,power1:-2923,voltage:23689}<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.96<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.96<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	2 {rf_fail:1}<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.97<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8</p>
<p>	emonTx data rx2 {rf_fail:0,power1:-2196,voltage:23671}<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.97<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.97<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8</p>
<p>	emonTx data rx2 {rf_fail:0,power1:-1445,voltage:23638}<br />
	DHCP status: 1<br />
	IP:&nbsp; 192.168.1.97<br />
	GW:&nbsp; 192.168.1.254<br />
	DNS: 8.8.8.8<br />
	&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="1049.html" class="topic-previous" title="Go to previous forum topic">‹ Seperate monitoring of two inverters in a solar PV array</a>
              <a href="1029.html" class="topic-next" title="Go to next forum topic">RESOLVED - emonGLCD Latest code ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-5528"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 05/08/2012 - 13:46.</div>
    <div class="content">
     <p>&nbsp;Good work getting the system up and running, I see your nearly there, emonTx data is being received successfully. I think I have spotted the probelem.</p>
<p>You have the emonBase setup to post to vis.openenergymonitor.org (our demo server). If you fancy you could test out posting data to here (you will need to create an account and put in the API key) to test before posting to your own server.</p>
<p>In order to post to your own server you will need to change the line&nbsp;</p>
<pre><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 17px; text-align: left; ">char website[] PROGMEM = &quot;vis.openenergymonitor.org&quot;;</span></pre><p>to be the domain name of you're server. If the server is on a local network and doesnt have a domain name you will need to comment out the above line, and un comment the line below, inserting the IP address of your emoncms server on your local network:&nbsp;</p>
<pre><span style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; line-height: 17px; text-align: left; ">//static byte hisip[] = { xxx,xxx,xxx,xxx };    // un-comment for posting to static IP server (no domain name)   </span></pre><p>you will also need to un-comment lines 33-24 in dhcp_dns.ino</p>
<pre>
//ether.copyIp(ether.hisip, hisip); // un-comment for posting to static IP server (no domain name)
//dns_status = 1; // un-comment for posting to static IP server (no domain name)</pre><p>Don't forget to put in the write only API key from emoncms. <br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5535"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Oracle617&#039;s picture" title="Oracle617&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by Oracle617 (not verified) on Sun, 05/08/2012 - 22:39.</div>
    <div class="content">
     <p>Hi Glyn, </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Thank you for your post. I have indeed created an account on your demo server - and started there! Alas it is not working... I went back to 'your code' for this post, to check it wasn't me 'making it worse' with all the messing around I had done. Alas neither server works reliably. If you have admin rights - I am 'Oracle617' on your demo server, so you should be able to see the very occasional posts of data? This is the 'odd one which gets through,' generally immediately after a '10 failures' reset? </p>
<p>I swapped the API key for the version I was running on my own server &amp; made the edits you described above - alas they didn't talk either. </p>
<p>Kind regards</p>
<p>Matt</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5540"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1039.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/1039.html" title="View user profile.">mattwire</a> on Mon, 06/08/2012 - 09:30.</div>
    <div class="content">
     <p>Hi Matt,</p>
<p>I'm also unable to post to my local server but have not had time to fully debug yet.&nbsp; I eventually got it working when posting to <a href="http://www.emoncms.org/" title="www.emoncms.org">www.emoncms.org</a> but it will not work when posting to my local server.&nbsp; I use DNS&nbsp;resolution for both and can see that this works correctly in both cases.</p>
<p>&nbsp;</p>
<p>At the moment I am wondering whether there could be a bug in the ethercard library or something but need to do some more tests to find out.&nbsp; I have done experiments talking to another web server on my lan and it does get the response (404 not found) which makes it even more mysterious as to why nothing is getting to the emoncms local server.&nbsp; Keep me posted with your progress - and see if you can get it to talk to <a href="http://www.emoncms.org/" title="www.emoncms.org">www.emoncms.org</a> first.</p>
<p>&nbsp;</p>
<p>Matthew</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5544"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 06/08/2012 - 11:06.</div>
    <div class="content">
     <p>Hmm, the serial output is really strange:</p>
<p><span class="Apple-style-span" style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13px; line-height: 17px; ">DHCP status: 1</span></p>
<p><span class="Apple-style-span" style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13px; line-height: 17px; ">IP:&nbsp; 192.168.1.95<br />
GW:&nbsp; 192.168.1.254<br />
DNS: 8.8.8.8<br />
DNS status: 1<br />
SRV: 213.138.101.177<br />
2 {rf_fail:1}</span></p>
<p><span class="Apple-style-span" style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13px; line-height: 17px; ">As it has now got an DHCP IP address and it has found the server you should not see the lines repeated again</span></p>
<p><span class="Apple-style-span" style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 13px; line-height: 17px; ">DHCP status: 1<br />
IP:&nbsp; 192.168.1.95<br />
GW:&nbsp; 192.168.1.254</span></p>
<p>I cant think why this would be the case, it looks like everything else is ok.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5547"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Javierete&#039;s picture" title="Javierete&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by Javierete (not verified) on Mon, 06/08/2012 - 15:12.</div>
    <div class="content">
     <p>&nbsp;I'm having this behaviour too.</p>
<p>Just for your information, 3 or 4 weeks ago had working perfectly and posting to my private server, but now I've updated the emonbase sketch and the server side and isn't working.</p>
<p>I though that was my own server fault so I've opened an account on emoncms.org and pointed the sketch with the correct write API key. But still no luck.</p>
<p>﻿Here's the output of serial monitor:</p>
<p>DNS status: 0<br />
2 {rf_fail:1}<br />
DNS status: 0</p>
<p>emonTx data rx2 {rf_fail:0,power1:71,voltage:3264}</p>
<p>[webClient]<br />
DHCP status: 1<br />
IP: &nbsp;192.168.1.19<br />
GW: &nbsp;192.168.1.1<br />
DNS: 8.8.8.8<br />
DNS status: 0<br />
2 {rf_fail:1}<br />
DNS status: 0</p>
<p>emonTx data rx2 {rf_fail:0,power1:72,voltage:3264}<br />
DNS status: 0<br />
2 {rf_fail:1}</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5764"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1039.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mattwire&#039;s picture" title="mattwire&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/1039.html" title="View user profile.">mattwire</a> on Thu, 16/08/2012 - 22:49.</div>
    <div class="content">
     <p>Did you get anywhere with this?&nbsp; I am still unable to post to the local server on my network (<a href="http://www.emoncms.org/" title="www.emoncms.org">www.emoncms.org</a> works fine). &nbsp;In fact the only local server it can communicate with is the gateway (which is also dhcp and dns) - it then receives tcp RST&nbsp;packets with source address of my emoncms server but actually originating from the gateway.</p>
<p>Using the web interface on the local server works fine for posting data.</p>
<p>I been doing packet captures on the network and can't see what's wrong, only that it clearly is wrong.&nbsp; All packets look identical with the obvious exception of source/destination IP&nbsp;addresses but the local ones are never reaching the destination :(</p>
<p>Anyone got any thoughts?</p>
<p>Matthew</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-5790"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Fri, 17/08/2012 - 16:41.</div>
    <div class="content">
     <p>Sorry about this, I think it was unclear documentation of the things that needed changing on on my part. I have just reordered both nanoderf sketches bringing all the config options to one place, I have tested it here on both my home server and on emoncms.org and it works fine.</p>
<p>There are now the following config lines at the top of the sketch:</p>
<pre><span style="color: #7E7E7E;">//&nbsp;ethernet&nbsp;interface&nbsp;mac&nbsp;address,&nbsp;must&nbsp;be&nbsp;unique&nbsp;on&nbsp;the&nbsp;LAN</span>
<span style="color: #CC6600;">static</span> <span style="color: #CC6600;">byte</span> mymac[] = { 0x42,0x31,0x42,0x21,0x30,0x31 };

<span style="color: #7E7E7E;">//&nbsp;1)&nbsp;Set&nbsp;this&nbsp;to&nbsp;the&nbsp;domain&nbsp;name&nbsp;of&nbsp;your&nbsp;hosted&nbsp;emoncms&nbsp;-&nbsp;leave&nbsp;blank&nbsp;if&nbsp;posting&nbsp;to&nbsp;IP&nbsp;address&nbsp;</span>
<span style="color: #CC6600;">char</span> website[] PROGMEM = <span style="color: #006699;">&quot;emoncms.org&quot;</span>;

<span style="color: #7E7E7E;">//&nbsp;or&nbsp;if&nbsp;your&nbsp;posting&nbsp;to&nbsp;a&nbsp;static&nbsp;IP&nbsp;server:</span>
<span style="color: #CC6600;">static</span> <span style="color: #CC6600;">byte</span> hisip[] = { 192,168,1,10 };

<span style="color: #7E7E7E;">//&nbsp;change&nbsp;to&nbsp;true&nbsp;if&nbsp;you&nbsp;would&nbsp;like&nbsp;the&nbsp;sketch&nbsp;to&nbsp;use&nbsp;hisip</span>
<span style="color: #CC6600;">boolean</span> use_hisip = <span style="color: #CC6600;">false</span>;  

<span style="color: #7E7E7E;">//&nbsp;2)&nbsp;If&nbsp;your&nbsp;emoncms&nbsp;install&nbsp;is&nbsp;in&nbsp;a&nbsp;subdirectory&nbsp;add&nbsp;details&nbsp;here&nbsp;i.e&nbsp;&quot;/emoncms3&quot;</span>
<span style="color: #CC6600;">char</span> basedir[] = <span style="color: #006699;">&quot;&quot;</span>;

<span style="color: #7E7E7E;">//&nbsp;3)&nbsp;Set&nbsp;to&nbsp;your&nbsp;account&nbsp;write&nbsp;apikey&nbsp;</span>
<span style="color: #CC6600;">char</span> apikey[] = <span style="color: #006699;">&quot;YOURAPIKEY&quot;</span>;<br type="_moz" /></pre><p>To set to a local server, set the ip address, the basedir, apikey and set:</p>
<p><span class="Apple-style-span" style="font-family: monospace; white-space: pre; "><span style="color: rgb(204, 102, 0); ">boolean</span> use_hisip = <span style="color: rgb(204, 102, 0); ">true</span>; </span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6173"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/349.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-349.jpg" alt="EnergyRnR&#039;s picture" title="EnergyRnR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/349.html" title="View user profile.">EnergyRnR</a> on Fri, 14/09/2012 - 10:48.</div>
    <div class="content">
     <p>&nbsp;</p>
<div>
	&nbsp;</div>
<div>
	I&#39;m seeing the same thing. just added a print statement to confirm ethernet_error&nbsp;is zero[that&#39;s the &#39;0&#39; in the serial output below.</div>
<div>
	&nbsp;Red LED stay on, in the emonbase and it just cycles through as below.</div>
<div>
	&nbsp;</div>
<div>
	Not getting the &quot;ok received&quot; from emoncms.org. I have this same code working in another site though....</div>
<div>
	Also, the node is incorrect; It should be node 25....</div>
<div>
	&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=480,766,1030,227</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=483,760,1022,227</div>
<div>
	0</div>
<div>
	&nbsp;</div>
<div>
	[webClient]</div>
<div>
	DHCP status: 1</div>
<div>
	IP: &nbsp;192.168.1.7</div>
<div>
	GW: &nbsp;192.168.1.254</div>
<div>
	DNS: 8.8.8.8</div>
<div>
	DNS status: 1</div>
<div>
	SRV: 213.138.101.177</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=488,736,1028,226</div>
<div>
	0</div>
<div>
	Time request sent</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=489,764,1048,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=490,755,1030,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=488,746,1041,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=486,758,1042,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=483,755,1037,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=484,734,1033,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=484,748,1033,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=485,754,1032,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=481,750,1021,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=483,755,1025,226</div>
<div>
	0</div>
<div>
	&nbsp;</div>
<div>
	[webClient]</div>
<div>
	DHCP status: 1</div>
<div>
	IP: &nbsp;192.168.1.7</div>
<div>
	GW: &nbsp;192.168.1.254</div>
<div>
	DNS: 8.8.8.8</div>
<div>
	DNS status: 1</div>
<div>
	SRV: 213.138.101.177</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=493,743,1033,225</div>
<div>
	0</div>
<div>
	Time request sent</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=501,751,1035,226</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=500,746,1036,227</div>
<div>
	0</div>
<div>
	Data sent: http://emoncms.org/api/post.json?apikey=&amp;node=18&amp;csv=502,757,1034,225</div>
<div>
	0</div>
<div>
	&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	Eamonn</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6175"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/349.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-349.jpg" alt="EnergyRnR&#039;s picture" title="EnergyRnR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/349.html" title="View user profile.">EnergyRnR</a> on Fri, 14/09/2012 - 10:52.</div>
    <div class="content">
     <p>I should mention that the only change I have made from the working version is that I&#39;ve dhcp_dns&nbsp;to include&nbsp;if (ether.dhcpExpired()) dhcp_status = 0;&nbsp;</p>
<p>Previously I was using (!ether.dhcpValid())&nbsp;</p>
<p>Eamonn</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6176"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/349.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-349.jpg" alt="EnergyRnR&#039;s picture" title="EnergyRnR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/349.html" title="View user profile.">EnergyRnR</a> on Fri, 14/09/2012 - 11:08.</div>
    <div class="content">
     <p>I have swopped laptops so I suspect the version of ethercard.h I was using in the other laptop was older...hence I needed to update dhcp_dns..... ok - I&#39;ll stop having a soliloquy on the forum :-)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6177"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/349.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-349.jpg" alt="EnergyRnR&#039;s picture" title="EnergyRnR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: RESOLVED - Emon Base - problems uploading to the server</h3>

    <div class="submitted">Submitted by <a href="../user/349.html" title="View user profile.">EnergyRnR</a> on Fri, 14/09/2012 - 11:43.</div>
    <div class="content">
     <p>Sorted: just downloaded latest ethercard lib . Eamonn (I&#39;m never moving laptops again!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/916"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-kgN00rwzTz58jeEXOFmaJNnd-zl6JT2ugNAXyvuU8xQ" value="form-kgN00rwzTz58jeEXOFmaJNnd-zl6JT2ugNAXyvuU8xQ"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
