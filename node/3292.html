<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3292 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:00:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch  | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>
        <span class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Fri, 06/12/2013 - 23:58</span>
        <div class="content"><p>Hi,</p>
<p>&nbsp;</p>
<p>I&#39;m very new to this (day 2). I have my emonTxV3&nbsp;sending data to my Raspberry Pi and then uploading to emonCms. But I have found some calibration issues.&nbsp;</p>
<p>My voltage is showing as an average of 256v, but when measured by an accurate meter it shows 241v. Obviously I need to calibrate, but all the instructions on the site seem to be for the previous emonTxV2, and how to update the standard sketch for that module.</p>
<p>The new sketch for the V3 is different and I can&#39;t see where I would plug in any calibration values. I&#39;m sure people have done this before, so could someone point me in the right direction.</p>
<p>I have to say what I&#39;ve seen so far of this project is amazing and I can&#39;t wait to get everything working smoothly.</p>
<p>Thanks for any help,</p>
<p>Allen</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3367.html" class="topic-previous" title="Go to previous forum topic">‹ Connecting EmonTx in Parallel with existing Export Meter Current Transformers</a>
              <a href="1704.html" class="topic-next" title="Go to next forum topic">Are my electricity and gas meters OEMable ? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-16596"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 07/12/2013 - 01:00.</div>
    <div class="content">
     <p>? ? ?&nbsp; If I&#39;m looking at the same emonTxV3_RFM12B_DiscreteSampling.ino as you are, all the settings are in the sketch starting at line 47.</p>
<p>From your numbers, I make Vcal = 268.27 (line 52).</p>
<p>All that&#39;s happened there is that instead of the constant being hard-coded into the call to emonLib, it&#39;s hard-coded as a constant higher up the sketch so that all the settings constants are grouped together.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16611"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Sat, 07/12/2013 - 22:20.</div>
    <div class="content">
     <p>I assume you calculated that from the formula on the calibration page:&nbsp;</p>
<p>New calibration = (correct reading / emonTx reading) * existing calibration</p>
<p>On that page it says you can either modify the Vcal value OR the Vrms value. Which is the better, or should I really adjust both?</p>
<p>I presume I should also calibrate the Ical and phase shift? How is the Ical&nbsp;calculated, as the calibration page seems to imply the default should be 111.1, but it is&nbsp;85.75996 in the sketch.</p>
<p>Thanks,</p>
<p>Allen</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16613"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 07/12/2013 - 23:32.</div>
    <div class="content">
     <p>I don&#39;t understand what you mean by &quot;you can either modify the Vcal value OR the Vrms value. Which is the better, or should I really adjust both?&quot;. The Vrms value is used when you are not using the voltage sensor but relying on the declared value or the value you measure once. This is what the comment on line 48 means. So, you adjust the one you are using.</p>
<p>Yes, you do need to calibrate the whole thing, because power is the product of voltage and (the real component of) current. The best way to calibrate the voltage and current constants is against a known accurate meter. The best way to calibrate phase shift is obtain the highest possible power factor when the load is purely resistive (e.g. a fan-less electric heater or water heater). After that, many users have fine-trimmed the calibration over time so that the accumulated energy value tallies with their electricity company&#39;s meter, claiming better than 1% agreement.</p>
<p>The calibration page predates the emonTx V3. Knowing the component values, it&#39;s possible to work through the maths to calculate the coefficients, and this should be reasonably close to the value you determine on test. A big discrepancy indicates an error or a faulty component somewhere. There&#39;s a Building Blocks page that describes the theoretical derivation of the calibration values.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16616"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Sun, 08/12/2013 - 00:46.</div>
    <div class="content">
     <p>I have updated the Vcal value and now the voltage reading is agreeing with my meter.</p>
<p>What is confusing me at the moment (not too difficult!), is that the Ical&nbsp;value in the sketch is 85.75996 but the online pages about calibration give a default value of&nbsp;111.1. Of course I might not be comparing the correct values, but when I read the online documentation I sure it implied that 111.1 was the default current calibration.</p>
<p>Do you know why this is different?</p>
<p>I don&#39;t have a meter that I can use to measure the current, so I&#39;m not sure I can calibrate anything else. Is there anything else I can do to improve accuracy?</p>
<p>By the way, thank you for your responses to what must seem like nonsense coming from a complete novice in this area (I&#39;m learning fast!)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16618"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 08/12/2013 - 01:15.</div>
    <div class="content">
     <p>Please could you provide some more info. Where online are you getting the 111.1 cal from? What value have you come up with which works well? Are you using an ac adapter from the shop? Is it UK / euro plug? We will do some testing this week and check the calibration&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16623"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 08/12/2013 - 02:22.</div>
    <div class="content">
     <p>Glyn: Ical, not Vcal is the problem!</p>
<p>Allen: Which current transformer are you using? Is it the blue YHDC SCT-013-000 from the shop? For that one, the theoretical&nbsp; value for Ical is 90.9 (111.1 relates to a 18 &Omega; burden resistor in the emonTx V2, yours in the V3 is 22 &Omega;.) So 85 isn&#39;t that far out. You can expect a variation of up to at least 5% due to component tolerances (1% on the burden resistor, 3% on the CT and I think 1% on the voltage regulator).</p>
<p>You&#39;ll need to use your electricity meter to calibrate!&nbsp; Take a look at your meter. If it&#39;s a rotating disc, it will say on the front what one revolution of the disc means (or what <em>n</em> revolutions mean). If it&#39;s a digital one, it will have a LED that flashes and it will tell you what 1 flash means (or you may need to look up the meter type on the web and read the manual). Then you run with a constant load and time revolutions or flashes (which will give you energy divided by time, equals power) and you relate that to the power the emonTx reads. Then correct Ical and try again!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16631"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Sun, 08/12/2013 - 10:12.</div>
    <div class="content">
     <p>Glyn: I am using the ac adapter from the shop, but my voltage is now calibrated.</p>
<p>Robert: I am using the blue YHDC SCT-013-000 from the shop as the CT. I guess the value in the&nbsp;emonTxV3_RFM12B_DiscreteSampling sketch in git is just whatever value the developer left in there. But it might be nicer if it was the theoretical value of 90.9, unless there is some explanation as to why it is set to such a precise value that is different.</p>
<p>I have a digital electricity meter with an LED on it, so I will do some timings when I can get a steady load on the system (might need to wait until everyone is in bed!)</p>
<p>I had been wondering if using a pulse counter would have been better for getting the power, surely this would not have suffered from calibration issues?</p>
<p>I am also connecting up a solar system in the Type 2 configuration. Will I need to calibrate that separately using the pulses from the generation meter? If that is the case, how can I set different Ical values for each of the CTs? In the previous emonTxV2 sketch you are able to set voltage and current for each CT, but in this newer sketch there seems to be only one setting for all of them (apart from Ical4).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16632"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4818.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4818.png" alt="dkeverne&#039;s picture" title="dkeverne&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4818.html" title="View user profile.">dkeverne</a> on Sun, 08/12/2013 - 11:17.</div>
    <div class="content">
     <p>Hi Allen,&nbsp; I&#39;ve just been going through the same thing on my new v3.&nbsp; My Vcal (changed in the emoxTX V3 Settings section around line 52 in the sketch) is now at 269.66 (original 284.9667) which matches up better with my MM reading, but I&#39;ve still got more calibration to do later today.&nbsp; I&#39;ll post my final values when I&#39;ve done some more testing.</p>
<p>Darren</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 08/12/2013 - 14:34.</div>
    <div class="content">
     <p>I think you two need to share a thread!&nbsp;(For anyone who&#39;s missed it: <a href="3300.html" title="http://openenergymonitor.org/emon/node/3300">http://openenergymonitor.org/emon/node/3300</a>)</p>
<p>I&#39;ve just written to Glyn suggesting that there should be 4 Ical&#39;s, since when you take the c.t. tolerance into account, to my mind at least the error is unacceptably large if there is a common calibration for the three main c.t&#39;s. If you want to do that, you repeat line 50 to give yourself an Ical1, Ical2 and Ical3, you (probably) get rid of line 170 (or repeat that as well, changing it appropriately (and bear in mind once you&#39;ve inserted some lines above, it won&#39;t be 170 any longer!), and then the important bit: you change what was lines 213, 214 &amp; 215 to use Ical1, Ical2 &amp; Ical3 respectively.</p>
<p>I justify that because as I wrote above, the tolerance on the burden resistor is 1%, and the c.t. is 3%. Therefore together you can expect up to 4% from the nominal due to those alone, or possibly 8% difference between channels. You can also expect another 1% I think from the voltage reference but that&#39;s common to all 5 channels (including the voltage now). It is clearly necessary, once you have established the calibration for a channel, to keep the same c.t. paired with that channel forever.</p>
<p>However, you don&#39;t need to marry the c.t and channel with a particular cable or feed. You can calibrate all 4 inputs simultaneously on the same cable (if there&#39;s room so that you can space them an inch or two apart!).</p>
<p>Pulse counter or c.t. is a matter of preference, as much as anything. True, the pulse count is by definition accurate (even if it isn&#39;t!) but the data is much more granular and requires you not to miss a pulse. You cannot normally measure exported energy (if you have generation) with a pulse input as the meter won&#39;t give pulses when exporting.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16647"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Sun, 08/12/2013 - 18:02.</div>
    <div class="content">
     <p>My own v3&nbsp;definitely needs adjusting, the&nbsp;v2 voltage was v229 it is 241 with the v3.</p>
<p>Thanks for the thread, I shall watch !</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16648"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Sun, 08/12/2013 - 18:18.</div>
    <div class="content">
     <p>So this is my current output , why is ct4 so different ?</p>
<p>emonTx V3 Discrete Sampling<br />
	OpenEnergyMonitor.org<br />
	CT 1-3 Calibration: 90.90<br />
	CT 4 Calibration: 16.66<br />
	RMS Voltage on AC-AC Adapter input is: ~124V<br />
	AC-AC adapter detected - Real Power measurements enabled<br />
	assuming powering from AC-AC adapter (jumper closed)<br />
	Vcal: 268.00<br />
	Phase Shift: 1.70<br />
	CT 1 detected<br />
	CT 2 detected<br />
	CT 3 detected<br />
	CT 4 detected<br />
	Detected 1 DS18B20..using this for temperature reading<br />
	RFM12B Initiated:<br />
	Node: 9 Freq: 868Mhz Network: 212<br />
	16379 14143 14719 2596 311.35<br />
	temperature: 8.30<br />
	1507 163 165 31 230.37<br />
	temperature: 8.30<br />
	1334 15 25 4 228.65<br />
	temperature: 8.30</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16649"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sun, 08/12/2013 - 18:20.</div>
    <div class="content">
     <p>I&#39;ve just updated the calibration constants for the continuous sampling example to values determined theoretically via component values:</p>
<p>voltage calibration: 276.9</p>
<p>(230V x 13) / (9V x 1.2) = 276.9. Where 13 is the voltage divider reduction factor and 1.2 accounts for 20% increase in voltage adapter output voltage as its not being loaded (open circuit)</p>
<p>and</p>
<p>23kW inputs (1-3) current calibration: 90.9&nbsp; ( 2000 turn CT / 22 Ohm burden)<br />
	4.5kW input (4) current calibration: 16.6&nbsp; ( 2000 turn CT / 120 Ohm burden)</p>
<p>The result agree&#39;s well with my reference meter here.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16650"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sun, 08/12/2013 - 18:23.</div>
    <div class="content">
     <p>dod: do you have anything plugged in to CT4? If you put the CT4 clip around the same cable as CT1 does it read the same?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16657"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sun, 08/12/2013 - 19:21.</div>
    <div class="content">
     <p>I&#39;ve updated the emonTxV3_RFM12B_DiscreteSampling sketch on github to use theoretically calculated calibration values and added the ability to tune each CT as suggested by Robert Wall</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16659"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Sun, 08/12/2013 - 19:28.</div>
    <div class="content">
     <p>Hi, Yes I have all four CT&#39;s in use grid,pv1,pv2,EV, I will try the new code.</p>
<p>Thanks</p>
<p>Dave</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16660"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4818.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4818.png" alt="dkeverne&#039;s picture" title="dkeverne&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4818.html" title="View user profile.">dkeverne</a> on Sun, 08/12/2013 - 20:17.</div>
    <div class="content">
     <p>Update, after several calculations and fine tuning I&#39;ve settled for 271.96 as my Vcal, which isn&#39;t far off Trystan&#39;s theoretical, taking into account component variation.&nbsp; It tracks the measured values to within .1 V.&nbsp; I&#39;ll get to current calibration next week.</p>
<p>Dod, I see you have a temperature sensor working, could you confirm your pin connections for that, I can&#39;t get it to recognise the sensor on my board?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16667"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4073.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4073.png" alt="dod&#039;s picture" title="dod&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4073.html" title="View user profile.">dod</a> on Sun, 08/12/2013 - 22:26.</div>
    <div class="content">
     <p>Mine didn&#39;t&nbsp;work first time, so I had to reverse pins 5/6</p>
<p>So I have black on pin 3 white on pin 5 and red on pin 6</p>
<p>&nbsp;</p>
<p>dod</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16707"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4818.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4818.png" alt="dkeverne&#039;s picture" title="dkeverne&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4818.html" title="View user profile.">dkeverne</a> on Wed, 11/12/2013 - 00:03.</div>
    <div class="content">
     <p>Hi, I managed to get some current calibration figures using a 1Kw and 2Kw bar heater.&nbsp; Numbered my 3 CTs (4th is in the post) as swapping them around also gives a small fluctuation, &lt; 1%.&nbsp; So from the theoretical 90.9 for CTs1-3 I now have CT1 89.42, CT2 88.96 and CT4 from 16.6 to 16.5.&nbsp; Not far off the theoretical but they give a much better tracking over higher power readings.</p>
<p>I&#39;ve also been playing with the continuous sampling sketch.&nbsp; Very good code, thanks to Robin Emley.&nbsp; I assume the discrete sketch is just instantaneous sampling every 10 seconds and the continuous one is taking multiple samples per cycle and summing the power, right?&nbsp; I&#39;ll test saving all the samples over a cycle and print them out, which should show a nice sine curve.</p>
<p>I&#39;ve plugged in the Vcal and Ical recalibration figures to those calculations and that is working well.&nbsp; I&#39;m getting about 39 samples per cycle and 38uS of available delay from the workload check.&nbsp; Is that what others have seen as well?&nbsp; Is the 38uS the time it takes to do the calculation or the time available for other things after the calculation?&nbsp; I assume it&#39;s the latter. It looks like it&#39;s testing the delay in every sample of the cycle and prints out what it settled at at the end of the cycle.</p>
<p>I&#39;m gonna have to squint at the code some more as I&#39;d like to get Vrms and Irms out of the calculations, just for interest and comparison...</p>
<p>Cheers, Darren</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16711"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 11/12/2013 - 11:00.</div>
    <div class="content">
     <p>The discreet sampling example samples over 10 full AC cycles, so 200ms per measurement on each CT. Within this measurement it samples rapidly at about 2500 samples per second. There is then an assumption that the power does not fluctuate significantly in the time it is asleep which is usually good enough for typical household monitoring.</p>
<p>The continuous power monitoring example by Robin is better as it samples continuously and so will not miss anything. The only disadvantage is that you cant put the emontx to sleep between samples and that it doesnt work well if you want to dedicate processor time to other operations like temperature monitoring as well. But if your only interested in power measurement and the emontx is always powered then the continuous sampling approach is the better way to go.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16715"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4818.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4818.png" alt="dkeverne&#039;s picture" title="dkeverne&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4818.html" title="View user profile.">dkeverne</a> on Wed, 11/12/2013 - 14:54.</div>
    <div class="content">
     <p>So discreet does 10 cycles, which is 1/5th of a second, 200ms @ 2500 samples per second, so it does 500 samples every 1/5th of a second?&nbsp; And it does that every 10 seconds?&nbsp; So it actually only measures the power for 1/50th of the period?</p>
<p>Just confirming, I&#39;m sure that is fine for rough figures.&nbsp; I know you can never get 100% accurate unless your actually in-line of the power usage or have infinite samples, which isn&#39;t practical ;-)</p>
<p>Have you compared both styles running at the same time on test loads to see how the results differ?&nbsp; I&#39;d need 2 emonTX&#39;s for that.</p>
<p>Cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16717"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 11/12/2013 - 15:59.</div>
    <div class="content">
     <p><em>I&#39;ve also been playing with the continuous sampling sketch.&nbsp; Very good code, thanks to Robin Emley.&nbsp;</em></p>
<p>Thanks, I&#39;m glad it&#39;s being of use to you.&nbsp; Can someone provide a link to this code, it seems to have disappeared from the Github repository.&nbsp; Or maybe I don&#39;t know where to look.</p>
<p><em>So it actually only measures the power for 1/50th of the period?</em></p>
<p>That&#39;s right, most of the early sketches work in this way.&nbsp; It allows three channels to be measured, albeit sparsely, using battery power only.&nbsp;&nbsp; This approach was not suitable for a PV Router application hence my Mk2 code which operates continuously.</p>
<p>The &quot;continuous monitoring&quot; code that I&#39;ve supplied for emonTx_V3 is a simple extension of my Mk2i PV Router code.&nbsp; By using low-level commands for the ADC, and integer-based maths, a decent sampling rate can be obtained for several analogue channels.&nbsp; This sketch uses five such channels (one voltage and four current).&nbsp; As per its Mk2 ancestry, an energy accumulator&nbsp; for each of the channels is updated every mains cycle.&nbsp; This arrangement is not ideal for a straightforward measurement application.&nbsp;</p>
<p>The alternative arrangement that I posted soon after in a <a href="2917.html">6-channel version</a> may be better (the code is in a zip-file at the end of the thread).&nbsp; For maximum speed, the 6-channel version has the ADC in free-running mode; the 5-channel one has the ADC in a timer-based mode which may provide better control of the sampling intervals.</p>
<p><em>The continuous power monitoring example by Robin is better as it samples continuously and so will not miss anything. The only disadvantage is that you cant put the emontx to sleep between samples and that it doesnt work well if you want to dedicate processor time to other operations like temperature monitoring as well.</em></p>
<p>Because this code is timer-based, the sampling rate can be reduced in order to create as much spare time as is needed.&nbsp; Although the ADC is running pretty much flat out, the main processor is only about 50% occupied.&nbsp; There should be plenty of time for other activities.&nbsp; Because all the data <strike>is</strike> are processed in one go, the idle periods (ignoring ISRs) between consecutive blocks of calculations are quite lengthy, maybe 250uS every 520uS.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16719"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4818.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4818.png" alt="dkeverne&#039;s picture" title="dkeverne&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4818.html" title="View user profile.">dkeverne</a> on Wed, 11/12/2013 - 18:37.</div>
    <div class="content">
     <p>I found it in:</p>
<p>OpenEnergyMonitor/emonTxFirmware/emonTxV3/RFM12B/Examples/emonTxV3_continuous</p>
<p>I shall read the other thread later with interest.&nbsp; I already had a quick skim and like the ASCII waveform diagram ;-)</p>
<p>Cheers</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16720"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 11/12/2013 - 19:05.</div>
    <div class="content">
     <p>Thanks for that link, I&#39;d not thought to look in the RFM12B folder.&nbsp; The RF part was a last-minute addition to that code.</p>
<p>Yes, I was pleased when that 6-channel trace appeared.&nbsp; As it&#39;s the Festive Season, maybe it deserves a second viewing :)</p>
<pre>
&gt;&gt;free RAM = 725
millis() now = 0
recordingMayStartAt 5000
4
3
2
1
0
No of cycles recorded = 1
cycleCount 252,  samplesRecorded 28
|                                  235 0.14                                     |
|                            3   5      .    401                                |
|                       3      5        .       4   01                          |
|                 3 2        5          .         4       1                     |
|            3  2          5            .          4          10                |
|         3   2           5             .           4            1 0            |
|       3    2            5             .            4            1   0         |
|       3     2           5             .           4             1    0        |
|       3      2           5            .           4             1    0        |
|          3     2           5          .         4             1     0         |
|                3    2        5        .       4          1     0              |
|                      3    2     5     .    4        1    0                    |
|                             3  2   5  .  4     1  0                           |
|                                    3 25  1  0                                 |
|                                   41 0.  532                                  |
|                              10 4     .     5   3                             |
|                        10    4        .       5      23                       |
|                   01       4          .         5        2 3                  |
|              0 1         4            .           5          2  3             |
|          0  1           4             .            5           2   3          |
|        0   1            4             .            5           2     3        |
|       0    1            4             .           5            2     3        |
|       0    1             4            .           5           2      3        |
|        0     1             4          .         5          2     3            |
|             0     1          4        .       5       2     3                 |
|                   0    1        4     .    5     2   3                        |
|                          0  1     4   . 5   2  3                              |
|                                0  1  52 3                                     |
 </pre>         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16737"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4782.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4782.png" alt="AllenConquest&#039;s picture" title="AllenConquest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4782.html" title="View user profile.">AllenConquest</a> on Fri, 13/12/2013 - 11:35.</div>
    <div class="content">
     <p>I finally got my solar PV system working today and got some readings coming from the emonTxV3. &nbsp;However, the inverter was should 242w, but my monitoring was showing 112w. That would give me&nbsp;</p>
<p>112/242 * 90.9 = 42.069</p>
<p>This seems very low. Has anyone else experienced something like this?</p>
<p>The CT clip is round a very narrow cable that comes from the inverter, could that affect the reading?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16738"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 13/12/2013 - 13:52.</div>
    <div class="content">
     <p>That does not sound right at all. Are you using an AC-AC adapter to power the emonTx&nbsp;V3? Also are you using the latest firmware on github?&nbsp;<a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling">https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/emonTxV3_RFM12B_DiscreteSampling</a></p>
<p>When you start up the emonTx V3 if you have a USB to UART&nbsp;cable connected it will serial print on 9600 baud the calibration values currently in the code.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16739"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 13/12/2013 - 13:57.</div>
    <div class="content">
     <p>Ah, just seen your other post:&nbsp;<a href="3330.html">http://openenergymonitor.org/emon/node/3330</a>. I&#39;ve just replyed&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16742"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Fri, 13/12/2013 - 14:35.</div>
    <div class="content">
     <p>calibraci&oacute;n de tensi&oacute;n: 276.9<br />
	(230V x 13) / (9V x 1,2) = 276,9. Donde 13 es el factor de reducci&oacute;n de divisor de tensi&oacute;n y 1.2 representa 20% de aumento en la tensi&oacute;n de salida del adaptador de tensi&oacute;n, ya que no est&aacute; cargado (circuito abierto)</p>
<p>&nbsp;</p>
<p>Saludos Amigos estoy intentando realizar un prototipo b&aacute;sico con un TC y un adaptador de AC-AC,, estoy tratando de calibrar de acuerdo a las condiciones en la que estoy trabajando (Vref=5V, tensi&oacute;n de la red 120V +-10%, y).</p>
<p>Si&nbsp; tengo una variaci&oacute;n del 20%&nbsp; sin carga y la salida nominal es de 9V , el porcentaje ser&iacute;a 1.8 y no 1.2, o estoy interpretando mal... Otra duda que tengo es, que hacer con la constante de calibraci&oacute;n, que operaci&oacute;n debo realizar para obtener los valores, similares o en el mejor de los casos iguales a los de mi mult&iacute;metro.</p>
<p>La verdad soy nuevo en esto, me parece que es una pregunta muy b&aacute;sica, pero si me pueden ayudar les quedo infinitamente agradecido, y si tienen un c&oacute;digo para estudiarlo y entenderlo mucho mejor...</p>
<p>Gracias...!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16750"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 13/12/2013 - 16:03.</div>
    <div class="content">
     <p>Your AC-AC adapter gives you ~ 11 V out for 120 V in, therefore if you use the calibration constant that is correct for a 240 V supply, it will say your supply is twice the voltage that you have in reality. Therefore you must use a voltage calibration constant that is approximately 140 ( 276.9 -&gt; 140). You measure the voltage and change the &quot;140&quot; so that your prototype reads the same as your meter.</p>
<p>&quot;Si&nbsp; tengo una variaci&oacute;n del 20%&nbsp; sin carga y la salida nominal es de 9V , el porcentaje ser&iacute;a 1.8 y no 1.2, o estoy interpretando mal...&quot;</p>
<p>I am sorry, but you are misinterpreting it. The voltage for small transformers is given at the rated load - 9 V - and the voltage rises by ~20% on no-load ( 11 / 9 = 1.22). For a distribution transformer owned by the power company, it is the no-load voltage that is &#39;normal&#39; and the transformer regulation is the drop in voltage at full load.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16791"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Sun, 15/12/2013 - 18:31.</div>
    <div class="content">
     <p>Gracias por contestar, &nbsp;estoy trabajando en esto y cada vez me surgen mas dudas, disculpas &nbsp;pero la verdad no me quedan claras algunas cosas, si me pueden ayudar con lo siguiente.&nbsp;</p>
<p>Tengo un Transformador de tensi&oacute;n en el cual el fabricante indica (110V AC / 12V AC) pero la tensi&oacute;n en mi pa&iacute;s es de 120V AC &nbsp;&plusmn;10% , es decir &nbsp;en el peor de los casos ser&iacute;a 132V AC he &nbsp;realizado la medici&oacute;n y obtengo a la salida del adaptador 15Vrms a esto le debo a&ntilde;adir el 20% debido a que no existe carga, quedandome 18Vrms = 25.46Vpico esto lo e utilizado para calcular el valor de la resistencia del divisor de tensi&oacute;n, tomando en cuenta que estoy trabajando con un aruino Mega 2560R3 y utilizo la referencia de 5V, finalmente los valores de resistencia son 100K y 10K, teniendo como m&aacute;ximo 2.3 Vpico. &nbsp;A &nbsp;partir de esto tengo las siguientes preguntas concretas.</p>
<p>1) Revis&eacute; el siguiente link <em>&nbsp;http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor-installation-and-calibration-theory </em>&nbsp;. Y la pregunta es &iquest;Por qu&eacute; se utiliza un solo valor de tensi&oacute;n (230V) sin tomar en cuenta la variaci&oacute;n que esta puede tener?.&nbsp;</p>
<p>Si aplico la f&oacute;rmula &nbsp;&quot;<em>voltage constant = 230 &times; 11 / (9 &times; 1.20) = 234.26</em>&quot; &nbsp;en las condiciones que estoy trabajando tendr&iacute;a lo siguiente.&nbsp;</p>
<p>2) Voltage Constant = 110 x 11 / (12 x 1.2) = 84.03&nbsp; Donde 110 es el voltage que indica el fabricante. &iquest;Esto es correcto con mis condiciones? o debo poner el valor de voltage real que tengo en la red (120V). &nbsp;</p>
<p>3) No comprendo la l&oacute;gica de esta constante de calibraci&oacute;n . &iquest;Por qu&eacute; se utiliza esta f&oacute;rmula?. &nbsp;</p>
<p>4) &iquest;Qu&eacute; funci&oacute;n tiene la siguiente l&iacute;nea de c&oacute;digo de la librer&iacute;a &quot;<em>EmonLib&quot; ?</em></p>
<p><em>double V_RATIO = VCAL *((SUPPLYVOLTAGE/1000.0) / 1023.0); &nbsp; &nbsp; &nbsp; &nbsp; Donde &nbsp;VCAL = Voltage constant<br />
	&nbsp;Vrms = V_RATIO * sqrt(sumV / numberOfSamples);&nbsp;</em></p>
<p>GRACIAS..!!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16792"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Sun, 15/12/2013 - 19:40.</div>
    <div class="content">
     <p>Mil disculpas, yo pens&eacute; por un momento realizar &nbsp;otros c&aacute;lculos muy diferentes a los que est&aacute;n <a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory">aqu&iacute;</a>&nbsp; Lo que pensaba realizar &nbsp;es lo siguiente:</p>
<p>1) Realice unas medidas con mi mult&iacute;metro&nbsp;el cual indica que tiene un error de 1%, y los resultados fueron:</p>
<p>VInt =108Vrms Vout= 12.3 Vrms<br />
	VInt=121.7Vrms Vout=13.87<br />
	VInt=130Vrms&nbsp; Vout=14.7 Vrms&nbsp;<br />
	VInt=132Vrms&nbsp; Vout=15 Vrms</p>
<p>2) Como la se&ntilde;al de entrada al&nbsp;ADC del arduino&nbsp;tiene una relaci&oacute;n de VintArduino= (1 / 11) (VOutAdaptador). Tomando como ejemplo &nbsp;la medida &nbsp;<em>VInt=130Vrms&nbsp; Vout=14.7 Vrms. Tendr&iacute;amos&nbsp;</em></p>
<p>3) VintArduino= (1 / 11) (14.7)=1.34V &nbsp;que corresponde a la muestra 274 del ACD del microprocesador, Entonces lo que se busca es una constante de calibraci&oacute;n que nos de el valor real (130Vrms), Se tendr&iacute;a la siguiente ecuaci&oacute;n:</p>
<p>4) VoltageConstant&nbsp;= 274 / 130 = 2.1 &nbsp;es decir que mediante software se debe dividir cada muestra entre 2.1 para obtener el valor real (130V).</p>
<p>Esto tomando en cuenta que la relaci&oacute;n del voltaje de salida del adaptador es lineal con respecto a la entrada.&nbsp;</p>
<p>Revis&eacute; el link anterior y la constante de calibraci&oacute;n es muy diferente, y no logro Interpretar su procedimiento</p>
<p><em>&nbsp;&quot;voltage constant = 230 &times; 11 / (9 &times; 1.20) = 234.26&quot;&nbsp;</em></p>
<p><em>&iquest;Que procedimiento realizan una vez calculada la constante &nbsp;de voltaje (234.26)?.&nbsp;</em></p>
<p><em>Se que no debe haber mucha dificultad para maestros como ustedes, pero yo estoy empezando a trabajar en esto y se me hace complicado.</em></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><em>Gracias &nbsp;nuevamente por su ayuda..!!</em></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16797"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 15/12/2013 - 22:43.</div>
    <div class="content">
     <p>I also found it complicated when I started! It is difficult, but it is possible to work through the mathematics to obtain the voltage constant.</p>
<p><em>1) Revis&eacute; el siguiente link&nbsp; <a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory%c2%a0" title="http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor-installation-and-calibration-theory ">http://openenergymonitor.org/emon/buildingblocks/ct-and-ac-power-adaptor...</a> . Y la pregunta es &iquest;Por qu&eacute; se utiliza un solo valor de tensi&oacute;n (230V) sin tomar en cuenta la variaci&oacute;n que esta puede tener?.</em></p>
<p>In the formula</p>
<p class="rteindent1">&quot;voltage constant = 230 &times; 11 / (9 &times; 1.20) = 234.26&quot;</p>
<p>&quot;230&quot; is the stated supply voltage for the adapter, and &quot;(9 &times; 1.20)&quot; is the output voltage at that supply voltage. You can use any supply voltage provided you know the output voltage that goes with it.</p>
<p>	&quot;11&quot; is the inverse of the ratio of the voltage divider in the input circuit.</p>
<p>Now the real question is: Is 100 k&Omega; and 10 k&Omega; the correct voltage divider?<br />
	Your maximum supply voltage is 132 V and at that voltage, you have 15 V from the adapter. Your ADC in the Arduino can accept 5 V peak-to-peak = 1.767 V rms, so that is safe, because you get only 1.36 V from the divider. You could use 82 k&Omega; and 10 k&Omega; in the voltage divider; then your calibration constant would be:</p>
<p class="rteindent1">132 V &times; ( (82 k + 10 k) / 10 k )&nbsp; / ( 15 V ) = 80.96</p>
<p>and you still have ~ 7% available to allow for component tolerances.</p>
<p><em>4) &iquest;Qu&eacute; funci&oacute;n tiene la siguiente l&iacute;nea de c&oacute;digo de la librer&iacute;a &quot;EmonLib&quot; ?</em></p>
<p><em>double V_RATIO = VCAL *((SUPPLYVOLTAGE/1000.0) / 1023.0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Donde&nbsp; VCAL = Voltage constant<br />
	Vrms = V_RATIO * sqrt(sumV / numberOfSamples);</em></p>
<p>Two things are happening here. (1) The first line is taking the voltage calibration constant (VCAL) and &quot;correcting&quot; it by measuring the actual analogue reference voltage ( = V<sub>CC</sub> ) at the top of the emonLib method calcVI( ), which it calls SUPPLYVOLTAGE. This is the reason that the Arduino V<sub>CC</sub> does not appear in the formula.</p>
<p>2) the second line is completing the rms calculation and applying the calibration. It is taking the average of the sum of V<sup>2</sup> and then taking the square root, multiplying by the number we just calculated that is the adjusted calibration constant and giving the answer in Volts rms.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16803"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Mon, 16/12/2013 - 04:24.</div>
    <div class="content">
     <p>&quot;Your maximum supply voltage is 132 V and at that voltage, you have 15 V from the adapter. Your ADC in the Arduino can accept 5 V peak-to-peak = 1.767 V rms, so that is safe, because you get only 1.36 V from the divider. You could use 82 k&Omega; and 10 k&Omega; in the voltage divider; then your calibration constant would be.....</p>
<p>Pero&nbsp; adicional a los&nbsp; 15 V tengo que sumarle la variaci&oacute;n del 20% debido a que no existe carga lo que me dar&iacute;a 18 V = 25.46 V pico-pico,&nbsp; y tom&eacute; en cuenta&nbsp; el caso en que la se&ntilde;al de referencia del arduino fuera 4.8V&nbsp; ya que planeo ponerle una bater&iacute;a que sirve cuando no haya servicio el&eacute;ctrico y esta hace que var&iacute;e la referencia. Haciendo los c&aacute;lculos y si selecciono una resistencia fija R2=100k&nbsp; obtengo&nbsp; R1=10.4k&nbsp; aproximadamente&nbsp; a 10k ... Es correcto esto? o &iquest;Cuando se toma en cuenta la variaci&oacute;n del 20% a la salida del adaptador?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16813"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 16/12/2013 - 13:07.</div>
    <div class="content">
     <p>No, you measured the adapter with no load (only your multimeter) so there is no need to add another 20%.</p>
<p>You only need to allow for transformer regulation when you use the full-load voltage that the manufacturer of the adapter gives: i.e. if the manufacturer states that it is for 120 V supply and gives 9 V and it is rated at 6 VA, then you get 9 V out when the load is 666 mA, and the voltage rises as the load reduces.</p>
<p>If you measure the same adapter at 132 V supply and you get 15 V out on no load, then those are the numbers you should use, because your circuit does not put a significant load on the adapter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16819"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Mon, 16/12/2013 - 14:54.</div>
    <div class="content">
     <p>Thank you very much!!</p>
<p>With this explanation I guess I&#39;ll calibrated voltage, then start with the current sensor and I need help.</p>
<p>In the library &quot;EmonLib&quot; algorithm is not performed to detect that wavelength is Missoni is &quot;zero&quot; (512) as it does in the voltage.</p>
<pre>
<em>boolean st=false;                            

unsigned long start = millis();

  while(st==false)                            
  {
     startV = analogRead(inPinV);              
     if ((startV &lt; 550) &amp;&amp; (startV &gt; 440)) st=true;
     if ((millis()-start)&gt;timeout) st = true;
  }</em></pre><p>Why not do the same with variable current?<br />
	Thanks was very helpful comments...!!!xfa</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16825"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 16/12/2013 - 15:15.</div>
    <div class="content">
     <p>The standard sketch for measuring voltage and current waits until the ADC value for voltage is near the zero-crossing point.&nbsp;&nbsp; This technique is possible because mains voltage should always be present.</p>
<p>For the current only sketch, it would be difficult to detect the start of a mains cycle if no current was flowing through the CT.&nbsp; I presume that&#39;s why this &quot;synchronous start&quot; stage is omitted.&nbsp; Instead, the measurement process starts straight away.&nbsp; By choosing a suitable number of samples, it should be possible to measure the current for a whole number of mains cycles, which achieves much the same effect. &nbsp;</p>
<p>(Hope this is right - from memory)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16826"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 16/12/2013 - 15:43.</div>
    <div class="content">
     <p>That is right - but there is no need to start sampling at or near zero in particular, it is only necessary to have as nearly as possible an integer number of whole cycles. So the exact point on the wave at which we start does not matter, as long as we finish at about the same place.</p>
<p>And there is no need to do the same with current, because emonLib measures samples of voltage and current alternately - approximately 50 pairs per cycle at 50 Hz.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16829"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Mon, 16/12/2013 - 16:19.</div>
    <div class="content">
     <p>Sorry, but the more I study, the more ignorant I become, I&#39;m tried to interpret the entire library &quot;EmonLib&quot;, here applies a high pass filter to remove the DC component (offset), can be you&nbsp; skip this algorithm by hardware if a full wave rectifier is used as to calculate effective values ​​has the same effect, since the formula is squared .....</p>
<p>&nbsp;</p>
<p>What implications would need to make this change?</p>
<p>Another option would be to use a half-wave rectifier, would have the same effect is compensated by multiplying 1 / sqr (2). and would avoid double drop diode voltage (occurring in the full-wave).</p>
<p>This is it correct?.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16830"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 16/12/2013 - 16:41.</div>
    <div class="content">
     <p>You cannot use a rectifier. If you do, you no longer have any information about the phase of the current in relation to the voltage, therefore you cannot determine the direction of power flow. In addition, if you include a rectifier, you will introduce non-linearity as the diodes begin to conduct.</p>
<p>I do not understand why you want to do that. All the rectification that is necessary is done in the software. As you say, provided you are measuring only power, you need only one high-pass filter. But if you need an output of both voltage and current, then you must have a high pass filter in each.</p>
<p>One more point: EmonLib is proven and it works.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16831"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Mon, 16/12/2013 - 17:48.</div>
    <div class="content">
     <p>&nbsp;</p>
<blockquote><p><em>&quot;One more point: EmonLib is proven and it works&quot;.</em></p>
<p>&nbsp;</p>
</blockquote>
<p>works well, I&#39;m know.<br />
	My idea is to fully understand how it works, now you can not run a full wave rectifier.</p>
<p>I&#39;m starting and so I came all these doubts.<br />
	Thanks for the help.!</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16848"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Tue, 17/12/2013 - 23:16.</div>
    <div class="content">
     <p>Help, I have problems playing back the program, you say that it takes <em>about 50 samples per cycle pairs</em>. Where does he get this value?.</p>
<p>According to my analysis, the samples are subject to sampling period of the ADC of Arduino (100uS), if I set the variable</p>
<p><em>&quot;timeout = 2000&quot;&nbsp;</em></p>
<p>Sampling would be for two seconds, which corresponds to 120 cycles (60 Hz). What if the other side to the<em>&nbsp;&quot;crossings&quot;</em> Variable I assign a value of 20?. Not fit something in there ...<span style="font-size: 12px;">The variable value should be 240 crossings. and must always have a logical relationship with the timeout variable.</span></p>
<p>Now there is another issue, as this sampling voltage and current time between samples is another 400uS, you&#39;ll take 41.67 samples per cycle, now in 2 seconds would have approximately 5000 samples.</p>
<p>Is this correct?.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16850"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 18/12/2013 - 00:33.</div>
    <div class="content">
     <p>Timeout is totally different. It should never end the sampling loop. It is there to prevent the program waiting forever in an infinite loop if there is no input. CrossCount should always terminate the measurement loop.</p>
<p>The default &quot;crossings&quot; (or wavelengths - which is not true, it is half-wavelengths) is 20, which at 50 Hz is 10 cycles in 0.2 s. If you leave crossings at 20, at 60 Hz you will sample for 0.166 s.&nbsp; Sampling for 0.2 s every 5 s was chosen to give a good battery life when using battery power. If you want to sample for 0.2 s, &quot;crossings&quot; should be 24.</p>
<p>As you say, the number of samples is defined by the rate at which the ADC converts inputs and the time taken by the program to do the mathematics. It works out be a little more than 2500 sample pairs per second. So you are almost correct, in 2 s you will have a little more than 5000 sample pairs. On a 60 Hz supply, I think you should see maybe one or two more, about 42 or 43 sample pairs per cycle.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Wed, 18/12/2013 - 00:53.</div>
    <div class="content">
     <blockquote><p>&quot;If you want to sample for 0.2 s, &quot;crossings&quot; should be 24.&quot;</p>
</blockquote>
<p>What effect has increased or decreased if the <em>&quot; crossings = 40 &quot; or &quot;&nbsp; crossings = 5&quot;</em> cycles ?. Have any negative effect?.</p>
<p>What would be the optimal value for crossings?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16853"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 18/12/2013 - 01:41.</div>
    <div class="content">
     <p>For how long do you want to measure?&nbsp; And how frequently?&nbsp; 0.2 s every 5 s is good if your electricity demand is not changing rapidly.</p>
<p>If you want, <a href="https://learn.openenergymonitor.org/?redirect=pll">Diverting surplus PV Power: PLL</a> will measure power continuously - you do not need to use the energy diverting function if you do not need it.</p>
<p>There is a 60 Hz version available (3 c.t&#39;s - by Dan Woodie: <a href="2624.html" title="http://openenergymonitor.org/emon/node/2624">http://openenergymonitor.org/emon/node/2624</a><br />
	and <a href="2679.html" title="http://openenergymonitor.org/emon/node/2679">http://openenergymonitor.org/emon/node/2679</a>)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16855"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Wed, 18/12/2013 - 03:02.</div>
    <div class="content">
     <p>What I seek is actually measuring energy consumption continuously (Real Time), ie the load increases at some point turn to observe the increase of energy ..... I think these changes (increased load ) do not occur very often, but if I must occur sensing that change.</p>
<p>I&#39;m think it would be fine in 5s 0.2s for my application.</p>
<p>I&#39;m will review the code of Dan, I will definitely take time entendenderlo.<br />
	Thanks for the help.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16861"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 18/12/2013 - 12:38.</div>
    <div class="content">
     <p>Two sketches of mine which measure Real Power continuously and support the RFM12B are available:</p>
<p><a href="https://github.com/openenergymonitor/emonTxFirmware/tree/master/emonTxV3/RFM12B/Examples/emonTxV3_continuous">This code</a> measures real power on four channels, it is intended for single-phase use with the emonTx V3.&nbsp; The ADC sampling regime uses a hardware timer.&nbsp;</p>
<p>The code on <a href="2917.html">this thread</a> (in <a href="../sites/default/files/NZ_project.zip">NZ_project.zip</a>) has the ADC in free-running mode for greatest speed.&nbsp; It was written to monitor 2 phases of a 3-phase supply, but could easily be modified to measure power on all three phases.</p>
<p>As far as I can see, both of these sketches should be able to measure real power in a 60Hz environment without requiring any changes.&nbsp; The first sketch also accumulates energy, so &quot;50&quot; should be changed to &quot;60&quot; in each of the following lines:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.msgNumber = msgNumber++; // increment<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.power_CT1 = energyInBucket_long_CT1 * (powerCal_CT1/50);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.power_CT2 = energyInBucket_long_CT2 * (powerCal_CT2/50);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.power_CT3 = energyInBucket_long_CT3 * (powerCal_CT3/50);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tx_data.power_CT4 = energyInBucket_long_CT4 * (powerCal_CT4/50);<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16866"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 18/12/2013 - 14:46.</div>
    <div class="content">
     <p>Thanks Robin. I was looking for those last night and couldn&#39;t find them, and hoped you&#39;d chip in. They&#39;re now in my private FAQ list.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-16874"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4595.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4595.jpg" alt="José&#039;s picture" title="José&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Calibration of emonTxV3 and emonTxV3_RFM12B DiscreteSampling sketch </h3>

    <div class="submitted">Submitted by <a href="../user/4595.html" title="View user profile.">José</a> on Wed, 18/12/2013 - 19:48.</div>
    <div class="content">
     <p>Thanks calypso_rae, no doubt this will help me a lot going to interpret the code and make the corresponding changes, I think I will take some time, since the code and <em>EmonLib</em> different from the library, which was the one with reference.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3292"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-E12Obonc01WdMC0MYXhQa_yizcOSdWSP-pa576XkWaU" value="form-E12Obonc01WdMC0MYXhQa_yizcOSdWSP-pa576XkWaU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
