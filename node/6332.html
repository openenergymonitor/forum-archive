<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/6332 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:00:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Can&#039;t make new RFM12Pi start | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Can&#039;t make new RFM12Pi start</h3>
        <span class="submitted">Submitted by <a href="../user/7401.html" title="View user profile.">Kokop</a> on Sat, 20/12/2014 - 20:48</span>
        <div class="content"><div>&nbsp;</div>
<div>&nbsp;</div>
<p>Hi everybody.</p>
<div>&nbsp;</div>
<div>I&#39;ve recently purchased a RFM12Pi and I&#39;m trying to use it in a Raspberry Pi B+. Before connecting it I&#39;ve followed this howto <a href="https://github.com/emoncms/emoncms/blob/bufferedwrite/docs/install.md">https://github.com/emoncms/emoncms/blob/bufferedwrite/docs/install.md</a></div>
<p>I had removed all the ttyAMA0 bits from /boot/cmdline.txt and did the other steps from the guide. I&#39;ve checked that I can enter emoncms, register a new user, but I have no inputs. Looking at emonhub.log I see:</p>
<p>ERROR Unable to create &#39;RFM2Pi&#39; interfacer: Attempting to use a port that is not open</p>
<p>I&#39;ve googled around to see how could I run more checks. I&#39;ve tried minicom (even with root user) using:</p>
<p>minicom -b 9600 -D /dev/ttyAMA0</p>
<p>I&#39;ve checked before there were no python process using the serial port (ps -ef|grep python shows nothing, and I&#39;ve ran too the localemoncms-disable script). Minicom starts but it stops at the &quot;Press CTRL A+Z ...&quot; line. It stills works, since I can press CTRL A commands, but I can&#39;t enter any other type of command (I wanted to light the led using 1l) or I don&#39;t know how to use minicom. I can&#39;t see any line beginning with &gt; to write a command or anything related to the RFM12Pi.</p>
<p>It is well fixed in the GPIO pins. I&#39;ve read it comes with a firmware pre-installed so I guess I should see something in minicom but, to be honest, I&#39;m not sure.</p>
<p>Could someone tell me a basic test just to see if the RFM12Pi works? (like switching on the led) I&#39;m a total newbie in this, so maybe I have emoncms running or something is interfering and I want to be sure my RFM12Pi is not faulty :(.</p>
<p>Many thanks in advance,</p>
<p>Kokop.</p>
<p>P.S. By the way, I&#39;ve seen older howtos talking about rfm12piphp. There is no &quot;/var/www/emoncms/Modules/raspberrypi/rfm12piphp&quot; folder in my emoncms installation. Should I download it somewhere?</p>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div>&nbsp;</div>
  <div class="forum-topic-navigation clear-block">
          <a href="6335.html" class="topic-previous" title="Go to previous forum topic">‹ MultiGraph is not showing correct data </a>
              <a href="6329.html" class="topic-next" title="Go to next forum topic">Issues Loading Sketch [Solved] ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-26024"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can't make new RFM12Pi start</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 20/12/2014 - 22:41.</div>
    <div class="content">
     <p><em>P.S. By the way, I&#39;ve seen older howtos talking about rfm12piphp. There is no &quot;/var/www/emoncms/Modules/raspberrypi/rfm12piphp&quot; folder in my emoncms installation. Should I download it somewhere?</em></p>
<p>No, the rfm12piphp&nbsp;is the forerunner&nbsp;to emonhub, and you can only have one listener at a time installed, so no, lets sort out the problem without adding to it!<br />
pb66&nbsp;is developing emonhub, and will hopefully pick this up, but in the meantime, is the emonhub&nbsp;configuration file details correct? -&nbsp;</p>
<pre>
$ nano /etc/emonhub/emonhub.conf</pre><p>And in that config, there is an option to change the error logging to &#39;Debug&#39; (if you haven&#39;t&nbsp;already done so)&nbsp;which often provides a bit more detail and can help.</p>
<p>&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26026"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7401.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7401.png" alt="Kokop&#039;s picture" title="Kokop&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can't make new RFM12Pi start</h3>

    <div class="submitted">Submitted by <a href="../user/7401.html" title="View user profile.">Kokop</a> on Sat, 20/12/2014 - 23:37.</div>
    <div class="content">
     <div>Thanks for your help, Paul.</div>
<p>It still doesn&#39;t work, but I&#39;ve found one important problem. There was no emonhub.conf at all because it looks like I didn&#39;t install dev-emonhub properly and I don&#39;t know why. I remember I did it (I remember because the guide says dev-emonhub/install.sh instead of dev-emonhub/install and looking at my history commands I see I did ran both versions), but maybe it failed because I didn&#39;t attach the RFM2Pi during the install? Whatever, it was my fault. I reinstalled it and this time it looks every file is in their correct place.</p>
<p>However the symptoms are the same. Your tip was very good and I put logging at debug level. Now, I see this in the log:</p>
<p>2014-12-20 23:10:14,275 INFO Creating EmonHubJeeInterfacer &#39;RFM2Pi&#39;<br />
2014-12-20 23:10:14,279 DEBUG Opening serial port: /dev/ttyAMA0 @ 57600 bits/s<br />
2014-12-20 23:10:16,287 DEBUG Opening serial port: /dev/ttyAMA0 @ 9600 bits/s<br />
<strong>2014-12-20 23:10:20,307 INFO RFM2Pi device firmware version &amp; configuration: not available</strong><br />
2014-12-20 23:10:20,313 INFO Setting RFM2Pi frequency: 433 (4b)<br />
2014-12-20 23:10:21,325 INFO Setting RFM2Pi group: 210 (210g)<br />
2014-12-20 23:10:22,329 INFO Setting RFM2Pi quiet: 1 (1q)<br />
2014-12-20 23:10:23,333 INFO Setting RFM2Pi baseid: 15 (15i)<br />
2014-12-20 23:10:24,368 DEBUG RFM2Pi acknowledged command: &gt; 4b<br />
2014-12-20 23:10:24,837 DEBUG 1 NEW FRAME : 1419117024.84 config failed&gt; 210g<br />
2014-12-20 23:10:24,847 WARNING 1 Discarded RX frame &#39;non-numerical content&#39; : [&#39;config&#39;, &#39;failed&gt;&#39;, &#39;210g&#39;]<br />
2014-12-20 23:10:25,296 DEBUG 2 NEW FRAME : 1419117025.3 config failed&gt; 1q<br />
2014-12-20 23:10:25,713 WARNING 2 Discarded RX frame &#39;non-numerical content&#39; : [&#39;config&#39;, &#39;failed&gt;&#39;, &#39;1q&#39;]<br />
2014-12-20 23:10:25,949 DEBUG RFM2Pi acknowledged command: &gt; 15i<br />
2014-12-20 23:14:51,508 DEBUG SIGINT received.<br />
2014-12-20 23:14:51,510 INFO Exiting hub...<br />
2014-12-20 23:14:51,513 DEBUG Closing serial port<br />
2014-12-20 23:14:51,573 INFO Exit completed</p>
<p>Is it that the RFM2Pi has not firmware? I thought it had one preinstalled. Although it looks like the emoncms install works (without the RFM2Pi, but I can log in, there are no mysql errors, and so on), maybe I&#39;ve messed up something during the installation. Would it be possible to do a quick test with minicom just to see if the RFM is alive?</p>
<p>Right now, I&#39;ve tried running these commands:</p>
<p>/usr/bin/localemoncms-disable (it looks like everything stops nicely)</p>
<p>sudo service emonhub stop (just in case, it stops nicely too)</p>
<p>ps -ef|grep python (there are no python process running)</p>
<p>sudo minicom -b 9600 -D /dev/ttyAMA0 (I just see till the Press CTRL-A Z message)</p>
<p>&nbsp;</p>
<p>If I do this:</p>
<p>ps -ef|grep ttyAMA0<br />
root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2883&nbsp;&nbsp;&nbsp;&nbsp; 1&nbsp; 0 23:11 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:00 /sbin/getty -L ttyAMA0 115200 vt100</p>
<p>I see that getty process. Is it important? Btw, I&#39;m also accessing the Raspberry through ssh and wirelessly.</p>
<p>Another detail, the led in the RFM12Pi flashes when you switch the Raspberry on. I guess that&#39;s good news. After that first flash it remains turned off.</p>
<p>Thanks again for your help and let&#39;s hope someone can point me in the right direction!</p>
<div id="yass_bottom_edge" style="background-image: url(_chrome_/yass/content/edgebgbot.html); background-position: 0px 0px; position: absolute; margin: 0px; padding: 0px; border-width: 0px; height: 0px; left: 0px; top: 0px; width: 100%; display: block;">&nbsp;</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26027"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can't make new RFM12Pi start</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 20/12/2014 - 23:56.</div>
    <div class="content">
     <p>What are you using to send data to your RFM12PI? is it sending&nbsp;data in the correct format?</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26028"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can't make new RFM12Pi start</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 21/12/2014 - 00:06.</div>
    <div class="content">
     <p>Hi Kokop</p>
<p>This is a new one that I&#39;ve not seen before, the log is telling us that the RFM2Pi is there and responding to commands from emonhub, but it&#39;s not happy at all. It accepted the frequenct&nbsp;selection ok but then for some reason it&#39;s prefixed the next 2 responses&nbsp;with &quot;config&nbsp;failed&quot;&nbsp;which is not a response that is expected by emonhub (or me for that fact!) and not responded to the&nbsp;4th command in a 41/2min window.&nbsp;</p>
<p>The &quot;RFM2Pi device firmware version &amp; configuration: not available&quot; isn&#39;t necessarily&nbsp;an issue as it&#39;s only available on some&nbsp;RFM2Pi&nbsp;firmwares.&nbsp;</p>
<p>Right now the issue seems to&nbsp;not be&nbsp;with emonhub.it&#39;s either with the serial console or the RFM2Pi (which is unlikely) so please check you have done both of these (cut from another post)</p>
<p>&nbsp;</p>
<p>Then&nbsp;disable the&nbsp;serial console&nbsp;by editing&nbsp;/etc/inittab and&nbsp;&nbsp;/boot/cmdline.txt</p>
<p>Firstly edit the inittab&nbsp;file&nbsp;by adding a &#39;#&#39; to the beginning of the last line, so it reads;</p>
<p># T0:23:respawn:/sbin/getty&nbsp;-L&nbsp;ttyAMA0&nbsp;115200&nbsp;vt100</p>
<p>​...and edit the cmdline.txt file by changing the single line to;</p>
<p>dwc_otg.lpm_enable=0 console=tty1&nbsp;root=/dev/mmcblk0p2&nbsp;rootfstype=ext4&nbsp;elevator=deadline&nbsp;rootwait</p>
<p>&nbsp;</p>
<p>I suspect you have not done the first one or at least not rebooted since, for the change to take effect.&nbsp;</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-26029"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7401.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-7401.png" alt="Kokop&#039;s picture" title="Kokop&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Can't make new RFM12Pi start</h3>

    <div class="submitted">Submitted by <a href="../user/7401.html" title="View user profile.">Kokop</a> on Sun, 21/12/2014 - 11:02.</div>
    <div class="content">
     <p>Oh, that was the problem! As you suspected, I didn&#39;t comment out that line in the inittab file. In my defense I&#39;ll say I&#39;m using an existing raspbian install where I didn&#39;t want to make a new partition for the data (as the guide says), so I overlooked that bit.</p>
<p>
In short, it was my fault for not following the install steps. Now I can switch the RFM2Pi led on and off through minicom, so now I&#39;ll start to setup some TinyTx sensors around my home and put them in emoncms.</p>
<p>&nbsp;</p>
<p>Thanks for your help!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/6332"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-qW3AbeaVKRPOOOPQDBclAbJSuZIbQ4gta56zXcuiM_E" value="form-qW3AbeaVKRPOOOPQDBclAbJSuZIbQ4gta56zXcuiM_E"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
