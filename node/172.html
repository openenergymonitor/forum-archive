<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/172 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:32:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>New build | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">New build</h3>
        <span class="submitted">Submitted by Guest on Sun, 12/06/2011 - 21:07</span>
        <div class="content"><p>Hi,</p>
<p>I've put together a build based on openEnergyMonitor. The only changes are a variable gain amplplifier, controlled over SPI, so that the ful lADC range is used as much as possible across the current range, and a 1:1 isolating transfroer, so I&nbsp;can run the circuit from the same AC adapter as the voltage is sampled from. I've also added a pot so I&nbsp;can adjust the voltage at the ADC input without changing the code - and will probably do the same for the current as well.</p>
<p>It's currently outputing data, via a serial&lt;&gt;ethernet bridge, to here:</p>
<p><a href="http://energy.bbarker.co.uk/" title="http://energy.bbarker.co.uk">http://energy.bbarker.co.uk</a></p>
<p>With a photo of the (not very neat)&nbsp;veriboard here:&nbsp;</p>
<p><a href="http://www.flickr.com/photos/22415346@N06/5822031737/" title="http://www.flickr.com/photos/22415346@N06/5822031737/">http://www.flickr.com/photos/22415346@N06/5822031737/</a></p>
<p>&nbsp;</p>
<p>One thing I have noticed is that the measured voltage drops significantly under load - so for instance when the fridge turns on, the measured voltage drops by ~6 volts and the power factor drops. The end rsult is while there is an increase in apparent power, there is very little change in real power. Not sure how realistic this is - will need to leave it runing and compare against my electricity meter over a few days.</p>
<p>There also seems to be more noise than I would like on the voltage measurement. Not sure if this is down to the use of the isolating transformer....will need to look into it.&nbsp;</p>
<p>&nbsp;</p>
<p>Ben</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="187.html" class="topic-previous" title="Go to previous forum topic">‹ power monitor with LCD and SD for information storage</a>
              <a href="184.html" class="topic-next" title="Go to next forum topic">Condor SMPS For projects  ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-1848"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hardwic&#039;s picture" title="hardwic&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by hardwic (not verified) on Mon, 13/06/2011 - 12:45.</div>
    <div class="content">
     <p>Hi Ben</p>
<p>The voltage variation is interesting. I have not seen this even when using a welder or even worse a 8kw plasma.</p>
<p>Sure your PF will be affected which should give you variation in VA.</p>
<p>If the voltage is really dropping - you have a supply issues. Something like a loos connection or faulty breaker.</p>
<p>I see you had a 10kw spike today in you data and the voltage drops on both sides of this. So my guess is a loos connection that is also overheating. Or there is a measurement issue.</p>
<p>Clinton</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1849"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by Guest on Mon, 13/06/2011 - 12:50.</div>
    <div class="content">
     <p>Yes - I am a bit suspicious of that volt drop. </p>
<p>I'm going to check it this evening with a voltmeter on the mains. If it is some strangeness with my measurement circuit, I'll have to track it down. Scraping the barrel here, but it could be that a higher current draw is causing the bias voltage on my ADC to drift. But the AC<>AC adapter is on a spur straight from the consumer unit - and the fridge is on another. </p>
<p>Anyway - while it may be hard to fix, it should not be too hard to track down :-)</p>
<p>Ben</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1850"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hardwic&#039;s picture" title="hardwic&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by hardwic (not verified) on Mon, 13/06/2011 - 15:29.</div>
    <div class="content">
     <p>1 thing to check is your method of reading the ADC.</p>
<p>&nbsp;</p>
<p>If you are not correctly selecting the channel you could be reading values from another register.</p>
<p>&nbsp;</p>
<p>Otherwise the volt drop is real and there is a major problem but then you would find heats.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1851"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dbrb2&#039;s picture" title="dbrb2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by dbrb2 (not verified) on Mon, 13/06/2011 - 23:52.</div>
    <div class="content">
     <p>Ok....using my hoover as a test load - slightly easier to predict than a fridge pump for similar characteristics!</p>
<p>The house voltage stays stead as a rock when turned on. My circuit readout drops considerably.&nbsp;</p>
<p>It looks like the problem is with the MCP6S28 programmable gain amp. If I bypass it, all is fine - but without the gain.&nbsp;</p>
<p>Disconnecting the current sensing input to my ADC fixes the problem - voltage steady - but of course leaves me with no current readings :-)&nbsp;</p>
<p>Looking at the serial dumps, it looks like the voltage read at the ADC goes awry whenever the gain of the PGA changes. Not sure yet where the linkage is - since the current, which is certainly is (by design) affected by the PGA, works fine :-)</p>
<p>But looking at this thread:</p>
<p><a href="http://forums.adafruit.com/viewtopic.php?f=25&amp;t=11597">http://forums.adafruit.com/viewtopic.php?f=25&amp;t=11597</a></p>
<p>Looks like it may be relevant. The output of my isolating transformer is dropped down via a pot across a 1K resistor - less that the 10k output suggested by atmel. but considerably higher than the output impedance from my amp.&nbsp;</p>
<p>For the moment I've set the gain to 1 - which has reduced the resultuion of my current plots, but given me something like stability. I'll try to dig out an opamp this weekend and try a buffer for a nice low output impedance. &nbsp;</p>
<p>&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1854"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by Guest on Wed, 15/06/2011 - 18:03.</div>
    <div class="content">
     <p>Looking at your veroboard photo, I noticed that the prog gain amp is long way from the power supply section. Do you have suitable supply decoupling close to it?<br />
To quote from the data sheet:<br />
Use a 0.1 μF supply bypass capacitor within 0.1 inch<br />
(2.5 mm) of the VDD pin. It must connect directly to the<br />
ground plane. A multi-layer ceramic chip capacitor, or<br />
high-frequency equivalent, works best.</p>
<p>Do you have a sufficiently fast oscilloscope to see whether the amp is stable?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1857"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dbrb2&#039;s picture" title="dbrb2&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by dbrb2 (not verified) on Wed, 15/06/2011 - 22:42.</div>
    <div class="content">
     <p>&nbsp;Using the lab scope, the amp does appear stable - even if the veriboard is a bit of a mess! However, you ae right a bit of decoupling can't do any harm, and may help - I'll give it a go.&nbsp;</p>
<p>Since the isolaing transformer gives a slightly distored sine at the secondary (only designed for audio frequencies really)&nbsp;and the and in the inerests of making things as simple as possible while debugging, I've bypassed the transformer completely and powered the board from an independant supply from the AC sampling one.&nbsp;</p>
<p>I'll try to have some time to look into it again this weekend!</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1914"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hardwic&#039;s picture" title="hardwic&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by hardwic (not verified) on Tue, 05/07/2011 - 17:05.</div>
    <div class="content">
     <p>Not sure if I understand you correctly but it sounds like you are sampling your isolation transformer and also using the same feed to supply your circuitry.</p>
<p>This is not a good idea and you should sample from a 2 x secondary transformer.<br />
1 supplies the circuit, the other for sampling only. You should then get a good clean waveform.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1919"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by Guest on Thu, 07/07/2011 - 17:33.</div>
    <div class="content">
     <p>Yes - I took out that isolation 1:1 transformer, as it introduced all kinds of nasty harmonics. </p>
<p>I'm currently running off two seperate supplies, but am thinking of trying a chassis mount 230v<>9v transformer, with two secondaries. I could use one to get my AC waveform, the other my DC supply - after rectification and regulation - keeping things as compact as possible. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1935"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by Guest on Fri, 15/07/2011 - 16:56.</div>
    <div class="content">
     <p>You would probably do better to use two separate, smaller transformers (even if it costs a little more) The problem with a transformer with 2 secondaries is that the current in the coil providing the power supply is not constant throughout the mains cycle - it only flows while the instantaneous voltage is greater then that on the reservoir capacitor (+ a diode drop). </p>
<p>Of course this doesn't cause a resistive voltage drop in the other secondary, but it does cause a magnetic circuit drop and will still give some distortion. </p>
<p>Most transformers are designed so that copper and iron losses are about equal at the rated power, so using a big enough transformer will reduce this effect to a negligible size, but that's going to add weight, power and expense.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1936"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by Guest on Fri, 15/07/2011 - 18:50.</div>
    <div class="content">
     <p>You are right - two supplies is the best solution. </p>
<p>However, one supply is far more compact. I currently have it running here:</p>
<p><a href="http://bbarker.co.uk/energy" title="http://bbarker.co.uk/energy">http://bbarker.co.uk/energy</a></p>
<p><a href="http://www.flickr.com/photos/22415346@N06/" title="http://www.flickr.com/photos/22415346@N06/">http://www.flickr.com/photos/22415346@N06/</a></p>
<p>Running of a single kettle lead into a 9v dual secondary transformer - courtesy of a five pound note and a maplin store. </p>
<p>The sine wave is not perfect by any means, but neither is it terrible. </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1937"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by Guest on Fri, 15/07/2011 - 19:14.</div>
    <div class="content">
     <p>My compliments on a tidy, compact board.<br />
I think I can see some flattening of the top of the sinewave, but, as you say, it probably won't matter much.<br />
I tried a similar approach with a small, dual secondary transformer. It was OK with just the Arduino and a logger shield, but looked much worse when driving an LCD backlight (~150mA @5v), also the calibration appeared to drift with temperature</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1952"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="trunet&#039;s picture" title="trunet&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: New build</h3>

    <div class="submitted">Submitted by trunet (not verified) on Tue, 19/07/2011 - 00:11.</div>
    <div class="content">
     <p>&nbsp;Hi,</p>
<p>I created the page&nbsp;<a target="_blank" href="../energy-monitor-pcb-xbee-support.html">openenergymonitor.org/emon/energy-monitor-pcb-xbee-support</a>&nbsp;with a common and easy to use PCB.</p>
<p>Maybe you can add this 1:1 isolating transformer to the schematic or improve in other ways.</p>
<p>Thanks,</p>
<p>Wagner Sartori Junior</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/172"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-v5ROAaq6G83wJhu-e1oQis1m5fYbQNmo3MMOPedn8ek" value="form-v5ROAaq6G83wJhu-e1oQis1m5fYbQNmo3MMOPedn8ek"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
