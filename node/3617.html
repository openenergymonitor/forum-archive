<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3617 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:06:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Initial setup not working. --FIXED-- | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Initial setup not working. --FIXED--</h3>
        <span class="submitted">Submitted by <a href="../user/5261.html" title="View user profile.">Jasper</a> on Mon, 13/01/2014 - 21:49</span>
        <div class="content"><p>Actually, I&#39;m putting edit 6 up here: D&#39;oh! My test packet was sending out <em>byte</em>&nbsp;and emon only handles <em>int</em> and thinks a single byte is garbage nondata. That was <strong>bloody well</strong>&nbsp;everything that was going wrong, right from the start. &#39;Trap for young players&#39;, I guess Dave&#39;d say.</p>
<p>----------------------------</p>
<p>I am presumably missing something obvious, but I can&#39;t figure it out.</p>
<p>My hardware is currently, just at the proof-of-concept stage, one raspberry pi and 2 jeenodes. One jeenode, powered by a jee AA board, is running the jeelib/DIJN/test2 sketch and is blipping once a second with the current light level. The other jeenode&nbsp;is connected to the RPi&nbsp;using an FT232RL&nbsp;board (running at 3V3 logic and 5V&nbsp;on the VCC pin, into the 3V3 regulator).</p>
<p>I have loaded the Rpi-node&nbsp;with the rf12-demo firmware from the R12Pi. Both nodes are configured with 868 MHz and group 97, with the central node being 15 and the lightnode&nbsp;being 17.</p>
<p>&nbsp;</p>
<p><img alt="" src="../../../www.evernote.com/shard/s361/sh/0a53b512-590d-4397-93ed-cf9616613cf1/43ba897be67836291b02bfccb1735623/deep/0/Volumes---pi%40raspberrypi------ssh---135" style="width: 300px; height: 240px;" /></p>
<p>As you can see, the central node is quite happily receiving the data pings. I swept my hand over the LDR once or twice to prove it was getting real data. Next issue is getting the data into emoncms. That&#39;s where the snag is.</p>
<p>My Rpi is running (over the SD card and a 16G&nbsp;Lexar USB key -- it&#39;ll get a proper HDD eventually) the &quot;Raspberry Pi + Harddrive + Emoncms&quot;, with only a few mods. Because my data collection node is on ttyUSB0 rather than ttyAMA0, I changed all the occurrences of that in /var/www:</p>
<p><img alt="" src="../../../www.evernote.com/shard/s361/sh/184266fd-7aa1-4d1c-b5b7-04d500ad5424/883e619bd1c760197a968236528e6902/deep/0/Cursor-and-Volumes---pi%40raspberrypi---v" style="width: 700px; height: 133px;" /></p>
<p>I can&#39;t find anywhere else on the system that mentions ttyAMA, apart from /dev/xconsole.</p>
<p><img alt="" src="../../../www.evernote.com/shard/s361/sh/e57f0cc3-475f-49be-aba9-59df70bf163a/c8033c9de026cb2277313683e0d805b5/deep/0/skitch.png" /><img alt="" src="../../../www.evernote.com/shard/s361/sh/5bb634bb-0fbc-408d-8f04-536d4fddae09/fcf910375172f69ff486c8e37a152434/deep/0/skitch.png" /></p>
<p>And yet despite many reboots and hair-tearing I am not getting a working data feed, even though I must be *so* *close*.</p>
<p>&nbsp;</p>
<p>What am I missing?</p>
<p>&nbsp;</p>
<p>Edit: Okay, i forgot something I wanted to try. The jeenode is now hooked straight to the GPIO pins:</p>
<p><img alt="" src="../../../www.evernote.com/shard/s361/sh/e83c7381-c8c3-4ef0-8f99-f0f83b949d35/f50430aaa0cbe99d8b6b91e9b802751c/deep/0/Cursor-and-Volumes---pi%40raspberrypi---v" style="width: 700px; height: 318px;" /></p>
<p>Still no data. So presumably I&#39;m just making a beginner&#39;s mistake somewhere and it&#39;s actually much easier than all the stuff I&#39;ve been trying.</p>
<p>Edit2: Oh, _result_. Using the raspberry Pi rfm12&nbsp;to pi module/thingy on the webinterface&nbsp;if I change the node ID of the central node, the jeenode actually does change its node number. This confirms that emoncms is actually talking to the jeenode just fine. In fact if I&#39;m listening to ttyAMA0 on an ssh&nbsp;I can see emoncms&nbsp;pushing the 15i/17i/etc commands to the node. Now why is that input not updating....</p>
<p>Edit3: Aha -- apparently, even if you have a local setup, you have to fill in the &quot;forward data to remote server&quot; section. With 127.0.0.1. I still don&#39;t seem to be getting my node 17 feed coming through, though.</p>
<p>Edit4: Just to be safe, I tried forwarding to my emoncms&nbsp;account instead of local. No joy. AFAICT the code used in my test2&nbsp;sketch uses the same dataformat as an emontx, except with just one value that means little:</p>
<p>rf12_sendNow(0, &amp;value, 1);&nbsp;</p>
<p>vs:</p>
<p>rf12_sendNow(0, &amp;emontx, sizeof emontx);</p>
<p>I am gathering from more and more doc reading that data should just magically appear in Inputs, right? nobody seems to be telling anyone how to get it there, when using an rfm12pi setup.</p>
<p>Edit5: In desperation, I went with just the oemgateway setup now, and following the troubleshooting steps, I get what I had been suspecting for a while now:</p>
<p class="rteindent3">2014-01-14 12:37:24,961 INFO Serial RX:&nbsp; 17 152<br />
	2014-01-14 12:37:24,965 WARNING Misformed RX frame: [&#39;17&#39;, &#39;152&#39;]<br />
	2014-01-14 12:37:25,993 INFO Serial RX:&nbsp; 17 152<br />
	2014-01-14 12:37:25,996 WARNING Misformed RX frame: [&#39;17&#39;, &#39;152&#39;]<br />
	2014-01-14 12:37:27,024 INFO Serial RX:&nbsp; 17 152<br />
	2014-01-14 12:37:27,028 WARNING Misformed RX frame: [&#39;17&#39;, &#39;152&#39;]<br />
	2014-01-14 12:37:28,056 INFO Serial RX:&nbsp; 17 152<br />
	2014-01-14 12:37:28,059 WARNING Misformed RX frame: [&#39;17&#39;, &#39;152&#39;]<br />
	2014-01-14 12:37:29,087 INFO Serial RX:&nbsp; 17 152<br />
	&nbsp;</p>
<p>So, my data packets are the wrong format. Argh! if I&#39;d figured that out sooner that would&#39;ve saved me some testing there...</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3615.html" class="topic-previous" title="Go to previous forum topic">‹ Another newbie 3 phase question</a>
              <a href="3616.html" class="topic-next" title="Go to next forum topic">kWh/d and temperature/day in same bargraph? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
