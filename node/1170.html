<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/1170 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:09:00 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Full-fat 3-phase monitor | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Full-fat 3-phase monitor</h3>
        <span class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Sun, 14/10/2012 - 09:38</span>
        <div class="content"><p>Just got my 3-phase solar PV monitoring up and running...</p>
<p><img alt="3-phase monitor" src="../sites/default/files/3phase_s.jpg" style="width: 570px; height: 1094px;" /></p>
<p>The transmitter block consists of 3 stacked transmitter boards but only a single RF module...</p>
<p><img alt="3-phase tramsmitter" src="../sites/default/files/3phasetx.jpg" style="width: 768px; height: 512px;" /></p>
<p>The&nbsp;5V power, ground, SDA and SCK signals of the three&nbsp;boards are connected via stackable headers so no wires are&nbsp;required. The top board is the I2C master and it operates as normal, except that just before it starts a sampling cycle it sends a command to each of the slaves to initiate their sampling cycles. When the sampling is complete the master requests the results from the slaves and packages all the data into a single packet for transmission to the display.</p>
<p>Next stage is to divert excess energy into the immersion heater and electric underfloor storage heating - hence the big box!</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10154.html" class="topic-previous" title="Go to previous forum topic">‹ hardware setup for multiple sensors on Arduino</a>
              <a href="12218.html" class="topic-next" title="Go to next forum topic">Arduino 1.6.7 I2C LCD library character issue ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-6683"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 15/10/2012 - 14:53.</div>
    <div class="content">
     <p>Wow! Great work Martin. Also a very elegant hardware setup. Please could you share your code, I know many users will be interested in how you have implemented this.&nbsp;</p>
<p>Keep up the good work.&nbsp;</p>
<p>All the best,&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6686"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Mon, 15/10/2012 - 15:54.</div>
    <div class="content">
     <p>Thanks Glyn. Most of the elegance is due to your thoughtful PCB design. Being able to link the boards via I2C without wires made it a pleasure to build.</p>
<p>Here&#39;s the code for the master and slave transmitters...</p>
<p><a href="../sites/default/files/emonTx_CT123_Voltage_3phase_Master.html">http://openenergymonitor.org/emon/sites/default/files/emonTx_CT123_Voltage_3phase_Master.ino</a></p>
<p><a href="../sites/default/files/emonTx_CT123_Voltage_3phase_Slave.html">http://openenergymonitor.org/emon/sites/default/files/emonTx_CT123_Voltage_3phase_Slave.ino</a></p>
<p>I&#39;ve kept the data for the 3 phases separate so I could display them individually but they could easily be combined in the master to work with the standard display code.</p>
<p>-martin</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7169"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 11/11/2012 - 21:33.</div>
    <div class="content">
     <p>That&#39;s a very neat build, Martin, much tidier than anything so far of mine!&nbsp; I&#39;ll be most interested to see how your project develops on the power diversion front.&nbsp;</p>
<p>My first attempt to divert surplus PV power was based around the standard OEM V&amp;I sketch which measured the power that was flowing at our grid supply point.&nbsp; A professional AC controller (&pound;&pound;&pound;) was then periodically adjusted so as to achieve a balance between import and export.&nbsp; That system did work OK but with some significant limitations.&nbsp; Apart from the expense, its response time was poor, and it did not monitor power continuously.&nbsp; The controller also needed an additional power supply, 24Vac for the one I was using.</p>
<p>My Mk2 version has a completely different approach in that the code for measuring and distributing power is combined.&nbsp; Its operation is fully continuous and the response time is nigh on instantaneous.&nbsp; With a simple DIY output stage, the cost is also greatly reduced.&nbsp; What it does <em>not</em> do, however, is to communicate its operational status to any form of display.&nbsp; Several other people have devised ways of adding this kind of facility.&nbsp; Maybe you will be looking to do the same?</p>
<p>With a single-phase supply, the ideal state is when import and export are balanced.&nbsp; In this condition, there is no charge to the user and no energy is lost to the grid.&nbsp; I wonder how this works with a 3-phase setup? &nbsp; If two phases were in perfect balance, but the third was consuming some power, I presume you would be charged.&nbsp; Could that charge be avoided if some export were allowed to occur such that the net flow across all three phases was zero?&nbsp; This would require an interesting balancing act from some master entity, but I feel sure that such a scheme should be possible once the relevant criteria are known.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7181"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Mon, 12/11/2012 - 08:53.</div>
    <div class="content">
     <p>Thanks Robin.</p>
<p>Yes, I&rsquo;ve been following your thread with a great deal of interest. The video showing the disc-type meter just hunting around the zero position is a great demo of how well it works. You have a very neat solution there, the precise control it offers really appeals to me and I&rsquo;m definitely going to have a play with a version of it at some point.</p>
<p>In the meantime I have built something similar to your first version using a commercial 3kW controller. At &pound;87+vat it seemed good value as it&rsquo;s very well made and does include the auxiliary power supply....</p>
<p><img alt="" src="../sites/default/files/immersion_controller_open_0.jpg" /></p>
<p><img alt="" src="../sites/default/files/immersion_controller_closed_0.jpg" /></p>
<p>As you can see, I managed to squeeze an emontx into the case and a rubber-duck type aerial into a convenient hole in the top. This just listens to the normal transmissions from the monitor to see if there is any spare power on the phase used by the immersion and if there is it turns the heater on just enough to use it. Not ideal but it works reasonably well. The main problem is that the controller won&rsquo;t go below about 30% power, probably so it can meet the flicker specs. I&rsquo;ve re-programmed the PIC chip it uses to overcome this but obviously this invalidates the warranty and quite possibly the specs too.</p>
<p>I have been looking into improving the monitoring side as I&rsquo;m not happy with just peeking at the power every few seconds. At the moment I measure the power continuously for 3 seconds and then transmit the result, but ideally I&rsquo;d like to monitor the power continuously so I&rsquo;m looking into doing this with a timer interrupt - although I should probably check out what others have done first.</p>
<p>Interesting point you make about 3-phase metering. I wonder if the meter does use a single &ldquo;energy bucket&rdquo; for all 3-phases or if they are treated separately? At the moment I&rsquo;m just considering it as 3 separate supplies as everything in the house just runs off one of the 3 phases.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7184"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 12/11/2012 - 12:15.</div>
    <div class="content">
     <p>Thanks for the update, Martin.&nbsp; I see that your standard of workmanship remains in a league above mine!</p>
<p>Having no idea about how a 3-phase inverter operates, is there any chance of posting something here about this?&nbsp; Or maybe you could point me towards the spec for the inverter which your PV system uses.</p>
<p>This sounds to be a most interesting development, and it would be great if my Mk2 code could be adapted for efficient use in a 3-phase environment.&nbsp; But, for now, I can only guess at how these things might work, which is probably not very helpful to anyone.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7198"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Mon, 12/11/2012 - 19:52.</div>
    <div class="content">
     <p>I&#39;m no expert but I don&#39;t think there&#39;s anything special about 3-phase inverters. They&#39;re effectively just 3 inverters in one box with the solar power shared between the 3 outputs. This is the one I have...</p>
<p><a href="http://www.sma.de/en/products/solar-inverter-without-transformer/sunny-tripower-8000tl-10000tl-12000tl-15000tl-17000tl.html#Overview-9516">http://www.sma.de/en/products/solar-inverter-without-transformer/sunny-tripower-8000tl-10000tl-12000tl-15000tl-17000tl.html#Overview-9516</a></p>
<p>I&#39;m really curious to know how the meter works now though as it might be possible to transfer power between the phases by leaking it out on one phase and then sucking back on another. If the meter only looks at the total power it will see this as zero nett power.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7221"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 13/11/2012 - 00:22.</div>
    <div class="content">
     <p>I have two theories about how the meter works. Either or neither could be right:</p>
<ol>
<li>
		It emulates exactly the mechanical meter. This has 3 disks on the same shaft, the torques add so export on one phase can balance import on another to give nil movement.</li>
<li>
		It emulates 3 separate mechanical meters (each of which ignores export) and the power company that just totals the 3 numbers.</li>
</ol>
<p>I&#39;ve found data on one 3-phase meter that has a starting current of 15 mA (input current 5 A from a c.t.) which is the same value as for the equivalent single-phase version, which makes sense to me.</p>
<p>I would presume it does have a &#39;energy packet&#39; that could be taken advantage of, but how is it shared over the phases? It would be great if you could repeat Robin&#39;s experiments and find out.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7222"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1165.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="richmc&#039;s picture" title="richmc&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1165.html" title="View user profile.">richmc</a> on Tue, 13/11/2012 - 08:40.</div>
    <div class="content">
     <p>Interesting work Martin. I&#39;ll point Noah in this direction, he&#39;s experimenting with three phase dumping at the moment. I was a bit concerned about the proximity of the three 13A sockets with different phases on them I had a nasty experience with two industrial sized photocopiers powered on different phases, the neutral went missing and for some reason the chassis of both went live with me across them, but that was in Poland, where 240V drops to 210V for the first hour of the day when everyone makes their tea!</p>
<p>I was going to ask if that&#39;s an economy 7 tank with two heaters so you could use two phases, I&#39;m not sure if that would be legal though</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7223"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1372.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="noah&#039;s picture" title="noah&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1372.html" title="View user profile.">noah</a> on Tue, 13/11/2012 - 09:02.</div>
    <div class="content">
     <p>Re 13amp sockets. Ithink the rule is that they should be at least 1.5m apart.</p>
<p>I never said a thing.</p>
<p>Keep up the good work.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7226"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 13/11/2012 - 10:40.</div>
    <div class="content">
     <p>My, that video is grim.&nbsp; Good to know that no parameterizing is required :D</p>
<p>The spec for these inverters at <a href="http://www.sma-uk.com/en_UK/products/solar-inverters/sunny-tripower/sunny-tripower-8000tl-10000tl-12000tl-15000tl-17000tl.html">http://www.sma-uk.com/en_UK/products/solar-inverters/sunny-tripower/sunny-tripower-8000tl-10000tl-12000tl-15000tl-17000tl.html </a>&nbsp; doesn&#39;t appear to say much about the output, apart from it being three-phase.&nbsp; We really could do with establishing how PV power is distributed across these phases.&nbsp; If, for example, your immersion heater were to be turned fully on, would that reduce the PV power that&#39;s being fed to the other two phases?</p>
<p>Do you have a link for the 3-phase meter that you use?&nbsp; By studying its specification, someone may be able to deduce how it works ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7232"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Tue, 13/11/2012 - 13:40.</div>
    <div class="content">
     <p>mmm, hadn&#39;t thought about the dangers of having the sockets close together but I see the point - I guess that&#39;s why there are specs! Originally I intended to use DIN rail bell transformers, as they are much neater, but the waveform from all the ones I tried was awful.</p>
<p>They are pretty safe where they are, at ceiling height inside a cupboard, but I would like to obey the rules. Putting the sockets 1.5m apart isn&#39;t very practical so&nbsp;if I put the sockets and transformers inside a box would that be acceptable?</p>
<p>It is an Economy 7 tank but I plan to dump any excess power into the electric floor heating, which acts as a storage heater and normally comes on during the Economy 7 period, so there&#39;s no real need to power both immersion heaters.</p>
<p>Robin - the meter is an Ampy 5192J</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7238"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 13/11/2012 - 15:12.</div>
    <div class="content">
     <p><em>They are pretty safe where they are, at ceiling height inside a cupboard, but I would like to obey the rules. Putting the sockets 1.5m apart isn&#39;t very practical so&nbsp;if I put the sockets and transformers inside a box would that be acceptable?</em></p>
<p>They are clearly labelled with the phase colours, they are dedicated to a specific purpose and if you are confident that the sockets will not be used for things like portable tools, then it&#39;s hard to see where the danger is. I would certainly not have sockets on different phases in the same room, and especially in a kitchen, utility room or workshop. I tend to view &#39;rules&#39; as for the obedience of idiots and the guidance of wise men.&nbsp; You could most likely cover yourself with a simple label &quot;These sockets must only be used for Energy Monitor &quot;.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7252"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 13/11/2012 - 20:08.</div>
    <div class="content">
     <p>There&#39;s a spec for the Ampy 5192J meter <a href="http://universalmeterservices.co.uk/store/index.php?main_page=product_info&amp;products_id=54">here</a>, but it won&#39;t let me copy or save it :(</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7253"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Tue, 13/11/2012 - 21:57.</div>
    <div class="content">
     <p>Strange, I can do either.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7321"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1372.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="noah&#039;s picture" title="noah&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1372.html" title="View user profile.">noah</a> on Thu, 15/11/2012 - 18:56.</div>
    <div class="content">
     <p>Safe? Legal? Hey I`m the guy that connected an induction generator direct on line with no synchronisation. In my youth, of course.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7338"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 15/11/2012 - 23:49.</div>
    <div class="content">
     <p>I have a mate who won&#39;t let me forget that he and I once pushed two car batteries together in 69 formation - to see what would happen.&nbsp; With 24V and minimal resistance, there was a sizeable flash, and all four terminals were instantly scorched and mutilated.&nbsp; Needless to say, our Physics teacher was not amused ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7340"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 15/11/2012 - 23:57.</div>
    <div class="content">
     <p>You mean there were still terminals? ! ! !</p>
<p>When I was at Uni, a colleague would often tell of the day when in school physics, the teacher told a particular boy (not him - I think!) to measure the impedance of the mains. So the boy picked up an Avo multiminor, set it on ohms - &quot;and remember, it&#39;s a.c.&quot; - so he swapped the prods over and <em>then</em> stuck them into the mains socket...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7502"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/349.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-349.jpg" alt="EnergyRnR&#039;s picture" title="EnergyRnR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/349.html" title="View user profile.">EnergyRnR</a> on Wed, 21/11/2012 - 10:40.</div>
    <div class="content">
     <p>Did you get the pdf in the end? It downloaded ok for me [attached ; note it&#39;s for the 5192B]</p>
<p>Eamonn</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7504"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/349.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-349.jpg" alt="EnergyRnR&#039;s picture" title="EnergyRnR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/349.html" title="View user profile.">EnergyRnR</a> on Wed, 21/11/2012 - 10:53.</div>
    <div class="content">
     <p>I won&#39;t tell you about a colleague who made a metal desk live when we were training, to &#39;test&#39; a 30ma&nbsp;ELCB on one of us...... It worked, by the way - what a stupid thing to do!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-7512"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 21/11/2012 - 12:04.</div>
    <div class="content">
     <p><em>Did you get the pdf in the end? It downloaded ok for me [attached ; note it&#39;s for the 5192B]</em></p>
<p>Thanks.&nbsp; I&#39;ve always been able to download it, I just couldn&#39;t use the Save or Copy commands in Preview on my Mac.&nbsp; That file seems to be well protected, but its contents are visible to all.&nbsp; Sorry for any confusion.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8106"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2128.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jb79&#039;s picture" title="jb79&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Tue, 11/12/2012 - 17:21.</div>
    <div class="content">
     <p>Hello Martin!</p>
<p>I&#39;ve some questions about your system:</p>
<p>1.) Are SDA, SCL, GND and PWR (5V) all the connections that are needed between the EmonTx modules?</p>
<p>2.) Does every EmonTx have its own 3,3V regulator or is there only one on the master-board?</p>
<p>I&#39;m building a system similar to your&#39;s, measuring total power consumtion of the house, power consumtion of the heatpump (for hot water and heating the house) and the power of the photovoltaic installation I plan to install in a few years (about 8-8,5kW should be possible on the roof of my house).</p>
<p>I allready got most of the hardware, only some components (3,3V regulator, oscillator and ATmega for the 3rd EmonTX), 2 power supplys and the 6 CTs (orderd in China) are missing.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8109"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Tue, 11/12/2012 - 19:16.</div>
    <div class="content">
     <p>Hi jb79,</p>
<p>1) Yes, SDA,SCL, GND and PWR are all the connections you need. I left the reset pin in place too, mainly because I didn&#39;t want to cut any more pins off the headers than I had to, but it isn&#39;t required. Obviously if you do go for a single regulator you&#39;ll need the 3.3V pin too.</p>
<p>2) I used a 3.3V regulator on each board as I thought it would minimise noise since the 3.3V line is used as the ADC reference. They&#39;re cheap enough but the concept would work with a single regulator if you want to go that way.</p>
<p>Good luck with your project, it sounds interesting.</p>
<p>-martin</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8185"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2128.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jb79&#039;s picture" title="jb79&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/2128.html" title="View user profile.">jb79</a> on Fri, 14/12/2012 - 01:12.</div>
    <div class="content">
     <p>Hello again Martin,</p>
<p>I just installed the scripts on my 3 EmonTx boards and connected them together with the connections I posted 2 days before. The slave boards also share the 3,3V supply because I didn&#39;t have the voltage regulator here.</p>
<p>The one with the rf part gets the master script, on the others I installed the slave script (one with address 2, one with address 3).</p>
<p>First it seems to work but it looks like there are some problems. The system isn&#39;t running as smooth as I expected.</p>
<p>I often get 65535 values from the middle slave board and sometimes the green leds turn on for some seconds. For me it looks like the boards are performing a lot of reboots.</p>
<p>Did you insert pull up resistors to the I2C bus lines, if yes, what value did you use?</p>
<p>Maybe that causes my problems.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-8212"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Fri, 14/12/2012 - 16:43.</div>
    <div class="content">
     <p>I didn&#39;t use any extra pullup resistors, the internal weak pullups seem to be enough.</p>
<p>The code I used for the Wire interface is just taken from the examples in the Wire library.</p>
<p>It might be worth trying those to make sure your hardware setup is working ok.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9911"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 16/02/2013 - 19:43.</div>
    <div class="content">
     <p>hi... i know its has been a few months since last post but i&#39;m monkey&#39;ing arround with this one, have a few q&#39;s:</p>
<p>1. in the first post on the pic&#39;s each board has 2 jacks connected... is that 2 CS clamps on each phase or? ahould there not be only one?</p>
<p>2. in the code for the master it says:</p>
<pre>
Other files in project directory (should appear in the arduino tabs above)
	- emontx_lib.ino</pre><p>where do i get that one?</p>
<p>3. I want to add a water meter since it&#39;s within 1 meter from my fuse box... its a pulse type (reed switch activated by magnet in meter)... i guess its no problem but could i get a bit of help on that? i have tried to mix together some code here:</p>
<p style="margin-bottom: 0cm">/*</p>
<p style="margin-bottom: 0cm">EmonTx CT123 + Voltage example</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">An example sketch for the emontx module for CT only electricity monitoring.</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Part of the openenergymonitor.org project</p>
<p style="margin-bottom: 0cm">Licence: GNU GPL V3</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Authors: Glyn Hudson, Trystan Lea</p>
<p style="margin-bottom: 0cm">Builds upon JeeLabs RF12 library and Arduino</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">emonTx documentation: <a href="../modules/emontx/index.html" title="http://openenergymonitor.org/emon/modules/emontx/">http://openenergymonitor.org/emon/modules/emontx/</a></p>
<p style="margin-bottom: 0cm">emonTx firmware code explination: <a href="../modules/emontx/firmware.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware">http://openenergymonitor.org/emon/modules/emontx/firmware</a></p>
<p style="margin-bottom: 0cm">emonTx calibration instructions: <a href="../modules/emontx/firmware/calibration.html" title="http://openenergymonitor.org/emon/modules/emontx/firmware/calibration">http://openenergymonitor.org/emon/modules/emontx/firmware/calibration</a></p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">THIS SKETCH REQUIRES:</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Libraries in the standard arduino libraries folder:</p>
<p style="margin-bottom: 0cm">- JeeLib <a href="https://github.com/jcw/jeelib" title="https://github.com/jcw/jeelib">https://github.com/jcw/jeelib</a></p>
<p style="margin-bottom: 0cm">- EmonLib <a href="https://github.com/openenergymonitor/EmonLib.git" title="https://github.com/openenergymonitor/EmonLib.git">https://github.com/openenergymonitor/EmonLib.git</a></p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Other files in project directory (should appear in the arduino tabs above)</p>
<p style="margin-bottom: 0cm">- emontx_lib.ino</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Slave control for 3-phase added by Martin Roberts 14/10/12</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Pulse counter for Elster m100 Artist water meter by Bo Herrmannsen 16/02/13</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">*/</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">#define FVCAL 237 // default is 234.26</p>
<p style="margin-bottom: 0cm">#define FICAL 111.5 // default 111.1</p>
<p style="margin-bottom: 0cm">#define FPHASE 1 // default 1.7</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">#define FILTERSETTLETIME 5000 // Time (ms) to allow the filters to settle before sending data</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">//CT 1 is always enabled</p>
<p style="margin-bottom: 0cm">const int CT2 = 1; // Set to 1 to enable CT channel 2</p>
<p style="margin-bottom: 0cm">const int CT3 = 0; // Set to 1 to enable CT channel 3</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">#define freq RF12_433MHZ // Frequency of RF12B module can be RF12_433MHZ, RF12_868MHZ or RF12_915MHZ. You should use the one matching the module you have.433MHZ, RF12_868MHZ or RF12_915MHZ. You should use the one matching the module you have.</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">const int nodeID = 10; // emonTx RFM12B node ID</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">const int networkGroup = 210; // emonTx RFM12B wireless network group - needs to be same as emonBase and emonGLCD needs to be same as emonBase and emonGLCD</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">const int UNO = 1; // Set to 0 if your not using the UNO bootloader (i.e using Duemilanove) - All Atmega&#39;s shipped from OpenEnergyMonitor come with Arduino Uno bootloader</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">#include &lt;avr/wdt.h&gt; // the UNO bootloader</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">#include &lt;JeeLib.h&gt; // Download JeeLib: <a href="http://github.com/jcw/jeelib" title="http://github.com/jcw/jeelib">http://github.com/jcw/jeelib</a></p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">ISR(WDT_vect) { Sleepy::watchdogEvent(); }</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">#include &quot;EmonLib.h&quot;</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">EnergyMonitor ct1,ct2,ct3; // Create instances for each CT channel</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">#include &lt;Wire.h&gt;</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">typedef struct { int power1, power2, power3, Vrms; } PayloadTX; // neat way of packaging data for RF comms</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">PayloadTX emontx[3];</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">const int LEDpin = 9; // On-board emonTx LED</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">boolean settled = false;</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">//------------------------Water Start----------------------------</p>
<p style="margin-bottom: 0cm">long pulseCount = 0;</p>
<p style="margin-bottom: 0cm">unsigned long pulseTime,lastTime; // Used to measure time between pulses</p>
<p style="margin-bottom: 0cm">double power;</p>
<p style="margin-bottom: 0cm">int ppltr = 1; // Pulses per liter</p>
<p style="margin-bottom: 0cm">//------------------------Water End------------------------------</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Void setup()</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">Serial.begin(9600);</p>
<p style="margin-bottom: 0cm">Serial.println(&quot;emonTX CT123 Voltage example&quot;);</p>
<p style="margin-bottom: 0cm">Serial.println(&quot;OpenEnergyMonitor.org&quot;);</p>
<p style="margin-bottom: 0cm">Serial.print(&quot;Node: &quot;);</p>
<p style="margin-bottom: 0cm">Serial.print(nodeID);</p>
<p style="margin-bottom: 0cm">Serial.print(&quot; Freq: &quot;);</p>
<p style="margin-bottom: 0cm">if (freq == RF12_433MHZ) Serial.print(&quot;433Mhz&quot;);</p>
<p style="margin-bottom: 0cm">if (freq == RF12_868MHZ) Serial.print(&quot;868Mhz&quot;);</p>
<p style="margin-bottom: 0cm">if (freq == RF12_915MHZ) Serial.print(&quot;915Mhz&quot;);</p>
<p style="margin-bottom: 0cm">Serial.print(&quot; Network: &quot;);</p>
<p style="margin-bottom: 0cm">Serial.println(networkGroup);</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">ct1.voltageTX(FVCAL, FPHASE); // ct.voltageTX(calibration, phase_shift) - make sure to select correct calibration for AC-AC adapter <a href="../modules/index.html" title="http://openenergymonitor.org/emon/modules/">http://openenergymonitor.org/emon/modules/</a></p>
<p style="margin-bottom: 0cm">emontx/firmware/calibration</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">ct1.currentTX(1, FICAL);1 // Setup emonTX CT channel (channel (1,2 or 3), calibration)</p>
<p style="margin-bottom: 0cm">// CT Calibration factor = CT ratio / burden resistance</p>
<p style="margin-bottom: 0cm">ct2.voltageTX(FVCAL, FPHASE); // CT Calibration factor = (100A / 0.05A) x 18 Ohms</p>
<p style="margin-bottom: 0cm">ct2.currentTX(2, FICAL);</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">ct3.voltageTX(FVCAL, FPHASE);</p>
<p style="margin-bottom: 0cm">ct3.currentTX(3, FICAL);</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">rf12_initialize(nodeID, freq, networkGroup); // initialize RF</p>
<p style="margin-bottom: 0cm">//rf12_control(0xc657);</p>
<p style="margin-bottom: 0cm">// approx. 3.918kps, i.e. 10000/29(1+0x57) kps</p>
<p style="margin-bottom: 0cm">rf12_sleep(RF12_SLEEP);</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Wire.begin(); // join i2c bus (address optional for master)</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">pinMode(LEDpin, OUTPUT); // Setup indicator LED</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">digitalWrite(LEDpin, HIGH);</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">if (UNO) wdt_enable(WDTO_8S); // Enable anti crash (restart) watchdog if UNO bootloader is selected. Watchdog does not work with duemilanove</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">bootloader // Restarts emonTx if sketch hangs for more than 8s</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">//------------------------Water Start----------------------------</p>
<p style="margin-bottom: 0cm">// pulse detection interrupt (emontx pulse channel - IRQ0 D3)</p>
<p style="margin-bottom: 0cm">attachInterrupt(1, onPulse, FALLING);</p>
<p style="margin-bottom: 0cm">//------------------------Water End------------------------------</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">void loop()</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">pokeSlave(2); // start slave on phase 2</p>
<p style="margin-bottom: 0cm">pokeSlave(3); // start slave on phase 3</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">ct1.calcVI(20,2000); // Calculate all. No.of crossings, time-out</p>
<p style="margin-bottom: 0cm">emontx[0].power1 = ct1.realPower;</p>
<p style="margin-bottom: 0cm">Serial.print(emontx[0].power1);</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">emontx[0].Vrms = ct1.Vrms*100; // AC Mains rms voltage</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">if (CT2)</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">ct2.calcVI(20,2000); //ct.calcVI(number of crossings to sample, time out (ms) if no waveform is detected)</p>
<p style="margin-bottom: 0cm">emontx[0].power2 = ct2.realPower;</p>
<p style="margin-bottom: 0cm">Serial.print(&quot;\t&quot;); Serial.print(emontx[0].power2);</p>
<p style="margin-bottom: 0cm">//Serial.print(&quot;\t&quot;); Serial.print(ct2.Irms);</p>
<p style="margin-bottom: 0cm">//Serial.print(&quot;\t&quot;); Serial.print(ct2.powerFactor);</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">if (CT3)</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">ct3.calcVI(20,2000);</p>
<p style="margin-bottom: 0cm">emontx[0].power3 = ct3.realPower;</p>
<p style="margin-bottom: 0cm">Serial.print(&quot;\t&quot;); Serial.print(emontx[0].power3);</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">Serial.print(&quot;\t&quot;); Serial.print(ct1.Vrms);</p>
<p style="margin-bottom: 0cm">Serial.println(); delay(100);</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">// because millis() returns to zero after 50 days !</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">if (!settled &amp;&amp; millis() &gt; FILTERSETTLETIME) settled = true;</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">if (settled) // send data only after filters have settled</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">readSlave(2); // get data for phase 2</p>
<p style="margin-bottom: 0cm">readSlave(3); // get data for phase 3</p>
<p style="margin-bottom: 0cm">delay(100); // send_rf_data corrupts any pending Serial.prints so wait until they finish - need to find out why</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">send_rf_data(); // *SEND RF DATA* - see emontx_lib</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">digitalWrite(LEDpin, HIGH); delay(2); digitalWrite(LEDpin, LOW); // flash LED</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">emontx_sleep(5); // sleep or delay in seconds - see emontx_lib</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">else if (UNO) wdt_reset();</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">//------------------------Water Start----------------------------</p>
<p style="margin-bottom: 0cm">Serial.print(Water);</p>
<p style="margin-bottom: 0cm">Serial.print(&#39; &#39;);</p>
<p style="margin-bottom: 0cm">Serial.print(Liter);</p>
<p style="margin-bottom: 0cm">Serial.println(pulseCount * ppltr); // Liters used</p>
<p style="margin-bottom: 0cm">delay(1000);</p>
<p style="margin-bottom: 0cm">//------------------------Water End------------------------------</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">//------------------------Water Start----------------------------</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">//The interrupt routine &ndash; runs each time a falling edge of a pulse is detected</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">void onPulse()</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">lastTime = pulseTime;</p>
<p style="margin-bottom: 0cm">pulseTime = micros();</p>
<p style="margin-bottom: 0cm">pulseCount++; // count pulse</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">power = int((3600000000.0 / (pulseTime - lastTime))/ppltr); // calculate water</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">//------------------------Water End------------------------------</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">void pokeSlave(byte phase)</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">//Serial.print(&quot;Poking slave &quot;);</p>
<p style="margin-bottom: 0cm">//Serial.println(phase,DEC);</p>
<p style="margin-bottom: 0cm">Wire.beginTransmission(phase); // transmit to device slave</p>
<p style="margin-bottom: 0cm">Wire.write(0x5a); // send any data</p>
<p style="margin-bottom: 0cm">Wire.endTransmission(); // stop transmitting</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">void readSlave(byte phase)</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">byte *p;</p>
<p style="margin-bottom: 0cm">int i;</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">if((phase&lt;2)||(phase&gt;3)) return;</p>
<p style="margin-bottom: 0cm">p=(byte *)(&amp;emontx[phase-1]);</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">//Serial.print(&quot;Reading from slave &quot;);</p>
<p style="margin-bottom: 0cm">//Serial.println(phase,DEC);</p>
<p style="margin-bottom: 0cm">Wire.requestFrom(phase, sizeof emontx[0]); // request data from slave device</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p style="margin-bottom: 0cm">i=0;</p>
<p style="margin-bottom: 0cm">while(Wire.available()) // slave may send less than requested</p>
<p style="margin-bottom: 0cm">{</p>
<p style="margin-bottom: 0cm">p[i++] = Wire.read();</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">}</p>
<p style="margin-bottom: 0cm">&nbsp;</p>
<p>4. I also have a heat meter next to the water meter, it has an optical port... my knowledge on the emontx are very limited but does it have enough unused pins on the chip so that 1 serial port can be added? the hardware is very simple for the optical port.. 1 IR LED to send and one IR Receiver look at this pic</p>
<p><img alt="" src="../../../ing.dk/modules/xphoto/cache/47/58447_328_402_0_0_0_0.html" style="width: 328px; height: 402px;" /></p>
<p>Led 4 is the reciver...</p>
<p>4.5: i have the complete arduino code to read the heat meter... but would anybody help me integrate it? As far i know it it build to send the data to serial port. The code is here:</p>
<p>#include &lt;SoftwareSerial.h&gt;<br />
	#include &lt;OneWire.h&gt;</p>
<p>	// Kamstrup Multical 601<br />
	word const kregnums[] = { 0x003C,0x0050,0x0056,0x0057,0x0059,0x004a,0x0044,0x0045 };<br />
	char* kregstrings[]&nbsp;&nbsp; = { &quot;Energy&quot;,&quot;Current Power&quot;,&quot;Temperature t1&quot;,&quot;Temperature t2&quot;,&quot;Temperature diff&quot;, &quot;Flow&quot;, &quot;Volumen 1&quot;, &quot;Volumen 2&quot; };<br />
	#define NUMREGS 8<br />
	#define KAMBAUD 1200</p>
<p>	// Units<br />
	char*&nbsp; units[65] = {&quot;&quot;,&quot;Wh&quot;,&quot;kWh&quot;,&quot;MWh&quot;,&quot;GWh&quot;,&quot;j&quot;,&quot;kj&quot;,&quot;Mj&quot;,<br />
	&nbsp;&nbsp;&nbsp; &quot;Gj&quot;,&quot;Cal&quot;,&quot;kCal&quot;,&quot;Mcal&quot;,&quot;Gcal&quot;,&quot;varh&quot;,&quot;kvarh&quot;,&quot;Mvarh&quot;,&quot;Gvarh&quot;,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;VAh&quot;,&quot;kVAh&quot;,&quot;MVAh&quot;,&quot;GVAh&quot;,&quot;kW&quot;,&quot;kW&quot;,&quot;MW&quot;,&quot;GW&quot;,&quot;kvar&quot;,&quot;kvar&quot;,&quot;Mvar&quot;,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;Gvar&quot;,&quot;VA&quot;,&quot;kVA&quot;,&quot;MVA&quot;,&quot;GVA&quot;,&quot;V&quot;,&quot;A&quot;,&quot;kV&quot;,&quot;kA&quot;,&quot;C&quot;,&quot;K&quot;,&quot;l&quot;,&quot;m3&quot;,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;l/h&quot;,&quot;m3/h&quot;,&quot;m3xC&quot;,&quot;ton&quot;,&quot;ton/h&quot;,&quot;h&quot;,&quot;hh:mm:ss&quot;,&quot;yy:mm:dd&quot;,&quot;yyyy:mm:dd&quot;,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;mm:dd&quot;,&quot;&quot;,&quot;bar&quot;,&quot;RTC&quot;,&quot;ASCII&quot;,&quot;m3 x 10&quot;,&quot;ton x 10&quot;,&quot;GJ x 10&quot;,&quot;minutes&quot;,&quot;Bitfield&quot;,<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;s&quot;,&quot;ms&quot;,&quot;days&quot;,&quot;RTC-Q&quot;,&quot;Datetime&quot;};</p>
<p>	// Pin definitions<br />
	#define PIN_1WIRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4&nbsp; // 1-Wire bus<br />
	#define PIN_KAMSER_RX&nbsp; 6&nbsp; // Kamstrup IR interface RX<br />
	#define PIN_KAMSER_TX&nbsp; 7&nbsp; // Kamstrup IR interface TX<br />
	#define PIN_DIAG_LED&nbsp;&nbsp; 13 // Diag LED to blink with for fun</p>
<p>	// Kamstrup optical IR serial<br />
	#define KAMTIMEOUT 2000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Kamstrup timeout after transmit<br />
	#define POLLINTERVAL 300000&nbsp; // Polling interval<br />
	SoftwareSerial kamSer(PIN_KAMSER_RX, PIN_KAMSER_TX, true);&nbsp; // Initialize serial</p>
<p>	// 1-wire<br />
	byte ts_t[]&nbsp; = {0x28,0x14,0xA9,0xAA,0x03,0x00,0x00,0x0F};&nbsp; // Indoor temperature<br />
	OneWire ds(PIN_1WIRE);&nbsp; // Initialize 1-Wire</p>
<p>	// last poll variable<br />
	long lastpoll;</p>
<p>
	void setup() {<br />
	&nbsp; // setup pins<br />
	&nbsp; pinMode(PIN_DIAG_LED,OUTPUT);<br />
	&nbsp; pinMode(PIN_KAMSER_RX,INPUT);<br />
	&nbsp; pinMode(PIN_KAMSER_TX,OUTPUT);</p>
<p>	&nbsp; // initialize kamstrup serial interface<br />
	&nbsp; kamSer.begin(KAMBAUD);<br />
	&nbsp;<br />
	&nbsp; // initialize serial interface (connected to linksys router)<br />
	&nbsp; Serial.begin(9600);<br />
	&nbsp;<br />
	&nbsp; // initialize lastpoll value<br />
	&nbsp; lastpoll = 0;<br />
	}</p>
<p>	void loop() {</p>
<p>	&nbsp; // check if it is time to do a poll<br />
	&nbsp; if(millis() - lastpoll &gt; POLLINTERVAL or lastpoll == 0) {</p>
<p>	&nbsp;&nbsp;&nbsp; // get Kamstrup data from meter<br />
	&nbsp;&nbsp;&nbsp; for (int kreg = 0; kreg &lt; NUMREGS; kreg++) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kamReadReg(kreg);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delay(100);<br />
	&nbsp;&nbsp;&nbsp; }</p>
<p>	&nbsp;&nbsp;&nbsp; // get 1-wire temps<br />
	&nbsp;&nbsp;&nbsp; String t = gettemp_ds18b20(ts_t);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(t);</p>
<p>	&nbsp;&nbsp;&nbsp; // send a newline to have linksys process the data<br />
	&nbsp;&nbsp;&nbsp; Serial.println(&quot;&quot;);&nbsp;&nbsp;&nbsp;</p>
<p>	&nbsp;&nbsp;&nbsp; // update lastpoll<br />
	&nbsp;&nbsp;&nbsp; lastpoll = millis();<br />
	&nbsp; }</p>
<p>	&nbsp; // toggle LED to show we are alive<br />
	&nbsp; togglePin(PIN_DIAG_LED);<br />
	&nbsp;<br />
	&nbsp; // loop delay<br />
	&nbsp; delay(500);<br />
	&nbsp;<br />
	};</p>
<p>	// Toggle pin<br />
	void togglePin(int pinNum) {<br />
	&nbsp; digitalWrite(pinNum, !digitalRead(pinNum));<br />
	}</p>
<p>	// get temperature reading from 1wire sensor<br />
	String gettemp_ds18b20(byte addr[8]) {<br />
	&nbsp; byte i;<br />
	&nbsp; byte present = 0;<br />
	&nbsp; byte data[12];<br />
	&nbsp; int HighByte, LowByte, TReading, SignBit, Tc_100, Whole, Fract;<br />
	&nbsp; String value = &quot;&quot;;<br />
	&nbsp; ds.reset();<br />
	&nbsp; ds.select(addr);<br />
	&nbsp; ds.write(0x44,1);<br />
	&nbsp; delay(1000);<br />
	&nbsp; present = ds.reset();<br />
	&nbsp; ds.select(addr);&nbsp;&nbsp;&nbsp;<br />
	&nbsp; ds.write(0xBE);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Read Scratchpad<br />
	&nbsp; for ( i = 0; i &lt; 2; i++) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // we need 2 bytes<br />
	&nbsp;&nbsp;&nbsp; data[i] = ds.read();<br />
	&nbsp; }<br />
	&nbsp; // Convert to degrees celsius<br />
	&nbsp; LowByte = data[0];<br />
	&nbsp; HighByte = data[1];<br />
	&nbsp; TReading = (HighByte &lt;&lt; 8) + LowByte;<br />
	&nbsp; SignBit = TReading &amp; 0x8000;&nbsp; // test most sig bit<br />
	&nbsp; if (SignBit) // negative<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; TReading = (TReading ^ 0xffff) + 1; // 2&#39;s comp<br />
	&nbsp; }<br />
	&nbsp; Tc_100 = (6 * TReading) + TReading / 4;&nbsp;&nbsp;&nbsp; // multiply by (100 * 0.0625) or 6.25<br />
	&nbsp; Whole = Tc_100 / 100;&nbsp; // separate off the whole and fractional portions<br />
	&nbsp; Fract = Tc_100 % 100;<br />
	&nbsp; if (SignBit) // If its negative<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; value = &quot;-&quot;;<br />
	&nbsp; }<br />
	&nbsp; value += Whole;<br />
	&nbsp; value += &quot;.&quot;;<br />
	&nbsp; if (Fract &lt; 10)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; value += &quot;0&quot;;<br />
	&nbsp; }<br />
	&nbsp; value += Fract;<br />
	&nbsp; return value;<br />
	}</p>
<p>
	// kamReadReg - read a Kamstrup register<br />
	void kamReadReg(unsigned short kreg) {</p>
<p>	&nbsp; byte recvmsg[30];&nbsp; // buffer of bytes to hold the received data<br />
	&nbsp; float rval;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // this will hold the final value</p>
<p>	&nbsp; // prepare message to send and send it<br />
	&nbsp; byte sendmsg[] = { 0x3f, 0x10, 0x01, (kregnums[kreg] &gt;&gt; 8), (kregnums[kreg] &amp; 0xff) };<br />
	&nbsp; kamSend(sendmsg, 5);</p>
<p>	&nbsp; // listen if we get an answer<br />
	&nbsp; unsigned short rxnum = kamReceive(recvmsg);</p>
<p>	&nbsp; // check if number of received bytes &gt; 0<br />
	&nbsp; if(rxnum != 0){<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; // decode the received message<br />
	&nbsp;&nbsp;&nbsp; rval = kamDecode(kreg,recvmsg);<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; // print out received value to terminal<br />
	&nbsp;&nbsp;&nbsp; if (rval != false) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(rval);<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp; }<br />
	&nbsp;<br />
	&nbsp; Serial.print(&quot;,&quot;);</p>
<p>	}</p>
<p>	// kamSend - send data to Kamstrup meter<br />
	void kamSend(byte const *msg, int msgsize) {</p>
<p>	&nbsp; // append checksum bytes to message<br />
	&nbsp; byte newmsg[msgsize+2];<br />
	&nbsp; for (int i = 0; i &lt; msgsize; i++) { newmsg[i] = msg[i]; }<br />
	&nbsp; newmsg[msgsize++] = 0x00;<br />
	&nbsp; newmsg[msgsize++] = 0x00;<br />
	&nbsp; int c = crc_1021(newmsg, msgsize);<br />
	&nbsp; newmsg[msgsize-2] = (c &gt;&gt; 8);<br />
	&nbsp; newmsg[msgsize-1] = c &amp; 0xff;</p>
<p>	&nbsp; // build final transmit message - escape various bytes<br />
	&nbsp; byte txmsg[20] = { 0x80 };&nbsp;&nbsp; // prefix<br />
	&nbsp; int txsize = 1;<br />
	&nbsp; for (int i = 0; i &lt; msgsize; i++) {<br />
	&nbsp;&nbsp;&nbsp; if (newmsg[i] == 0x06 or newmsg[i] == 0x0d or newmsg[i] == 0x1b or newmsg[i] == 0x40 or newmsg[i] == 0x80) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; txmsg[txsize++] = 0x1b;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; txmsg[txsize++] = newmsg[i] ^ 0xff;<br />
	&nbsp;&nbsp;&nbsp; } else {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; txmsg[txsize++] = newmsg[i];<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp; }<br />
	&nbsp; txmsg[txsize++] = 0x0d;&nbsp; // EOF</p>
<p>	&nbsp; // send to serial interface<br />
	&nbsp; for (int x = 0; x &lt; txsize; x++) {<br />
	&nbsp;&nbsp;&nbsp; kamSer.write(txmsg[x]);<br />
	&nbsp; }</p>
<p>	}</p>
<p>	// kamReceive - receive bytes from Kamstrup meter<br />
	unsigned short kamReceive(byte recvmsg[]) {</p>
<p>	&nbsp; byte rxdata[50];&nbsp; // buffer to hold received data<br />
	&nbsp; unsigned long rxindex = 0;<br />
	&nbsp; unsigned long starttime = millis();<br />
	&nbsp;<br />
	&nbsp; kamSer.flush();&nbsp; // flush serial buffer - might contain noise</p>
<p>	&nbsp; byte r;<br />
	&nbsp;<br />
	&nbsp; // loop until EOL received or timeout<br />
	&nbsp; while(r != 0x0d){<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; // handle rx timeout<br />
	&nbsp;&nbsp;&nbsp; if(millis()-starttime &gt; KAMTIMEOUT) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 0;<br />
	&nbsp;&nbsp;&nbsp; }</p>
<p>	&nbsp;&nbsp;&nbsp; // handle incoming data<br />
	&nbsp;&nbsp;&nbsp; if (kamSer.available()) {</p>
<p>	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // receive byte<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r = kamSer.read();<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(r != 0x40) {&nbsp; // don&#39;t append if we see the start marker<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // append data<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rxdata[rxindex] = r;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rxindex++;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp; }</p>
<p>	&nbsp; // remove escape markers from received data<br />
	&nbsp; unsigned short j = 0;<br />
	&nbsp; for (unsigned short i = 0; i &lt; rxindex -1; i++) {<br />
	&nbsp;&nbsp;&nbsp; if (rxdata[i] == 0x1b) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; byte v = rxdata[i+1] ^ 0xff;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (v != 0x06 and v != 0x0d and v != 0x1b and v != 0x40 and v != 0x80){<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Missing escape &quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(v,HEX);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recvmsg[j] = v;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i++; // skip<br />
	&nbsp;&nbsp;&nbsp; } else {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; recvmsg[j] = rxdata[i];<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; j++;<br />
	&nbsp; }<br />
	&nbsp;<br />
	&nbsp; // check CRC<br />
	&nbsp; if (crc_1021(recvmsg,j)) {<br />
	&nbsp;&nbsp;&nbsp; Serial.println(&quot;CRC error: &quot;);<br />
	&nbsp;&nbsp;&nbsp; return 0;<br />
	&nbsp; }<br />
	&nbsp;<br />
	&nbsp; return j;<br />
	&nbsp;<br />
	}</p>
<p>	// kamDecode - decodes received data<br />
	float kamDecode(unsigned short const kreg, byte const *msg) {</p>
<p>	&nbsp; // skip if message is not valid<br />
	&nbsp; if (msg[0] != 0x3f or msg[1] != 0x10) {<br />
	&nbsp;&nbsp;&nbsp; return false;<br />
	&nbsp; }<br />
	&nbsp; if (msg[2] != (kregnums[kreg] &gt;&gt; 8) or msg[3] != (kregnums[kreg] &amp; 0xff)) {<br />
	&nbsp;&nbsp;&nbsp; return false;<br />
	&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp; // decode the mantissa<br />
	&nbsp; long x = 0;<br />
	&nbsp; for (int i = 0; i &lt; msg[5]; i++) {<br />
	&nbsp;&nbsp;&nbsp; x &lt;&lt;= 8;<br />
	&nbsp;&nbsp;&nbsp; x |= msg[i + 7];<br />
	&nbsp; }<br />
	&nbsp;<br />
	&nbsp; // decode the exponent<br />
	&nbsp; int i = msg[6] &amp; 0x3f;<br />
	&nbsp; if (msg[6] &amp; 0x40) {<br />
	&nbsp;&nbsp;&nbsp; i = -i;<br />
	&nbsp; };<br />
	&nbsp; float ifl = pow(10,i);<br />
	&nbsp; if (msg[6] &amp; 0x80) {<br />
	&nbsp;&nbsp;&nbsp; ifl = -ifl;<br />
	&nbsp; }</p>
<p>	&nbsp; // return final value<br />
	&nbsp; return (float )(x * ifl);</p>
<p>	}</p>
<p>	// crc_1021 - calculate crc16<br />
	long crc_1021(byte const *inmsg, unsigned int len){<br />
	&nbsp; long creg = 0x0000;<br />
	&nbsp; for(unsigned int i = 0; i &lt; len; i++) {<br />
	&nbsp;&nbsp;&nbsp; int mask = 0x80;<br />
	&nbsp;&nbsp;&nbsp; while(mask &gt; 0) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; creg &lt;&lt;= 1;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (inmsg[i] &amp; mask){<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; creg |= 1;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mask&gt;&gt;=1;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (creg &amp; 0x10000) {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; creg &amp;= 0xffff;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; creg ^= 0x1021;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp; }<br />
	&nbsp; return creg;<br />
	}<br />
	&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9912"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 16/02/2013 - 20:08.</div>
    <div class="content">
     <p>tried to compile and got a few errors... have an idea its a simple thing:</p>
<p>In file included from sketch_feb16b.cpp:58:<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:9: error: stray &#39;\302&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:9: error: stray &#39;\267&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:9: error: stray &#39;\302&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:9: error: stray &#39;\267&#39; in program<br />
	In file included from sketch_feb16b.cpp:58:<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:252:46: error: invalid suffix &quot;dc3202e9bd6dee29fbfadea040f592d&quot; on integer constant<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:253:62: error: invalid suffix &quot;dc3202e9bd6dee29fbfadea040f592d&quot; on integer constant<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:442: error: stray &#39;#&#39; in program<br />
	In file included from sketch_feb16b.cpp:62:<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:9: error: stray &#39;\302&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:9: error: stray &#39;\267&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:9: error: stray &#39;\302&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:9: error: stray &#39;\267&#39; in program<br />
	In file included from sketch_feb16b.cpp:62:<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:248:46: error: invalid suffix &quot;c7fa71f1de8d7c8a35f1c2056c669ff&quot; on integer constant<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:249:62: error: invalid suffix &quot;c7fa71f1de8d7c8a35f1c2056c669ff&quot; on integer constant<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:270: error: stray &#39;\342&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:270: error: stray &#39;\200&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:270: error: stray &#39;\246&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: stray &#39;#&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: stray &#39;#&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: stray &#39;#&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: stray &#39;#&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: stray &#39;#&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: stray &#39;#&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: stray &#39;#&#39; in program<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:489: error: stray &#39;#&#39; in program<br />
	sketch_feb16b:33: error: &#39;Void&#39; does not name a type<br />
	In file included from sketch_feb16b.cpp:58:<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:4: error: expected unqualified-id before &#39;&lt;&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:389: error: expected constructor, destructor, or type conversion before &#39;&lt;&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:421: error: expected constructor, destructor, or type conversion before &#39;&lt;&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:423: error: expected constructor, destructor, or type conversion before &#39;&lt;&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/JeeLib/JeeLib.h:430: error: expected unqualified-id before numeric constant<br />
	sketch_feb16b.cpp: In function &#39;void __vector_12()&#39;:<br />
	sketch_feb16b:53: error: &#39;Sleepy&#39; has not been declared<br />
	In file included from sketch_feb16b.cpp:62:<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h: At global scope:<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:4: error: expected unqualified-id before &#39;&lt;&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: expected constructor, destructor, or type conversion before &#39;;&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: expected unqualified-id before numeric constant<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: expected unqualified-id before &#39;=&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: expected constructor, destructor, or type conversion before &#39;.&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: expected unqualified-id before &#39;&lt;&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: expected constructor, destructor, or type conversion before &#39;.&#39; token<br />
	/Applications/Arduino101.app/Contents/Resources/Java/libraries/EmonLib/EmonLib.h:391: error: expected unqualified-id before &#39;&lt;&#39; token</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9921"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 17/02/2013 - 09:06.</div>
    <div class="content">
     <p>The newbie &quot;screwed up&quot; a bit... did crossposting and did not attach big files as attactment...</p>
<p>Only Q&#39;s left for here is why 2 jacks on each board...</p>
<p>The rest goes in my first thread: <a href="1974.html" title="http://openenergymonitor.org/emon/node/1974">http://openenergymonitor.org/emon/node/1974</a></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9927"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Sun, 17/02/2013 - 10:28.</div>
    <div class="content">
     <p>There are 2 CTs, and therefore 2 jacks used, for each phase because this is a solar PV setup. One CT measures the house supply current and the other measures the PV output.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9928"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 17/02/2013 - 10:34.</div>
    <div class="content">
     <p>dooh... of course...</p>
<p>i assume that i can use the code as it is now and just use one CT... but which one is for the house supply?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9929"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 17/02/2013 - 10:35.</div>
    <div class="content">
     <p>btw...</p>
<p>in your sketch i read this:</p>
<p><em>Other files in project directory (should appear in the arduino tabs above)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; - emontx_lib.ino</em></p>
<p>where do i get emontx_lib.ino ?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9932"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 17/02/2013 - 12:48.</div>
    <div class="content">
     <p>If I were looking an emonTx library file, I think would start here:</p>
<p><a href="../emontx.html">http://openenergymonitor.org/emon/emontx</a></p>
<p>and follow the Firmware link at the bottom of the page ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9934"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 17/02/2013 - 15:31.</div>
    <div class="content">
     <p>tried that... it was not here: <a href="https://github.com/openenergymonitor/EmonLib" title="https://github.com/openenergymonitor/EmonLib">https://github.com/openenergymonitor/EmonLib</a></p>
<p>here i found lots of them: <a href="https://github.com/openenergymonitor/emonTxFirmware" title="https://github.com/openenergymonitor/emonTxFirmware">https://github.com/openenergymonitor/emonTxFirmware</a></p>
<p>&nbsp;</p>
<p>but which one is the correct one to use? there are a bit differnt it seems</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9935"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sun, 17/02/2013 - 15:51.</div>
    <div class="content">
     <p>its not a library file as such in think... the file i miss ends in .ino and under firmware i find a lot...</p>
<p>&nbsp;</p>
<p>EDIT: just counted 6 copies of the file in the zip...</p>
<p>EDIT2: what jack are the in house supply?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9939"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 17/02/2013 - 16:35.</div>
    <div class="content">
     <p>Not having used this code myself, I don&#39;t know how everything is set up, but:</p>
<p>- are you sure that the name of the file you&#39;re looking for is correct?&nbsp;</p>
<p>- what is the problem that you&#39;re seeing when trying to compile the code that you wish to use?&nbsp;</p>
<p>- have you been able to compile the standard emonTx firmware?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-9942"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Sun, 17/02/2013 - 19:38.</div>
    <div class="content">
     <p><a href="../sites/default/files/emontx_lib.html">This is the emontx_lib&nbsp;file</a> I used originally. It&#39;s the one that came&nbsp;in the standard emonTx_CT123_Voltage folder in the emonTx firmware package. There&#39;s hardly anything in the file.</p>
<p>The CT1 jack is usually used for the house supply but they are both treated the same by the firmware. You just need to make sure that whatever you are using to receive the transmissions is using the data from the correct CT input.</p>
<p>As&nbsp;calypso_rae said, you should probably make sure the original files compile without problems before you start making changes.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-10493"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Fri, 15/03/2013 - 20:33.</div>
    <div class="content">
     <p>btw.... trying to understand the GLCD.... are you just using the standard examples or have you tweaked the code to display the different phases?</p>
<p>i would love to display then seperate but also an option to display combined would be nice</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13609"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="permeke&#039;s picture" title="permeke&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by permeke (not verified) on Sat, 13/07/2013 - 18:56.</div>
    <div class="content">
     <p>Hey Martin.&nbsp;</p>
<p>Newbie here and very intrigued by your project.</p>
<p>I wonder if I could use that as well as a power analyzer. ( a 3 phase Fluke costs well over 3000 euro)</p>
<p>I need to measure house mains power for fluctuations. Mostly 3 phase + neutral.</p>
<p>Voltage, not current.</p>
<p>thanks, Permeke</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-13618"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 14/07/2013 - 10:09.</div>
    <div class="content">
     <p>I am sure you could, but it does depend on what you expect. You are unlikely to be able to have real time harmonic analysis, for example, and while you should be able to capture one cycle of waveform for later analysis, the resolution (number of samples) will be less than the professional instrument, and of course without access to other highly accurate meters for calibration, the accuracy will be significantly lower too.</p>
<p>However, you will still have a useful tool that should help with diagnosing power problems in general. If you only want to see and record voltage fluctuations (and you are not too concerned with absolute accuracy), then you should have absolutely no difficulty. In fact, if all you want to do is record voltage fluctuations, you might not need 3 processors - it will be worth doing the maths regarding performance.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14727"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4288.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Wxll&#039;s picture" title="Wxll&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/4288.html" title="View user profile.">Wxll</a> on Sun, 01/09/2013 - 12:07.</div>
    <div class="content">
     <p>Hi Martin,</p>
<p>Thank you for sharing your project, I&#39;ve just enroled&nbsp;in OpenEnergyMonitor so pardon my n00b&nbsp;Q&#39;s</p>
<p>I&#39;m looking for a way to measure the same and use the&nbsp;divert excess energy ( or better say the energy left to use on my grid) for charging an electric car.</p>
<p>Q: Could anyone help me out with this beginners question, the &quot;stacking&quot; of these boards is that just as simple of adding the&nbsp;Stackable Header on the (correct place? which is?) on the boards and then push them together ?</p>
<p>Is there any information what size stackable header and where to place them on the boards?</p>
<p>Many thanks in advance,</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wxll</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14740"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 01/09/2013 - 21:15.</div>
    <div class="content">
     <p>Does this, the 3rd sentence in the top post, not tell you: &quot;The 5V power, ground, SDA and SCK signals of the three boards are connected via stackable headers so no wires are required.&quot;</p>
<p>You can identify these from the pcb layout and schematic on solderpad, or just look at the silk screen if you have a board. (The 5 V is labelled &quot;PWR&quot;)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14741"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4288.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Wxll&#039;s picture" title="Wxll&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/4288.html" title="View user profile.">Wxll</a> on Mon, 02/09/2013 - 00:01.</div>
    <div class="content">
     <p>Thanks!,</p>
<p>I saw that 3rd sentence however that did not make me feel that confident it was that simple, just connect up and switch on the power. The whole concept or stackable headers is new to me, like a Q in my head &quot;can you really pile up all the boards?&quot;, especially as data seems to go bidirectional as I understand from your posting on one wire and not like a serial cable. Just getting into this and did not work with any of these hardware lnks like the&nbsp;I2C lbefore.</p>
<p>I found the pins on the pictures :-)</p>
<p><img alt="Pin Layout" src="../../../content.screencast.com/users/Wesseldr/folders/Snagit/media/7b7c476b-99c3-4793-a464-dd3c9ce93b7b/2013-09-02_01-51-57.png" style="width: 638px; height: 378px;" /></p>
<p>Thanks for the confirmation that helped to get me started.</p>
<p>Wxll</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14742"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 02/09/2013 - 00:39.</div>
    <div class="content">
     <p>Many multi-drop bus systems work that way. There is often (not always) one &quot;controller&quot; that initiates proceedings, either by issuing a command to one or more slaves or requesting data from one named slave, then the slave that&#39;s been addressed responds. Each device usually listens before transmitting, and in many cases they also listen as they transmit so are capable of recognising a conflict on the bus (two transmitting at once) and can react accordingly.</p>
<p>There&#39;s plenty on the I<sup>2</sup>C bus that Google will find for you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14901"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2888.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/2888.html" title="View user profile.">Tinbum</a> on Fri, 06/09/2013 - 07:33.</div>
    <div class="content">
     <p>Martin,</p>
<p>This may seem a really dumb question but where did you get your standoffs from? I can&#39;t find any with a small enough thread size to go through the holes..</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14907"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3657.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3657.jpg" alt="Mattia Rossi&#039;s picture" title="Mattia Rossi&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3657.html" title="View user profile.">Mattia Rossi</a> on Fri, 06/09/2013 - 09:13.</div>
    <div class="content">
     <p>There are some hints in this thread:<br />
<a href="2407.html" title="http://openenergymonitor.org/emon/node/2407">http://openenergymonitor.org/emon/node/2407</a></p>
<p>I just bought some nylon standoffs from the ebay seller linked in that thread ...  price isn't cheap but much better than local stores ... my usual online seller doesn't stock them. M3 stuff is the smaller size they have. You want M2 standoffs </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14910"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2888.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/2888.html" title="View user profile.">Tinbum</a> on Fri, 06/09/2013 - 09:55.</div>
    <div class="content">
     <p>Thanks, good old eBay again!</p>
<p>(I do seem to have problems with items from Hong Kong etc not getting to me, though PayPal are normally good at giving refunds).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14918"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1824.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="MartinR&#039;s picture" title="MartinR&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/1824.html" title="View user profile.">MartinR</a> on Fri, 06/09/2013 - 13:27.</div>
    <div class="content">
     <p>The ones in the photo came from <a href="http://www.atomicengineering.co.uk/brass_stand_off_pillars-male.htm">Atomic Engineering</a> in the UK. The part number is BS-L12-TA-M2 (so 12mm long).</p>
<p>They have a minimum order of 100 though so you might be better of with the eBay ones. It might be a good idea for the shop to get a bunch&nbsp;in stock and offer them&nbsp;as an optional extra?</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14937"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2888.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/2888.html" title="View user profile.">Tinbum</a> on Fri, 06/09/2013 - 21:34.</div>
    <div class="content">
     <p>Thanks Martin.</p>
<p>I&#39;m struggling with your code a bit, I&#39;m new to sketches and can&#39;t find anything to explain this.</p>
<p>In your master you have;</p>
<p><em>typedef struct { int power1, power2, power3, Vrms; } PayloadTX;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // neat way of packaging data for RF comms<br />
	PayloadTX emontx[3];</em></p>
<p>Does this mean&nbsp;1 packet&nbsp;is sent with 3 parts,&nbsp;first the data for phase 1, then phase 2 and finally phase 3?</p>
<p>I&#39;ve been trying to receive the data with;</p>
<p><a href="https://github.com/openenergymonitor/RFM12B_Simple/tree/master/Rx_SimpleRFM12B_demo" title="https://github.com/openenergymonitor/RFM12B_Simple/tree/master/Rx_SimpleRFM12B_demo">https://github.com/openenergymonitor/RFM12B_Simple/tree/master/Rx_Simple...</a></p>
<p>and all&nbsp;I can get is phase 1.&nbsp;I&#39;ve tried&nbsp;different ways to modify it but&nbsp;I can&#39;t find any info on how&nbsp;to&nbsp;get the data for&nbsp;phases 2 and 3.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14938"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Fri, 06/09/2013 - 22:10.</div>
    <div class="content">
     <p>Here, emontx is an array of structs. That means the 3 sets of values for the 3 phases are stored in memory sequentially. This is all standard &#39;C&#39; language.</p>
<p>The rf library sends the one variable emontx as a continuous sequence of 24 bytes (2 bytes per integer x 4 integers per struct x 3 structs in the array).</p>
<p>The Rx_SimpleRFM12B_demo has the &quot;standard&quot; struct for the data and it reads only that. If you modify emontx in the receiving sketch to be the same as the sending end (as you quoted above), then you can access the 3 array elements, like &quot;phase3_Grid=emontx[2].power1&quot;. Read up on how the data is transferred <a href="https://learn.openenergymonitor.org/?redirect=rfm12b2">here</a>.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14940"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/2888.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Tinbum&#039;s picture" title="Tinbum&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/2888.html" title="View user profile.">Tinbum</a> on Fri, 06/09/2013 - 22:34.</div>
    <div class="content">
     <p>Thanks Robert,&nbsp;</p>
<p>I was looking at that link but now you&#39;ve pointed me in the right direction with the structure&nbsp;it makes much more sense.</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14941"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4241.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Zakke&#039;s picture" title="Zakke&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/4241.html" title="View user profile.">Zakke</a> on Sat, 07/09/2013 - 06:02.</div>
    <div class="content">
     <p>Is there any diversion projects going on with this stacked solution?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-14949"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4288.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Wxll&#039;s picture" title="Wxll&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/4288.html" title="View user profile.">Wxll</a> on Sat, 07/09/2013 - 14:07.</div>
    <div class="content">
     <p>+1 on that Zakke.</p>
<p>I&#39;ve the single version working now, and probably extend it to the stacked version later on.</p>
<p>&nbsp;</p>
<p>Wxll</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15004"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 10/09/2013 - 08:10.</div>
    <div class="content">
     <p>M2 nylon screws &amp; nuts are available at <a href="http://cgi.ebay.co.uk/ws/eBayISAPI.dll?ViewItem&amp;item=181156721645&amp;ssPageName=ADME:L:OC:GB:3160">http://cgi.ebay.co.uk/ws/eBayISAPI.dll?ViewItem&amp;item=181156721645&amp;ssPageName=ADME:L:OC:GB:3160</a></p>
<p>M2 spacers are not available from this source, but an M3 threaded spacer such as <a href="http://spiratronics.com/product-40357.html">http://spiratronics.com/product-40357.html</a> works nicely; its bore is just right for the M2 threaded screw to pass through.&nbsp;</p>
<p>(photo to follow, my disk quota on the forum has apparently been exceeded ...)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20728"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3149.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3149.jpg" alt="boelle&#039;s picture" title="boelle&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/3149.html" title="View user profile.">boelle</a> on Sat, 12/04/2014 - 19:38.</div>
    <div class="content">
     <p>have anyone made a 3d printed case for the stacked build?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20819"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6111.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mattfrazer&#039;s picture" title="mattfrazer&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/6111.html" title="View user profile.">mattfrazer</a> on Thu, 17/04/2014 - 15:52.</div>
    <div class="content">
     <p>I&#39;m glad I found this thread. My ideal setup would involve monitoring all the individual circuits in my panel in addition to the main panel input so stacking is very appealing. Do you know if the stacking could also be done with the emontx&nbsp;arduino shield? Is that why it is sold with stackable headers in the shop?</p>
<p>Thanks</p>
<p>-mjf</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20822"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 17/04/2014 - 16:50.</div>
    <div class="content">
     <p>I think you can not stack several shields - the analogue inputs on each shield would all be on the same pins on the Arduino PCB.</p>
<p>The stacked emonTx V2&#39;s work because stacking connects power supplies and the serial one-wire interface. It should be possible to interconnect emonTx V3&#39;s similarly but the physical stacking and interconnection arrangements need to be different.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39611"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8797.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="M0n0wall&#039;s picture" title="M0n0wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/8797.html" title="View user profile.">M0n0wall</a> on Sun, 21/02/2016 - 16:47.</div>
    <div class="content">
     <p>I am interested in something similar to monitor all of the circuits in my fuseboard. As these are EmonTx v2, is there a direct replacement to achieve what&#39;s pictured in Martins original post?</p>
<p>Was looking at the emonTx Arduino Shield and stacking, but I don&#39;t think its going to be possible.</p>
<p>Regards</p>
<p>Dave</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39658"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Full-fat 3-phase monitor</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 22/02/2016 - 20:19.</div>
    <div class="content">
     <p>It&#39;s definitely not possible to achieve this by stacking EmonTx Shields, you would need to stack pairs of Arduino plus Shield.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/1170"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-5KukJ6X_NQ3qRDV5sTNWC1QNjo-D_PoFMDuF_copK_g" value="form-5KukJ6X_NQ3qRDV5sTNWC1QNjo-D_PoFMDuF_copK_g"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
