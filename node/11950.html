<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11950 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:56:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Changing TX NodeID in software | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Changing TX NodeID in software</h3>
        <span class="submitted">Submitted by <a href="../user/8942.html" title="View user profile.">jasonnet</a> on Thu, 07/01/2016 - 06:04</span>
        <div class="content"><p>Hello.&nbsp;&nbsp; I received a emonTx 3.4.1 a few weeks ago programmed to node id 8.&nbsp;&nbsp; I&#39;m trying to modify the sketch (emonTx V3.4 Discrete Sampling V2.30 RFM69CW) to ignore the switch and use node id 9.&nbsp; &nbsp; The serial monitor seems to show that the emonTx is happy with this, but the emonBase isn&#39;t seeing this emonTx then.&nbsp;&nbsp; I can modify the sketch to specify node id 8 and the emonBase sees this emonTx without problems again.&nbsp;&nbsp; Restarting the emonBase hasn&#39;t helped.</p>
<p>What might be causing me to be unable to switch the node id of the emonTx?</p>
<p>I think I saw somewhere an explanation why recently shipped emonTx&#39;s use nodes 7/8 yet they used to ship as nodes 9/10 and the documentation speaks of only nodes 9/10.&nbsp;&nbsp;&nbsp; I&#39;ve not been able to find that information tonight though.&nbsp; Could someone point out the explanation?</p>
<p>Thanks.</p>
<p>&nbsp;</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11954.html" class="topic-previous" title="Go to previous forum topic">‹ emonTX plus USB plus batteries (as backup)</a>
              <a href="11164.html" class="topic-next" title="Go to next forum topic">audio extension cable for CT cables ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-37965"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Changing TX NodeID in software</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 07/01/2016 - 10:19.</div>
    <div class="content">
     <p>If you take out the lines that change the NodeID based on the switch selection, then the nodeID will be and remain as it was initialised when the variable was created. If you want to be really sure, change the definition to be "const", which will cause an error if the code subsequently tries to change it.</p>
<p>Then in emonHub, you edit the config file to create a section that responds to the new nodeID. If there isn't a section that defines how the data from a node will be handled, that node is ignored.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37980"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8942.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jasonnet&#039;s picture" title="jasonnet&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Changing TX NodeID in software</h3>

    <div class="submitted">Submitted by <a href="../user/8942.html" title="View user profile.">jasonnet</a> on Thu, 07/01/2016 - 16:20.</div>
    <div class="content">
     <p>Thanks.&nbsp; In my case the problem was my emonhub.conf file for node 9 listed old firmware string and old datacode string.&nbsp; Apparently emonhub will ignore the incoming transmission if ?one or both? of these are not set right.&nbsp; ( It wasn&#39;t even listing the ?ignored? node 9 transmission in the debug mode emonhub log.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37981"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Changing TX NodeID in software</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 07/01/2016 - 16:35.</div>
    <div class="content">
     <p>Yes, emonHub will ignore ANY inconsistency in the data. Unless you use the form that is common for each field (i.e. datacode =  in the singular) then the count for each must exactly match the number of data items sent.</p>
<p>I wrote this formal definition a few days ago, it's yet to be verified/approved by Paul (pb66), so don't rely on it being totally accurate:</p>
<p>[[10]]<br />
   A numeric NodeID. This identifies the node to emonHub, and every node within your system must have a unique ID. There may be only one definition for each NodeId. The NodeID is programmed into the node firmware, either in the sketch and/or by switches.</p>
<p>nodename =<br />
   A text string, for your benefit in identifying each node.</p>
<p>firmware =<br />
   A text string specifying the sketch running on the node. (At present, this is for information only. At some future time, it might be used to auto-configure emonHub and/or the sketch.)</p>
<p>hardware =<br />
   Indicates the host environment.</p>
<p>[[[rx]]]<br />
    Must be "rx"<br />
    "rx" - emonHub receives the data from this node.</p>
<p>names =<br />
   A comma-separated list of names identifying the meaning of the data values. There must be exactly one name for each item of data, and except where the short form is used, each name on the list must have a corresponding datacode, scale and unit specified.</p>
<p>datacodes =<br />
   A comma-separated list of code letters from the table. Each code letter must exactly match the corresponding data item sent by the node both in type and in its position within the list.<br />
   short form: If all data items are of the same type, "datacodes = [a list]" can be replaced by (for example) "datacode = h"<br />
   default: if nothing is specified, "datacode = h" is used. "datacodes = [a list]" will override "datacode = [one code]"</p>
<p>scales =<br />
   A comma-separated list of multipliers. The value received from the node is multiplied by this coefficient and passed forwards to emoncms for logging and display. e.g, a voltage received as the integer 23153 with a multiplier 0.01 is passed forwards as the floating point value 231.53  A value of 1 should be used when no scaling is to be applied.<br />
   short form: If all data items require the same multiplier, "scales = [a list]" can be replaced by (for example) "scale = 1"</p>
<p>units =<br />
   A comma-separated list of engineering units to describe the data. Common units are W, kW, V, A, C, %.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37991"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Changing TX NodeID in software</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Thu, 07/01/2016 - 19:10.</div>
    <div class="content">
     <p><em>&quot;If there isn&#39;t a section that defines how the data from a node will be handled, that node is ignored.&quot;</em></p>
<p>Actually it is the nodes module that ignores the data if there is no entry in emonhub.conf, emonhub&nbsp;will still process data without an entry in the [nodes] section of emonhub.conf, it will then publish and/or send that data to emoncms(s) but the nodes module will only process nodes that have an entry in emonhub.conf.</p>
<p>emonhub will not be able to pass data IF it has been specifically defined and the data received doesn&#39;t fit, the legacy method of processing all data using default values can be overridden by specifying the exact definition of the node, but if that is then not adhered to it will discard the packet as being &quot;wrong&quot; by the definition given.</p>
<p>&quot;<em>In my case the problem was my emonhub.conf file for node 9 listed old firmware string and old datacode string.&nbsp; Apparently emonhub will ignore the incoming transmission if ?one or both? of these are not set right.&nbsp; ( It wasn&#39;t even listing the ?ignored? node 9 transmission in the debug mode emonhub log.)&quot;</em></p>
<p>The firmware version is not used or even read by emonhub as yet (future feature) it is only read and displayed&nbsp;by the nodes module and it has no verification process. The datacode string will cause a packet to be discarded but it will provide details of that in the log, the scales should also provide a log entry if the packet gets discarded.The names and units are not used in emonhub and have no error checks.</p>
<p><em>&quot;emonHub will ignore ANY inconsistency in the data&quot;</em></p>
<p>This is the <em>appearance&nbsp;</em>and may even be true in some instances for the &quot;emonpi&quot; variant of emonhub,&nbsp;I haven&#39;t tried&nbsp;every scenario but, emonHub is (was?) designed NOT to impose any mandatory configuration requirements whilst providing the facility to do so if the user wishes or if the application demands. emonhub should also provide in-depth logging of all steps, under no circumstance should emonhub&nbsp;just &quot;ignore&quot; data and&nbsp;this is true in most instances as we know emonhub.logs are probably the most valuable asset we have when debugging an emonBase and traffic from connected nodes.</p>
<p>Robert - Most of those definitions seem like a pretty accurate current&nbsp;status. The important parts are the [[<em>node</em>]]&nbsp;which must be a unique section heading in the conf and currently, yes it is closely tied with the 1-31 node ids of the rfm2pi, but the node ids can relate to any interfacer&nbsp;and therefore could be any number since the 32 node limit has been changed in emoncms to be a count not a max node id. In fact the nodes in emoncms&nbsp;no longer even need to be numbers they can be names, emonhub&nbsp;does currently have some filtering&nbsp;to accommodate the&nbsp;&nbsp;1-31 rule but that can be removed when some node id to node name mapping is introduced.</p>
<p>And datacode(s), there&nbsp;is a basic check within emonhub to check the total data size if &quot;datacodes&quot; is provided so if a node of 2 longs is defined and a node of int,long,int is passed emonhub cannot tell the difference it is still 8 bytes, but the output will be very different to what is expected. So the important fact here is that the datacode array exactly matches the sketches typedef&nbsp;struct&nbsp;(payload).</p>
<p>If there are no datacode(s) defined then emonhub will use a default, this default can be set for the node in question by using datacode (no plural) in the nodes conf or if it is not defined there it will fall back to the interfacers default which is &#39;h&#39; for the commonly used rfm2pi interfacer, but it is &#39;0&#39; for the serial and socket interfacers.</p>
<p>Scales are not yet implemented in v1.2, but in the &quot;emonpi&quot; variant&nbsp;<span style="line-height: 16.64px;">scale(s) is pretty straight forward and&nbsp;</span><span style="line-height: 16.64px;">appl</span><span style="line-height: 16.64px;">ies</span><span style="line-height: 16.64px;">&nbsp;the same scale vs scales&nbsp;</span><span style="line-height: 16.64px;">logic but the validation is done on the number of scales&nbsp;</span><span style="line-height: 16.64px;">equaling</span><span style="line-height: 16.64px;">&nbsp;the number of decoded values rather than total (data)size.</span></p>
<p>The rest is pretty much (currently) eye candy for the nodes module and have no checks in emonhub, for the data to be displayed correctly in the nodes module though you would need to ensure each values datacode, scale, name and unit all align.&nbsp;</p>
<p>The [[[rx]]] is only used in the &quot;emonpi&quot; version, the original version has the datacodes in the [[<em>node</em>]]&nbsp;section.&nbsp;and to me the [[[tx]]] and [[[rx]]] do actually seem the wrong way round, since we are defining &quot;the node&quot; and the nodes &quot;tx&quot; payload definition is labeled&nbsp;&quot;rx&quot;, ie from emonhub&#39;s&nbsp;position not the nodes position. This may well be changed in v2 as part of a larger overhaul as the whole [nodes] section is under re-evaluation.</p>
<p>Paul.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-37997"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8942.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="jasonnet&#039;s picture" title="jasonnet&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Changing TX NodeID in software</h3>

    <div class="submitted">Submitted by <a href="../user/8942.html" title="View user profile.">jasonnet</a> on Thu, 07/01/2016 - 20:17.</div>
    <div class="content">
     <p>Robert, I like that you describe how a field is used.&nbsp; Perhaps you could also indicate how the units field is or might eventually be used?</p>
<p>Anyway, it will be good to have a document like this.</p>
<p>Thanks!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11950"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-4qJDaTUKUzQ2b8HaIu4q-jr7wak9GDSXjG7oVq8WFZY" value="form-4qJDaTUKUzQ2b8HaIu4q-jr7wak9GDSXjG7oVq8WFZY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/11950 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:56:08 GMT -->
</html>
