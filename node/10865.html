<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10865 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 13:42:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Using an Emontx V3.4 as a MK2 PV Router with phase angle control | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>
        <span class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Wed, 17/06/2015 - 09:39</span>
        <div class="content"><p>Hi,<br />
I&#39;m a French user of an MK2 system, the good way for me after lot of tests is the Phase angle control, which is suitable with my import energy meter.</p>
<p>The original sketch works fine, but I have to add options, which are causing that a modified sketch could not work good, because it&#39;s take too much time.<br />
In the options that I need, there is a temp sensor (DS18B20) and serial datalog (and other tools but not important),<br />
so with good Robin&#39;s advices, it seems that Emontx_as_MK2Router is the sketch the most suitable.</p>
<p>The problem is that I&#39;m not&nbsp; familiar with arduino code (that&#39;s very a big problem, i know), and I have to add the Phase_Angle control in that sketch.<br />
For the moment, that&#39;s not work because:<br />
- I don&#39;t really know where add the different parts of PA control, without disturbing the rest of code<br />
- the &quot;energyInBucket&quot; is now a &quot;long&quot;, so, the algorithm has to be adapted</p>
<p>I will take care of my options later, but yet, I can not run it properly.<br />
Your advices are welcome<br />
Thanks,<br />
Franck</p>
  <div class="forum-topic-navigation clear-block">
          <a href="11771.html" class="topic-previous" title="Go to previous forum topic">‹ avrdude: stk500_recv(): programmer is not responding</a>
              <a href="10865.html" class="topic-next" title="Go to next forum topic">Using an Emontx V3.4 as a MK2 PV Router with phase angle control ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31771"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Sun, 28/06/2015 - 19:05.</div>
    <div class="content">
     <p>Hi,</p>
<p>I suppose that i&#39;m alone to use phase-angle control,<br />
that explain i&#39;m alone on that thread.,<br />
I didn&#39;t have time to go really deep, but i have tried some tests without success.<br />
The originally sketch is running since few time, and the analysis shows me that 75 to 90% of surplus power is diverted, without import power when the system is running.<br />
Today i have only 1Kwc PV power, so there not lot of surplus power, but (if everything is ok) i will get 2.5Kwc next month.</p>
<p>I continue to learn and trying, i hope to find.</p>
<p>Franck</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31773"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 28/06/2015 - 23:06.</div>
    <div class="content">
     <p>I think phase angle control is unpopular because expensive filters are likely to be needed to meet the rules concerning the injection of harmonic currents into the public electricity supply.</p>
<p>I cannot remember now, are you trying to convert Robin's later sketch or are you working with his Phase Angle sketch <a href="../sites/default/files/Mk2_PV_phaseAngle.ino_.zip">Mk2_PV_phaseAngle</a>?</p>
<p>If you have not tried the phase angle sketch, I suggest you try that and see if and how it works for you, then develop it and change it to suit your needs. </p>
<p>You do know that you need to change the opto-trigger I.C. from the zero-crossing type to the random phase (non-zero crossing) type? (MOC30XX family - probably the MOC 3021, 22 or 23. The difference between the three is the sensitivity, therefore the current needed to drive it and hence the value of the current-limiting resistor between the output pin and the opto-trigger input.)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31780"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Mon, 29/06/2015 - 07:29.</div>
    <div class="content">
     <p>Hi Robert,</p>
<p>My MK2 is running with phase-angle sketch, but i need to send serial data and checking a temperature sensor. In that sketch, if i&nbsp; modify the originally sketch, it&#39;s cause to much work in the loop and is not efficient anymore.</p>
<p>With Robin advices, the Emontx3_4_as_MK2Router sketch is more suitable, because the options I need, are there.<br />
What i&#39;m trying to do is using that sketch but in phase-angle way.</p>
<p>For the output hardware, I &#39;m using the moc3021+triac (trigger is active high, because I&#39;ve made a mistake on my PCB design, but it works fine)<br />
There is also another output which can driver an SSR (D2425), it&#39; like a moc3041+triac.<br />
That give me the possibility to use different ways, (phase-angle control or burst)<br />
but for the moment, only the phase-angle control seems suitable with my import energy meter.</p>
<p>Franck</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31948"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Sun, 05/07/2015 - 18:28.</div>
    <div class="content">
     <p>Hi,</p>
<p>to be sure, i have made new test today in burst mode (with change the moc)<br />
results are the same as before, balancing correctly, but import and export energy meters increment one after the other, it&#39;s not the case in phase-angle control.</p>
<p>I have made that tests to be sure i was not mistaken before.<br />
So, the phase-angle control is really the way to do for me.</p>
<p>I must find a way to update a sketch, with temp sensor (for activate an onboard fan) and a s&eacute;rial datalog for energy diverted....the most important.</p>
<p>I understand that that way of work is not a priority in UK, maybe energy meters are defferents, in my case, it is not a choice.<br />
But i don&#39;t have enough competence, so i&#39;m learning.<br />
Franck</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31950"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 05/07/2015 - 20:19.</div>
    <div class="content">
     <p>I quickly looked at Robin's phase angle sketch. That is not the best place to start. You will find it much better if you start with one of the later burst mode sketches that use interrupts and have the temperature measurements in the main loop and away from the time-critical Interrupt Service Routine (ISR). What needs to be done - confirmed by Robin - is you should take that and remove the burst-mode section and replace it with the phase angle section from the earlier phase-angle sketch.</p>
<p>The serial communications also needs to go in the main loop.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31955"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 05/07/2015 - 21:33.</div>
    <div class="content">
     <p>Franck, for customers that are using hardware from my <a href="http://mk2pvrouter.co.uk/13779.html">Shop</a> , I am generally willing to provide software that has been modified to meet the customer&#39;s requirements.&nbsp; This could include phase-angle control as well as temperature monitoring, RF datalogging, Serial etc.&nbsp;</p>
<p>All of my code is freely available for forum members to use and modify, but I am not able to produce special versions for the emonTx on request for free.&nbsp; I&#39;m sure you will understand.&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31971"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Mon, 06/07/2015 - 07:22.</div>
    <div class="content">
     <p>Yes Robert, it&#39;s what i&#39;m trying to do with the Emontx3-4-asMK2 sketch.</p>
<p>
Robin, i understand what you mean, of course, but i didn&#39;t ask you to write a special sketch for me.<br />
What i need is some advices to start well.</p>
<p>
As i said before, i&#39;m not familiar with&nbsp;arduino, but it&#39;s motivating.<br />
I will try again this week.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32019"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Tue, 07/07/2015 - 19:47.</div>
    <div class="content">
     <p>Hi</p>
<p>i&#39;ve made other tests today, I think that is the algorithm which not work.<br />
I have tried, but i don&#39;t understand, whatever i&#39;ve done ( in this algorithm) and whatever power avaible, it did divert around 666W/h ....(is it the devil in my MK2)</p>
<p>In originally Phase_Angle control, there is also this Data &quot;firstLoopOfHalfCycle&quot; which i could have not placed properly. It may cause troubles.</p>
<p>What is take my mind is the algorithm :<br />
In the original Phase_Angle sketch, we got :</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (energyInBucket &lt;= 1300) { firingDelayInMicros = 99999;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (energyInBucket &gt;= 2300) { firingDelayInMicros = 0;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // complex algorithm which reflects the non-linear nature of phase-angle control. &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; firingDelayInMicros =(asin((-1 * (energyInBucket - 1800) / 500)) + (PI/2)) * (10000/PI);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (firingDelayInMicros &gt; 8500) { firingDelayInMicros = 99999;} // never fire</p>
<p>In the later sketches, the &quot;energyInBucket&quot; is became a long, so :</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (energyInBucket_ long&lt;= 1300L) { firingDelayInMicros = 99999;}<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (energyInBucket_long &gt;= 2300L) { firingDelayInMicros = 0;}</p>
<p>I hope that point is correct for for the thresholds! maybe not, but this part, disturb me with the algorithm!</p>
<p>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp; &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // complex algorithm which reflects the non-linear nature of phase-angle control. &nbsp;<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; firingDelayInMicros =(asin((-1 * (energyInBucket_long - 1800) / 500)) + (PI/2)) * (10000/PI);</p>
<p>I&#39;ve done many way to adapt it, (i mean with (long) or L) nothing has worked properly</p>
<p>I think my problem is at this point.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32032"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 07/07/2015 - 22:06.</div>
    <div class="content">
     <p>You may be suffering integer truncation.</p>
<p>If energyInBucket is a float or an integer, <i>(-1 * (energyInBucket - 1800)</i> will be the same type (a float or an integer). However, when you divide that by 500, if it was a float (which it was), it will divide OK, but if it is an integer, then the result of the division will be truncated to an integer (towards zero I think). From there on, you are working with the wrong number so everything is wrong. The easiest way to correct this is to force it to be a float by making it <i>(-1<b>.0</b> * (energyInBucket - 1800)</i>. When you do that, <i>(energyInBucket - 1800)</i> is done as integers but the <i><b>-1.0</b></i>, being a float, forces the result of the subtraction to be promoted to a float and the division and the rest of the arithmetic should work as expected.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32035"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 07/07/2015 - 22:26.</div>
    <div class="content">
     <p><em>In the later sketches, the &quot;energyInBucket&quot; is became a long, so :</em></p>
<p><em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (energyInBucket_ long&lt;= 1300L) { firingDelayInMicros = 99999;}</em></p>
<p>No, that won&#39;t work.&nbsp; In the later sketches, the value in the energy bucket is not a &quot;float&quot; within the range 0 - 3600.&nbsp; Instead, it is a much larger &quot;long&quot; value using integer maths on a scale which reflects various factors including powerCal which is different for each hardware platform.</p>
<p>So, you won&#39;t want to set the phase-angle operating limit to 1300L.&nbsp; Instead, you will want to set it to the equivalent value in Integer Energy Units (IEU).&nbsp; In the code that you&#39;re using, a conversion variable will probably have been defined in <em>setup()</em>, something like IEU_per_Joule.&nbsp; So you would set the limit to 1300 *&nbsp;IEU_per_Joule.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32036"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 07/07/2015 - 22:47.</div>
    <div class="content">
     <p>The reason for the complicated maths is because the graph of power against firing angle is an "S"-curve, the object is to straighten out the "S" so that the relationship between power and the energy bucket is closer to linear.</p>
<p>The complicated answer is the changing slope of the "S" represents a change in the loop gain, which could result in instability with operating point oscillating about the desired diverted power.</p>
<p>You need both my change and Robin's.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32042"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Wed, 08/07/2015 - 06:06.</div>
    <div class="content">
     <p>Thanks you guys, for explanations,</p>
<p>I understand the range problem, so i think i have to adapt it within range of capacity of energy bucket, maybe like that :<br />
if (energyInBucket_ long&lt;= 1300* CYCLES_PER_SECOND * (1/powerCal_grid)) { firingDelayInMicros = 99999;}</p>
<p>The algorithm must be also adapted with the range. Is it correct?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32066"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Wed, 08/07/2015 - 20:31.</div>
    <div class="content">
     <p>Both changes seems working,<br />
and pass the 60w bulb test (pv simulation)<br />
Test in real power tomorrow, i hope.<br />
If everything is ok for few days, I&#39;ll post the code, maybe someone else could be interested.</p>
<p>
Thank again , Robin and Robert for your advices which always make me going on good way</p>
<p>
After that , i could work on my options, that is another story:<br />
- one of option is reading a 50khz signal from the French energy meters (it&#39;s call &quot;T&eacute;l&eacute;info&quot;) it is a trame which is send to client, the most important are the indexes from the energy meter. So this tool will take the indexes and transmit them to serial datalog.<br />
This hardware input is done with a SFH620.<br />
- drive a fan for the triac heatsink, with the temp sensor (my MK2 is in rail din boxe)<br />
- datalog on temp, indexes, and total energy diverted, so no need to transmit more than one sending per minutes<br />
- maybe, receive data from serial, to activate an output, for example</p>
<p>It is my project, and it&#39;s why my hardware is a little different.</p>
<p>Franck</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32080"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 10/07/2015 - 21:53.</div>
    <div class="content">
     <p>Here is a modified version of <em>emonTxV3_4_as_Mk2Router</em> which operates with phase-angle control.&nbsp; The relevant code for the p-a control section is exactly as was posted in 2012.&nbsp;</p>
<p>The p-a logic has been written with floating-point maths, but later versions of my Mk2 PV Router code all use integer maths for speed.&nbsp; To overcome this mismatch, the content of the energy bucket is re-scaled to Joules before the p-a logic is applied at the start every mains cycle.&nbsp;</p>
<p>To maximise the sampling rate, the ADC operates in free-running mode.&nbsp; With 5 analog channels on the go, each set of samples takes approx 5 * 104 us = 520 us to complete.&nbsp; During each 50 Hz mains cycle, the expected number of sample sets will be 20 ms / 520 us = 38.46.&nbsp; By monitoring the minimum number of sample sets per mains cycle, any <s>lost</s> <strong>loss of</strong> data should be detected.&nbsp; This value, as displayed at the Serial Monitor, has never dropped below 38.</p>
<p>The attached results file shows the system operating with various combinations of load and surplus power.&nbsp; In unchanging conditions, the energy state is constrained very effectively by the p-a control mechanism, generally to within a range of around 10 Joules.&nbsp; As conditions vary, the control mechanism finds its own balance point at a new part of the energy profile.&nbsp; The phase-angle control mechanism operates over an energy range of 1000 Joules.&nbsp; Beyond this range, the load is either fully on or fully off.&nbsp; It may be possible for this range to be considerably reduced - I have not tried to do this.</p>
<p>As with the original version, relevant data for power, energy, temperature and Vrms are transmitted by RF every 5 seconds.&nbsp; These values are also displayed at the Serial Monitor along with the <em>minNoOfSampleSetsPerMC </em>data.&nbsp; Because most of the action takes place within the ISR and its helper functions, Serial statements may only be used in a few sections of this code.&nbsp; <em>Loop()</em> is always a safe place for Serial statements.</p>
<p>When operating in p-a mode, there is a slight buzzing sound from the load, just as with a dimmable light.&nbsp; Suitable filtering is recommended.</p>
<p>For supply meters that have minimal tolerance to reciprocating flows of energy, the phase-angle control version may have advantages over burst-mode alternatives.&nbsp; I would be very interested to hear of any situations where only the p-a control version is suitable for diverting surplus power.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32096"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Fri, 10/07/2015 - 10:40.</div>
    <div class="content">
     <p>Happy to see your new sketch, Robin. Thank for your interest.<br />
It could help someone else, like me, when the burst mode is not suitable with the meters.</p>
<p>
Mine has well done yesterday ( today too) and seems work better than the original old one.<br />
I&#39;ll test your&#39;s, this week-end, it &#39;s very similar.<br />
In my case, there is only 2 CT, so i had cut this part, but i had not cut the burst mode yet.<br />
The algorithm part is in &quot;checkProgress&quot;, before the triac driving, and i let it &quot; long&quot;. (with the Robert change)<br />
I have now my good point to start, the most important is done.<br />
Thank again,<br />
Franck</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32104"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 10/07/2015 - 14:59.</div>
    <div class="content">
     <p>Franck,</p>
<p>If you wish to test my phase-angle Mk2 code and report your results, do please run the sketch without making any changes.&nbsp; With CT4 around either of the &#39;live&#39; supply wires and an output stage connected as described in the header, this sketch should work on an emonTx V3.4 without needing any changes.&nbsp; If it doesn&#39;t, let me know!</p>
<p>Thanks, Robin<br />
&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32107"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Fri, 10/07/2015 - 17:34.</div>
    <div class="content">
     <p>Ok, Robin,</p>
<p>i didn&#39;t have Emontx but,</p>
<p>i&#39;ll try it without changes, my CT (150R burden), the output stage is a moc3021 with BTA, so no problem, i think.</p>
<p>On mine, i&#39;ll try to reduce the range to see what is happening and i got a little surplus power between 10-20%, so i&#39;ll try to arrange that better.<br />
Anyway, i&#39;ll give the results.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32223"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Tue, 14/07/2015 - 16:40.</div>
    <div class="content">
     <p>I&#39;m not be able to check with your sketch, my hardware seems not working with it. It is crashing the atmega.<br />
The problem is certainly caused by the i/o , because i&#39;m using the D10 for the trigger, and it seems to me that it&#39;s used for the RF. (or other problem like that)<br />
So, to do the test, I&#39;ll have to cut the rf part, like i had done on on my sketch..<br />
I hope someone else could do that test on an Emontx, with all abilities.</p>
<p>On my side, i&#39;m testing with sweet zone reduced to 3000, it&#39;s seems not affect the import meter, but reduce a little the surplus power, with a result approaching of 92% energy diverted.<br />
During my MK2 was working today, the results of different meters are:<br />
- import energy meter 56Wh<br />
- export energy meter 70Wh<br />
- diverted energy meter 886Wh</p>
<p>Further tests now will be with more PV power in august.</p>
<p>Franck</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32229"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Tue, 14/07/2015 - 20:38.</div>
    <div class="content">
     <p>Franck,</p>
<p>I am sorry that this latest sketch is not of use to you.&nbsp; I thought it was exactly as you had requested.&nbsp; The sketch works well for me on an emonTx v3.4, including all features (RF, Serial, temperature)</p>
<p>The concept of a &quot;sweet zone&quot; is only really helpful for a burst-mode diverter.&nbsp; As your meter will only work with a phase-angle controlled diverter, its &quot;sweet zone&quot; would appear to be very small.&nbsp; It is certainly very much less than 3000 Joules.</p>
<p>While you are trying to get a diverter to work properly alongside your meter, it may be best for the processor to only be doing this one task rather than asking it to do RF datalogging as well.&nbsp; Then you will have no difficulties with the IO port allocations.</p>
<p>I do hope you will get some more sun between now and August :)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32244"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Wed, 15/07/2015 - 07:58.</div>
    <div class="content">
     <p>Robin,<br />
i&#39;m sure your sketch work properly, no doubt.</p>
<p>I had followed your advices to adapt the emontx_3_4_asMK2 sketch in phase-angle control. That works well. My hardware is just different of Emontx, no RF and different i/o, (only 2 CT). So, I&#39;m sure, if i cut the RF part, your latest sketch will work on my MK2.</p>
<p>Today, my PV power is poor (only 1Kwp south), so the surplus power is very little and for testing the MK2 part, i have to turn off some consumers in the house.<br />
Next weeks, i&#39;ll have to install more PV power, (it will be 1KWp east+ 500Wp south+1KWp west)<br />
That will be ready in august, so more PV power, more surplus power, and a new heater tank (2000w) sp&eacute;cialy for that.</p>
<p>My MK2 is ready to use in its first function, then, I &#39;ll have to send once per minute some data on the serial port:<br />
- total energy diverted<br />
- temp heater tank<br />
- (temp triac maybe)<br />
- index of a power energy meter / or pulses counting<br />
That&#39;s the project.</p>
<p>I do not understand why only phase_Angle control works well with my energy meters.<br />
Franck</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32251"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 15/07/2015 - 10:02.</div>
    <div class="content">
     <p><i>"I do not understand why only phase_Angle control works well with my energy meters."</i></p>
<p>The simple answer is your energy meter is designed to work in that way.</p>
<p>The more complicated answer is some electronic energy meters are designed to closely replicate the behaviour of a mechanical Ferraris meter, where the reverse rotation of the disc is prevented by a ratchet mechanism, and some are like yours. We have tried to explain this in the Building Blocks article <a href="https://learn.openenergymonitor.org/?redirect=meters">Energy Meters</a>.</p>
<p>In your case, the "Energy packet" must be very small, very much smaller than the 3600 J of most energy meters, and maybe only big enough for the energy transferred in one mains cycle.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33916"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Sun, 06/09/2015 - 16:44.</div>
    <div class="content">
     <p>hi,<br />
here again,<br />
more PV installed in august, but the the load got a problem in that time.<br />
The heater resistor has been broken.</p>
<p>Anyway, the system is now running properly. The phase angle control suit to me.<br />
Thank again Robin and Robert to have helped a novice.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33930"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8380.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dansir&#039;s picture" title="dansir&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/8380.html" title="View user profile.">dansir</a> on Mon, 07/09/2015 - 08:54.</div>
    <div class="content">
     <p>please post the sketch you are using.thank you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33932"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Mon, 07/09/2015 - 10:44.</div>
    <div class="content">
     <p>Hi dansir</p>
<p>The Sketch for Emontx V3.4 is allready in this page, by Robin</p>
<p>Mine is different, because my hardware is different, but works in same way.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33934"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8380.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dansir&#039;s picture" title="dansir&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/8380.html" title="View user profile.">dansir</a> on Mon, 07/09/2015 - 11:51.</div>
    <div class="content">
     <p>hi,for this reason i ask to you to atach the sketch.i am using arduino uno board.thanks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33935"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Mon, 07/09/2015 - 12:41.</div>
    <div class="content">
     <p>The Mk2 Router sketch with phase-angle control for use with an Arduino Uno is included on my Summary Page.&nbsp; The relevant section is:</p>
<p><em>Mk2_PV_phaseAngle.&nbsp; A phase-angle controlled variant.&nbsp; This requires a trigger which acts immediately rather than a zero-crossing one.&nbsp;&nbsp;&nbsp; Originally posted, with full supporting information, on 01/11/12 at <a href="8412679.html?page=1#comment-6990">http://openenergymonitor.org/emon/node/841</a>, this code is available at<br />
<a href="../sites/default/files/Mk2_PV_phaseAngle.ino_.zip">http://openenergymonitor.org/emon/sites/default/files/Mk2_PV_phaseAngle....</a></em></p>
<p>(the links may not work here, but they should be OK in the <a href="1757.html">Summary Page</a> version)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-33936"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8380.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dansir&#039;s picture" title="dansir&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/8380.html" title="View user profile.">dansir</a> on Mon, 07/09/2015 - 13:30.</div>
    <div class="content">
     <p>thank you</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36780"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Sun, 06/12/2015 - 12:03.</div>
    <div class="content">
     <p>Hi,</p>
<p>i&#39;m still using the phase-angle control,</p>
<p>there is a problem in my datalog, the &quot;divertedEnergyTotal_Wh&quot; stays to 0.</p>
<p>In the Robin&#39;s results.txt, the &quot;WH@CT3&quot;, it seems staying 0.<br />
I don&#39;t really need this value now, but i&#39;m wondering why that part seems not working.</p>
<p>i could need later for monitoring.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36787"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 06/12/2015 - 18:27.</div>
    <div class="content">
     <p><em>there is a problem in my datalog, the &quot;divertedEnergyTotal_Wh&quot; stays to 0.</em></p>
<p>Do you have CT3 clipped around one core of the diverted power cable in the correct orientation?&nbsp; Any current-carrying cable could be used to test and calibrate this part of your system.&nbsp;</p>
<p><em>In the Robin&#39;s results.txt, the &quot;WH@CT3&quot;, it seems staying 0.<br />
I don&#39;t really need this value now, but i&#39;m wondering why that part seems not working.</em></p>
<p>The most likely explanation is that I did not have a CT3 in place when I ran that test.&nbsp; I would expect the CT3 sensor to support measurement of real power in exactly the same way as the original (burst-mode) version does.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36791"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Sun, 06/12/2015 - 20:13.</div>
    <div class="content">
     <p>as you know Robin, i&#39;m using a different hardware.<br />
(closer than yours, without display, and with other in/out)</p>
<p>The sketch in use is still mine, so it is probably the problem....<br />
i will looking, but it it&#39;s not easy for me.</p>
<p>In my sketch, the burst mode still running (without effect, not wired),<br />
only the phase angle is in used and works perfectly.</p>
<p>The datalog is as i want to, &quot;grid power&quot; &quot;Vrms&quot; &quot;temp&quot; are ok, just missing the total energy diverted.<br />
I think, i have just missing something in the sketch, and maybe it&#39;s working in the burst mode and not in phase-angle. I don&#39;t know.<br />
It &#39;s maybe simple. But i still not be able to find.<br />
(arduiono codes , it&#39;s like my english, i&#39;m learning)</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36796"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Sun, 06/12/2015 - 22:16.</div>
    <div class="content">
     <p>happyf, you enquired on this public forum why the results file that Robin had posted contains &#39;0&#39; for all the diverted power values.&nbsp; The answer to this question is that I did not have a CT3 sensor in place at the time.&nbsp; The main purpose of those results was to demonstrate the operation of my phase-angle control algorithm when running on an emonTx V3.4.&nbsp; For that purpose, only CT4 was needed.</p>
<p>If you are running your own version of my software on some other hardware, please do not post your findings on this thread which is clearly intended for the emonTx v3.4.&nbsp; Thanks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-36809"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7404.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="happyf&#039;s picture" title="happyf&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Using an Emontx V3.4 as a MK2 PV Router with phase angle control</h3>

    <div class="submitted">Submitted by <a href="../user/7404.html" title="View user profile.">happyf</a> on Mon, 07/12/2015 - 14:06.</div>
    <div class="content">
     <p>Robin,</p>
<p><em>The answer to this question is that I did not have a CT3 sensor in place at the time.&nbsp;</em></p>
<p>yes, of course, i didn&#39;t thought at that when i asked, it&#39;s silly.</p>
<p>
When I started that thread with that title, it&#39;s simply for staying public on the forum with hardware for most.<br />
I know, my hardware is different, and the sketch too. But the it&#39;s really the same way to use.<br />
I don&#39;t want open a specific thread for myself, i prefer that staying for all, the phase angle control is already specific.<br />
I will work on my sketch, it&#39;s the only part that&#39;s not work, and it&#39;s probably just a little mistake between the burst mode and phase angle control. I will try to find. As i&#39;m not good on that, not sure.</p>
<p>Sorry that it&#39;s feel out of the thread.<br />
Franck</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10865"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-UHPl9ezWSfPije-uZhKza_Cnt7wCb2upitYGZz7wktk" value="form-UHPl9ezWSfPije-uZhKza_Cnt7wCb2upitYGZz7wktk"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
