<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/10942 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:58:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Weird emonTx shield readings | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Weird emonTx shield readings</h3>
        <span class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Sun, 05/07/2015 - 08:53</span>
        <div class="content"><p>Hi to all!</p>
<p>I&#39;ll cut to the chase. I&#39;ve bought a pre-asembled emonTx shield with an arduino uno. I did all the proper connections and uploaded the following firmware</p>
<p>#include &quot;EmonLib.h&quot;</p>
<p>EnergyMonitor ct1;</p>
<p>const int LEDpin = 9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</p>
<p>void setup()<br />
{<br />
&nbsp; Serial.begin(9600);<br />
&nbsp; Serial.println(&quot;emonTX Shield CT123 Voltage Serial Only example&quot;);<br />
&nbsp; Serial.println(&quot;OpenEnergyMonitor.org&quot;);<br />
&nbsp;<br />
&nbsp; ct1.current(1, 60.606);<br />
&nbsp;&nbsp; ct1.voltage(0, 220.3, 1.0);<br />
&nbsp;<br />
&nbsp; pinMode(LEDpin, OUTPUT);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
&nbsp; digitalWrite(LEDpin, HIGH);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<br />
}</p>
<p>void loop()<br />
{<br />
&nbsp; ct1.calcVI(11,2000);&nbsp; &nbsp;<br />
&nbsp;&nbsp; // Print power<br />
&nbsp; Serial.print(&quot;Vrms:&quot;);<br />
&nbsp; Serial.println(ct1.Vrms);<br />
&nbsp; Serial.print(&quot;CT1:&quot;); Serial.print(ct1.Irms);<br />
&nbsp; Serial.print(&quot; - &quot;);<br />
&nbsp; Serial.print(ct1.realPower);<br />
&nbsp; Serial.print(&quot; - &quot;);<br />
&nbsp; Serial.print(ct1.apparentPower);<br />
&nbsp; Serial.print(&quot; - &quot;);<br />
&nbsp; Serial.println(ct1.powerFactor);<br />
&nbsp; Serial.println();<br />
&nbsp; delay(2000);<br />
}</p>
<p>Uno is powered from the pc usb port. I&#39;ve connect a voltmeter to the mains power to get the reading and an amperemeter in series with the phase cable. The load is a heater with two scales. The CT is the YHDC SCT-013-000 and the AC-AC adapter is 8.5V and not 9.0V.</p>
<p>When I compile/run the code the readings I get with a single heating lamp are:</p>
<p><strong>Vrms:132.58</strong><br />
CT1:1.61 - 111.36 - 213.83 - 0.52</p>
<p>while the multimeters display <strong>220.5V</strong> and 1.54A.</p>
<p>And with the second lamp on,</p>
<p><strong>Vrms:133.40</strong><br />
CT1:3.20 - 222.32 - 427.35 - 0.52<br />
while the multimeters display <strong>220.3V </strong>and 3.08A</p>
<p>As you see the Vrms is way too wrong the current is also wrong but it maybe normal as I haven&#39;t done any calibrations yet. I&#39;ve used an oscillator to see the signal on R14 and it&#39;s a 50Hz AC signal with a DC offset of 2.5V and min value of 1.64V and max 3.36V, therefore I suppose there&#39;s no problem with the resistor divider.</p>
<p>Anyway I&#39;ve also printed the values from EnergyMonitor::calcVI() function of the EmonLib.cpp where the Vrms is calculated and still can&#39;t figure out what is wrong. The values are the following:</p>
<p>VCAL: 220.30<br />
SupplyVoltage: 5059<br />
ADC_COUNTS: 1024<br />
sumV: 4005907.75<br />
numberOfSamples: 283<br />
<strong>Vrms: 129.49</strong></p>
<p>I&#39;m a bit lost here, what&#39;s my mistake? I don&#39;t think that the 8.5VAC of the adapter is the problem but I don&#39;t have a 9VAC to test it. I thought I can use the 8.5V adapter and then make any adjustments by calibrating the paramaters.</p>
<p>I&#39;ve tried to find the values of the variables that this setup displays meaningful values and I&#39;ve ended to the following:<br />
ct1.current(1, 58);<br />
ct1.voltage(0, 362.8, 5.4);</p>
<p>Yeah I know, doesn&#39;t make sense.</p>
<p>Thank you in advance for any help.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10973.html" class="topic-previous" title="Go to previous forum topic">‹ SOLVED Problem with new Jeelink not receiving data from emonTX v3.4</a>
              <a href="10959.html" class="topic-next" title="Go to next forum topic">&quot;Log to feed&quot; blank graphics [SOLVED] ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-31935"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 05/07/2015 - 10:29.</div>
    <div class="content">
     <p>First, the ac adapter will be a problem because the voltage (and hence the power) calibration depends on the adapter giving you 11.6 V out unloaded for 240 V in. Those are the numbers for our standard UK adapter. Your adapter is different, therefore you will need to measure the output voltage and input voltage simultaneously (yes, I know! I mean measure the second and hope the first doesn't change meanwhile) and recalculate the voltage calibration constant accordingly. I see you've changed the constant to a value that's way out, so that explains why your voltage reading is badly wrong. My guess - and it's only an educated guess - is if your adapter is labelled 8.5 V and your mains is exactly on specification at 220 V, then your voltage calibration coefficient is 293 approx, but using the values you measured on the input pin it should be 362.26. Using the latter value, your shield would report 217 V. </p>
<p>That doesn't however affect the current calibration, which is wrong by about 4%, and that's actually just within tolerance, though you can of course alter the current calibration too if you wish. All the details about calibration, both the theory and the procedure, are in Building Blocks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31975"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8396.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dimtass&#039;s picture" title="dimtass&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Mon, 06/07/2015 - 11:16.</div>
    <div class="content">
     <p>Thank you for your response.</p>
<p>The adapter is rated at 8.5VAC 230V. I&#39;ve measured the input voltage at 220.5 VAC and the output was at 8.5. So, if I understand it right it&#39;s not a problem to use the 8.5V adapter as long as I use an appropriate voltage coeficient (in my case 362.26). With that coefficient the readings I get are still valid, as it seems to be, correct?</p>
<p>What about the phase shift value which again is way out? It should be within the limits of 1.0 to 2.0 but in my case to get a power factor of 0.99-1.00 I need to use a value of 5.4. Is this ok?</p>
<p>Anyway, my concern is to just get valid readings even if the ac adapter is not the appropriate and the parameters are different from the sketches&#39; defaults. Do you think that is ok if I use the parameters that I get meaningful readings or there&#39;s a problem that I can&#39;t think of?</p>
<p>Again thank you for your response.&nbsp;</p>
<p>Regards.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31977"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 06/07/2015 - 13:17.</div>
    <div class="content">
     <p>The whole purpose of the calibration constants is to correct for differences between what the designer expects and reality, where component tolerances come into play. If you use the "shop" parts, experience tells us that the default values overall are 'good enough' for many people and a good starting point for those who are able to do the full calibration. It's quite in order to change the values, especially when you've identified a reason for the change. (If you can't identify a reason, then that's an indication that something might be wrong, and some fault-finding is called for.)</p>
<p>The ac adapter is, where the Shield is concerned - the emonTx V3 is different, only used to measure the voltage. Any voltage above 1.5 V will do, but you might need to change a resistor if the output is markedly different from 9 V. In your case, 8.5 V is close enough to not warrant changing components even though you are losing a little in resolution.</p>
<p>The phase error is clearly not OK and could be giving you serious errors in the voltage measurement. For why, read Building Blocks about "Explanation of the phase correction algorithm". Basically, you're extrapolating 4.4 samples away. If your mains is a good sine wave, that's OK, but if you experience any distortion - like the 'flat-topping' I see, then it is not good. You can do very little about it without getting a better adapter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31979"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8396.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dimtass&#039;s picture" title="dimtass&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Mon, 06/07/2015 - 13:48.</div>
    <div class="content">
     <p>Thanks Robert.</p>
<p>I will try to investigate further on the phase shift parameter and&nbsp;the reason it has to be that large to get a correct power factor. The sine seems pretty good, I think, I will be able to send you a photo later the evening.</p>
<p>Maybe I will also&nbsp;try to change &nbsp;the R13/R14 ratio to get closer to the specs that you&#39;ve designed.</p>
<p>Of course, I know that it&#39;s not the shield&#39;s flow or the design, as also its very simple to just buy another AC adapter and everything be just fine. It&#39;s just that I&#39;m trying to solve this in order to learn&nbsp;something because many years ago I&#39;ve studied electronics and I really remember nothing than the ohm and kirchhoff law...</p>
<p>Again thanks for your time.</p>
<p>Regards.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31981"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 06/07/2015 - 18:41.</div>
    <div class="content">
     <p>Your phase shift problem unfortunately is a little deeper than that! Basically, it comes down to the design of the transformer. And you'll need to go very deeply into transformer design to understand what's going on there. Even I have to look it up in the text books to remind myself.</p>
<p>As a matter of interest, what frequency is your supply? I've only been able to test the 'shop' adapter at 50 Hz, so I've no idea how it behaves at 60 Hz for example. </p>
<p>I wouldn't change the resistor ratio. Although theoretically it will be better, I don't think you will see any gain. If you think about it, the current inputs usually work over a far smaller input range. You're seeing a range of 1.64 V to 3.36 V in 5 V, that's around 350 counts, and it's only when you get down to inputs of around 15 counts rms that the inherent inaccuracies of the sampling process become significant. If you do change anything, remember you need to cater for the maximum possible mains voltage and the worst case components, and that includes the adapter, divider resistors, the bias resistors and the 5 V supply voltage. It's worth reading what the component tolerances add up to in Building Blocks.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31985"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8396.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dimtass&#039;s picture" title="dimtass&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Mon, 06/07/2015 - 21:14.</div>
    <div class="content">
     <p>Hi Robert thanks for your reply and excuse my late response as things here i Greece are little weird after the referendum and I spend very little time in home.</p>
<p>Anyway, the mains power supply here in Greece is rated at 230V/50Hz and in my house I have a 3-phase installation. I suppose the phase difference and shift should be ok in my&nbsp;area as there aren&#39;t any industries around. Nevertheless the voltage is lower than the rated and I&#39;ve checked with two different multimeters that gives almost the same readings. I&#39;ve&nbsp;also checked the house&#39;s earth grounding and it&#39;s ok. Finally I would like to measure the transformers input and output simultaneously&nbsp;with the oscilloscope but as I remember it&#39;s not very good idea to do that with mains power and I don&#39;t know if the oscilloscope has a proper protection, maybe I try it with a UPS&nbsp;that gives a &quot;good&quot; sine.&nbsp;I still have to read a lot of stuff.</p>
<p>I also have a socket energy meter (expensive Chinese calibrated equipment that costs 10 euro, lol) that when I use the parameters in the first posts gives almost the exact results. Therefore, it seems to work ok for now but as you&#39;ve said I should (and I will) go deep down to the problem as it&#39;s not robust and very little changes on the mains supply will do alot of difference, especially in the phase shift.</p>
<p>Thanks again Robert.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-31995"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 07/07/2015 - 00:12.</div>
    <div class="content">
     <p>You say you have a 3 phase supply - you must be measuring the voltage and current for the same phase, or when you move to the 3-phase sketch, then voltage and CT1 must be on the same phase.</p>
<p>Until you have carefully checked, do not try measuring the mains with an oscilloscope. You are very likely to connect mains neutral to earth via your oscilloscope, and that may give a high current in the 'scope probe screened lead, or if you have RCD protection, will trip it. You need an isolating transformer that you can use to feed your ac adapter. Don't be tempted to do what was common practice years ago but which is now illegal (in the UK at least) - disconnect the 'scope earth.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32000"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8396.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dimtass&#039;s picture" title="dimtass&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Tue, 07/07/2015 - 09:27.</div>
    <div class="content">
     <p>Good morning Robert.</p>
<p>Indeed for the testings I used only one phase sketch with voltage and CT1 on the same phase and of course on real use later they will be on the same phase. I&#39;ve measured again the transformer and it seems that I was very wrong about the output quality. I will need another transformer to get acceptable results as it&#39;s top and bottom are cut-off and maybe this explains the excess phase-shift value I need to use to get meaningful results. You&#39;ve told me that before but I&#39;ve trusted my memory that the output was ok, my fault.</p>
<p>Here I post the results (I didn&#39;t used the image tag).</p>
<p>CH1:R13/R14, CH2: SEC output (meas: CH1)<br />
<a href="../sites/default/files/IMG_20150707_111552.jpg" title="http://openenergymonitor.org/emon/sites/default/files/IMG_20150707_111552.jpg">http://openenergymonitor.org/emon/sites/default/files/IMG_20150707_11155...</a><br />
&nbsp;</p>
<p>CH1:R13/R14, CH2: SEC output (meas: CH2)</p>
<p><a href="../sites/default/files/IMG_20150707_111711.jpg" title="http://openenergymonitor.org/emon/sites/default/files/IMG_20150707_111711.jpg">http://openenergymonitor.org/emon/sites/default/files/IMG_20150707_11171...</a></p>
<p>&nbsp;</p>
<p>I&#39;ve also made a project on PartSim, to check my input voltage against the optimal and the real measured one of my transformer. The difference is around 200mV. Here is the link just for reference.</p>
<p><a href="http://www.partsim.com/simulator/#33724" title="http://www.partsim.com/simulator/#33724">http://www.partsim.com/simulator/#33724</a></p>
<p><a href="../sites/default/files/8V0.jpg" title="http://openenergymonitor.org/emon/sites/default/files/8V0.jpg">http://openenergymonitor.org/emon/sites/default/files/8V0.jpg</a></p>
<p>&nbsp;</p>
<p>Therefore, until I get a decent transformer I will proceed with the rest project&#39;s target which is to connect the emonTx shield with an ESP8266 wifi module (IoT is hype right now :p) and then interface the energy meter with the EIB/KNX installation of the house and assign group addresses to the meter&#39;s output parameters.</p>
<p>I&#39;ll come back with the full project.</p>
<p>Robert, thanks again for your help and I appreciate your time.</p>
<p>Regards.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32004"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 07/07/2015 - 11:26.</div>
    <div class="content">
     <p>The only thing I would question is, could the mains supply really be that shape? If you look at the report on the Mascot and Ideal ac adapters, you can see that my mains voltage really is 'flat-topped', but not quite so distinctively as yours is. So try looking at the output of any transformer, or even wrap some aluminium foil around a wire to make a low-value capacitor, and look at the shape of that before you conclude that it is all down to the transformer that you have chosen. It just doesn't look quite like what I'd expect for a transformer that's saturating, it's more like an amplifier clipping.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32016"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8396.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dimtass&#039;s picture" title="dimtass&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Tue, 07/07/2015 - 18:00.</div>
    <div class="content">
     <p>Hi Robert.</p>
<p>Ok, you&#39;re right... It seems that it&#39;s the network&#39;s problem and not the transformer&#39;s. I&#39;ve just tested a 12V ~1200mA AC/AC adapter (Ktec KA23A120120015G) and the results are the same as before, hence I suppose that it&#39;s relative.</p>
<p>This is the SEC output.</p>
<p><a href="../sites/default/files/12V.jpg" title="http://openenergymonitor.org/emon/sites/default/files/12V.jpg">http://openenergymonitor.org/emon/sites/default/files/12V.jpg</a></p>
<p>So, what&#39;s your opinion on this? Is this something I should worry about in terms of consumption and devices safety or just ignore it? Do you think that this might be the reason for the exceed phase shift parameter value?</p>
<p>Regards.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32018"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8396.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dimtass&#039;s picture" title="dimtass&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Tue, 07/07/2015 - 19:03.</div>
    <div class="content">
     <p>Sorry for double posting.</p>
<p>I&#39;ve made some test with the Ktec adapter and the results are much better by calculating the new calibration value as below.</p>
<p>ct1.voltage(0, 215.2, 1.25);</p>
<p>Now also the phase shift parameter is within the limits and gives very good results.</p>
<p>Vrms on multimeter: <strong>232.6</strong></p>
<p>VCAL: 215.20<br />
SupplyVoltage: 5059<br />
ADC_COUNTS: 1024<br />
sumV: 13521581.00<br />
numberOfSamples: 282<br />
Vrms: <strong>232.81</strong><br />
CT1:1.62 - 375.25 - 376.44 - 1.00</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32030"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 07/07/2015 - 21:50.</div>
    <div class="content">
     <p><i>"So, what's your opinion on this? Is this something I should worry about in terms of consumption and devices safety or just ignore it? Do you think that this might be the reason for the exceed phase shift parameter value?"</i></p>
<p>I'm not sure what you're asking there. If it is 'Is the Ktek adapter going to have an excessive losses because it is rated at 1200 mA?' - possibly, but not necessarily. There are two components to transformer losses, those related to the transformer itself, and those related to the current it is delivering. You have (almost) zero secondary current, so the only losses are the transformer's own. If it gets warm in use, then it might be something to consider. If it runs cold, it's probably nothing to worry about. Obviously, you'd prefer zero losses but that's not possible given the need to put safety first.</p>
<p>If you are asking 'Is the excessive phase shift and excessive loss in the 8.5 V adapter linked?', then quite possibly they are!</p>
<p>If you're going to continue with the Ktek adapter, you just need to make sure that you don't have excessive volts at the ADC input at maximum mains voltage (which I think should be 230 V + 10% = 243 V).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32043"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8396.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dimtass&#039;s picture" title="dimtass&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Wed, 08/07/2015 - 06:27.</div>
    <div class="content">
     <p>Hi Robert.</p>
<p>You&#39;ve fully covered all my questions. It seems that I will continue with the Ktek adapter as I finally get meaningful results, therefore; the only thing is left is to calibrate the CT parameter to get more precise current readings.</p>
<p>Also I&#39;ve noticed that the 8.5V adapter was running too hot even without a load. After 2 days on the mains power of which the last day was unconnected, it was so hot I could barely hold it for couple of seconds. It&#39;s obvious that the transformer has problem.</p>
<p>Thank you for your advices and support!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-32082"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/8396.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="dimtass&#039;s picture" title="dimtass&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Weird emonTx shield readings</h3>

    <div class="submitted">Submitted by <a href="../user/8396.html" title="View user profile.">dimtass</a> on Thu, 09/07/2015 - 18:50.</div>
    <div class="content">
     <p>Hi again Robert.</p>
<p>Everything is fine now and while I&#39;m finished with my little project I&#39;m posting the code here for anyone who needs to interface the emonTx shield with an ESP8266 (is a cheap but excellent wifi transceiver with embedded tcp/ip stack) and retrieve UDP packets on a certain IP and port (I use a raspberry pi to listen to the UDP packets).</p>
<p>The sketch is here:</p>
<p><a href="../sites/default/files/ard_energy_meter.html" title="http://openenergymonitor.org/emon/sites/default/files/ard_energy_meter.ino">http://openenergymonitor.org/emon/sites/default/files/ard_energy_meter.ino</a></p>
<p>Some brief notes on the code and shield. To use it you need to connect the ESP8266 module to the RFM12B pads and the following image shows how.</p>
<p><img alt="" src="../sites/default/files/emonTxShieldV2_PCB_front.jpg" /></p>
<p>TX. RX are the signals from the ESP8266. Also you have to replace resistors R7 and R20 as their value are too large to use for level translator, therefore R7 must be replaced with a 2K2 resistor and R20 with an 1K.</p>
<p>Also depending the Arduino board (mine is R3 UNO), it&#39;s 3V3 supply current may not be enough to drive the ESP8266. In my case there wasn&#39;t any problem but I&#39;ve red that some people did have problems. Anyway, in that case you may need an AMS1117-3.3 or something similar to power the ESP8266 but I think it&#39;s no need to cover it here.</p>
<p>Finally, in the sketch you only have to edit the AP_SSID, AP_PASSWD, AP_SERVER_IP and AP_SERVER_PORT definitions with the ones that meet your Access Point and network setup. These values are stored also in the internal EEPROM, that&#39;s though are for mine future needs, so don&#39;t mind them. Also to enable or disable the debug output of the wifi module comment in or out the DEBUG_WIFI definition.</p>
<p>I hope I&#39;ve explained it well enough.</p>
<p>Regards.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/10942"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-keiMuYU8tmH4LFa7REqBwAcK5Lj2ftejpULLdhwwZ34" value="form-keiMuYU8tmH4LFa7REqBwAcK5Lj2ftejpULLdhwwZ34"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
