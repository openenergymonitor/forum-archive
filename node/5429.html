<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5429 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:23:52 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Unable to detect DS18B20 sensor addresses and long one-wire radius problem | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Unable to detect DS18B20 sensor addresses and long one-wire radius problem</h3>
        <span class="submitted">Submitted by <a href="../user/6496.html" title="View user profile.">WernerOpenEM</a> on Sat, 19/07/2014 - 23:49</span>
        <div class="content"><p>Hi,</p>
<p>&nbsp;</p>
<p>I finally managed to spend some time again on my little project but I am stuck now, after mane many hours.</p>
<p>&nbsp;</p>
<p>The default sketch that came installed on my EmonTx v3&nbsp;does send a temperature value if a sensor is connected to the terminal block. &nbsp;I tried to add another one and it worked fine, modified my sketch and payload and all is good, no problem(with that).</p>
<p>&nbsp;</p>
<p>Now I have these two problems:</p>
<p>1) I am trying to read and print the sensor address. &nbsp;I have found a lot of examples but even though my sensors are connected and working, this&nbsp;<strong><em>sensors.getAddress(tempDeviceAddress, 0)</em></strong> always returns FALSE and then just prints that a Ghost device was found(taken from a common example). &nbsp;Although I probably don&#39;t really need the address I just want it to hardcode my sensors, given that they are deterministic it is probably not really required, but still, I want it. :)</p>
<p>2) Connecting a 1m wire to a bread board containing my test&nbsp;DS18B20 sensor works fine at startup. &nbsp;As soon as a just push in another much longer wire(60m) into the breadboard without or without a sensor on the other end(I tried both), then my original sensor seem to die and my temp reading goes to 0. &nbsp;I saw some schemetics that suggest a 4K7 resistor across Vdd and Data, but then I found on the OEM Wiki that a 4k7&nbsp;is already on the board, pre-installed. &nbsp;I even tried a 100Ohm on the data pin before it goes to the wire same problem. &nbsp;My cable is not twister-pair or shielded. &nbsp;</p>
<p>&nbsp;</p>
<p>Would really appreciate some expert help here, I am at my wits end with this, I know it is something basic, but I am just missing it.</p>
<p>&nbsp;</p>
<p>I spent a lot of time on this example:&nbsp;http://openenergymonitor.org/emon/buildingblocks/DS18B20-temperature-sensing and that didn&#39;t help me either.....</p>
<p>&nbsp;</p>
<p>Here is my very very very messy sketch:</p>
<p>***************************************************************************************</p>
<p>/*<br />
	&nbsp;<br />
	&nbsp; emonTxV3 Discrete Sampling<br />
	&nbsp;<br />
	&nbsp; If AC-AC adapter is detected assume emonTx is also powered from adapter (jumper shorted) and take Real Power Readings and disable sleep mode to keep load on power supply constant<br />
	&nbsp; If AC-AC addapter is not detected assume powering from battereis / USB 5V AC sample is not present so take Apparent Power Readings and enable sleep mode<br />
	&nbsp;<br />
	&nbsp; Transmitt values via RFM12B radio<br />
	&nbsp;<br />
	&nbsp;&nbsp; -----------------------------------------<br />
	&nbsp; Part of the openenergymonitor.org project<br />
	&nbsp;<br />
	&nbsp; Authors: Glyn Hudson &amp; Trystan Lea<br />
	&nbsp; Builds upon JCW JeeLabs RF12 library and Arduino<br />
	&nbsp;<br />
	&nbsp; Licence: GNU GPL V3</p>
<p>*/</p>
<p>/*Recommended node ID allocation<br />
	------------------------------------------------------------------------------------------------------------<br />
	-ID- -Node Type-<br />
	0 - Special allocation in JeeLib RFM12 driver - reserved for OOK use<br />
	1-4&nbsp;&nbsp;&nbsp;&nbsp; - Control nodes<br />
	5-10 - Energy monitoring nodes<br />
	11-14 --Un-assigned --<br />
	15-16 - Base Station &amp; logging nodes<br />
	17-30 - Environmental sensing nodes (temperature humidity etc.)<br />
	31 - Special allocation in JeeLib RFM12 driver - Node31 can communicate with nodes on any network group<br />
	-------------------------------------------------------------------------------------------------------------</p>
<p>
	Change Log:<br />
	V1.3 - fix filter settle time to eliminate large inital reading<br />
	V1.2 - fix bug which caused Vrms to be returned as zero if CT1 was not connected<br />
	V1.1 - fix bug in startup Vrms calculation, startup Vrms startup calculation is now more accuratre<br />
	*/</p>
<p>#define emonTxV3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Tell emonLib this is the emonTx V3 - don&#39;t read Vcc assume Vcc = 3.3V as is always the case on emonTx V3 eliminates bandgap error and need for calibration <a href="http://harizanov.com/2013/09/thoughts-on-avr-adc-accuracy/" title="http://harizanov.com/2013/09/thoughts-on-avr-adc-accuracy/">http://harizanov.com/2013/09/thoughts-on-avr-adc-accuracy/</a></p>
<p>#include &lt;RFu_JeeLib.h&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Special modified version of the JeeJib library to work with the RFu328 <a href="https://github.com/openenergymonitor/RFu_jeelib       " title="https://github.com/openenergymonitor/RFu_jeelib       ">https://github.com/openenergymonitor/RFu_jeelib       </a><br />
	ISR(WDT_vect) { Sleepy::watchdogEvent(); }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Attached JeeLib sleep function to Atmega328 watchdog -enables MCU to be put into sleep mode inbetween readings to reduce power consumption</p>
<p>#include &quot;EmonLib.h&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Include EmonLib energy monitoring library <a href="https://github.com/openenergymonitor/EmonLib" title="https://github.com/openenergymonitor/EmonLib">https://github.com/openenergymonitor/EmonLib</a><br />
	EnergyMonitor ct1, ct2, ct3, ct4;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p>#include &lt;OneWire.h&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //http://www.pjrc.com/teensy/td_libs_OneWire.html<br />
	#include &lt;DallasTemperature.h&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //http://download.milesburton.com/Arduino/MaximTemperature/DallasTemperature_LATEST.zip</p>
<p>
	//----------------------------emonTx V3 Settings---------------------------------------------------------------------------------------------------------------<br />
	const byte Vrms=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 230;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Vrms for apparent power readings (when no AC-AC voltage sample is present)<br />
	const byte TIME_BETWEEN_READINGS= 10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Time between readings&nbsp;&nbsp;</p>
<p>const float Ical1=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 90.9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (2000 turns / 22 Ohm burden) = 90.9<br />
	const float Ical2=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 90.9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (2000 turns / 22 Ohm burden) = 90.9<br />
	const float Ical3=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 90.9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (2000 turns / 22 Ohm burden) = 90.9<br />
	const float Ical4=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 16.6;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (2000 turns / 120 Ohm burden) = 16.6</p>
<p>const float Vcal=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 276.9;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // (230V x 13) / (9V x 1.2) = 276.9</p>
<p>const float phase_shift=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.7;<br />
	const int no_of_samples=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1480;<br />
	const int no_of_half_wavelengths= 20;<br />
	const int timeout=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2000;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //emonLib timeout<br />
	const int ACAC_DETECTION_LEVEL=&nbsp;&nbsp; 3000;<br />
	const int TEMPERATURE_PRECISION=&nbsp; 11;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //9 (93.8ms),10 (187.5ms) ,11 (375ms) or 12 (750ms) bits equal to resplution of 0.5C, 0.25C, 0.125C and 0.0625C<br />
	//#define FILTERSETTLETIME&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 25000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Time (ms) to allow the filters to settle before sending data<br />
	#define ASYNC_DELAY 375&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // DS18B20 conversion delay - 9bit requres 95ms, 10bit 187ms, 11bit 375ms and 12bit resolution takes 750ms<br />
	//-------------------------------------------------------------------------------------------------------------------------------------------<br />
	//-------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>
	//----------------------------emonTx V3 hard-wired connections---------------------------------------------------------------------------------------------------------------<br />
	const byte LEDpin=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 6;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // emonTx V3 LED<br />
	const byte DS18B20_PWR=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 19;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // DS18B20 Power<br />
	#define ONE_WIRE_BUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // DS18B20 Data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	//-------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>//Setup DS128B20<br />
	OneWire oneWire(ONE_WIRE_BUS);<br />
	DallasTemperature sensors(&amp;oneWire);<br />
	DeviceAddress tempDeviceAddress;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // We&#39;ll use this variable to store a found device address</p>
<p>//-------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>//-----------------------RFM12B SETTINGS----------------------------------------------------------------------------------------------------<br />
	#define RF_freq RF12_433MHZ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Frequency of RF12B module can be RF12_433MHZ, RF12_868MHZ or RF12_915MHZ. You should use the one matching the module you have.<br />
	const int nodeID = 10;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // emonTx RFM12B node ID<br />
	const int networkGroup = 210;&nbsp;<br />
	typedef struct { int power1, power2, power3, power4, Vrms, temp0; } PayloadTX;&nbsp;&nbsp;&nbsp;&nbsp; // create structure - a neat way of packaging data for RF comms<br />
	&nbsp; PayloadTX emontx;<br />
	//-------------------------------------------------------------------------------------------------------------------------------------------<br />
	//-------------------------------------------------------------------------------------------------------------------------------------------</p>
<p>
	//Random Variables<br />
	//boolean settled = false;<br />
	boolean CT1, CT2, CT3, CT4, ACAC, debug, DS18B20_STATUS;<br />
	byte CT_count=0;<br />
	int numSensors;<br />
	//addresses of sensors, MAX 4!!&nbsp;<br />
	byte allAddress [4][8];&nbsp; // 8 bytes per address<br />
	DeviceAddress deviceAddress;</p>
<p>void setup()<br />
	{</p>
<p>	&nbsp; pinMode(LEDpin, OUTPUT);<br />
	&nbsp; pinMode(DS18B20_PWR, OUTPUT);&nbsp;<br />
	&nbsp; digitalWrite(LEDpin,HIGH);</p>
<p>&nbsp; Serial.begin(9600);<br />
	&nbsp; Serial.println(&quot;emonTx V3 Discrete Sampling V1.3&quot;);<br />
	&nbsp; Serial.println(&quot;OpenEnergyMonitor.org&quot;);<br />
	&nbsp; Serial.println(&quot;Performing power-on tests.....please wait 10s&quot;);<br />
	&nbsp; Serial.println(&quot;Werners custom SKETCH&quot;);<br />
	&nbsp;<br />
	&nbsp; delay(10);<br />
	&nbsp; rf12_initialize(nodeID, RF_freq, networkGroup);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // initialize RFM12B<br />
	&nbsp;&nbsp; for (int i=10; i&gt;=0; i--)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Send RFM12B test sequence (for factory testing)<br />
	&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.power1=i;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; rf12_sendNow(0, &amp;emontx, sizeof emontx);<br />
	&nbsp;&nbsp;&nbsp;&nbsp; delay(100);<br />
	&nbsp;&nbsp; }<br />
	&nbsp; rf12_sendWait(2);<br />
	&nbsp; emontx.power1=0;<br />
	&nbsp; rf12_sleep(RF12_SLEEP);&nbsp;&nbsp;</p>
<p>	&nbsp;&nbsp;</p>
<p>&nbsp; if (analogRead(1) &gt; 0) {CT1 = 1; CT_count++;} else CT1=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // check to see if CT is connected to CT1 input, if so enable that channel<br />
	&nbsp; if (analogRead(2) &gt; 0) {CT2 = 1; CT_count++;} else CT2=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // check to see if CT is connected to CT2 input, if so enable that channel<br />
	&nbsp; if (analogRead(3) &gt; 0) {CT3 = 1; CT_count++;} else CT3=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // check to see if CT is connected to CT3 input, if so enable that channel<br />
	&nbsp; if (analogRead(4) &gt; 0) {CT4 = 1; CT_count++;} else CT4=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //&nbsp; check to see if CT is connected to CT4 input, if so enable that channel<br />
	&nbsp;<br />
	&nbsp; if ( CT_count == 0) CT1=1;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // If no CT&#39;s are connect ed CT1-4 then by default read from CT1</p>
<p>&nbsp; // Quick check to see if there is a voltage waveform present on the ACAC Voltage input<br />
	&nbsp; // Check consists of calculating the RMS from 100 samples of the voltage input.<br />
	&nbsp; Sleepy::loseSomeTime(10000);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //wait for settle<br />
	&nbsp; digitalWrite(LEDpin,LOW);<br />
	&nbsp;<br />
	&nbsp; // Calculate if there is an ACAC adapter on analog input 0<br />
	&nbsp; //double vrms = calc_rms(0,1780) * (Vcal * (3.3/1024) );<br />
	&nbsp; double vrms = calc_rms(0,1780) * 0.87;<br />
	&nbsp; if (vrms&gt;90) ACAC = 1; else ACAC=0;</p>
<p>	&nbsp; if (ACAC)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; for (int i=0; i&lt;10; i++)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // indicate AC has been detected by flashing LED 10 times<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(LEDpin, HIGH); delay(200);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(LEDpin, LOW); delay(300);<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp; }<br />
	&nbsp; else<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; delay(1000);<br />
	&nbsp;&nbsp;&nbsp; digitalWrite(LEDpin, HIGH); delay(2000); digitalWrite(LEDpin, LOW);&nbsp;&nbsp; // indicate DC power has been detected by turing LED on then off<br />
	&nbsp; }</p>
<p>
	//################################################################################################################################<br />
	&nbsp; //Setup and for presence of DS18B20<br />
	&nbsp; //################################################################################################################################<br />
	&nbsp; digitalWrite(DS18B20_PWR, HIGH); delay(50);<br />
	&nbsp; sensors.begin();<br />
	&nbsp; sensors.setWaitForConversion(false);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //disable automatic temperature conversion to reduce time spent awake, conversion will be implemented manually in sleeping <a href="http://harizanov.com/2013/07/optimizing-ds18b20-code-for-low-power-applications/" title="http://harizanov.com/2013/07/optimizing-ds18b20-code-for-low-power-applications/">http://harizanov.com/2013/07/optimizing-ds18b20-code-for-low-power-appli...</a><br />
	&nbsp; numSensors=(sensors.getDeviceCount());<br />
	&nbsp;</p>
<p>&nbsp; byte j=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // search for one wire devices and<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // copy to device address arrays.<br />
	&nbsp; while ((j &lt; numSensors) &amp;&amp; (oneWire.search(allAddress[j])))&nbsp; j++;<br />
	&nbsp; digitalWrite(DS18B20_PWR, LOW);<br />
	&nbsp;<br />
	&nbsp; if (numSensors==0) DS18B20_STATUS=0;<br />
	&nbsp;&nbsp;&nbsp; else DS18B20_STATUS=1;<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp; Serial.print(&quot;DS18B20_STATUS =&quot;); Serial.println(DS18B20_STATUS);</p>
<p>&nbsp;<br />
	//################################################################################################################################</p>
<p>&nbsp; if (Serial) debug = 1; else debug=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if serial UART to USB is connected show debug O/P. If not then disable serial<br />
	&nbsp; if (debug==1)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;CT 1 Calibration: &quot;); Serial.println(Ical1);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;CT 2 Calibration: &quot;); Serial.println(Ical2);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;CT 3 Calibration: &quot;); Serial.println(Ical3);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;CT 4 Calibration: &quot;); Serial.println(Ical4);<br />
	&nbsp;&nbsp;&nbsp; delay(1000);</p>
<p>&nbsp;&nbsp;&nbsp; Serial.print(&quot;RMS Voltage on AC-AC Adapter input is: ~&quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(vrms,0); Serial.println(&quot;V&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; if (ACAC)<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot;AC-AC adapter detected - Real Power measurements enabled&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot;assuming powering from AC-AC adapter (jumper closed)&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Vcal: &quot;); Serial.println(Vcal);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Phase Shift: &quot;); Serial.println(phase_shift);<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot;AC-AC adapter NOT detected - Apparent Power measurements enabled&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Assuming VRMS to be &quot;); Serial.print(Vrms); Serial.println(&quot;V&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot;Assuming powering from batteries / 5V USB - power saving mode enabled&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp; if (CT_count==0) Serial.println(&quot;NO CT&#39;s detected, sampling from CT1 by default&quot;);<br />
	&nbsp;&nbsp;&nbsp; else&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (CT1) Serial.println(&quot;CT 1 detected&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (CT2) Serial.println(&quot;CT 2 detected&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (CT3) Serial.println(&quot;CT 3 detected&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (CT4) Serial.println(&quot;CT 4 detected&quot;);<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; if (DS18B20_STATUS==1) {Serial.print(&quot;Detected &quot;); Serial.print(numSensors); Serial.println(&quot; DS18B20..using this for temperature reading&quot;);}<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else Serial.println(&quot;Unable to detect DS18B20 temperature sensor&quot;);<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; // report parasite power requirements<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;Parasite power is: &quot;);<br />
	&nbsp;&nbsp;&nbsp; if (sensors.isParasitePowerMode()) Serial.println(&quot;ON&quot;);<br />
	&nbsp;&nbsp;&nbsp; else Serial.println(&quot;OFF&quot;);<br />
	&nbsp;&nbsp;&nbsp; // Loop through each device, print out address<br />
	&nbsp;&nbsp;&nbsp; for(int i=0;i&lt;numSensors; i++)<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(&quot;Searching for device # =&quot;); Serial.println(i);<br />
	&nbsp;&nbsp;&nbsp; // Search the wire for address<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(sensors.getAddress(tempDeviceAddress, i))<br />
	{<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; Serial.print(&quot;Found device &quot;);<br />
	&nbsp; Serial.print(i, DEC);<br />
	&nbsp; Serial.print(&quot; with address: &quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (uint8_t i = 0; i &lt; 8; i++)<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (deviceAddress[i] &lt; 16) Serial.print(&quot;0&quot;);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.print(deviceAddress[i], HEX);<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />
	//&nbsp; printAddress(tempDeviceAddress);<br />
	&nbsp; Serial.println();<br />
	&nbsp;<br />
	&nbsp; Serial.print(&quot;Setting resolution to &quot;);<br />
	&nbsp; Serial.println(TEMPERATURE_PRECISION,DEC);<br />
	&nbsp; delay(100);<br />
	&nbsp; // set the resolution to 9 bit (Each Dallas/Maxim device is capable of several different resolutions)<br />
	&nbsp; sensors.setResolution(tempDeviceAddress, TEMPERATURE_PRECISION);<br />
	&nbsp;<br />
	&nbsp;&nbsp; Serial.print(&quot;Resolution actually set to: &quot;);<br />
	&nbsp; Serial.print(sensors.getResolution(tempDeviceAddress), DEC);<br />
	&nbsp; Serial.println();<br />
	&nbsp;&nbsp; }else{<br />
	&nbsp; Serial.print(&quot;Found ghost device at &quot;);<br />
	&nbsp; Serial.print(i, DEC);<br />
	&nbsp; Serial.println(&quot; but could not detect address. Check power and cabling&quot;);<br />
	&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp; }&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; Serial.println(&quot;RFM12B Initiated: &quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot;Node: &quot;); Serial.print(nodeID);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot; Freq: &quot;);<br />
	&nbsp;&nbsp;&nbsp; if (RF_freq == RF12_433MHZ) Serial.print(&quot;433Mhz&quot;);<br />
	&nbsp;&nbsp;&nbsp; if (RF_freq == RF12_868MHZ) Serial.print(&quot;868Mhz&quot;);<br />
	&nbsp;&nbsp;&nbsp; if (RF_freq == RF12_915MHZ) Serial.print(&quot;915Mhz&quot;);<br />
	&nbsp;&nbsp;&nbsp; Serial.print(&quot; Network: &quot;); Serial.println(networkGroup);<br />
	&nbsp;&nbsp; delay(500);&nbsp;<br />
	&nbsp; }<br />
	&nbsp; else<br />
	&nbsp;&nbsp;&nbsp; Serial.end();<br />
	&nbsp;<br />
	&nbsp;<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp; if (CT1) ct1.current(1, Ical1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // CT ADC channel 1, calibration.&nbsp; calibration (2000 turns / 22 Ohm burden resistor = 90.909)<br />
	&nbsp; if (CT2) ct2.current(2, Ical2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // CT ADC channel 2, calibration.<br />
	&nbsp; if (CT3) ct3.current(3, Ical3);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // CT ADC channel 3, calibration.<br />
	&nbsp; //CT 3 is high accuracy @ low power -&nbsp; 4.5kW Max @ 240V<br />
	&nbsp; if (CT4) ct4.current(4, Ical4);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // CT channel ADC 4, calibration.&nbsp;&nbsp;&nbsp; calibration (2000 turns / 120 Ohm burden resistor = 16.66)<br />
	&nbsp;<br />
	&nbsp; if (ACAC)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; if (CT1) ct1.voltage(0, Vcal, phase_shift);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ADC pin, Calibration, phase_shift<br />
	&nbsp;&nbsp;&nbsp; if (CT2) ct2.voltage(0, Vcal, phase_shift);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ADC pin, Calibration, phase_shift<br />
	&nbsp;&nbsp;&nbsp; if (CT3) ct3.voltage(0, Vcal, phase_shift);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ADC pin, Calibration, phase_shift<br />
	&nbsp;&nbsp;&nbsp; if (CT4) ct4.voltage(0, Vcal, phase_shift);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ADC pin, Calibration, phase_shift<br />
	&nbsp; }</p>
<p>	&nbsp; // Do some measurements to allow the software filter to settle - don&#39;t use the result<br />
	&nbsp; if (ACAC)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; if (CT1) for (int j=0; j&lt;5; j++) ct1.calcVI(no_of_half_wavelengths,timeout);<br />
	&nbsp;&nbsp;&nbsp; if (CT2) for (int j=0; j&lt;5; j++) ct2.calcVI(no_of_half_wavelengths,timeout);<br />
	&nbsp;&nbsp;&nbsp; if (CT3) for (int j=0; j&lt;5; j++) ct3.calcVI(no_of_half_wavelengths,timeout);<br />
	&nbsp;&nbsp;&nbsp; if (CT4) for (int j=0; j&lt;5; j++) ct4.calcVI(no_of_half_wavelengths,timeout);<br />
	&nbsp;&nbsp; }<br />
	&nbsp;&nbsp; else<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; if (CT1) for (int j=0; j&lt;5; j++) ct1.calcIrms(no_of_samples);<br />
	&nbsp;&nbsp;&nbsp; if (CT2) for (int j=0; j&lt;5; j++) ct2.calcIrms(no_of_samples);<br />
	&nbsp;&nbsp;&nbsp; if (CT3) for (int j=0; j&lt;5; j++) ct3.calcIrms(no_of_samples);<br />
	&nbsp;&nbsp;&nbsp; if (CT4) for (int j=0; j&lt;5; j++) ct4.calcIrms(no_of_samples);<br />
	&nbsp;&nbsp; }<br />
	}</p>
<p>void loop()<br />
	{<br />
	&nbsp;<br />
	&nbsp; if (ACAC) {<br />
	&nbsp;&nbsp;&nbsp; delay(200);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if powering from AC-AC allow time for power supply to settle&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; emontx.Vrms=0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Set Vrms to zero, this will be overwirtten by wither CT 1-4<br />
	&nbsp; }<br />
	&nbsp;<br />
	&nbsp; if (CT1)<br />
	&nbsp; {<br />
	&nbsp;&nbsp; if (ACAC)<br />
	&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp; ct1.calcVI(no_of_half_wavelengths,timeout); emontx.power1=ct1.realPower;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.Vrms=ct1.Vrms*100;<br />
	&nbsp;&nbsp; }<br />
	&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.power1 = ct1.calcIrms(no_of_samples)*Vrms;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calculate Apparent Power 1&nbsp; 1480 is&nbsp; number of samples<br />
	&nbsp;&nbsp; if (debug==1) {Serial.print(emontx.power1); Serial.print(&quot; &quot;);}</p>
<p>&nbsp; }<br />
	&nbsp;<br />
	&nbsp; if (CT2)<br />
	&nbsp; {<br />
	&nbsp;&nbsp; if (ACAC)<br />
	&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp; ct2.calcVI(no_of_half_wavelengths,timeout); emontx.power2=ct2.realPower;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.Vrms=ct2.Vrms*100;<br />
	&nbsp;&nbsp; }<br />
	&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.power2 = ct2.calcIrms(no_of_samples)*Vrms;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calculate Apparent Power 1&nbsp; 1480 is&nbsp; number of samples<br />
	&nbsp;&nbsp; if (debug==1) {Serial.print(emontx.power2); Serial.print(&quot; &quot;);}&nbsp;</p>
<p>&nbsp; }</p>
<p>&nbsp; if (CT3)<br />
	&nbsp; {<br />
	&nbsp;&nbsp; if (ACAC)<br />
	&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp; ct3.calcVI(no_of_half_wavelengths,timeout); emontx.power3=ct3.realPower;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.Vrms=ct3.Vrms*100;<br />
	&nbsp;&nbsp; }<br />
	&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.power3 = ct3.calcIrms(no_of_samples)*Vrms;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calculate Apparent Power 1&nbsp; 1480 is&nbsp; number of samples<br />
	&nbsp;&nbsp; if (debug==1) {Serial.print(emontx.power3); Serial.print(&quot; &quot;);}</p>
<p>&nbsp; }<br />
	&nbsp;</p>
<p>&nbsp; if (CT4)<br />
	&nbsp; {<br />
	&nbsp;&nbsp; if (ACAC)<br />
	&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp; ct4.calcVI(no_of_half_wavelengths,timeout); emontx.power4=ct4.realPower;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.Vrms=ct4.Vrms*100;<br />
	&nbsp;&nbsp; }<br />
	&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp; emontx.power4 = ct4.calcIrms(no_of_samples)*Vrms;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Calculate Apparent Power 1&nbsp; 1480 is&nbsp; number of samples<br />
	&nbsp;&nbsp; if (debug==1) {Serial.print(emontx.power4); Serial.print(&quot; &quot;);}</p>
<p>&nbsp; }<br />
	&nbsp;<br />
	&nbsp;<br />
	&nbsp; if (ACAC)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; if ((debug==1) &amp;&amp; (!CT_count==0))&nbsp; Serial.print(emontx.Vrms);<br />
	&nbsp; }<br />
	&nbsp;<br />
	&nbsp; if ((debug==1) &amp;&amp; (!CT_count==0)) {Serial.println(); delay(20);}<br />
	&nbsp;<br />
	&nbsp; // because millis() returns to zero after 50 days !<br />
	&nbsp; //if (!settled &amp;&amp; millis() &gt; FILTERSETTLETIME) settled = true; - replaced by filter settle routine at end of setup</p>
<p>&nbsp;<br />
	&nbsp;&nbsp;&nbsp; if (DS18B20_STATUS==1)<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(DS18B20_PWR, HIGH); Sleepy::loseSomeTime(50);<br />
	&nbsp;&nbsp;&nbsp;&nbsp; for(int j=0;j&lt;numSensors;j++) sensors.setResolution(allAddress[j], TEMPERATURE_PRECISION);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // and set the a to d conversion resolution of each.<br />
	&nbsp;&nbsp;&nbsp;&nbsp; sensors.requestTemperatures();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Send the command to get temperatures<br />
	&nbsp;&nbsp;&nbsp;&nbsp; Sleepy::loseSomeTime(ASYNC_DELAY); //Must wait for conversion, since we use ASYNC mode<br />
	&nbsp;&nbsp;&nbsp;&nbsp; float temp0=(sensors.getTempC(allAddress[0]));<br />
	&nbsp;&nbsp;&nbsp;&nbsp; //float temp1=(sensors.getTempC(allAddress[1]));<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(DS18B20_PWR, LOW);<br />
	&nbsp;&nbsp;&nbsp;&nbsp; if ((temp0&lt;125.0) &amp;&amp; (temp0&gt;-40.0)) emontx.temp0=(temp0*10);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //if reading is within range for the sensor convert float to int ready to send via RF<br />
	&nbsp;&nbsp;&nbsp; // if ((temp1&lt;125.0) &amp;&amp; (temp1&gt;-40.0)) emontx.temp1=(temp1*10);<br />
	&nbsp;&nbsp;&nbsp;&nbsp; if (debug==1) {Serial.print(&quot;temperature0: &quot;); Serial.println(emontx.temp0*0.1); delay(20);}<br />
	&nbsp;&nbsp;&nbsp; // if (debug==1) {Serial.print(&quot;temperature1: &quot;); Serial.println(emontx.temp1*0.1); delay(20);}<br />
	&nbsp;&nbsp;&nbsp;&nbsp; if (debug==1) {Serial.println(&quot;DONE with this pass&quot;);&nbsp; delay(20);}<br />
	&nbsp; }<br />
	&nbsp;<br />
	&nbsp;<br />
	&nbsp;<br />
	&nbsp;<br />
	&nbsp;<br />
	&nbsp;<br />
	&nbsp;<br />
	&nbsp;<br />
	// if (settled)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // send data only after filters have settled<br />
	&nbsp; //{<br />
	&nbsp;&nbsp;&nbsp; send_rf_data();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // *SEND RF DATA* - see emontx_lib<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; if (ACAC)<br />
	&nbsp;&nbsp;&nbsp; {<br />
	&nbsp;&nbsp;&nbsp;&nbsp; delay(TIME_BETWEEN_READINGS*1000);<br />
	&nbsp;&nbsp;&nbsp;&nbsp; digitalWrite(LEDpin, HIGH); delay(200); digitalWrite(LEDpin, LOW);&nbsp;&nbsp;&nbsp; // flash LED - turn off to save power<br />
	&nbsp;&nbsp;&nbsp; }<br />
	&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp; else<br />
	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; emontx_sleep(TIME_BETWEEN_READINGS);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // sleep or delay in seconds<br />
	//&nbsp; }&nbsp;</p>
<p>	}</p>
<p>void send_rf_data()<br />
	{<br />
	&nbsp; rf12_sleep(RF12_WAKEUP);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp; rf12_sendNow(0, &amp;emontx, sizeof emontx);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //send temperature data via RFM12B using new rf12_sendNow wrapper<br />
	&nbsp; rf12_sendWait(2);<br />
	&nbsp; rf12_sleep(RF12_SLEEP);<br />
	}</p>
<p>void emontx_sleep(int seconds) {<br />
	&nbsp; Sleepy::loseSomeTime(seconds*1000);<br />
	}</p>
<p>double calc_rms(int pin, int samples)<br />
	{<br />
	&nbsp; unsigned long sum = 0;<br />
	&nbsp; for (int i=0; i&lt;samples; i++) // 178 samples takes about 20ms<br />
	&nbsp; {<br />
	&nbsp;&nbsp;&nbsp; int raw = (analogRead(0)-512);<br />
	&nbsp;&nbsp;&nbsp; sum += (unsigned long)raw * raw;<br />
	&nbsp; }<br />
	&nbsp; double rms = sqrt((double)sum / samples);<br />
	&nbsp; return rms;<br />
	}</p>
<p>// function to print a device address<br />
	//void printAddress(DeviceAddress deviceAddress)<br />
	//{<br />
	//&nbsp; for (uint8_t i = 0; i &lt; 8; i++)<br />
	//&nbsp; {<br />
	//&nbsp;&nbsp;&nbsp; if (deviceAddress[i] &lt; 16) Serial.print(&quot;0&quot;);<br />
	//&nbsp;&nbsp;&nbsp; Serial.print(deviceAddress[i], HEX);<br />
	//&nbsp; }<br />
	//}</p>
<p>***************************************************************************************</p>
  <div class="forum-topic-navigation clear-block">
          <a href="5699.html" class="topic-previous" title="Go to previous forum topic">‹ Trying to pass empty value with csv input api</a>
              <a href="5658.html" class="topic-next" title="Go to next forum topic">there is a function? ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-22627"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Unable to detect DS18B20 sensor addresses and long one-wire radius problem</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 20/07/2014 - 01:17.</div>
    <div class="content">
     <p>I don&#39;t think we know very much that is not in the Building Blocks page &quot;DS18B20 temperature sensing&quot;. You&#39;ll find a link to a sketch to get the addresses of the sensors, but remember, all that was written for the emonTx V2, so you will need to make some small changes to suit the V3. Have you checked out the driver IC for long cable runs? - the problem there is you are most probably getting reflections because the cable is acting as a transmission line that does not have the proper terminating impedances, so the data is going backwards and forwards and interfering with itself. The idea of the resistor is to try to alleviate that problem, the driver IC should do a better job. Maxim&#39;s &quot;Guidelines&quot; app. note seems to infer 150 m should be possible.</p>
<p>As far as I know, nobody has tried to use the DS18B20 over a distance of 60 m, but we have had success reported at 30 m. If you still have no success, you might like to consider using a separate emonTH instead of the cable.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22637"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6496.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="WernerOpenEM&#039;s picture" title="WernerOpenEM&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Unable to detect DS18B20 sensor addresses and long one-wire radius problem</h3>

    <div class="submitted">Submitted by <a href="../user/6496.html" title="View user profile.">WernerOpenEM</a> on Sun, 20/07/2014 - 15:26.</div>
    <div class="content">
     <p>Thanks for your Reply Robert.</p>
<p>&nbsp;</p>
<p>I managed to solve <strong>problem 1 </strong>by doing the following:</p>
<pre>
<em>for (int i=0; i&lt;numSensors; i++)
      {
        Serial.print(&quot;Printing address of sensor&quot;); Serial.print(i); Serial.print(&quot;: &quot;);
         for (uint8_t j = 0; j &lt; 8; j++)
         {
           if (allAddress[i][j] &lt; 16) Serial.print(&quot;0&quot;);
            Serial.print(allAddress[i][j], HEX);
         }
         Serial.println(&quot;&quot;);
      }</em></pre><p>There are still some options to make it neater, but for now this works fine. &nbsp;Anycase, this will only be required initially when you add new sensors.</p>
<p>&nbsp;</p>
<p>ito <strong>Problem 2:</strong> I also thought the problem is related to reflections and spent a lot of time on researching resistor options to see if it will solve it, but to no avail. &nbsp;A lot of the Arduino pages suggest that long cable runs/one-wire radius are possible. &nbsp;I&#39;ll try twisted&nbsp;CAT5 cable to see how that goes. &nbsp;If I go a 2nd EmonTH I will have different transmission issues as my hot water tanks are solar powered and on my roof. &nbsp;I was hoping to run a single cable and plug in a number or TempSensors for various measurements. What do you mean when you say&nbsp;</p>
<blockquote><p>&quot;.....the driver IC should do a better job.&quot;</p>
</blockquote>
<p>Are you referring to the DS18B20?</p>
<p>&nbsp;</p>
<p>Thanks</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-22638"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Unable to detect DS18B20 sensor addresses and long one-wire radius problem</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 20/07/2014 - 15:44.</div>
    <div class="content">
     <p>Quote from the page you said you had studied for a long time:</p>
<p>&quot;Notes and further reading</p>
<p>For large numbers of sensors and long cable runs use the DS2480B 1-wire driver chip. More info here.&quot;</p>
<p>On Maxim&#39;s website, you will find some Application Notes that might help you.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23509"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6496.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="WernerOpenEM&#039;s picture" title="WernerOpenEM&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Unable to detect DS18B20 sensor addresses and long one-wire radius problem</h3>

    <div class="submitted">Submitted by <a href="../user/6496.html" title="View user profile.">WernerOpenEM</a> on Tue, 02/09/2014 - 07:26.</div>
    <div class="content">
     <p>Hi, so after 6 weeks I managed to get some more time to play with this prolem of mine(I blame wife, work and kids)</p>
<p>&nbsp;</p>
<p>I am still not able to use the built in 1-wire connections on the Tx3 to get a single ds18b20 temp sensor to work over a 60m cable(tried a few cables incl cat5e).</p>
<p>After reading up a bit more on the option as documented on the Wiki and pointed out by Robert Wall I came to the conclusion that the DS2480&nbsp;driver chip will require it&#39;s own serial connections on whatever board you use it(TX3 or R-Pi or Arduino etc). &nbsp;Currently in my setup the Tx3 is transmitting wirelessly to my R-Pi which has the RFM12pi shield plugged in. &nbsp;So using my R-Pi&#39;s serial connection is not an option.</p>
<p><strong>QUESTION</strong>: Would you suggest that my best course of action is to use the Tx3&#39;s but then will have to unplug and reconnect various connections during development phase while I upload sketches with the programmer etc.?</p>
<p>I could always just have a 2nd R-Pi that drive just my 1-wire network?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23516"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Unable to detect DS18B20 sensor addresses and long one-wire radius problem</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 02/09/2014 - 11:40.</div>
    <div class="content">
     <p>What does your temperature sensor network look like?&nbsp; From what you wrote earlier, you have many sensors close to each other, but then a long cable run to your RPi. If I&#39;m correct, then either a second RPi (presumably you&#39;d use Ethernet and the Cat5e that you tested with to get the data back) or a second emonTx, without the driver IC, might be the easier option.</p>
<p>I can well understand that development of the software for the DS 2480 would be hard without a second serial port, and that&#39;s the main reason for suggesting the RPi / second emonTx solution.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23529"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6496.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="WernerOpenEM&#039;s picture" title="WernerOpenEM&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Unable to detect DS18B20 sensor addresses and long one-wire radius problem</h3>

    <div class="submitted">Submitted by <a href="../user/6496.html" title="View user profile.">WernerOpenEM</a> on Tue, 02/09/2014 - 19:56.</div>
    <div class="content">
     <p>Thanks Robert. &nbsp;Correct, all my sensors are between 40 and 60m from my &quot;server room&quot;, so a 2nd Pi with a &nbsp;cat5 cable might be the only option. &nbsp;I&#39;ll have to run a 2nd cable for power though, unless I manage to keep my 2nd Pi in my &quot;server room&quot; and just hook the sensors on the cable at the far end. &nbsp;Assuming I have no long cable run issues on the Pi and DS2480 driver.</p>
<p>Will post back here when I eventually manage to solve it.</p>
<p>Thanks for your quick replies.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5429"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-yZUFDwcC8NMUHd0tV4W-aG-nZyTP4yjyeNb9CKOxXiU" value="form-yZUFDwcC8NMUHd0tV4W-aG-nZyTP4yjyeNb9CKOxXiU"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
