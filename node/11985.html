<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/11985 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:48:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Move emoncms.org data to local install of emoncms | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Move emoncms.org data to local install of emoncms</h3>
        <span class="submitted">Submitted by <a href="../user/9108.html" title="View user profile.">ChrisValentine</a> on Wed, 13/01/2016 - 10:41</span>
        <div class="content"><p>I have downloaded the latest (9.3) emoncms from GitHub, got it running with the required database settings and created a user account with the same username and password that I had on emoncms.org</p>
<p>I now want to migrate the data already on emoncms.org to my own server (Linux). I have downloaded backup.php from &quot;usefulscripts&quot; but I can&#39;t get it to work. I&#39;m not entirely clear on the settings in that script - for example it asks for the WRITE API key for emoncms.org - why isn&#39;t that the READ key?</p>
<p>Initially the script wouldn&#39;t run at all because it couldn&#39;t find process_settings.php - I tweaked the &#39;require&#39; line to be:</p>
<p>require $_SERVER[&#39;DOCUMENT_ROOT&#39;].&quot;/process_settings.php&quot;;</p>
<p>...but now its complaining &quot;Class &#39;Redis&#39; not found&quot;</p>
<p>Its also not clear what $local_emoncms_location should be set to if I want the data to go into my own emoncms installation - should that be a folder path or a URL?</p>
<p>Can anyone help please? Nowhere does it say where &quot;usefulscripts&quot; should be installed. I don&#39;t want to lose the data we&#39;ve already collected.</p>
<p>Chris.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12129.html" class="topic-previous" title="Go to previous forum topic">‹ Possible MQTT_INPUT bug</a>
              <a href="12091.html" class="topic-next" title="Go to next forum topic">emonhub emon-pi variant MQTT support &amp; Emoncms MQTT input service   ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-38423"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9108.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9108.jpg" alt="ChrisValentine&#039;s picture" title="ChrisValentine&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/9108.html" title="View user profile.">ChrisValentine</a> on Mon, 18/01/2016 - 10:25.</div>
    <div class="content">
     <p>I note that backup.php appears to ignore the value of $redis_enabled in the settings file - as I have it set to false.</p>
<p>Can anyone shed any light on this? I don&#39;t have any data on my new server - I specifically want to grab the historical data first.</p>
<p>Chris.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38484"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9108.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9108.jpg" alt="ChrisValentine&#039;s picture" title="ChrisValentine&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/9108.html" title="View user profile.">ChrisValentine</a> on Tue, 19/01/2016 - 10:02.</div>
    <div class="content">
     <p>OK, looks like Redis is now enabled on our server but I&#39;m getting other errors:</p>
<p>Uncaught exception &#39;RedisException&#39; with message &#39;Redis server went away&#39; in /data/web/greendata.kmi.open.ac.uk/www/backup/lib/metadata.php:22 Stack trace: #0 /data/web/greendata.kmi.open.ac.uk/www/backup/lib/metadata.php(22): Redis-&gt;hMset(&#39;feed:102381&#39;, Array) #1 /data/web/greendata.kmi.open.ac.uk/www/backup/backup.php(89): register_emoncms_feed(Object(mysqli), Object(Redis), Object(stdClass)) #2 {main} thrown in /data/web/greendata.kmi.open.ac.uk/www/backup/lib/metadata.php on line 22</p>
<p>Chris</p>
<p><em>Edit - duplicate posts deleted</em><br />
<em><strong><a href="11355.html">Please don&#39;t make duplicate posts</a></strong><br />
Moderator - BT</em></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38540"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9108.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9108.jpg" alt="ChrisValentine&#039;s picture" title="ChrisValentine&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/9108.html" title="View user profile.">ChrisValentine</a> on Wed, 20/01/2016 - 11:17.</div>
    <div class="content">
     <p>Despite the error messages it does appear that some data has been imported. If I view the Feeds list on our installation, the Updated column just shows n/a and the Value column is all NULL, but the Size column numbers are quite close to what&#39;s stated on emoncms.org - does this mean I have the data now or only part of it?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38543"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9108.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9108.jpg" alt="ChrisValentine&#039;s picture" title="ChrisValentine&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/9108.html" title="View user profile.">ChrisValentine</a> on Wed, 20/01/2016 - 11:28.</div>
    <div class="content">
     <p>...maybe not. If I click on any of the eye icons I get errors like:</p>
<p>Request error {&quot;success&quot;:false,&quot;message&quot;:&quot;Error reading meta data feedid=102381&quot;}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38575"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9108.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9108.jpg" alt="ChrisValentine&#039;s picture" title="ChrisValentine&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/9108.html" title="View user profile.">ChrisValentine</a> on Thu, 21/01/2016 - 10:22.</div>
    <div class="content">
     <p>I found that the default Redis folders did not exist on the server (off /var/lib) so I&#39;ve created them in a different place and changed settings.php to reflect that. If I empty the feeds table then run backup.php again I see:</p>
<p>Warning: Invalid argument supplied for foreach() in /data/web/greendata.kmi.open.ac.uk/www/backup/lib/inputs.php on line 8<br />
11 Emoncms.org feeds found Create feed 102381<br />
Fatal error: Uncaught exception &#39;RedisException&#39; with message &#39;Redis server went away&#39; in /data/web/greendata.kmi.open.ac.uk/www/backup/lib/metadata.php:22</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39022"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9108.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9108.jpg" alt="ChrisValentine&#039;s picture" title="ChrisValentine&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/9108.html" title="View user profile.">ChrisValentine</a> on Tue, 02/02/2016 - 11:55.</div>
    <div class="content">
     <p>In the end I&#39;ve given up. Lost a load of historic data but I guess I&#39;ll just have to put up with it. Frankly disappointed that this procedure isn&#39;t properly implemented or supported.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39054"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 03/02/2016 - 08:02.</div>
    <div class="content">
     <p>Hello Chris</p>
<p>Sorry to not have seen your posts sooner. On closer inspection of the backup script I realise that I accidentally uploaded local changes to the script that I was using for local backups to the github repository. I have now reverted them back and tested downloading to emoncms v9.3 running locally and it all ran ok.</p>
<p>The location of usefulscripts on your computer doesnt really matter, I have mine on my desktop. There is also no need to have the same account credentials on the local install to mirror the remote.</p>
<p>The backup script needs to be ran as root:</p>
<p>&nbsp;&nbsp;&nbsp; sudo php backup.php</p>
<p>The main settings to look out for in backup.php are:</p>
<p>&nbsp;&nbsp;&nbsp; $remote_server = &quot;http://emoncms.org&quot;;</p>
<p>This is the remote server from which to download the data, here emoncms.org by default.</p>
<p>&nbsp;&nbsp;&nbsp; $remote_apikey = &quot;WRITE-APIKEY&quot;;</p>
<p>Yes, write apikey - no writing is actually being done, the writekey is more for elevated permissions here as a full download would ideally require higher level access to an account.</p>
<p>&nbsp;&nbsp;&nbsp; $link_to_local_emoncms = true;</p>
<p>Link to local needs to be true for the data to appear in your local emoncms account. This will create all the mysql and redis entries for the feeds. With link to local set to false the data will just be downloaded locally as a backup.</p>
<p>&nbsp;&nbsp;&nbsp; $local_emoncms_location = &quot;/var/www/emoncms/&quot;;</p>
<p>If your local emoncms is in a different location such as /var/www/html/emoncms this line will need amending.</p>
<p>&nbsp;&nbsp;&nbsp; $local_emoncms_userid = 1;</p>
<p>This is the line that specifies the local emoncms account to link the data with. If its the first user registered on the local emoncms the user id will be 1.</p>
<p>&nbsp;&nbsp;&nbsp; $backup_inputs = true;</p>
<p>Backup_inputs can be used to make a local backup of all inputs and input processing. Useful for moving emoncms installs between raspberrypi&#39;s</p>
<p>&nbsp;&nbsp;&nbsp; $dir = &quot;/var/lib&quot;;</p>
<p>$dir specifies the data location which is usually /var/lib on non emonpi linux systems or /home/pi/data on the emonpi/emonbase.</p>
<p>&nbsp;</p>
<p>I will look into modifying the script to check if redis is enabled in the local emoncms settings.php so that its not a requirement.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39055"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 03/02/2016 - 08:20.</div>
    <div class="content">
     <p>Ok, I&#39;ve modified the backup script to be able to run without redis if redis_enabled is set to false in the local emoncms settings.php. Tested it and it works ok.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39076"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/9108.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-9108.jpg" alt="ChrisValentine&#039;s picture" title="ChrisValentine&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Move emoncms.org data to local install of emoncms</h3>

    <div class="submitted">Submitted by <a href="../user/9108.html" title="View user profile.">ChrisValentine</a> on Wed, 03/02/2016 - 13:23.</div>
    <div class="content">
     <p>Does this mean that if I download the latest version I could now grab the historic data without it upsetting the new data?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/11985"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-pMKvKuYAk_q3HqZpvObWpsUz66nBCy5hBTP-kIAGlog" value="form-pMKvKuYAk_q3HqZpvObWpsUz66nBCy5hBTP-kIAGlog"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
