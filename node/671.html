<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/671 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:18:05 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Light sensor and two tri-color ambient indicator LED&#039;s | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Light sensor and two tri-color ambient indicator LED&#039;s</h3>
        <span class="submitted">Submitted by <a href="../user/985.html" title="View user profile.">esawyja</a> on Thu, 10/05/2012 - 11:35</span>
        <div class="content"><p>Hi,</p>
<p>What is the Light Sensor used for? I&#39;m running the<span style="font-family: monospace;"> </span>emonGLCD_HEM: Home Energy Monitor Example sketch and I do not see a different display during day time or night time (What I suspect the Light Sensor is used for), except for the backlight to switch off at the times defined in the sketch. Also with the&nbsp;emonGLCD_HEM: Home Energy Monitor Example are the tri-color LED used at all?</p>
<p>Thanks</p>
  <div class="forum-topic-navigation clear-block">
          <a href="1116.html" class="topic-previous" title="Go to previous forum topic">‹ Radio Control</a>
              <a href="1031.html" class="topic-next" title="Go to next forum topic">Feed status active/inactive ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-4387"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 12/05/2012 - 07:27.</div>
    <div class="content">
     <p>Hello, yes your right, the tri-color LED&#39;s and light sensor are not used in the home energy monitor sketch.</p>
<p>The tri-color LED&#39;s are used in the PV monitoring sketch and we are yet to use the light sensor, but added it on there for future developments, your welcome to make use of it!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4591"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Fri, 25/05/2012 - 22:25.</div>
    <div class="content">
     <p>Update: their used now! The latest version of the Home Energy Monitor and Solar PV emonGLCD examples use the light level reading from the LCR to adjust the brightness level of the backlight. In bright light the backlight dims to save power.&nbsp;</p>
<p>I have also implemented the tri colour LED&#39;s in the Home Energy Monitor example, the brightness of the red LED varies smoothly depending on the amount of power being consumed. This feature is a bit experimental, let us know what you think.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-4824"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/985.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-985.jpg" alt="esawyja&#039;s picture" title="esawyja&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/985.html" title="View user profile.">esawyja</a> on Fri, 15/06/2012 - 07:04.</div>
    <div class="content">
     <p>Brilliant, thanks Glyn, will try it out this weekend</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6539"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Sun, 07/10/2012 - 10:18.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Still very noobie for this as just got everything up and running. Could you please point me to the direction of how enabling backlight in the HomeEnergyMonitor (newest version from github).</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6540"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Sun, 07/10/2012 - 10:21.</div>
    <div class="content">
     <p>Ah - sorry for the silly question, there seemed to be a hardcoded clock time when the background light does not work and as I do not yet have EmonBASE running therefore of course the backgligh did not work.</p>
<p>Maybe in one of the future versions this includes also if (emonbase_notfound) then glcd.backLight(LDRbacklight);</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6542"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 07/10/2012 - 14:35.</div>
    <div class="content">
     <p>I too have been looking at controlling both the backlight and the LED brightness - taking incident light and, for the LEDs, the power too into account. The big complication is the human eye works on a logarithmic scale, hence it is necessary to take account of that in the algorithm.</p>
<p>The objective was to maintain the backlight and LEDs at a constant perceived brightness irrespective of the ambient lighting conditions. So in bright conditions, backlight and LEDs are at maximum and in low light, both backlight and LEDs dim. It&#39;s early days yet but this seems to work reasonably well:</p>
<p>	<font face="Helvetica, Arial,<br />
        sans-serif">LED = 3.0 * 2 ^&nbsp; (LDR * 0.0033 - 1)&nbsp; *&nbsp; 2 ^ (pu_power * 3.2 - 1)&nbsp; *&nbsp; 2 ^ (LDR * pu_power * 0.0036 - 1)&nbsp; </font></p>
<p>	<font face="Helvetica, Arial, sans-serif">where</font></p>
<p class="rteindent1"><font face="Helvetica, Arial, sans-serif">LED is the PWM output scaled 0-255,<br />
	LDR is the light level from the sensor (scaled 0 - 1023),<br />
	pu_power is per unit power, scaled 0 - 1.0<br />
	&#39; ^ &#39; is of course exponentiation [in Arduino-speak: pow(2,n) ]</font></p>
<p><font face="Helvetica, Arial, sans-serif">The output (LED) needs to be limited to a maximum value of 255, which happens when the power is 100% and light is about 900.</font></p>
<p>The coefficients can be adjusted to change the relative effect of the inputs. Don&#39;t try this in a sketch, the best way to see what is happening is to write the equation into a spreadsheet and plot the values of LED (on a log scale) against light level with power as a parameter (I used steps of 25%, more gets confusing) and play with the numbers there before importing the values into your sketch.</p>
<p>For controlling the backlight, the same equation can be used, giving it a constant power of 1.05 (yes! - it means it hits maximum brightness slightly earlier than the LEDs). This works in the opposite direction to Glyn&#39;s - it reduces the backlight in low light levels thereby attempting to maintain a constant perceived brightness and contrast ratio.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6544"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1399.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1399.jpg" alt="Series530&#039;s picture" title="Series530&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/1399.html" title="View user profile.">Series530</a> on Sun, 07/10/2012 - 16:35.</div>
    <div class="content">
     <p>In my fusion of MK2 controller and EmonGLCD I use the backlight and the LDR sensor.&nbsp;</p>
<p>The light sensor monitors the ambient light level and adjusts the LCD display to compensate for room brightness. I don&#39;t bother to maintain a constant brightness simply to make sure that when the light levels are low the LCD display backlight doesn&#39;t blind anybody who may be in the room.</p>
<p>I also use the LED&#39;s to show if the data received from the emonTX&nbsp;indicates that the system is importing or exporting power. The LED&#39;s are set to run red if the house is importing and green if it is exporting.&nbsp;</p>
<p>The LED&#39;s are set to stay on constantly if the light level is reasonably high and they turn off if the light level detected by the LDR shows a low level of light.</p>
<p>In addition to all of this, the LED&#39;s provide a heart beat to indicate that the system is receiving data from the emonTX. If the LED&#39;s are running constantly on they will momentarily pulse off every 4 seconds to show the receipt of data. Similarly, if the light level is low they will momentarily pulse on either red or green so as to indicate household import or export.</p>
<p>Take a look at the emonGLCD receiver sketch&nbsp;</p>
<p><a href="1103.html" title="http://openenergymonitor.org/emon/node/1103">http://openenergymonitor.org/emon/node/1103</a></p>
<p>to see how it all threads together.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6546"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1747.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1747.jpg" alt="Petrik&#039;s picture" title="Petrik&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/1747.html" title="View user profile.">Petrik</a> on Sun, 07/10/2012 - 18:26.</div>
    <div class="content">
     <p>Good ideas - here is one more: Regardless of what are the other thoughts of Wattson (RIP) there was two particularly fine features in it: BIG numbers and varying colour based on consumption. So decided to&nbsp;make emonGLCD to show green light ath the background&nbsp;when consumption is low, red when its high - varying in between.</p>
<p>My maxPower during winter heating is 9Kw and normal summer time consumption around 650-800w. The below gives green light for below 1kw and moving gradually to full red. The dividers of /5 and /10 are used for adjusting the colour change to my preference.</p>
<p>...</p>
<p>&nbsp;&nbsp;&nbsp;int greenPWRleds= map(cval, maxPower/5, 0, 0, 200);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp; int redPWRleds= map(cval, maxPower/10, maxPower, 0, 200);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp; redPWRleds = constrain(redPWRleds, 0, 200);&nbsp;&nbsp;&nbsp;&nbsp;<br />
	&nbsp;&nbsp; greenPWRleds = constrain(greenPWRleds, 0, 200);&nbsp;&nbsp;&nbsp;</p>
<p>...</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;analogWrite(redLED, redPWRleds);&nbsp;&nbsp;<br />
	&nbsp;&nbsp;&nbsp;&nbsp;analogWrite(greenLED, greenPWRleds);</p>
<p>....</p>
<p><img alt="emonGLCD" src="../../../www.macmadigan.com/ilp/emonGLCD.jpg" style="width: 320px; height: 240px;" /></p>
<p>the efergy LCD on right is just showing the air to water heatpump consumption, not noticeable at all whereas emonGLCD really shows when the tumbledryer and washing machine together are burning energy</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-6547"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1399.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1399.jpg" alt="Series530&#039;s picture" title="Series530&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Light sensor and two tri-color ambient indicator LED's</h3>

    <div class="submitted">Submitted by <a href="../user/1399.html" title="View user profile.">Series530</a> on Sun, 07/10/2012 - 19:40.</div>
    <div class="content">
     <p>Having a Wattson&nbsp;(as well as everything else), I can totally relate to your idea ! Nice one !!!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/671"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-_yYoaEV0ZDBncZZM15wB0QIbLruspGfQStwBNG6ZrT8" value="form-_yYoaEV0ZDBncZZM15wB0QIbLruspGfQStwBNG6ZrT8"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/671 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:18:09 GMT -->
</html>
