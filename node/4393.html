<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/4393 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:43:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Setting up OemGateway | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Setting up OemGateway</h3>
        <span class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Thu, 27/03/2014 - 16:49</span>
        <div class="content"><p>Hi</p>
<p>I am trying to set up OemGateway to send data from my PI live to a PI test slave setup on the same network.</p>
<p>The PI Live does not use a&nbsp;RFM12B module.&nbsp;My PI Live is a remote server on a fixed IP address using the internet to get data from an emontx in a completely different location.</p>
<p>I am not sure of the requirements in this part of the config&nbsp;file</p>
<p><strong>[[emoncms_local]]<br />
	&nbsp; type = OemGatewayEmoncmsBuffer<br />
	[[[init_settings]]]<br />
	[[[runtime_settings]]]<br />
	&nbsp; domain = localhost<br />
	&nbsp; apikey = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br />
	&nbsp; protocol = http://<br />
	&nbsp; active = False<br />
	&nbsp; path = /emoncms</strong></p>
<p><strong>[[emoncms_remote]]<br />
	&nbsp; type = OemGatewayEmoncmsBuffer<br />
	[[[init_settings]]]<br />
	[[[runtime_settings]]]<br />
	&nbsp; domain = emoncms.org<br />
	&nbsp; apikey = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br />
	&nbsp; protocol = http://<br />
	&nbsp; active = True<br />
	&nbsp; path =</strong></p>
<p>My test slave is located at <a href="http://192.168.1.77/emoncms/" title="http://192.168.1.77/emoncms/">http://192.168.1.77/emoncms/</a></p>
<p>Where do I put that information? I assume API key on remote is the API key of the slave. Do I put the API key of the PI live in the emoncms_local settings and do I need to change anything else in the local settings?</p>
<p>Regards</p>
<p>Ian</p>
  <div class="forum-topic-navigation clear-block">
          <a href="4891.html" class="topic-previous" title="Go to previous forum topic">‹ Emonth count gazmeter</a>
              <a href="4439.html" class="topic-next" title="Go to next forum topic">EmonCMS V8 Firefox (not only) related issues ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-19917"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1741.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1741.jpg" alt="ukmoose&#039;s picture" title="ukmoose&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1741.html" title="View user profile.">ukmoose</a> on Thu, 27/03/2014 - 17:55.</div>
    <div class="content">
     <p>Its my understanding that those settings are just for writing to the database. &nbsp;So try this:</p>
<pre>
[[emoncms_local]]
  type = OemGatewayEmoncmsBuffer
[[[init_settings]]]
[[[runtime_settings]]]
  domain = <strong>192.168.1.77</strong>
  apikey = <strong>&lt;READ AND WRITE API KEY FROM Input API help on YOUR LOCAL EMONCMS INSTANCE&gt;</strong>
  protocol = http://
  active = <strong>True</strong>
  path = /emoncms

[[emoncms_remote]]
  type = OemGatewayEmoncmsBuffer
[[[init_settings]]]
[[[runtime_settings]]]
  domain = emoncms.org
  apikey = xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
  protocol = http://
  active = <strong>False</strong>
  path =</pre><p>&nbsp;</p>
<p>I reserve emoncms_remote for emoncms.org, so if you are not using emoncms.org set active to false.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19946"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Thu, 27/03/2014 - 20:12.</div>
    <div class="content">
     <p>Thanks</p>
<p>I have done that and started oemgateway.</p>
<p>I am not seeing any inputs so I must have something wrong. Where does the log file end up?</p>
<p>Regards</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19947"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1741.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1741.jpg" alt="ukmoose&#039;s picture" title="ukmoose&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1741.html" title="View user profile.">ukmoose</a> on Thu, 27/03/2014 - 20:43.</div>
    <div class="content">
     <p>Are you sure that the data is getting to the oemgateway script?</p>
<p>Oemgateway&nbsp;either gets data from a&nbsp;RFM12Pi on the same computer (via serial port) or via listening on a socket.</p>
<p>You can setup the log file location from the command line otherwise it is directed to&nbsp;sys.stderr</p>
<p>&nbsp;</p>
<p>Have a look at the source code&nbsp;https://github.com/Jerome-github/oem_gateway/blob/master/oemgateway&nbsp;approx line180.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19974"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 28/03/2014 - 11:01.</div>
    <div class="content">
     <p>Hi Ian, Did you get this sorted?&nbsp;</p>
<p>Having tried this last night I can confirm the oemgateway forwarder used in the RO image will forward both socket and serial packets, to emoncms locally on same machine, same network or remotely hosted (in fact it can do all 3 at once if you add another buffer in oemgateway.conf) so these details should work for you.</p>
<p><strong>[[emoncms_local]]<br />
	&nbsp; type = OemGatewayEmoncmsBuffer<br />
	[[[init_settings]]]<br />
	[[[runtime_settings]]]<br />
	&nbsp; domain = IP.OF.LIVE.PI<br />
	&nbsp; apikey = API KEY OF LIVE EMONCMS<br />
	&nbsp; protocol = http://<br />
	&nbsp; active = True<br />
	&nbsp; path = /emoncms</strong></p>
<p><strong>[[emoncms_remote]]<br />
	&nbsp; type = OemGatewayEmoncmsBuffer<br />
	[[[init_settings]]]<br />
	[[[runtime_settings]]]<br />
	&nbsp; domain = IP.OF.TEST.PI<br />
	&nbsp; apikey = API KEY OF TEST&nbsp;EMONCMS<br />
	&nbsp; protocol = http://<br />
	&nbsp; active = True<br />
	&nbsp; path = /emoncms</strong></p>
<p>Getting oemgateway to install and run was a bit fiddly&nbsp;due to some permission issues, but once it started everything worked really well</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19982"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Fri, 28/03/2014 - 13:11.</div>
    <div class="content">
     <p>Hi</p>
<p>Thanks. Not working yet because I think I had not configured port number correctly.</p>
<p>I set that to 80 which is what I thought it is but get an error:-</p>
<p>2014-03-28 13:04:46,954 INFO Logging level set to DEBUG<br />
	2014-03-28 13:04:46,958 INFO Opening gateway...<br />
	2014-03-28 13:04:46,963 INFO Creating buffer emoncms_local<br />
	2014-03-28 13:04:46,970 INFO Creating buffer emoncms_remote<br />
	2014-03-28 13:04:46,975 INFO Creating listener RFM2Pi<br />
	2014-03-28 13:04:46,981 DEBUG Opening serial port: /dev/ttyAMA0<br />
	2014-03-28 13:04:46,988 INFO Setting send time interval to 0<br />
	2014-03-28 13:04:46,992 INFO Setting RFM2Pi | frequency: 4<br />
	2014-03-28 13:04:47,997 INFO Setting RFM2Pi | sgroup: 210<br />
	2014-03-28 13:04:49,002 INFO Setting RFM2Pi | baseid: 15<br />
	2014-03-28 13:04:50,006 INFO Creating listener Socket<br />
	2014-03-28 13:04:50,011 DEBUG Opening socket on port 80<br />
	2014-03-28 13:04:50,016 ERROR [Errno 13] Permission denied<br />
	2014-03-28 13:04:50,021 ERROR Could not open port 80<br />
	^C2014-03-28 13:04:58,990 DEBUG SIGINT received.<br />
	2014-03-28 13:04:58,994 DEBUG Closing serial port.<br />
	2014-03-28 13:04:58,997 INFO Exiting gateway...</p>
<p>Still investigating!</p>
<p>I will change config to your example.</p>
<p>Regards</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19984"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 28/03/2014 - 13:23.</div>
    <div class="content">
     <p>the default port oemgateway listens to is port 50011, it may be better to change it back and match it at the other (emontx) end since you are not sending direct to emoncms&nbsp;now.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-19997"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Fri, 28/03/2014 - 16:12.</div>
    <div class="content">
     <p>Hi Paul</p>
<p>I am a bit lost on port addressing(but learning!).</p>
<p>My Live PI is on a fixed IP internet connection. My emontx is located remotely and sends data over the internet.</p>
<p>I have port forwarding set up on the router for the emoncms as follows.</p>
<p># Service Name &nbsp; External Start Port &nbsp; External End Port &nbsp; Internal Start Port &nbsp; Internal End Port &nbsp;<br />
	4 Emon&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 80 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p>
<p>Internal IP address</p>
<p>192.168.1.9</p>
<p>I changed the oemgateway&nbsp;to listen to port 5011 and it starts without an error message. I then changed the internal port forwarding to match 50011.</p>
<p>This has an immediate effect on the oemgateway&nbsp; which is giving warnings like this:-</p>
<p>2014-03-28 16:04:43,630 WARNING Misformed RX frame: [&#39;GET&#39;, &#39;/emoncms/input/post.json?apikey=********06d069745bfe8dac70040261&amp;node=28&amp;csv=0,0&#39;, &#39;HTTP/1.0&#39;]<br />
	2014-03-28 16:04:43,864 INFO Serial RX: Host:<br />
	2014-03-28 16:04:43,869 WARNING Misformed RX frame: [&#39;Host:&#39;]<br />
	2014-03-28 16:04:44,075 INFO Serial RX: Accept: text/html<br />
	2014-03-28 16:04:44,079 WARNING Misformed RX frame: [&#39;Accept:&#39;, &#39;text/html&#39;]<br />
	2014-03-28 16:04:44,283 INFO Serial RX:<br />
	2014-03-28 16:04:44,287 WARNING Misformed RX frame: [&#39;&#39;]</p>
<p>Sadly it also has the effect that I can no longer log in to my Live PI over the internet. I can log in to the live PI using the network address but the inputs are not updating. So I am not sure what to do next. It would seem I need to give oemgateway access to port 80 but I don&#39;t know how.</p>
<p>Regards</p>
<p>Ian</p>
<p>[Edited: APIkey fudged - RW]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20001"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Fri, 28/03/2014 - 16:37.</div>
    <div class="content">
     <p>I&#39;m not familiar with port forwarding but I would of thought you could leave the live pi exactly as it was and change emontx to send to LIVE.PI.IP port 50011 and then enter whatever address your emontx was originally sending to in the oemgateway.conf in one buffer along with the test pi address in the other buffer. that should retain your previous access as you are just putting oemgateway in between emontx and live pi.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20002"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Sun, 30/03/2014 - 09:14.</div>
    <div class="content">
     <p>&nbsp;</p>
<p>Hi Paul</p>
<p>Not so easy. I am using a nanodeRF&nbsp; located at different premises and I don&#39;t really want to lose data collection.</p>
<p>My emontx&nbsp;data is all collected by the nanode.</p>
<p>My Live PI server &nbsp;is working well and has done for many months. I was setting up a test slave PI to evaluate emoncms V8&nbsp;before I upgrade and to help with the testing of V8 if I can.</p>
<p>The nanode is sending data to a static address set by this line of code:-</p>
<p>static byte hisip[] = { 85,***,188,38 };</p>
<p>Out of interest does anyone know if the port number can just be added to this in the normal format:-</p>
<p>static byte hisip[] = { 85,***,188,38<strong>:50011</strong> };</p>
<p>&nbsp;</p>
<p>Regards</p>
<p>Ian</p>
<p>[Edit: IP address fudged - RW]</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20196"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 30/03/2014 - 10:20.</div>
    <div class="content">
     <p>Hi Ian - You should maybe mask some&nbsp;<span style="font-size: 12px;">digits&nbsp;</span><span style="font-size: 12px;">off</span><span style="font-size: 12px;">&nbsp;in your last post</span><span style="font-size: 12px;">&nbsp;!</span></p>
<p>I&#39;m guessing this isn&#39;t going to work as even if it did send to that ip/port it will clash with existing port forwarding. It seems from the previous prints the oemgateway isn&#39;t able to decode the complex url from nanode when using port 50011 so giving it access to&nbsp;<span style="font-size: 12px;">port</span><span style="font-size: 12px;">&nbsp;</span><span style="font-size: 12px;">80 probably won&#39;t resolve the issue. You maybe able to get around it by changing url&nbsp;template at the nanode but I think this would then be insecure as it appears the oemgateway&nbsp;requires no authentication, in fact&nbsp;it will add its own API key validating everything it receives.&nbsp;</span></p>
<p><span style="font-size: 12px;">So probably&nbsp;oemgateway&nbsp;will need modifying for this to work</span></p>
<p><span style="font-size: 12px;">Paul</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20200"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 30/03/2014 - 11:04.</div>
    <div class="content">
     <p>You can&#39;t do &quot;static byte hisip[] = { 85,***,188,38:50011 };&quot;&nbsp; because that is trying to fill an array, and the syntax is illegal - 38:50011 is not an integer. You&#39;ll need to delve very deeply into the Ethercard library to find out how to add the port (always assuming that you can). So while I can tell you why it won&#39;t work, I&#39;m sorry but I can&#39;t tell you how to fix it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20201"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Sun, 30/03/2014 - 11:28.</div>
    <div class="content">
     <p>Hi</p>
<p>Many thanks.</p>
<p>I will forget this for now as it was only for testing purposes. Robert - &nbsp;thanks for changing the IP address. It may have been interesting &nbsp;to see how well my router firewall works as there are only 4 ports exposed and they are all pointing to uncritical web pages. However probably best not to find out is does not work the hard way.</p>
<p>Lesson learned, don&#39;t cut and paste without thinking.</p>
<p>Regards</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20244"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 31/03/2014 - 09:58.</div>
    <div class="content">
     <p>Hi.</p>
<p>Not sure I get the point, but I think there is a misunderstanding.</p>
<p>The gateway is a repeater. It gets data from the emonTX (generally locally) and sends it to one or several emoncms servers. Those servers can be anywhere, even on the same machine, in which case the domain is localhost. The name &quot;emoncms_local&quot; is just a convenient name, it can be changed and any number of &quot;emoncms buffers&quot; can be created ion the gateway. This config file is just an example. Anything can be changed.</p>
<p>When the gateway sends data to an emoncms server, it formats it as a http request. Which means it sends it to that server on the 80 port (I suppose) or the https one, if configured so and if this works on server side (never checked). Apache (or nginx, or whatever) on the server side passes it to the emoncms instance on that server, and the rest is history.</p>
<p>The socket listener of the gateway (the one that opens a port) is very specific. It opens a new port (I chose 50xxx to be sure it was a free port, since it is not currently reserved, you can pick another open one if it is already open) and reads it as you would read a COM port. It expects raw data of the form</p>
<pre>
NodeID val1 val2 val3</pre><p>See the example in the gateway directory. There is no &quot;mainstream&quot; application of this. It is here to help anyone wanting to send data from a custom application like a sensor reader.</p>
<p>It is not clear to me what you want to do. If you want to receive data on an emoncms instance on one Pi, then forward it to another, well, this is not possible. emoncms does not do this. And the gateway is not concerned, since the data is sent to emoncms, not to it, on the first Pi.</p>
<p>The solution is to send to both Pis from the emonTX. There was a thread about this. I don&#39;t think there is another way, unless such feature was added in emoncms since then (which I doubt).</p>
<p>That is if my assumption is correct that you&#39;re using a TX with an ethernet port and formatting the data for emoncms. By &quot;formatting&quot; I mean that the TX creates a http request with the API key and all.</p>
<p>The gateway is meant to get raw data and create the http request. If your TX is equipped with network interface and does that, you just don&#39;t need the gateway.</p>
<p>You could use the gateway as a repeater if you sent it raw data, but I don&#39;t see the point (there could be good reasons in specific cases, and testing is a specific case). However, it would mean open a port, route it, and it is not really meant to be done : there is no authentication such as API key, so currently it should be used on a local network.</p>
<p>I hope this is not too confusing. Please ask for clarification if needed.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20246"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Mon, 31/03/2014 - 10:05.</div>
    <div class="content">
     <p>Hi J&eacute;r&ocirc;me</p>
<p>I have since learned that oemgateway&nbsp;does not do what I was trying to do.</p>
<p>I have a nanodeRF sending data over the internet to a raspberry PI (without the RFM12Pi expansion board) acting as an emoncms server at a fixed IP address. I have recently set up a&nbsp; second PI again without RFM12Pi expansion board as a second emoncms server. I thought the oemgateway could be used to forward the data from the 1st Pi server to the 2nd PI server.</p>
<p>I now understand that this is not how oemgateway works.</p>
<p>This is not important as I was only trying to do this as a way of testing the latest version 8 of emoncms before I actually upgrade.</p>
<p>Many thanks for replying</p>
<p>Regards</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20248"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Mon, 31/03/2014 - 10:22.</div>
    <div class="content">
     <p>OK.</p>
<p>I think you could modify your Nanode code to send to both servers, if they are both reachable from it.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20258"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Mon, 31/03/2014 - 12:53.</div>
    <div class="content">
     <p>I tried that some time ago, I could send the data to the two servers, but handling the acknowledgements was difficult as I couldn&#39;t identify the sender; and I gave up (mainly because the Nanode was losing favour and everybody seemed to switching to using RPi&#39;s).</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20288"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 01/04/2014 - 11:02.</div>
    <div class="content">
     <p><span style="font-size: 12px;">Would it be possible to add a </span>url listener<span style="font-size: 12px;"> to the </span>oemgateway<span style="font-size: 12px;"> with the listeners&nbsp;</span><span style="font-size: 12px;">incoming</span><span style="font-size: 12px;">&nbsp;</span>apikey<span style="font-size: 12px;">&nbsp;set within it&#39;s&nbsp;</span><span style="font-size: 12px;">entry in oemgateway.conf? So if the received&nbsp;url string contains the correct api then add the basic data values to the existing buffer system. I know it won&#39;t be quite as easy as that but it would be a very valuable addition to the&nbsp;oemgateway.</span></p>
<p>This would not only resolve this particular need but also expand on the currently limited option of only being able to forward rfm2pi data from emoncms.</p>
<p>Dave (aka Schism) for instance is currently able to forward from one emoncms to another via the rfm2pi module interface but if he had non rfm inputs they would be excluded.</p>
<p>I on the other hand can use&nbsp;oemgateway&nbsp;to feed 2 local installs and emoncms.org, forwarding all input types to all&nbsp;emoncms&nbsp;servers as long as the inputs are created<span style="font-size: 12px;">&nbsp;</span><span style="font-size: 12px;">locally</span><span style="font-size: 12px;">.</span></p>
<p><span style="font-size: 12px;">With what&#39;s currently available the easiest solution for Ian would </span>may<span style="font-size: 12px;"> be to replace the </span>nanode<span style="font-size: 12px;"> </span>rf<span style="font-size: 12px;"> with a Pi running the </span>rocksolid<span style="font-size: 12px;">&nbsp;</span>ro<span style="font-size: 12px;"> version of </span>oemgateway,<span style="font-size: 12px;">&nbsp;sending to 2 </span>emoncms<span style="font-size: 12px;"> servers using the same </span>ip<span style="font-size: 12px;"> but different paths </span>eg<span style="font-size: 12px;">&nbsp;/</span>emoncmslive<span style="font-size: 12px;"> and </span>emoncmstest<span style="font-size: 12px;"> and resolve the addresses locally, but I&#39;m guessing the test </span>emoncms<span style="font-size: 12px;"> may not be important enough for the extra expense/hassle.</span></p>
<p><span style="font-size: 12px;">So how difficult would it be to add a url listener (assuming it can be done of course) ?&nbsp;</span></p>
<p><span style="font-size: 12px;">Paul</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20291"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1894.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Ian Eagland&#039;s picture" title="Ian Eagland&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1894.html" title="View user profile.">Ian Eagland</a> on Tue, 01/04/2014 - 12:07.</div>
    <div class="content">
     <p>Hi Paul</p>
<p>Your suggestion would also provide an up to the minute automatic backup!</p>
<p>Regards</p>
<p>Ian</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20293"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Tue, 01/04/2014 - 13:12.</div>
    <div class="content">
     <p>I&#39;m not convinced it is a good idea. I mean, it may be a twisted way of doing something that could be done from emoncms.</p>
<p>In fact, after a quick thought, I think it&#39;s more a job for emoncms.</p>
<p>Maybe you can open an enhancement request on emoncms for this. You can also open one on OEM gateway. I don&#39;t plan on doing this soon, but it will be here for here record. And maybe the one on emoncms will open a fertile discussion.</p>
<p>Or maybe you&#39;ll convince me that the gateway is a place for that.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20308"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 01/04/2014 - 16:24.</div>
    <div class="content">
     <p>It strikes me it&#39;s more like RAID than a backup?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20313"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 01/04/2014 - 17:46.</div>
    <div class="content">
     <p>Ian - yes it would, in fact much better than just a data back-up because if a server went down either due to a fault or for intentional&nbsp;maintenance/upgrade and was back-up again before the oemgateway buffer duration was reached (currently about 1.5hrs for me) there would be no loss of data on that server once it was back online and caught up with the buffered backlog.<span style="font-size: 12px;">(assuming of course the </span>oemgateway<span style="font-size: 12px;">&nbsp;hasn&#39;t gone down with it </span>ie<span style="font-size: 12px;"> same machine or same power supply failure)</span></p>
<p><span style="font-size: 12px;">Robert - I hadn&#39;t thought of it that way but yes like a mirror array raid except a complete shadow server possibly even located somewhere different eg&nbsp;emoncms.org that if a server went down you could just log-in to the other and carry on. not that anything we&#39;re monitoring is quite that important but it&#39;s a nice incidental feature.</span></p>
<p><span style="font-size: 12px;">J&eacute;r&ocirc;me - Basically having decided the url forwarding was definitely a useful feature for the emoncms project, based mainly on the usefulness of the limited&nbsp;rfm2pi&nbsp;only forwarding part of emoncms and the forward all local data functions of the oemgateway, My thought process was simply why exclude standalone RO&nbsp;oemgateway&nbsp;from using it? if added to oemgateway both standalone and emoncms&nbsp;servers reap the benefit in one go as I believe the oemgateway is being adopted as the standard gateway to emoncms. </span></p>
<p><span style="font-size: 12px;">I guess either place would suffice&nbsp;but to me the oemgateway&nbsp;is really the traffic hub for the system and as this function is explicitly about routing data,, it just seems the most logical and flexible option,</span></p>
<p><span style="font-size: 12px;">Paul</span></p>
<p><span style="font-size: 12px;">&nbsp;</span></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-20362"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/1531.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-1531.gif" alt="Jérôme&#039;s picture" title="Jérôme&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Setting up OemGateway</h3>

    <div class="submitted">Submitted by <a href="../user/1531.html" title="View user profile.">Jérôme</a> on Thu, 03/04/2014 - 13:20.</div>
    <div class="content">
     <p>Anyone, please follow discussion on this specific point in the <a href="https://github.com/Jerome-github/oem_gateway/issues/22">github issue</a>, if you want to be sure I&#39;m notified.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/4393"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-HMIPXg_EsWUWRmJfqfB5JEB1LwrSSPCazMuZSVl1WhI" value="form-HMIPXg_EsWUWRmJfqfB5JEB1LwrSSPCazMuZSVl1WhI"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
