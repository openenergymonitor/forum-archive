<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2404 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:39:09 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>JMPM | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">JMPM</h3>
        <span class="submitted">Submitted by Guest on Fri, 24/05/2013 - 19:06</span>
        <div class="content"><p>Hello,</p>
<p>I&#39;m working on a new project that I would like to share with this community. For now, I called it &quot;JMPM&quot;.</p>
<p>It&#39;s a power monitor similar to the designs here, but based around more mordern&nbsp;components.</p>
<p>The design goals are simple -- I want a highly accurate device for measuring my home&#39;s energy use and production.</p>
<p>JMPM&nbsp;is based on the Xmega series of uC by Atmel and as such:</p>
<p>Feature highlights:</p>
<ul>
<li>
		11 CT sensor inputs</p>
<ul>
<li>
				2x 200 Amp Range</li>
<li>
				2x 100 Amp Range</li>
<li>
				2x 50 Amp Range</li>
<li>
				5x 30 Amp Range</li>
</ul>
</li>
<li>
		On board voltage isolation (read: No wall wart neccessary)</li>
<li>
		Native support for both Raspberry PI and USB interfaces</p>
<ul>
<li>
				Pin header for Raspberry PI. Just connect a ribbon cable</li>
<li>
				USB if you want to use a laptop or whatever</li>
</ul>
</li>
<li>
		12 bit native sample resolution</p>
<ul>
<li>
				+/- 6 watts accuracy on the 200 Amp sensor inputs</li>
<li>
				+/- 1 watt accuracy on the 30 Amp sensor inputs</li>
</ul>
</li>
<li>
		14 bit over sampling (This *SHOULD* work)</p>
<ul>
<li>
				+/- 2 watts accuracy on the 200 Amp sensor inputs</li>
<li>
				+/- 0.25 watt accuracy on the 30 Amp sensor inputs</li>
</ul>
</li>
<li>
		High sample rate</p>
<ul>
<li>
				Provide data at up to the 80th harmonic in real time. Think of it as an oscilloscope&nbsp;permanently attached to your mains.</li>
<li>
				Identify specific loads.</p>
<ul>
<li>
						Eg. My electric toothbrush was charging for 75 minutes today</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The design target for this is to have it work with&nbsp;emoncms as the front end. I took a look at that and it&#39;s pretty darned complete.</p>
<p>The board powered up for the first time last night. Once it&#39;s proven to work, I will publish everything as an open design and open source.</p>
<p><a href="../../../www.oontz.org/jmpm/photo.html">http://www.oontz.org/jmpm/photo.JPG</a></p>
<p>Huge thanks to everyone here for inspiring!</p>
<p>- Jm</p>
  <div class="forum-topic-navigation clear-block">
          <a href="342.html" class="topic-previous" title="Go to previous forum topic">‹ Reducing Arduino brown out voltage investigation </a>
              <a href="2400.html" class="topic-next" title="Go to next forum topic">Working CT123 EmonTX sketch changes for USA ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-12339"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Sat, 25/05/2013 - 03:57.</div>
    <div class="content">
     <p>That looks good.</p>
<p>See my post about EmonLibPro <a href="2406.html" title="http://openenergymonitor.org/emon/node/2406">http://openenergymonitor.org/emon/node/2406</a></p>
<p>May be usefull to you.</p>
<p>&nbsp;</p>
<p>For improovement, i&#39;d like to see an ethernet port in it to comunicate directly to emoncms as i&#39;m doing with arduino. :)</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12345"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Sat, 25/05/2013 - 09:58.</div>
    <div class="content">
     <p>Looks really good! nice work! Love the purple boards. I look forward to seeing the schematics, are you using similar input stage circuitry to emontx or different?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12348"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mchamster&#039;s picture" title="mchamster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by mchamster (not verified) on Sat, 25/05/2013 - 14:35.</div>
    <div class="content">
     <p>V0.01 uses nearly the exact same input stages as described here. I have v0.02 in the works right now. that includes an anti-aliasing filter to improve ADC accuracy and an option for direct (transformer-free) measurement of line voltage. Transformers are difficult to reliably source and expensive when they can be found.&nbsp;</p>
<p>Also considering adding an rf transmitter to the board layout since that&#39;ll be nearly free.&nbsp;</p>
<p>- Jm</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12350"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 25/05/2013 - 14:46.</div>
    <div class="content">
     <p>I&#39;ll be interested to see what difference the anti-alias filter makes to the low level performance and noise rejection.</p>
<p>How do you intend to handle the necessary isolation if you will be having a direct galvanic connection to the line for voltage monitoring?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12351"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mchamster&#039;s picture" title="mchamster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by mchamster (not verified) on Sat, 25/05/2013 - 15:36.</div>
    <div class="content">
     <p>nyquist frequency theorem says the sample rate has to be at least twice the highest frequency being measured. With my scope and a ct probe, I can see details around 30khz and I have only looked at my laptop power supply and a small desk fan. I'm sure higher frequencies are present and even more noisy with larger and composite loads.</p>
<p>Additionally, if there are enough cycles to perform reliable over sampling, the signal can't change much during the extended sample period. I don't think the 12bit adc is nearly good enough for measuring the 200amp sensors with any reasonable accuracy. </p>
<p>Unfortunately my ct probe came after the boards were sent to be fabbed, so I didn't think to add the filter to the first design. </p>
<p>Cheers!</p>
<p>- Jm </p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12353"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Sat, 25/05/2013 - 16:38.</div>
    <div class="content">
     <p>Anti-alias filter in hardware? I see that as a shortcut with precision reducion.</p>
<p>Typical LPF DC offset filter should account for high frequency content removing.</p>
<p>&nbsp;</p>
<p>If you want reliability and precision you should:</p>
<p>1 - Eliminate digital noise from analogic section.<br />
	2 - Sample values ranges close to max precision of adc. If needed much range, hardware gain must be considered. From atmel appnote it exists onchip on XMega so use it.<br />
	3- Sample as fast as possible. (include cpu processing time)<br />
	4- Assure you are sampling at the same time position in every cycle. (call for PLL)<br />
	5- Continuou sample and never miss any sample at any time.<br />
	6- Do the filtering in software.<br />
	7- Give result data as an average over time of sampled data.</p>
<p>&nbsp;</p>
<p>What exact XMega are you using at what freq? ATxmega128 is only twice as fast as arduino Atmega328 in cpu raw power.Not realy enought for what you describe you want to do.<br />
	You should revise your cpu software processing power required as no way you can get your &quot;80th harmonic in real time&quot; measurements with this for 11cts.<br />
	See <span id="ctl00_ctl00_mpCore_CoreContentSpan_gcDocuments1_lblDocuments"><strong>Atmel AVR1631: Single Phase Energy Meter using XMEGA A&nbsp;&nbsp; </strong></span>http://www.atmel.com/Images/doc42039.pdf</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>As i said on the post above, see my lib, it does pretty much all the necessary steps i said minus step 2, but i&#39;m using 20A/ CTs so range is short.<br />
	Noise is my main problem with arduino shield proto boards as pcb layout is bad designed for analog signal. Even though i got 0.01-0.25 precision on all units.</p>
<p>With a precision for step 4 in range of&nbsp; 39-78uS with the PLL technique.</p>
<p>Take time and analise it, you wont regret.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12361"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 25/05/2013 - 20:34.</div>
    <div class="content">
     <div class="submitted">
	<a href="../user/3695.html" title="View user profile.">chaveiro</a><br />
	<em>&quot;Anti-alias filter in hardware?&quot;</em></div>
<p>Is there any other way? ? ?</p>
<p><em>&quot;Typical LPF DC offset filter should account for high frequency content removing.&quot;</em><br />
	Please explain. You need a HIGH PASS filter to remove the d.c. content, else you obtain the d.c. content with a low pass filter and subtract it. Either way, the high frequency content is largely unaltered.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12367"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3695.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="chaveiro&#039;s picture" title="chaveiro&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by <a href="../user/3695.html" title="View user profile.">chaveiro</a> on Sun, 26/05/2013 - 00:44.</div>
    <div class="content">
     <p><a href="../user/924.html" title="View user profile.">Robert Wall</a>&nbsp; :</p>
<p>First to clarify, high frequency &#39;noise&#39; (in MHZ) is not the same as (not so) high frequency current peaks (eg.: from smps).</p>
<p>I tought that hardware anti-aliasing filters was used to remove&nbsp; the later peaks, but from viewing the atmel AVR1631 app note i believe that filters are there to remove high frequency noise from the line like the generated by powerlan devices in MHZ ranges.</p>
<p>Meaning that this kind of filters will not do much change with arduino like ADCs because itself works by sampling a small window (at 125khz for arduino). So any higher frequency content is lost already.</p>
<p>&nbsp;</p>
<p>Regarding LPF for DC ofset, forget it we use a HPF. My mistake.</p>
<p>For LPF in software it can be implemented with a formula like:</p>
<p>y(n) = 0.996 * y(n-1) + x(n)<br />
	&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12370"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mchamster&#039;s picture" title="mchamster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by mchamster (not verified) on Sun, 26/05/2013 - 05:07.</div>
    <div class="content">
     <p>Aurduino isn&#39;t a development target for this project.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12381"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 26/05/2013 - 11:49.</div>
    <div class="content">
     <p><a href="../user/3695.html" title="View user profile.">chaveiro</a></p>
<p>I am well aware that digital noise originates from a different source, and is unwanted, compared to high frequency Fourier components of the wanted input. However, a passive anti-alias filter, which will of necessity remove high frequency components of the wanted signal above the Nyquist frequency, <em>might</em> also serve to remove some of the noise components, especially those that are inductively or capacitively coupled, as opposed to conducted, into the input (or indeed conducted into the analogue supply).</p>
<p>For good low level performance, you must have a clean analogue supply (an L-C filter L50 - C50 is shown in the Atmel app.note AVR465 and similarly in other Atmel documents), and if there are components in the input above the Nyquist frequency, then hardware anti-alias filters are required. However, the limited bandwidth of the current transformer, and the very low level of high frequency components in the voltage supply are probably reasons for these not being included in the Atmel AVR465 design. It is of course quite impossible to have a digital anti-alias filter.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-12417"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="mchamster&#039;s picture" title="mchamster&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: JMPM</h3>

    <div class="submitted">Submitted by mchamster (not verified) on Tue, 28/05/2013 - 04:25.</div>
    <div class="content">
     <p>chaveiro - I appreciate all your feedback. This is good information. I&#39;ll review the utility of all your points with the design.</p>
<p>I&#39;ll include ethernet into v0.02. That&#39;s really a very good idea and something I hadn&#39;t considered.</p>
<p>Additionally, re: 80th harmonic -- My consideration is much of the processing can be offloaded for high precision&nbsp;heavy lifting. In this use case, the device just sends raw data in a periodic packet and something else can do the analysis. Moving this much data in and out of the uC will be enough work.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2404"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-AR5cgbCkpfG-YVa6digQMUAI7WQYq0TqoaVKdzzN8po" value="form-AR5cgbCkpfG-YVa6digQMUAI7WQYq0TqoaVKdzzN8po"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
