<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/200 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:07:43 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Monitor 3 phases with one voltage sensor | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/4.html">Archived: Hardware</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Monitor 3 phases with one voltage sensor</h3>
        <span class="submitted">Submitted by Guest on Fri, 22/07/2011 - 11:24</span>
        <div class="content"><p>&nbsp;Hello everyone,</p>
<p>As we all know, there are two ways of measuring electrical power with the CT sensors: one involves using a CT sensor + voltage sensor, and the other just a CT.</p>
<p>Each method has advantages and disadvantages:</p>
<table width="100%" border="1" cellpadding="1" cellspacing="1">
<tbody>
<tr>
<td>CT only</td>
<td>CT+Voltage sensor</td>
</tr>
<tr>
<td>
<p>+Simple</p>
<p>+Does not require a voltage sensor (assumes the AC voltage is constant and the phase shift is 1)</p>
<p>+Does not require an electricity plug next to the monitor</p>
<p>-Inaccurate because RealPower does not always equal ApparentPower</p>
</td>
<td>
<p>+Accurate</p>
<p>+Measures actual voltage values</p>
<p>+Measures phase shift and actual RealPower and ApparentPower</p>
<p>-Requires an AC plug next to the monitor</p>
<p>-Requires a voltage sensor per phase</p>
</td>
</tr>
</tbody>
</table>
<p>The biggest drawback of the CT only method is that it does not measure the phase shift between the current and voltage, and it just multiplies the measured current values by the fixed voltage value (say 230v), so for example if your device consumes 3Amp and it is not purely resistive (phase shift different than 1, let's say 0.20) then your CT only monitor will show a power consumption of 690 Watt while a CT + Voltage sensor monitor will show the accurate value of 144.9 Watt.</p>
<p>Here comes the biggest drawback of the CT only method. It also does not measure the voltage drop but that is very tolerable I think (not more than a few volts).</p>
<p>Now if we want to monitor more than one phase with the CT + Voltage sensor method (say 3 phases), we would need 3 CTs and 3 voltage sensors.&nbsp;</p>
<p>However, I think we can use only one voltage sensor to measure one phase voltage, and since the phase shift between the three voltage vectors is always 120&deg; (see diagram below) , we can create two variables that are 120&deg; shifted from the measured voltage phase, and multiply the measured current values from the CTs by an assumed voltage value and by the phase shift between this current and the created 120&deg; shifted phase.</p>
<p><img alt="" src="../../../mysite.du.edu/_jcalvert/tech/wyedelta.gif" /></p>
<p>What do you think? Can this idea be further developed?</p>
  <div class="forum-topic-navigation clear-block">
          <a href="474.html" class="topic-previous" title="Go to previous forum topic">‹ Biphase 220V</a>
              <a href="267.html" class="topic-next" title="Go to next forum topic">Current sensor in Italy ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-1979"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 02/08/2011 - 23:33.</div>
    <div class="content">
     <p>&nbsp;Hi Amin,&nbsp;</p>
<p>How are things? What have you been up to?</p>
<p>Sorry we have been slow replying, we have been busy assembling up a load of emonTx's and Nanodes (see tweets) for our <a href="http://ecobro.org/node/24">community energy project</a>. We have also been working on polishing the emonTx and Nanode firmware.&nbsp;</p>
<p>Sounds pleasuable, I will need to do some more reading an thinking. With the<a href="205.html"> new version of the emonTx (V2.0)</a>&nbsp;including 3 x CT channels it would be really cool to get some 3-phase monitoring working.&nbsp;</p>
<p>Trystan and I did an interesting test last night. We graphed real power, apparent power and P.F. The test was conducted over night, the main loads connected were fridges (3 different ones I think). You can see the effect of their inductive loads.&nbsp;</p>
<p>&nbsp;</p>
<p><a href="../sites/default/files/real_vs_app%20power.png"><img width="500" height="228" alt="" src="../sites/default/files/real_vs_app%20power.png" /></a></p>
<p>&nbsp;</p>
<p>All the best, Glyn.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1980"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Wed, 03/08/2011 - 18:55.</div>
    <div class="content">
     <p>Hey Amin, I reckon your idea is worth a go. The challenge might be to create that phase shifted waveform, maybe it could be done with an array that say stores the last 100 samples and the 50th sample back is 120 deg out of phase?</p>
<p>As glyn said we have started to do some proper testing of the difference between realpower and apparent power when monitoring a 'normal' house's combination of loads over time. A good measure would be realpower kwh in a year vs apparent power kwh in a year. So far though we only have two days and these are the results:</p>
<p>Day 1: | real power 20.6kWh | apparent power 21.8kWh | real power = 94% of apparent power</p>
<p>Day 2: | real power 10.3kWh | apparent power 11.6kWh | real power = 89% of apparent power</p>
<p>It would be interesting to know what the average difference is between real and apparent for the typical house, we could then calibrate it out in a rough way giving a good enough for our needs result.</p>
<p>If the loads being measured however where not average household loads like a workshop full of motors this would be less lickely to work. Anyhow we can get around all this by adding voltage measurement which is what this topic is actually about, sorry for the digression.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1985"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Amin Zayani&#039;s picture" title="Amin Zayani&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by Amin Zayani (not verified) on Mon, 08/08/2011 - 13:35.</div>
    <div class="content">
     <p>&nbsp;Hey guys,</p>
<p>It's cool that you started measuring the real power vs apparent power. Now we have an &quot;empirical&quot; evidence that voltage measurement makes an important difference. It is already more than 10% deviance: WAY TOO MUCH! I am afraid I'll have to disagree with you about the &quot;calibrating&quot; solution. I believe that every decent monitor needs a voltage sensor. Calibration opens the door for an error margin that's too important to tolerate.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1986"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Amin Zayani&#039;s picture" title="Amin Zayani&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by Amin Zayani (not verified) on Mon, 08/08/2011 - 13:39.</div>
    <div class="content">
     <p>&nbsp;The challenge might be to create that phase shifted waveform, maybe it could be done with an array that say stores the last 100 samples and the 50th sample back is 120 deg out of phase?</p>
<p>&nbsp;</p>
<p>I'm sorry I did not get the idea, do you want to create that array in the arduino memory or in the database?&nbsp;</p>
<p>I think the other two waveforms must both be created within the arduino, the other challenge will be to make the arduino match the corresponding generated voltage waveform to the current measured. Tricky.</p>
<p>&nbsp;</p>
<p>Should we start a topic on the official arduino forums?</p>
<p>&nbsp;</p>
<p>Do you think the little ATMega 328 can handle it?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1989"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/3.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-3.jpg" alt="TrystanLea&#039;s picture" title="TrystanLea&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by <a href="../user/3.html" title="View user profile.">TrystanLea</a> on Mon, 08/08/2011 - 17:37.</div>
    <div class="content">
     <p>I think that the method choosen depends on your aims and accuracy requirements. The main disadvantage of the voltage measurement option is the need for a AC socket near to you utility meter and also the cost of the additional adapter. If you need an indication of your energy use, good enough for seeing trends then the CT only option may be fine. I believe this is why most domestic energy monitors go for the CT only option. If we can layout each options advantages and disadvantages on this site clearly then each of us can decide for ourselves which option best suits our own needs and our particular applications needs.</p>
<p>I will try and create a page on this later this week</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-2353"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by Guest on Sat, 26/11/2011 - 09:26.</div>
    <div class="content">
     <p>I'm asuming there arn't enough pins on the ATMega 328 to just measure the additional two phase voltages ? Wouldn't that be the simplest and most accurate.</p>
<p>I'm also interested in this, and don't really have a typical electrical usage (workshop etc) to make any kind of estimations for the trouble.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3325"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Mon, 05/03/2012 - 21:16.</div>
    <div class="content">
     <p>YES, i hat the exactly same ideia, and i think it can handle.</p>
<div>
	&nbsp;</div>
<div>
	I&#39;m thinking in create a array to buffer the x last ac waveform samples where:</div>
<div>
	&nbsp;</div>
<div>
	x = (F_CPU / ADC_PRESCALER / 13 / (Number of voltage sensors + number of CT&#39;s) / Mains_HZ) * Max_Phase_Angle / 360&nbsp;</div>
<div>
	&nbsp;</div>
<div>
	Where F_CPU is the CPU frequency or 16000000</div>
<div>
	ADC_PRESCALER = 128</div>
<div>
	13 is the ADC clocks to give a reading</div>
<div>
	Mains_HZ is the line frequency (60 or 50Hz)</div>
<div>
	Max_Phase_Angle = the maximun angle ex: 240 for 3 phase circuit with 3 cts.</div>
<div>
	&nbsp;</div>
<div>
	(16.000.000/128/13/4/60) * 240 / 360 = 22</div>
<div>
	&nbsp;</div>
<div>
	so we need to mantain the last 22 voltage readings on a fifo buffer ant then apply only a little phase shift correction.</div>
<div>
	When reading the first phase, we will pick the array[0] position, on the second phase the array[11] and on the third array[22], so that way we can maintain the original active and real power measurements.</div>
<div>
	&nbsp;</div>
<div>
	I&#39;m working on that code right now to prove it&#39;s concept.</div>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3326"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="ControlGadgets_Geoff&#039;s picture" title="ControlGadgets_Geoff&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by ControlGadgets_Geoff (not verified) on Tue, 06/03/2012 - 14:35.</div>
    <div class="content">
     <p>The calculations above suggest that the supply voltage affects the accuracy of the calculation more than the power factor does.</p>
<p>The problem with only measuring 1 phase is, the voltage on all 3 phases is rarely the same. This is because the load is generally only randomly balanced by linesmen.&nbsp; If the supply is overhead, the linesman will usually attach each connection to the closest phase.&nbsp; This is call&nbsp; &quot;short arm linesman&quot; theorem and is generally the first thing that we check when there are voltage problems.&nbsp; If the supply is underground it relies on the favorite color (red, white or blue) or favorite letter. (A,B or C) to get the balancing correct.&nbsp; Even if the load in numercally balanced, rarely do all people draw the same amount of power at the same time, so a balanced load is practically impossible.</p>
<p>An unbalanced system can cause the voltage on some phases to be far greater than the supply and others to be less, since the voltage on the neutral will move towards the heaviest loaded phase and therefore away from the lightest loaded phase.&nbsp; So, when one customer draws more load their voltage will go down and other customers supply voltage can go up!&nbsp; Also consider a highly inductive load (pool pump), the current direction is somewhere off in space...</p>
<p>It sounds to me like you are getting too excited by the prospect of doing something clever, as we all do from time to time, instead of focusing on being practical.&nbsp; I frequently see this in some of my programmers&#39; work.&nbsp; The Keeping It Simple Stupid theory is frequently the best solution and is always more reliable than some convoluted algorithm. (Or maybe I&#39;m just getting too old to see the fun in programming...)</p>
<p>In my opinion, measuring voltage and/or power factor is only really useful if you are going to challenge your power company&#39;s meter reading. Simply measuring current and multiplying by a arbitrary supply voltage will give you all the data that you need to determine what is consuming the most energy.</p>
<p>I&#39;d also be doing some linearity tests on your CT&#39;s.&nbsp; Since you are using Atmel/arduino, I&#39;d guess you are measuring around 3-5 volts from a CT using a high value (200 ohm+) resistor.&nbsp; If this is the case you will likely see an error of up to 40% from 0 to full scale.&nbsp; Use a resistive heater to check, it&#39;s very interesting!</p>
<p>Sounds like your having fun.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-3331"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Pcunha&#039;s picture" title="Pcunha&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Monitor 3 phases with one voltage sensor</h3>

    <div class="submitted">Submitted by Pcunha (not verified) on Wed, 07/03/2012 - 15:21.</div>
    <div class="content">
     <p>Yes i&acute;m having a lot of fun! ( Don&acute;t trow &nbsp;cold water in me).&nbsp;</p>
<p>If i wanted to be practical &nbsp;i have had both a presicion meter... a fully assembled one. with a user manual, a waranty certificate...</p>
<p>The voltage problem is a problem that could be &nbsp;resolved easy using 3 voltage sensors with 3 cts. ( my actual hack of OpenEnergyMonitor). The approach of using only one voltage sensor will give-us at least the same precision as using none.</p>
<p>(correct-me if i&acute;m wrong):</p>
<p>As far as i can read the pratical approach has been already acomplished by the OpenEnergyMonitor Project. It gives you some accurate readings with very cheap hardware that you can assemble yourself.</p>
<p>As i can see, the actual approach of the project is simplicity and easy to use not precision. I can see that for the simple fact that the code base only utilize some samples of the AC grid to determine it&acute;s load. This is great. a very simple software with simple hardware to provide some acurracy...</p>
<p>What i&acute;m trying to do is a way of improving the actual project on a software basis. If my code, compiles, fits and runs on the same processor, with the exactly same hardware only losing it&acute;s power saving capability, but improving the accuracy of the meter, let&acute;s say, some %, the user will have a choice on what firmware to use...</p>
<p>I&acute;ve not tested yet, but the CT&acute;s datasheet gives-me a high linearity from 0 to 30A.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/200"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-KLohCoj6WOE8p-nYEy7rF1eExQ7ea9CITfstoN1lUEM" value="form-KLohCoj6WOE8p-nYEy7rF1eExQ7ea9CITfstoN1lUEM"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/200 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:07:44 GMT -->
</html>
