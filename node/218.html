<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/218 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:53:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Nanode + RFM12B can&#039;t initialise | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Nanode + RFM12B can&#039;t initialise</h3>
        <span class="submitted">Submitted by Guest on Sun, 07/08/2011 - 12:43</span>
        <div class="content"><p>I've just soldered all my stuff together, just wondering where I&nbsp;can get some help about the Nanode?</p>
<p>In the setup I've put in some traces:</p>
<p>&nbsp;ethernet_setup(mac,ip,gateway,server,80,8); // Last two: PORT and SPI PIN: 8 for Nanode, 10 for nuelectronics<br />
&nbsp; Serial.println(&quot;Ethernet set up&quot;);<br />
&nbsp; <br />
&nbsp; rf12_initialize(MYNODE, freq,group);<br />
&nbsp; Serial.println(&quot;RF12 Initialized&quot;);</p>
<p>&nbsp;</p>
<p>But almost always I&nbsp;can't get the trace for 'RF12 Initialized'?&nbsp;I've cut the 5V&nbsp;pin from the RFM12B, but do I&nbsp;have to remove the other components as well as shown in this pic:&nbsp;http://wiki.hackspace.org.uk/wiki/File:JeeNode_RFM12B.jpg</p>
<p>As I've already soldered them on, and finding it difficult to remove them!</p>
<p>&nbsp;</p>
<p>Is there some way to get some more debug info from the &nbsp; rf12_initialize command?</p>
<p>&nbsp;</p>
<p>Regards,</p>
<p>Reuben</p>
  <div class="forum-topic-navigation clear-block">
          <a href="236.html" class="topic-previous" title="Go to previous forum topic">‹ EMON Simulation</a>
              <a href="203.html" class="topic-next" title="Go to next forum topic">Adding a delay() in sketch ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-1982"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Nanode + RFM12B can't initialise</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Sun, 07/08/2011 - 23:12.</div>
    <div class="content">
     <p>Hi Reuben,</p>
<p>There is an error in the Nanod 5 board which stops the RFM12B and Ethernet being used at the same time. Have you followed the instructions here to mod the board?&nbsp;</p>
<p><a href="http://wiki.hackspace.org.uk/wiki/Project:Nanode/Applications#RFM12_Wireless_Module">http://wiki.hackspace.org.uk/wiki/Project:Nanode/Applications#RFM12_Wireless_Module</a></p>
<p>What sketch are you trying to run?&nbsp;</p>
<p>All the best, Glyn.&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1983"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="reubenb87&#039;s picture" title="reubenb87&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Nanode + RFM12B can't initialise</h3>

    <div class="submitted">Submitted by reubenb87 (not verified) on Mon, 08/08/2011 - 10:24.</div>
    <div class="content">
     <p>Yes&nbsp;I followed the instructions from that post. I've removed the 10k resistor, and bent up pin 4. However I&nbsp;just cut the 5V&nbsp;header pin, I&nbsp;didn't remove all the components as shown in the picture, but that should be ok</p>
<p>(For connecting to the nanode there is no need to solder in the 3.3V  voltage regulator. Just omit the 5V headder pin. The RFM12B will get is  3.3V power from the Nanode's 3.3V voltage regulator.)</p>
<p>I'm trying to run EtherShield_simpleClient_Pachube_RF12 from <a href="https://github.com/openenergymonitor/sketchbook/tree/master/EtherShield_simpleClient_RF12/EtherShield_simpleClient_Pachube_RF12" title="https://github.com/openenergymonitor/sketchbook/tree/master/EtherShield_simpleClient_RF12/EtherShield_simpleClient_Pachube_RF12">https://github.com/openenergymonitor/sketchbook/tree/master/EtherShield_...</a></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1987"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Nanode + RFM12B can't initialise</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 08/08/2011 - 13:39.</div>
    <div class="content">
     <p>I think I know what the problem is. The RFM12 board needs to be plugged into a special port an the Nanode. This requires an extra header to be soldered in. Quite a few people have been having this problem. I will update the Nanode RFM12B section of the London hackspace wiki as soon as I get a chance. For now see image below:</p>
<p><a href="../sites/default/files/RFM12B_Nanode_port.png"><img width="200" height="183" alt="" src="../sites/default/files/RFM12B_Nanode_port.png" /></a></p>
<p>Had you plugged the RFM12 board into the wrong port on the Nanode? Has this fixed the problem?&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1991"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Guest&#039;s picture" title="Guest&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Nanode + RFM12B can't initialise</h3>

    <div class="submitted">Submitted by Guest on Mon, 08/08/2011 - 21:35.</div>
    <div class="content">
     <p>Ah so this is a different port to the pins just below? I thought they were.joined but it seems not, I'll try tonight and update on success or.not</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1992"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Nanode + RFM12B can't initialise</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Mon, 08/08/2011 - 22:14.</div>
    <div class="content">
     <p>Yes their different. Just updated the Nanode wiki with image showing location of RFM12B wireless port: <a href="http://wiki.hackspace.org.uk/wiki/Project:Nanode/Applications#RFM12_Wireless_Module">http://wiki.hackspace.org.uk/wiki/Project:Nanode/Applications#RFM12_Wireless_Module</a>&nbsp;</p>
<p>
<meta http-equiv="content-type" content="text/html; charset=utf-8" /></p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1994"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="reubenb87&#039;s picture" title="reubenb87&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Nanode + RFM12B can't initialise</h3>

    <div class="submitted">Submitted by reubenb87 (not verified) on Tue, 09/08/2011 - 08:42.</div>
    <div class="content">
     <p>Thanks Glyn, working now!!&nbsp;Also on the wiki you say an extra 9 pin header is needed? But the pin next to the 3V3 is Dig7 from this pic:&nbsp;http://wiki.hackspace.org.uk/wiki/File:Nanode_conns.jpg</p>
<p>Where is that supposed to connect to the RFM12B?&nbsp;Or you are just unable to use this pin with the RFM12B?</p>
<p>&nbsp;</p>
<p>I also have a question about sending the data to Pachube. I've put in a delay of 30seconds, as I&nbsp;haven't got the pro account yet, but I don't get any response from Pachube when I&nbsp;do this, can you see if there's any error in my code? If I&nbsp;get rid of the lines I&nbsp;added, it will update a few values, but then get the error that I'm exceeding the limit.</p>
<p>I've only added 'lastUpdate', but the println(sent) statement works, but just doesn't seem to send the data!?!</p>
<p>#include &lt;Ports.h&gt;<br />
#include &lt;RF12.h&gt;</p>
<p>#define MYNODE 30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //node ID 30 reserved for base station<br />
#define freq RF12_433MHZ&nbsp;&nbsp;&nbsp;&nbsp; //frequency<br />
#define group 212&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //network group </p>
<p>#include &lt;EtherShield.h&gt;</p>
<p>byte mac[6] =&nbsp;&nbsp;&nbsp;&nbsp; { <br />
&nbsp; 0x54,0x55,0x38,0x12,0x01,0x23};<br />
byte ip[4] =&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />
&nbsp; 192,168,1,131};<br />
byte gateway[4] = {<br />
&nbsp; 192,168,1,1};<br />
byte server[4] =&nbsp; {<br />
&nbsp; 173,203,98,29};</p>
<p>#define PACHUBE_VHOST &quot;www.pachube.com&quot;<br />
#define PACHUBEAPIKEY &quot;www.pachube.com\r\nX-PachubeApiKey: xxxxxxxxxxxxxxx&quot; <br />
#define PACHUBEAPIURL &quot;/api/xxx.csv&quot;</p>
<p>char str[150];<br />
int dataReady=0;<br />
unsigned long lastUpdate;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // only update every 5 seconds</p>
<p>//########################################################################################################################<br />
// EmonTX Data Structure to be received <br />
//########################################################################################################################<br />
typedef struct {<br />
&nbsp; int ct1;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // current transformer 1<br />
&nbsp; int ct2;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // current transformer 2<br />
&nbsp; int nPulse;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // number of pulses recieved since last update<br />
&nbsp; int temp1;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // One-wire temperature 1<br />
&nbsp; int temp2;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // One-wire temperature 2<br />
&nbsp; int temp3;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // One-wire temperature 3<br />
&nbsp; int supplyV;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; // emontx voltage<br />
} <br />
Payload;<br />
Payload emontx;</p>
<p>int emontx_nodeID;&nbsp;&nbsp;&nbsp; //node ID of emon tx, extracted from RF datapacket. Not transmitted as part of structure<br />
//########################################################################################################################</p>
<p>void setup()<br />
{<br />
&nbsp; Serial.begin(9600);<br />
&nbsp; Serial.println(&quot;EtherShield_simpleClient_Pachube_RF12&quot;);</p>
<p>&nbsp; ethernet_setup(mac,ip,gateway,server,80,8); // Last two: PORT and SPI PIN: 8 for Nanode, 10 for nuelectronics<br />
&nbsp; Serial.println(&quot;Ethernet set up&quot;);</p>
<p>&nbsp; rf12_initialize(MYNODE, freq,group);<br />
&nbsp; Serial.println(&quot;RF12 Initialized&quot;);</p>
<p>&nbsp; lastUpdate = millis();<br />
}</p>
<p>void loop()<br />
{<br />
&nbsp; //----------------------------------------<br />
&nbsp; // 1) Recieve data from rf12<br />
&nbsp; //----------------------------------------<br />
&nbsp; if (rf12_recvDone() &amp;&amp; rf12_crc == 0 &amp;&amp; (rf12_hdr &amp; RF12_HDR_CTL) == 0 &amp;&amp; rf12_len==sizeof(Payload) ) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; emontx=*(Payload*) rf12_data;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; emontx_nodeID=rf12_hdr &amp; 0x1F;&nbsp;&nbsp; //extract node ID from received packet </p>
<p>&nbsp;&nbsp;&nbsp; Serial.print(&quot;Node ID: &quot;);<br />
&nbsp;&nbsp;&nbsp; Serial.println(emontx_nodeID);</p>
<p>&nbsp;&nbsp;&nbsp; // Construct CSV<br />
&nbsp;&nbsp;&nbsp; Serial.println(&quot;CSV:&quot;);<br />
&nbsp;&nbsp;&nbsp; sprintf(str,&quot;%d&quot;,emontx.ct1);<br />
&nbsp;&nbsp;&nbsp; Serial.println(str);</p>
<p>&nbsp;&nbsp;&nbsp; dataReady = 1;<br />
&nbsp; }</p>
<p>&nbsp; //----------------------------------------<br />
&nbsp; // 2) Send the data (wait every 30 seconds)<br />
&nbsp; //----------------------------------------<br />
&nbsp; if ((millis()-lastUpdate)&gt;30000)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; lastUpdate = millis();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (ethernet_ready() &amp;&amp; dataReady==1)<br />
&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ethernet_send_post(PSTR(PACHUBEAPIURL),PSTR(PACHUBE_VHOST),PSTR(PACHUBEAPIKEY), PSTR(&quot;PUT &quot;),str);<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Serial.println(&quot;sent&quot;); <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dataReady = 0;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; }<br />
}</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-1997"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/10.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-10.jpg" alt="glyn.hudson&#039;s picture" title="glyn.hudson&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Nanode + RFM12B can't initialise</h3>

    <div class="submitted">Submitted by <a href="../user/10.html" title="View user profile.">glyn.hudson</a> on Tue, 09/08/2011 - 20:09.</div>
    <div class="content">
     <p>Fantastic.&nbsp;</p>
<p>Well spotted, your right, it's only 8 pins. Dig 7 is not used by the RFM12. I'll update the wiki. Thanks for spotting that.</p>
<p>I'v heard that Pachube have changed their API since we made that example. Iv not really used Pachube myself, I've been using emoncms. I know a couple of people are looking to re-write the example. In the meantime here is a link to an example of posting data to Pachube. I havent tested it myself but it was posted up by Pachube on their twitter, so I would assume it works. It used the Ethercard library from JeeLabs rather than the Ethershield library from Andy (cofusing I know!). &nbsp;<a href="https://gist.github.com/1130021">Download it here</a></p>
<p>Let me know how you get on.</p>
<p>Good luck, Glyn.&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/218"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-1xxBgFMCTx_MVSXbMWTP2jC2qgYCHOH_FPzhzP-J6nY" value="form-1xxBgFMCTx_MVSXbMWTP2jC2qgYCHOH_FPzhzP-J6nY"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
