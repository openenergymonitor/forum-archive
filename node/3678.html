<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/3678 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:23:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Reading sinusoidal wave with Arduino | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/3.html">Archived: General Discussion</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Reading sinusoidal wave with Arduino</h3>
        <span class="submitted">Submitted by Guest on Sun, 19/01/2014 - 22:54</span>
        <div class="content"><p>Hi guys, before I start, I just want to say that I try searching but &#39;nothing&#39; help me.</p>
<p>I live in Brazil, the voltage here is about&nbsp;127V&nbsp;60Hz, I bought an SCT-1250-400 for a project in my university, we will measure the consumption in building, the current is almost 300A more during a hot day.</p>
<p>What I did till now: The output of the CT is 0 to 333mV&nbsp;AC, where I know, I can&#39;t put this voltage directly in the Arduino&nbsp;analog port, and even if I could, the mV is not enough, so, I amplifier with a Amp op and sum with 2.5V, now I have a sinusoidal wave starting from 0 to 5V (the middle point is in 2.5V).</p>
<p>The big problem is, how can I read this with a Arduino, if the voltage in the analog port is between 0-5V, the current passing trough&nbsp;the CT is 400A, and the arduino&nbsp;should show me 400A in the serial monitor.</p>
<p>&nbsp;</p>
<p>How can I get there?</p>
<p>PS: sorry about the bad english.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="3651.html" class="topic-previous" title="Go to previous forum topic">‹ Be able to display a map of an OEM network in EmonCMS</a>
              <a href="3672.html" class="topic-next" title="Go to next forum topic">Glyn&#039;s Bee Hive Temperature Monitor (uses EMONCMS) up for an award VOTE NOW! ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-17757"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading sinusoidal wave with Arduino</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 19/01/2014 - 23:22.</div>
    <div class="content">
     <p>Everything you need to understand how to do this, and solve your problem, is in the section <a href="../buildingblocks.html">Building Blocks</a>. The first page to read is &quot;CT sensors - Interfacing with an Arduino&quot;, then you should download and understand the sketch &quot;arduino-sketch-current-only&quot; and the <a href="https://github.com/openenergymonitor/EmonLib">emonLib library</a>. It is the library class &quot;EnergyMonitor&quot; and the method &quot;EnergyMonitor::calcIrms( )&quot; where the rms value of the voltage at the analogue input is calculated and multiplied by a scale factor to print the correct current. You will need to understand the <a href="https://learn.openenergymonitor.org/?redirect=ct-and-ac-power-adaptor-installation-and-calibration-theory">calibration theory</a> so that you can calculate and supply the correct calibration constant to the library in &quot;EnergyMonitor::current(...)&quot;.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17777"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="fellipem&#039;s picture" title="fellipem&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading sinusoidal wave with Arduino</h3>

    <div class="submitted">Submitted by fellipem (not verified) on Mon, 20/01/2014 - 18:50.</div>
    <div class="content">
     <p>Thanks Robert, I&#39;ll try!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17786"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="fellipem&#039;s picture" title="fellipem&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading sinusoidal wave with Arduino</h3>

    <div class="submitted">Submitted by fellipem (not verified) on Mon, 20/01/2014 - 22:56.</div>
    <div class="content">
     <p>Robert,</p>
<p>I read the material but I couldn&#39;t find how to solution another problem. Here in Brazil, the voltage is 127V&nbsp; (in this moment, my&nbsp;multimeter is showing 118V). I&#39;m using a transformer 127V / 8V, I create and measuring every component, the board now look like the image attached.</p>
<p>Question 1: How can I make the calibration for this, I tried (127*11 / 8*1.2) but the value showing in the Serial Monitor from arduino is showing me 142V. I also tried (118*11/8*1.2) . I also would like to know why I multiply by 11. Just to know, I&#39;m not using emontx.</p>
<p>Question 2: I don&#39;t understand the phase shift (emon1.voltage(2, 234.26, 1.7)), maybe that&#39;s my problem?</p>
<p>The Serial Monitor is showing me:</p>
<p>26516.41 24946.56 173.86 143.49 1.06<br />
	26517.78 24948.83 173.84 143.52 1.06<br />
	26602.12 25030.10 174.13 143.74 1.06</p>
<p>I put the same Voltage from&nbsp;A2 in A1&nbsp;port, just to test, I&#39;m trying just make the voltage work. If voltage work, I&#39;m make my CT work.&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>Thanks</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17791"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading sinusoidal wave with Arduino</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 21/01/2014 - 00:53.</div>
    <div class="content">
     <p>Voltage: &quot;11&quot; is the inverse ratio of the voltage divider, in your case it is&nbsp; (110 + 20) / 20 = 6.5</p>
<p>If you <u>measured</u> your transformer output at 8 V with 118 V input, then you use those numbers and you do not need the &quot;1.2&quot; (The 1.2 is because the adapter we use is 9 V out fully loaded, approx. 10.8 V unloaded, and we use it unloaded: 9 x 1.2 = 10.8).</p>
<p>Therefore your voltage calibration constant should be 118 x 6.5 / 8 = 95.875</p>
<p>Phase shift is to correct for 3 different things. Both your voltage transformer and your current transformer have a phase shift, that is a physical property and if you spend a lot of money you can buy a transformer with a small phase error. You can read about the error we measure with the transformers from the shop in the reports in Building Blocks. The third error is because the voltage and current are not measured at the same time, therefore the mains wave has advanced between measurements. The phase shift calibration extrapolates from two successive voltage readings to make the voltage reading appear to be taken at the same time that the current reading appears to have been taken. &quot;1.7&quot; is a good starting value for 50 Hz mains and the transformers from the shop. You need to adjust the number when setting up your system as explained on the Calibration page.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17801"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <img src="../sites/default/files/imagecache/avatar/default_0.png" alt="fellipem&#039;s picture" title="fellipem&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading sinusoidal wave with Arduino</h3>

    <div class="submitted">Submitted by fellipem (not verified) on Tue, 21/01/2014 - 11:43.</div>
    <div class="content">
     <p>Thanks Robert,</p>
<p>I did the calculus again, I measured 124V/8.3, the voltage calibration constante should be 97.11, I put it in the arduino sketch and made the upload again, but the voltage that appears in the Serial Monitor was almost 15V more than my multimeter was show me. So, I went down&nbsp;the value of the constant, when I stopped&nbsp;in 90.7 the Serial monitor shows me the exactly value of the multimeter (+/-0.3V of diference).</p>
<p>Should I left the constant&nbsp;iguals to 90.7 or found why the value of 97.11 make the diference about 15V ??</p>
<p>Thanks</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-17809"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Reading sinusoidal wave with Arduino</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 21/01/2014 - 17:47.</div>
    <div class="content">
     <p>You should use the number that gives you the correct answer - always assuming your multimeter is correct! The difference is likely to be because the internal reference voltage of the ADC is not exactly 1.1 V - it has a 9% (IIRC) tolerance so that, added to the tolerance of your voltage divider resistors, accounts for the difference. <a href="https://learn.openenergymonitor.org/?redirect=emontx-error-sources" title="http://openenergymonitor.org/emon/buildingblocks/emontx-error-sources">http://openenergymonitor.org/emon/buildingblocks/emontx-error-sources</a> tells you where the errors creep in.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/3678"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-D7D_h5LSqOinRYDjWKl-FPEsxXhIM7MA5lCx_TPYmdo" value="form-D7D_h5LSqOinRYDjWKl-FPEsxXhIM7MA5lCx_TPYmdo"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
