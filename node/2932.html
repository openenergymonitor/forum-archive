<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/2932 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 16:06:45 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Some guidance needed please! | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/6.html">Archived: Questions and support </a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Some guidance needed please!</h3>
        <span class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 12/10/2013 - 17:25</span>
        <div class="content"><p>Hi, can I get some help in putting together a monitoring/diverting solution please? specifically choosing a firmware.</p>
<p>I have assembled and installed a EmonTX&nbsp;with 3 CT&#39;s (solar, grid and usage) with an AC/AC adapter for voltage measurement. This is connected via a RFM12Pi to a Raspberry Pi running the OEM gateway SD card and appears to be working very well with EmonCMS remotely. Overall I&#39;m very impressed with the &quot;stock&quot; set up&#39;s features and accuracy. So thank you all, OEM :-)</p>
<p>Next I have built a Mk2 PV Router output circuit and would like to get this to working from the &quot;pulse input socket&quot; of the EmonTX BUT! I seem to have hit a bit of a wall as I did not fully understand that the firmwares&nbsp;were independent until now and I&#39;m unable to work out how to amalgamate the existing monitoring firmware (emontx_ct123_voltage) and the diverting firmware (mk2i_pv_router_rev_5b). I have tried to work this out for myself and have read many many pages of posts but I am still unsure of how to implement it. I can see a couple of forks to a couple of bespoke solutions but what isn&#39;t clear is how they compare to the &quot;official&quot; independent solutions and whether they are maintained/updated/bug-free/universal etc etc and I don&#39;t feel confident enough to decide for myself.&nbsp;</p>
<p>Ideally I would like to start close to mainstream design as I have a few tweaks of my own to try and if I am to learn I need a base that is either well documented or familiar to you experts so I can pick your brains as and when I get stuck.</p>
<p>Thanks in advance for your assistance.</p>
<p>Paul</p>
  <div class="forum-topic-navigation clear-block">
          <a href="237.html" class="topic-previous" title="Go to previous forum topic">‹ Solar hot water controller - extensions</a>
              <a href="2934.html" class="topic-next" title="Go to next forum topic">Calender on new Module help! ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-15671"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some guidance needed please!</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sat, 12/10/2013 - 18:42.</div>
    <div class="content">
     <p>Have you looked at MartinR&#39;s design: Solar PV power diversion with emonTx, emonGLCD and temperature measurement: <a href="1535.html" title="http://openenergymonitor.org/emon/node/1535">http://openenergymonitor.org/emon/node/1535</a></p>
<p>If I understand your needs correctly, it will do what you want, with possibly a minor modification for your hardware. MartinR is a well-regarded member of the community and you need have no worries on that score. The PLL design is however quite complicated to understand at first, but it is established and proven. Note that this design only uses two c.t&#39;s. For a diverter/controller, one c.t. must measure the nett grid power and is used for both measurement and control, the second is for measurement only. The third is unnecessary since the third quantity can be calculated knowing the other two.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15677"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some guidance needed please!</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 12/10/2013 - 21:57.</div>
    <div class="content">
     <p>Thanks for the reply&nbsp;Robert, I had looked at MartinR&#39;s design, but the thread is quite long and complex, some discussions appeared unfinished to my untrained eye. I had however assumed the software was sound as there was no criticism and Paul Reed had mentioned in another post he uses MartinR&#39;s design. I believe I became more comfortable with Robins design because it is well documented and has been continually revised, with a revision history.</p>
<p>I have re read the thread as I&#39;m unsure about the hardware mod you mention, are you&nbsp;referring to the hot water tank temperature sensor? I don&#39;t think I would use that method to control or calculate the diverted load. I believe external hot water tank temperature&nbsp;sensors are less accurate/responsive than internal sensors ie immersion heater sensor and then consumption of the available surplus power is just an assumption I would still need to install at least 1 more CT for a Consumption &amp; Dump load calculation (calculation is better than assumption) or better still 2 more CT&#39;s for&nbsp;Consumption &amp; Dump load measurements. (rather than a CT clamp I did intend to use a pcb mounted CT and burden resistor for dump load consumption)</p>
<p>Am I right in thinking this will work seamlessly with the Raspberry Pi in place of the emonGLCD as they listen to the same transmissions?</p>
<p>I have also noted it states &quot;Support for a single DS18B20 temperature sensor&quot; is this correct if so can it be changed? I had planned to add several temp sensors at a later date.</p>
<p>I hope I don&#39;t sound critical of MartinR&#39;s design (if I do I apologise) as that not my intention as there is no doubt its a great design and I do not have the expertise to say otherwise, I&#39;m just hoping to establish (if) it&#39;s what I need.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15678"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some guidance needed please!</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Sun, 13/10/2013 - 00:44.</div>
    <div class="content">
     <p>The reason I recommended MartinR&#39;s over Robin&#39;s is that Martin&#39;s has reporting to a GLCD or emonCMS via RF built in, whereas Robin does not do any reporting and uses the RF for controlling a remote load only.</p>
<p>The hardware mod you might need depends on the voltage you designed your triac interface for. If you followed Robins 5 V Arduino design, you&#39;ll need to change one resistor for the lower emonTx voltage of 3.3 V.&nbsp; I&#39;ve been intending to comprehensively document Martin&#39;s design for some months now, and have yet to get past the contents list! The delay is due to responding to forum posts ;-)</p>
<p>If you don&#39;t control the water tank temperature but rely on the cylinder thermostat, then Martin&#39;s code for reporting the diverted load fails and shows only the energy <em>available for</em> diversion, not that actually diverted. If you want that as a separate value, then you probably need to measure it with a further c.t. As you suggest, a split core one is overkill and a small ring type is most suitable. (Though I can think of a way to know when the cylinder &#39;stat has opened to allow you to estimate the diverted energy correctly.) Courtesy of Herr Kirchhoff, you don&#39;t need a further c.t. for overall consumption (and you will run out of sockets and probably processing power anyway if you have one for both that and diverted power).</p>
<p>The base and the GLCD listen to the same transmissions, so if you don&#39;t want the live display (or want it somewhere else), that&#39;s fine. All you need to do is ensure exactly the same data that you send now is sent, and then absolutely no change needs to be made to emonCMS.</p>
<p>You&#39;ll need to check with Martin regarding the temperature sensors. His code only works with one, I think the time it takes to read the sensor was the limiting factor.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15686"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some guidance needed please!</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sun, 13/10/2013 - 22:45.</div>
    <div class="content">
     <p>Robert -&nbsp;<em>I&#39;ve been intending to comprehensively document Martin&#39;s design for some months now...</em></p>
<p>I wish you would, I&#39;d love to know what&#39;s under the bonnet!</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15696"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some guidance needed please!</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 14/10/2013 - 22:02.</div>
    <div class="content">
     <p>So I have tweaked Martin&#39;s code to add another CT (solar, grid &amp; dumped) and the reporting side appears to be working ok, I say appears as I&#39;ve not made a test rig and the sun&#39;s barely made an appearance over the last couple of days, certainly not produced enough solar power to cover use let alone a surplus ;-(&nbsp;</p>
<p>I am going to play with it over the next few days and see if I can get my head around the code and any adjustments or calibrations that may be needed and bench test the triac before hooking up to the immersion heater.</p>
<p>Could someone summarize in (words of one syllable or less) the differences between Martins &amp; Robins approaches?</p>
<p>Is it possible to ease the processors workload by removing the RF&nbsp;code and hardwiring the EmonTX to the Raspberry Pi? as the Pi is connected to the router wirelessly it only needs power so they could go in the same box. although I would want to keep the RFM12Pi&nbsp;on the Raspberry Pi to add further nodes. In fact I guess could I also move the temp sensors across to the Pi if they were in one box.</p>
<p>Also if hard wired to the Raspberry Pi,&nbsp;could Robins code be modified to report the power and voltage values it already has, leaving the RF as it is to control a remote load and then maybe add 1 or 2 more CT&#39;s purely&nbsp;for reporting? has anyone tried this or is there a reason it can&#39;t be done?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15698"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some guidance needed please!</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 15/10/2013 - 00:15.</div>
    <div class="content">
     <p><em>Could someone summarize in (words of one syllable or less) the differences between Martins &amp; Robins approaches?</em></p>
<p>As I wrote above, Robin&#39;s code does not do monitoring and RF transmission of the measured values. It is purely a dump load controller. So that answers a few of your questions. On the load control side, both use similar algorithms.</p>
<p>It should be possible to send the data serially using the I<sup>2</sup>C one-wire bus, which I believe the RPi can accept; in fact that is the approach Martin used in his 3-phase &quot;Full fat&quot; monitor (<a href="1170.html" title="http://openenergymonitor.org/emon/node/1170">http://openenergymonitor.org/emon/node/1170</a>) to share data between 3 emonTx&#39;s. I don&#39;t know though whether it would significantly reduce the loading</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15699"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some guidance needed please!</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 15/10/2013 - 01:46.</div>
    <div class="content">
     <p>Thank you Robert. I was aware that Robin&#39;s was just a dump load controller in its present form but all I was wondering is whether it was superior at that function or perhaps more efficient with processor time to help establish whether it is worth the effort to try and add monitoring, but if they do a similar job controlling dump loads then there would seem little reason to when Martins already does the monitoring.&nbsp;</p>
<p>Your previous comment regards running out of processor power concerns me as although you&#39;re right about not needing a 4th&nbsp;CT, I would prefer not to be running the processor flat out or harder than needed as thats when things fall over and I may want to add/change things down the line eg a second dump load or more likely RF the dump load.</p>
<p>I&#39;m giving Martins code a run currently &amp; see how it goes......</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-15703"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Some guidance needed please!</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Tue, 15/10/2013 - 10:39.</div>
    <div class="content">
     <p>As Martin&#39;s code, and the later &quot;i&quot; examples of Robin&#39;s, all use interrupts, it is vital that the interrupt handler (ISR) completes in time to allow the main loop to do all it needs to in a timely manner. It&#39;s been a while since I looked in detail at Martin&#39;s code, from memory you need to use a &#39;scope to check how much free time is available. At least some of Robin&#39;s versions have that built in.</p>
<p>I have run both in a test situation - I did not do any rigorous measurements and found no flaws in either, and as the algorithms are based on the same principle, I would expect both to have very similar performance when set up the same.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/2932"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-hMXeoKoSTO5pbksspv8GAePb6KymW6ixGeOiFgoe278" value="form-hMXeoKoSTO5pbksspv8GAePb6KymW6ixGeOiFgoe278"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
