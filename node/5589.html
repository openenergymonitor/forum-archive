<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/5589 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 15:26:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Voltage reading from emonTxV3 continuous kwhtotals noeeprom | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>
        <span class="submitted">Submitted by <a href="../user/6745.html" title="View user profile.">normosb</a> on Wed, 20/08/2014 - 02:14</span>
        <div class="content"><p>Hi,</p>
<p>I&#39;m currently using the&nbsp;emonTxV3_continuous_kwhtotals_noeeprom sketch. I&#39;ve looked in to adding Voltage to the RF&nbsp;data but can&#39;t seem to find the voltage variable. What is it called? The complexities of the sketch are beyond my level of understanding.</p>
<p>typedef struct {<br />
	&nbsp;&nbsp; unsigned long msgNumber;<br />
	&nbsp;&nbsp; int realPower_CT1;<br />
	&nbsp;&nbsp; int realPower_CT2;<br />
	&nbsp;&nbsp; int realPower_CT3;<br />
	&nbsp;&nbsp; int realPower_CT4;<br />
	&nbsp;&nbsp; long wh_CT1;<br />
	&nbsp;&nbsp; long wh_CT2;<br />
	&nbsp;&nbsp; long wh_CT3;<br />
	&nbsp;&nbsp; long wh_CT4;<br />
	} Tx_struct;&nbsp;&nbsp;&nbsp; // revised data for RF comms<br />
	Tx_struct tx_data;</p>
<p>Thanks!</p>
  <div class="forum-topic-navigation clear-block">
          <a href="10233.html" class="topic-previous" title="Go to previous forum topic">‹ Multiple ds18b20 on Emontx3.4</a>
              <a href="10223.html" class="topic-next" title="Go to next forum topic">emoncms on R Pi Raspbian build - saw local landing page once, now it&#039;s blank white ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-23225"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 20/08/2014 - 08:13.</div>
    <div class="content">
     <p>This sketch appears to be based on one that I have supplied for use with the emonTx V3.&nbsp; I say this because my name appears at the top! &nbsp; Although voltage samples are &quot;continuously&quot; taken, they are only used for the purpose of calculating Real Power.</p>
<p>To display Vrms would require additional processing of the voltage samples which is not included in this code.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23244"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6745.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="normosb&#039;s picture" title="normosb&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/6745.html" title="View user profile.">normosb</a> on Wed, 20/08/2014 - 21:35.</div>
    <div class="content">
     <p>Thanks very much for your reply. Voltage was a&nbsp;nice to have reading.</p>
<p>I&#39;ll put this in the way to hard basket at the moment seeing as it&#39;s not readily available in the code!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23245"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Wed, 20/08/2014 - 22:06.</div>
    <div class="content">
     <p>What values would you like to be transmitted, along with the RMS voltage?&nbsp; Specifying exactly what data needs to be transmitted, and how often, seems to be every bit as elusive as writing the code for it.</p>
<p>Although this sketch is monitoring continuously, much of the data that it collects is not being used.&nbsp; If data is only to be transmitted every 10 seconds, then each measurement window should be 10 seconds too.&nbsp; Otherwise data will be overwritten before being sent.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23246"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6745.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="normosb&#039;s picture" title="normosb&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/6745.html" title="View user profile.">normosb</a> on Wed, 20/08/2014 - 22:41.</div>
    <div class="content">
     <p>I&#39;d like RMS voltage and temp from DS18B20, basically&nbsp;the functionality the non watt hour sketch had.</p>
<p>I can probably handle adding the code for the temperature sensor back in. I changed the RF send to every 5 seconds in an attempt to display power changes quicker in emonCMS &amp; my local display.</p>
<p>Actually how about power factor and frequency? could be interesting.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23249"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Wed, 20/08/2014 - 22:59.</div>
    <div class="content">
     <p>If you&#39;re looking for the full range of measurements, Martin Roberts&#39; <a href="1535.html">PLL sketch</a> might be worth considering (with the diverter logic removed if you wish - or just ignore it). (You&#39;re OK with that, there&#39;s a 60 Hz version elsewhere for those that need it.)</p>
<p>The logic is somewhat complicated as Martin didn&#39;t use the library calls due to the overhead they carry, but I&#39;ve explained most of it in the &#39;Guide&#39; article about energy diverters.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23255"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Thu, 21/08/2014 - 08:09.</div>
    <div class="content">
     <p><em>I can probably handle adding the code for the temperature sensor back in.</em></p>
<p>As this sketch is based on my code for taking continuous measurements, temperature sensing has never been included.</p>
<p>Taking temperature measurements when nothing else is happening is straightforward enough.&nbsp; But in a &quot;continuous monitoring&quot; sketch, such as the one we&#39;re discussing here, the situation is rather different.&nbsp; If the standard library routines for measuring temperature are used, the flow of V and I data ceases to be continuous.&nbsp; Gaps are caused while the OneWire routines run their course.</p>
<p>Martin&#39;s PLL-based code does appear able to perform both continuous measurements of its V and I sensors, and also provide temperature measurements - but not using the standard library routines.&nbsp; If anyone can explain to me how this mechanism actually works, I would be most grateful.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23259"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 21/08/2014 - 09:11.</div>
    <div class="content">
     <p><em>&quot;If anyone can explain to me how this mechanism actually works, I would be most grateful.</em>&quot;</p>
<p>Deviously!</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23268"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6745.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="normosb&#039;s picture" title="normosb&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/6745.html" title="View user profile.">normosb</a> on Thu, 21/08/2014 - 12:04.</div>
    <div class="content">
     <p>Thanks for the information. You&#39;ve convinced me to not got tampering with the continuous sketch :) I&#39;ll have a look at Martin&#39;s PLL sketch.&nbsp;</p>
<p>Regards</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23274"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/924.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Robert Wall&#039;s picture" title="Robert Wall&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/924.html" title="View user profile.">Robert Wall</a> on Thu, 21/08/2014 - 20:08.</div>
    <div class="content">
     <p>Martin&#39;s PLL sketch was designed for energy diversion, which means it has two current inputs only. It should be possible to extend it if you need to use all 4 current inputs. Dan Woodie certainly extended it to 3 at 60 Hz (<a href="2624.html" title="http://openenergymonitor.org/emon/node/2624">http://openenergymonitor.org/emon/node/2624</a> and <a href="2679.html" title="http://openenergymonitor.org/emon/node/2679">http://openenergymonitor.org/emon/node/2679</a>).</p>
<p>Expanding on my &quot;deviously&quot; answer above: The library routines for measuring the temperature cannot make any assumptions about the state of the sensor, and they must therefore set it up completely each time assuming nothing, and wait for the measurement to be done and only then they return with the value, while that is happening the processor must wait. Martin was able to sidestep all the reconfiguration that the library does because he knew nothing had changed between readings, and he was able to split the reading process into two and sidestep the wait while the sensor does the measurement. First he requests a reading and then the sketch does other things while the sensor gets the temperature, converts it and stores it in its buffer memory. He then comes back and gets the answer from the buffer. This makes not the slightest difference in practice as the temperature changes only slowly compared to the time to execute the main loop in the sketch.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23277"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/6745.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="normosb&#039;s picture" title="normosb&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/6745.html" title="View user profile.">normosb</a> on Thu, 21/08/2014 - 20:59.</div>
    <div class="content">
     <p>Thanks for the explanation, impressive stuff! I&#39;m using 3 current inputs at the moment.</p>
<p>I&#39;ll hold off on trying to extend the sketch till my skills are up to the task.</p>
<p>I&#39;ve certainly learnt&nbsp;a lot since embarking on my house monitoring project. I find it very rewarding. The support available on OEM makes anything seem possible, some very bright cookies are involved with this project.</p>
<p>I now understand why developers love Linux. It&#39;s awesome what you can do with a few shell commands. I&#39;m in the process of configuring emonCMS&nbsp;on the Raspberry Pi purchased last week with help from the OEM forums of course :)</p>
<p>Thanks again.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-23284"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/956.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-956.jpg" alt="calypso_rae&#039;s picture" title="calypso_rae&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/956.html" title="View user profile.">calypso_rae</a> on Fri, 22/08/2014 - 08:20.</div>
    <div class="content">
     <p>Thanks, Robert, for your comprehensive explanation about temperature sensing.&nbsp;</p>
<p>I look forward to trying this out in my own code ...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-28280"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7764.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="hercules71035&#039;s picture" title="hercules71035&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Voltage reading from emonTxV3 continuous kwhtotals noeeprom</h3>

    <div class="submitted">Submitted by <a href="../user/7764.html" title="View user profile.">hercules71035</a> on Sat, 28/02/2015 - 17:20.</div>
    <div class="content">
     <p>So, there no way for get voltage from this sketch?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/5589"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-KXq7iux6vqXZEPKvxTlZF6moc1GwF2-MTC05FpDNuVo" value="form-KXq7iux6vqXZEPKvxTlZF6moc1GwF2-MTC05FpDNuVo"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
<div style="margin:0 auto;width:1000px;">
  <div style ="float:right;width:400px;padding-right:20px;">
    <script>
      (function() {
        var cx = '006198118389747886812:rtaoc3wurta';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <gcse:searchbox-only></gcse:searchbox-only>
  </div>
</div>

</body>
</html>
