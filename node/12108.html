<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">


<!-- Mirrored from openenergymonitor.org/emon/node/12108 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:44:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok | Archived Forum</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/default/files/emon3_favicon.png" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="../modules/node/node4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/defaults4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/system/system-menus4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/user/user4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/mollom/mollom4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/forum/forum4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/modules/views/css/views4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../modules/comment/comment4b43.css?r" />
<link type="text/css" rel="stylesheet" media="all" href="../sites/all/themes/emon3/style4b43.css?r" />
<style type="text/css" media="all">@import "../sites/all/themes/emon3/user_bar.css";</style>
    <script type="text/javascript"> </script>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
</head>

<body>

<div id="box">

<table border="0" cellpadding="0" cellspacing="0" id="header">
  <tr>
    <td id="logo">
       <h1 class='site-name'><a href="../index.html" title="Home">Archived Forum</a></h1>    </td>
    <td id="menu">
      
                  
      
    </td>
  </tr>
  <tr>
    <td colspan="2"><div></div></td>
</tr>
</table>
<!--<div style="background-color:#444444; border-top: 1px solid #888; height:32px;">-->

<table border="0" cellpadding="0" cellspacing="0" id="content">
  <tr>
        <td valign="top">
            <div id="main">
        <div class="breadcrumb"><a href="../index.html">Home</a> » <a href="../forum.html">Forums</a> » <a href="../forum/5.html">Archived: Software</a></div>     
        <div class="tabs"></div>
                          <div class="node">

    
    
          <div class="comment" >
                <h3 class="title" style="">Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>
        <span class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Sat, 30/01/2016 - 09:22</span>
        <div class="content"><p>im running the December&nbsp;beta emonpi&nbsp;image and last night (around 9am uk time) all my RF received channels stopped updating but my MQTT ones kept working suggesting&nbsp;that most of the system was still alive. The RF module was still blinking its red led suggesting that the radio but was still alive too and a reboot fixed everything.</p>
<p>i recently updated the RFM&nbsp;to the latest version.</p>
<p>Is this a known problem? It&#39;s the first time I&#39;ve seen it.</p>
  <div class="forum-topic-navigation clear-block">
          <a href="12209.html" class="topic-previous" title="Go to previous forum topic">‹ Feeds not updating - PHPFina:post timestamp out of range</a>
              <a href="12189.html" class="topic-next" title="Go to next forum topic">(BETA #2): emonSD-16Feb16 - emonPi / emonBase (Raspberry Pi + RFM69Pi) Emoncms v9 pre-built SD card image ›</a>
      </div>
</div>
      </div>
    
    <div class="links">&raquo; <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul></div>  </div>
<div id="comments">
  <a id="comment-38905"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 30/01/2016 - 11:08.</div>
    <div class="content">
     <p>I&#39;m currently experiencing the same issue - <a href="12004.html">see this thread</a>.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38906"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 30/01/2016 - 11:55.</div>
    <div class="content">
     <p>The fact that the RFM2Pi&#39;s&nbsp;LED continued to blink would suggest the issue is more likely to be on the Pi rather than the RFM2Pi. The best place to look should this reoccur is in emonhub.log. I suspect the RFM2Pi thread may have died but we cannot confirm that as after a reboot,&nbsp;the read-only OS of the&nbsp;emonPi&nbsp;image&nbsp;clears all the logs and any useful info with it.</p>
<p>@Paul - are you still having trouble? I hoped&nbsp;no news was good news as there were no further reports.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38908"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Sat, 30/01/2016 - 12:38.</div>
    <div class="content">
     <p>I&#39;ve just updated my thread Paul, but yes, this does seem different as my LED stops flashing.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38920"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Sat, 30/01/2016 - 23:46.</div>
    <div class="content">
     <p>@PB66, I&#39;m guessing I need to change the logging as currenly&nbsp;/log/emonhub/emonhub.log just contains</p>
<p>2016-01-29 21:44:18,981 INFO &nbsp; &nbsp; MainThread EmonHub emonHub &#39;emon-pi&#39; variant v1.1<br />
2016-01-29 21:44:18,983 INFO &nbsp; &nbsp; MainThread Opening hub...</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38925"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 31/01/2016 - 11:35.</div>
    <div class="content">
     <p>I also get this issue. 9.3 installation following the raspi installation guide on a PiB on Jessie Lite with USB HDD.</p>
<p>In my case, the rfm12 led is flashing at the 5 second interval but if I look at the emoncms&nbsp;Input View I see that the inputs haven&#39;t been updated for a long time. Last time I hadn&#39;t checked things for a while and all the inputs were 31 hours since last update (note to self - must set up a notification when this occurs!)</p>
<p>emonhub log shows some errors over the previous hours mainly to do with emoncms send failures, e.g.</p>
<p>2016-01-30 02:49:44,762 WARNING emonCMS send failure: wanted &#39;ok&#39; but got &#39;&#39;<br />
2016-01-30 03:01:34,797 WARNING emonCMS couldn&#39;t send to server, Exception: Traceback (most recent call last):<br />
&nbsp; File &quot;/home/pi/emonhub/src/emonhub_reporter.py&quot;, line 227, in _send_post<br />
&nbsp; &nbsp; response = urllib2.urlopen(request, timeout=60) &nbsp; etc. etc. etc.</p>
<p>emonhub status gives:</p>
<p>pi@Homepi-emoncms:~ $ sudo service emonhub status<br />
● emonhub.service - LSB: Start/stop emonHub<br />
&nbsp; &nbsp;Loaded: loaded (/etc/init.d/emonhub)<br />
&nbsp; &nbsp;Active: active (running) since Fri 2016-01-29 16:59:01 GMT; 1 day 18h ago<br />
&nbsp; Process: 331 ExecStart=/etc/init.d/emonhub start (code=exited, status=0/SUCCESS)<br />
&nbsp; &nbsp;CGroup: /system.slice/emonhub.service<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;└─378 python /usr/share/emonhub/emonhub.py --logfile /var/log/emonhub/emonhub.log --...</p>
<p>Jan 29 16:58:58 Homepi-emoncms emonhub[331]: Starting OpenEnergyMonitor emonHub: emonhub has...ok.<br />
Jan 29 16:59:01 Homepi-emoncms systemd[1]: Started LSB: Start/stop emonHub.<br />
Jan 31 03:12:06 Homepi-emoncms emonhub[331]: Traceback (most recent call last):<br />
Jan 31 03:12:06 Homepi-emoncms emonhub[331]: File &quot;/usr/share/emonhub/emonhub.py&quot;, line 338,...le&gt;<br />
Jan 31 03:12:06 Homepi-emoncms emonhub[331]: hub.run()<br />
Jan 31 03:12:06 Homepi-emoncms emonhub[331]: File &quot;/usr/share/emonhub/emonhub.py&quot;, line 90, in run<br />
Jan 31 03:12:06 Homepi-emoncms emonhub[331]: values = I.read()<br />
Jan 31 03:12:06 Homepi-emoncms emonhub[331]: File &quot;/home/pi/emonhub/src/emonhub_interfacer.p...ead<br />
Jan 31 03:12:06 Homepi-emoncms emonhub[331]: self._sock_rx_buf = self._sock_rx_buf + conn.re...24)<br />
Jan 31 03:12:06 Homepi-emoncms emonhub[331]: socket.error: [Errno 104] Connection reset by peer<br />
Hint: Some lines were ellipsized, use -l to show in full.</p>
<p>Is there anything else I can check to see what emonhub is doing?</p>
<p>sudo service emonhub stop, then start brings things back to life, inputs start updating every 5 seconds or so.</p>
<p>Simon</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38929"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 31/01/2016 - 13:12.</div>
    <div class="content">
     <p>@Sheppy - yes, I would set a loglevel=DEBUG just to be sure I captured as much info as possible, the loglevel=WARNING may tell you &quot;it&#39;s&nbsp;broke&quot; but not give you any insight as to why it broke, in these instances the more info the better usually.&nbsp;</p>
<p>@ Simon - I don&#39;t think this is the same issue either because the &quot;break&quot; in your route is between emonhub and emoncms, this is unlikely to be able to differentiate between mqtt and rfm, this thread is about rfm stopping whilst mqtt continues so the issue is most likely between emonhub and the rfm2pi.</p>
<p>However the same applies about the loglevel and&nbsp;the lead up&nbsp;to&nbsp;the fault in your&nbsp;log. the&nbsp;2 emonhub&nbsp;messages you posted tell us emonhub&nbsp;didn&#39;t get the expected response from emoncms&nbsp;and what that response was. It does not tell us if what it sent was likely to get a good&nbsp;response.</p>
<p>Plus sheppy is using the emon-pi variant on the 22dec&nbsp;image not genuine emonhub&nbsp;v1.2&nbsp;on Jessie-lite. I am&nbsp;pretty confident that your issue will be with (reaching)&nbsp;emoncms not emonhub. possibly another dns/dhcp issue with &quot;lite&quot;.</p>
<p>If you are also still having &quot;rfm only&quot; issues as well then we need to revisit&nbsp;your existing RFM2Pi&nbsp;thread.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38941"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 31/01/2016 - 16:44.</div>
    <div class="content">
     <p>Hi paul, you&#39;re right I shouldn&#39;t have hijacked this thread. My issues with rfm have gone away and now I only have this type of failure.</p>
<p>Although I think I need some more info from you,&nbsp;When you say &#39;your route is between emonhub and emoncms, this is <em>unlikely to be able to differentiate between mqtt and rfm</em>&#39; and &#39;the&nbsp;2 emonhub&nbsp;messages you posted tell us emonhub&nbsp;didn&#39;t get the expected response from emoncms&nbsp;and what that response was. <em>It does not tell us if what it sent was likely to get a good&nbsp;response</em>.&#39; Can you be a bit more specific. I&#39;d be glad to start up a new thread on these types of issues.</p>
<p>Simon</p>
<p>PS you keep accusing me of having dhcp and dns issues, which i&#39;m sure I haven&#39;t got at all &nbsp; accusing is perhaps the wrong word but it&#39;ll have to do &nbsp;:-). &nbsp;There was a dns issue on wget which I tracked down to my ISP virgin media with the help of the pi forums but that wouldn&#39;t affect this.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38961"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Mon, 01/02/2016 - 08:07.</div>
    <div class="content">
     <p>@pb66&nbsp;It hasn&#39;t failed so far so nothing to report. I&#39;ll try and establish a failure pattern and then turn the logging on when a failure is due. Its been up for almost 48 hours so far. Are there any services I can restart when it does fail to narrow it down a bit?&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38967"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 01/02/2016 - 12:25.</div>
    <div class="content">
     <p>@ sheppy - I&#39;d be inclined to just change the loglevel now, you do not need to restart and you can always change it back further down the line if no longer required. The main benefit of the log is to gather data unattended and continuously so that when the issue&nbsp;occurs unexpectedly,&nbsp;data has already been captured that may help establish the cause or pattern.</p>
<p>At the moment we have zero info so I couldn&#39;t say what would be a valid test, the logs from when/if&nbsp;it fails will hopefully give us some direction, even if they contain no error codes the continued logging of certain messages may confirm or eliminate certain possibilities.</p>
<p>@Simon - I only&nbsp;suggest&nbsp;a possible dns/dhcp&nbsp;issue when it fits the symptoms, like your&nbsp;example&nbsp;when &quot;There was a&nbsp;dns issue on wget&quot; or&nbsp;when your&nbsp;<a href="11837.html">emonhub warnings and exceptions</a>&nbsp;clearly stated &quot;URLError: [Errno -2] Name or service not known&quot;.</p>
<p>If there is a problem with your set up that is preventing emonhub communicating with an emoncms instance on the same machine via http, then the first thing that sprung to my mind was a dns/dchp&nbsp;type issue, a thought&nbsp;I shared with you in hope it may help not offend, my use of the term &quot;another&quot; only casually refers to it not being the first time you will have encountered an issue of this type IF indeed it is of this type, not that is necessarily related.</p>
<p>A new thread maybe a good idea and was the reason for pointing out the difference in issues the first of those&nbsp;2 comments. Since the messages state emonhub did not get a valid response from emoncms, it is highly unlikely to be specific any one type of input and not others (ie rfm not mqtt as the op reports) and I also commented that emoncms&#39;s&nbsp;non-response might actually be due to a bad request from emonhub. I&#39;m not suggesting that is (or isn&#39;t) the case, it probably (but not definitely)&nbsp;isn&#39;t, but I was only pointing out the information to make a quick and very useful observation isn&#39;t present in the short piece of log provided, which was inline with what I was saying to Sheppy about the loglevel at that point.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38981"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Mon, 01/02/2016 - 20:39.</div>
    <div class="content">
     <p>@pb66&nbsp;Debug&nbsp;Logging turned on - presumably it will trim it before the tmpfs /var/log runs out of space?</p>
<p>Also is it worth turning on quiet mode? (how?)&nbsp;There&#39;s a lot of discarded packets in there</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38992"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 01/02/2016 - 21:31.</div>
    <div class="content">
     <p>emonhub self manages it&#39;s logfiles,&nbsp;rotating them at 5mb although if using the emonpi image I believe there may be&nbsp;log rotation&nbsp;at 1mb. Either way, no, emonhub&nbsp;cannot consume the whole /var/log&nbsp;tmpfs partition..</p>
<p>Tough call to make on quiet mode. Yes, less packets may be less difficult to sift through, but if your loss of data is due to packets no longer being seen as valid, or a potential serial issue, the &quot;noise&quot; may be useful. Flip a coin, or go with your instinct if there really are that many. It can be enabled/disabled by setting &quot;quiet = true&quot; or &quot;quiet = false&quot; in the runtimesettings of the RFM2Pi&nbsp;in emonhub.conf. By default, quiet mode is active (true) if there is no entry.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-38993"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Mon, 01/02/2016 - 21:36.</div>
    <div class="content">
     <p>I&#39;ll leave it as is, especially as details on this issue are lacking.</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39020"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Tue, 02/02/2016 - 10:42.</div>
    <div class="content">
     <p>@Paul, thanks for the (as usual) clear explanation.</p>
<p>Having said that I&#39;m not sure that my issue is different to Sheppy&#39;s.</p>
<p>The system stopped passing through data again soon after the last time. I had changed the emonhub log setting to DEBUG in the meantime. You&#39;ll see the log below.</p>
<p>Essentially everything was running fine, no warnings about not being able to reach emoncms etc. when suddenly the log stops. You&#39;ll see the restart a few hours later. I&#39;ve highlighted in BOLD the point where I did the service emonhub stop and start to get things functioning again. I haven&#39;t done a reboot on the system for a few weeks, just stopped and started emonhub if there has been an issue.</p>
<p>If this occurs again in the future is there any arcane bit of Linux I can use to get an idea of what has happened. You mention the rfm2pi thread in one of your earlier replies. Can I see if that is still running? Or are there any other logs I can look at?</p>
<p>Simon</p>
<p>2016-02-01 03:41:44,253 DEBUG 7585 NEW FRAME : 1454298104.25 &nbsp;10 46 1 0 0 0 0 0 0 189 94 178 1 122 2 199 1 153 2 114 1<br />
2016-02-01 03:41:44,270 DEBUG 7585 Timestamp : 1454298104.25<br />
2016-02-01 03:41:44,273 DEBUG 7585 &nbsp; &nbsp; &nbsp;Node : 10<br />
2016-02-01 03:41:44,275 DEBUG 7585 &nbsp; &nbsp;Values : [302, 0, 0, 0, 24253, 434, 634, 455, 665, 370]<br />
2016-02-01 03:41:44,373 DEBUG 7585 Append to &#39;emonCMSlocal&#39; buffer =&gt; time: 1454298104.25, data: [10, 302, 0, 0, 0, 24253, 434, 634, 455, 665, 370], ref: 7585<br />
2016-02-01 03:41:44,477 INFO emonCMSlocal sending: http://localhost/emoncms/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1454298104.25,10,302,0,0,0,24253,434,634,455,665,370]]&amp;sentat=1454298104<br />
2016-02-01 03:41:44,667 DEBUG emonCMSlocal acknowledged receipt with &#39;ok&#39; from <a href="http://localhost/emoncms" title="http://localhost/emoncms">http://localhost/emoncms</a><br />
2016-02-01 03:41:45,567 DEBUG emonCMS acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
2016-02-01 03:41:45,580 DEBUG 7585 Append to &#39;emonCMS&#39; buffer =&gt; time: 1454298104.25, data: [10, 302, 0, 0, 0, 24253, 434, 634, 455, 665, 370], ref: 7585<br />
2016-02-01 03:41:45,684 INFO emonCMS sending: http://emoncms.org/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1454298104.25,10,302,0,0,0,24253,434,634,455,665,370]]&amp;sentat=1454298105<br />
2016-02-01 03:41:45,766 DEBUG emonCMS acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
<strong>2016-02-01 08:08:19,343 DEBUG SIGINT received.</strong><br />
2016-02-01 08:09:09,476 INFO EmonHub Pre-Release Development Version (rc1.2)<br />
2016-02-01 08:09:09,479 INFO Opening hub...<br />
2016-02-01 08:09:09,492 INFO Logging level set to DEBUG<br />
2016-02-01 08:09:09,495 INFO Creating EmonHubEmoncmsReporter &#39;emonCMS&#39;&nbsp;<br />
2016-02-01 08:09:09,512 INFO Set up reporter &#39;emonCMS&#39; (buffer: memory | size: 1000)<br />
2016-02-01 08:09:09,523 INFO Setting emonCMS url: <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
2016-02-01 08:09:09,525 INFO Setting emonCMS apikey: set<br />
2016-02-01 08:09:09,528 INFO Creating EmonHubEmoncmsReporter &#39;emonCMSlocal&#39;&nbsp;<br />
2016-02-01 08:09:09,544 INFO Set up reporter &#39;emonCMSlocal&#39; (buffer: memory | size: 1000)<br />
2016-02-01 08:09:09,563 INFO Setting emonCMSlocal url: <a href="http://localhost/emoncms" title="http://localhost/emoncms">http://localhost/emoncms</a><br />
2016-02-01 08:09:09,565 INFO Setting emonCMSlocal apikey: set<br />
2016-02-01 08:09:09,568 INFO Creating EmonHubJeeInterfacer &#39;RFM2Pi&#39;&nbsp;<br />
2016-02-01 08:09:09,574 DEBUG Opening serial port: /dev/ttyAMA0 @ 9600 bits/s<br />
2016-02-01 08:09:11,580 INFO RFM2Pi device firmware version &amp; configuration: not available<br />
2016-02-01 08:09:11,583 INFO Setting RFM2Pi frequency: 868 (8b)<br />
2016-02-01 08:09:12,587 INFO Setting RFM2Pi group: 210 (210g)<br />
2016-02-01 08:09:13,590 INFO Setting RFM2Pi quiet: 1 (1q)<br />
2016-02-01 08:09:14,594 INFO Setting RFM2Pi baseid: 15 (15i)<br />
2016-02-01 08:09:15,598 INFO Creating EmonHubSocketInterfacer &#39;Socket&#39;&nbsp;<br />
2016-02-01 08:09:15,601 DEBUG Opening socket on port 20100<br />
2016-02-01 08:09:15,648 DEBUG RFM2Pi acknowledged command: &gt; 8b<br />
2016-02-01 08:09:16,154 DEBUG RFM2Pi acknowledged command: &gt; 210g<br />
2016-02-01 08:09:16,634 DEBUG RFM2Pi acknowledged command: &gt; 1q<br />
2016-02-01 08:09:16,900 DEBUG RFM2Pi acknowledged command: &gt; 15i<br />
2016-02-01 08:09:17,407 DEBUG 1 NEW FRAME : 1454314157.41 &nbsp;10 244 3 0 0 0 0 0 0 204 94 69 1 81 1 68 1 176 2 19 2<br />
2016-02-01 08:09:17,424 DEBUG 1 Timestamp : 1454314157.41<br />
2016-02-01 08:09:17,426 DEBUG 1 &nbsp; &nbsp; &nbsp;Node : 10<br />
2016-02-01 08:09:17,429 DEBUG 1 &nbsp; &nbsp;Values : [1012, 0, 0, 0, 24268, 325, 337, 324, 688, 531]<br />
2016-02-01 08:09:17,504 DEBUG 1 Append to &#39;emonCMS&#39; buffer =&gt; time: 1454314157.41, data: [10, 1012, 0, 0, 0, 24268, 325, 337, 324, 688, 531], ref: 1<br />
2016-02-01 08:09:17,539 DEBUG 1 Append to &#39;emonCMSlocal&#39; buffer =&gt; time: 1454314157.41, data: [10, 1012, 0, 0, 0, 24268, 325, 337, 324, 688, 531], ref: 1<br />
2016-02-01 08:09:17,607 INFO emonCMS sending: http://emoncms.org/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1454314157.41,10,1012,0,0,0,24268,325,337,324,688,531]]&amp;sentat=1454314157<br />
2016-02-01 08:09:17,643 INFO emonCMSlocal sending: http://localhost/emoncms/input/bulk.json?apikey=E-M-O-N-C-M-S-A-P-I-K-E-Y&amp;data=[[1454314157.41,10,1012,0,0,0,24268,325,337,324,688,531]]&amp;sentat=1454314157<br />
2016-02-01 08:09:17,852 DEBUG emonCMSlocal acknowledged receipt with &#39;ok&#39; from <a href="http://localhost/emoncms" title="http://localhost/emoncms">http://localhost/emoncms</a><br />
2016-02-01 08:09:18,116 DEBUG emonCMS acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a></p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39030"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Tue, 02/02/2016 - 14:10.</div>
    <div class="content">
     <p>I need to think about this some more,&nbsp;I can see no reason why if it is able to log the SIGINT why it isn&#39;t logging a graceful shutdown of emonhub. I need to find out some more info on Jessie and possibly why the SIGINT&nbsp;is being used over SIGTERM, and&nbsp;if that is a problem. I have no clue as to why this has suddenly changed, there has been no change to emonhub v1.2. Clutching at straws a&nbsp;bit&nbsp;here, but maybe the serial port not being gracefully closed is causing a serial communication error when trying to re-use the open but orphaned port and on this occasion it has eventually been closed by the OS prior to trying a restart on emonhub&nbsp;some&nbsp;4+hrs later. I do not even know if the OS can do that, I&#39;m just putting the clues together.</p>
<p>if it occurs again can you also do a &quot;df -h&quot; to check there is still some available disk space just in case it&#39;s choking?</p>
<p>Also can you set an &quot;interval = 600&quot; in the RFM2Pi&nbsp;runtimesettings, it will transmit the time for a glcd every 10mins, doesn&#39;t matter if you have one or not,&nbsp;it will cause emonhub to try and do something every 10mins even if theres no data coming in. I&#39;m not suggesting this is the case but the log finishes quite tidily with an &quot;ok&quot; from emoncms&nbsp;as if it was patiently awaiting data from the rfm2pi for over 4hrs, the attempts to send the time would be proof of life and also the response to the attempts to tx the time will give insight to whether the rfm2pi is on-line.</p>
<p>Paul&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39032"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Tue, 02/02/2016 - 14:27.</div>
    <div class="content">
     <p>Will do Paul. Will be good to get to the bottom of this.</p>
<p>One thing I did look at but when things were running again was to use top to see if anything is hogging the system. I think you had also seen some latency with SSH on Jessie. I&#39;m not sure if I am reading the output correctly but the emonhub/emoncms bits seem to be taking less than 15% of CPU. So plenty of bandwidth there.</p>
<p>I&#39;ll report back if and when things go awry again.</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39040"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Tue, 02/02/2016 - 21:18.</div>
    <div class="content">
     <p>@PB66 in case it affects your thinking my issue happened with EMONCMS locally and @Bramco appears to use emoncms.org so I&#39;d guess that can be ruled out as a cause. I&#39;ve just switched to a newly built image so it will be a few days before I can offer anything meaningful.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39049"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Wed, 03/02/2016 - 00:17.</div>
    <div class="content">
     <p>@sheppy. &nbsp;I use both. Local and .org.</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39050"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/7997.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="sheppy&#039;s picture" title="sheppy&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/7997.html" title="View user profile.">sheppy</a> on Wed, 03/02/2016 - 00:18.</div>
    <div class="content">
     <p>@Simon. Presumably they both stop updating?</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39064"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Wed, 03/02/2016 - 10:11.</div>
    <div class="content">
     <p>@Sheppy - yes it affects both of them.</p>
<p>Here&#39;s the output from the df -h</p>
<p>pi@Homepi-emoncms:~ $ df -h<br />
Filesystem &nbsp; &nbsp; &nbsp;Size &nbsp;Used Avail Use% Mounted on<br />
/dev/root &nbsp; &nbsp; &nbsp; 5.1G &nbsp;1.3G &nbsp;3.6G &nbsp;26% /<br />
devtmpfs &nbsp; &nbsp; &nbsp; &nbsp; 87M &nbsp; &nbsp; 0 &nbsp; 87M &nbsp; 0% /dev<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp; &nbsp; 0 &nbsp; 91M &nbsp; 0% /dev/shm<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp;4.5M &nbsp; 87M &nbsp; 5% /run<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5.0M &nbsp;4.0K &nbsp;5.0M &nbsp; 1% /run/lock<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp; &nbsp; 0 &nbsp; 91M &nbsp; 0% /sys/fs/cgroup<br />
/dev/mmcblk0p1 &nbsp; 60M &nbsp; 20M &nbsp; 41M &nbsp;34% /boot</p>
<p>Although I&#39;m not sure I understand this as the system has been transferred to the HDD, so the sizes don&#39;t seem right.</p>
<p>Also attached is the emonhub log.</p>
<p>Take a look at 14:30 yesterday where I stopped and restarted the hub to add the interval = 600. This shows a normal stop and restart (unlike the one above, or the one at 08:22 today). Also from the log you can see that emonCMSLocal gets it&#39;s data in a big chunk every 10 minutes, which is I guess what you&#39;d expect from the interval = 600 setting.</p>
<p>Everything seems to run normally like this, sending to emonCMS (.org) on every packet and to emonCMSLocal every 10 minutes until you get to 19:19 yesterday evening when the emonCMS&nbsp;sends stop and the new frame reporting stops. But sending to emonCMSLocal in 10 minute batches continues at 19:22 and then every 10 minutes until everything finally grinds to a stop at 20:23. (There does seem to be a disjoin between the last timestamp to emonCMS and the first time stamp in the next batch to emonCMSLocal.)</p>
<p>Anyway, over to you Paul, any ideas?</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39065"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 03/02/2016 - 10:14.</div>
    <div class="content">
     <p><em>Although I&#39;m not sure I understand this as the system has been transferred to the HDD, so the sizes don&#39;t seem right.</em></p>
<p>Have you expanded your filesystem&nbsp;to fill the HDD?<br />
GParted&nbsp;is a good graphical tool to use, or it can be done using&nbsp;resize2fs via the command terminal.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39066"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Wed, 03/02/2016 - 10:49.</div>
    <div class="content">
     <p>Hadn&#39;t done that Paul, I was under the impression the script to switch from SD to HDD did that for you?</p>
<p>I&#39;ll use GParted next time I have to restart. Thanks for the tip.</p>
<p>Simon</p>
<p>PS If the script doesn&#39;t do the expand, maybe this tip should be added to the instructions for switching from SD to HDD.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39067"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/238.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-238.jpg" alt="Paul Reed&#039;s picture" title="Paul Reed&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/238.html" title="View user profile.">Paul Reed</a> on Wed, 03/02/2016 - 11:02.</div>
    <div class="content">
     <p>The script does expand the filesystem, but in the HDD guide it stresses that it applies to systems installed via the Raspberry Pi installation guide, which is either Wheezy or Jessie, and I think that you are using Lite?<br />
The script has not been tested using Lite, so probably doesn't work fully, as it relies upon other software being available in the OS, which maybe has been stripped out in Lite.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39068"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Wed, 03/02/2016 - 11:43.</div>
    <div class="content">
     <p>I&#39;ll give it a whirl later today when I&#39;m home, I have the image saved so can quickly transfer it to an SD. I can&#39;t remember seeing any errors when I did it last time but if there are I&#39;ll post it in a separate&nbsp;issue.</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39082"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Wed, 03/02/2016 - 14:09.</div>
    <div class="content">
     <p>@Simon - not quite sure how you ended up putting the &quot;interval = 600&quot; in the &quot;emonCMSlocal&quot; runtimesettings rather than the &quot;RFM2Pi&quot; runtimesettings&nbsp;but I believe it has proved the same point just not as cleanly or clearly.</p>
<p>Also you can set any runtimesettings without restarting emonhub, when&nbsp;you look at&nbsp;the log the &quot;interval = 600&quot; setting is acknowledged 15 secs before you restart emonhub. to see this in action open 2 ssh windows at once and run the command &quot; tail -f /var/log/emonhub/emonhub.log in one and then in the other open emonhub.conf and edit some runtimesettings, each time you save the conf&nbsp;file the settings are picked up and applied to emonhub&nbsp;whilst running.&nbsp;</p>
<p>The addition of a &quot;interval = 600&quot; in the&nbsp;RFM2Pi&nbsp;runtimesettings&nbsp;as originally suggested may still&nbsp;shed a little more light if you wish to try that.</p>
<p>You could also remove the &quot;interval = 600&quot; from the &quot;emonCMSlocal&quot; runtimesettings, I recommend doing that as a separate&nbsp;&quot;save&quot; so the first action is easier to spot (this latter change will cause a rush&nbsp;in traffic to the local server&nbsp;as the restriction is lifted more on this below)</p>
<p>At 19:19:07 the last packet is processed from the rfm2pi, why that is the last packet I do not know at this point, perhaps an issue with the device, the serial port or indeed emonhub itself, however emonhub does continue to function as a backlog of packets has built up in the emonCMSLocal buffer due to the 10min&nbsp;posting rate set by the &quot;interval = 600&quot;&nbsp;and they continue to be delivered in batches of 100 every 10mins. However that continued delivery is in it&#39;s own child thread and the main parent thread may have stopped or is being blocked, I have never seen it occur and would not normally consider&nbsp;it an option but&nbsp;the lack of graceful shut down messages suggests emonhub has stopped, maybe.</p>
<p>Although at this point I do not think is is related and may even be detracting from the issue, but there are numerous &quot;dns/dhcp type&quot; error messages of more than one type, dotted throughout the log for both the local and remote emoncms&nbsp;connections. I know that&#39;s not something you want to hear but it is the case none the less.</p>
<p>I have attached your log with some notes throughout, it wasn&#39;t done in a way to publish it was just me adding markers whilst trying to decypher the info. If you use find or search in your text reader to search/find &quot;????&quot; all my comments start &quot;????&quot;.</p>
<p>There are some &quot;tracebacks&quot; that look like a failure but they are have been caught and handled correctly, the traceback&nbsp;is provided in th e log for debugging only.</p>
<p>Originally I said this was unlikely to be the same issue as Sheppy&#39;s&nbsp;based on the few facts provided of which one was the &quot;emonCMS timeout&quot; error message you provided, I think &quot;&quot;those&quot;&quot; types of error message are unrelated to this issue and for the time being more likely to be just a characteristic of your setup.</p>
<p>What is the socket interfacer? the &quot;sudo service&nbsp;emonhub&nbsp;status&quot; log you provided seems to mention reading sockets but although I see one created in your log it doesn&#39;t seem to be used (in this log) is it worth disabling it for the moment if it&#39;s not being used? if so just add a &quot;#&quot; (hash) in front of the &quot;Type = EmonHubSocketInterfacer&quot; line in emonhub.conf, this has the effect of hiding the configuration from emonhub as every interfacer&nbsp;must have a Type and any that don&#39;t are ignored.</p>
<p>Please provide a new log of the error with the new settings and also the &quot;sudo service&nbsp;emonhub status&quot; mini log might be useful.</p>
<p>Paul</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39085"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Wed, 03/02/2016 - 15:19.</div>
    <div class="content">
     <p>Paul,</p>
<p>Thanks for the clear explanations and apologies for putting the interval = 600 in the wrong place. Schoolboy error. I will rectify that and set things off again. I&#39;ll also comment out the socket interfacer, this is for my esp8266 Heat Bank controller which is reporting elsewhere until I get this thing going properly.</p>
<p>I can only see dns/dhcp&nbsp;type errors for the .org sends, all of only this type:</p>
<p>2016-02-03 09:02:16,066 WARNING emonCMS couldn&#39;t send to server, URLError: [Errno -2] Name or service not known</p>
<p>Am I missing something? We&#39;re with Virgin Media and their email was down yesterday&nbsp;so probably other things too which may have&nbsp;been causing these errors. And as you&nbsp;say are probably a DNS lookup problem and aren&#39;t detrimental to the whole as the next send works fine, so it&#39;s just a glitch which the code gets over.</p>
<p>Anyway, let&#39;s see if we get a log of a fail with the interval in the right place. Thanks again for taking the time to look at this.</p>
<p>Simon</p>
<p>PS Not sure if you&#39;ve seen the jeelib&nbsp;weblog recently but there&#39;s a very interesting development from&nbsp;Jean-Claude Wippler around his Jet/Hub concept. You may want to take a look before embarking on the next version of emonhub.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39086"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Wed, 03/02/2016 - 15:23.</div>
    <div class="content">
     <p>@Paul Reed.</p>
<p>The USB HDD script worked fine on another system (Pi2) with a Jessie Lite image, so I&#39;m not sure what happened on the PiB I&#39;m running things on.</p>
<p>Next time I need to restart the system I&#39;ll check it out on the PiB although I can&#39;t see how the system should have any impact on the script.</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39151"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sat, 06/02/2016 - 08:05.</div>
    <div class="content">
     <p>Failed again Paul...</p>
<p>I&#39;m going to try swapping the power supplies on the powered usb hub and the Pi to make sure it&#39;s not anything as daft as that. Can&#39;t see why it should cause any problems but you never know. I can also try running it just on the SD card.</p>
<p>pi@Homepi-emoncms:~ $ df -h<br />
Filesystem &nbsp; &nbsp; &nbsp;Size &nbsp;Used Avail Use% Mounted on<br />
/dev/root &nbsp; &nbsp; &nbsp; 5.1G &nbsp;1.3G &nbsp;3.6G &nbsp;26% /<br />
devtmpfs &nbsp; &nbsp; &nbsp; &nbsp; 87M &nbsp; &nbsp; 0 &nbsp; 87M &nbsp; 0% /dev<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp; &nbsp; 0 &nbsp; 91M &nbsp; 0% /dev/shm<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp;4.5M &nbsp; 87M &nbsp; 5% /run<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5.0M &nbsp;4.0K &nbsp;5.0M &nbsp; 1% /run/lock<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp; &nbsp; 0 &nbsp; 91M &nbsp; 0% /sys/fs/cgroup<br />
/dev/mmcblk0p1 &nbsp; 60M &nbsp; 20M &nbsp; 41M &nbsp;34% /boot<br />
pi@Homepi-emoncms:~ $ sudo service emonhub status<br />
● emonhub.service - LSB: Start/stop emonHub<br />
&nbsp; &nbsp;Loaded: loaded (/etc/init.d/emonhub)<br />
&nbsp; &nbsp;Active: active (running) since Fri 2016-02-05 09:35:28 GMT; 22h ago<br />
&nbsp; Process: 6156 ExecStop=/etc/init.d/emonhub stop (code=exited, status=0/SUCCESS)<br />
&nbsp; Process: 6197 ExecStart=/etc/init.d/emonhub start (code=exited, status=0/SUCCESS)<br />
&nbsp; &nbsp;CGroup: /system.slice/emonhub.service<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;└─6209 python /usr/share/emonhub/emonhub.py --logfile /var/log/emonhub/emonhub.log -...</p>
<p>Feb 05 09:35:28 Homepi-emoncms emonhub[6197]: Starting OpenEnergyMonitor emonHub: emonhub ha...ok.<br />
Feb 05 09:35:28 Homepi-emoncms systemd[1]: Started LSB: Start/stop emonHub.<br />
Hint: Some lines were ellipsized, use -l to show in full.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39155"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sat, 06/02/2016 - 11:26.</div>
    <div class="content">
     <p>And again - from strange to weird.</p>
<p>Emonhub has managed to change my rfm12pi to 433 from 868Mhz which of course stops it receiving anything.</p>
<p>You can see in the attached log how first of all it stops receiving while this time the interval 600 keeps on working but then some spurious commands seem to go out to the rfm12pi which changes it&#39;s frequency.</p>
<p>df and status as below. (I did a sudo shutdown -r now after the first failure this morning.)</p>
<p>Simon</p>
<p>pi@Homepi-emoncms:~ $ df -h<br />
Filesystem &nbsp; &nbsp; &nbsp;Size &nbsp;Used Avail Use% Mounted on<br />
/dev/root &nbsp; &nbsp; &nbsp; 5.1G &nbsp;1.3G &nbsp;3.6G &nbsp;26% /<br />
devtmpfs &nbsp; &nbsp; &nbsp; &nbsp; 87M &nbsp; &nbsp; 0 &nbsp; 87M &nbsp; 0% /dev<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp; &nbsp; 0 &nbsp; 91M &nbsp; 0% /dev/shm<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp;4.5M &nbsp; 87M &nbsp; 5% /run<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5.0M &nbsp;4.0K &nbsp;5.0M &nbsp; 1% /run/lock<br />
tmpfs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;91M &nbsp; &nbsp; 0 &nbsp; 91M &nbsp; 0% /sys/fs/cgroup<br />
/dev/mmcblk0p1 &nbsp; 60M &nbsp; 20M &nbsp; 41M &nbsp;34% /boot<br />
pi@Homepi-emoncms:~ $ sudo service emonhub status<br />
● emonhub.service - LSB: Start/stop emonHub<br />
&nbsp; &nbsp;Loaded: loaded (/etc/init.d/emonhub)<br />
&nbsp; &nbsp;Active: active (running) since Sat 2016-02-06 08:06:16 GMT; 3h 18min ago<br />
&nbsp; Process: 330 ExecStart=/etc/init.d/emonhub start (code=exited, status=0/SUCCESS)<br />
&nbsp; &nbsp;CGroup: /system.slice/emonhub.service<br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;└─372 python /usr/share/emonhub/emonhub.py --logfile /var/log/emonhub/emonhub.log --...</p>
<p>Feb 06 08:06:13 Homepi-emoncms emonhub[330]: Starting OpenEnergyMonitor emonHub: emonhub has...ok.<br />
Feb 06 08:06:16 Homepi-emoncms systemd[1]: Started LSB: Start/stop emonHub.<br />
Hint: Some lines were ellipsized, use -l to show in full.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39162"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sat, 06/02/2016 - 16:21.</div>
    <div class="content">
     <p><em>&quot;Emonhub has managed to change my rfm12pi to 433 from 868Mhz&quot;&nbsp;</em></p>
<p>Where are you seeing this? do you have another log as your post suggests this has happened more than oncw this morning.</p>
<p>I see that 7:15 all still seemed well and&nbsp;another &quot;normal&quot; response was recieved&nbsp;by broadcasting the time</p>
<blockquote><p>2016-02-06 07:15:50,897 DEBUG RFM2Pi broadcasting time: 07:15<br />
2016-02-06 07:15:51,119 DEBUG RFM2Pi acknowledged command: &gt; 0s<br />
2016-02-06 07:15:51,349 DEBUG RFM2Pi confirmed sent packet size: &nbsp;-&gt; 4 b</p>
</blockquote>
<p>The &quot;0s&quot; command to <strong>s</strong>end&nbsp;(with no request for an ack)&nbsp;the preceding csv (ie 0,7,15,0,) to node <strong>0</strong> (ie broadcast&nbsp;to&nbsp;all nodes)&nbsp;is acknowledged by the &quot;&gt; 0s&quot; returned from the rfm2pi and the packet size was also confirmed in the following line with &quot;-&gt; 4 b&quot; as 4 bytes correct for &quot;0,7,15,0&quot;</p>
<p>emonHub then continues to receive&nbsp;packets for the next 10mins until the last packet at&nbsp;07:25:46, 6secs later it broadcasts the time at it&#39;s 10min interval (600s) all appears normally up&nbsp;to this point, But the response from the rfm2pi is very odd indeed. it acknowledges a command of &quot;0b&quot; 3 times, these responses are&nbsp;the only &quot;bad&quot; thing I can see besides the lack of received packets beyond this point. There are another 2 successfully sent and&nbsp;confirmed (both&nbsp;command and size) time broadcasts at 7:35 and 7:45. which suggests despite the lack of received packets, both the rfm2pi and emonhub&nbsp;&quot;continue&quot; to function.</p>
<p>I use the term continue but I cannot rule out the rfm2pi is restarting at some point. If there were a crash recovery and the eeprom&nbsp;stored config, freq, baseid and group were not available it would probally revert any unavailable settings to&nbsp;433b,&nbsp;15i&nbsp;or&nbsp;210g as these are hard&nbsp;coded into the firmware. If we refer back to the &quot;rfm2pi goes hard down&quot; thread, only those users not sticking to the default 15i, 210g and 433b&nbsp;that get &quot;changes&quot; occuring and as I pointed out there, it is more likely the same thing is occuring to all users but it&#39;s undetectable on set-ups that stick to the defaults.</p>
<p>If the group, node or frequency were being changed and that was the cause of the original complaint then this could be proved by simply revising the settings in emonhub.conf, eg is you suspect the freq is wrong then change it to something other than what it should be, save the conf and then change it to what it should be again. emonhub will only send the &quot;new&quot; setting if there is a detected change in the conf&nbsp;file, so <u>it must change to</u> the correct setting to make emonhub reapply it.</p>
<p>Going back to what we see in emonhubs log the <a href="https://github.com/emonhub/emonhub/blob/development/src/emonhub_interfacer.py#L620">time is sent from emonhub via a hardcoded command that just has the hour and minutes values changed according to time</a>&nbsp;so it is unlikely for that string to morph into something else to result in the 3 &quot;0b&quot; commands.&nbsp;</p>
<p>Even if the commas of the csv could be mistaken as &quot;b&quot;s by the rfm2pi there would be a 1 min window at midnight where all the values were &quot;0&quot; and even then there would probably be either 4 &quot;0b&quot;s or the 3 &quot;0b&quot;s would be followed by a broadcast transmission of &quot;0&quot; bytes.</p>
<p>Plus you are seeing an issue that was there prior to the &quot;send time&quot; code being activated so if this is a valid fault caused by the time sending then it is another issue on top of what you were already seeing.</p>
<p>Looking at <a href="https://github.com/openenergymonitor/RFM2Pi/blob/master/firmware/RFM69CW_RF_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328/RFM69CW_RF12_Demo_ATmega328.ino#L410">the way the &quot;b&quot; command is processed in the&nbsp;current firmware</a>, the &quot;0b&quot; commands would not result in any changes anyway. the &quot;if(value)&quot; would fail as the value is &quot;0&quot;.&nbsp;</p>
<p>If emonhub was to change the frequency setting I would expect&nbsp;lines like this (taken from your previous log)</p>
<blockquote><p>2016-02-02 14:30:41,985 INFO Setting RFM2Pi frequency: 868 (8b)<br />
2016-02-02 14:30:46,062 DEBUG RFM2Pi acknowledged command: &gt; 8b</p>
</blockquote>
<p>Right now I suspect the rfm2pi is at fault, although the evidence is far from&nbsp;conclusive, I was previously confident about emonHubs&nbsp;performance and less confident of any rfm2pi firmware, the clues we see do seem to fit that idea more than&nbsp;they cause me to question it.</p>
<p>The other log may show something different, or future logs may shed some light perhaps.</p>
<p>Would you consider installing a later firmware to the&nbsp;rfm69pi that you are not currently using???</p>
<p>We could write some extra logging&nbsp;into your&nbsp;emonhub to see&nbsp;exactly what is sent to the serial port at the time of the &quot;send time&quot; if we see this fail coincide with a send again but I do not feel that is the cause as it wasn&#39;t originally active.</p>
<p>Or add a line to emonhub to&nbsp;log everything received from the rfm2pi rather than discard anything not relevant to emonhub, but I feel these efforts would do very little even if they do reveal anything (and I&#39;m not too sure they would) as we cannot change anything in the rfm2pi without uploading new firmware.</p>
<p>The systend&nbsp;mini log and the df -h do not show anything odd, in&nbsp;fact the systemd&nbsp;log seems to confirm there was no perceived issues during either the 22hrs&nbsp;or the 3hrs 18mins&nbsp;emonhub&nbsp;was running.</p>
<p>Sorry, I wish I could put my finger on the exact cause but currently the only smoking gun I see is the one used to put another hole in the messenger :-)</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39205"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Mon, 08/02/2016 - 10:03.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Apologies for the slow response. Life tries to continue even though my emoncms&nbsp;sysadmin work wants to take over. &nbsp;:-)</p>
<p>Anyway, where to start, I guess where you left off.... &nbsp;Smoking gun, I see no smoking guns around here... &nbsp;Sounds like the wide mouthed frog joke...</p>
<p>More seriously though, the system crashed again yesterday. I&#39;ve attached the log again and leaving the interval timer running begins to shw some patterns.</p>
<p>Take a look at these extracts:</p>
<p>2016-02-07 <strong>22</strong>:48:24,049 DEBUG RFM2Pi broadcasting time: 22:48<br />
2016-02-07 22:48:24,275 DEBUG RFM2Pi acknowledged command: &gt;<strong> 22</strong>b</p>
<p>&nbsp;</p>
<p>2016-02-07 22:58:27,321 DEBUG RFM2Pi acknowledged command: &gt; 0b<br />
2016-02-07 22:<strong>58</strong>:27,762 DEBUG RFM2Pi acknowledged command: &gt; <strong>58</strong>b</p>
<p>Fortunately the rfm12&nbsp;has at some stage been switched to 433, so the log isn&#39;t cluttered with received buffers as it&#39;s long since given up the ghost on that front.</p>
<p>In the log, the 1st failure happens around 9:59 yesterday with the 0bs and 0ss and after that I did a sudo shutdown -r.</p>
<p>At 13:07 it goes again and you can see the rfm12 responses start to match parts of the time and packets stop, so somehow the rfm12 has reverted to 433MHz</p>
<p>Then you get this sequence, which shows the rfm12 acking an 8b command and obviously reverting to 868MHz as packets start to arrive 5 seconds later.</p>
<p>2016-02-07 18:08:21,477 DEBUG RFM2Pi acknowledged command: &gt; 8b<br />
2016-02-07 18:08:25,014 DEBUG 709 NEW FRAME : 1454868505.01 &nbsp;10 197 8 0 0 0 0 0 0 231 93 210 1 132 2 210 1 166 2 119 1</p>
<p>And then 10 minutes later it goes again, although this time we see a 1b command which will change the band although it&#39;s not a valid b command.</p>
<p>2016-02-07 18:18:10,175 DEBUG emonCMS acknowledged receipt with &#39;ok&#39; from <a href="http://emoncms.org/" title="http://emoncms.org">http://emoncms.org</a><br />
2016-02-07 18:18:21,282 DEBUG RFM2Pi broadcasting time: 18:18<br />
2016-02-07 18:18:21,504 DEBUG RFM2Pi acknowledged command: &gt; 1b<br />
2016-02-07 18:18:21,946 DEBUG RFM2Pi acknowledged command: &gt; 0b<br />
2016-02-07 18:28:21,355 DEBUG RFM2Pi broadcasting time: 18:28<br />
2016-02-07 18:28:21,577 DEBUG RFM2Pi acknowledged command: &gt; 0s<br />
2016-02-07 18:28:21,799 DEBUG RFM2Pi confirmed sent packet size: &nbsp;-&gt; 4 b</p>
<p>So all told I&#39;m not sure I&#39;m any clearer, except in this log we&#39;ve seen some reasons as to why the rfm12 changes band.</p>
<p>Following on from what you said in your earlier analysis, I guess it could be that the rfm12 is restarting but somehow with the various b commands being received, I&#39;m not sure about this. Doesn&#39;t the rfm12&nbsp;store the settings in EEPROM? And if so wouldn&#39;t it simply restart in 868.</p>
<p>Or is all of this just some flaky connection or power supply. I did swap the power supply a few days ago when I moved the system onto my work bench, maybe I&#39;ll try the cable and a different usb hub to see if it is down to the those types of issues.</p>
<p>Smoking guns, anyone seen any smoking guns? &nbsp; :-)</p>
<p>Simon</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39214"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 08/02/2016 - 14:06.</div>
    <div class="content">
     <p>Ok this log has far more interesting bits. I can see some of the time updates do result in incorrect acknowledgements, where it could be tripping up isn&#39;t really clear, is emonhub sending the correct packet? is the packet arriving intact at the rfm2pi? or is the rfm2pi misinterpreting the packet?</p>
<p>The time sends themselves&nbsp;cannot be the root of the issue, as previously pointed out your&nbsp;issue pre-dates&nbsp;the activation of the time sending code and the time send packet is hardcoded so that only the hours and minutes values are changed, the csv commas and the trailing s command are fixed in the write to serial port&nbsp;code.</p>
<p>There are many instances that do not make any sense, to point where the responses may just be garbage without an obvious pattern. I have studied alot of emonhub.logs for many reasons as you can imagine and I have never seen &quot;rogue acknowledgements&quot;, given I wasn&#39;t looking for them I cannot say they do not exist but I would have certainly expected to have noted some along the way.</p>
<p>I can see from the help-text and current configuration text blocks that the frequency has been changed to 433, but at no time was there a logged &quot;4b&quot; command nor an acknowledgement to that effect, there are many, many &quot;0b&quot;s and some &quot;1b&quot;s and although they may not show the command being sent the commands are acknowledged, so why not the &quot;4b&quot; even the &quot;8b&quot;s are always acknowledged.</p>
<p>There are instances where the time is sent and the minutes OR the hours get morphed into a b command, but never both, why do some get morphed into 4 x &quot;0b&quot;s ? ie what happened to BOTH the time values.</p>
<p>There is an&nbsp;instance where &quot;0i&quot; is set, this is an issue that was fixed in the last commit to the oem rfm2pi firmware, that causes a &quot;failed configuration&quot; and will not recover untill&nbsp;a valid node id is set (1 to 30), or a reboot/crash forces the use of eeprom&nbsp;values.</p>
<p>You comment above about the settings being stored in the&nbsp;eeprom&nbsp;is correct, IF that is functioning correctly that is what is supposed to happen, as you&#39;ll see in the other thread there is a question over the rfm2pi forgetting it&#39;s config and reverting to the hardcoded&nbsp;values, highlighted by Glyn&nbsp;using a version that did not store it&#39;s config to the eeprom.</p>
<p>The help text for your device clearly states &lt;nnn&gt;g will set the group but looking closer at your logs the 210g command never works, nor does the &quot;q&quot; but that was absent from some firmwares.</p>
<p>Looking back at your first &quot;600&quot; log there is an instant where at 8:23 3rd feb the group and quiet commands are sent</p>
<p>2016-02-03 08:23:22,242 INFO Setting RFM2Pi group: 210 (210g)<br />
2016-02-03 08:23:23,246 INFO Setting RFM2Pi quiet: 1 (1q)&nbsp;</p>
<p>and they are somehow morphed into one</p>
<p>2016-02-03 08:23:29,763 DEBUG RFM2Pi acknowledged command: &gt; 211q</p>
<p>​This is when the interval = 600 was in the reporter so there was no time sending, but the way emonhub processes settings in a loop it uses a fixed pattern to write to the serial port&nbsp;with only the command in the brackets inserted and sent each loop before it reads the next setting. At the other end in the rfm2pi firmware each char is processed individually and any &quot;command character&quot; can trigger the processing of a command using the previous value(s). eg&nbsp;8b&nbsp;is a &quot;b&quot; command and the&nbsp;last value was 8 so &quot;8b&quot; it is.</p>
<p>This&nbsp;leads me to believe the rfm2pi&nbsp;had taken the leading &quot;21&quot; of the &quot;210g&quot; and&nbsp;not seen or ignored the rest until the &quot;1q&quot; arrived making the command &quot;211q&quot;, whether that is a serial issue or a firmware issue or an hardware issue I couldn&#39;t say based on what we have.</p>
<p>There also seems to be alot of coincidence suggesting reuse of variables perhaps, why do the time sends result mainly in &quot;b&quot;s and occasionally an &quot;i&quot;? why any other command character eg &quot;a&quot;?</p>
<p>I do not see enough of a pattern&nbsp;to determine the cause. Unless you can monitor the serial traffic somehow you need to change one end or the other to move forward, v1.2&nbsp;emonhub is being used reliably on many systems and is less likely to be the cause based on the little evidence we have. Your rfm2pi&nbsp;is running an unknown out of date firmware that may (or may not) be the cause.</p>
<p>You have a spare&nbsp;device and the quickest and most sensible test you can do right now is to load the firmware that Paul Reed is testing for a similar issue, see <a href="12004.html">&quot;Feeds stop updating&quot;</a>&nbsp;and try that before anything else. the data we are gathering seems too random to be of use and if it does turn out to be a problem with a firmware that should be out of service then we have all wasted out time.</p>
<p>I am not saying it is definitely&nbsp;the rfm2pi firmware, nor am I saying the firmware Paul is testing will fix it. But there is a long standing issue with a number of rfm2pi&#39;s&nbsp;that predates your setup and emonhub so it would seem the best place to start is there unless there is evidence to suggest something different to tackle.</p>
<p>It could possibly be power related I guess, but since the Pi is more power hungry and less &quot;single minded&quot; than the AVR I would of expected trouble to manifest in other ways too, but I suppose it also depends on how robust the hardware is to low voltage? It may also be a &quot;Jessie&quot; or &quot;Jessie-lite&quot; issue as these are still relatively new ventures and may require &quot;tweeks&quot; to the way we have been doing&nbsp;things in wheezy, including emonhub. And yes it could be an&nbsp;emonhub issue too which I would be very keen to resolve if it turns out to be the case.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39220"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Mon, 08/02/2016 - 15:40.</div>
    <div class="content">
     <p>Hi Paul,</p>
<p>Yes I can bet you&#39;ve seen your share of emonhub logs in your time!</p>
<p>I think we can rule out power supply issues as I swapped out both supplies (Pi and USB hub) and it&#39;s still failing.</p>
<p>I&#39;ve been watching the other thread with interest and will try updating the firmware as outlined there. I&#39;ll let you know if there is any progress. Might try it on the spare&nbsp;rfm69 as you suggested earlier.&nbsp;</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39228"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Mon, 08/02/2016 - 18:04.</div>
    <div class="content">
     <p>Yes if you are tempted to try the firmware update then I would recommend the rfm69pi, it&#39;s not in service so you can swap it in and then out again if it&#39;s worse, leaving your existing rfm12&nbsp;rfm2pi as it is until we are a little more sure of the situation&nbsp;means you have little&nbsp;to lose by trying the later firmware.&nbsp;</p>
<p>The hex file attached to that thread is compiled for a rfm69&nbsp;so it will not run on your rfm12 device, I can recompile for a rfm12 no problem but it would be better at this stage if all testing was done with a common hardware/firmware combo.&nbsp;&nbsp;&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39543"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Fri, 19/02/2016 - 12:15.</div>
    <div class="content">
     <p>So more than a week later and with the rfm69 in place and updated to the firmware Paul provided in this thread everything is running fine. So I think my issues must have been down to a failing rfm12 (hardware).</p>
<p>Thought I&#39;d give this thread a jog as I noticed Paul (Reed) had had another failure.</p>
<p>For the record my system is a PiB with Jessie Lite running on a USB HDD and an rfm69 running the firmware above.</p>
<p>Simon</p>
<p>PS - I&#39;ve also rebooted my router a couple of times in the last week and Jessie Lite&nbsp;hasn&#39;t had any problems in reconnecting (Edimax dongle).</p>
<p>PPS Thanks to Paul as usual for the patience and taking the trouble to make the latest firmware for the rfm.</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39593"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 21/02/2016 - 13:03.</div>
    <div class="content">
     <p>This is good news Simon.</p>
<p>Regarding your other rfm2pi, it may well be a firmware issue not a hardware issue, can you confirm it is definitely a v2 not a v1 (I&#39;m sure we&#39;ve done this but I want to be sure) ie it is a small&nbsp;surface mount mcu not a big 28 pin DIL ?</p>
<p>I can recompile the firmware for you to use on a rfm12b&nbsp;RFM2Pi&nbsp;v2 very easily, I have only refrained from doing so only&nbsp;to avoid confusion since we are only currently focusing on debugging the rfm69, perhaps we can try that down the line once the firmware is a little more tried and (time)tested, so don&#39;t give up on or bin the rfm12&nbsp;device just yet.</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39596"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 21/02/2016 - 13:36.</div>
    <div class="content">
     <p>Hi Paul, was beginning to worry about your health! A week away, must have been vacation :-)</p>
<p>As for the rfm12 it&#39;s a V2.5.3 with the surface mount. I&#39;d be glad to test it again with revised firmware although of course the system is running like a train at the mo&#39; (fingers crossed of course) so maybe it would be worth waiting to see if it fails again. And as you imply fixing the 69 versions is much more important as the 12s are not being supplied any more.</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39604"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/4440.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/pictures/picture-4440.jpg" alt="pb66&#039;s picture" title="pb66&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/4440.html" title="View user profile.">pb66</a> on Sun, 21/02/2016 - 14:56.</div>
    <div class="content">
     <p>&quot;vacation&quot; no such luck! Just very, very busy with a&nbsp;work project at the moment, lots of very long days, my sanity is&nbsp;as much a concern as my health right now :-)&nbsp; But thanks for your thoughts :-)</p>
<p>I didn&#39;t intend to imply rfm69 was more important, just that there are more active &quot;69&quot; complainers ie testers and not complicating the issue with 2 different rfm modules seemed the wiser option, lets stick with &quot;69&quot; now for simplicity and then if/when fixed we can roll out to rfm12, these are perhaps&nbsp;the devices that will most need the updated firmware as they are further behind.</p>
<p>I have an almost finished script that will be incorporated into emonhub to &quot;watch&quot; a firmware repo (local or remote) and if the &quot;version&quot; increases it will update the rfm2pi automatically, it does not require the use of the &quot;avrdude-rpi&quot; mods it all done in-house by emonhub.&nbsp;I would hope to roll this out to all emonhub +&nbsp;rfm2pi&nbsp;users regardless of vintage of device to activate the code the user would just need to define the device ie 12 or 69 in emonhub.conf.&nbsp;</p>
<p>This paves the way for a closer emonhub to rfm2pi integration as I am also working on &quot;fault codes&quot; as a shorthand way for the rfm2pi to communicate it&#39;s status or events to emonhub&nbsp;which will in turn react or at least log them in user friendly&nbsp;long hand messages.&nbsp;</p>
<p>Paul</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<a id="comment-39607"></a>
  <div class="comment comment-published" >
    <div class="picture">
  <a href="../user/937.html" title="View user profile."><img src="../sites/default/files/imagecache/avatar/default_0.png" alt="Bramco&#039;s picture" title="Bramco&#039;s picture" width="50" height="50" class="imagecache imagecache-avatar"/></a></div>

<h3 class="title" style="padding-bottom:5px">Re: Emonpi image, RFM69PI images froze, rest of Emonhub MQTT inputs still ok</h3>

    <div class="submitted">Submitted by <a href="../user/937.html" title="View user profile.">Bramco</a> on Sun, 21/02/2016 - 15:32.</div>
    <div class="content">
     <p>Sounds like a good plan Paul. The more these things can be automated and provide sensible long hand messages the better. Although of course all that added functionality also needs to be idiot proofed - don&#39;t go there...</p>
<p>In the long term I&#39;m planning to move away from rfm and onto wifi based systems (esp8266). My Heat Bank and CH controller (esp8266) now monitors all the temperature sensors, so the emonTx is only managing the PV diversion and reporting the power. As soon as I have that set up to manage the boiler properly with weather compensation etc. via&nbsp;node-red and MQTT, I&#39;ll be trying to build a replacement for the emonTx&nbsp;based on an esp8266 using an external ADC chip to start with.&nbsp;</p>
<p>Simon</p>
         </div>
    <div class="links">&raquo; <ul class="links"><li class="comment_forbidden first last"></li>
</ul></div>
  </div>
<form action="https://openenergymonitor.org/emon/node/12108"  accept-charset="UTF-8" method="post" id="comment-controls">
<div>  <div class="box">
    <h2 class="title">Comment viewing options</h2>    <div class="content"><div class="container-inline"><input type="hidden" name="form_build_id" id="form-eeFGOFqEPEwtCPd9hKXJLwI8paRfvR5uzXzWcMAhH4k" value="form-eeFGOFqEPEwtCPd9hKXJLwI8paRfvR5uzXzWcMAhH4k"  />
<input type="hidden" name="form_id" id="edit-comment-controls" value="comment_controls"  />
<div class="form-item" id="edit-mode-wrapper">
 <select name="mode" class="form-select" id="edit-mode" ><option value="1">Flat list - collapsed</option><option value="2" selected="selected">Flat list - expanded</option><option value="3">Threaded list - collapsed</option><option value="4">Threaded list - expanded</option></select>
</div>
<div class="form-item" id="edit-order-wrapper">
 <select name="order" class="form-select" id="edit-order" ><option value="1">Date - newest first</option><option value="2" selected="selected">Date - oldest first</option></select>
</div>
<div class="form-item" id="edit-comments-per-page-wrapper">
 <select name="comments_per_page" class="form-select" id="edit-comments-per-page" ><option value="10">10 comments per page</option><option value="30">30 comments per page</option><option value="50">50 comments per page</option><option value="70">70 comments per page</option><option value="90">90 comments per page</option><option value="150">150 comments per page</option><option value="200">200 comments per page</option><option value="250">250 comments per page</option><option value="300" selected="selected">300 comments per page</option></select>
</div>
<input type="submit" name="op" id="edit-submit" value="Save settings"  class="form-submit" />
</div><div class="description">Select your preferred way to display the comments and click "Save settings" to activate your changes.</div></div>
 </div>


</div></form>
</div>
      
              </div>
    </td>
      </tr>
</table>

<div id="footer">
  <p>Open-source tools for energy monitoring and analysis.&nbsp;Forum has moved to: <a href="https://community.openenergymonitor.org/">https://community.openenergymonitor.org</a></p>
   
</div>


</div>
</body>


<!-- Mirrored from openenergymonitor.org/emon/node/12108 by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 20 Feb 2017 14:44:56 GMT -->
</html>
